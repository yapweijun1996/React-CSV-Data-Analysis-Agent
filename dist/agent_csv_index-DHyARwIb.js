(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();function Op(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var am={exports:{}},Do={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Mv;function AE(){if(Mv)return Do;Mv=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(s,i,o){var u=null;if(o!==void 0&&(u=""+o),i.key!==void 0&&(u=""+i.key),"key"in i){o={};for(var d in i)d!=="key"&&(o[d]=i[d])}else o=i;return i=o.ref,{$$typeof:t,type:s,key:u,ref:i!==void 0?i:null,props:o}}return Do.Fragment=e,Do.jsx=n,Do.jsxs=n,Do}var Iv;function EE(){return Iv||(Iv=1,am.exports=AE()),am.exports}var x=EE(),rm={exports:{}},Pe={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Dv;function RE(){if(Dv)return Pe;Dv=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),u=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),v=Symbol.for("react.lazy"),S=Symbol.for("react.activity"),w=Symbol.iterator;function C(N){return N===null||typeof N!="object"?null:(N=w&&N[w]||N["@@iterator"],typeof N=="function"?N:null)}var M={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},I=Object.assign,k={};function F(N,q,te){this.props=N,this.context=q,this.refs=k,this.updater=te||M}F.prototype.isReactComponent={},F.prototype.setState=function(N,q){if(typeof N!="object"&&typeof N!="function"&&N!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,N,q,"setState")},F.prototype.forceUpdate=function(N){this.updater.enqueueForceUpdate(this,N,"forceUpdate")};function V(){}V.prototype=F.prototype;function G(N,q,te){this.props=N,this.context=q,this.refs=k,this.updater=te||M}var z=G.prototype=new V;z.constructor=G,I(z,F.prototype),z.isPureReactComponent=!0;var ae=Array.isArray;function Q(){}var J={H:null,A:null,T:null,S:null},j=Object.prototype.hasOwnProperty;function X(N,q,te){var re=te.ref;return{$$typeof:t,type:N,key:q,ref:re!==void 0?re:null,props:te}}function ne(N,q){return X(N.type,q,N.props)}function le(N){return typeof N=="object"&&N!==null&&N.$$typeof===t}function _(N){var q={"=":"=0",":":"=2"};return"$"+N.replace(/[=:]/g,function(te){return q[te]})}var E=/\/+/g;function P(N,q){return typeof N=="object"&&N!==null&&N.key!=null?_(""+N.key):q.toString(36)}function D(N){switch(N.status){case"fulfilled":return N.value;case"rejected":throw N.reason;default:switch(typeof N.status=="string"?N.then(Q,Q):(N.status="pending",N.then(function(q){N.status==="pending"&&(N.status="fulfilled",N.value=q)},function(q){N.status==="pending"&&(N.status="rejected",N.reason=q)})),N.status){case"fulfilled":return N.value;case"rejected":throw N.reason}}throw N}function T(N,q,te,re,de){var ue=typeof N;(ue==="undefined"||ue==="boolean")&&(N=null);var pe=!1;if(N===null)pe=!0;else switch(ue){case"bigint":case"string":case"number":pe=!0;break;case"object":switch(N.$$typeof){case t:case e:pe=!0;break;case v:return pe=N._init,T(pe(N._payload),q,te,re,de)}}if(pe)return de=de(N),pe=re===""?"."+P(N,0):re,ae(de)?(te="",pe!=null&&(te=pe.replace(E,"$&/")+"/"),T(de,q,te,"",function(en){return en})):de!=null&&(le(de)&&(de=ne(de,te+(de.key==null||N&&N.key===de.key?"":(""+de.key).replace(E,"$&/")+"/")+pe)),q.push(de)),1;pe=0;var Ae=re===""?".":re+":";if(ae(N))for(var Fe=0;Fe<N.length;Fe++)re=N[Fe],ue=Ae+P(re,Fe),pe+=T(re,q,te,ue,de);else if(Fe=C(N),typeof Fe=="function")for(N=Fe.call(N),Fe=0;!(re=N.next()).done;)re=re.value,ue=Ae+P(re,Fe++),pe+=T(re,q,te,ue,de);else if(ue==="object"){if(typeof N.then=="function")return T(D(N),q,te,re,de);throw q=String(N),Error("Objects are not valid as a React child (found: "+(q==="[object Object]"?"object with keys {"+Object.keys(N).join(", ")+"}":q)+"). If you meant to render a collection of children, use an array instead.")}return pe}function R(N,q,te){if(N==null)return N;var re=[],de=0;return T(N,re,"","",function(ue){return q.call(te,ue,de++)}),re}function L(N){if(N._status===-1){var q=N._result;q=q(),q.then(function(te){(N._status===0||N._status===-1)&&(N._status=1,N._result=te)},function(te){(N._status===0||N._status===-1)&&(N._status=2,N._result=te)}),N._status===-1&&(N._status=0,N._result=q)}if(N._status===1)return N._result.default;throw N._result}var B=typeof reportError=="function"?reportError:function(N){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var q=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof N=="object"&&N!==null&&typeof N.message=="string"?String(N.message):String(N),error:N});if(!window.dispatchEvent(q))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",N);return}console.error(N)},H={map:R,forEach:function(N,q,te){R(N,function(){q.apply(this,arguments)},te)},count:function(N){var q=0;return R(N,function(){q++}),q},toArray:function(N){return R(N,function(q){return q})||[]},only:function(N){if(!le(N))throw Error("React.Children.only expected to receive a single React element child.");return N}};return Pe.Activity=S,Pe.Children=H,Pe.Component=F,Pe.Fragment=n,Pe.Profiler=i,Pe.PureComponent=G,Pe.StrictMode=s,Pe.Suspense=p,Pe.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=J,Pe.__COMPILER_RUNTIME={__proto__:null,c:function(N){return J.H.useMemoCache(N)}},Pe.cache=function(N){return function(){return N.apply(null,arguments)}},Pe.cacheSignal=function(){return null},Pe.cloneElement=function(N,q,te){if(N==null)throw Error("The argument must be a React element, but you passed "+N+".");var re=I({},N.props),de=N.key;if(q!=null)for(ue in q.key!==void 0&&(de=""+q.key),q)!j.call(q,ue)||ue==="key"||ue==="__self"||ue==="__source"||ue==="ref"&&q.ref===void 0||(re[ue]=q[ue]);var ue=arguments.length-2;if(ue===1)re.children=te;else if(1<ue){for(var pe=Array(ue),Ae=0;Ae<ue;Ae++)pe[Ae]=arguments[Ae+2];re.children=pe}return X(N.type,de,re)},Pe.createContext=function(N){return N={$$typeof:u,_currentValue:N,_currentValue2:N,_threadCount:0,Provider:null,Consumer:null},N.Provider=N,N.Consumer={$$typeof:o,_context:N},N},Pe.createElement=function(N,q,te){var re,de={},ue=null;if(q!=null)for(re in q.key!==void 0&&(ue=""+q.key),q)j.call(q,re)&&re!=="key"&&re!=="__self"&&re!=="__source"&&(de[re]=q[re]);var pe=arguments.length-2;if(pe===1)de.children=te;else if(1<pe){for(var Ae=Array(pe),Fe=0;Fe<pe;Fe++)Ae[Fe]=arguments[Fe+2];de.children=Ae}if(N&&N.defaultProps)for(re in pe=N.defaultProps,pe)de[re]===void 0&&(de[re]=pe[re]);return X(N,ue,de)},Pe.createRef=function(){return{current:null}},Pe.forwardRef=function(N){return{$$typeof:d,render:N}},Pe.isValidElement=le,Pe.lazy=function(N){return{$$typeof:v,_payload:{_status:-1,_result:N},_init:L}},Pe.memo=function(N,q){return{$$typeof:m,type:N,compare:q===void 0?null:q}},Pe.startTransition=function(N){var q=J.T,te={};J.T=te;try{var re=N(),de=J.S;de!==null&&de(te,re),typeof re=="object"&&re!==null&&typeof re.then=="function"&&re.then(Q,B)}catch(ue){B(ue)}finally{q!==null&&te.types!==null&&(q.types=te.types),J.T=q}},Pe.unstable_useCacheRefresh=function(){return J.H.useCacheRefresh()},Pe.use=function(N){return J.H.use(N)},Pe.useActionState=function(N,q,te){return J.H.useActionState(N,q,te)},Pe.useCallback=function(N,q){return J.H.useCallback(N,q)},Pe.useContext=function(N){return J.H.useContext(N)},Pe.useDebugValue=function(){},Pe.useDeferredValue=function(N,q){return J.H.useDeferredValue(N,q)},Pe.useEffect=function(N,q){return J.H.useEffect(N,q)},Pe.useEffectEvent=function(N){return J.H.useEffectEvent(N)},Pe.useId=function(){return J.H.useId()},Pe.useImperativeHandle=function(N,q,te){return J.H.useImperativeHandle(N,q,te)},Pe.useInsertionEffect=function(N,q){return J.H.useInsertionEffect(N,q)},Pe.useLayoutEffect=function(N,q){return J.H.useLayoutEffect(N,q)},Pe.useMemo=function(N,q){return J.H.useMemo(N,q)},Pe.useOptimistic=function(N,q){return J.H.useOptimistic(N,q)},Pe.useReducer=function(N,q,te){return J.H.useReducer(N,q,te)},Pe.useRef=function(N){return J.H.useRef(N)},Pe.useState=function(N){return J.H.useState(N)},Pe.useSyncExternalStore=function(N,q,te){return J.H.useSyncExternalStore(N,q,te)},Pe.useTransition=function(){return J.H.useTransition()},Pe.version="19.2.0",Pe}var Pv;function il(){return Pv||(Pv=1,rm.exports=RE()),rm.exports}var ce=il();const $s=Op(ce);var im={exports:{}},Po={},om={exports:{}},lm={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kv;function NE(){return kv||(kv=1,(function(t){function e(T,R){var L=T.length;T.push(R);e:for(;0<L;){var B=L-1>>>1,H=T[B];if(0<i(H,R))T[B]=R,T[L]=H,L=B;else break e}}function n(T){return T.length===0?null:T[0]}function s(T){if(T.length===0)return null;var R=T[0],L=T.pop();if(L!==R){T[0]=L;e:for(var B=0,H=T.length,N=H>>>1;B<N;){var q=2*(B+1)-1,te=T[q],re=q+1,de=T[re];if(0>i(te,L))re<H&&0>i(de,te)?(T[B]=de,T[re]=L,B=re):(T[B]=te,T[q]=L,B=q);else if(re<H&&0>i(de,L))T[B]=de,T[re]=L,B=re;else break e}}return R}function i(T,R){var L=T.sortIndex-R.sortIndex;return L!==0?L:T.id-R.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var u=Date,d=u.now();t.unstable_now=function(){return u.now()-d}}var p=[],m=[],v=1,S=null,w=3,C=!1,M=!1,I=!1,k=!1,F=typeof setTimeout=="function"?setTimeout:null,V=typeof clearTimeout=="function"?clearTimeout:null,G=typeof setImmediate<"u"?setImmediate:null;function z(T){for(var R=n(m);R!==null;){if(R.callback===null)s(m);else if(R.startTime<=T)s(m),R.sortIndex=R.expirationTime,e(p,R);else break;R=n(m)}}function ae(T){if(I=!1,z(T),!M)if(n(p)!==null)M=!0,Q||(Q=!0,_());else{var R=n(m);R!==null&&D(ae,R.startTime-T)}}var Q=!1,J=-1,j=5,X=-1;function ne(){return k?!0:!(t.unstable_now()-X<j)}function le(){if(k=!1,Q){var T=t.unstable_now();X=T;var R=!0;try{e:{M=!1,I&&(I=!1,V(J),J=-1),C=!0;var L=w;try{t:{for(z(T),S=n(p);S!==null&&!(S.expirationTime>T&&ne());){var B=S.callback;if(typeof B=="function"){S.callback=null,w=S.priorityLevel;var H=B(S.expirationTime<=T);if(T=t.unstable_now(),typeof H=="function"){S.callback=H,z(T),R=!0;break t}S===n(p)&&s(p),z(T)}else s(p);S=n(p)}if(S!==null)R=!0;else{var N=n(m);N!==null&&D(ae,N.startTime-T),R=!1}}break e}finally{S=null,w=L,C=!1}R=void 0}}finally{R?_():Q=!1}}}var _;if(typeof G=="function")_=function(){G(le)};else if(typeof MessageChannel<"u"){var E=new MessageChannel,P=E.port2;E.port1.onmessage=le,_=function(){P.postMessage(null)}}else _=function(){F(le,0)};function D(T,R){J=F(function(){T(t.unstable_now())},R)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(T){T.callback=null},t.unstable_forceFrameRate=function(T){0>T||125<T?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):j=0<T?Math.floor(1e3/T):5},t.unstable_getCurrentPriorityLevel=function(){return w},t.unstable_next=function(T){switch(w){case 1:case 2:case 3:var R=3;break;default:R=w}var L=w;w=R;try{return T()}finally{w=L}},t.unstable_requestPaint=function(){k=!0},t.unstable_runWithPriority=function(T,R){switch(T){case 1:case 2:case 3:case 4:case 5:break;default:T=3}var L=w;w=T;try{return R()}finally{w=L}},t.unstable_scheduleCallback=function(T,R,L){var B=t.unstable_now();switch(typeof L=="object"&&L!==null?(L=L.delay,L=typeof L=="number"&&0<L?B+L:B):L=B,T){case 1:var H=-1;break;case 2:H=250;break;case 5:H=1073741823;break;case 4:H=1e4;break;default:H=5e3}return H=L+H,T={id:v++,callback:R,priorityLevel:T,startTime:L,expirationTime:H,sortIndex:-1},L>B?(T.sortIndex=L,e(m,T),n(p)===null&&T===n(m)&&(I?(V(J),J=-1):I=!0,D(ae,L-B))):(T.sortIndex=H,e(p,T),M||C||(M=!0,Q||(Q=!0,_()))),T},t.unstable_shouldYield=ne,t.unstable_wrapCallback=function(T){var R=w;return function(){var L=w;w=R;try{return T.apply(this,arguments)}finally{w=L}}}})(lm)),lm}var Lv;function ME(){return Lv||(Lv=1,om.exports=NE()),om.exports}var um={exports:{}},nn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Uv;function IE(){if(Uv)return nn;Uv=1;var t=il();function e(p){var m="https://react.dev/errors/"+p;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var v=2;v<arguments.length;v++)m+="&args[]="+encodeURIComponent(arguments[v])}return"Minified React error #"+p+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var s={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},i=Symbol.for("react.portal");function o(p,m,v){var S=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:S==null?null:""+S,children:p,containerInfo:m,implementation:v}}var u=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(p,m){if(p==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return nn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,nn.createPortal=function(p,m){var v=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(e(299));return o(p,m,null,v)},nn.flushSync=function(p){var m=u.T,v=s.p;try{if(u.T=null,s.p=2,p)return p()}finally{u.T=m,s.p=v,s.d.f()}},nn.preconnect=function(p,m){typeof p=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,s.d.C(p,m))},nn.prefetchDNS=function(p){typeof p=="string"&&s.d.D(p)},nn.preinit=function(p,m){if(typeof p=="string"&&m&&typeof m.as=="string"){var v=m.as,S=d(v,m.crossOrigin),w=typeof m.integrity=="string"?m.integrity:void 0,C=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;v==="style"?s.d.S(p,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:S,integrity:w,fetchPriority:C}):v==="script"&&s.d.X(p,{crossOrigin:S,integrity:w,fetchPriority:C,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},nn.preinitModule=function(p,m){if(typeof p=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var v=d(m.as,m.crossOrigin);s.d.M(p,{crossOrigin:v,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&s.d.M(p)},nn.preload=function(p,m){if(typeof p=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var v=m.as,S=d(v,m.crossOrigin);s.d.L(p,v,{crossOrigin:S,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},nn.preloadModule=function(p,m){if(typeof p=="string")if(m){var v=d(m.as,m.crossOrigin);s.d.m(p,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:v,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else s.d.m(p)},nn.requestFormReset=function(p){s.d.r(p)},nn.unstable_batchedUpdates=function(p,m){return p(m)},nn.useFormState=function(p,m,v){return u.H.useFormState(p,m,v)},nn.useFormStatus=function(){return u.H.useHostTransitionStatus()},nn.version="19.2.0",nn}var Ov;function DE(){if(Ov)return um.exports;Ov=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),um.exports=IE(),um.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Bv;function PE(){if(Bv)return Po;Bv=1;var t=ME(),e=il(),n=DE();function s(a){var r="https://react.dev/errors/"+a;if(1<arguments.length){r+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)r+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+a+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function o(a){var r=a,l=a;if(a.alternate)for(;r.return;)r=r.return;else{a=r;do r=a,(r.flags&4098)!==0&&(l=r.return),a=r.return;while(a)}return r.tag===3?l:null}function u(a){if(a.tag===13){var r=a.memoizedState;if(r===null&&(a=a.alternate,a!==null&&(r=a.memoizedState)),r!==null)return r.dehydrated}return null}function d(a){if(a.tag===31){var r=a.memoizedState;if(r===null&&(a=a.alternate,a!==null&&(r=a.memoizedState)),r!==null)return r.dehydrated}return null}function p(a){if(o(a)!==a)throw Error(s(188))}function m(a){var r=a.alternate;if(!r){if(r=o(a),r===null)throw Error(s(188));return r!==a?null:a}for(var l=a,c=r;;){var g=l.return;if(g===null)break;var y=g.alternate;if(y===null){if(c=g.return,c!==null){l=c;continue}break}if(g.child===y.child){for(y=g.child;y;){if(y===l)return p(g),a;if(y===c)return p(g),r;y=y.sibling}throw Error(s(188))}if(l.return!==c.return)l=g,c=y;else{for(var b=!1,A=g.child;A;){if(A===l){b=!0,l=g,c=y;break}if(A===c){b=!0,c=g,l=y;break}A=A.sibling}if(!b){for(A=y.child;A;){if(A===l){b=!0,l=y,c=g;break}if(A===c){b=!0,c=y,l=g;break}A=A.sibling}if(!b)throw Error(s(189))}}if(l.alternate!==c)throw Error(s(190))}if(l.tag!==3)throw Error(s(188));return l.stateNode.current===l?a:r}function v(a){var r=a.tag;if(r===5||r===26||r===27||r===6)return a;for(a=a.child;a!==null;){if(r=v(a),r!==null)return r;a=a.sibling}return null}var S=Object.assign,w=Symbol.for("react.element"),C=Symbol.for("react.transitional.element"),M=Symbol.for("react.portal"),I=Symbol.for("react.fragment"),k=Symbol.for("react.strict_mode"),F=Symbol.for("react.profiler"),V=Symbol.for("react.consumer"),G=Symbol.for("react.context"),z=Symbol.for("react.forward_ref"),ae=Symbol.for("react.suspense"),Q=Symbol.for("react.suspense_list"),J=Symbol.for("react.memo"),j=Symbol.for("react.lazy"),X=Symbol.for("react.activity"),ne=Symbol.for("react.memo_cache_sentinel"),le=Symbol.iterator;function _(a){return a===null||typeof a!="object"?null:(a=le&&a[le]||a["@@iterator"],typeof a=="function"?a:null)}var E=Symbol.for("react.client.reference");function P(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===E?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case I:return"Fragment";case F:return"Profiler";case k:return"StrictMode";case ae:return"Suspense";case Q:return"SuspenseList";case X:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case M:return"Portal";case G:return a.displayName||"Context";case V:return(a._context.displayName||"Context")+".Consumer";case z:var r=a.render;return a=a.displayName,a||(a=r.displayName||r.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case J:return r=a.displayName||null,r!==null?r:P(a.type)||"Memo";case j:r=a._payload,a=a._init;try{return P(a(r))}catch{}}return null}var D=Array.isArray,T=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,R=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,L={pending:!1,data:null,method:null,action:null},B=[],H=-1;function N(a){return{current:a}}function q(a){0>H||(a.current=B[H],B[H]=null,H--)}function te(a,r){H++,B[H]=a.current,a.current=r}var re=N(null),de=N(null),ue=N(null),pe=N(null);function Ae(a,r){switch(te(ue,r),te(de,a),te(re,null),r.nodeType){case 9:case 11:a=(a=r.documentElement)&&(a=a.namespaceURI)?Q0(a):0;break;default:if(a=r.tagName,r=r.namespaceURI)r=Q0(r),a=ev(r,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}q(re),te(re,a)}function Fe(){q(re),q(de),q(ue)}function en(a){a.memoizedState!==null&&te(pe,a);var r=re.current,l=ev(r,a.type);r!==l&&(te(de,a),te(re,l))}function yt(a){de.current===a&&(q(re),q(de)),pe.current===a&&(q(pe),Ro._currentValue=L)}var tn,Ie;function Oe(a){if(tn===void 0)try{throw Error()}catch(l){var r=l.stack.trim().match(/\n( *(at )?)/);tn=r&&r[1]||"",Ie=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+tn+a+Ie}var et=!1;function Ye(a,r){if(!a||et)return"";et=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var c={DetermineComponentFrameRoot:function(){try{if(r){var oe=function(){throw Error()};if(Object.defineProperty(oe.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(oe,[])}catch(ee){var W=ee}Reflect.construct(a,[],oe)}else{try{oe.call()}catch(ee){W=ee}a.call(oe.prototype)}}else{try{throw Error()}catch(ee){W=ee}(oe=a())&&typeof oe.catch=="function"&&oe.catch(function(){})}}catch(ee){if(ee&&W&&typeof ee.stack=="string")return[ee.stack,W.stack]}return[null,null]}};c.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var g=Object.getOwnPropertyDescriptor(c.DetermineComponentFrameRoot,"name");g&&g.configurable&&Object.defineProperty(c.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var y=c.DetermineComponentFrameRoot(),b=y[0],A=y[1];if(b&&A){var U=b.split(`
`),K=A.split(`
`);for(g=c=0;c<U.length&&!U[c].includes("DetermineComponentFrameRoot");)c++;for(;g<K.length&&!K[g].includes("DetermineComponentFrameRoot");)g++;if(c===U.length||g===K.length)for(c=U.length-1,g=K.length-1;1<=c&&0<=g&&U[c]!==K[g];)g--;for(;1<=c&&0<=g;c--,g--)if(U[c]!==K[g]){if(c!==1||g!==1)do if(c--,g--,0>g||U[c]!==K[g]){var se=`
`+U[c].replace(" at new "," at ");return a.displayName&&se.includes("<anonymous>")&&(se=se.replace("<anonymous>",a.displayName)),se}while(1<=c&&0<=g);break}}}finally{et=!1,Error.prepareStackTrace=l}return(l=a?a.displayName||a.name:"")?Oe(l):""}function he(a,r){switch(a.tag){case 26:case 27:case 5:return Oe(a.type);case 16:return Oe("Lazy");case 13:return a.child!==r&&r!==null?Oe("Suspense Fallback"):Oe("Suspense");case 19:return Oe("SuspenseList");case 0:case 15:return Ye(a.type,!1);case 11:return Ye(a.type.render,!1);case 1:return Ye(a.type,!0);case 31:return Oe("Activity");default:return""}}function ye(a){try{var r="",l=null;do r+=he(a,l),l=a,a=a.return;while(a);return r}catch(c){return`
Error generating stack: `+c.message+`
`+c.stack}}var wt=Object.prototype.hasOwnProperty,Me=t.unstable_scheduleCallback,rn=t.unstable_cancelCallback,dt=t.unstable_shouldYield,Dn=t.unstable_requestPaint,_t=t.unstable_now,rs=t.unstable_getCurrentPriorityLevel,Kn=t.unstable_ImmediatePriority,vs=t.unstable_UserBlockingPriority,on=t.unstable_NormalPriority,It=t.unstable_LowPriority,Jt=t.unstable_IdlePriority,xs=t.log,ft=t.unstable_setDisableYieldValue,ln=null,bt=null;function vn(a){if(typeof xs=="function"&&ft(a),bt&&typeof bt.setStrictMode=="function")try{bt.setStrictMode(ln,a)}catch{}}var Ht=Math.clz32?Math.clz32:$a,Dt=Math.log,Ws=Math.LN2;function $a(a){return a>>>=0,a===0?32:31-(Dt(a)/Ws|0)|0}var Zn=256,_r=262144,Ga=4194304;function Ss(a){var r=a&42;if(r!==0)return r;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return a&261888;case 262144:case 524288:case 1048576:case 2097152:return a&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function br(a,r,l){var c=a.pendingLanes;if(c===0)return 0;var g=0,y=a.suspendedLanes,b=a.pingedLanes;a=a.warmLanes;var A=c&134217727;return A!==0?(c=A&~y,c!==0?g=Ss(c):(b&=A,b!==0?g=Ss(b):l||(l=A&~a,l!==0&&(g=Ss(l))))):(A=c&~y,A!==0?g=Ss(A):b!==0?g=Ss(b):l||(l=c&~a,l!==0&&(g=Ss(l)))),g===0?0:r!==0&&r!==g&&(r&y)===0&&(y=g&-g,l=r&-r,y>=l||y===32&&(l&4194048)!==0)?r:g}function Ha(a,r){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&r)===0}function Yc(a,r){switch(a){case 1:case 2:case 4:case 8:case 64:return r+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function yl(){var a=Ga;return Ga<<=1,(Ga&62914560)===0&&(Ga=4194304),a}function Fi(a){for(var r=[],l=0;31>l;l++)r.push(a);return r}function za(a,r){a.pendingLanes|=r,r!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function Kc(a,r,l,c,g,y){var b=a.pendingLanes;a.pendingLanes=l,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=l,a.entangledLanes&=l,a.errorRecoveryDisabledLanes&=l,a.shellSuspendCounter=0;var A=a.entanglements,U=a.expirationTimes,K=a.hiddenUpdates;for(l=b&~l;0<l;){var se=31-Ht(l),oe=1<<se;A[se]=0,U[se]=-1;var W=K[se];if(W!==null)for(K[se]=null,se=0;se<W.length;se++){var ee=W[se];ee!==null&&(ee.lane&=-536870913)}l&=~oe}c!==0&&$i(a,c,0),y!==0&&g===0&&a.tag!==0&&(a.suspendedLanes|=y&~(b&~r))}function $i(a,r,l){a.pendingLanes|=r,a.suspendedLanes&=~r;var c=31-Ht(r);a.entangledLanes|=r,a.entanglements[c]=a.entanglements[c]|1073741824|l&261930}function vl(a,r){var l=a.entangledLanes|=r;for(a=a.entanglements;l;){var c=31-Ht(l),g=1<<c;g&r|a[c]&r&&(a[c]|=r),l&=~g}}function xl(a,r){var l=r&-r;return l=(l&42)!==0?1:Gi(l),(l&(a.suspendedLanes|r))!==0?0:l}function Gi(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function Cr(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function fe(){var a=R.p;return a!==0?a:(a=window.event,a===void 0?32:bv(a.type))}function De(a,r){var l=R.p;try{return R.p=a,r()}finally{R.p=l}}var Et=Math.random().toString(36).slice(2),mt="__reactFiber$"+Et,Vt="__reactProps$"+Et,Se="__reactContainer$"+Et,Qs="__reactEvents$"+Et,nt="__reactListeners$"+Et,Xn="__reactHandles$"+Et,ja="__reactResources$"+Et,ea="__reactMarker$"+Et;function Ja(a){delete a[mt],delete a[Vt],delete a[Qs],delete a[nt],delete a[Xn]}function ta(a){var r=a[mt];if(r)return r;for(var l=a.parentNode;l;){if(r=l[Se]||l[mt]){if(l=r.alternate,r.child!==null||l!==null&&l.child!==null)for(a=ov(a);a!==null;){if(l=a[mt])return l;a=ov(a)}return r}a=l,l=a.parentNode}return null}function na(a){if(a=a[mt]||a[Se]){var r=a.tag;if(r===5||r===6||r===13||r===31||r===26||r===27||r===3)return a}return null}function sa(a){var r=a.tag;if(r===5||r===26||r===27||r===6)return a.stateNode;throw Error(s(33))}function aa(a){var r=a[ja];return r||(r=a[ja]={hoistableStyles:new Map,hoistableScripts:new Map}),r}function Pt(a){a[ea]=!0}var Sl=new Set,wl={};function Ct(a,r){Tr(a,r),Tr(a+"Capture",r)}function Tr(a,r){for(wl[a]=r,a=0;a<r.length;a++)Sl.add(r[a])}var yT=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Gh={},Hh={};function vT(a){return wt.call(Hh,a)?!0:wt.call(Gh,a)?!1:yT.test(a)?Hh[a]=!0:(Gh[a]=!0,!1)}function _l(a,r,l){if(vT(r))if(l===null)a.removeAttribute(r);else{switch(typeof l){case"undefined":case"function":case"symbol":a.removeAttribute(r);return;case"boolean":var c=r.toLowerCase().slice(0,5);if(c!=="data-"&&c!=="aria-"){a.removeAttribute(r);return}}a.setAttribute(r,""+l)}}function bl(a,r,l){if(l===null)a.removeAttribute(r);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(r);return}a.setAttribute(r,""+l)}}function ws(a,r,l,c){if(c===null)a.removeAttribute(l);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(l);return}a.setAttributeNS(r,l,""+c)}}function Pn(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function zh(a){var r=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function xT(a,r,l){var c=Object.getOwnPropertyDescriptor(a.constructor.prototype,r);if(!a.hasOwnProperty(r)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var g=c.get,y=c.set;return Object.defineProperty(a,r,{configurable:!0,get:function(){return g.call(this)},set:function(b){l=""+b,y.call(this,b)}}),Object.defineProperty(a,r,{enumerable:c.enumerable}),{getValue:function(){return l},setValue:function(b){l=""+b},stopTracking:function(){a._valueTracker=null,delete a[r]}}}}function Zc(a){if(!a._valueTracker){var r=zh(a)?"checked":"value";a._valueTracker=xT(a,r,""+a[r])}}function jh(a){if(!a)return!1;var r=a._valueTracker;if(!r)return!0;var l=r.getValue(),c="";return a&&(c=zh(a)?a.checked?"true":"false":a.value),a=c,a!==l?(r.setValue(a),!0):!1}function Cl(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var ST=/[\n"\\]/g;function kn(a){return a.replace(ST,function(r){return"\\"+r.charCodeAt(0).toString(16)+" "})}function Xc(a,r,l,c,g,y,b,A){a.name="",b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"?a.type=b:a.removeAttribute("type"),r!=null?b==="number"?(r===0&&a.value===""||a.value!=r)&&(a.value=""+Pn(r)):a.value!==""+Pn(r)&&(a.value=""+Pn(r)):b!=="submit"&&b!=="reset"||a.removeAttribute("value"),r!=null?Wc(a,b,Pn(r)):l!=null?Wc(a,b,Pn(l)):c!=null&&a.removeAttribute("value"),g==null&&y!=null&&(a.defaultChecked=!!y),g!=null&&(a.checked=g&&typeof g!="function"&&typeof g!="symbol"),A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"?a.name=""+Pn(A):a.removeAttribute("name")}function Jh(a,r,l,c,g,y,b,A){if(y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(a.type=y),r!=null||l!=null){if(!(y!=="submit"&&y!=="reset"||r!=null)){Zc(a);return}l=l!=null?""+Pn(l):"",r=r!=null?""+Pn(r):l,A||r===a.value||(a.value=r),a.defaultValue=r}c=c??g,c=typeof c!="function"&&typeof c!="symbol"&&!!c,a.checked=A?a.checked:!!c,a.defaultChecked=!!c,b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(a.name=b),Zc(a)}function Wc(a,r,l){r==="number"&&Cl(a.ownerDocument)===a||a.defaultValue===""+l||(a.defaultValue=""+l)}function Ar(a,r,l,c){if(a=a.options,r){r={};for(var g=0;g<l.length;g++)r["$"+l[g]]=!0;for(l=0;l<a.length;l++)g=r.hasOwnProperty("$"+a[l].value),a[l].selected!==g&&(a[l].selected=g),g&&c&&(a[l].defaultSelected=!0)}else{for(l=""+Pn(l),r=null,g=0;g<a.length;g++){if(a[g].value===l){a[g].selected=!0,c&&(a[g].defaultSelected=!0);return}r!==null||a[g].disabled||(r=a[g])}r!==null&&(r.selected=!0)}}function Yh(a,r,l){if(r!=null&&(r=""+Pn(r),r!==a.value&&(a.value=r),l==null)){a.defaultValue!==r&&(a.defaultValue=r);return}a.defaultValue=l!=null?""+Pn(l):""}function Kh(a,r,l,c){if(r==null){if(c!=null){if(l!=null)throw Error(s(92));if(D(c)){if(1<c.length)throw Error(s(93));c=c[0]}l=c}l==null&&(l=""),r=l}l=Pn(r),a.defaultValue=l,c=a.textContent,c===l&&c!==""&&c!==null&&(a.value=c),Zc(a)}function Er(a,r){if(r){var l=a.firstChild;if(l&&l===a.lastChild&&l.nodeType===3){l.nodeValue=r;return}}a.textContent=r}var wT=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Zh(a,r,l){var c=r.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?c?a.setProperty(r,""):r==="float"?a.cssFloat="":a[r]="":c?a.setProperty(r,l):typeof l!="number"||l===0||wT.has(r)?r==="float"?a.cssFloat=l:a[r]=(""+l).trim():a[r]=l+"px"}function Xh(a,r,l){if(r!=null&&typeof r!="object")throw Error(s(62));if(a=a.style,l!=null){for(var c in l)!l.hasOwnProperty(c)||r!=null&&r.hasOwnProperty(c)||(c.indexOf("--")===0?a.setProperty(c,""):c==="float"?a.cssFloat="":a[c]="");for(var g in r)c=r[g],r.hasOwnProperty(g)&&l[g]!==c&&Zh(a,g,c)}else for(var y in r)r.hasOwnProperty(y)&&Zh(a,y,r[y])}function Qc(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _T=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),bT=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Tl(a){return bT.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}function _s(){}var ed=null;function td(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Rr=null,Nr=null;function Wh(a){var r=na(a);if(r&&(a=r.stateNode)){var l=a[Vt]||null;e:switch(a=r.stateNode,r.type){case"input":if(Xc(a,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),r=l.name,l.type==="radio"&&r!=null){for(l=a;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+kn(""+r)+'"][type="radio"]'),r=0;r<l.length;r++){var c=l[r];if(c!==a&&c.form===a.form){var g=c[Vt]||null;if(!g)throw Error(s(90));Xc(c,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name)}}for(r=0;r<l.length;r++)c=l[r],c.form===a.form&&jh(c)}break e;case"textarea":Yh(a,l.value,l.defaultValue);break e;case"select":r=l.value,r!=null&&Ar(a,!!l.multiple,r,!1)}}}var nd=!1;function Qh(a,r,l){if(nd)return a(r,l);nd=!0;try{var c=a(r);return c}finally{if(nd=!1,(Rr!==null||Nr!==null)&&(fu(),Rr&&(r=Rr,a=Nr,Nr=Rr=null,Wh(r),a)))for(r=0;r<a.length;r++)Wh(a[r])}}function Hi(a,r){var l=a.stateNode;if(l===null)return null;var c=l[Vt]||null;if(c===null)return null;l=c[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(a=a.type,c=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!c;break e;default:a=!1}if(a)return null;if(l&&typeof l!="function")throw Error(s(231,r,typeof l));return l}var bs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),sd=!1;if(bs)try{var zi={};Object.defineProperty(zi,"passive",{get:function(){sd=!0}}),window.addEventListener("test",zi,zi),window.removeEventListener("test",zi,zi)}catch{sd=!1}var ra=null,ad=null,Al=null;function eg(){if(Al)return Al;var a,r=ad,l=r.length,c,g="value"in ra?ra.value:ra.textContent,y=g.length;for(a=0;a<l&&r[a]===g[a];a++);var b=l-a;for(c=1;c<=b&&r[l-c]===g[y-c];c++);return Al=g.slice(a,1<c?1-c:void 0)}function El(a){var r=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&r===13&&(a=13)):a=r,a===10&&(a=13),32<=a||a===13?a:0}function Rl(){return!0}function tg(){return!1}function cn(a){function r(l,c,g,y,b){this._reactName=l,this._targetInst=g,this.type=c,this.nativeEvent=y,this.target=b,this.currentTarget=null;for(var A in a)a.hasOwnProperty(A)&&(l=a[A],this[A]=l?l(y):y[A]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?Rl:tg,this.isPropagationStopped=tg,this}return S(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=Rl)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=Rl)},persist:function(){},isPersistent:Rl}),r}var Ya={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Nl=cn(Ya),ji=S({},Ya,{view:0,detail:0}),CT=cn(ji),rd,id,Ji,Ml=S({},ji,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ld,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Ji&&(Ji&&a.type==="mousemove"?(rd=a.screenX-Ji.screenX,id=a.screenY-Ji.screenY):id=rd=0,Ji=a),rd)},movementY:function(a){return"movementY"in a?a.movementY:id}}),ng=cn(Ml),TT=S({},Ml,{dataTransfer:0}),AT=cn(TT),ET=S({},ji,{relatedTarget:0}),od=cn(ET),RT=S({},Ya,{animationName:0,elapsedTime:0,pseudoElement:0}),NT=cn(RT),MT=S({},Ya,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),IT=cn(MT),DT=S({},Ya,{data:0}),sg=cn(DT),PT={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},kT={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},LT={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function UT(a){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(a):(a=LT[a])?!!r[a]:!1}function ld(){return UT}var OT=S({},ji,{key:function(a){if(a.key){var r=PT[a.key]||a.key;if(r!=="Unidentified")return r}return a.type==="keypress"?(a=El(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?kT[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ld,charCode:function(a){return a.type==="keypress"?El(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?El(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),BT=cn(OT),VT=S({},Ml,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ag=cn(VT),qT=S({},ji,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ld}),FT=cn(qT),$T=S({},Ya,{propertyName:0,elapsedTime:0,pseudoElement:0}),GT=cn($T),HT=S({},Ml,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),zT=cn(HT),jT=S({},Ya,{newState:0,oldState:0}),JT=cn(jT),YT=[9,13,27,32],ud=bs&&"CompositionEvent"in window,Yi=null;bs&&"documentMode"in document&&(Yi=document.documentMode);var KT=bs&&"TextEvent"in window&&!Yi,rg=bs&&(!ud||Yi&&8<Yi&&11>=Yi),ig=" ",og=!1;function lg(a,r){switch(a){case"keyup":return YT.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ug(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var Mr=!1;function ZT(a,r){switch(a){case"compositionend":return ug(r);case"keypress":return r.which!==32?null:(og=!0,ig);case"textInput":return a=r.data,a===ig&&og?null:a;default:return null}}function XT(a,r){if(Mr)return a==="compositionend"||!ud&&lg(a,r)?(a=eg(),Al=ad=ra=null,Mr=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return rg&&r.locale!=="ko"?null:r.data;default:return null}}var WT={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function cg(a){var r=a&&a.nodeName&&a.nodeName.toLowerCase();return r==="input"?!!WT[a.type]:r==="textarea"}function dg(a,r,l,c){Rr?Nr?Nr.push(c):Nr=[c]:Rr=c,r=xu(r,"onChange"),0<r.length&&(l=new Nl("onChange","change",null,l,c),a.push({event:l,listeners:r}))}var Ki=null,Zi=null;function QT(a){J0(a,0)}function Il(a){var r=sa(a);if(jh(r))return a}function fg(a,r){if(a==="change")return r}var mg=!1;if(bs){var cd;if(bs){var dd="oninput"in document;if(!dd){var pg=document.createElement("div");pg.setAttribute("oninput","return;"),dd=typeof pg.oninput=="function"}cd=dd}else cd=!1;mg=cd&&(!document.documentMode||9<document.documentMode)}function hg(){Ki&&(Ki.detachEvent("onpropertychange",gg),Zi=Ki=null)}function gg(a){if(a.propertyName==="value"&&Il(Zi)){var r=[];dg(r,Zi,a,td(a)),Qh(QT,r)}}function eA(a,r,l){a==="focusin"?(hg(),Ki=r,Zi=l,Ki.attachEvent("onpropertychange",gg)):a==="focusout"&&hg()}function tA(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Il(Zi)}function nA(a,r){if(a==="click")return Il(r)}function sA(a,r){if(a==="input"||a==="change")return Il(r)}function aA(a,r){return a===r&&(a!==0||1/a===1/r)||a!==a&&r!==r}var xn=typeof Object.is=="function"?Object.is:aA;function Xi(a,r){if(xn(a,r))return!0;if(typeof a!="object"||a===null||typeof r!="object"||r===null)return!1;var l=Object.keys(a),c=Object.keys(r);if(l.length!==c.length)return!1;for(c=0;c<l.length;c++){var g=l[c];if(!wt.call(r,g)||!xn(a[g],r[g]))return!1}return!0}function yg(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function vg(a,r){var l=yg(a);a=0;for(var c;l;){if(l.nodeType===3){if(c=a+l.textContent.length,a<=r&&c>=r)return{node:l,offset:r-a};a=c}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=yg(l)}}function xg(a,r){return a&&r?a===r?!0:a&&a.nodeType===3?!1:r&&r.nodeType===3?xg(a,r.parentNode):"contains"in a?a.contains(r):a.compareDocumentPosition?!!(a.compareDocumentPosition(r)&16):!1:!1}function Sg(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var r=Cl(a.document);r instanceof a.HTMLIFrameElement;){try{var l=typeof r.contentWindow.location.href=="string"}catch{l=!1}if(l)a=r.contentWindow;else break;r=Cl(a.document)}return r}function fd(a){var r=a&&a.nodeName&&a.nodeName.toLowerCase();return r&&(r==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||r==="textarea"||a.contentEditable==="true")}var rA=bs&&"documentMode"in document&&11>=document.documentMode,Ir=null,md=null,Wi=null,pd=!1;function wg(a,r,l){var c=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;pd||Ir==null||Ir!==Cl(c)||(c=Ir,"selectionStart"in c&&fd(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),Wi&&Xi(Wi,c)||(Wi=c,c=xu(md,"onSelect"),0<c.length&&(r=new Nl("onSelect","select",null,r,l),a.push({event:r,listeners:c}),r.target=Ir)))}function Ka(a,r){var l={};return l[a.toLowerCase()]=r.toLowerCase(),l["Webkit"+a]="webkit"+r,l["Moz"+a]="moz"+r,l}var Dr={animationend:Ka("Animation","AnimationEnd"),animationiteration:Ka("Animation","AnimationIteration"),animationstart:Ka("Animation","AnimationStart"),transitionrun:Ka("Transition","TransitionRun"),transitionstart:Ka("Transition","TransitionStart"),transitioncancel:Ka("Transition","TransitionCancel"),transitionend:Ka("Transition","TransitionEnd")},hd={},_g={};bs&&(_g=document.createElement("div").style,"AnimationEvent"in window||(delete Dr.animationend.animation,delete Dr.animationiteration.animation,delete Dr.animationstart.animation),"TransitionEvent"in window||delete Dr.transitionend.transition);function Za(a){if(hd[a])return hd[a];if(!Dr[a])return a;var r=Dr[a],l;for(l in r)if(r.hasOwnProperty(l)&&l in _g)return hd[a]=r[l];return a}var bg=Za("animationend"),Cg=Za("animationiteration"),Tg=Za("animationstart"),iA=Za("transitionrun"),oA=Za("transitionstart"),lA=Za("transitioncancel"),Ag=Za("transitionend"),Eg=new Map,gd="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");gd.push("scrollEnd");function Wn(a,r){Eg.set(a,r),Ct(r,[a])}var Dl=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var r=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(r))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)},Ln=[],Pr=0,yd=0;function Pl(){for(var a=Pr,r=yd=Pr=0;r<a;){var l=Ln[r];Ln[r++]=null;var c=Ln[r];Ln[r++]=null;var g=Ln[r];Ln[r++]=null;var y=Ln[r];if(Ln[r++]=null,c!==null&&g!==null){var b=c.pending;b===null?g.next=g:(g.next=b.next,b.next=g),c.pending=g}y!==0&&Rg(l,g,y)}}function kl(a,r,l,c){Ln[Pr++]=a,Ln[Pr++]=r,Ln[Pr++]=l,Ln[Pr++]=c,yd|=c,a.lanes|=c,a=a.alternate,a!==null&&(a.lanes|=c)}function vd(a,r,l,c){return kl(a,r,l,c),Ll(a)}function Xa(a,r){return kl(a,null,null,r),Ll(a)}function Rg(a,r,l){a.lanes|=l;var c=a.alternate;c!==null&&(c.lanes|=l);for(var g=!1,y=a.return;y!==null;)y.childLanes|=l,c=y.alternate,c!==null&&(c.childLanes|=l),y.tag===22&&(a=y.stateNode,a===null||a._visibility&1||(g=!0)),a=y,y=y.return;return a.tag===3?(y=a.stateNode,g&&r!==null&&(g=31-Ht(l),a=y.hiddenUpdates,c=a[g],c===null?a[g]=[r]:c.push(r),r.lane=l|536870912),y):null}function Ll(a){if(50<wo)throw wo=0,Rf=null,Error(s(185));for(var r=a.return;r!==null;)a=r,r=a.return;return a.tag===3?a.stateNode:null}var kr={};function uA(a,r,l,c){this.tag=a,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Sn(a,r,l,c){return new uA(a,r,l,c)}function xd(a){return a=a.prototype,!(!a||!a.isReactComponent)}function Cs(a,r){var l=a.alternate;return l===null?(l=Sn(a.tag,r,a.key,a.mode),l.elementType=a.elementType,l.type=a.type,l.stateNode=a.stateNode,l.alternate=a,a.alternate=l):(l.pendingProps=r,l.type=a.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=a.flags&65011712,l.childLanes=a.childLanes,l.lanes=a.lanes,l.child=a.child,l.memoizedProps=a.memoizedProps,l.memoizedState=a.memoizedState,l.updateQueue=a.updateQueue,r=a.dependencies,l.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},l.sibling=a.sibling,l.index=a.index,l.ref=a.ref,l.refCleanup=a.refCleanup,l}function Ng(a,r){a.flags&=65011714;var l=a.alternate;return l===null?(a.childLanes=0,a.lanes=r,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=l.childLanes,a.lanes=l.lanes,a.child=l.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=l.memoizedProps,a.memoizedState=l.memoizedState,a.updateQueue=l.updateQueue,a.type=l.type,r=l.dependencies,a.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),a}function Ul(a,r,l,c,g,y){var b=0;if(c=a,typeof a=="function")xd(a)&&(b=1);else if(typeof a=="string")b=pE(a,l,re.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case X:return a=Sn(31,l,r,g),a.elementType=X,a.lanes=y,a;case I:return Wa(l.children,g,y,r);case k:b=8,g|=24;break;case F:return a=Sn(12,l,r,g|2),a.elementType=F,a.lanes=y,a;case ae:return a=Sn(13,l,r,g),a.elementType=ae,a.lanes=y,a;case Q:return a=Sn(19,l,r,g),a.elementType=Q,a.lanes=y,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case G:b=10;break e;case V:b=9;break e;case z:b=11;break e;case J:b=14;break e;case j:b=16,c=null;break e}b=29,l=Error(s(130,a===null?"null":typeof a,"")),c=null}return r=Sn(b,l,r,g),r.elementType=a,r.type=c,r.lanes=y,r}function Wa(a,r,l,c){return a=Sn(7,a,c,r),a.lanes=l,a}function Sd(a,r,l){return a=Sn(6,a,null,r),a.lanes=l,a}function Mg(a){var r=Sn(18,null,null,0);return r.stateNode=a,r}function wd(a,r,l){return r=Sn(4,a.children!==null?a.children:[],a.key,r),r.lanes=l,r.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},r}var Ig=new WeakMap;function Un(a,r){if(typeof a=="object"&&a!==null){var l=Ig.get(a);return l!==void 0?l:(r={value:a,source:r,stack:ye(r)},Ig.set(a,r),r)}return{value:a,source:r,stack:ye(r)}}var Lr=[],Ur=0,Ol=null,Qi=0,On=[],Bn=0,ia=null,is=1,os="";function Ts(a,r){Lr[Ur++]=Qi,Lr[Ur++]=Ol,Ol=a,Qi=r}function Dg(a,r,l){On[Bn++]=is,On[Bn++]=os,On[Bn++]=ia,ia=a;var c=is;a=os;var g=32-Ht(c)-1;c&=~(1<<g),l+=1;var y=32-Ht(r)+g;if(30<y){var b=g-g%5;y=(c&(1<<b)-1).toString(32),c>>=b,g-=b,is=1<<32-Ht(r)+g|l<<g|c,os=y+a}else is=1<<y|l<<g|c,os=a}function _d(a){a.return!==null&&(Ts(a,1),Dg(a,1,0))}function bd(a){for(;a===Ol;)Ol=Lr[--Ur],Lr[Ur]=null,Qi=Lr[--Ur],Lr[Ur]=null;for(;a===ia;)ia=On[--Bn],On[Bn]=null,os=On[--Bn],On[Bn]=null,is=On[--Bn],On[Bn]=null}function Pg(a,r){On[Bn++]=is,On[Bn++]=os,On[Bn++]=ia,is=r.id,os=r.overflow,ia=a}var Yt=null,pt=null,Je=!1,oa=null,Vn=!1,Cd=Error(s(519));function la(a){var r=Error(s(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw eo(Un(r,a)),Cd}function kg(a){var r=a.stateNode,l=a.type,c=a.memoizedProps;switch(r[mt]=a,r[Vt]=c,l){case"dialog":He("cancel",r),He("close",r);break;case"iframe":case"object":case"embed":He("load",r);break;case"video":case"audio":for(l=0;l<bo.length;l++)He(bo[l],r);break;case"source":He("error",r);break;case"img":case"image":case"link":He("error",r),He("load",r);break;case"details":He("toggle",r);break;case"input":He("invalid",r),Jh(r,c.value,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name,!0);break;case"select":He("invalid",r);break;case"textarea":He("invalid",r),Kh(r,c.value,c.defaultValue,c.children)}l=c.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||r.textContent===""+l||c.suppressHydrationWarning===!0||X0(r.textContent,l)?(c.popover!=null&&(He("beforetoggle",r),He("toggle",r)),c.onScroll!=null&&He("scroll",r),c.onScrollEnd!=null&&He("scrollend",r),c.onClick!=null&&(r.onclick=_s),r=!0):r=!1,r||la(a,!0)}function Lg(a){for(Yt=a.return;Yt;)switch(Yt.tag){case 5:case 31:case 13:Vn=!1;return;case 27:case 3:Vn=!0;return;default:Yt=Yt.return}}function Or(a){if(a!==Yt)return!1;if(!Je)return Lg(a),Je=!0,!1;var r=a.tag,l;if((l=r!==3&&r!==27)&&((l=r===5)&&(l=a.type,l=!(l!=="form"&&l!=="button")||Gf(a.type,a.memoizedProps)),l=!l),l&&pt&&la(a),Lg(a),r===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(317));pt=iv(a)}else if(r===31){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(317));pt=iv(a)}else r===27?(r=pt,_a(a.type)?(a=Yf,Yf=null,pt=a):pt=r):pt=Yt?Fn(a.stateNode.nextSibling):null;return!0}function Qa(){pt=Yt=null,Je=!1}function Td(){var a=oa;return a!==null&&(pn===null?pn=a:pn.push.apply(pn,a),oa=null),a}function eo(a){oa===null?oa=[a]:oa.push(a)}var Ad=N(null),er=null,As=null;function ua(a,r,l){te(Ad,r._currentValue),r._currentValue=l}function Es(a){a._currentValue=Ad.current,q(Ad)}function Ed(a,r,l){for(;a!==null;){var c=a.alternate;if((a.childLanes&r)!==r?(a.childLanes|=r,c!==null&&(c.childLanes|=r)):c!==null&&(c.childLanes&r)!==r&&(c.childLanes|=r),a===l)break;a=a.return}}function Rd(a,r,l,c){var g=a.child;for(g!==null&&(g.return=a);g!==null;){var y=g.dependencies;if(y!==null){var b=g.child;y=y.firstContext;e:for(;y!==null;){var A=y;y=g;for(var U=0;U<r.length;U++)if(A.context===r[U]){y.lanes|=l,A=y.alternate,A!==null&&(A.lanes|=l),Ed(y.return,l,a),c||(b=null);break e}y=A.next}}else if(g.tag===18){if(b=g.return,b===null)throw Error(s(341));b.lanes|=l,y=b.alternate,y!==null&&(y.lanes|=l),Ed(b,l,a),b=null}else b=g.child;if(b!==null)b.return=g;else for(b=g;b!==null;){if(b===a){b=null;break}if(g=b.sibling,g!==null){g.return=b.return,b=g;break}b=b.return}g=b}}function Br(a,r,l,c){a=null;for(var g=r,y=!1;g!==null;){if(!y){if((g.flags&524288)!==0)y=!0;else if((g.flags&262144)!==0)break}if(g.tag===10){var b=g.alternate;if(b===null)throw Error(s(387));if(b=b.memoizedProps,b!==null){var A=g.type;xn(g.pendingProps.value,b.value)||(a!==null?a.push(A):a=[A])}}else if(g===pe.current){if(b=g.alternate,b===null)throw Error(s(387));b.memoizedState.memoizedState!==g.memoizedState.memoizedState&&(a!==null?a.push(Ro):a=[Ro])}g=g.return}a!==null&&Rd(r,a,l,c),r.flags|=262144}function Bl(a){for(a=a.firstContext;a!==null;){if(!xn(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function tr(a){er=a,As=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function Kt(a){return Ug(er,a)}function Vl(a,r){return er===null&&tr(a),Ug(a,r)}function Ug(a,r){var l=r._currentValue;if(r={context:r,memoizedValue:l,next:null},As===null){if(a===null)throw Error(s(308));As=r,a.dependencies={lanes:0,firstContext:r},a.flags|=524288}else As=As.next=r;return l}var cA=typeof AbortController<"u"?AbortController:function(){var a=[],r=this.signal={aborted:!1,addEventListener:function(l,c){a.push(c)}};this.abort=function(){r.aborted=!0,a.forEach(function(l){return l()})}},dA=t.unstable_scheduleCallback,fA=t.unstable_NormalPriority,kt={$$typeof:G,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Nd(){return{controller:new cA,data:new Map,refCount:0}}function to(a){a.refCount--,a.refCount===0&&dA(fA,function(){a.controller.abort()})}var no=null,Md=0,Vr=0,qr=null;function mA(a,r){if(no===null){var l=no=[];Md=0,Vr=kf(),qr={status:"pending",value:void 0,then:function(c){l.push(c)}}}return Md++,r.then(Og,Og),r}function Og(){if(--Md===0&&no!==null){qr!==null&&(qr.status="fulfilled");var a=no;no=null,Vr=0,qr=null;for(var r=0;r<a.length;r++)(0,a[r])()}}function pA(a,r){var l=[],c={status:"pending",value:null,reason:null,then:function(g){l.push(g)}};return a.then(function(){c.status="fulfilled",c.value=r;for(var g=0;g<l.length;g++)(0,l[g])(r)},function(g){for(c.status="rejected",c.reason=g,g=0;g<l.length;g++)(0,l[g])(void 0)}),c}var Bg=T.S;T.S=function(a,r){w0=_t(),typeof r=="object"&&r!==null&&typeof r.then=="function"&&mA(a,r),Bg!==null&&Bg(a,r)};var nr=N(null);function Id(){var a=nr.current;return a!==null?a:ct.pooledCache}function ql(a,r){r===null?te(nr,nr.current):te(nr,r.pool)}function Vg(){var a=Id();return a===null?null:{parent:kt._currentValue,pool:a}}var Fr=Error(s(460)),Dd=Error(s(474)),Fl=Error(s(542)),$l={then:function(){}};function qg(a){return a=a.status,a==="fulfilled"||a==="rejected"}function Fg(a,r,l){switch(l=a[l],l===void 0?a.push(r):l!==r&&(r.then(_s,_s),r=l),r.status){case"fulfilled":return r.value;case"rejected":throw a=r.reason,Gg(a),a;default:if(typeof r.status=="string")r.then(_s,_s);else{if(a=ct,a!==null&&100<a.shellSuspendCounter)throw Error(s(482));a=r,a.status="pending",a.then(function(c){if(r.status==="pending"){var g=r;g.status="fulfilled",g.value=c}},function(c){if(r.status==="pending"){var g=r;g.status="rejected",g.reason=c}})}switch(r.status){case"fulfilled":return r.value;case"rejected":throw a=r.reason,Gg(a),a}throw ar=r,Fr}}function sr(a){try{var r=a._init;return r(a._payload)}catch(l){throw l!==null&&typeof l=="object"&&typeof l.then=="function"?(ar=l,Fr):l}}var ar=null;function $g(){if(ar===null)throw Error(s(459));var a=ar;return ar=null,a}function Gg(a){if(a===Fr||a===Fl)throw Error(s(483))}var $r=null,so=0;function Gl(a){var r=so;return so+=1,$r===null&&($r=[]),Fg($r,a,r)}function ao(a,r){r=r.props.ref,a.ref=r!==void 0?r:null}function Hl(a,r){throw r.$$typeof===w?Error(s(525)):(a=Object.prototype.toString.call(r),Error(s(31,a==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":a)))}function Hg(a){function r($,O){if(a){var Y=$.deletions;Y===null?($.deletions=[O],$.flags|=16):Y.push(O)}}function l($,O){if(!a)return null;for(;O!==null;)r($,O),O=O.sibling;return null}function c($){for(var O=new Map;$!==null;)$.key!==null?O.set($.key,$):O.set($.index,$),$=$.sibling;return O}function g($,O){return $=Cs($,O),$.index=0,$.sibling=null,$}function y($,O,Y){return $.index=Y,a?(Y=$.alternate,Y!==null?(Y=Y.index,Y<O?($.flags|=67108866,O):Y):($.flags|=67108866,O)):($.flags|=1048576,O)}function b($){return a&&$.alternate===null&&($.flags|=67108866),$}function A($,O,Y,ie){return O===null||O.tag!==6?(O=Sd(Y,$.mode,ie),O.return=$,O):(O=g(O,Y),O.return=$,O)}function U($,O,Y,ie){var Te=Y.type;return Te===I?se($,O,Y.props.children,ie,Y.key):O!==null&&(O.elementType===Te||typeof Te=="object"&&Te!==null&&Te.$$typeof===j&&sr(Te)===O.type)?(O=g(O,Y.props),ao(O,Y),O.return=$,O):(O=Ul(Y.type,Y.key,Y.props,null,$.mode,ie),ao(O,Y),O.return=$,O)}function K($,O,Y,ie){return O===null||O.tag!==4||O.stateNode.containerInfo!==Y.containerInfo||O.stateNode.implementation!==Y.implementation?(O=wd(Y,$.mode,ie),O.return=$,O):(O=g(O,Y.children||[]),O.return=$,O)}function se($,O,Y,ie,Te){return O===null||O.tag!==7?(O=Wa(Y,$.mode,ie,Te),O.return=$,O):(O=g(O,Y),O.return=$,O)}function oe($,O,Y){if(typeof O=="string"&&O!==""||typeof O=="number"||typeof O=="bigint")return O=Sd(""+O,$.mode,Y),O.return=$,O;if(typeof O=="object"&&O!==null){switch(O.$$typeof){case C:return Y=Ul(O.type,O.key,O.props,null,$.mode,Y),ao(Y,O),Y.return=$,Y;case M:return O=wd(O,$.mode,Y),O.return=$,O;case j:return O=sr(O),oe($,O,Y)}if(D(O)||_(O))return O=Wa(O,$.mode,Y,null),O.return=$,O;if(typeof O.then=="function")return oe($,Gl(O),Y);if(O.$$typeof===G)return oe($,Vl($,O),Y);Hl($,O)}return null}function W($,O,Y,ie){var Te=O!==null?O.key:null;if(typeof Y=="string"&&Y!==""||typeof Y=="number"||typeof Y=="bigint")return Te!==null?null:A($,O,""+Y,ie);if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case C:return Y.key===Te?U($,O,Y,ie):null;case M:return Y.key===Te?K($,O,Y,ie):null;case j:return Y=sr(Y),W($,O,Y,ie)}if(D(Y)||_(Y))return Te!==null?null:se($,O,Y,ie,null);if(typeof Y.then=="function")return W($,O,Gl(Y),ie);if(Y.$$typeof===G)return W($,O,Vl($,Y),ie);Hl($,Y)}return null}function ee($,O,Y,ie,Te){if(typeof ie=="string"&&ie!==""||typeof ie=="number"||typeof ie=="bigint")return $=$.get(Y)||null,A(O,$,""+ie,Te);if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case C:return $=$.get(ie.key===null?Y:ie.key)||null,U(O,$,ie,Te);case M:return $=$.get(ie.key===null?Y:ie.key)||null,K(O,$,ie,Te);case j:return ie=sr(ie),ee($,O,Y,ie,Te)}if(D(ie)||_(ie))return $=$.get(Y)||null,se(O,$,ie,Te,null);if(typeof ie.then=="function")return ee($,O,Y,Gl(ie),Te);if(ie.$$typeof===G)return ee($,O,Y,Vl(O,ie),Te);Hl(O,ie)}return null}function xe($,O,Y,ie){for(var Te=null,Ze=null,_e=O,Ve=O=0,je=null;_e!==null&&Ve<Y.length;Ve++){_e.index>Ve?(je=_e,_e=null):je=_e.sibling;var Xe=W($,_e,Y[Ve],ie);if(Xe===null){_e===null&&(_e=je);break}a&&_e&&Xe.alternate===null&&r($,_e),O=y(Xe,O,Ve),Ze===null?Te=Xe:Ze.sibling=Xe,Ze=Xe,_e=je}if(Ve===Y.length)return l($,_e),Je&&Ts($,Ve),Te;if(_e===null){for(;Ve<Y.length;Ve++)_e=oe($,Y[Ve],ie),_e!==null&&(O=y(_e,O,Ve),Ze===null?Te=_e:Ze.sibling=_e,Ze=_e);return Je&&Ts($,Ve),Te}for(_e=c(_e);Ve<Y.length;Ve++)je=ee(_e,$,Ve,Y[Ve],ie),je!==null&&(a&&je.alternate!==null&&_e.delete(je.key===null?Ve:je.key),O=y(je,O,Ve),Ze===null?Te=je:Ze.sibling=je,Ze=je);return a&&_e.forEach(function(Ea){return r($,Ea)}),Je&&Ts($,Ve),Te}function Ee($,O,Y,ie){if(Y==null)throw Error(s(151));for(var Te=null,Ze=null,_e=O,Ve=O=0,je=null,Xe=Y.next();_e!==null&&!Xe.done;Ve++,Xe=Y.next()){_e.index>Ve?(je=_e,_e=null):je=_e.sibling;var Ea=W($,_e,Xe.value,ie);if(Ea===null){_e===null&&(_e=je);break}a&&_e&&Ea.alternate===null&&r($,_e),O=y(Ea,O,Ve),Ze===null?Te=Ea:Ze.sibling=Ea,Ze=Ea,_e=je}if(Xe.done)return l($,_e),Je&&Ts($,Ve),Te;if(_e===null){for(;!Xe.done;Ve++,Xe=Y.next())Xe=oe($,Xe.value,ie),Xe!==null&&(O=y(Xe,O,Ve),Ze===null?Te=Xe:Ze.sibling=Xe,Ze=Xe);return Je&&Ts($,Ve),Te}for(_e=c(_e);!Xe.done;Ve++,Xe=Y.next())Xe=ee(_e,$,Ve,Xe.value,ie),Xe!==null&&(a&&Xe.alternate!==null&&_e.delete(Xe.key===null?Ve:Xe.key),O=y(Xe,O,Ve),Ze===null?Te=Xe:Ze.sibling=Xe,Ze=Xe);return a&&_e.forEach(function(TE){return r($,TE)}),Je&&Ts($,Ve),Te}function ot($,O,Y,ie){if(typeof Y=="object"&&Y!==null&&Y.type===I&&Y.key===null&&(Y=Y.props.children),typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case C:e:{for(var Te=Y.key;O!==null;){if(O.key===Te){if(Te=Y.type,Te===I){if(O.tag===7){l($,O.sibling),ie=g(O,Y.props.children),ie.return=$,$=ie;break e}}else if(O.elementType===Te||typeof Te=="object"&&Te!==null&&Te.$$typeof===j&&sr(Te)===O.type){l($,O.sibling),ie=g(O,Y.props),ao(ie,Y),ie.return=$,$=ie;break e}l($,O);break}else r($,O);O=O.sibling}Y.type===I?(ie=Wa(Y.props.children,$.mode,ie,Y.key),ie.return=$,$=ie):(ie=Ul(Y.type,Y.key,Y.props,null,$.mode,ie),ao(ie,Y),ie.return=$,$=ie)}return b($);case M:e:{for(Te=Y.key;O!==null;){if(O.key===Te)if(O.tag===4&&O.stateNode.containerInfo===Y.containerInfo&&O.stateNode.implementation===Y.implementation){l($,O.sibling),ie=g(O,Y.children||[]),ie.return=$,$=ie;break e}else{l($,O);break}else r($,O);O=O.sibling}ie=wd(Y,$.mode,ie),ie.return=$,$=ie}return b($);case j:return Y=sr(Y),ot($,O,Y,ie)}if(D(Y))return xe($,O,Y,ie);if(_(Y)){if(Te=_(Y),typeof Te!="function")throw Error(s(150));return Y=Te.call(Y),Ee($,O,Y,ie)}if(typeof Y.then=="function")return ot($,O,Gl(Y),ie);if(Y.$$typeof===G)return ot($,O,Vl($,Y),ie);Hl($,Y)}return typeof Y=="string"&&Y!==""||typeof Y=="number"||typeof Y=="bigint"?(Y=""+Y,O!==null&&O.tag===6?(l($,O.sibling),ie=g(O,Y),ie.return=$,$=ie):(l($,O),ie=Sd(Y,$.mode,ie),ie.return=$,$=ie),b($)):l($,O)}return function($,O,Y,ie){try{so=0;var Te=ot($,O,Y,ie);return $r=null,Te}catch(_e){if(_e===Fr||_e===Fl)throw _e;var Ze=Sn(29,_e,null,$.mode);return Ze.lanes=ie,Ze.return=$,Ze}finally{}}}var rr=Hg(!0),zg=Hg(!1),ca=!1;function Pd(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function kd(a,r){a=a.updateQueue,r.updateQueue===a&&(r.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function da(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function fa(a,r,l){var c=a.updateQueue;if(c===null)return null;if(c=c.shared,(tt&2)!==0){var g=c.pending;return g===null?r.next=r:(r.next=g.next,g.next=r),c.pending=r,r=Ll(a),Rg(a,null,l),r}return kl(a,c,r,l),Ll(a)}function ro(a,r,l){if(r=r.updateQueue,r!==null&&(r=r.shared,(l&4194048)!==0)){var c=r.lanes;c&=a.pendingLanes,l|=c,r.lanes=l,vl(a,l)}}function Ld(a,r){var l=a.updateQueue,c=a.alternate;if(c!==null&&(c=c.updateQueue,l===c)){var g=null,y=null;if(l=l.firstBaseUpdate,l!==null){do{var b={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};y===null?g=y=b:y=y.next=b,l=l.next}while(l!==null);y===null?g=y=r:y=y.next=r}else g=y=r;l={baseState:c.baseState,firstBaseUpdate:g,lastBaseUpdate:y,shared:c.shared,callbacks:c.callbacks},a.updateQueue=l;return}a=l.lastBaseUpdate,a===null?l.firstBaseUpdate=r:a.next=r,l.lastBaseUpdate=r}var Ud=!1;function io(){if(Ud){var a=qr;if(a!==null)throw a}}function oo(a,r,l,c){Ud=!1;var g=a.updateQueue;ca=!1;var y=g.firstBaseUpdate,b=g.lastBaseUpdate,A=g.shared.pending;if(A!==null){g.shared.pending=null;var U=A,K=U.next;U.next=null,b===null?y=K:b.next=K,b=U;var se=a.alternate;se!==null&&(se=se.updateQueue,A=se.lastBaseUpdate,A!==b&&(A===null?se.firstBaseUpdate=K:A.next=K,se.lastBaseUpdate=U))}if(y!==null){var oe=g.baseState;b=0,se=K=U=null,A=y;do{var W=A.lane&-536870913,ee=W!==A.lane;if(ee?(ze&W)===W:(c&W)===W){W!==0&&W===Vr&&(Ud=!0),se!==null&&(se=se.next={lane:0,tag:A.tag,payload:A.payload,callback:null,next:null});e:{var xe=a,Ee=A;W=r;var ot=l;switch(Ee.tag){case 1:if(xe=Ee.payload,typeof xe=="function"){oe=xe.call(ot,oe,W);break e}oe=xe;break e;case 3:xe.flags=xe.flags&-65537|128;case 0:if(xe=Ee.payload,W=typeof xe=="function"?xe.call(ot,oe,W):xe,W==null)break e;oe=S({},oe,W);break e;case 2:ca=!0}}W=A.callback,W!==null&&(a.flags|=64,ee&&(a.flags|=8192),ee=g.callbacks,ee===null?g.callbacks=[W]:ee.push(W))}else ee={lane:W,tag:A.tag,payload:A.payload,callback:A.callback,next:null},se===null?(K=se=ee,U=oe):se=se.next=ee,b|=W;if(A=A.next,A===null){if(A=g.shared.pending,A===null)break;ee=A,A=ee.next,ee.next=null,g.lastBaseUpdate=ee,g.shared.pending=null}}while(!0);se===null&&(U=oe),g.baseState=U,g.firstBaseUpdate=K,g.lastBaseUpdate=se,y===null&&(g.shared.lanes=0),ya|=b,a.lanes=b,a.memoizedState=oe}}function jg(a,r){if(typeof a!="function")throw Error(s(191,a));a.call(r)}function Jg(a,r){var l=a.callbacks;if(l!==null)for(a.callbacks=null,a=0;a<l.length;a++)jg(l[a],r)}var Gr=N(null),zl=N(0);function Yg(a,r){a=Us,te(zl,a),te(Gr,r),Us=a|r.baseLanes}function Od(){te(zl,Us),te(Gr,Gr.current)}function Bd(){Us=zl.current,q(Gr),q(zl)}var wn=N(null),qn=null;function ma(a){var r=a.alternate;te(Rt,Rt.current&1),te(wn,a),qn===null&&(r===null||Gr.current!==null||r.memoizedState!==null)&&(qn=a)}function Vd(a){te(Rt,Rt.current),te(wn,a),qn===null&&(qn=a)}function Kg(a){a.tag===22?(te(Rt,Rt.current),te(wn,a),qn===null&&(qn=a)):pa()}function pa(){te(Rt,Rt.current),te(wn,wn.current)}function _n(a){q(wn),qn===a&&(qn=null),q(Rt)}var Rt=N(0);function jl(a){for(var r=a;r!==null;){if(r.tag===13){var l=r.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||jf(l)||Jf(l)))return r}else if(r.tag===19&&(r.memoizedProps.revealOrder==="forwards"||r.memoizedProps.revealOrder==="backwards"||r.memoizedProps.revealOrder==="unstable_legacy-backwards"||r.memoizedProps.revealOrder==="together")){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===a)break;for(;r.sibling===null;){if(r.return===null||r.return===a)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var Rs=0,Be=null,rt=null,Lt=null,Jl=!1,Hr=!1,ir=!1,Yl=0,lo=0,zr=null,hA=0;function Tt(){throw Error(s(321))}function qd(a,r){if(r===null)return!1;for(var l=0;l<r.length&&l<a.length;l++)if(!xn(a[l],r[l]))return!1;return!0}function Fd(a,r,l,c,g,y){return Rs=y,Be=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,T.H=a===null||a.memoizedState===null?Dy:nf,ir=!1,y=l(c,g),ir=!1,Hr&&(y=Xg(r,l,c,g)),Zg(a),y}function Zg(a){T.H=fo;var r=rt!==null&&rt.next!==null;if(Rs=0,Lt=rt=Be=null,Jl=!1,lo=0,zr=null,r)throw Error(s(300));a===null||Ut||(a=a.dependencies,a!==null&&Bl(a)&&(Ut=!0))}function Xg(a,r,l,c){Be=a;var g=0;do{if(Hr&&(zr=null),lo=0,Hr=!1,25<=g)throw Error(s(301));if(g+=1,Lt=rt=null,a.updateQueue!=null){var y=a.updateQueue;y.lastEffect=null,y.events=null,y.stores=null,y.memoCache!=null&&(y.memoCache.index=0)}T.H=Py,y=r(l,c)}while(Hr);return y}function gA(){var a=T.H,r=a.useState()[0];return r=typeof r.then=="function"?uo(r):r,a=a.useState()[0],(rt!==null?rt.memoizedState:null)!==a&&(Be.flags|=1024),r}function $d(){var a=Yl!==0;return Yl=0,a}function Gd(a,r,l){r.updateQueue=a.updateQueue,r.flags&=-2053,a.lanes&=~l}function Hd(a){if(Jl){for(a=a.memoizedState;a!==null;){var r=a.queue;r!==null&&(r.pending=null),a=a.next}Jl=!1}Rs=0,Lt=rt=Be=null,Hr=!1,lo=Yl=0,zr=null}function un(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Lt===null?Be.memoizedState=Lt=a:Lt=Lt.next=a,Lt}function Nt(){if(rt===null){var a=Be.alternate;a=a!==null?a.memoizedState:null}else a=rt.next;var r=Lt===null?Be.memoizedState:Lt.next;if(r!==null)Lt=r,rt=a;else{if(a===null)throw Be.alternate===null?Error(s(467)):Error(s(310));rt=a,a={memoizedState:rt.memoizedState,baseState:rt.baseState,baseQueue:rt.baseQueue,queue:rt.queue,next:null},Lt===null?Be.memoizedState=Lt=a:Lt=Lt.next=a}return Lt}function Kl(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function uo(a){var r=lo;return lo+=1,zr===null&&(zr=[]),a=Fg(zr,a,r),r=Be,(Lt===null?r.memoizedState:Lt.next)===null&&(r=r.alternate,T.H=r===null||r.memoizedState===null?Dy:nf),a}function Zl(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return uo(a);if(a.$$typeof===G)return Kt(a)}throw Error(s(438,String(a)))}function zd(a){var r=null,l=Be.updateQueue;if(l!==null&&(r=l.memoCache),r==null){var c=Be.alternate;c!==null&&(c=c.updateQueue,c!==null&&(c=c.memoCache,c!=null&&(r={data:c.data.map(function(g){return g.slice()}),index:0})))}if(r==null&&(r={data:[],index:0}),l===null&&(l=Kl(),Be.updateQueue=l),l.memoCache=r,l=r.data[r.index],l===void 0)for(l=r.data[r.index]=Array(a),c=0;c<a;c++)l[c]=ne;return r.index++,l}function Ns(a,r){return typeof r=="function"?r(a):r}function Xl(a){var r=Nt();return jd(r,rt,a)}function jd(a,r,l){var c=a.queue;if(c===null)throw Error(s(311));c.lastRenderedReducer=l;var g=a.baseQueue,y=c.pending;if(y!==null){if(g!==null){var b=g.next;g.next=y.next,y.next=b}r.baseQueue=g=y,c.pending=null}if(y=a.baseState,g===null)a.memoizedState=y;else{r=g.next;var A=b=null,U=null,K=r,se=!1;do{var oe=K.lane&-536870913;if(oe!==K.lane?(ze&oe)===oe:(Rs&oe)===oe){var W=K.revertLane;if(W===0)U!==null&&(U=U.next={lane:0,revertLane:0,gesture:null,action:K.action,hasEagerState:K.hasEagerState,eagerState:K.eagerState,next:null}),oe===Vr&&(se=!0);else if((Rs&W)===W){K=K.next,W===Vr&&(se=!0);continue}else oe={lane:0,revertLane:K.revertLane,gesture:null,action:K.action,hasEagerState:K.hasEagerState,eagerState:K.eagerState,next:null},U===null?(A=U=oe,b=y):U=U.next=oe,Be.lanes|=W,ya|=W;oe=K.action,ir&&l(y,oe),y=K.hasEagerState?K.eagerState:l(y,oe)}else W={lane:oe,revertLane:K.revertLane,gesture:K.gesture,action:K.action,hasEagerState:K.hasEagerState,eagerState:K.eagerState,next:null},U===null?(A=U=W,b=y):U=U.next=W,Be.lanes|=oe,ya|=oe;K=K.next}while(K!==null&&K!==r);if(U===null?b=y:U.next=A,!xn(y,a.memoizedState)&&(Ut=!0,se&&(l=qr,l!==null)))throw l;a.memoizedState=y,a.baseState=b,a.baseQueue=U,c.lastRenderedState=y}return g===null&&(c.lanes=0),[a.memoizedState,c.dispatch]}function Jd(a){var r=Nt(),l=r.queue;if(l===null)throw Error(s(311));l.lastRenderedReducer=a;var c=l.dispatch,g=l.pending,y=r.memoizedState;if(g!==null){l.pending=null;var b=g=g.next;do y=a(y,b.action),b=b.next;while(b!==g);xn(y,r.memoizedState)||(Ut=!0),r.memoizedState=y,r.baseQueue===null&&(r.baseState=y),l.lastRenderedState=y}return[y,c]}function Wg(a,r,l){var c=Be,g=Nt(),y=Je;if(y){if(l===void 0)throw Error(s(407));l=l()}else l=r();var b=!xn((rt||g).memoizedState,l);if(b&&(g.memoizedState=l,Ut=!0),g=g.queue,Zd(ty.bind(null,c,g,a),[a]),g.getSnapshot!==r||b||Lt!==null&&Lt.memoizedState.tag&1){if(c.flags|=2048,jr(9,{destroy:void 0},ey.bind(null,c,g,l,r),null),ct===null)throw Error(s(349));y||(Rs&127)!==0||Qg(c,r,l)}return l}function Qg(a,r,l){a.flags|=16384,a={getSnapshot:r,value:l},r=Be.updateQueue,r===null?(r=Kl(),Be.updateQueue=r,r.stores=[a]):(l=r.stores,l===null?r.stores=[a]:l.push(a))}function ey(a,r,l,c){r.value=l,r.getSnapshot=c,ny(r)&&sy(a)}function ty(a,r,l){return l(function(){ny(r)&&sy(a)})}function ny(a){var r=a.getSnapshot;a=a.value;try{var l=r();return!xn(a,l)}catch{return!0}}function sy(a){var r=Xa(a,2);r!==null&&hn(r,a,2)}function Yd(a){var r=un();if(typeof a=="function"){var l=a;if(a=l(),ir){vn(!0);try{l()}finally{vn(!1)}}}return r.memoizedState=r.baseState=a,r.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ns,lastRenderedState:a},r}function ay(a,r,l,c){return a.baseState=l,jd(a,rt,typeof c=="function"?c:Ns)}function yA(a,r,l,c,g){if(eu(a))throw Error(s(485));if(a=r.action,a!==null){var y={payload:g,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(b){y.listeners.push(b)}};T.T!==null?l(!0):y.isTransition=!1,c(y),l=r.pending,l===null?(y.next=r.pending=y,ry(r,y)):(y.next=l.next,r.pending=l.next=y)}}function ry(a,r){var l=r.action,c=r.payload,g=a.state;if(r.isTransition){var y=T.T,b={};T.T=b;try{var A=l(g,c),U=T.S;U!==null&&U(b,A),iy(a,r,A)}catch(K){Kd(a,r,K)}finally{y!==null&&b.types!==null&&(y.types=b.types),T.T=y}}else try{y=l(g,c),iy(a,r,y)}catch(K){Kd(a,r,K)}}function iy(a,r,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(c){oy(a,r,c)},function(c){return Kd(a,r,c)}):oy(a,r,l)}function oy(a,r,l){r.status="fulfilled",r.value=l,ly(r),a.state=l,r=a.pending,r!==null&&(l=r.next,l===r?a.pending=null:(l=l.next,r.next=l,ry(a,l)))}function Kd(a,r,l){var c=a.pending;if(a.pending=null,c!==null){c=c.next;do r.status="rejected",r.reason=l,ly(r),r=r.next;while(r!==c)}a.action=null}function ly(a){a=a.listeners;for(var r=0;r<a.length;r++)(0,a[r])()}function uy(a,r){return r}function cy(a,r){if(Je){var l=ct.formState;if(l!==null){e:{var c=Be;if(Je){if(pt){t:{for(var g=pt,y=Vn;g.nodeType!==8;){if(!y){g=null;break t}if(g=Fn(g.nextSibling),g===null){g=null;break t}}y=g.data,g=y==="F!"||y==="F"?g:null}if(g){pt=Fn(g.nextSibling),c=g.data==="F!";break e}}la(c)}c=!1}c&&(r=l[0])}}return l=un(),l.memoizedState=l.baseState=r,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:uy,lastRenderedState:r},l.queue=c,l=Ny.bind(null,Be,c),c.dispatch=l,c=Yd(!1),y=tf.bind(null,Be,!1,c.queue),c=un(),g={state:r,dispatch:null,action:a,pending:null},c.queue=g,l=yA.bind(null,Be,g,y,l),g.dispatch=l,c.memoizedState=a,[r,l,!1]}function dy(a){var r=Nt();return fy(r,rt,a)}function fy(a,r,l){if(r=jd(a,r,uy)[0],a=Xl(Ns)[0],typeof r=="object"&&r!==null&&typeof r.then=="function")try{var c=uo(r)}catch(b){throw b===Fr?Fl:b}else c=r;r=Nt();var g=r.queue,y=g.dispatch;return l!==r.memoizedState&&(Be.flags|=2048,jr(9,{destroy:void 0},vA.bind(null,g,l),null)),[c,y,a]}function vA(a,r){a.action=r}function my(a){var r=Nt(),l=rt;if(l!==null)return fy(r,l,a);Nt(),r=r.memoizedState,l=Nt();var c=l.queue.dispatch;return l.memoizedState=a,[r,c,!1]}function jr(a,r,l,c){return a={tag:a,create:l,deps:c,inst:r,next:null},r=Be.updateQueue,r===null&&(r=Kl(),Be.updateQueue=r),l=r.lastEffect,l===null?r.lastEffect=a.next=a:(c=l.next,l.next=a,a.next=c,r.lastEffect=a),a}function py(){return Nt().memoizedState}function Wl(a,r,l,c){var g=un();Be.flags|=a,g.memoizedState=jr(1|r,{destroy:void 0},l,c===void 0?null:c)}function Ql(a,r,l,c){var g=Nt();c=c===void 0?null:c;var y=g.memoizedState.inst;rt!==null&&c!==null&&qd(c,rt.memoizedState.deps)?g.memoizedState=jr(r,y,l,c):(Be.flags|=a,g.memoizedState=jr(1|r,y,l,c))}function hy(a,r){Wl(8390656,8,a,r)}function Zd(a,r){Ql(2048,8,a,r)}function xA(a){Be.flags|=4;var r=Be.updateQueue;if(r===null)r=Kl(),Be.updateQueue=r,r.events=[a];else{var l=r.events;l===null?r.events=[a]:l.push(a)}}function gy(a){var r=Nt().memoizedState;return xA({ref:r,nextImpl:a}),function(){if((tt&2)!==0)throw Error(s(440));return r.impl.apply(void 0,arguments)}}function yy(a,r){return Ql(4,2,a,r)}function vy(a,r){return Ql(4,4,a,r)}function xy(a,r){if(typeof r=="function"){a=a();var l=r(a);return function(){typeof l=="function"?l():r(null)}}if(r!=null)return a=a(),r.current=a,function(){r.current=null}}function Sy(a,r,l){l=l!=null?l.concat([a]):null,Ql(4,4,xy.bind(null,r,a),l)}function Xd(){}function wy(a,r){var l=Nt();r=r===void 0?null:r;var c=l.memoizedState;return r!==null&&qd(r,c[1])?c[0]:(l.memoizedState=[a,r],a)}function _y(a,r){var l=Nt();r=r===void 0?null:r;var c=l.memoizedState;if(r!==null&&qd(r,c[1]))return c[0];if(c=a(),ir){vn(!0);try{a()}finally{vn(!1)}}return l.memoizedState=[c,r],c}function Wd(a,r,l){return l===void 0||(Rs&1073741824)!==0&&(ze&261930)===0?a.memoizedState=r:(a.memoizedState=l,a=b0(),Be.lanes|=a,ya|=a,l)}function by(a,r,l,c){return xn(l,r)?l:Gr.current!==null?(a=Wd(a,l,c),xn(a,r)||(Ut=!0),a):(Rs&42)===0||(Rs&1073741824)!==0&&(ze&261930)===0?(Ut=!0,a.memoizedState=l):(a=b0(),Be.lanes|=a,ya|=a,r)}function Cy(a,r,l,c,g){var y=R.p;R.p=y!==0&&8>y?y:8;var b=T.T,A={};T.T=A,tf(a,!1,r,l);try{var U=g(),K=T.S;if(K!==null&&K(A,U),U!==null&&typeof U=="object"&&typeof U.then=="function"){var se=pA(U,c);co(a,r,se,Tn(a))}else co(a,r,c,Tn(a))}catch(oe){co(a,r,{then:function(){},status:"rejected",reason:oe},Tn())}finally{R.p=y,b!==null&&A.types!==null&&(b.types=A.types),T.T=b}}function SA(){}function Qd(a,r,l,c){if(a.tag!==5)throw Error(s(476));var g=Ty(a).queue;Cy(a,g,r,L,l===null?SA:function(){return Ay(a),l(c)})}function Ty(a){var r=a.memoizedState;if(r!==null)return r;r={memoizedState:L,baseState:L,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ns,lastRenderedState:L},next:null};var l={};return r.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ns,lastRenderedState:l},next:null},a.memoizedState=r,a=a.alternate,a!==null&&(a.memoizedState=r),r}function Ay(a){var r=Ty(a);r.next===null&&(r=a.alternate.memoizedState),co(a,r.next.queue,{},Tn())}function ef(){return Kt(Ro)}function Ey(){return Nt().memoizedState}function Ry(){return Nt().memoizedState}function wA(a){for(var r=a.return;r!==null;){switch(r.tag){case 24:case 3:var l=Tn();a=da(l);var c=fa(r,a,l);c!==null&&(hn(c,r,l),ro(c,r,l)),r={cache:Nd()},a.payload=r;return}r=r.return}}function _A(a,r,l){var c=Tn();l={lane:c,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null},eu(a)?My(r,l):(l=vd(a,r,l,c),l!==null&&(hn(l,a,c),Iy(l,r,c)))}function Ny(a,r,l){var c=Tn();co(a,r,l,c)}function co(a,r,l,c){var g={lane:c,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null};if(eu(a))My(r,g);else{var y=a.alternate;if(a.lanes===0&&(y===null||y.lanes===0)&&(y=r.lastRenderedReducer,y!==null))try{var b=r.lastRenderedState,A=y(b,l);if(g.hasEagerState=!0,g.eagerState=A,xn(A,b))return kl(a,r,g,0),ct===null&&Pl(),!1}catch{}finally{}if(l=vd(a,r,g,c),l!==null)return hn(l,a,c),Iy(l,r,c),!0}return!1}function tf(a,r,l,c){if(c={lane:2,revertLane:kf(),gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},eu(a)){if(r)throw Error(s(479))}else r=vd(a,l,c,2),r!==null&&hn(r,a,2)}function eu(a){var r=a.alternate;return a===Be||r!==null&&r===Be}function My(a,r){Hr=Jl=!0;var l=a.pending;l===null?r.next=r:(r.next=l.next,l.next=r),a.pending=r}function Iy(a,r,l){if((l&4194048)!==0){var c=r.lanes;c&=a.pendingLanes,l|=c,r.lanes=l,vl(a,l)}}var fo={readContext:Kt,use:Zl,useCallback:Tt,useContext:Tt,useEffect:Tt,useImperativeHandle:Tt,useLayoutEffect:Tt,useInsertionEffect:Tt,useMemo:Tt,useReducer:Tt,useRef:Tt,useState:Tt,useDebugValue:Tt,useDeferredValue:Tt,useTransition:Tt,useSyncExternalStore:Tt,useId:Tt,useHostTransitionStatus:Tt,useFormState:Tt,useActionState:Tt,useOptimistic:Tt,useMemoCache:Tt,useCacheRefresh:Tt};fo.useEffectEvent=Tt;var Dy={readContext:Kt,use:Zl,useCallback:function(a,r){return un().memoizedState=[a,r===void 0?null:r],a},useContext:Kt,useEffect:hy,useImperativeHandle:function(a,r,l){l=l!=null?l.concat([a]):null,Wl(4194308,4,xy.bind(null,r,a),l)},useLayoutEffect:function(a,r){return Wl(4194308,4,a,r)},useInsertionEffect:function(a,r){Wl(4,2,a,r)},useMemo:function(a,r){var l=un();r=r===void 0?null:r;var c=a();if(ir){vn(!0);try{a()}finally{vn(!1)}}return l.memoizedState=[c,r],c},useReducer:function(a,r,l){var c=un();if(l!==void 0){var g=l(r);if(ir){vn(!0);try{l(r)}finally{vn(!1)}}}else g=r;return c.memoizedState=c.baseState=g,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:g},c.queue=a,a=a.dispatch=_A.bind(null,Be,a),[c.memoizedState,a]},useRef:function(a){var r=un();return a={current:a},r.memoizedState=a},useState:function(a){a=Yd(a);var r=a.queue,l=Ny.bind(null,Be,r);return r.dispatch=l,[a.memoizedState,l]},useDebugValue:Xd,useDeferredValue:function(a,r){var l=un();return Wd(l,a,r)},useTransition:function(){var a=Yd(!1);return a=Cy.bind(null,Be,a.queue,!0,!1),un().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,r,l){var c=Be,g=un();if(Je){if(l===void 0)throw Error(s(407));l=l()}else{if(l=r(),ct===null)throw Error(s(349));(ze&127)!==0||Qg(c,r,l)}g.memoizedState=l;var y={value:l,getSnapshot:r};return g.queue=y,hy(ty.bind(null,c,y,a),[a]),c.flags|=2048,jr(9,{destroy:void 0},ey.bind(null,c,y,l,r),null),l},useId:function(){var a=un(),r=ct.identifierPrefix;if(Je){var l=os,c=is;l=(c&~(1<<32-Ht(c)-1)).toString(32)+l,r="_"+r+"R_"+l,l=Yl++,0<l&&(r+="H"+l.toString(32)),r+="_"}else l=hA++,r="_"+r+"r_"+l.toString(32)+"_";return a.memoizedState=r},useHostTransitionStatus:ef,useFormState:cy,useActionState:cy,useOptimistic:function(a){var r=un();r.memoizedState=r.baseState=a;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return r.queue=l,r=tf.bind(null,Be,!0,l),l.dispatch=r,[a,r]},useMemoCache:zd,useCacheRefresh:function(){return un().memoizedState=wA.bind(null,Be)},useEffectEvent:function(a){var r=un(),l={impl:a};return r.memoizedState=l,function(){if((tt&2)!==0)throw Error(s(440));return l.impl.apply(void 0,arguments)}}},nf={readContext:Kt,use:Zl,useCallback:wy,useContext:Kt,useEffect:Zd,useImperativeHandle:Sy,useInsertionEffect:yy,useLayoutEffect:vy,useMemo:_y,useReducer:Xl,useRef:py,useState:function(){return Xl(Ns)},useDebugValue:Xd,useDeferredValue:function(a,r){var l=Nt();return by(l,rt.memoizedState,a,r)},useTransition:function(){var a=Xl(Ns)[0],r=Nt().memoizedState;return[typeof a=="boolean"?a:uo(a),r]},useSyncExternalStore:Wg,useId:Ey,useHostTransitionStatus:ef,useFormState:dy,useActionState:dy,useOptimistic:function(a,r){var l=Nt();return ay(l,rt,a,r)},useMemoCache:zd,useCacheRefresh:Ry};nf.useEffectEvent=gy;var Py={readContext:Kt,use:Zl,useCallback:wy,useContext:Kt,useEffect:Zd,useImperativeHandle:Sy,useInsertionEffect:yy,useLayoutEffect:vy,useMemo:_y,useReducer:Jd,useRef:py,useState:function(){return Jd(Ns)},useDebugValue:Xd,useDeferredValue:function(a,r){var l=Nt();return rt===null?Wd(l,a,r):by(l,rt.memoizedState,a,r)},useTransition:function(){var a=Jd(Ns)[0],r=Nt().memoizedState;return[typeof a=="boolean"?a:uo(a),r]},useSyncExternalStore:Wg,useId:Ey,useHostTransitionStatus:ef,useFormState:my,useActionState:my,useOptimistic:function(a,r){var l=Nt();return rt!==null?ay(l,rt,a,r):(l.baseState=a,[a,l.queue.dispatch])},useMemoCache:zd,useCacheRefresh:Ry};Py.useEffectEvent=gy;function sf(a,r,l,c){r=a.memoizedState,l=l(c,r),l=l==null?r:S({},r,l),a.memoizedState=l,a.lanes===0&&(a.updateQueue.baseState=l)}var af={enqueueSetState:function(a,r,l){a=a._reactInternals;var c=Tn(),g=da(c);g.payload=r,l!=null&&(g.callback=l),r=fa(a,g,c),r!==null&&(hn(r,a,c),ro(r,a,c))},enqueueReplaceState:function(a,r,l){a=a._reactInternals;var c=Tn(),g=da(c);g.tag=1,g.payload=r,l!=null&&(g.callback=l),r=fa(a,g,c),r!==null&&(hn(r,a,c),ro(r,a,c))},enqueueForceUpdate:function(a,r){a=a._reactInternals;var l=Tn(),c=da(l);c.tag=2,r!=null&&(c.callback=r),r=fa(a,c,l),r!==null&&(hn(r,a,l),ro(r,a,l))}};function ky(a,r,l,c,g,y,b){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(c,y,b):r.prototype&&r.prototype.isPureReactComponent?!Xi(l,c)||!Xi(g,y):!0}function Ly(a,r,l,c){a=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(l,c),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(l,c),r.state!==a&&af.enqueueReplaceState(r,r.state,null)}function or(a,r){var l=r;if("ref"in r){l={};for(var c in r)c!=="ref"&&(l[c]=r[c])}if(a=a.defaultProps){l===r&&(l=S({},l));for(var g in a)l[g]===void 0&&(l[g]=a[g])}return l}function Uy(a){Dl(a)}function Oy(a){console.error(a)}function By(a){Dl(a)}function tu(a,r){try{var l=a.onUncaughtError;l(r.value,{componentStack:r.stack})}catch(c){setTimeout(function(){throw c})}}function Vy(a,r,l){try{var c=a.onCaughtError;c(l.value,{componentStack:l.stack,errorBoundary:r.tag===1?r.stateNode:null})}catch(g){setTimeout(function(){throw g})}}function rf(a,r,l){return l=da(l),l.tag=3,l.payload={element:null},l.callback=function(){tu(a,r)},l}function qy(a){return a=da(a),a.tag=3,a}function Fy(a,r,l,c){var g=l.type.getDerivedStateFromError;if(typeof g=="function"){var y=c.value;a.payload=function(){return g(y)},a.callback=function(){Vy(r,l,c)}}var b=l.stateNode;b!==null&&typeof b.componentDidCatch=="function"&&(a.callback=function(){Vy(r,l,c),typeof g!="function"&&(va===null?va=new Set([this]):va.add(this));var A=c.stack;this.componentDidCatch(c.value,{componentStack:A!==null?A:""})})}function bA(a,r,l,c,g){if(l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){if(r=l.alternate,r!==null&&Br(r,l,g,!0),l=wn.current,l!==null){switch(l.tag){case 31:case 13:return qn===null?mu():l.alternate===null&&At===0&&(At=3),l.flags&=-257,l.flags|=65536,l.lanes=g,c===$l?l.flags|=16384:(r=l.updateQueue,r===null?l.updateQueue=new Set([c]):r.add(c),If(a,c,g)),!1;case 22:return l.flags|=65536,c===$l?l.flags|=16384:(r=l.updateQueue,r===null?(r={transitions:null,markerInstances:null,retryQueue:new Set([c])},l.updateQueue=r):(l=r.retryQueue,l===null?r.retryQueue=new Set([c]):l.add(c)),If(a,c,g)),!1}throw Error(s(435,l.tag))}return If(a,c,g),mu(),!1}if(Je)return r=wn.current,r!==null?((r.flags&65536)===0&&(r.flags|=256),r.flags|=65536,r.lanes=g,c!==Cd&&(a=Error(s(422),{cause:c}),eo(Un(a,l)))):(c!==Cd&&(r=Error(s(423),{cause:c}),eo(Un(r,l))),a=a.current.alternate,a.flags|=65536,g&=-g,a.lanes|=g,c=Un(c,l),g=rf(a.stateNode,c,g),Ld(a,g),At!==4&&(At=2)),!1;var y=Error(s(520),{cause:c});if(y=Un(y,l),So===null?So=[y]:So.push(y),At!==4&&(At=2),r===null)return!0;c=Un(c,l),l=r;do{switch(l.tag){case 3:return l.flags|=65536,a=g&-g,l.lanes|=a,a=rf(l.stateNode,c,a),Ld(l,a),!1;case 1:if(r=l.type,y=l.stateNode,(l.flags&128)===0&&(typeof r.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(va===null||!va.has(y))))return l.flags|=65536,g&=-g,l.lanes|=g,g=qy(g),Fy(g,a,l,c),Ld(l,g),!1}l=l.return}while(l!==null);return!1}var of=Error(s(461)),Ut=!1;function Zt(a,r,l,c){r.child=a===null?zg(r,null,l,c):rr(r,a.child,l,c)}function $y(a,r,l,c,g){l=l.render;var y=r.ref;if("ref"in c){var b={};for(var A in c)A!=="ref"&&(b[A]=c[A])}else b=c;return tr(r),c=Fd(a,r,l,b,y,g),A=$d(),a!==null&&!Ut?(Gd(a,r,g),Ms(a,r,g)):(Je&&A&&_d(r),r.flags|=1,Zt(a,r,c,g),r.child)}function Gy(a,r,l,c,g){if(a===null){var y=l.type;return typeof y=="function"&&!xd(y)&&y.defaultProps===void 0&&l.compare===null?(r.tag=15,r.type=y,Hy(a,r,y,c,g)):(a=Ul(l.type,null,c,r,r.mode,g),a.ref=r.ref,a.return=r,r.child=a)}if(y=a.child,!hf(a,g)){var b=y.memoizedProps;if(l=l.compare,l=l!==null?l:Xi,l(b,c)&&a.ref===r.ref)return Ms(a,r,g)}return r.flags|=1,a=Cs(y,c),a.ref=r.ref,a.return=r,r.child=a}function Hy(a,r,l,c,g){if(a!==null){var y=a.memoizedProps;if(Xi(y,c)&&a.ref===r.ref)if(Ut=!1,r.pendingProps=c=y,hf(a,g))(a.flags&131072)!==0&&(Ut=!0);else return r.lanes=a.lanes,Ms(a,r,g)}return lf(a,r,l,c,g)}function zy(a,r,l,c){var g=c.children,y=a!==null?a.memoizedState:null;if(a===null&&r.stateNode===null&&(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),c.mode==="hidden"){if((r.flags&128)!==0){if(y=y!==null?y.baseLanes|l:l,a!==null){for(c=r.child=a.child,g=0;c!==null;)g=g|c.lanes|c.childLanes,c=c.sibling;c=g&~y}else c=0,r.child=null;return jy(a,r,y,l,c)}if((l&536870912)!==0)r.memoizedState={baseLanes:0,cachePool:null},a!==null&&ql(r,y!==null?y.cachePool:null),y!==null?Yg(r,y):Od(),Kg(r);else return c=r.lanes=536870912,jy(a,r,y!==null?y.baseLanes|l:l,l,c)}else y!==null?(ql(r,y.cachePool),Yg(r,y),pa(),r.memoizedState=null):(a!==null&&ql(r,null),Od(),pa());return Zt(a,r,g,l),r.child}function mo(a,r){return a!==null&&a.tag===22||r.stateNode!==null||(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),r.sibling}function jy(a,r,l,c,g){var y=Id();return y=y===null?null:{parent:kt._currentValue,pool:y},r.memoizedState={baseLanes:l,cachePool:y},a!==null&&ql(r,null),Od(),Kg(r),a!==null&&Br(a,r,c,!0),r.childLanes=g,null}function nu(a,r){return r=au({mode:r.mode,children:r.children},a.mode),r.ref=a.ref,a.child=r,r.return=a,r}function Jy(a,r,l){return rr(r,a.child,null,l),a=nu(r,r.pendingProps),a.flags|=2,_n(r),r.memoizedState=null,a}function CA(a,r,l){var c=r.pendingProps,g=(r.flags&128)!==0;if(r.flags&=-129,a===null){if(Je){if(c.mode==="hidden")return a=nu(r,c),r.lanes=536870912,mo(null,a);if(Vd(r),(a=pt)?(a=rv(a,Vn),a=a!==null&&a.data==="&"?a:null,a!==null&&(r.memoizedState={dehydrated:a,treeContext:ia!==null?{id:is,overflow:os}:null,retryLane:536870912,hydrationErrors:null},l=Mg(a),l.return=r,r.child=l,Yt=r,pt=null)):a=null,a===null)throw la(r);return r.lanes=536870912,null}return nu(r,c)}var y=a.memoizedState;if(y!==null){var b=y.dehydrated;if(Vd(r),g)if(r.flags&256)r.flags&=-257,r=Jy(a,r,l);else if(r.memoizedState!==null)r.child=a.child,r.flags|=128,r=null;else throw Error(s(558));else if(Ut||Br(a,r,l,!1),g=(l&a.childLanes)!==0,Ut||g){if(c=ct,c!==null&&(b=xl(c,l),b!==0&&b!==y.retryLane))throw y.retryLane=b,Xa(a,b),hn(c,a,b),of;mu(),r=Jy(a,r,l)}else a=y.treeContext,pt=Fn(b.nextSibling),Yt=r,Je=!0,oa=null,Vn=!1,a!==null&&Pg(r,a),r=nu(r,c),r.flags|=4096;return r}return a=Cs(a.child,{mode:c.mode,children:c.children}),a.ref=r.ref,r.child=a,a.return=r,a}function su(a,r){var l=r.ref;if(l===null)a!==null&&a.ref!==null&&(r.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(s(284));(a===null||a.ref!==l)&&(r.flags|=4194816)}}function lf(a,r,l,c,g){return tr(r),l=Fd(a,r,l,c,void 0,g),c=$d(),a!==null&&!Ut?(Gd(a,r,g),Ms(a,r,g)):(Je&&c&&_d(r),r.flags|=1,Zt(a,r,l,g),r.child)}function Yy(a,r,l,c,g,y){return tr(r),r.updateQueue=null,l=Xg(r,c,l,g),Zg(a),c=$d(),a!==null&&!Ut?(Gd(a,r,y),Ms(a,r,y)):(Je&&c&&_d(r),r.flags|=1,Zt(a,r,l,y),r.child)}function Ky(a,r,l,c,g){if(tr(r),r.stateNode===null){var y=kr,b=l.contextType;typeof b=="object"&&b!==null&&(y=Kt(b)),y=new l(c,y),r.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,y.updater=af,r.stateNode=y,y._reactInternals=r,y=r.stateNode,y.props=c,y.state=r.memoizedState,y.refs={},Pd(r),b=l.contextType,y.context=typeof b=="object"&&b!==null?Kt(b):kr,y.state=r.memoizedState,b=l.getDerivedStateFromProps,typeof b=="function"&&(sf(r,l,b,c),y.state=r.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof y.getSnapshotBeforeUpdate=="function"||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(b=y.state,typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount(),b!==y.state&&af.enqueueReplaceState(y,y.state,null),oo(r,c,y,g),io(),y.state=r.memoizedState),typeof y.componentDidMount=="function"&&(r.flags|=4194308),c=!0}else if(a===null){y=r.stateNode;var A=r.memoizedProps,U=or(l,A);y.props=U;var K=y.context,se=l.contextType;b=kr,typeof se=="object"&&se!==null&&(b=Kt(se));var oe=l.getDerivedStateFromProps;se=typeof oe=="function"||typeof y.getSnapshotBeforeUpdate=="function",A=r.pendingProps!==A,se||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(A||K!==b)&&Ly(r,y,c,b),ca=!1;var W=r.memoizedState;y.state=W,oo(r,c,y,g),io(),K=r.memoizedState,A||W!==K||ca?(typeof oe=="function"&&(sf(r,l,oe,c),K=r.memoizedState),(U=ca||ky(r,l,U,c,W,K,b))?(se||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount()),typeof y.componentDidMount=="function"&&(r.flags|=4194308)):(typeof y.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=c,r.memoizedState=K),y.props=c,y.state=K,y.context=b,c=U):(typeof y.componentDidMount=="function"&&(r.flags|=4194308),c=!1)}else{y=r.stateNode,kd(a,r),b=r.memoizedProps,se=or(l,b),y.props=se,oe=r.pendingProps,W=y.context,K=l.contextType,U=kr,typeof K=="object"&&K!==null&&(U=Kt(K)),A=l.getDerivedStateFromProps,(K=typeof A=="function"||typeof y.getSnapshotBeforeUpdate=="function")||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(b!==oe||W!==U)&&Ly(r,y,c,U),ca=!1,W=r.memoizedState,y.state=W,oo(r,c,y,g),io();var ee=r.memoizedState;b!==oe||W!==ee||ca||a!==null&&a.dependencies!==null&&Bl(a.dependencies)?(typeof A=="function"&&(sf(r,l,A,c),ee=r.memoizedState),(se=ca||ky(r,l,se,c,W,ee,U)||a!==null&&a.dependencies!==null&&Bl(a.dependencies))?(K||typeof y.UNSAFE_componentWillUpdate!="function"&&typeof y.componentWillUpdate!="function"||(typeof y.componentWillUpdate=="function"&&y.componentWillUpdate(c,ee,U),typeof y.UNSAFE_componentWillUpdate=="function"&&y.UNSAFE_componentWillUpdate(c,ee,U)),typeof y.componentDidUpdate=="function"&&(r.flags|=4),typeof y.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof y.componentDidUpdate!="function"||b===a.memoizedProps&&W===a.memoizedState||(r.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||b===a.memoizedProps&&W===a.memoizedState||(r.flags|=1024),r.memoizedProps=c,r.memoizedState=ee),y.props=c,y.state=ee,y.context=U,c=se):(typeof y.componentDidUpdate!="function"||b===a.memoizedProps&&W===a.memoizedState||(r.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||b===a.memoizedProps&&W===a.memoizedState||(r.flags|=1024),c=!1)}return y=c,su(a,r),c=(r.flags&128)!==0,y||c?(y=r.stateNode,l=c&&typeof l.getDerivedStateFromError!="function"?null:y.render(),r.flags|=1,a!==null&&c?(r.child=rr(r,a.child,null,g),r.child=rr(r,null,l,g)):Zt(a,r,l,g),r.memoizedState=y.state,a=r.child):a=Ms(a,r,g),a}function Zy(a,r,l,c){return Qa(),r.flags|=256,Zt(a,r,l,c),r.child}var uf={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function cf(a){return{baseLanes:a,cachePool:Vg()}}function df(a,r,l){return a=a!==null?a.childLanes&~l:0,r&&(a|=Cn),a}function Xy(a,r,l){var c=r.pendingProps,g=!1,y=(r.flags&128)!==0,b;if((b=y)||(b=a!==null&&a.memoizedState===null?!1:(Rt.current&2)!==0),b&&(g=!0,r.flags&=-129),b=(r.flags&32)!==0,r.flags&=-33,a===null){if(Je){if(g?ma(r):pa(),(a=pt)?(a=rv(a,Vn),a=a!==null&&a.data!=="&"?a:null,a!==null&&(r.memoizedState={dehydrated:a,treeContext:ia!==null?{id:is,overflow:os}:null,retryLane:536870912,hydrationErrors:null},l=Mg(a),l.return=r,r.child=l,Yt=r,pt=null)):a=null,a===null)throw la(r);return Jf(a)?r.lanes=32:r.lanes=536870912,null}var A=c.children;return c=c.fallback,g?(pa(),g=r.mode,A=au({mode:"hidden",children:A},g),c=Wa(c,g,l,null),A.return=r,c.return=r,A.sibling=c,r.child=A,c=r.child,c.memoizedState=cf(l),c.childLanes=df(a,b,l),r.memoizedState=uf,mo(null,c)):(ma(r),ff(r,A))}var U=a.memoizedState;if(U!==null&&(A=U.dehydrated,A!==null)){if(y)r.flags&256?(ma(r),r.flags&=-257,r=mf(a,r,l)):r.memoizedState!==null?(pa(),r.child=a.child,r.flags|=128,r=null):(pa(),A=c.fallback,g=r.mode,c=au({mode:"visible",children:c.children},g),A=Wa(A,g,l,null),A.flags|=2,c.return=r,A.return=r,c.sibling=A,r.child=c,rr(r,a.child,null,l),c=r.child,c.memoizedState=cf(l),c.childLanes=df(a,b,l),r.memoizedState=uf,r=mo(null,c));else if(ma(r),Jf(A)){if(b=A.nextSibling&&A.nextSibling.dataset,b)var K=b.dgst;b=K,c=Error(s(419)),c.stack="",c.digest=b,eo({value:c,source:null,stack:null}),r=mf(a,r,l)}else if(Ut||Br(a,r,l,!1),b=(l&a.childLanes)!==0,Ut||b){if(b=ct,b!==null&&(c=xl(b,l),c!==0&&c!==U.retryLane))throw U.retryLane=c,Xa(a,c),hn(b,a,c),of;jf(A)||mu(),r=mf(a,r,l)}else jf(A)?(r.flags|=192,r.child=a.child,r=null):(a=U.treeContext,pt=Fn(A.nextSibling),Yt=r,Je=!0,oa=null,Vn=!1,a!==null&&Pg(r,a),r=ff(r,c.children),r.flags|=4096);return r}return g?(pa(),A=c.fallback,g=r.mode,U=a.child,K=U.sibling,c=Cs(U,{mode:"hidden",children:c.children}),c.subtreeFlags=U.subtreeFlags&65011712,K!==null?A=Cs(K,A):(A=Wa(A,g,l,null),A.flags|=2),A.return=r,c.return=r,c.sibling=A,r.child=c,mo(null,c),c=r.child,A=a.child.memoizedState,A===null?A=cf(l):(g=A.cachePool,g!==null?(U=kt._currentValue,g=g.parent!==U?{parent:U,pool:U}:g):g=Vg(),A={baseLanes:A.baseLanes|l,cachePool:g}),c.memoizedState=A,c.childLanes=df(a,b,l),r.memoizedState=uf,mo(a.child,c)):(ma(r),l=a.child,a=l.sibling,l=Cs(l,{mode:"visible",children:c.children}),l.return=r,l.sibling=null,a!==null&&(b=r.deletions,b===null?(r.deletions=[a],r.flags|=16):b.push(a)),r.child=l,r.memoizedState=null,l)}function ff(a,r){return r=au({mode:"visible",children:r},a.mode),r.return=a,a.child=r}function au(a,r){return a=Sn(22,a,null,r),a.lanes=0,a}function mf(a,r,l){return rr(r,a.child,null,l),a=ff(r,r.pendingProps.children),a.flags|=2,r.memoizedState=null,a}function Wy(a,r,l){a.lanes|=r;var c=a.alternate;c!==null&&(c.lanes|=r),Ed(a.return,r,l)}function pf(a,r,l,c,g,y){var b=a.memoizedState;b===null?a.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:c,tail:l,tailMode:g,treeForkCount:y}:(b.isBackwards=r,b.rendering=null,b.renderingStartTime=0,b.last=c,b.tail=l,b.tailMode=g,b.treeForkCount=y)}function Qy(a,r,l){var c=r.pendingProps,g=c.revealOrder,y=c.tail;c=c.children;var b=Rt.current,A=(b&2)!==0;if(A?(b=b&1|2,r.flags|=128):b&=1,te(Rt,b),Zt(a,r,c,l),c=Je?Qi:0,!A&&a!==null&&(a.flags&128)!==0)e:for(a=r.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&Wy(a,l,r);else if(a.tag===19)Wy(a,l,r);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break e;for(;a.sibling===null;){if(a.return===null||a.return===r)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}switch(g){case"forwards":for(l=r.child,g=null;l!==null;)a=l.alternate,a!==null&&jl(a)===null&&(g=l),l=l.sibling;l=g,l===null?(g=r.child,r.child=null):(g=l.sibling,l.sibling=null),pf(r,!1,g,l,y,c);break;case"backwards":case"unstable_legacy-backwards":for(l=null,g=r.child,r.child=null;g!==null;){if(a=g.alternate,a!==null&&jl(a)===null){r.child=g;break}a=g.sibling,g.sibling=l,l=g,g=a}pf(r,!0,l,null,y,c);break;case"together":pf(r,!1,null,null,void 0,c);break;default:r.memoizedState=null}return r.child}function Ms(a,r,l){if(a!==null&&(r.dependencies=a.dependencies),ya|=r.lanes,(l&r.childLanes)===0)if(a!==null){if(Br(a,r,l,!1),(l&r.childLanes)===0)return null}else return null;if(a!==null&&r.child!==a.child)throw Error(s(153));if(r.child!==null){for(a=r.child,l=Cs(a,a.pendingProps),r.child=l,l.return=r;a.sibling!==null;)a=a.sibling,l=l.sibling=Cs(a,a.pendingProps),l.return=r;l.sibling=null}return r.child}function hf(a,r){return(a.lanes&r)!==0?!0:(a=a.dependencies,!!(a!==null&&Bl(a)))}function TA(a,r,l){switch(r.tag){case 3:Ae(r,r.stateNode.containerInfo),ua(r,kt,a.memoizedState.cache),Qa();break;case 27:case 5:en(r);break;case 4:Ae(r,r.stateNode.containerInfo);break;case 10:ua(r,r.type,r.memoizedProps.value);break;case 31:if(r.memoizedState!==null)return r.flags|=128,Vd(r),null;break;case 13:var c=r.memoizedState;if(c!==null)return c.dehydrated!==null?(ma(r),r.flags|=128,null):(l&r.child.childLanes)!==0?Xy(a,r,l):(ma(r),a=Ms(a,r,l),a!==null?a.sibling:null);ma(r);break;case 19:var g=(a.flags&128)!==0;if(c=(l&r.childLanes)!==0,c||(Br(a,r,l,!1),c=(l&r.childLanes)!==0),g){if(c)return Qy(a,r,l);r.flags|=128}if(g=r.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),te(Rt,Rt.current),c)break;return null;case 22:return r.lanes=0,zy(a,r,l,r.pendingProps);case 24:ua(r,kt,a.memoizedState.cache)}return Ms(a,r,l)}function e0(a,r,l){if(a!==null)if(a.memoizedProps!==r.pendingProps)Ut=!0;else{if(!hf(a,l)&&(r.flags&128)===0)return Ut=!1,TA(a,r,l);Ut=(a.flags&131072)!==0}else Ut=!1,Je&&(r.flags&1048576)!==0&&Dg(r,Qi,r.index);switch(r.lanes=0,r.tag){case 16:e:{var c=r.pendingProps;if(a=sr(r.elementType),r.type=a,typeof a=="function")xd(a)?(c=or(a,c),r.tag=1,r=Ky(null,r,a,c,l)):(r.tag=0,r=lf(null,r,a,c,l));else{if(a!=null){var g=a.$$typeof;if(g===z){r.tag=11,r=$y(null,r,a,c,l);break e}else if(g===J){r.tag=14,r=Gy(null,r,a,c,l);break e}}throw r=P(a)||a,Error(s(306,r,""))}}return r;case 0:return lf(a,r,r.type,r.pendingProps,l);case 1:return c=r.type,g=or(c,r.pendingProps),Ky(a,r,c,g,l);case 3:e:{if(Ae(r,r.stateNode.containerInfo),a===null)throw Error(s(387));c=r.pendingProps;var y=r.memoizedState;g=y.element,kd(a,r),oo(r,c,null,l);var b=r.memoizedState;if(c=b.cache,ua(r,kt,c),c!==y.cache&&Rd(r,[kt],l,!0),io(),c=b.element,y.isDehydrated)if(y={element:c,isDehydrated:!1,cache:b.cache},r.updateQueue.baseState=y,r.memoizedState=y,r.flags&256){r=Zy(a,r,c,l);break e}else if(c!==g){g=Un(Error(s(424)),r),eo(g),r=Zy(a,r,c,l);break e}else{switch(a=r.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(pt=Fn(a.firstChild),Yt=r,Je=!0,oa=null,Vn=!0,l=zg(r,null,c,l),r.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling}else{if(Qa(),c===g){r=Ms(a,r,l);break e}Zt(a,r,c,l)}r=r.child}return r;case 26:return su(a,r),a===null?(l=dv(r.type,null,r.pendingProps,null))?r.memoizedState=l:Je||(l=r.type,a=r.pendingProps,c=Su(ue.current).createElement(l),c[mt]=r,c[Vt]=a,Xt(c,l,a),Pt(c),r.stateNode=c):r.memoizedState=dv(r.type,a.memoizedProps,r.pendingProps,a.memoizedState),null;case 27:return en(r),a===null&&Je&&(c=r.stateNode=lv(r.type,r.pendingProps,ue.current),Yt=r,Vn=!0,g=pt,_a(r.type)?(Yf=g,pt=Fn(c.firstChild)):pt=g),Zt(a,r,r.pendingProps.children,l),su(a,r),a===null&&(r.flags|=4194304),r.child;case 5:return a===null&&Je&&((g=c=pt)&&(c=tE(c,r.type,r.pendingProps,Vn),c!==null?(r.stateNode=c,Yt=r,pt=Fn(c.firstChild),Vn=!1,g=!0):g=!1),g||la(r)),en(r),g=r.type,y=r.pendingProps,b=a!==null?a.memoizedProps:null,c=y.children,Gf(g,y)?c=null:b!==null&&Gf(g,b)&&(r.flags|=32),r.memoizedState!==null&&(g=Fd(a,r,gA,null,null,l),Ro._currentValue=g),su(a,r),Zt(a,r,c,l),r.child;case 6:return a===null&&Je&&((a=l=pt)&&(l=nE(l,r.pendingProps,Vn),l!==null?(r.stateNode=l,Yt=r,pt=null,a=!0):a=!1),a||la(r)),null;case 13:return Xy(a,r,l);case 4:return Ae(r,r.stateNode.containerInfo),c=r.pendingProps,a===null?r.child=rr(r,null,c,l):Zt(a,r,c,l),r.child;case 11:return $y(a,r,r.type,r.pendingProps,l);case 7:return Zt(a,r,r.pendingProps,l),r.child;case 8:return Zt(a,r,r.pendingProps.children,l),r.child;case 12:return Zt(a,r,r.pendingProps.children,l),r.child;case 10:return c=r.pendingProps,ua(r,r.type,c.value),Zt(a,r,c.children,l),r.child;case 9:return g=r.type._context,c=r.pendingProps.children,tr(r),g=Kt(g),c=c(g),r.flags|=1,Zt(a,r,c,l),r.child;case 14:return Gy(a,r,r.type,r.pendingProps,l);case 15:return Hy(a,r,r.type,r.pendingProps,l);case 19:return Qy(a,r,l);case 31:return CA(a,r,l);case 22:return zy(a,r,l,r.pendingProps);case 24:return tr(r),c=Kt(kt),a===null?(g=Id(),g===null&&(g=ct,y=Nd(),g.pooledCache=y,y.refCount++,y!==null&&(g.pooledCacheLanes|=l),g=y),r.memoizedState={parent:c,cache:g},Pd(r),ua(r,kt,g)):((a.lanes&l)!==0&&(kd(a,r),oo(r,null,null,l),io()),g=a.memoizedState,y=r.memoizedState,g.parent!==c?(g={parent:c,cache:c},r.memoizedState=g,r.lanes===0&&(r.memoizedState=r.updateQueue.baseState=g),ua(r,kt,c)):(c=y.cache,ua(r,kt,c),c!==g.cache&&Rd(r,[kt],l,!0))),Zt(a,r,r.pendingProps.children,l),r.child;case 29:throw r.pendingProps}throw Error(s(156,r.tag))}function Is(a){a.flags|=4}function gf(a,r,l,c,g){if((r=(a.mode&32)!==0)&&(r=!1),r){if(a.flags|=16777216,(g&335544128)===g)if(a.stateNode.complete)a.flags|=8192;else if(E0())a.flags|=8192;else throw ar=$l,Dd}else a.flags&=-16777217}function t0(a,r){if(r.type!=="stylesheet"||(r.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!gv(r))if(E0())a.flags|=8192;else throw ar=$l,Dd}function ru(a,r){r!==null&&(a.flags|=4),a.flags&16384&&(r=a.tag!==22?yl():536870912,a.lanes|=r,Zr|=r)}function po(a,r){if(!Je)switch(a.tailMode){case"hidden":r=a.tail;for(var l=null;r!==null;)r.alternate!==null&&(l=r),r=r.sibling;l===null?a.tail=null:l.sibling=null;break;case"collapsed":l=a.tail;for(var c=null;l!==null;)l.alternate!==null&&(c=l),l=l.sibling;c===null?r||a.tail===null?a.tail=null:a.tail.sibling=null:c.sibling=null}}function ht(a){var r=a.alternate!==null&&a.alternate.child===a.child,l=0,c=0;if(r)for(var g=a.child;g!==null;)l|=g.lanes|g.childLanes,c|=g.subtreeFlags&65011712,c|=g.flags&65011712,g.return=a,g=g.sibling;else for(g=a.child;g!==null;)l|=g.lanes|g.childLanes,c|=g.subtreeFlags,c|=g.flags,g.return=a,g=g.sibling;return a.subtreeFlags|=c,a.childLanes=l,r}function AA(a,r,l){var c=r.pendingProps;switch(bd(r),r.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ht(r),null;case 1:return ht(r),null;case 3:return l=r.stateNode,c=null,a!==null&&(c=a.memoizedState.cache),r.memoizedState.cache!==c&&(r.flags|=2048),Es(kt),Fe(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(a===null||a.child===null)&&(Or(r)?Is(r):a===null||a.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,Td())),ht(r),null;case 26:var g=r.type,y=r.memoizedState;return a===null?(Is(r),y!==null?(ht(r),t0(r,y)):(ht(r),gf(r,g,null,c,l))):y?y!==a.memoizedState?(Is(r),ht(r),t0(r,y)):(ht(r),r.flags&=-16777217):(a=a.memoizedProps,a!==c&&Is(r),ht(r),gf(r,g,a,c,l)),null;case 27:if(yt(r),l=ue.current,g=r.type,a!==null&&r.stateNode!=null)a.memoizedProps!==c&&Is(r);else{if(!c){if(r.stateNode===null)throw Error(s(166));return ht(r),null}a=re.current,Or(r)?kg(r):(a=lv(g,c,l),r.stateNode=a,Is(r))}return ht(r),null;case 5:if(yt(r),g=r.type,a!==null&&r.stateNode!=null)a.memoizedProps!==c&&Is(r);else{if(!c){if(r.stateNode===null)throw Error(s(166));return ht(r),null}if(y=re.current,Or(r))kg(r);else{var b=Su(ue.current);switch(y){case 1:y=b.createElementNS("http://www.w3.org/2000/svg",g);break;case 2:y=b.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;default:switch(g){case"svg":y=b.createElementNS("http://www.w3.org/2000/svg",g);break;case"math":y=b.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;case"script":y=b.createElement("div"),y.innerHTML="<script><\/script>",y=y.removeChild(y.firstChild);break;case"select":y=typeof c.is=="string"?b.createElement("select",{is:c.is}):b.createElement("select"),c.multiple?y.multiple=!0:c.size&&(y.size=c.size);break;default:y=typeof c.is=="string"?b.createElement(g,{is:c.is}):b.createElement(g)}}y[mt]=r,y[Vt]=c;e:for(b=r.child;b!==null;){if(b.tag===5||b.tag===6)y.appendChild(b.stateNode);else if(b.tag!==4&&b.tag!==27&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===r)break e;for(;b.sibling===null;){if(b.return===null||b.return===r)break e;b=b.return}b.sibling.return=b.return,b=b.sibling}r.stateNode=y;e:switch(Xt(y,g,c),g){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}c&&Is(r)}}return ht(r),gf(r,r.type,a===null?null:a.memoizedProps,r.pendingProps,l),null;case 6:if(a&&r.stateNode!=null)a.memoizedProps!==c&&Is(r);else{if(typeof c!="string"&&r.stateNode===null)throw Error(s(166));if(a=ue.current,Or(r)){if(a=r.stateNode,l=r.memoizedProps,c=null,g=Yt,g!==null)switch(g.tag){case 27:case 5:c=g.memoizedProps}a[mt]=r,a=!!(a.nodeValue===l||c!==null&&c.suppressHydrationWarning===!0||X0(a.nodeValue,l)),a||la(r,!0)}else a=Su(a).createTextNode(c),a[mt]=r,r.stateNode=a}return ht(r),null;case 31:if(l=r.memoizedState,a===null||a.memoizedState!==null){if(c=Or(r),l!==null){if(a===null){if(!c)throw Error(s(318));if(a=r.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(557));a[mt]=r}else Qa(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;ht(r),a=!1}else l=Td(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=l),a=!0;if(!a)return r.flags&256?(_n(r),r):(_n(r),null);if((r.flags&128)!==0)throw Error(s(558))}return ht(r),null;case 13:if(c=r.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(g=Or(r),c!==null&&c.dehydrated!==null){if(a===null){if(!g)throw Error(s(318));if(g=r.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(s(317));g[mt]=r}else Qa(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;ht(r),g=!1}else g=Td(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=g),g=!0;if(!g)return r.flags&256?(_n(r),r):(_n(r),null)}return _n(r),(r.flags&128)!==0?(r.lanes=l,r):(l=c!==null,a=a!==null&&a.memoizedState!==null,l&&(c=r.child,g=null,c.alternate!==null&&c.alternate.memoizedState!==null&&c.alternate.memoizedState.cachePool!==null&&(g=c.alternate.memoizedState.cachePool.pool),y=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(y=c.memoizedState.cachePool.pool),y!==g&&(c.flags|=2048)),l!==a&&l&&(r.child.flags|=8192),ru(r,r.updateQueue),ht(r),null);case 4:return Fe(),a===null&&Bf(r.stateNode.containerInfo),ht(r),null;case 10:return Es(r.type),ht(r),null;case 19:if(q(Rt),c=r.memoizedState,c===null)return ht(r),null;if(g=(r.flags&128)!==0,y=c.rendering,y===null)if(g)po(c,!1);else{if(At!==0||a!==null&&(a.flags&128)!==0)for(a=r.child;a!==null;){if(y=jl(a),y!==null){for(r.flags|=128,po(c,!1),a=y.updateQueue,r.updateQueue=a,ru(r,a),r.subtreeFlags=0,a=l,l=r.child;l!==null;)Ng(l,a),l=l.sibling;return te(Rt,Rt.current&1|2),Je&&Ts(r,c.treeForkCount),r.child}a=a.sibling}c.tail!==null&&_t()>cu&&(r.flags|=128,g=!0,po(c,!1),r.lanes=4194304)}else{if(!g)if(a=jl(y),a!==null){if(r.flags|=128,g=!0,a=a.updateQueue,r.updateQueue=a,ru(r,a),po(c,!0),c.tail===null&&c.tailMode==="hidden"&&!y.alternate&&!Je)return ht(r),null}else 2*_t()-c.renderingStartTime>cu&&l!==536870912&&(r.flags|=128,g=!0,po(c,!1),r.lanes=4194304);c.isBackwards?(y.sibling=r.child,r.child=y):(a=c.last,a!==null?a.sibling=y:r.child=y,c.last=y)}return c.tail!==null?(a=c.tail,c.rendering=a,c.tail=a.sibling,c.renderingStartTime=_t(),a.sibling=null,l=Rt.current,te(Rt,g?l&1|2:l&1),Je&&Ts(r,c.treeForkCount),a):(ht(r),null);case 22:case 23:return _n(r),Bd(),c=r.memoizedState!==null,a!==null?a.memoizedState!==null!==c&&(r.flags|=8192):c&&(r.flags|=8192),c?(l&536870912)!==0&&(r.flags&128)===0&&(ht(r),r.subtreeFlags&6&&(r.flags|=8192)):ht(r),l=r.updateQueue,l!==null&&ru(r,l.retryQueue),l=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(l=a.memoizedState.cachePool.pool),c=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),c!==l&&(r.flags|=2048),a!==null&&q(nr),null;case 24:return l=null,a!==null&&(l=a.memoizedState.cache),r.memoizedState.cache!==l&&(r.flags|=2048),Es(kt),ht(r),null;case 25:return null;case 30:return null}throw Error(s(156,r.tag))}function EA(a,r){switch(bd(r),r.tag){case 1:return a=r.flags,a&65536?(r.flags=a&-65537|128,r):null;case 3:return Es(kt),Fe(),a=r.flags,(a&65536)!==0&&(a&128)===0?(r.flags=a&-65537|128,r):null;case 26:case 27:case 5:return yt(r),null;case 31:if(r.memoizedState!==null){if(_n(r),r.alternate===null)throw Error(s(340));Qa()}return a=r.flags,a&65536?(r.flags=a&-65537|128,r):null;case 13:if(_n(r),a=r.memoizedState,a!==null&&a.dehydrated!==null){if(r.alternate===null)throw Error(s(340));Qa()}return a=r.flags,a&65536?(r.flags=a&-65537|128,r):null;case 19:return q(Rt),null;case 4:return Fe(),null;case 10:return Es(r.type),null;case 22:case 23:return _n(r),Bd(),a!==null&&q(nr),a=r.flags,a&65536?(r.flags=a&-65537|128,r):null;case 24:return Es(kt),null;case 25:return null;default:return null}}function n0(a,r){switch(bd(r),r.tag){case 3:Es(kt),Fe();break;case 26:case 27:case 5:yt(r);break;case 4:Fe();break;case 31:r.memoizedState!==null&&_n(r);break;case 13:_n(r);break;case 19:q(Rt);break;case 10:Es(r.type);break;case 22:case 23:_n(r),Bd(),a!==null&&q(nr);break;case 24:Es(kt)}}function ho(a,r){try{var l=r.updateQueue,c=l!==null?l.lastEffect:null;if(c!==null){var g=c.next;l=g;do{if((l.tag&a)===a){c=void 0;var y=l.create,b=l.inst;c=y(),b.destroy=c}l=l.next}while(l!==g)}}catch(A){at(r,r.return,A)}}function ha(a,r,l){try{var c=r.updateQueue,g=c!==null?c.lastEffect:null;if(g!==null){var y=g.next;c=y;do{if((c.tag&a)===a){var b=c.inst,A=b.destroy;if(A!==void 0){b.destroy=void 0,g=r;var U=l,K=A;try{K()}catch(se){at(g,U,se)}}}c=c.next}while(c!==y)}}catch(se){at(r,r.return,se)}}function s0(a){var r=a.updateQueue;if(r!==null){var l=a.stateNode;try{Jg(r,l)}catch(c){at(a,a.return,c)}}}function a0(a,r,l){l.props=or(a.type,a.memoizedProps),l.state=a.memoizedState;try{l.componentWillUnmount()}catch(c){at(a,r,c)}}function go(a,r){try{var l=a.ref;if(l!==null){switch(a.tag){case 26:case 27:case 5:var c=a.stateNode;break;case 30:c=a.stateNode;break;default:c=a.stateNode}typeof l=="function"?a.refCleanup=l(c):l.current=c}}catch(g){at(a,r,g)}}function ls(a,r){var l=a.ref,c=a.refCleanup;if(l!==null)if(typeof c=="function")try{c()}catch(g){at(a,r,g)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(g){at(a,r,g)}else l.current=null}function r0(a){var r=a.type,l=a.memoizedProps,c=a.stateNode;try{e:switch(r){case"button":case"input":case"select":case"textarea":l.autoFocus&&c.focus();break e;case"img":l.src?c.src=l.src:l.srcSet&&(c.srcset=l.srcSet)}}catch(g){at(a,a.return,g)}}function yf(a,r,l){try{var c=a.stateNode;KA(c,a.type,l,r),c[Vt]=r}catch(g){at(a,a.return,g)}}function i0(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&_a(a.type)||a.tag===4}function vf(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||i0(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&_a(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function xf(a,r,l){var c=a.tag;if(c===5||c===6)a=a.stateNode,r?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(a,r):(r=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,r.appendChild(a),l=l._reactRootContainer,l!=null||r.onclick!==null||(r.onclick=_s));else if(c!==4&&(c===27&&_a(a.type)&&(l=a.stateNode,r=null),a=a.child,a!==null))for(xf(a,r,l),a=a.sibling;a!==null;)xf(a,r,l),a=a.sibling}function iu(a,r,l){var c=a.tag;if(c===5||c===6)a=a.stateNode,r?l.insertBefore(a,r):l.appendChild(a);else if(c!==4&&(c===27&&_a(a.type)&&(l=a.stateNode),a=a.child,a!==null))for(iu(a,r,l),a=a.sibling;a!==null;)iu(a,r,l),a=a.sibling}function o0(a){var r=a.stateNode,l=a.memoizedProps;try{for(var c=a.type,g=r.attributes;g.length;)r.removeAttributeNode(g[0]);Xt(r,c,l),r[mt]=a,r[Vt]=l}catch(y){at(a,a.return,y)}}var Ds=!1,Ot=!1,Sf=!1,l0=typeof WeakSet=="function"?WeakSet:Set,zt=null;function RA(a,r){if(a=a.containerInfo,Ff=Eu,a=Sg(a),fd(a)){if("selectionStart"in a)var l={start:a.selectionStart,end:a.selectionEnd};else e:{l=(l=a.ownerDocument)&&l.defaultView||window;var c=l.getSelection&&l.getSelection();if(c&&c.rangeCount!==0){l=c.anchorNode;var g=c.anchorOffset,y=c.focusNode;c=c.focusOffset;try{l.nodeType,y.nodeType}catch{l=null;break e}var b=0,A=-1,U=-1,K=0,se=0,oe=a,W=null;t:for(;;){for(var ee;oe!==l||g!==0&&oe.nodeType!==3||(A=b+g),oe!==y||c!==0&&oe.nodeType!==3||(U=b+c),oe.nodeType===3&&(b+=oe.nodeValue.length),(ee=oe.firstChild)!==null;)W=oe,oe=ee;for(;;){if(oe===a)break t;if(W===l&&++K===g&&(A=b),W===y&&++se===c&&(U=b),(ee=oe.nextSibling)!==null)break;oe=W,W=oe.parentNode}oe=ee}l=A===-1||U===-1?null:{start:A,end:U}}else l=null}l=l||{start:0,end:0}}else l=null;for($f={focusedElem:a,selectionRange:l},Eu=!1,zt=r;zt!==null;)if(r=zt,a=r.child,(r.subtreeFlags&1028)!==0&&a!==null)a.return=r,zt=a;else for(;zt!==null;){switch(r=zt,y=r.alternate,a=r.flags,r.tag){case 0:if((a&4)!==0&&(a=r.updateQueue,a=a!==null?a.events:null,a!==null))for(l=0;l<a.length;l++)g=a[l],g.ref.impl=g.nextImpl;break;case 11:case 15:break;case 1:if((a&1024)!==0&&y!==null){a=void 0,l=r,g=y.memoizedProps,y=y.memoizedState,c=l.stateNode;try{var xe=or(l.type,g);a=c.getSnapshotBeforeUpdate(xe,y),c.__reactInternalSnapshotBeforeUpdate=a}catch(Ee){at(l,l.return,Ee)}}break;case 3:if((a&1024)!==0){if(a=r.stateNode.containerInfo,l=a.nodeType,l===9)zf(a);else if(l===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":zf(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(s(163))}if(a=r.sibling,a!==null){a.return=r.return,zt=a;break}zt=r.return}}function u0(a,r,l){var c=l.flags;switch(l.tag){case 0:case 11:case 15:ks(a,l),c&4&&ho(5,l);break;case 1:if(ks(a,l),c&4)if(a=l.stateNode,r===null)try{a.componentDidMount()}catch(b){at(l,l.return,b)}else{var g=or(l.type,r.memoizedProps);r=r.memoizedState;try{a.componentDidUpdate(g,r,a.__reactInternalSnapshotBeforeUpdate)}catch(b){at(l,l.return,b)}}c&64&&s0(l),c&512&&go(l,l.return);break;case 3:if(ks(a,l),c&64&&(a=l.updateQueue,a!==null)){if(r=null,l.child!==null)switch(l.child.tag){case 27:case 5:r=l.child.stateNode;break;case 1:r=l.child.stateNode}try{Jg(a,r)}catch(b){at(l,l.return,b)}}break;case 27:r===null&&c&4&&o0(l);case 26:case 5:ks(a,l),r===null&&c&4&&r0(l),c&512&&go(l,l.return);break;case 12:ks(a,l);break;case 31:ks(a,l),c&4&&f0(a,l);break;case 13:ks(a,l),c&4&&m0(a,l),c&64&&(a=l.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(l=OA.bind(null,l),sE(a,l))));break;case 22:if(c=l.memoizedState!==null||Ds,!c){r=r!==null&&r.memoizedState!==null||Ot,g=Ds;var y=Ot;Ds=c,(Ot=r)&&!y?Ls(a,l,(l.subtreeFlags&8772)!==0):ks(a,l),Ds=g,Ot=y}break;case 30:break;default:ks(a,l)}}function c0(a){var r=a.alternate;r!==null&&(a.alternate=null,c0(r)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(r=a.stateNode,r!==null&&Ja(r)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var vt=null,dn=!1;function Ps(a,r,l){for(l=l.child;l!==null;)d0(a,r,l),l=l.sibling}function d0(a,r,l){if(bt&&typeof bt.onCommitFiberUnmount=="function")try{bt.onCommitFiberUnmount(ln,l)}catch{}switch(l.tag){case 26:Ot||ls(l,r),Ps(a,r,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:Ot||ls(l,r);var c=vt,g=dn;_a(l.type)&&(vt=l.stateNode,dn=!1),Ps(a,r,l),To(l.stateNode),vt=c,dn=g;break;case 5:Ot||ls(l,r);case 6:if(c=vt,g=dn,vt=null,Ps(a,r,l),vt=c,dn=g,vt!==null)if(dn)try{(vt.nodeType===9?vt.body:vt.nodeName==="HTML"?vt.ownerDocument.body:vt).removeChild(l.stateNode)}catch(y){at(l,r,y)}else try{vt.removeChild(l.stateNode)}catch(y){at(l,r,y)}break;case 18:vt!==null&&(dn?(a=vt,sv(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,l.stateNode),ai(a)):sv(vt,l.stateNode));break;case 4:c=vt,g=dn,vt=l.stateNode.containerInfo,dn=!0,Ps(a,r,l),vt=c,dn=g;break;case 0:case 11:case 14:case 15:ha(2,l,r),Ot||ha(4,l,r),Ps(a,r,l);break;case 1:Ot||(ls(l,r),c=l.stateNode,typeof c.componentWillUnmount=="function"&&a0(l,r,c)),Ps(a,r,l);break;case 21:Ps(a,r,l);break;case 22:Ot=(c=Ot)||l.memoizedState!==null,Ps(a,r,l),Ot=c;break;default:Ps(a,r,l)}}function f0(a,r){if(r.memoizedState===null&&(a=r.alternate,a!==null&&(a=a.memoizedState,a!==null))){a=a.dehydrated;try{ai(a)}catch(l){at(r,r.return,l)}}}function m0(a,r){if(r.memoizedState===null&&(a=r.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{ai(a)}catch(l){at(r,r.return,l)}}function NA(a){switch(a.tag){case 31:case 13:case 19:var r=a.stateNode;return r===null&&(r=a.stateNode=new l0),r;case 22:return a=a.stateNode,r=a._retryCache,r===null&&(r=a._retryCache=new l0),r;default:throw Error(s(435,a.tag))}}function ou(a,r){var l=NA(a);r.forEach(function(c){if(!l.has(c)){l.add(c);var g=BA.bind(null,a,c);c.then(g,g)}})}function fn(a,r){var l=r.deletions;if(l!==null)for(var c=0;c<l.length;c++){var g=l[c],y=a,b=r,A=b;e:for(;A!==null;){switch(A.tag){case 27:if(_a(A.type)){vt=A.stateNode,dn=!1;break e}break;case 5:vt=A.stateNode,dn=!1;break e;case 3:case 4:vt=A.stateNode.containerInfo,dn=!0;break e}A=A.return}if(vt===null)throw Error(s(160));d0(y,b,g),vt=null,dn=!1,y=g.alternate,y!==null&&(y.return=null),g.return=null}if(r.subtreeFlags&13886)for(r=r.child;r!==null;)p0(r,a),r=r.sibling}var Qn=null;function p0(a,r){var l=a.alternate,c=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:fn(r,a),mn(a),c&4&&(ha(3,a,a.return),ho(3,a),ha(5,a,a.return));break;case 1:fn(r,a),mn(a),c&512&&(Ot||l===null||ls(l,l.return)),c&64&&Ds&&(a=a.updateQueue,a!==null&&(c=a.callbacks,c!==null&&(l=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=l===null?c:l.concat(c))));break;case 26:var g=Qn;if(fn(r,a),mn(a),c&512&&(Ot||l===null||ls(l,l.return)),c&4){var y=l!==null?l.memoizedState:null;if(c=a.memoizedState,l===null)if(c===null)if(a.stateNode===null){e:{c=a.type,l=a.memoizedProps,g=g.ownerDocument||g;t:switch(c){case"title":y=g.getElementsByTagName("title")[0],(!y||y[ea]||y[mt]||y.namespaceURI==="http://www.w3.org/2000/svg"||y.hasAttribute("itemprop"))&&(y=g.createElement(c),g.head.insertBefore(y,g.querySelector("head > title"))),Xt(y,c,l),y[mt]=a,Pt(y),c=y;break e;case"link":var b=pv("link","href",g).get(c+(l.href||""));if(b){for(var A=0;A<b.length;A++)if(y=b[A],y.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&y.getAttribute("rel")===(l.rel==null?null:l.rel)&&y.getAttribute("title")===(l.title==null?null:l.title)&&y.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){b.splice(A,1);break t}}y=g.createElement(c),Xt(y,c,l),g.head.appendChild(y);break;case"meta":if(b=pv("meta","content",g).get(c+(l.content||""))){for(A=0;A<b.length;A++)if(y=b[A],y.getAttribute("content")===(l.content==null?null:""+l.content)&&y.getAttribute("name")===(l.name==null?null:l.name)&&y.getAttribute("property")===(l.property==null?null:l.property)&&y.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&y.getAttribute("charset")===(l.charSet==null?null:l.charSet)){b.splice(A,1);break t}}y=g.createElement(c),Xt(y,c,l),g.head.appendChild(y);break;default:throw Error(s(468,c))}y[mt]=a,Pt(y),c=y}a.stateNode=c}else hv(g,a.type,a.stateNode);else a.stateNode=mv(g,c,a.memoizedProps);else y!==c?(y===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):y.count--,c===null?hv(g,a.type,a.stateNode):mv(g,c,a.memoizedProps)):c===null&&a.stateNode!==null&&yf(a,a.memoizedProps,l.memoizedProps)}break;case 27:fn(r,a),mn(a),c&512&&(Ot||l===null||ls(l,l.return)),l!==null&&c&4&&yf(a,a.memoizedProps,l.memoizedProps);break;case 5:if(fn(r,a),mn(a),c&512&&(Ot||l===null||ls(l,l.return)),a.flags&32){g=a.stateNode;try{Er(g,"")}catch(xe){at(a,a.return,xe)}}c&4&&a.stateNode!=null&&(g=a.memoizedProps,yf(a,g,l!==null?l.memoizedProps:g)),c&1024&&(Sf=!0);break;case 6:if(fn(r,a),mn(a),c&4){if(a.stateNode===null)throw Error(s(162));c=a.memoizedProps,l=a.stateNode;try{l.nodeValue=c}catch(xe){at(a,a.return,xe)}}break;case 3:if(bu=null,g=Qn,Qn=wu(r.containerInfo),fn(r,a),Qn=g,mn(a),c&4&&l!==null&&l.memoizedState.isDehydrated)try{ai(r.containerInfo)}catch(xe){at(a,a.return,xe)}Sf&&(Sf=!1,h0(a));break;case 4:c=Qn,Qn=wu(a.stateNode.containerInfo),fn(r,a),mn(a),Qn=c;break;case 12:fn(r,a),mn(a);break;case 31:fn(r,a),mn(a),c&4&&(c=a.updateQueue,c!==null&&(a.updateQueue=null,ou(a,c)));break;case 13:fn(r,a),mn(a),a.child.flags&8192&&a.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(uu=_t()),c&4&&(c=a.updateQueue,c!==null&&(a.updateQueue=null,ou(a,c)));break;case 22:g=a.memoizedState!==null;var U=l!==null&&l.memoizedState!==null,K=Ds,se=Ot;if(Ds=K||g,Ot=se||U,fn(r,a),Ot=se,Ds=K,mn(a),c&8192)e:for(r=a.stateNode,r._visibility=g?r._visibility&-2:r._visibility|1,g&&(l===null||U||Ds||Ot||lr(a)),l=null,r=a;;){if(r.tag===5||r.tag===26){if(l===null){U=l=r;try{if(y=U.stateNode,g)b=y.style,typeof b.setProperty=="function"?b.setProperty("display","none","important"):b.display="none";else{A=U.stateNode;var oe=U.memoizedProps.style,W=oe!=null&&oe.hasOwnProperty("display")?oe.display:null;A.style.display=W==null||typeof W=="boolean"?"":(""+W).trim()}}catch(xe){at(U,U.return,xe)}}}else if(r.tag===6){if(l===null){U=r;try{U.stateNode.nodeValue=g?"":U.memoizedProps}catch(xe){at(U,U.return,xe)}}}else if(r.tag===18){if(l===null){U=r;try{var ee=U.stateNode;g?av(ee,!0):av(U.stateNode,!1)}catch(xe){at(U,U.return,xe)}}}else if((r.tag!==22&&r.tag!==23||r.memoizedState===null||r===a)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===a)break e;for(;r.sibling===null;){if(r.return===null||r.return===a)break e;l===r&&(l=null),r=r.return}l===r&&(l=null),r.sibling.return=r.return,r=r.sibling}c&4&&(c=a.updateQueue,c!==null&&(l=c.retryQueue,l!==null&&(c.retryQueue=null,ou(a,l))));break;case 19:fn(r,a),mn(a),c&4&&(c=a.updateQueue,c!==null&&(a.updateQueue=null,ou(a,c)));break;case 30:break;case 21:break;default:fn(r,a),mn(a)}}function mn(a){var r=a.flags;if(r&2){try{for(var l,c=a.return;c!==null;){if(i0(c)){l=c;break}c=c.return}if(l==null)throw Error(s(160));switch(l.tag){case 27:var g=l.stateNode,y=vf(a);iu(a,y,g);break;case 5:var b=l.stateNode;l.flags&32&&(Er(b,""),l.flags&=-33);var A=vf(a);iu(a,A,b);break;case 3:case 4:var U=l.stateNode.containerInfo,K=vf(a);xf(a,K,U);break;default:throw Error(s(161))}}catch(se){at(a,a.return,se)}a.flags&=-3}r&4096&&(a.flags&=-4097)}function h0(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var r=a;h0(r),r.tag===5&&r.flags&1024&&r.stateNode.reset(),a=a.sibling}}function ks(a,r){if(r.subtreeFlags&8772)for(r=r.child;r!==null;)u0(a,r.alternate,r),r=r.sibling}function lr(a){for(a=a.child;a!==null;){var r=a;switch(r.tag){case 0:case 11:case 14:case 15:ha(4,r,r.return),lr(r);break;case 1:ls(r,r.return);var l=r.stateNode;typeof l.componentWillUnmount=="function"&&a0(r,r.return,l),lr(r);break;case 27:To(r.stateNode);case 26:case 5:ls(r,r.return),lr(r);break;case 22:r.memoizedState===null&&lr(r);break;case 30:lr(r);break;default:lr(r)}a=a.sibling}}function Ls(a,r,l){for(l=l&&(r.subtreeFlags&8772)!==0,r=r.child;r!==null;){var c=r.alternate,g=a,y=r,b=y.flags;switch(y.tag){case 0:case 11:case 15:Ls(g,y,l),ho(4,y);break;case 1:if(Ls(g,y,l),c=y,g=c.stateNode,typeof g.componentDidMount=="function")try{g.componentDidMount()}catch(K){at(c,c.return,K)}if(c=y,g=c.updateQueue,g!==null){var A=c.stateNode;try{var U=g.shared.hiddenCallbacks;if(U!==null)for(g.shared.hiddenCallbacks=null,g=0;g<U.length;g++)jg(U[g],A)}catch(K){at(c,c.return,K)}}l&&b&64&&s0(y),go(y,y.return);break;case 27:o0(y);case 26:case 5:Ls(g,y,l),l&&c===null&&b&4&&r0(y),go(y,y.return);break;case 12:Ls(g,y,l);break;case 31:Ls(g,y,l),l&&b&4&&f0(g,y);break;case 13:Ls(g,y,l),l&&b&4&&m0(g,y);break;case 22:y.memoizedState===null&&Ls(g,y,l),go(y,y.return);break;case 30:break;default:Ls(g,y,l)}r=r.sibling}}function wf(a,r){var l=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(l=a.memoizedState.cachePool.pool),a=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(a=r.memoizedState.cachePool.pool),a!==l&&(a!=null&&a.refCount++,l!=null&&to(l))}function _f(a,r){a=null,r.alternate!==null&&(a=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==a&&(r.refCount++,a!=null&&to(a))}function es(a,r,l,c){if(r.subtreeFlags&10256)for(r=r.child;r!==null;)g0(a,r,l,c),r=r.sibling}function g0(a,r,l,c){var g=r.flags;switch(r.tag){case 0:case 11:case 15:es(a,r,l,c),g&2048&&ho(9,r);break;case 1:es(a,r,l,c);break;case 3:es(a,r,l,c),g&2048&&(a=null,r.alternate!==null&&(a=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==a&&(r.refCount++,a!=null&&to(a)));break;case 12:if(g&2048){es(a,r,l,c),a=r.stateNode;try{var y=r.memoizedProps,b=y.id,A=y.onPostCommit;typeof A=="function"&&A(b,r.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(U){at(r,r.return,U)}}else es(a,r,l,c);break;case 31:es(a,r,l,c);break;case 13:es(a,r,l,c);break;case 23:break;case 22:y=r.stateNode,b=r.alternate,r.memoizedState!==null?y._visibility&2?es(a,r,l,c):yo(a,r):y._visibility&2?es(a,r,l,c):(y._visibility|=2,Jr(a,r,l,c,(r.subtreeFlags&10256)!==0||!1)),g&2048&&wf(b,r);break;case 24:es(a,r,l,c),g&2048&&_f(r.alternate,r);break;default:es(a,r,l,c)}}function Jr(a,r,l,c,g){for(g=g&&((r.subtreeFlags&10256)!==0||!1),r=r.child;r!==null;){var y=a,b=r,A=l,U=c,K=b.flags;switch(b.tag){case 0:case 11:case 15:Jr(y,b,A,U,g),ho(8,b);break;case 23:break;case 22:var se=b.stateNode;b.memoizedState!==null?se._visibility&2?Jr(y,b,A,U,g):yo(y,b):(se._visibility|=2,Jr(y,b,A,U,g)),g&&K&2048&&wf(b.alternate,b);break;case 24:Jr(y,b,A,U,g),g&&K&2048&&_f(b.alternate,b);break;default:Jr(y,b,A,U,g)}r=r.sibling}}function yo(a,r){if(r.subtreeFlags&10256)for(r=r.child;r!==null;){var l=a,c=r,g=c.flags;switch(c.tag){case 22:yo(l,c),g&2048&&wf(c.alternate,c);break;case 24:yo(l,c),g&2048&&_f(c.alternate,c);break;default:yo(l,c)}r=r.sibling}}var vo=8192;function Yr(a,r,l){if(a.subtreeFlags&vo)for(a=a.child;a!==null;)y0(a,r,l),a=a.sibling}function y0(a,r,l){switch(a.tag){case 26:Yr(a,r,l),a.flags&vo&&a.memoizedState!==null&&hE(l,Qn,a.memoizedState,a.memoizedProps);break;case 5:Yr(a,r,l);break;case 3:case 4:var c=Qn;Qn=wu(a.stateNode.containerInfo),Yr(a,r,l),Qn=c;break;case 22:a.memoizedState===null&&(c=a.alternate,c!==null&&c.memoizedState!==null?(c=vo,vo=16777216,Yr(a,r,l),vo=c):Yr(a,r,l));break;default:Yr(a,r,l)}}function v0(a){var r=a.alternate;if(r!==null&&(a=r.child,a!==null)){r.child=null;do r=a.sibling,a.sibling=null,a=r;while(a!==null)}}function xo(a){var r=a.deletions;if((a.flags&16)!==0){if(r!==null)for(var l=0;l<r.length;l++){var c=r[l];zt=c,S0(c,a)}v0(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)x0(a),a=a.sibling}function x0(a){switch(a.tag){case 0:case 11:case 15:xo(a),a.flags&2048&&ha(9,a,a.return);break;case 3:xo(a);break;case 12:xo(a);break;case 22:var r=a.stateNode;a.memoizedState!==null&&r._visibility&2&&(a.return===null||a.return.tag!==13)?(r._visibility&=-3,lu(a)):xo(a);break;default:xo(a)}}function lu(a){var r=a.deletions;if((a.flags&16)!==0){if(r!==null)for(var l=0;l<r.length;l++){var c=r[l];zt=c,S0(c,a)}v0(a)}for(a=a.child;a!==null;){switch(r=a,r.tag){case 0:case 11:case 15:ha(8,r,r.return),lu(r);break;case 22:l=r.stateNode,l._visibility&2&&(l._visibility&=-3,lu(r));break;default:lu(r)}a=a.sibling}}function S0(a,r){for(;zt!==null;){var l=zt;switch(l.tag){case 0:case 11:case 15:ha(8,l,r);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var c=l.memoizedState.cachePool.pool;c!=null&&c.refCount++}break;case 24:to(l.memoizedState.cache)}if(c=l.child,c!==null)c.return=l,zt=c;else e:for(l=a;zt!==null;){c=zt;var g=c.sibling,y=c.return;if(c0(c),c===l){zt=null;break e}if(g!==null){g.return=y,zt=g;break e}zt=y}}}var MA={getCacheForType:function(a){var r=Kt(kt),l=r.data.get(a);return l===void 0&&(l=a(),r.data.set(a,l)),l},cacheSignal:function(){return Kt(kt).controller.signal}},IA=typeof WeakMap=="function"?WeakMap:Map,tt=0,ct=null,Ge=null,ze=0,st=0,bn=null,ga=!1,Kr=!1,bf=!1,Us=0,At=0,ya=0,ur=0,Cf=0,Cn=0,Zr=0,So=null,pn=null,Tf=!1,uu=0,w0=0,cu=1/0,du=null,va=null,qt=0,xa=null,Xr=null,Os=0,Af=0,Ef=null,_0=null,wo=0,Rf=null;function Tn(){return(tt&2)!==0&&ze!==0?ze&-ze:T.T!==null?kf():fe()}function b0(){if(Cn===0)if((ze&536870912)===0||Je){var a=_r;_r<<=1,(_r&3932160)===0&&(_r=262144),Cn=a}else Cn=536870912;return a=wn.current,a!==null&&(a.flags|=32),Cn}function hn(a,r,l){(a===ct&&(st===2||st===9)||a.cancelPendingCommit!==null)&&(Wr(a,0),Sa(a,ze,Cn,!1)),za(a,l),((tt&2)===0||a!==ct)&&(a===ct&&((tt&2)===0&&(ur|=l),At===4&&Sa(a,ze,Cn,!1)),us(a))}function C0(a,r,l){if((tt&6)!==0)throw Error(s(327));var c=!l&&(r&127)===0&&(r&a.expiredLanes)===0||Ha(a,r),g=c?kA(a,r):Mf(a,r,!0),y=c;do{if(g===0){Kr&&!c&&Sa(a,r,0,!1);break}else{if(l=a.current.alternate,y&&!DA(l)){g=Mf(a,r,!1),y=!1;continue}if(g===2){if(y=r,a.errorRecoveryDisabledLanes&y)var b=0;else b=a.pendingLanes&-536870913,b=b!==0?b:b&536870912?536870912:0;if(b!==0){r=b;e:{var A=a;g=So;var U=A.current.memoizedState.isDehydrated;if(U&&(Wr(A,b).flags|=256),b=Mf(A,b,!1),b!==2){if(bf&&!U){A.errorRecoveryDisabledLanes|=y,ur|=y,g=4;break e}y=pn,pn=g,y!==null&&(pn===null?pn=y:pn.push.apply(pn,y))}g=b}if(y=!1,g!==2)continue}}if(g===1){Wr(a,0),Sa(a,r,0,!0);break}e:{switch(c=a,y=g,y){case 0:case 1:throw Error(s(345));case 4:if((r&4194048)!==r)break;case 6:Sa(c,r,Cn,!ga);break e;case 2:pn=null;break;case 3:case 5:break;default:throw Error(s(329))}if((r&62914560)===r&&(g=uu+300-_t(),10<g)){if(Sa(c,r,Cn,!ga),br(c,0,!0)!==0)break e;Os=r,c.timeoutHandle=tv(T0.bind(null,c,l,pn,du,Tf,r,Cn,ur,Zr,ga,y,"Throttled",-0,0),g);break e}T0(c,l,pn,du,Tf,r,Cn,ur,Zr,ga,y,null,-0,0)}}break}while(!0);us(a)}function T0(a,r,l,c,g,y,b,A,U,K,se,oe,W,ee){if(a.timeoutHandle=-1,oe=r.subtreeFlags,oe&8192||(oe&16785408)===16785408){oe={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:_s},y0(r,y,oe);var xe=(y&62914560)===y?uu-_t():(y&4194048)===y?w0-_t():0;if(xe=gE(oe,xe),xe!==null){Os=y,a.cancelPendingCommit=xe(P0.bind(null,a,r,y,l,c,g,b,A,U,se,oe,null,W,ee)),Sa(a,y,b,!K);return}}P0(a,r,y,l,c,g,b,A,U)}function DA(a){for(var r=a;;){var l=r.tag;if((l===0||l===11||l===15)&&r.flags&16384&&(l=r.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var c=0;c<l.length;c++){var g=l[c],y=g.getSnapshot;g=g.value;try{if(!xn(y(),g))return!1}catch{return!1}}if(l=r.child,r.subtreeFlags&16384&&l!==null)l.return=r,r=l;else{if(r===a)break;for(;r.sibling===null;){if(r.return===null||r.return===a)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function Sa(a,r,l,c){r&=~Cf,r&=~ur,a.suspendedLanes|=r,a.pingedLanes&=~r,c&&(a.warmLanes|=r),c=a.expirationTimes;for(var g=r;0<g;){var y=31-Ht(g),b=1<<y;c[y]=-1,g&=~b}l!==0&&$i(a,l,r)}function fu(){return(tt&6)===0?(_o(0),!1):!0}function Nf(){if(Ge!==null){if(st===0)var a=Ge.return;else a=Ge,As=er=null,Hd(a),$r=null,so=0,a=Ge;for(;a!==null;)n0(a.alternate,a),a=a.return;Ge=null}}function Wr(a,r){var l=a.timeoutHandle;l!==-1&&(a.timeoutHandle=-1,WA(l)),l=a.cancelPendingCommit,l!==null&&(a.cancelPendingCommit=null,l()),Os=0,Nf(),ct=a,Ge=l=Cs(a.current,null),ze=r,st=0,bn=null,ga=!1,Kr=Ha(a,r),bf=!1,Zr=Cn=Cf=ur=ya=At=0,pn=So=null,Tf=!1,(r&8)!==0&&(r|=r&32);var c=a.entangledLanes;if(c!==0)for(a=a.entanglements,c&=r;0<c;){var g=31-Ht(c),y=1<<g;r|=a[g],c&=~y}return Us=r,Pl(),l}function A0(a,r){Be=null,T.H=fo,r===Fr||r===Fl?(r=$g(),st=3):r===Dd?(r=$g(),st=4):st=r===of?8:r!==null&&typeof r=="object"&&typeof r.then=="function"?6:1,bn=r,Ge===null&&(At=1,tu(a,Un(r,a.current)))}function E0(){var a=wn.current;return a===null?!0:(ze&4194048)===ze?qn===null:(ze&62914560)===ze||(ze&536870912)!==0?a===qn:!1}function R0(){var a=T.H;return T.H=fo,a===null?fo:a}function N0(){var a=T.A;return T.A=MA,a}function mu(){At=4,ga||(ze&4194048)!==ze&&wn.current!==null||(Kr=!0),(ya&134217727)===0&&(ur&134217727)===0||ct===null||Sa(ct,ze,Cn,!1)}function Mf(a,r,l){var c=tt;tt|=2;var g=R0(),y=N0();(ct!==a||ze!==r)&&(du=null,Wr(a,r)),r=!1;var b=At;e:do try{if(st!==0&&Ge!==null){var A=Ge,U=bn;switch(st){case 8:Nf(),b=6;break e;case 3:case 2:case 9:case 6:wn.current===null&&(r=!0);var K=st;if(st=0,bn=null,Qr(a,A,U,K),l&&Kr){b=0;break e}break;default:K=st,st=0,bn=null,Qr(a,A,U,K)}}PA(),b=At;break}catch(se){A0(a,se)}while(!0);return r&&a.shellSuspendCounter++,As=er=null,tt=c,T.H=g,T.A=y,Ge===null&&(ct=null,ze=0,Pl()),b}function PA(){for(;Ge!==null;)M0(Ge)}function kA(a,r){var l=tt;tt|=2;var c=R0(),g=N0();ct!==a||ze!==r?(du=null,cu=_t()+500,Wr(a,r)):Kr=Ha(a,r);e:do try{if(st!==0&&Ge!==null){r=Ge;var y=bn;t:switch(st){case 1:st=0,bn=null,Qr(a,r,y,1);break;case 2:case 9:if(qg(y)){st=0,bn=null,I0(r);break}r=function(){st!==2&&st!==9||ct!==a||(st=7),us(a)},y.then(r,r);break e;case 3:st=7;break e;case 4:st=5;break e;case 7:qg(y)?(st=0,bn=null,I0(r)):(st=0,bn=null,Qr(a,r,y,7));break;case 5:var b=null;switch(Ge.tag){case 26:b=Ge.memoizedState;case 5:case 27:var A=Ge;if(b?gv(b):A.stateNode.complete){st=0,bn=null;var U=A.sibling;if(U!==null)Ge=U;else{var K=A.return;K!==null?(Ge=K,pu(K)):Ge=null}break t}}st=0,bn=null,Qr(a,r,y,5);break;case 6:st=0,bn=null,Qr(a,r,y,6);break;case 8:Nf(),At=6;break e;default:throw Error(s(462))}}LA();break}catch(se){A0(a,se)}while(!0);return As=er=null,T.H=c,T.A=g,tt=l,Ge!==null?0:(ct=null,ze=0,Pl(),At)}function LA(){for(;Ge!==null&&!dt();)M0(Ge)}function M0(a){var r=e0(a.alternate,a,Us);a.memoizedProps=a.pendingProps,r===null?pu(a):Ge=r}function I0(a){var r=a,l=r.alternate;switch(r.tag){case 15:case 0:r=Yy(l,r,r.pendingProps,r.type,void 0,ze);break;case 11:r=Yy(l,r,r.pendingProps,r.type.render,r.ref,ze);break;case 5:Hd(r);default:n0(l,r),r=Ge=Ng(r,Us),r=e0(l,r,Us)}a.memoizedProps=a.pendingProps,r===null?pu(a):Ge=r}function Qr(a,r,l,c){As=er=null,Hd(r),$r=null,so=0;var g=r.return;try{if(bA(a,g,r,l,ze)){At=1,tu(a,Un(l,a.current)),Ge=null;return}}catch(y){if(g!==null)throw Ge=g,y;At=1,tu(a,Un(l,a.current)),Ge=null;return}r.flags&32768?(Je||c===1?a=!0:Kr||(ze&536870912)!==0?a=!1:(ga=a=!0,(c===2||c===9||c===3||c===6)&&(c=wn.current,c!==null&&c.tag===13&&(c.flags|=16384))),D0(r,a)):pu(r)}function pu(a){var r=a;do{if((r.flags&32768)!==0){D0(r,ga);return}a=r.return;var l=AA(r.alternate,r,Us);if(l!==null){Ge=l;return}if(r=r.sibling,r!==null){Ge=r;return}Ge=r=a}while(r!==null);At===0&&(At=5)}function D0(a,r){do{var l=EA(a.alternate,a);if(l!==null){l.flags&=32767,Ge=l;return}if(l=a.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!r&&(a=a.sibling,a!==null)){Ge=a;return}Ge=a=l}while(a!==null);At=6,Ge=null}function P0(a,r,l,c,g,y,b,A,U){a.cancelPendingCommit=null;do hu();while(qt!==0);if((tt&6)!==0)throw Error(s(327));if(r!==null){if(r===a.current)throw Error(s(177));if(y=r.lanes|r.childLanes,y|=yd,Kc(a,l,y,b,A,U),a===ct&&(Ge=ct=null,ze=0),Xr=r,xa=a,Os=l,Af=y,Ef=g,_0=c,(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,VA(on,function(){return B0(),null})):(a.callbackNode=null,a.callbackPriority=0),c=(r.flags&13878)!==0,(r.subtreeFlags&13878)!==0||c){c=T.T,T.T=null,g=R.p,R.p=2,b=tt,tt|=4;try{RA(a,r,l)}finally{tt=b,R.p=g,T.T=c}}qt=1,k0(),L0(),U0()}}function k0(){if(qt===1){qt=0;var a=xa,r=Xr,l=(r.flags&13878)!==0;if((r.subtreeFlags&13878)!==0||l){l=T.T,T.T=null;var c=R.p;R.p=2;var g=tt;tt|=4;try{p0(r,a);var y=$f,b=Sg(a.containerInfo),A=y.focusedElem,U=y.selectionRange;if(b!==A&&A&&A.ownerDocument&&xg(A.ownerDocument.documentElement,A)){if(U!==null&&fd(A)){var K=U.start,se=U.end;if(se===void 0&&(se=K),"selectionStart"in A)A.selectionStart=K,A.selectionEnd=Math.min(se,A.value.length);else{var oe=A.ownerDocument||document,W=oe&&oe.defaultView||window;if(W.getSelection){var ee=W.getSelection(),xe=A.textContent.length,Ee=Math.min(U.start,xe),ot=U.end===void 0?Ee:Math.min(U.end,xe);!ee.extend&&Ee>ot&&(b=ot,ot=Ee,Ee=b);var $=vg(A,Ee),O=vg(A,ot);if($&&O&&(ee.rangeCount!==1||ee.anchorNode!==$.node||ee.anchorOffset!==$.offset||ee.focusNode!==O.node||ee.focusOffset!==O.offset)){var Y=oe.createRange();Y.setStart($.node,$.offset),ee.removeAllRanges(),Ee>ot?(ee.addRange(Y),ee.extend(O.node,O.offset)):(Y.setEnd(O.node,O.offset),ee.addRange(Y))}}}}for(oe=[],ee=A;ee=ee.parentNode;)ee.nodeType===1&&oe.push({element:ee,left:ee.scrollLeft,top:ee.scrollTop});for(typeof A.focus=="function"&&A.focus(),A=0;A<oe.length;A++){var ie=oe[A];ie.element.scrollLeft=ie.left,ie.element.scrollTop=ie.top}}Eu=!!Ff,$f=Ff=null}finally{tt=g,R.p=c,T.T=l}}a.current=r,qt=2}}function L0(){if(qt===2){qt=0;var a=xa,r=Xr,l=(r.flags&8772)!==0;if((r.subtreeFlags&8772)!==0||l){l=T.T,T.T=null;var c=R.p;R.p=2;var g=tt;tt|=4;try{u0(a,r.alternate,r)}finally{tt=g,R.p=c,T.T=l}}qt=3}}function U0(){if(qt===4||qt===3){qt=0,Dn();var a=xa,r=Xr,l=Os,c=_0;(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?qt=5:(qt=0,Xr=xa=null,O0(a,a.pendingLanes));var g=a.pendingLanes;if(g===0&&(va=null),Cr(l),r=r.stateNode,bt&&typeof bt.onCommitFiberRoot=="function")try{bt.onCommitFiberRoot(ln,r,void 0,(r.current.flags&128)===128)}catch{}if(c!==null){r=T.T,g=R.p,R.p=2,T.T=null;try{for(var y=a.onRecoverableError,b=0;b<c.length;b++){var A=c[b];y(A.value,{componentStack:A.stack})}}finally{T.T=r,R.p=g}}(Os&3)!==0&&hu(),us(a),g=a.pendingLanes,(l&261930)!==0&&(g&42)!==0?a===Rf?wo++:(wo=0,Rf=a):wo=0,_o(0)}}function O0(a,r){(a.pooledCacheLanes&=r)===0&&(r=a.pooledCache,r!=null&&(a.pooledCache=null,to(r)))}function hu(){return k0(),L0(),U0(),B0()}function B0(){if(qt!==5)return!1;var a=xa,r=Af;Af=0;var l=Cr(Os),c=T.T,g=R.p;try{R.p=32>l?32:l,T.T=null,l=Ef,Ef=null;var y=xa,b=Os;if(qt=0,Xr=xa=null,Os=0,(tt&6)!==0)throw Error(s(331));var A=tt;if(tt|=4,x0(y.current),g0(y,y.current,b,l),tt=A,_o(0,!1),bt&&typeof bt.onPostCommitFiberRoot=="function")try{bt.onPostCommitFiberRoot(ln,y)}catch{}return!0}finally{R.p=g,T.T=c,O0(a,r)}}function V0(a,r,l){r=Un(l,r),r=rf(a.stateNode,r,2),a=fa(a,r,2),a!==null&&(za(a,2),us(a))}function at(a,r,l){if(a.tag===3)V0(a,a,l);else for(;r!==null;){if(r.tag===3){V0(r,a,l);break}else if(r.tag===1){var c=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(va===null||!va.has(c))){a=Un(l,a),l=qy(2),c=fa(r,l,2),c!==null&&(Fy(l,c,r,a),za(c,2),us(c));break}}r=r.return}}function If(a,r,l){var c=a.pingCache;if(c===null){c=a.pingCache=new IA;var g=new Set;c.set(r,g)}else g=c.get(r),g===void 0&&(g=new Set,c.set(r,g));g.has(l)||(bf=!0,g.add(l),a=UA.bind(null,a,r,l),r.then(a,a))}function UA(a,r,l){var c=a.pingCache;c!==null&&c.delete(r),a.pingedLanes|=a.suspendedLanes&l,a.warmLanes&=~l,ct===a&&(ze&l)===l&&(At===4||At===3&&(ze&62914560)===ze&&300>_t()-uu?(tt&2)===0&&Wr(a,0):Cf|=l,Zr===ze&&(Zr=0)),us(a)}function q0(a,r){r===0&&(r=yl()),a=Xa(a,r),a!==null&&(za(a,r),us(a))}function OA(a){var r=a.memoizedState,l=0;r!==null&&(l=r.retryLane),q0(a,l)}function BA(a,r){var l=0;switch(a.tag){case 31:case 13:var c=a.stateNode,g=a.memoizedState;g!==null&&(l=g.retryLane);break;case 19:c=a.stateNode;break;case 22:c=a.stateNode._retryCache;break;default:throw Error(s(314))}c!==null&&c.delete(r),q0(a,l)}function VA(a,r){return Me(a,r)}var gu=null,ei=null,Df=!1,yu=!1,Pf=!1,wa=0;function us(a){a!==ei&&a.next===null&&(ei===null?gu=ei=a:ei=ei.next=a),yu=!0,Df||(Df=!0,FA())}function _o(a,r){if(!Pf&&yu){Pf=!0;do for(var l=!1,c=gu;c!==null;){if(a!==0){var g=c.pendingLanes;if(g===0)var y=0;else{var b=c.suspendedLanes,A=c.pingedLanes;y=(1<<31-Ht(42|a)+1)-1,y&=g&~(b&~A),y=y&201326741?y&201326741|1:y?y|2:0}y!==0&&(l=!0,H0(c,y))}else y=ze,y=br(c,c===ct?y:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),(y&3)===0||Ha(c,y)||(l=!0,H0(c,y));c=c.next}while(l);Pf=!1}}function qA(){F0()}function F0(){yu=Df=!1;var a=0;wa!==0&&XA()&&(a=wa);for(var r=_t(),l=null,c=gu;c!==null;){var g=c.next,y=$0(c,r);y===0?(c.next=null,l===null?gu=g:l.next=g,g===null&&(ei=l)):(l=c,(a!==0||(y&3)!==0)&&(yu=!0)),c=g}qt!==0&&qt!==5||_o(a),wa!==0&&(wa=0)}function $0(a,r){for(var l=a.suspendedLanes,c=a.pingedLanes,g=a.expirationTimes,y=a.pendingLanes&-62914561;0<y;){var b=31-Ht(y),A=1<<b,U=g[b];U===-1?((A&l)===0||(A&c)!==0)&&(g[b]=Yc(A,r)):U<=r&&(a.expiredLanes|=A),y&=~A}if(r=ct,l=ze,l=br(a,a===r?l:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),c=a.callbackNode,l===0||a===r&&(st===2||st===9)||a.cancelPendingCommit!==null)return c!==null&&c!==null&&rn(c),a.callbackNode=null,a.callbackPriority=0;if((l&3)===0||Ha(a,l)){if(r=l&-l,r===a.callbackPriority)return r;switch(c!==null&&rn(c),Cr(l)){case 2:case 8:l=vs;break;case 32:l=on;break;case 268435456:l=Jt;break;default:l=on}return c=G0.bind(null,a),l=Me(l,c),a.callbackPriority=r,a.callbackNode=l,r}return c!==null&&c!==null&&rn(c),a.callbackPriority=2,a.callbackNode=null,2}function G0(a,r){if(qt!==0&&qt!==5)return a.callbackNode=null,a.callbackPriority=0,null;var l=a.callbackNode;if(hu()&&a.callbackNode!==l)return null;var c=ze;return c=br(a,a===ct?c:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),c===0?null:(C0(a,c,r),$0(a,_t()),a.callbackNode!=null&&a.callbackNode===l?G0.bind(null,a):null)}function H0(a,r){if(hu())return null;C0(a,r,!0)}function FA(){QA(function(){(tt&6)!==0?Me(Kn,qA):F0()})}function kf(){if(wa===0){var a=Vr;a===0&&(a=Zn,Zn<<=1,(Zn&261888)===0&&(Zn=256)),wa=a}return wa}function z0(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:Tl(""+a)}function j0(a,r){var l=r.ownerDocument.createElement("input");return l.name=r.name,l.value=r.value,a.id&&l.setAttribute("form",a.id),r.parentNode.insertBefore(l,r),a=new FormData(a),l.parentNode.removeChild(l),a}function $A(a,r,l,c,g){if(r==="submit"&&l&&l.stateNode===g){var y=z0((g[Vt]||null).action),b=c.submitter;b&&(r=(r=b[Vt]||null)?z0(r.formAction):b.getAttribute("formAction"),r!==null&&(y=r,b=null));var A=new Nl("action","action",null,c,g);a.push({event:A,listeners:[{instance:null,listener:function(){if(c.defaultPrevented){if(wa!==0){var U=b?j0(g,b):new FormData(g);Qd(l,{pending:!0,data:U,method:g.method,action:y},null,U)}}else typeof y=="function"&&(A.preventDefault(),U=b?j0(g,b):new FormData(g),Qd(l,{pending:!0,data:U,method:g.method,action:y},y,U))},currentTarget:g}]})}}for(var Lf=0;Lf<gd.length;Lf++){var Uf=gd[Lf],GA=Uf.toLowerCase(),HA=Uf[0].toUpperCase()+Uf.slice(1);Wn(GA,"on"+HA)}Wn(bg,"onAnimationEnd"),Wn(Cg,"onAnimationIteration"),Wn(Tg,"onAnimationStart"),Wn("dblclick","onDoubleClick"),Wn("focusin","onFocus"),Wn("focusout","onBlur"),Wn(iA,"onTransitionRun"),Wn(oA,"onTransitionStart"),Wn(lA,"onTransitionCancel"),Wn(Ag,"onTransitionEnd"),Tr("onMouseEnter",["mouseout","mouseover"]),Tr("onMouseLeave",["mouseout","mouseover"]),Tr("onPointerEnter",["pointerout","pointerover"]),Tr("onPointerLeave",["pointerout","pointerover"]),Ct("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ct("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ct("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ct("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ct("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ct("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var bo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),zA=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(bo));function J0(a,r){r=(r&4)!==0;for(var l=0;l<a.length;l++){var c=a[l],g=c.event;c=c.listeners;e:{var y=void 0;if(r)for(var b=c.length-1;0<=b;b--){var A=c[b],U=A.instance,K=A.currentTarget;if(A=A.listener,U!==y&&g.isPropagationStopped())break e;y=A,g.currentTarget=K;try{y(g)}catch(se){Dl(se)}g.currentTarget=null,y=U}else for(b=0;b<c.length;b++){if(A=c[b],U=A.instance,K=A.currentTarget,A=A.listener,U!==y&&g.isPropagationStopped())break e;y=A,g.currentTarget=K;try{y(g)}catch(se){Dl(se)}g.currentTarget=null,y=U}}}}function He(a,r){var l=r[Qs];l===void 0&&(l=r[Qs]=new Set);var c=a+"__bubble";l.has(c)||(Y0(r,a,2,!1),l.add(c))}function Of(a,r,l){var c=0;r&&(c|=4),Y0(l,a,c,r)}var vu="_reactListening"+Math.random().toString(36).slice(2);function Bf(a){if(!a[vu]){a[vu]=!0,Sl.forEach(function(l){l!=="selectionchange"&&(zA.has(l)||Of(l,!1,a),Of(l,!0,a))});var r=a.nodeType===9?a:a.ownerDocument;r===null||r[vu]||(r[vu]=!0,Of("selectionchange",!1,r))}}function Y0(a,r,l,c){switch(bv(r)){case 2:var g=xE;break;case 8:g=SE;break;default:g=Qf}l=g.bind(null,r,l,a),g=void 0,!sd||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(g=!0),c?g!==void 0?a.addEventListener(r,l,{capture:!0,passive:g}):a.addEventListener(r,l,!0):g!==void 0?a.addEventListener(r,l,{passive:g}):a.addEventListener(r,l,!1)}function Vf(a,r,l,c,g){var y=c;if((r&1)===0&&(r&2)===0&&c!==null)e:for(;;){if(c===null)return;var b=c.tag;if(b===3||b===4){var A=c.stateNode.containerInfo;if(A===g)break;if(b===4)for(b=c.return;b!==null;){var U=b.tag;if((U===3||U===4)&&b.stateNode.containerInfo===g)return;b=b.return}for(;A!==null;){if(b=ta(A),b===null)return;if(U=b.tag,U===5||U===6||U===26||U===27){c=y=b;continue e}A=A.parentNode}}c=c.return}Qh(function(){var K=y,se=td(l),oe=[];e:{var W=Eg.get(a);if(W!==void 0){var ee=Nl,xe=a;switch(a){case"keypress":if(El(l)===0)break e;case"keydown":case"keyup":ee=BT;break;case"focusin":xe="focus",ee=od;break;case"focusout":xe="blur",ee=od;break;case"beforeblur":case"afterblur":ee=od;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ee=ng;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ee=AT;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ee=FT;break;case bg:case Cg:case Tg:ee=NT;break;case Ag:ee=GT;break;case"scroll":case"scrollend":ee=CT;break;case"wheel":ee=zT;break;case"copy":case"cut":case"paste":ee=IT;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ee=ag;break;case"toggle":case"beforetoggle":ee=JT}var Ee=(r&4)!==0,ot=!Ee&&(a==="scroll"||a==="scrollend"),$=Ee?W!==null?W+"Capture":null:W;Ee=[];for(var O=K,Y;O!==null;){var ie=O;if(Y=ie.stateNode,ie=ie.tag,ie!==5&&ie!==26&&ie!==27||Y===null||$===null||(ie=Hi(O,$),ie!=null&&Ee.push(Co(O,ie,Y))),ot)break;O=O.return}0<Ee.length&&(W=new ee(W,xe,null,l,se),oe.push({event:W,listeners:Ee}))}}if((r&7)===0){e:{if(W=a==="mouseover"||a==="pointerover",ee=a==="mouseout"||a==="pointerout",W&&l!==ed&&(xe=l.relatedTarget||l.fromElement)&&(ta(xe)||xe[Se]))break e;if((ee||W)&&(W=se.window===se?se:(W=se.ownerDocument)?W.defaultView||W.parentWindow:window,ee?(xe=l.relatedTarget||l.toElement,ee=K,xe=xe?ta(xe):null,xe!==null&&(ot=o(xe),Ee=xe.tag,xe!==ot||Ee!==5&&Ee!==27&&Ee!==6)&&(xe=null)):(ee=null,xe=K),ee!==xe)){if(Ee=ng,ie="onMouseLeave",$="onMouseEnter",O="mouse",(a==="pointerout"||a==="pointerover")&&(Ee=ag,ie="onPointerLeave",$="onPointerEnter",O="pointer"),ot=ee==null?W:sa(ee),Y=xe==null?W:sa(xe),W=new Ee(ie,O+"leave",ee,l,se),W.target=ot,W.relatedTarget=Y,ie=null,ta(se)===K&&(Ee=new Ee($,O+"enter",xe,l,se),Ee.target=Y,Ee.relatedTarget=ot,ie=Ee),ot=ie,ee&&xe)t:{for(Ee=jA,$=ee,O=xe,Y=0,ie=$;ie;ie=Ee(ie))Y++;ie=0;for(var Te=O;Te;Te=Ee(Te))ie++;for(;0<Y-ie;)$=Ee($),Y--;for(;0<ie-Y;)O=Ee(O),ie--;for(;Y--;){if($===O||O!==null&&$===O.alternate){Ee=$;break t}$=Ee($),O=Ee(O)}Ee=null}else Ee=null;ee!==null&&K0(oe,W,ee,Ee,!1),xe!==null&&ot!==null&&K0(oe,ot,xe,Ee,!0)}}e:{if(W=K?sa(K):window,ee=W.nodeName&&W.nodeName.toLowerCase(),ee==="select"||ee==="input"&&W.type==="file")var Ze=fg;else if(cg(W))if(mg)Ze=sA;else{Ze=tA;var _e=eA}else ee=W.nodeName,!ee||ee.toLowerCase()!=="input"||W.type!=="checkbox"&&W.type!=="radio"?K&&Qc(K.elementType)&&(Ze=fg):Ze=nA;if(Ze&&(Ze=Ze(a,K))){dg(oe,Ze,l,se);break e}_e&&_e(a,W,K),a==="focusout"&&K&&W.type==="number"&&K.memoizedProps.value!=null&&Wc(W,"number",W.value)}switch(_e=K?sa(K):window,a){case"focusin":(cg(_e)||_e.contentEditable==="true")&&(Ir=_e,md=K,Wi=null);break;case"focusout":Wi=md=Ir=null;break;case"mousedown":pd=!0;break;case"contextmenu":case"mouseup":case"dragend":pd=!1,wg(oe,l,se);break;case"selectionchange":if(rA)break;case"keydown":case"keyup":wg(oe,l,se)}var Ve;if(ud)e:{switch(a){case"compositionstart":var je="onCompositionStart";break e;case"compositionend":je="onCompositionEnd";break e;case"compositionupdate":je="onCompositionUpdate";break e}je=void 0}else Mr?lg(a,l)&&(je="onCompositionEnd"):a==="keydown"&&l.keyCode===229&&(je="onCompositionStart");je&&(rg&&l.locale!=="ko"&&(Mr||je!=="onCompositionStart"?je==="onCompositionEnd"&&Mr&&(Ve=eg()):(ra=se,ad="value"in ra?ra.value:ra.textContent,Mr=!0)),_e=xu(K,je),0<_e.length&&(je=new sg(je,a,null,l,se),oe.push({event:je,listeners:_e}),Ve?je.data=Ve:(Ve=ug(l),Ve!==null&&(je.data=Ve)))),(Ve=KT?ZT(a,l):XT(a,l))&&(je=xu(K,"onBeforeInput"),0<je.length&&(_e=new sg("onBeforeInput","beforeinput",null,l,se),oe.push({event:_e,listeners:je}),_e.data=Ve)),$A(oe,a,K,l,se)}J0(oe,r)})}function Co(a,r,l){return{instance:a,listener:r,currentTarget:l}}function xu(a,r){for(var l=r+"Capture",c=[];a!==null;){var g=a,y=g.stateNode;if(g=g.tag,g!==5&&g!==26&&g!==27||y===null||(g=Hi(a,l),g!=null&&c.unshift(Co(a,g,y)),g=Hi(a,r),g!=null&&c.push(Co(a,g,y))),a.tag===3)return c;a=a.return}return[]}function jA(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function K0(a,r,l,c,g){for(var y=r._reactName,b=[];l!==null&&l!==c;){var A=l,U=A.alternate,K=A.stateNode;if(A=A.tag,U!==null&&U===c)break;A!==5&&A!==26&&A!==27||K===null||(U=K,g?(K=Hi(l,y),K!=null&&b.unshift(Co(l,K,U))):g||(K=Hi(l,y),K!=null&&b.push(Co(l,K,U)))),l=l.return}b.length!==0&&a.push({event:r,listeners:b})}var JA=/\r\n?/g,YA=/\u0000|\uFFFD/g;function Z0(a){return(typeof a=="string"?a:""+a).replace(JA,`
`).replace(YA,"")}function X0(a,r){return r=Z0(r),Z0(a)===r}function it(a,r,l,c,g,y){switch(l){case"children":typeof c=="string"?r==="body"||r==="textarea"&&c===""||Er(a,c):(typeof c=="number"||typeof c=="bigint")&&r!=="body"&&Er(a,""+c);break;case"className":bl(a,"class",c);break;case"tabIndex":bl(a,"tabindex",c);break;case"dir":case"role":case"viewBox":case"width":case"height":bl(a,l,c);break;case"style":Xh(a,c,y);break;case"data":if(r!=="object"){bl(a,"data",c);break}case"src":case"href":if(c===""&&(r!=="a"||l!=="href")){a.removeAttribute(l);break}if(c==null||typeof c=="function"||typeof c=="symbol"||typeof c=="boolean"){a.removeAttribute(l);break}c=Tl(""+c),a.setAttribute(l,c);break;case"action":case"formAction":if(typeof c=="function"){a.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof y=="function"&&(l==="formAction"?(r!=="input"&&it(a,r,"name",g.name,g,null),it(a,r,"formEncType",g.formEncType,g,null),it(a,r,"formMethod",g.formMethod,g,null),it(a,r,"formTarget",g.formTarget,g,null)):(it(a,r,"encType",g.encType,g,null),it(a,r,"method",g.method,g,null),it(a,r,"target",g.target,g,null)));if(c==null||typeof c=="symbol"||typeof c=="boolean"){a.removeAttribute(l);break}c=Tl(""+c),a.setAttribute(l,c);break;case"onClick":c!=null&&(a.onclick=_s);break;case"onScroll":c!=null&&He("scroll",a);break;case"onScrollEnd":c!=null&&He("scrollend",a);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(s(61));if(l=c.__html,l!=null){if(g.children!=null)throw Error(s(60));a.innerHTML=l}}break;case"multiple":a.multiple=c&&typeof c!="function"&&typeof c!="symbol";break;case"muted":a.muted=c&&typeof c!="function"&&typeof c!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(c==null||typeof c=="function"||typeof c=="boolean"||typeof c=="symbol"){a.removeAttribute("xlink:href");break}l=Tl(""+c),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":c!=null&&typeof c!="function"&&typeof c!="symbol"?a.setAttribute(l,""+c):a.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":c&&typeof c!="function"&&typeof c!="symbol"?a.setAttribute(l,""):a.removeAttribute(l);break;case"capture":case"download":c===!0?a.setAttribute(l,""):c!==!1&&c!=null&&typeof c!="function"&&typeof c!="symbol"?a.setAttribute(l,c):a.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":c!=null&&typeof c!="function"&&typeof c!="symbol"&&!isNaN(c)&&1<=c?a.setAttribute(l,c):a.removeAttribute(l);break;case"rowSpan":case"start":c==null||typeof c=="function"||typeof c=="symbol"||isNaN(c)?a.removeAttribute(l):a.setAttribute(l,c);break;case"popover":He("beforetoggle",a),He("toggle",a),_l(a,"popover",c);break;case"xlinkActuate":ws(a,"http://www.w3.org/1999/xlink","xlink:actuate",c);break;case"xlinkArcrole":ws(a,"http://www.w3.org/1999/xlink","xlink:arcrole",c);break;case"xlinkRole":ws(a,"http://www.w3.org/1999/xlink","xlink:role",c);break;case"xlinkShow":ws(a,"http://www.w3.org/1999/xlink","xlink:show",c);break;case"xlinkTitle":ws(a,"http://www.w3.org/1999/xlink","xlink:title",c);break;case"xlinkType":ws(a,"http://www.w3.org/1999/xlink","xlink:type",c);break;case"xmlBase":ws(a,"http://www.w3.org/XML/1998/namespace","xml:base",c);break;case"xmlLang":ws(a,"http://www.w3.org/XML/1998/namespace","xml:lang",c);break;case"xmlSpace":ws(a,"http://www.w3.org/XML/1998/namespace","xml:space",c);break;case"is":_l(a,"is",c);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=_T.get(l)||l,_l(a,l,c))}}function qf(a,r,l,c,g,y){switch(l){case"style":Xh(a,c,y);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(s(61));if(l=c.__html,l!=null){if(g.children!=null)throw Error(s(60));a.innerHTML=l}}break;case"children":typeof c=="string"?Er(a,c):(typeof c=="number"||typeof c=="bigint")&&Er(a,""+c);break;case"onScroll":c!=null&&He("scroll",a);break;case"onScrollEnd":c!=null&&He("scrollend",a);break;case"onClick":c!=null&&(a.onclick=_s);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!wl.hasOwnProperty(l))e:{if(l[0]==="o"&&l[1]==="n"&&(g=l.endsWith("Capture"),r=l.slice(2,g?l.length-7:void 0),y=a[Vt]||null,y=y!=null?y[l]:null,typeof y=="function"&&a.removeEventListener(r,y,g),typeof c=="function")){typeof y!="function"&&y!==null&&(l in a?a[l]=null:a.hasAttribute(l)&&a.removeAttribute(l)),a.addEventListener(r,c,g);break e}l in a?a[l]=c:c===!0?a.setAttribute(l,""):_l(a,l,c)}}}function Xt(a,r,l){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":He("error",a),He("load",a);var c=!1,g=!1,y;for(y in l)if(l.hasOwnProperty(y)){var b=l[y];if(b!=null)switch(y){case"src":c=!0;break;case"srcSet":g=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,r));default:it(a,r,y,b,l,null)}}g&&it(a,r,"srcSet",l.srcSet,l,null),c&&it(a,r,"src",l.src,l,null);return;case"input":He("invalid",a);var A=y=b=g=null,U=null,K=null;for(c in l)if(l.hasOwnProperty(c)){var se=l[c];if(se!=null)switch(c){case"name":g=se;break;case"type":b=se;break;case"checked":U=se;break;case"defaultChecked":K=se;break;case"value":y=se;break;case"defaultValue":A=se;break;case"children":case"dangerouslySetInnerHTML":if(se!=null)throw Error(s(137,r));break;default:it(a,r,c,se,l,null)}}Jh(a,y,A,U,K,b,g,!1);return;case"select":He("invalid",a),c=b=y=null;for(g in l)if(l.hasOwnProperty(g)&&(A=l[g],A!=null))switch(g){case"value":y=A;break;case"defaultValue":b=A;break;case"multiple":c=A;default:it(a,r,g,A,l,null)}r=y,l=b,a.multiple=!!c,r!=null?Ar(a,!!c,r,!1):l!=null&&Ar(a,!!c,l,!0);return;case"textarea":He("invalid",a),y=g=c=null;for(b in l)if(l.hasOwnProperty(b)&&(A=l[b],A!=null))switch(b){case"value":c=A;break;case"defaultValue":g=A;break;case"children":y=A;break;case"dangerouslySetInnerHTML":if(A!=null)throw Error(s(91));break;default:it(a,r,b,A,l,null)}Kh(a,c,g,y);return;case"option":for(U in l)if(l.hasOwnProperty(U)&&(c=l[U],c!=null))switch(U){case"selected":a.selected=c&&typeof c!="function"&&typeof c!="symbol";break;default:it(a,r,U,c,l,null)}return;case"dialog":He("beforetoggle",a),He("toggle",a),He("cancel",a),He("close",a);break;case"iframe":case"object":He("load",a);break;case"video":case"audio":for(c=0;c<bo.length;c++)He(bo[c],a);break;case"image":He("error",a),He("load",a);break;case"details":He("toggle",a);break;case"embed":case"source":case"link":He("error",a),He("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(K in l)if(l.hasOwnProperty(K)&&(c=l[K],c!=null))switch(K){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,r));default:it(a,r,K,c,l,null)}return;default:if(Qc(r)){for(se in l)l.hasOwnProperty(se)&&(c=l[se],c!==void 0&&qf(a,r,se,c,l,void 0));return}}for(A in l)l.hasOwnProperty(A)&&(c=l[A],c!=null&&it(a,r,A,c,l,null))}function KA(a,r,l,c){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var g=null,y=null,b=null,A=null,U=null,K=null,se=null;for(ee in l){var oe=l[ee];if(l.hasOwnProperty(ee)&&oe!=null)switch(ee){case"checked":break;case"value":break;case"defaultValue":U=oe;default:c.hasOwnProperty(ee)||it(a,r,ee,null,c,oe)}}for(var W in c){var ee=c[W];if(oe=l[W],c.hasOwnProperty(W)&&(ee!=null||oe!=null))switch(W){case"type":y=ee;break;case"name":g=ee;break;case"checked":K=ee;break;case"defaultChecked":se=ee;break;case"value":b=ee;break;case"defaultValue":A=ee;break;case"children":case"dangerouslySetInnerHTML":if(ee!=null)throw Error(s(137,r));break;default:ee!==oe&&it(a,r,W,ee,c,oe)}}Xc(a,b,A,U,K,se,y,g);return;case"select":ee=b=A=W=null;for(y in l)if(U=l[y],l.hasOwnProperty(y)&&U!=null)switch(y){case"value":break;case"multiple":ee=U;default:c.hasOwnProperty(y)||it(a,r,y,null,c,U)}for(g in c)if(y=c[g],U=l[g],c.hasOwnProperty(g)&&(y!=null||U!=null))switch(g){case"value":W=y;break;case"defaultValue":A=y;break;case"multiple":b=y;default:y!==U&&it(a,r,g,y,c,U)}r=A,l=b,c=ee,W!=null?Ar(a,!!l,W,!1):!!c!=!!l&&(r!=null?Ar(a,!!l,r,!0):Ar(a,!!l,l?[]:"",!1));return;case"textarea":ee=W=null;for(A in l)if(g=l[A],l.hasOwnProperty(A)&&g!=null&&!c.hasOwnProperty(A))switch(A){case"value":break;case"children":break;default:it(a,r,A,null,c,g)}for(b in c)if(g=c[b],y=l[b],c.hasOwnProperty(b)&&(g!=null||y!=null))switch(b){case"value":W=g;break;case"defaultValue":ee=g;break;case"children":break;case"dangerouslySetInnerHTML":if(g!=null)throw Error(s(91));break;default:g!==y&&it(a,r,b,g,c,y)}Yh(a,W,ee);return;case"option":for(var xe in l)if(W=l[xe],l.hasOwnProperty(xe)&&W!=null&&!c.hasOwnProperty(xe))switch(xe){case"selected":a.selected=!1;break;default:it(a,r,xe,null,c,W)}for(U in c)if(W=c[U],ee=l[U],c.hasOwnProperty(U)&&W!==ee&&(W!=null||ee!=null))switch(U){case"selected":a.selected=W&&typeof W!="function"&&typeof W!="symbol";break;default:it(a,r,U,W,c,ee)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ee in l)W=l[Ee],l.hasOwnProperty(Ee)&&W!=null&&!c.hasOwnProperty(Ee)&&it(a,r,Ee,null,c,W);for(K in c)if(W=c[K],ee=l[K],c.hasOwnProperty(K)&&W!==ee&&(W!=null||ee!=null))switch(K){case"children":case"dangerouslySetInnerHTML":if(W!=null)throw Error(s(137,r));break;default:it(a,r,K,W,c,ee)}return;default:if(Qc(r)){for(var ot in l)W=l[ot],l.hasOwnProperty(ot)&&W!==void 0&&!c.hasOwnProperty(ot)&&qf(a,r,ot,void 0,c,W);for(se in c)W=c[se],ee=l[se],!c.hasOwnProperty(se)||W===ee||W===void 0&&ee===void 0||qf(a,r,se,W,c,ee);return}}for(var $ in l)W=l[$],l.hasOwnProperty($)&&W!=null&&!c.hasOwnProperty($)&&it(a,r,$,null,c,W);for(oe in c)W=c[oe],ee=l[oe],!c.hasOwnProperty(oe)||W===ee||W==null&&ee==null||it(a,r,oe,W,c,ee)}function W0(a){switch(a){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function ZA(){if(typeof performance.getEntriesByType=="function"){for(var a=0,r=0,l=performance.getEntriesByType("resource"),c=0;c<l.length;c++){var g=l[c],y=g.transferSize,b=g.initiatorType,A=g.duration;if(y&&A&&W0(b)){for(b=0,A=g.responseEnd,c+=1;c<l.length;c++){var U=l[c],K=U.startTime;if(K>A)break;var se=U.transferSize,oe=U.initiatorType;se&&W0(oe)&&(U=U.responseEnd,b+=se*(U<A?1:(A-K)/(U-K)))}if(--c,r+=8*(y+b)/(g.duration/1e3),a++,10<a)break}}if(0<a)return r/a/1e6}return navigator.connection&&(a=navigator.connection.downlink,typeof a=="number")?a:5}var Ff=null,$f=null;function Su(a){return a.nodeType===9?a:a.ownerDocument}function Q0(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function ev(a,r){if(a===0)switch(r){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&r==="foreignObject"?0:a}function Gf(a,r){return a==="textarea"||a==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.children=="bigint"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var Hf=null;function XA(){var a=window.event;return a&&a.type==="popstate"?a===Hf?!1:(Hf=a,!0):(Hf=null,!1)}var tv=typeof setTimeout=="function"?setTimeout:void 0,WA=typeof clearTimeout=="function"?clearTimeout:void 0,nv=typeof Promise=="function"?Promise:void 0,QA=typeof queueMicrotask=="function"?queueMicrotask:typeof nv<"u"?function(a){return nv.resolve(null).then(a).catch(eE)}:tv;function eE(a){setTimeout(function(){throw a})}function _a(a){return a==="head"}function sv(a,r){var l=r,c=0;do{var g=l.nextSibling;if(a.removeChild(l),g&&g.nodeType===8)if(l=g.data,l==="/$"||l==="/&"){if(c===0){a.removeChild(g),ai(r);return}c--}else if(l==="$"||l==="$?"||l==="$~"||l==="$!"||l==="&")c++;else if(l==="html")To(a.ownerDocument.documentElement);else if(l==="head"){l=a.ownerDocument.head,To(l);for(var y=l.firstChild;y;){var b=y.nextSibling,A=y.nodeName;y[ea]||A==="SCRIPT"||A==="STYLE"||A==="LINK"&&y.rel.toLowerCase()==="stylesheet"||l.removeChild(y),y=b}}else l==="body"&&To(a.ownerDocument.body);l=g}while(l);ai(r)}function av(a,r){var l=a;a=0;do{var c=l.nextSibling;if(l.nodeType===1?r?(l._stashedDisplay=l.style.display,l.style.display="none"):(l.style.display=l._stashedDisplay||"",l.getAttribute("style")===""&&l.removeAttribute("style")):l.nodeType===3&&(r?(l._stashedText=l.nodeValue,l.nodeValue=""):l.nodeValue=l._stashedText||""),c&&c.nodeType===8)if(l=c.data,l==="/$"){if(a===0)break;a--}else l!=="$"&&l!=="$?"&&l!=="$~"&&l!=="$!"||a++;l=c}while(l)}function zf(a){var r=a.firstChild;for(r&&r.nodeType===10&&(r=r.nextSibling);r;){var l=r;switch(r=r.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":zf(l),Ja(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}a.removeChild(l)}}function tE(a,r,l,c){for(;a.nodeType===1;){var g=l;if(a.nodeName.toLowerCase()!==r.toLowerCase()){if(!c&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(c){if(!a[ea])switch(r){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(y=a.getAttribute("rel"),y==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(y!==g.rel||a.getAttribute("href")!==(g.href==null||g.href===""?null:g.href)||a.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin)||a.getAttribute("title")!==(g.title==null?null:g.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(y=a.getAttribute("src"),(y!==(g.src==null?null:g.src)||a.getAttribute("type")!==(g.type==null?null:g.type)||a.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin))&&y&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(r==="input"&&a.type==="hidden"){var y=g.name==null?null:""+g.name;if(g.type==="hidden"&&a.getAttribute("name")===y)return a}else return a;if(a=Fn(a.nextSibling),a===null)break}return null}function nE(a,r,l){if(r==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!l||(a=Fn(a.nextSibling),a===null))return null;return a}function rv(a,r){for(;a.nodeType!==8;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!r||(a=Fn(a.nextSibling),a===null))return null;return a}function jf(a){return a.data==="$?"||a.data==="$~"}function Jf(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState!=="loading"}function sE(a,r){var l=a.ownerDocument;if(a.data==="$~")a._reactRetry=r;else if(a.data!=="$?"||l.readyState!=="loading")r();else{var c=function(){r(),l.removeEventListener("DOMContentLoaded",c)};l.addEventListener("DOMContentLoaded",c),a._reactRetry=c}}function Fn(a){for(;a!=null;a=a.nextSibling){var r=a.nodeType;if(r===1||r===3)break;if(r===8){if(r=a.data,r==="$"||r==="$!"||r==="$?"||r==="$~"||r==="&"||r==="F!"||r==="F")break;if(r==="/$"||r==="/&")return null}}return a}var Yf=null;function iv(a){a=a.nextSibling;for(var r=0;a;){if(a.nodeType===8){var l=a.data;if(l==="/$"||l==="/&"){if(r===0)return Fn(a.nextSibling);r--}else l!=="$"&&l!=="$!"&&l!=="$?"&&l!=="$~"&&l!=="&"||r++}a=a.nextSibling}return null}function ov(a){a=a.previousSibling;for(var r=0;a;){if(a.nodeType===8){var l=a.data;if(l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"){if(r===0)return a;r--}else l!=="/$"&&l!=="/&"||r++}a=a.previousSibling}return null}function lv(a,r,l){switch(r=Su(l),a){case"html":if(a=r.documentElement,!a)throw Error(s(452));return a;case"head":if(a=r.head,!a)throw Error(s(453));return a;case"body":if(a=r.body,!a)throw Error(s(454));return a;default:throw Error(s(451))}}function To(a){for(var r=a.attributes;r.length;)a.removeAttributeNode(r[0]);Ja(a)}var $n=new Map,uv=new Set;function wu(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var Bs=R.d;R.d={f:aE,r:rE,D:iE,C:oE,L:lE,m:uE,X:dE,S:cE,M:fE};function aE(){var a=Bs.f(),r=fu();return a||r}function rE(a){var r=na(a);r!==null&&r.tag===5&&r.type==="form"?Ay(r):Bs.r(a)}var ti=typeof document>"u"?null:document;function cv(a,r,l){var c=ti;if(c&&typeof r=="string"&&r){var g=kn(r);g='link[rel="'+a+'"][href="'+g+'"]',typeof l=="string"&&(g+='[crossorigin="'+l+'"]'),uv.has(g)||(uv.add(g),a={rel:a,crossOrigin:l,href:r},c.querySelector(g)===null&&(r=c.createElement("link"),Xt(r,"link",a),Pt(r),c.head.appendChild(r)))}}function iE(a){Bs.D(a),cv("dns-prefetch",a,null)}function oE(a,r){Bs.C(a,r),cv("preconnect",a,r)}function lE(a,r,l){Bs.L(a,r,l);var c=ti;if(c&&a&&r){var g='link[rel="preload"][as="'+kn(r)+'"]';r==="image"&&l&&l.imageSrcSet?(g+='[imagesrcset="'+kn(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(g+='[imagesizes="'+kn(l.imageSizes)+'"]')):g+='[href="'+kn(a)+'"]';var y=g;switch(r){case"style":y=ni(a);break;case"script":y=si(a)}$n.has(y)||(a=S({rel:"preload",href:r==="image"&&l&&l.imageSrcSet?void 0:a,as:r},l),$n.set(y,a),c.querySelector(g)!==null||r==="style"&&c.querySelector(Ao(y))||r==="script"&&c.querySelector(Eo(y))||(r=c.createElement("link"),Xt(r,"link",a),Pt(r),c.head.appendChild(r)))}}function uE(a,r){Bs.m(a,r);var l=ti;if(l&&a){var c=r&&typeof r.as=="string"?r.as:"script",g='link[rel="modulepreload"][as="'+kn(c)+'"][href="'+kn(a)+'"]',y=g;switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":y=si(a)}if(!$n.has(y)&&(a=S({rel:"modulepreload",href:a},r),$n.set(y,a),l.querySelector(g)===null)){switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(Eo(y)))return}c=l.createElement("link"),Xt(c,"link",a),Pt(c),l.head.appendChild(c)}}}function cE(a,r,l){Bs.S(a,r,l);var c=ti;if(c&&a){var g=aa(c).hoistableStyles,y=ni(a);r=r||"default";var b=g.get(y);if(!b){var A={loading:0,preload:null};if(b=c.querySelector(Ao(y)))A.loading=5;else{a=S({rel:"stylesheet",href:a,"data-precedence":r},l),(l=$n.get(y))&&Kf(a,l);var U=b=c.createElement("link");Pt(U),Xt(U,"link",a),U._p=new Promise(function(K,se){U.onload=K,U.onerror=se}),U.addEventListener("load",function(){A.loading|=1}),U.addEventListener("error",function(){A.loading|=2}),A.loading|=4,_u(b,r,c)}b={type:"stylesheet",instance:b,count:1,state:A},g.set(y,b)}}}function dE(a,r){Bs.X(a,r);var l=ti;if(l&&a){var c=aa(l).hoistableScripts,g=si(a),y=c.get(g);y||(y=l.querySelector(Eo(g)),y||(a=S({src:a,async:!0},r),(r=$n.get(g))&&Zf(a,r),y=l.createElement("script"),Pt(y),Xt(y,"link",a),l.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},c.set(g,y))}}function fE(a,r){Bs.M(a,r);var l=ti;if(l&&a){var c=aa(l).hoistableScripts,g=si(a),y=c.get(g);y||(y=l.querySelector(Eo(g)),y||(a=S({src:a,async:!0,type:"module"},r),(r=$n.get(g))&&Zf(a,r),y=l.createElement("script"),Pt(y),Xt(y,"link",a),l.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},c.set(g,y))}}function dv(a,r,l,c){var g=(g=ue.current)?wu(g):null;if(!g)throw Error(s(446));switch(a){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(r=ni(l.href),l=aa(g).hoistableStyles,c=l.get(r),c||(c={type:"style",instance:null,count:0,state:null},l.set(r,c)),c):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){a=ni(l.href);var y=aa(g).hoistableStyles,b=y.get(a);if(b||(g=g.ownerDocument||g,b={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},y.set(a,b),(y=g.querySelector(Ao(a)))&&!y._p&&(b.instance=y,b.state.loading=5),$n.has(a)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},$n.set(a,l),y||mE(g,a,l,b.state))),r&&c===null)throw Error(s(528,""));return b}if(r&&c!==null)throw Error(s(529,""));return null;case"script":return r=l.async,l=l.src,typeof l=="string"&&r&&typeof r!="function"&&typeof r!="symbol"?(r=si(l),l=aa(g).hoistableScripts,c=l.get(r),c||(c={type:"script",instance:null,count:0,state:null},l.set(r,c)),c):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,a))}}function ni(a){return'href="'+kn(a)+'"'}function Ao(a){return'link[rel="stylesheet"]['+a+"]"}function fv(a){return S({},a,{"data-precedence":a.precedence,precedence:null})}function mE(a,r,l,c){a.querySelector('link[rel="preload"][as="style"]['+r+"]")?c.loading=1:(r=a.createElement("link"),c.preload=r,r.addEventListener("load",function(){return c.loading|=1}),r.addEventListener("error",function(){return c.loading|=2}),Xt(r,"link",l),Pt(r),a.head.appendChild(r))}function si(a){return'[src="'+kn(a)+'"]'}function Eo(a){return"script[async]"+a}function mv(a,r,l){if(r.count++,r.instance===null)switch(r.type){case"style":var c=a.querySelector('style[data-href~="'+kn(l.href)+'"]');if(c)return r.instance=c,Pt(c),c;var g=S({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return c=(a.ownerDocument||a).createElement("style"),Pt(c),Xt(c,"style",g),_u(c,l.precedence,a),r.instance=c;case"stylesheet":g=ni(l.href);var y=a.querySelector(Ao(g));if(y)return r.state.loading|=4,r.instance=y,Pt(y),y;c=fv(l),(g=$n.get(g))&&Kf(c,g),y=(a.ownerDocument||a).createElement("link"),Pt(y);var b=y;return b._p=new Promise(function(A,U){b.onload=A,b.onerror=U}),Xt(y,"link",c),r.state.loading|=4,_u(y,l.precedence,a),r.instance=y;case"script":return y=si(l.src),(g=a.querySelector(Eo(y)))?(r.instance=g,Pt(g),g):(c=l,(g=$n.get(y))&&(c=S({},l),Zf(c,g)),a=a.ownerDocument||a,g=a.createElement("script"),Pt(g),Xt(g,"link",c),a.head.appendChild(g),r.instance=g);case"void":return null;default:throw Error(s(443,r.type))}else r.type==="stylesheet"&&(r.state.loading&4)===0&&(c=r.instance,r.state.loading|=4,_u(c,l.precedence,a));return r.instance}function _u(a,r,l){for(var c=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),g=c.length?c[c.length-1]:null,y=g,b=0;b<c.length;b++){var A=c[b];if(A.dataset.precedence===r)y=A;else if(y!==g)break}y?y.parentNode.insertBefore(a,y.nextSibling):(r=l.nodeType===9?l.head:l,r.insertBefore(a,r.firstChild))}function Kf(a,r){a.crossOrigin==null&&(a.crossOrigin=r.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=r.referrerPolicy),a.title==null&&(a.title=r.title)}function Zf(a,r){a.crossOrigin==null&&(a.crossOrigin=r.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=r.referrerPolicy),a.integrity==null&&(a.integrity=r.integrity)}var bu=null;function pv(a,r,l){if(bu===null){var c=new Map,g=bu=new Map;g.set(l,c)}else g=bu,c=g.get(l),c||(c=new Map,g.set(l,c));if(c.has(a))return c;for(c.set(a,null),l=l.getElementsByTagName(a),g=0;g<l.length;g++){var y=l[g];if(!(y[ea]||y[mt]||a==="link"&&y.getAttribute("rel")==="stylesheet")&&y.namespaceURI!=="http://www.w3.org/2000/svg"){var b=y.getAttribute(r)||"";b=a+b;var A=c.get(b);A?A.push(y):c.set(b,[y])}}return c}function hv(a,r,l){a=a.ownerDocument||a,a.head.insertBefore(l,r==="title"?a.querySelector("head > title"):null)}function pE(a,r,l){if(l===1||r.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof r.precedence!="string"||typeof r.href!="string"||r.href==="")break;return!0;case"link":if(typeof r.rel!="string"||typeof r.href!="string"||r.href===""||r.onLoad||r.onError)break;switch(r.rel){case"stylesheet":return a=r.disabled,typeof r.precedence=="string"&&a==null;default:return!0}case"script":if(r.async&&typeof r.async!="function"&&typeof r.async!="symbol"&&!r.onLoad&&!r.onError&&r.src&&typeof r.src=="string")return!0}return!1}function gv(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}function hE(a,r,l,c){if(l.type==="stylesheet"&&(typeof c.media!="string"||matchMedia(c.media).matches!==!1)&&(l.state.loading&4)===0){if(l.instance===null){var g=ni(c.href),y=r.querySelector(Ao(g));if(y){r=y._p,r!==null&&typeof r=="object"&&typeof r.then=="function"&&(a.count++,a=Cu.bind(a),r.then(a,a)),l.state.loading|=4,l.instance=y,Pt(y);return}y=r.ownerDocument||r,c=fv(c),(g=$n.get(g))&&Kf(c,g),y=y.createElement("link"),Pt(y);var b=y;b._p=new Promise(function(A,U){b.onload=A,b.onerror=U}),Xt(y,"link",c),l.instance=y}a.stylesheets===null&&(a.stylesheets=new Map),a.stylesheets.set(l,r),(r=l.state.preload)&&(l.state.loading&3)===0&&(a.count++,l=Cu.bind(a),r.addEventListener("load",l),r.addEventListener("error",l))}}var Xf=0;function gE(a,r){return a.stylesheets&&a.count===0&&Au(a,a.stylesheets),0<a.count||0<a.imgCount?function(l){var c=setTimeout(function(){if(a.stylesheets&&Au(a,a.stylesheets),a.unsuspend){var y=a.unsuspend;a.unsuspend=null,y()}},6e4+r);0<a.imgBytes&&Xf===0&&(Xf=62500*ZA());var g=setTimeout(function(){if(a.waitingForImages=!1,a.count===0&&(a.stylesheets&&Au(a,a.stylesheets),a.unsuspend)){var y=a.unsuspend;a.unsuspend=null,y()}},(a.imgBytes>Xf?50:800)+r);return a.unsuspend=l,function(){a.unsuspend=null,clearTimeout(c),clearTimeout(g)}}:null}function Cu(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Au(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var Tu=null;function Au(a,r){a.stylesheets=null,a.unsuspend!==null&&(a.count++,Tu=new Map,r.forEach(yE,a),Tu=null,Cu.call(a))}function yE(a,r){if(!(r.state.loading&4)){var l=Tu.get(a);if(l)var c=l.get(null);else{l=new Map,Tu.set(a,l);for(var g=a.querySelectorAll("link[data-precedence],style[data-precedence]"),y=0;y<g.length;y++){var b=g[y];(b.nodeName==="LINK"||b.getAttribute("media")!=="not all")&&(l.set(b.dataset.precedence,b),c=b)}c&&l.set(null,c)}g=r.instance,b=g.getAttribute("data-precedence"),y=l.get(b)||c,y===c&&l.set(null,g),l.set(b,g),this.count++,c=Cu.bind(this),g.addEventListener("load",c),g.addEventListener("error",c),y?y.parentNode.insertBefore(g,y.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(g,a.firstChild)),r.state.loading|=4}}var Ro={$$typeof:G,Provider:null,Consumer:null,_currentValue:L,_currentValue2:L,_threadCount:0};function vE(a,r,l,c,g,y,b,A,U){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Fi(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Fi(0),this.hiddenUpdates=Fi(null),this.identifierPrefix=c,this.onUncaughtError=g,this.onCaughtError=y,this.onRecoverableError=b,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=U,this.incompleteTransitions=new Map}function yv(a,r,l,c,g,y,b,A,U,K,se,oe){return a=new vE(a,r,l,b,U,K,se,oe,A),r=1,y===!0&&(r|=24),y=Sn(3,null,null,r),a.current=y,y.stateNode=a,r=Nd(),r.refCount++,a.pooledCache=r,r.refCount++,y.memoizedState={element:c,isDehydrated:l,cache:r},Pd(y),a}function vv(a){return a?(a=kr,a):kr}function xv(a,r,l,c,g,y){g=vv(g),c.context===null?c.context=g:c.pendingContext=g,c=da(r),c.payload={element:l},y=y===void 0?null:y,y!==null&&(c.callback=y),l=fa(a,c,r),l!==null&&(hn(l,a,r),ro(l,a,r))}function Sv(a,r){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var l=a.retryLane;a.retryLane=l!==0&&l<r?l:r}}function Wf(a,r){Sv(a,r),(a=a.alternate)&&Sv(a,r)}function wv(a){if(a.tag===13||a.tag===31){var r=Xa(a,67108864);r!==null&&hn(r,a,67108864),Wf(a,67108864)}}function _v(a){if(a.tag===13||a.tag===31){var r=Tn();r=Gi(r);var l=Xa(a,r);l!==null&&hn(l,a,r),Wf(a,r)}}var Eu=!0;function xE(a,r,l,c){var g=T.T;T.T=null;var y=R.p;try{R.p=2,Qf(a,r,l,c)}finally{R.p=y,T.T=g}}function SE(a,r,l,c){var g=T.T;T.T=null;var y=R.p;try{R.p=8,Qf(a,r,l,c)}finally{R.p=y,T.T=g}}function Qf(a,r,l,c){if(Eu){var g=em(c);if(g===null)Vf(a,r,c,Ru,l),Cv(a,c);else if(_E(g,a,r,l,c))c.stopPropagation();else if(Cv(a,c),r&4&&-1<wE.indexOf(a)){for(;g!==null;){var y=na(g);if(y!==null)switch(y.tag){case 3:if(y=y.stateNode,y.current.memoizedState.isDehydrated){var b=Ss(y.pendingLanes);if(b!==0){var A=y;for(A.pendingLanes|=2,A.entangledLanes|=2;b;){var U=1<<31-Ht(b);A.entanglements[1]|=U,b&=~U}us(y),(tt&6)===0&&(cu=_t()+500,_o(0))}}break;case 31:case 13:A=Xa(y,2),A!==null&&hn(A,y,2),fu(),Wf(y,2)}if(y=em(c),y===null&&Vf(a,r,c,Ru,l),y===g)break;g=y}g!==null&&c.stopPropagation()}else Vf(a,r,c,null,l)}}function em(a){return a=td(a),tm(a)}var Ru=null;function tm(a){if(Ru=null,a=ta(a),a!==null){var r=o(a);if(r===null)a=null;else{var l=r.tag;if(l===13){if(a=u(r),a!==null)return a;a=null}else if(l===31){if(a=d(r),a!==null)return a;a=null}else if(l===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;a=null}else r!==a&&(a=null)}}return Ru=a,null}function bv(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(rs()){case Kn:return 2;case vs:return 8;case on:case It:return 32;case Jt:return 268435456;default:return 32}default:return 32}}var nm=!1,ba=null,Ca=null,Ta=null,No=new Map,Mo=new Map,Aa=[],wE="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Cv(a,r){switch(a){case"focusin":case"focusout":ba=null;break;case"dragenter":case"dragleave":Ca=null;break;case"mouseover":case"mouseout":Ta=null;break;case"pointerover":case"pointerout":No.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":Mo.delete(r.pointerId)}}function Io(a,r,l,c,g,y){return a===null||a.nativeEvent!==y?(a={blockedOn:r,domEventName:l,eventSystemFlags:c,nativeEvent:y,targetContainers:[g]},r!==null&&(r=na(r),r!==null&&wv(r)),a):(a.eventSystemFlags|=c,r=a.targetContainers,g!==null&&r.indexOf(g)===-1&&r.push(g),a)}function _E(a,r,l,c,g){switch(r){case"focusin":return ba=Io(ba,a,r,l,c,g),!0;case"dragenter":return Ca=Io(Ca,a,r,l,c,g),!0;case"mouseover":return Ta=Io(Ta,a,r,l,c,g),!0;case"pointerover":var y=g.pointerId;return No.set(y,Io(No.get(y)||null,a,r,l,c,g)),!0;case"gotpointercapture":return y=g.pointerId,Mo.set(y,Io(Mo.get(y)||null,a,r,l,c,g)),!0}return!1}function Tv(a){var r=ta(a.target);if(r!==null){var l=o(r);if(l!==null){if(r=l.tag,r===13){if(r=u(l),r!==null){a.blockedOn=r,De(a.priority,function(){_v(l)});return}}else if(r===31){if(r=d(l),r!==null){a.blockedOn=r,De(a.priority,function(){_v(l)});return}}else if(r===3&&l.stateNode.current.memoizedState.isDehydrated){a.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Nu(a){if(a.blockedOn!==null)return!1;for(var r=a.targetContainers;0<r.length;){var l=em(a.nativeEvent);if(l===null){l=a.nativeEvent;var c=new l.constructor(l.type,l);ed=c,l.target.dispatchEvent(c),ed=null}else return r=na(l),r!==null&&wv(r),a.blockedOn=l,!1;r.shift()}return!0}function Av(a,r,l){Nu(a)&&l.delete(r)}function bE(){nm=!1,ba!==null&&Nu(ba)&&(ba=null),Ca!==null&&Nu(Ca)&&(Ca=null),Ta!==null&&Nu(Ta)&&(Ta=null),No.forEach(Av),Mo.forEach(Av)}function Mu(a,r){a.blockedOn===r&&(a.blockedOn=null,nm||(nm=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,bE)))}var Iu=null;function Ev(a){Iu!==a&&(Iu=a,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Iu===a&&(Iu=null);for(var r=0;r<a.length;r+=3){var l=a[r],c=a[r+1],g=a[r+2];if(typeof c!="function"){if(tm(c||l)===null)continue;break}var y=na(l);y!==null&&(a.splice(r,3),r-=3,Qd(y,{pending:!0,data:g,method:l.method,action:c},c,g))}}))}function ai(a){function r(U){return Mu(U,a)}ba!==null&&Mu(ba,a),Ca!==null&&Mu(Ca,a),Ta!==null&&Mu(Ta,a),No.forEach(r),Mo.forEach(r);for(var l=0;l<Aa.length;l++){var c=Aa[l];c.blockedOn===a&&(c.blockedOn=null)}for(;0<Aa.length&&(l=Aa[0],l.blockedOn===null);)Tv(l),l.blockedOn===null&&Aa.shift();if(l=(a.ownerDocument||a).$$reactFormReplay,l!=null)for(c=0;c<l.length;c+=3){var g=l[c],y=l[c+1],b=g[Vt]||null;if(typeof y=="function")b||Ev(l);else if(b){var A=null;if(y&&y.hasAttribute("formAction")){if(g=y,b=y[Vt]||null)A=b.formAction;else if(tm(g)!==null)continue}else A=b.action;typeof A=="function"?l[c+1]=A:(l.splice(c,3),c-=3),Ev(l)}}}function Rv(){function a(y){y.canIntercept&&y.info==="react-transition"&&y.intercept({handler:function(){return new Promise(function(b){return g=b})},focusReset:"manual",scroll:"manual"})}function r(){g!==null&&(g(),g=null),c||setTimeout(l,20)}function l(){if(!c&&!navigation.transition){var y=navigation.currentEntry;y&&y.url!=null&&navigation.navigate(y.url,{state:y.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var c=!1,g=null;return navigation.addEventListener("navigate",a),navigation.addEventListener("navigatesuccess",r),navigation.addEventListener("navigateerror",r),setTimeout(l,100),function(){c=!0,navigation.removeEventListener("navigate",a),navigation.removeEventListener("navigatesuccess",r),navigation.removeEventListener("navigateerror",r),g!==null&&(g(),g=null)}}}function sm(a){this._internalRoot=a}Du.prototype.render=sm.prototype.render=function(a){var r=this._internalRoot;if(r===null)throw Error(s(409));var l=r.current,c=Tn();xv(l,c,a,r,null,null)},Du.prototype.unmount=sm.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var r=a.containerInfo;xv(a.current,2,null,a,null,null),fu(),r[Se]=null}};function Du(a){this._internalRoot=a}Du.prototype.unstable_scheduleHydration=function(a){if(a){var r=fe();a={blockedOn:null,target:a,priority:r};for(var l=0;l<Aa.length&&r!==0&&r<Aa[l].priority;l++);Aa.splice(l,0,a),l===0&&Tv(a)}};var Nv=e.version;if(Nv!=="19.2.0")throw Error(s(527,Nv,"19.2.0"));R.findDOMNode=function(a){var r=a._reactInternals;if(r===void 0)throw typeof a.render=="function"?Error(s(188)):(a=Object.keys(a).join(","),Error(s(268,a)));return a=m(r),a=a!==null?v(a):null,a=a===null?null:a.stateNode,a};var CE={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:T,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Pu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Pu.isDisabled&&Pu.supportsFiber)try{ln=Pu.inject(CE),bt=Pu}catch{}}return Po.createRoot=function(a,r){if(!i(a))throw Error(s(299));var l=!1,c="",g=Uy,y=Oy,b=By;return r!=null&&(r.unstable_strictMode===!0&&(l=!0),r.identifierPrefix!==void 0&&(c=r.identifierPrefix),r.onUncaughtError!==void 0&&(g=r.onUncaughtError),r.onCaughtError!==void 0&&(y=r.onCaughtError),r.onRecoverableError!==void 0&&(b=r.onRecoverableError)),r=yv(a,1,!1,null,null,l,c,null,g,y,b,Rv),a[Se]=r.current,Bf(a),new sm(r)},Po.hydrateRoot=function(a,r,l){if(!i(a))throw Error(s(299));var c=!1,g="",y=Uy,b=Oy,A=By,U=null;return l!=null&&(l.unstable_strictMode===!0&&(c=!0),l.identifierPrefix!==void 0&&(g=l.identifierPrefix),l.onUncaughtError!==void 0&&(y=l.onUncaughtError),l.onCaughtError!==void 0&&(b=l.onCaughtError),l.onRecoverableError!==void 0&&(A=l.onRecoverableError),l.formState!==void 0&&(U=l.formState)),r=yv(a,1,!0,r,l??null,c,g,U,y,b,A,Rv),r.context=vv(null),l=r.current,c=Tn(),c=Gi(c),g=da(c),g.callback=null,fa(l,g,c),l=c,r.current.lanes=l,za(r,l),us(r),a[Se]=r.current,Bf(a),new Du(r)},Po.version="19.2.0",Po}var Vv;function kE(){if(Vv)return im.exports;Vv=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),im.exports=PE(),im.exports}var LE=kE();const UE=Op(LE);function OE(t,e){if(t==null)return{};var n=BE(t,e),s,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)s=o[i],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(n[s]=t[s])}return n}function BE(t,e){if(t==null)return{};var n={},s=Object.keys(t),i,o;for(o=0;o<s.length;o++)i=s[o],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}function oc(){return oc=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},oc.apply(this,arguments)}function qv(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,s)}return n}function ko(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?qv(Object(n),!0).forEach(function(s){VE(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):qv(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}function VE(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const qE={breakpointCols:void 0,className:void 0,columnClassName:void 0,children:void 0,columnAttrs:void 0,column:void 0},cm=2;class p_ extends $s.Component{constructor(e){super(e),this.reCalculateColumnCount=this.reCalculateColumnCount.bind(this),this.reCalculateColumnCountDebounce=this.reCalculateColumnCountDebounce.bind(this);let n;this.props.breakpointCols&&this.props.breakpointCols.default?n=this.props.breakpointCols.default:n=parseInt(this.props.breakpointCols)||cm,this.state={columnCount:n}}componentDidMount(){this.reCalculateColumnCount(),window&&window.addEventListener("resize",this.reCalculateColumnCountDebounce)}componentDidUpdate(){this.reCalculateColumnCount()}componentWillUnmount(){window&&window.removeEventListener("resize",this.reCalculateColumnCountDebounce)}reCalculateColumnCountDebounce(){if(!window||!window.requestAnimationFrame){this.reCalculateColumnCount();return}window.cancelAnimationFrame&&window.cancelAnimationFrame(this._lastRecalculateAnimationFrame),this._lastRecalculateAnimationFrame=window.requestAnimationFrame(()=>{this.reCalculateColumnCount()})}reCalculateColumnCount(){const e=window&&window.innerWidth||1/0;let n=this.props.breakpointCols;typeof n!="object"&&(n={default:parseInt(n)||cm});let s=1/0,i=n.default||cm;for(let o in n){const u=parseInt(o);u>0&&e<=u&&u<s&&(s=u,i=n[o])}i=Math.max(1,parseInt(i)||1),this.state.columnCount!==i&&this.setState({columnCount:i})}itemsInColumns(){const e=this.state.columnCount,n=new Array(e),s=$s.Children.toArray(this.props.children);for(let i=0;i<s.length;i++){const o=i%e;n[o]||(n[o]=[]),n[o].push(s[i])}return n}renderColumns(){const{column:e,columnAttrs:n={},columnClassName:s}=this.props,i=this.itemsInColumns(),o=`${100/i.length}%`;let u=s;u&&typeof u!="string"&&(this.logDeprecated('The property "columnClassName" requires a string'),typeof u>"u"&&(u="my-masonry-grid_column"));const d=ko(ko(ko({},e),n),{},{style:ko(ko({},n.style),{},{width:o}),className:u});return i.map((p,m)=>$s.createElement("div",oc({},d,{key:m}),p))}logDeprecated(e){console.error("[Masonry]",e)}render(){const e=this.props,{children:n,breakpointCols:s,columnClassName:i,columnAttrs:o,column:u,className:d}=e,p=OE(e,["children","breakpointCols","columnClassName","columnAttrs","column","className"]);let m=d;return typeof d!="string"&&(this.logDeprecated('The property "className" requires a string'),typeof d>"u"&&(m="my-masonry-grid")),$s.createElement("div",oc({},p,{className:m}),this.renderColumns())}}p_.defaultProps=qE;const pi=["#4e79a7","#f28e2c","#e15759","#76b7b2","#59a14f","#edc949","#af7aa1","#ff9da7","#9c755f","#bab0ab"],ri=pi.map(t=>`${t}B3`),ku=pi.map(t=>`${t}80`),FE="#3b82f6",$E="#2563eb",Fv="rgba(107, 114, 128, 0.2)",Lu="rgba(107, 114, 128, 0.5)";let $v=!1;const GE=ce.forwardRef(({chartType:t,data:e,plan:n,selectedIndices:s,onElementClick:i,onZoomChange:o,disableAnimation:u},d)=>{const p=ce.useRef(null),m=ce.useRef(null);return typeof Chart<"u"&&typeof ChartZoom<"u"&&!$v&&(Chart.register(ChartZoom),$v=!0),ce.useImperativeHandle(d,()=>({resetZoom:()=>{var v;(v=m.current)==null||v.resetZoom()}})),ce.useEffect(()=>{if(!p.current||!n)return;m.current&&m.current.destroy();const v=p.current.getContext("2d");if(!v)return;const{groupByColumn:S,valueColumn:w,xValueColumn:C,yValueColumn:M}=n,I=w||"count",k=s.length>0,F=j=>k?e.map((X,ne)=>s.includes(ne)?FE:Fv):j,V=j=>k?e.map((X,ne)=>s.includes(ne)?$E:Lu):j,G=j=>{if(!j||!j.scales||!j.scales.x)return!1;const X=j.getInitialScaleBounds().x,ne={min:j.scales.x.min,max:j.scales.x.max};return X.min!==ne.min||X.max!==ne.max},z={maintainAspectRatio:!1,responsive:!0,animation:u?{duration:0}:void 0,onClick:(j,X)=>{X.length>0&&i(X[0].index,j)},plugins:{legend:{display:!1},tooltip:{backgroundColor:"#ffffff",titleColor:"#1e293b",bodyColor:"#475569",borderColor:"#e2e8f0",borderWidth:1,titleFont:{weight:"bold"},bodyFont:{size:13},padding:10}},scales:{x:{ticks:{color:"#64748b",callback:function(j){const X=this.getLabelForValue(Number(j));return typeof X=="string"&&X.length>30?X.substring(0,27)+"...":X}},grid:{color:"#e2e8f0"}},y:{ticks:{color:"#64748b"},grid:{color:"#e2e8f0"}}}},ae={pan:{enabled:!0,mode:"xy",onPanComplete:({chart:j})=>o(G(j))},zoom:{wheel:{enabled:!1},pinch:{enabled:!0},mode:"xy",onZoomComplete:({chart:j})=>o(G(j))}},Q=S?e.map(j=>j[S]):[],J=e.map(j=>j[I]);switch(t){case"bar":m.current=new Chart(v,{type:"bar",data:{labels:Q,datasets:[{label:I,data:J,backgroundColor:F(ku),borderColor:V(ri),borderWidth:1}]},options:{...z}});break;case"line":m.current=new Chart(v,{type:"line",data:{labels:Q,datasets:[{label:I,data:J,fill:!1,borderColor:k?Lu:pi[0],pointBackgroundColor:F([pi[0]]),pointBorderColor:V([ri[0]]),pointRadius:k?5:3,pointHoverRadius:7,tension:.1}]},options:{...z,plugins:{...z.plugins,zoom:ae}}});break;case"pie":case"doughnut":m.current=new Chart(v,{type:t,data:{labels:Q,datasets:[{label:I,data:J,backgroundColor:F(ku),borderColor:V(ri),borderWidth:1,offset:k?e.map((_,E)=>s.includes(E)?20:0):0}]},options:{...z,scales:{x:{display:!1},y:{display:!1}}}});break;case"scatter":if(!C||!M)break;const j=e.map(_=>({x:_[C],y:_[M]}));m.current=new Chart(v,{type:"scatter",data:{datasets:[{label:`${M} vs ${C}`,data:j,backgroundColor:F(ku),borderColor:V(ri),borderWidth:1.5,pointRadius:k?e.map((_,E)=>s.includes(E)?7:4):5,pointHoverRadius:k?e.map((_,E)=>s.includes(E)?9:6):7}]},options:{...z,scales:{x:{...z.scales.x,title:{display:!0,text:C,color:"#64748b"}},y:{...z.scales.y,title:{display:!0,text:M,color:"#64748b"}}},plugins:{...z.plugins,zoom:ae}}});break;case"combo":if(!S||!I||!n.secondaryValueColumn)break;const X=n.secondaryValueColumn,ne=e.map(_=>_[I]),le=e.map(_=>_[X]);m.current=new Chart(v,{type:"bar",data:{labels:Q,datasets:[{type:"bar",label:I,data:ne,backgroundColor:F(ku),borderColor:V(ri),borderWidth:1,yAxisID:"y"},{type:"line",label:X,data:le,fill:!1,borderColor:k?Lu:pi[1],pointBackgroundColor:k?Fv:pi[1],pointBorderColor:k?Lu:ri[1],pointRadius:k?5:3,pointHoverRadius:7,tension:.1,yAxisID:"y1"}]},options:{...z,scales:{...z.scales,y:{type:"linear",display:!0,position:"left",ticks:{color:"#64748b"},grid:{color:"#e2e8f0"},title:{display:!0,text:I,color:"#64748b"}},y1:{type:"linear",display:!0,position:"right",ticks:{color:"#64748b"},grid:{drawOnChartArea:!1},title:{display:!0,text:X,color:"#64748b"}}}}});break}return()=>{m.current&&m.current.destroy()}},[t,e,n,s,i,o,u]),x.jsx("canvas",{ref:p})}),lc=(t,e=0,n)=>{if(t==null)return"";if(typeof t=="number")return Gv(t,n);if(typeof t=="string"){if(n&&(n==="currency"||n==="percentage"||n==="number")){const s=Number(t);if(!Number.isNaN(s))return Gv(s,n)}return t}if(typeof t=="boolean")return t?"true":"false";if(Array.isArray(t))return e>=1?`[${t.length} items]`:t.map(s=>lc(s,e+1,n)).join(", ");if(typeof t=="object"){const s=Object.entries(t);return s.length===0?"{}":e>=1?`{${s.length} keys}`:s.map(([i,o])=>`${i}: ${lc(o,e+1,n)}`).join("; ")}return String(t)},Gv=(t,e)=>{const n=e==null?void 0:e.toLowerCase();return n==="currency"?t.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):n==="percentage"?`${t.toFixed(2)}%`:t.toLocaleString(void 0,{maximumFractionDigits:2})};class h_ extends Error{constructor(e,n="unknown"){super(e),this.name="PlanExecutionError",this.code=n}}const g_=t=>typeof t=="string"&&t.startsWith("=")?`'${t}`:t,Nn=t=>{if(t==null)return null;let e=String(t).trim();if(e==="")return null;let n=!1;e.startsWith("(")&&e.endsWith(")")&&(e=e.substring(1,e.length-1),n=!0),e=e.replace(/[$\s%]/g,"");const s=e.lastIndexOf(","),i=e.lastIndexOf(".");s>i?e=e.replace(/\./g,"").replace(",","."):e=e.replace(/,/g,"");const o=parseFloat(e);return isNaN(o)?null:n?-o:o},HE=t=>typeof t!="string"||!t?!1:!isNaN(new Date(t).getTime())&&/[0-9]{1,4}[-/][0-9]{1,2}[-/][0-9]{1,4}/.test(t),y_=/^Q([1-4])(?:\s*\/?\s*('?\d{2,4}))?$/i,v_={january:1,jan:1,february:2,feb:2,march:3,mar:3,april:4,apr:4,may:5,june:6,jun:6,july:7,jul:7,august:8,aug:8,september:9,sep:9,october:10,oct:10,november:11,nov:11,december:12,dec:12},x_={monday:1,mon:1,tuesday:2,tue:2,wednesday:3,wed:3,thursday:4,thu:4,friday:5,fri:5,saturday:6,sat:6,sunday:7,sun:7},Hv=(t,e)=>{const n=String(t).toLowerCase().trim();switch(e){case"quarter":const s=n.match(y_);if(s){const i=parseInt(s[1],10);let o=0;if(s[2]){const u=s[2].replace("'","");o=parseInt(u,10),u.length===2&&(o+=o>50?1900:2e3)}return o*10+i}return 1/0;case"month":return v_[n]||1/0;case"day":return x_[n]||1/0}return 1/0},zv=(t,e)=>{if(t.length<2)return t;const n=t.slice(0,10).map(p=>String(p[e]).toLowerCase().trim());let s=null;const i=n.filter(p=>y_.test(p)).length,o=n.filter(p=>v_[p]!==void 0).length,u=n.filter(p=>x_[p]!==void 0).length,d=n.filter(HE).length;if(i/n.length>=.5)s="quarter";else if(o/n.length>=.5)s="month";else if(u/n.length>=.5)s="day";else if(d/n.length>=.5)return[...t].sort((p,m)=>new Date(String(p[e])).getTime()-new Date(String(m[e])).getTime());return s?[...t].sort((p,m)=>{const v=Hv(String(p[e]),s),S=Hv(String(m[e]),s);return v-S}):null},S_=(t,e,n,s)=>{if(t.length<=s)return t;const i=[...t].sort((d,p)=>(Number(p[n])||0)-(Number(d[n])||0)),o=i.slice(0,s),u=i.slice(s);if(u.length>0){const d=u.reduce((m,v)=>m+(Number(v[n])||0),0),p={[e]:"Others",[n]:d};return[...o,p]}return o},zE=/^column_\d+$/i,jE=t=>typeof t!="string"?"":t.replace(/[\u0000-\u001F]/g,"").trim(),JE=()=>{const t=new Map;return(e,n)=>{const s=jE(e),i=s.length>0?s:`column_${n+1}`,o=t.get(i)??0;return t.set(i,o+1),o===0?i:`${i}_${o+1}`}},YE=(t,e)=>t.filter(n=>e.some(s=>{const i=n[s];return i!==void 0&&String(i).trim()!==""})).map(n=>{const s={};return e.forEach(i=>{s[i]=g_(String(n[i]??""))}),s}),KE=t=>new Promise((e,n)=>{Papa.parse(t,{header:!1,skipEmptyLines:"greedy",worker:!0,complete:s=>{if(s.data.length===0){e({fileName:t.name,data:[]});return}const i=s.data.reduce((d,p)=>Math.max(d,p.length),0),o=Array.from({length:i},(d,p)=>`column_${p+1}`),u=s.data.map(d=>{const p={};return o.forEach((m,v)=>{const S=d[v]!==void 0?d[v]:"";p[m]=g_(String(S))}),p});e({fileName:t.name,data:u})},error:n})}),ZE=t=>new Promise((e,n)=>{const s=JE(),i=[];Papa.parse(t,{header:!0,skipEmptyLines:"greedy",worker:!1,transformHeader:(o,u)=>{const d=s(o,u);return i[u]=d,d},complete:async o=>{try{if(!(i.length>0&&i.some(d=>!zE.test(d)))){const d=await KE(t);e(d);return}e({fileName:t.name,data:YE(o.data,i)})}catch(u){n(u)}},error:n})}),Wo=t=>{if(!t||t.length===0)return[];const e=Object.keys(t[0]),n=[];for(const s of e){let i=!0;const o=t.map(m=>m[s]);let u=0;const d=t.length,p=o.filter(m=>m!==null&&String(m).trim()!=="").length;for(const m of o){const v=Nn(m);if(m!==null&&String(m).trim()!==""){if(v===null){i=!1;break}u++}}if(i&&u>0){const m=o.map(Nn).filter(S=>S!==null),v=d>0?m.length/d:0;n.push({name:s,type:"numerical",valueRange:[Math.min(...m),Math.max(...m)],missingPercentage:(1-v)*100,sampleSize:d,nonNullCount:p,numericSampleCount:m.length,numericSampleRatio:v})}else{const m=new Set(o.map(String));n.push({name:s,type:"categorical",uniqueValues:m.size,missingPercentage:d===0?0:o.filter(v=>v===null||String(v).trim()==="").length/d*100,sampleSize:d,nonNullCount:p})}}return n},w_=t=>t?String(t).replace(/,(?=-?\d)/g,"|").split("|"):[],cr=t=>t==null||t===""?"__NULL__":String(t),jv=(t,e)=>{const n=t.map(i=>typeof i=="number"?i:Nn(i)).filter(i=>typeof i=="number");if(n.length===0)return 0;const s=n.reduce((i,o)=>i+o,0);switch(e){case"avg":return s/n.length;case"count":return n.length;default:return s}},__=()=>({parseNumber:Nn,splitNumericString:w_,groupBy:(t=[],e)=>{const n=typeof e=="function"?e:i=>i[e],s={};return t.forEach(i=>{const o=cr(n(i));s[o]||(s[o]=[]),s[o].push(i)}),Object.entries(s).map(([i,o])=>({key:i==="__NULL__"?null:i,rows:o,count:o.length}))},pivot:(t=[],e,n,s,i="sum")=>{const o=new Set,u=new Map;t.forEach(m=>{const v=cr(m[e]),S=cr(m[n]);o.add(S);const w=u.get(v)??{[e]:m[e]},C=w[S]??[];C.push(m[s]),w[S]=C,u.set(v,w)});const d=typeof i=="function"?i:m=>jv(m,i),p=Array.from(o);return Array.from(u.values()).map(m=>{const v={...m};return p.forEach(S=>{const w=Array.isArray(v[S])?v[S]:[];v[S]=d(w)}),v})},join:(t=[],e=[],n)=>{if(!(n!=null&&n.leftKey))throw new Error("join requires a leftKey.");const s=n.how||"inner",i=n.rightKey??n.leftKey,o=new Map;e.forEach(m=>{const v=cr(m[i]),S=o.get(v)??[];S.push(m),o.set(v,S)});const u=(m,v)=>m&&v?{...v,...m}:m?{...m}:v?{...v}:{},d=[],p=new Set;return t.forEach(m=>{const v=cr(m[n.leftKey]),S=o.get(v);S&&S.length>0?S.forEach(w=>{p.add(w),d.push(u(m,w))}):(s==="left"||s==="full")&&d.push(u(m,null))}),(s==="right"||s==="full")&&e.forEach(m=>{if(!p.has(m)){if(s==="right")d.push(u(null,m));else if(s==="full"){const v=cr(m[i]);t.filter(w=>cr(w[n.leftKey])===v).length===0&&d.push(u(null,m))}}}),d},rollingWindow:(t=[],e,n={column:"value",op:"avg"})=>{if(!Array.isArray(t)||e<=0)return[];const s=typeof n=="function"?n:i=>{const o=i.map(u=>u[n.column]);return jv(o,n.op??"avg")};return t.map((i,o)=>{const u=Math.max(0,o-e+1),d=t.slice(u,o+1);return{index:o,start:u,end:o,value:s(d,o)}})}}),Jv=t=>t==null?"":typeof t=="number"?t.toString():String(t),XE=(t,e)=>{const n=Object.keys(t),s=Object.keys(e);if(n.length!==s.length)return!1;for(const i of n)if(!Object.prototype.hasOwnProperty.call(e,i)||Jv(t[i])!==Jv(e[i]))return!1;return!0},WE=t=>{const e=t.trim(),n=o=>`const __transform = ${o}; return __transform(data, _util);`,s=/^(?:async\s+)?function\s*(?:[\w$]+)?\s*\(/i,i=/^(?:async\s*)?\(?[\w\s,$]*\)?\s*=>/;return s.test(e)||i.test(e)?n(e):t},b_=(t,e)=>{try{const n=__(),s=WE(e),o=new Function("data","_util",s)(t,n),u=()=>({rowsBefore:t.length,rowsAfter:t.length,addedRows:0,removedRows:0,modifiedRows:0,noOp:!0});if(!Array.isArray(o)||o.length>0&&typeof o[0]!="object")return console.warn("AI-generated transform function did not produce an array of row objects. Treating as pass-through.",{returnedValue:o,generatedCode:e}),{data:t,meta:u()};const d=o,p=t.length,m=d.length,v=p>m?p-m:0,S=m>p?m-p:0,w=Math.min(p,m);let C=0;for(let k=0;k<w;k++)XE(t[k],d[k])||C++;const M=v>0||S>0||C>0,I={rowsBefore:p,rowsAfter:m,addedRows:S,removedRows:v,modifiedRows:C,noOp:!M};return M||console.warn("AI-generated data transformation produced no observable row changes. Treating result as a no-op.",{generatedCode:e}),{data:d,meta:I}}catch(n){throw console.error("Error executing AI-generated JavaScript:",n),new Error(`AI-generated data transformation failed: ${n instanceof Error?n.message:String(n)}`)}},QE=(t,e)=>{try{const n=__(),i=new Function("data","_util",e)(t,n);if(!Array.isArray(i))throw new Error("AI-generated filter function did not return an array.");return i}catch(n){throw console.error("Error executing AI-generated JavaScript filter:",n),new Error(`AI-generated data filter failed: ${n instanceof Error?n.message:String(n)}`)}},Yv=t=>{if(t==null)return null;const e=String(t).trim();return e===""?null:e},eR=(t,e)=>{if(!(e!=null&&e.column)||!Array.isArray(e.values)||e.values.length===0)return t;const n=new Set(e.values.map(Yv).filter(s=>s!==null));return n.size===0?t:t.filter(s=>{const i=Yv(s[e.column]);return i!==null&&n.has(i)})},dm=(t,e)=>{if(t.length===0)return 0;switch(e){case"sum":return t.reduce((s,i)=>s+i,0);case"count":return t.length;case"avg":return t.reduce((s,i)=>s+i,0)/t.length;default:throw new Error(`Unsupported aggregation type: ${e}`)}},C_=(t,e)=>{const n=eR(t.data,e.rowFilter);if(e.rowFilter&&e.rowFilter.column&&Array.isArray(e.rowFilter.values)&&e.rowFilter.values.length>0&&n.length===0){const m=e.rowFilter.values.map(v=>`"${String(v)}"`).join(", ");throw new h_(`No rows matched the filter ${e.rowFilter.column}  ${m}. Remove or adjust the filter and try again.`,"no_rows")}if(e.chartType==="scatter"){const{xValueColumn:m,yValueColumn:v}=e;if(!m||!v)throw new Error("Scatter plot plan is missing xValueColumn or yValueColumn.");return n.map(S=>({[m]:Nn(S[m]),[v]:Nn(S[v])})).filter(S=>S[m]!==null&&S[v]!==null)}if(e.chartType==="combo"){const{groupByColumn:m,valueColumn:v,aggregation:S,secondaryValueColumn:w,secondaryAggregation:C}=e;if(!m||!v||!S||!w||!C)throw new Error("Combo chart plan is missing required aggregation fields.");const M={};n.forEach(F=>{const V=String(F[m]);if(V==="undefined"||V==="null")return;M[V]||(M[V]={primaryValues:[],secondaryValues:[]});const G=Nn(F[v]);G!==null&&M[V].primaryValues.push(G);const z=Nn(F[w]);z!==null&&M[V].secondaryValues.push(z)});const I=Object.keys(M).filter(F=>M[F].primaryValues.length>0||M[F].secondaryValues.length>0).map(F=>{const V=dm(M[F].primaryValues,S),G=dm(M[F].secondaryValues,C);return{[m]:F,[v]:V,[w]:G}});return zv(I,m)||I.sort((F,V)=>(Number(V[v])||0)-(Number(F[v])||0))}const{groupByColumn:s,valueColumn:i,aggregation:o}=e;if(!s||!o)throw new Error("Analysis plan is missing groupByColumn or aggregation type for non-scatter chart.");const u={};n.forEach(m=>{const v=String(m[s]);if(!(v==="undefined"||v==="null"))if(u[v]||(u[v]=[]),i){const S=Nn(m[i]);S!==null&&u[v].push(S)}else o==="count"&&u[v].push(1)});const d=Object.keys(u).filter(m=>u[m].length>0).map(m=>{const v=dm(u[m],o),S=i||"count";return{[s]:m,[S]:v}}),p=zv(d,s);if(p)return p;{const m=i||"count";return d.sort((v,S)=>(Number(S[m])||0)-(Number(v[m])||0))}},tR=new Set(["number","currency","percentage"]),uc=({data:t,schema:e})=>{if(!t||t.length===0)return x.jsx("p",{className:"text-slate-500",children:"No data to display."});const n=(e==null?void 0:e.map(u=>u.name))??Object.keys(t[0]),s=ce.useMemo(()=>{if(!e)return new Map;const u=new Map;return e.forEach(d=>u.set(d.name,d.type)),u},[e]),i=ce.useMemo(()=>{for(const u of n){const d=(s.get(u)??"").toLowerCase();if(tR.has(d))return u}return null},[n,s]),o=ce.useMemo(()=>i?[...t].sort((u,d)=>{const p=Nn(u[i]),m=Nn(d[i]);return p===m?0:p==null?1:m==null?-1:m-p}):t,[t,i]);return x.jsx("div",{className:"w-full text-sm",children:x.jsxs("table",{className:"w-full text-left",children:[x.jsx("thead",{className:"bg-slate-100 text-slate-600",children:x.jsx("tr",{children:n.map(u=>x.jsx("th",{className:"p-2 font-semibold",children:u},u))})}),x.jsx("tbody",{className:"bg-white",children:o.map((u,d)=>x.jsx("tr",{className:"border-b border-slate-200 last:border-b-0",children:n.map(p=>x.jsx("td",{className:"p-2 text-slate-700",children:lc(u[p],0,s.get(p))},`${d}-${p}`))},d))})]})})},T_=async(t,e)=>{try{const n=await htmlToImage.toPng(t,{backgroundColor:"#ffffff",pixelRatio:2}),s=document.createElement("a");s.download=`${e.replace(/ /g,"_")}.png`,s.href=n,s.click()}catch(n){console.error("Error exporting to PNG:",n)}},A_=(t,e)=>{try{const n=Papa.unparse(t),s=new Blob([n],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");i.href=URL.createObjectURL(s),i.setAttribute("download",`${e.replace(/ /g,"_")}.csv`),i.click()}catch(n){console.error("Error exporting to CSV:",n)}},E_=async(t,e,n,s)=>{try{const i=t.querySelector("canvas");if(!i)throw new Error("Chart canvas not found for export.");const o=i.toDataURL("image/png"),u=`
      <table border="1" style="border-collapse: collapse; width: 100%; font-family: sans-serif; color: #333;">
        <thead>
          <tr style="background-color: #f2f2f2;">
            ${Object.keys(n[0]||{}).map(S=>`<th style="padding: 8px;">${S}</th>`).join("")}
          </tr>
        </thead>
        <tbody>
          ${n.map(S=>`
            <tr>
              ${Object.values(S).map(w=>`<td style="padding: 8px;">${w}</td>`).join("")}
            </tr>
          `).join("")}
        </tbody>
      </table>
    `,d=s.replace(/\n/g,"<br>").replace("---","<hr>"),p=`
      <!DOCTYPE html>
      <html lang="en">
        <head>
          <meta charset="UTF-8">
          <title>${e}</title>
          <style> body { font-family: sans-serif; line-height: 1.6; padding: 20px; } h1, h2 { color: #111827; } .card { border: 1px solid #ddd; padding: 20px; border-radius: 8px; margin-bottom: 20px; } </style>
        </head>
        <body>
          <h1>Analysis Report: ${e}</h1>
          <div class="card">
            <h2>Chart</h2>
            <img src="${o}" alt="Chart for ${e}" style="max-width: 100%; border: 1px solid #ddd; border-radius: 4px;">
          </div>
          <div class="card">
            <h2>AI Summary</h2>
            <p>${d}</p>
          </div>
          <div class="card">
            <h2>Data</h2>
            ${u}
          </div>
          <p style="font-size: 0.8em; color: #888;">Generated by CSV Data Analysis Agent on ${new Date().toLocaleString()}</p>
        </body>
      </html>
    `,m=new Blob([p],{type:"text/html;charset=utf-8;"}),v=document.createElement("a");v.href=URL.createObjectURL(m),v.setAttribute("download",`Report_${e.replace(/ /g,"_")}.html`),v.click()}catch(i){console.error("Error exporting to HTML:",i)}},nR=t=>{try{const e=new Blob([JSON.stringify(t,null,2)],{type:"application/json;charset=utf-8;"}),n=document.createElement("a");n.href=URL.createObjectURL(e),n.setAttribute("download",`${t.plan.title.replace(/ /g,"_")}.json`),n.click()}catch(e){console.error("Error exporting JSON:",e)}},sR=({type:t})=>{switch(t){case"bar":return x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:x.jsx("path",{d:"M2 10a1 1 0 011-1h1a1 1 0 011 1v4a1 1 0 01-1 1H3a1 1 0 01-1-1v-4zM8 8a1 1 0 011-1h1a1 1 0 011 1v6a1 1 0 01-1 1H9a1 1 0 01-1-1V8zM14 4a1 1 0 011-1h1a1 1 0 011 1v10a1 1 0 01-1 1h-1a1 1 0 01-1-1V4z"})});case"line":return x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:x.jsx("path",{fillRule:"evenodd",d:"M3 3a1 1 0 000 2v8a1 1 0 001 1h12a1 1 0 100-2H5V3a1 1 0 00-2 0zm12.293 4.293a1 1 0 011.414 0l2 2a1 1 0 01-1.414 1.414L15 8.414l-2.293 2.293a1 1 0 01-1.414 0l-2-2a1 1 0 111.414-1.414L12 7.586l1.293-1.293z",clipRule:"evenodd"})});case"pie":return x.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:[x.jsx("path",{d:"M2 10a8 8 0 018-8v8h8a8 8 0 11-16 0z"}),x.jsx("path",{d:"M12 2.252A8.014 8.014 0 0117.748 8H12V2.252z"})]});case"doughnut":return x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:x.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM7 10a3 3 0 116 0 3 3 0 01-6 0z",clipRule:"evenodd"})});case"scatter":return x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:x.jsx("path",{d:"M5 3a2 2 0 100 4 2 2 0 000-4zM5 13a2 2 0 100 4 2 2 0 000-4zM15 3a2 2 0 100 4 2 2 0 000-4zM15 13a2 2 0 100 4 2 2 0 000-4zM8 8a2 2 0 100 4 2 2 0 000-4zM12 8a2 2 0 100 4 2 2 0 000-4z"})});case"combo":return x.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:[x.jsx("path",{opacity:"0.6",d:"M2 10a1 1 0 011-1h1a1 1 0 011 1v4a1 1 0 01-1 1H3a1 1 0 01-1-1v-4zM8 8a1 1 0 011-1h1a1 1 0 011 1v6a1 1 0 01-1 1H9a1 1 0 01-1-1V8zM14 4a1 1 0 011-1h1a1 1 0 011 1v10a1 1 0 01-1 1h-1a1 1 0 01-1-1V4z"}),x.jsx("path",{fillRule:"evenodd",d:"M3.293 11.293a1 1 0 011.414 0L8 14.586l2.293-2.293a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 15.414l-2.293 2.293a1 1 0 01-1.414 0L3.293 12.707a1 1 0 010-1.414z",clipRule:"evenodd"})]});default:return null}},aR=["bar","line","pie","doughnut","scatter","combo"],rR=({currentType:t,onChange:e})=>x.jsx("div",{className:"flex items-center space-x-1 bg-slate-200 p-1 rounded-md",children:aR.map(n=>x.jsx("button",{onClick:()=>e(n),title:`Switch to ${n} chart`,className:`p-1 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed ${t===n?"bg-blue-600 text-white":"text-slate-500 hover:bg-slate-300 hover:text-slate-700"}`,children:x.jsx(sR,{type:n})},n))}),Kv=["#4e79a7","#f28e2c","#e15759","#76b7b2","#59a14f","#edc949","#af7aa1","#ff9da7","#9c755f","#bab0ab"],iR=({data:t,total:e,groupByKey:n,valueKey:s,hiddenLabels:i,onLabelClick:o})=>{const u=d=>typeof d=="number"?d.toLocaleString(void 0,{maximumFractionDigits:2}):d;return x.jsx("div",{className:"text-sm space-y-1 max-h-48 overflow-y-auto pr-2",children:t.map((d,p)=>{const m=String(d[n]),v=Number(d[s])||0,S=e>0?(v/e*100).toFixed(1):"0.0",w=i.includes(m),C=Kv[p%Kv.length];return x.jsxs("button",{onClick:()=>o(m),className:`w-full flex items-center justify-between p-1.5 rounded-md transition-all duration-200 ${w?"opacity-50":"hover:bg-slate-100"}`,title:`Click to ${w?"show":"hide"} "${m}"`,children:[x.jsxs("div",{className:"flex items-center truncate mr-2",children:[x.jsx("span",{className:"w-3 h-3 rounded-sm mr-2 flex-shrink-0",style:{backgroundColor:w?"#9ca3af":C}}),x.jsx("span",{className:`truncate text-xs ${w?"line-through text-slate-400":"text-slate-700"}`,children:m})]}),x.jsxs("div",{className:"flex items-baseline ml-2 flex-shrink-0",children:[x.jsx("span",{className:`font-semibold text-xs ${w?"text-slate-400":"text-slate-800"}`,children:u(v)}),x.jsxs("span",{className:"text-xs text-slate-500 ml-1.5 w-12 text-right",children:["(",S,"%)"]})]})]},m)})})},oR={},Zv=t=>{let e;const n=new Set,s=(v,S)=>{const w=typeof v=="function"?v(e):v;if(!Object.is(w,e)){const C=e;e=S??(typeof w!="object"||w===null)?w:Object.assign({},e,w),n.forEach(M=>M(e,C))}},i=()=>e,p={setState:s,getState:i,getInitialState:()=>m,subscribe:v=>(n.add(v),()=>n.delete(v)),destroy:()=>{(oR?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},m=e=t(s,i,p);return p},lR=t=>t?Zv(t):Zv;var fm={exports:{}},mm={},pm={exports:{}},hm={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xv;function uR(){if(Xv)return hm;Xv=1;var t=il();function e(S,w){return S===w&&(S!==0||1/S===1/w)||S!==S&&w!==w}var n=typeof Object.is=="function"?Object.is:e,s=t.useState,i=t.useEffect,o=t.useLayoutEffect,u=t.useDebugValue;function d(S,w){var C=w(),M=s({inst:{value:C,getSnapshot:w}}),I=M[0].inst,k=M[1];return o(function(){I.value=C,I.getSnapshot=w,p(I)&&k({inst:I})},[S,C,w]),i(function(){return p(I)&&k({inst:I}),S(function(){p(I)&&k({inst:I})})},[S]),u(C),C}function p(S){var w=S.getSnapshot;S=S.value;try{var C=w();return!n(S,C)}catch{return!0}}function m(S,w){return w()}var v=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?m:d;return hm.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:v,hm}var Wv;function cR(){return Wv||(Wv=1,pm.exports=uR()),pm.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qv;function dR(){if(Qv)return mm;Qv=1;var t=il(),e=cR();function n(m,v){return m===v&&(m!==0||1/m===1/v)||m!==m&&v!==v}var s=typeof Object.is=="function"?Object.is:n,i=e.useSyncExternalStore,o=t.useRef,u=t.useEffect,d=t.useMemo,p=t.useDebugValue;return mm.useSyncExternalStoreWithSelector=function(m,v,S,w,C){var M=o(null);if(M.current===null){var I={hasValue:!1,value:null};M.current=I}else I=M.current;M=d(function(){function F(Q){if(!V){if(V=!0,G=Q,Q=w(Q),C!==void 0&&I.hasValue){var J=I.value;if(C(J,Q))return z=J}return z=Q}if(J=z,s(G,Q))return J;var j=w(Q);return C!==void 0&&C(J,j)?(G=Q,J):(G=Q,z=j)}var V=!1,G,z,ae=S===void 0?null:S;return[function(){return F(v())},ae===null?void 0:function(){return F(ae())}]},[v,S,w,C]);var k=i(m,M[0],M[1]);return u(function(){I.hasValue=!0,I.value=k},[k]),p(k),k},mm}var ex;function fR(){return ex||(ex=1,fm.exports=dR()),fm.exports}var mR=fR();const pR=Op(mR),R_={},{useDebugValue:hR}=$s,{useSyncExternalStoreWithSelector:gR}=pR;let tx=!1;const yR=t=>t;function vR(t,e=yR,n){(R_?"production":void 0)!=="production"&&n&&!tx&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),tx=!0);const s=gR(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,n);return hR(s),s}const nx=t=>{(R_?"production":void 0)!=="production"&&typeof t!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof t=="function"?lR(t):t,n=(s,i)=>vR(e,s,i);return Object.assign(n,e),n},xR=t=>t?nx(t):nx;/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let SR,wR;function _R(){return{geminiUrl:SR,vertexUrl:wR}}function bR(t,e,n,s){var i,o;if(!(t!=null&&t.baseUrl)){const u=_R();return e?(i=u.vertexUrl)!==null&&i!==void 0?i:n:(o=u.geminiUrl)!==null&&o!==void 0?o:s}return t.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ys{}function ge(t,e){const n=/\{([^}]+)\}/g;return t.replace(n,(s,i)=>{if(Object.prototype.hasOwnProperty.call(e,i)){const o=e[i];return o!=null?String(o):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function h(t,e,n){for(let o=0;o<e.length-1;o++){const u=e[o];if(u.endsWith("[]")){const d=u.slice(0,-2);if(!(d in t))if(Array.isArray(n))t[d]=Array.from({length:n.length},()=>({}));else throw new Error(`Value must be a list given an array path ${u}`);if(Array.isArray(t[d])){const p=t[d];if(Array.isArray(n))for(let m=0;m<p.length;m++){const v=p[m];h(v,e.slice(o+1),n[m])}else for(const m of p)h(m,e.slice(o+1),n)}return}else if(u.endsWith("[0]")){const d=u.slice(0,-3);d in t||(t[d]=[{}]);const p=t[d];h(p[0],e.slice(o+1),n);return}(!t[u]||typeof t[u]!="object")&&(t[u]={}),t=t[u]}const s=e[e.length-1],i=t[s];if(i!==void 0){if(!n||typeof n=="object"&&Object.keys(n).length===0||n===i)return;if(typeof i=="object"&&typeof n=="object"&&i!==null&&n!==null)Object.assign(i,n);else throw new Error(`Cannot set value for an existing key. Key: ${s}`)}else s==="_self"&&typeof n=="object"&&n!==null&&!Array.isArray(n)?Object.assign(t,n):t[s]=n}function f(t,e,n=void 0){try{if(e.length===1&&e[0]==="_self")return t;for(let s=0;s<e.length;s++){if(typeof t!="object"||t===null)return n;const i=e[s];if(i.endsWith("[]")){const o=i.slice(0,-2);if(o in t){const u=t[o];return Array.isArray(u)?u.map(d=>f(d,e.slice(s+1),n)):n}else return n}else t=t[i]}return t}catch(s){if(s instanceof TypeError)return n;throw s}}function CR(t,e){for(const[n,s]of Object.entries(e)){const i=n.split("."),o=s.split("."),u=new Set;let d=-1;for(let p=0;p<i.length;p++)if(i[p]==="*"){d=p;break}if(d!==-1&&o.length>d)for(let p=d;p<o.length;p++){const m=o[p];m!=="*"&&!m.endsWith("[]")&&!m.endsWith("[0]")&&u.add(m)}Jm(t,i,o,0,u)}}function Jm(t,e,n,s,i){if(s>=e.length||typeof t!="object"||t===null)return;const o=e[s];if(o.endsWith("[]")){const u=o.slice(0,-2),d=t;if(u in d&&Array.isArray(d[u]))for(const p of d[u])Jm(p,e,n,s+1,i)}else if(o==="*"){if(typeof t=="object"&&t!==null&&!Array.isArray(t)){const u=t,d=Object.keys(u).filter(m=>!m.startsWith("_")&&!i.has(m)),p={};for(const m of d)p[m]=u[m];for(const[m,v]of Object.entries(p)){const S=[];for(const w of n.slice(s))w==="*"?S.push(m):S.push(w);h(u,S,v)}for(const m of d)delete u[m]}}else{const u=t;o in u&&Jm(u[o],e,n,s+1,i)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Bp(t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function TR(t){const e={},n=f(t,["operationName"]);n!=null&&h(e,["operationName"],n);const s=f(t,["resourceName"]);return s!=null&&h(e,["_url","resourceName"],s),e}function AR(t){const e={},n=f(t,["name"]);n!=null&&h(e,["name"],n);const s=f(t,["metadata"]);s!=null&&h(e,["metadata"],s);const i=f(t,["done"]);i!=null&&h(e,["done"],i);const o=f(t,["error"]);o!=null&&h(e,["error"],o);const u=f(t,["response","generateVideoResponse"]);return u!=null&&h(e,["response"],RR(u)),e}function ER(t){const e={},n=f(t,["name"]);n!=null&&h(e,["name"],n);const s=f(t,["metadata"]);s!=null&&h(e,["metadata"],s);const i=f(t,["done"]);i!=null&&h(e,["done"],i);const o=f(t,["error"]);o!=null&&h(e,["error"],o);const u=f(t,["response"]);return u!=null&&h(e,["response"],NR(u)),e}function RR(t){const e={},n=f(t,["generatedSamples"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(u=>MR(u))),h(e,["generatedVideos"],o)}const s=f(t,["raiMediaFilteredCount"]);s!=null&&h(e,["raiMediaFilteredCount"],s);const i=f(t,["raiMediaFilteredReasons"]);return i!=null&&h(e,["raiMediaFilteredReasons"],i),e}function NR(t){const e={},n=f(t,["videos"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(u=>IR(u))),h(e,["generatedVideos"],o)}const s=f(t,["raiMediaFilteredCount"]);s!=null&&h(e,["raiMediaFilteredCount"],s);const i=f(t,["raiMediaFilteredReasons"]);return i!=null&&h(e,["raiMediaFilteredReasons"],i),e}function MR(t){const e={},n=f(t,["video"]);return n!=null&&h(e,["video"],OR(n)),e}function IR(t){const e={},n=f(t,["_self"]);return n!=null&&h(e,["video"],BR(n)),e}function DR(t){const e={},n=f(t,["operationName"]);return n!=null&&h(e,["_url","operationName"],n),e}function PR(t){const e={},n=f(t,["operationName"]);return n!=null&&h(e,["_url","operationName"],n),e}function kR(t){const e={},n=f(t,["name"]);n!=null&&h(e,["name"],n);const s=f(t,["metadata"]);s!=null&&h(e,["metadata"],s);const i=f(t,["done"]);i!=null&&h(e,["done"],i);const o=f(t,["error"]);o!=null&&h(e,["error"],o);const u=f(t,["response"]);return u!=null&&h(e,["response"],LR(u)),e}function LR(t){const e={},n=f(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=f(t,["parent"]);s!=null&&h(e,["parent"],s);const i=f(t,["documentName"]);return i!=null&&h(e,["documentName"],i),e}function N_(t){const e={},n=f(t,["name"]);n!=null&&h(e,["name"],n);const s=f(t,["metadata"]);s!=null&&h(e,["metadata"],s);const i=f(t,["done"]);i!=null&&h(e,["done"],i);const o=f(t,["error"]);o!=null&&h(e,["error"],o);const u=f(t,["response"]);return u!=null&&h(e,["response"],UR(u)),e}function UR(t){const e={},n=f(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=f(t,["parent"]);s!=null&&h(e,["parent"],s);const i=f(t,["documentName"]);return i!=null&&h(e,["documentName"],i),e}function OR(t){const e={},n=f(t,["uri"]);n!=null&&h(e,["uri"],n);const s=f(t,["encodedVideo"]);s!=null&&h(e,["videoBytes"],Bp(s));const i=f(t,["encoding"]);return i!=null&&h(e,["mimeType"],i),e}function BR(t){const e={},n=f(t,["gcsUri"]);n!=null&&h(e,["uri"],n);const s=f(t,["bytesBase64Encoded"]);s!=null&&h(e,["videoBytes"],Bp(s));const i=f(t,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var sx;(function(t){t.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",t.OUTCOME_OK="OUTCOME_OK",t.OUTCOME_FAILED="OUTCOME_FAILED",t.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(sx||(sx={}));var ax;(function(t){t.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",t.PYTHON="PYTHON"})(ax||(ax={}));var rx;(function(t){t.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",t.SILENT="SILENT",t.WHEN_IDLE="WHEN_IDLE",t.INTERRUPT="INTERRUPT"})(rx||(rx={}));var Z;(function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.STRING="STRING",t.NUMBER="NUMBER",t.INTEGER="INTEGER",t.BOOLEAN="BOOLEAN",t.ARRAY="ARRAY",t.OBJECT="OBJECT",t.NULL="NULL"})(Z||(Z={}));var ix;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(ix||(ix={}));var ox;(function(t){t.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",t.SIMPLE_SEARCH="SIMPLE_SEARCH",t.ELASTIC_SEARCH="ELASTIC_SEARCH"})(ox||(ox={}));var lx;(function(t){t.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",t.NO_AUTH="NO_AUTH",t.API_KEY_AUTH="API_KEY_AUTH",t.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",t.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",t.OAUTH="OAUTH",t.OIDC_AUTH="OIDC_AUTH"})(lx||(lx={}));var ux;(function(t){t.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",t.HTTP_IN_QUERY="HTTP_IN_QUERY",t.HTTP_IN_HEADER="HTTP_IN_HEADER",t.HTTP_IN_PATH="HTTP_IN_PATH",t.HTTP_IN_BODY="HTTP_IN_BODY",t.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(ux||(ux={}));var cx;(function(t){t.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",t.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",t.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",t.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(cx||(cx={}));var dx;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",t.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",t.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",t.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",t.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(dx||(dx={}));var fx;(function(t){t.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",t.SEVERITY="SEVERITY",t.PROBABILITY="PROBABILITY"})(fx||(fx={}));var mx;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE",t.OFF="OFF"})(mx||(mx={}));var px;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.IMAGE_SAFETY="IMAGE_SAFETY",t.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",t.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",t.NO_IMAGE="NO_IMAGE"})(px||(px={}));var hx;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(hx||(hx={}));var gx;(function(t){t.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",t.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",t.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",t.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",t.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(gx||(gx={}));var yx;(function(t){t.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",t.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",t.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",t.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",t.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(yx||(yx={}));var vx;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.IMAGE_SAFETY="IMAGE_SAFETY",t.MODEL_ARMOR="MODEL_ARMOR",t.JAILBREAK="JAILBREAK"})(vx||(vx={}));var xx;(function(t){t.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",t.ON_DEMAND="ON_DEMAND",t.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(xx||(xx={}));var cc;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.AUDIO="AUDIO"})(cc||(cc={}));var Sx;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(Sx||(Sx={}));var wx;(function(t){t.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",t.TUNING_MODE_FULL="TUNING_MODE_FULL",t.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(wx||(wx={}));var _x;(function(t){t.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",t.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",t.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",t.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",t.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",t.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",t.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(_x||(_x={}));var Ym;(function(t){t.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",t.JOB_STATE_QUEUED="JOB_STATE_QUEUED",t.JOB_STATE_PENDING="JOB_STATE_PENDING",t.JOB_STATE_RUNNING="JOB_STATE_RUNNING",t.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",t.JOB_STATE_FAILED="JOB_STATE_FAILED",t.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",t.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",t.JOB_STATE_PAUSED="JOB_STATE_PAUSED",t.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",t.JOB_STATE_UPDATING="JOB_STATE_UPDATING",t.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(Ym||(Ym={}));var bx;(function(t){t.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",t.TUNING_TASK_I2V="TUNING_TASK_I2V",t.TUNING_TASK_T2V="TUNING_TASK_T2V",t.TUNING_TASK_R2V="TUNING_TASK_R2V"})(bx||(bx={}));var Cx;(function(t){t.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",t.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",t.BALANCED="BALANCED",t.PRIORITIZE_COST="PRIORITIZE_COST"})(Cx||(Cx={}));var Tx;(function(t){t.UNSPECIFIED="UNSPECIFIED",t.BLOCKING="BLOCKING",t.NON_BLOCKING="NON_BLOCKING"})(Tx||(Tx={}));var Ax;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(Ax||(Ax={}));var Ex;(function(t){t.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",t.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(Ex||(Ex={}));var Rx;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE",t.VALIDATED="VALIDATED"})(Rx||(Rx={}));var Nx;(function(t){t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(Nx||(Nx={}));var Mx;(function(t){t.DONT_ALLOW="DONT_ALLOW",t.ALLOW_ADULT="ALLOW_ADULT",t.ALLOW_ALL="ALLOW_ALL"})(Mx||(Mx={}));var Ix;(function(t){t.auto="auto",t.en="en",t.ja="ja",t.ko="ko",t.hi="hi",t.zh="zh",t.pt="pt",t.es="es"})(Ix||(Ix={}));var Dx;(function(t){t.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",t.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",t.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",t.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",t.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(Dx||(Dx={}));var Px;(function(t){t.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",t.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",t.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",t.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(Px||(Px={}));var kx;(function(t){t.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",t.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",t.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",t.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(kx||(kx={}));var Lx;(function(t){t.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",t.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",t.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",t.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",t.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",t.EDIT_MODE_STYLE="EDIT_MODE_STYLE",t.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",t.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(Lx||(Lx={}));var Ux;(function(t){t.FOREGROUND="FOREGROUND",t.BACKGROUND="BACKGROUND",t.PROMPT="PROMPT",t.SEMANTIC="SEMANTIC",t.INTERACTIVE="INTERACTIVE"})(Ux||(Ux={}));var Ox;(function(t){t.ASSET="ASSET",t.STYLE="STYLE"})(Ox||(Ox={}));var Bx;(function(t){t.INSERT="INSERT",t.REMOVE="REMOVE",t.REMOVE_STATIC="REMOVE_STATIC",t.OUTPAINT="OUTPAINT"})(Bx||(Bx={}));var Vx;(function(t){t.OPTIMIZED="OPTIMIZED",t.LOSSLESS="LOSSLESS"})(Vx||(Vx={}));var qx;(function(t){t.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",t.PREFERENCE_TUNING="PREFERENCE_TUNING"})(qx||(qx={}));var Fx;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.STATE_PENDING="STATE_PENDING",t.STATE_ACTIVE="STATE_ACTIVE",t.STATE_FAILED="STATE_FAILED"})(Fx||(Fx={}));var $x;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.PROCESSING="PROCESSING",t.ACTIVE="ACTIVE",t.FAILED="FAILED"})($x||($x={}));var Gx;(function(t){t.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",t.UPLOADED="UPLOADED",t.GENERATED="GENERATED"})(Gx||(Gx={}));var Hx;(function(t){t.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.RESPONSE_REJECTED="RESPONSE_REJECTED",t.NEED_MORE_INPUT="NEED_MORE_INPUT"})(Hx||(Hx={}));var zx;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.VIDEO="VIDEO",t.AUDIO="AUDIO",t.DOCUMENT="DOCUMENT"})(zx||(zx={}));var jx;(function(t){t.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",t.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",t.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(jx||(jx={}));var Jx;(function(t){t.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",t.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",t.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(Jx||(Jx={}));var Yx;(function(t){t.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",t.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",t.NO_INTERRUPTION="NO_INTERRUPTION"})(Yx||(Yx={}));var Kx;(function(t){t.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",t.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",t.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(Kx||(Kx={}));var Zx;(function(t){t.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",t.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",t.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",t.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",t.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",t.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",t.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",t.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",t.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",t.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",t.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",t.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",t.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(Zx||(Zx={}));var Xx;(function(t){t.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",t.QUALITY="QUALITY",t.DIVERSITY="DIVERSITY",t.VOCALIZATION="VOCALIZATION"})(Xx||(Xx={}));var hi;(function(t){t.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",t.PLAY="PLAY",t.PAUSE="PAUSE",t.STOP="STOP",t.RESET_CONTEXT="RESET_CONTEXT"})(hi||(hi={}));class Km{constructor(e){const n={};for(const s of e.headers.entries())n[s[0]]=s[1];this.headers=n,this.responseInternal=e}json(){return this.responseInternal.json()}}class Lo{get text(){var e,n,s,i,o,u,d,p;if(((i=(s=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let m="",v=!1;const S=[];for(const w of(p=(d=(u=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||u===void 0?void 0:u.content)===null||d===void 0?void 0:d.parts)!==null&&p!==void 0?p:[]){for(const[C,M]of Object.entries(w))C!=="text"&&C!=="thought"&&(M!==null||M!==void 0)&&S.push(C);if(typeof w.text=="string"){if(typeof w.thought=="boolean"&&w.thought)continue;v=!0,m+=w.text}}return S.length>0&&console.warn(`there are non-text parts ${S} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),v?m:void 0}get data(){var e,n,s,i,o,u,d,p;if(((i=(s=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let m="";const v=[];for(const S of(p=(d=(u=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||u===void 0?void 0:u.content)===null||d===void 0?void 0:d.parts)!==null&&p!==void 0?p:[]){for(const[w,C]of Object.entries(S))w!=="inlineData"&&(C!==null||C!==void 0)&&v.push(w);S.inlineData&&typeof S.inlineData.data=="string"&&(m+=atob(S.inlineData.data))}return v.length>0&&console.warn(`there are non-data parts ${v} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),m.length>0?btoa(m):void 0}get functionCalls(){var e,n,s,i,o,u,d,p;if(((i=(s=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const m=(p=(d=(u=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||u===void 0?void 0:u.content)===null||d===void 0?void 0:d.parts)===null||p===void 0?void 0:p.filter(v=>v.functionCall).map(v=>v.functionCall).filter(v=>v!==void 0);if((m==null?void 0:m.length)!==0)return m}get executableCode(){var e,n,s,i,o,u,d,p,m;if(((i=(s=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const v=(p=(d=(u=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||u===void 0?void 0:u.content)===null||d===void 0?void 0:d.parts)===null||p===void 0?void 0:p.filter(S=>S.executableCode).map(S=>S.executableCode).filter(S=>S!==void 0);if((v==null?void 0:v.length)!==0)return(m=v==null?void 0:v[0])===null||m===void 0?void 0:m.code}get codeExecutionResult(){var e,n,s,i,o,u,d,p,m;if(((i=(s=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const v=(p=(d=(u=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||u===void 0?void 0:u.content)===null||d===void 0?void 0:d.parts)===null||p===void 0?void 0:p.filter(S=>S.codeExecutionResult).map(S=>S.codeExecutionResult).filter(S=>S!==void 0);if((v==null?void 0:v.length)!==0)return(m=v==null?void 0:v[0])===null||m===void 0?void 0:m.output}}class Wx{}class Qx{}class VR{}class qR{}class FR{}class $R{}class eS{}class tS{}class nS{}class GR{}class dc{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const s=new dc;let i;const o=e;return n?i=ER(o):i=AR(o),Object.assign(s,i),s}}class sS{}class aS{}class rS{}class HR{}class zR{}class jR{}class Vp{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const s=new Vp,o=kR(e);return Object.assign(s,o),s}}class JR{}class YR{}class KR{}class iS{}class ZR{get text(){var e,n,s;let i="",o=!1;const u=[];for(const d of(s=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&s!==void 0?s:[]){for(const[p,m]of Object.entries(d))p!=="text"&&p!=="thought"&&m!==null&&u.push(p);if(typeof d.text=="string"){if(typeof d.thought=="boolean"&&d.thought)continue;o=!0,i+=d.text}}return u.length>0&&console.warn(`there are non-text parts ${u} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),o?i:void 0}get data(){var e,n,s;let i="";const o=[];for(const u of(s=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&s!==void 0?s:[]){for(const[d,p]of Object.entries(u))d!=="inlineData"&&p!==null&&o.push(d);u.inlineData&&typeof u.inlineData.data=="string"&&(i+=atob(u.inlineData.data))}return o.length>0&&console.warn(`there are non-data parts ${o} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}}class XR{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class qp{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const s=new qp,o=N_(e);return Object.assign(s,o),s}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Qe(t,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(t.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const n=e.split("/",2);return`publishers/${n[0]}/models/${n[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function M_(t,e){const n=Qe(t,e);return n?n.startsWith("publishers/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}`:n.startsWith("models/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/publishers/google/${n}`:n:""}function I_(t){return Array.isArray(t)?t.map(e=>fc(e)):[fc(t)]}function fc(t){if(typeof t=="object"&&t!==null)return t;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof t}`)}function D_(t){const e=fc(t);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function P_(t){const e=fc(t);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function oS(t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function k_(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>oS(e)):[oS(t)]}function Zm(t){return t!=null&&typeof t=="object"&&"parts"in t&&Array.isArray(t.parts)}function lS(t){return t!=null&&typeof t=="object"&&"functionCall"in t}function uS(t){return t!=null&&typeof t=="object"&&"functionResponse"in t}function an(t){if(t==null)throw new Error("ContentUnion is required");return Zm(t)?t:{role:"user",parts:k_(t)}}function Fp(t,e){if(!e)return[];if(t.isVertexAI()&&Array.isArray(e))return e.flatMap(n=>{const s=an(n);return s.parts&&s.parts.length>0&&s.parts[0].text!==void 0?[s.parts[0].text]:[]});if(t.isVertexAI()){const n=an(e);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]}return Array.isArray(e)?e.map(n=>an(n)):[an(e)]}function jn(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t)){if(lS(t)||uS(t))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[an(t)]}const e=[],n=[],s=Zm(t[0]);for(const i of t){const o=Zm(i);if(o!=s)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(o)e.push(i);else{if(lS(i)||uS(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(i)}}return s||e.push({role:"user",parts:k_(n)}),e}function WR(t,e){t.includes("null")&&(e.nullable=!0);const n=t.filter(s=>s!=="null");if(n.length===1)e.type=Object.values(Z).includes(n[0].toUpperCase())?n[0].toUpperCase():Z.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const s of n)e.anyOf.push({type:Object.values(Z).includes(s.toUpperCase())?s.toUpperCase():Z.TYPE_UNSPECIFIED})}}function Si(t){const e={},n=["items"],s=["anyOf"],i=["properties"];if(t.type&&t.anyOf)throw new Error("type and anyOf cannot be both populated.");const o=t.anyOf;o!=null&&o.length==2&&(o[0].type==="null"?(e.nullable=!0,t=o[1]):o[1].type==="null"&&(e.nullable=!0,t=o[0])),t.type instanceof Array&&WR(t.type,e);for(const[u,d]of Object.entries(t))if(d!=null)if(u=="type"){if(d==="null")throw new Error("type: null can not be the only possible type for the field.");if(d instanceof Array)continue;e.type=Object.values(Z).includes(d.toUpperCase())?d.toUpperCase():Z.TYPE_UNSPECIFIED}else if(n.includes(u))e[u]=Si(d);else if(s.includes(u)){const p=[];for(const m of d){if(m.type=="null"){e.nullable=!0;continue}p.push(Si(m))}e[u]=p}else if(i.includes(u)){const p={};for(const[m,v]of Object.entries(d))p[m]=Si(v);e[u]=p}else{if(u==="additionalProperties")continue;e[u]=d}return e}function $p(t){return Si(t)}function Gp(t){if(typeof t=="object")return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function Hp(t){if("multiSpeakerVoiceConfig"in t)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return t}function Li(t){if(t.functionDeclarations)for(const e of t.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=Si(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=Si(e.response));return t}function Ui(t){if(t==null)throw new Error("tools is required");if(!Array.isArray(t))throw new Error("tools is required and must be an array of Tools");const e=[];for(const n of t)e.push(n);return e}function QR(t,e,n,s=1){const i=!e.startsWith(`${n}/`)&&e.split("/").length===s;return t.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${t.getProject()}/${e}`:e.startsWith(`${n}/`)?`projects/${t.getProject()}/locations/${t.getLocation()}/${e}`:i?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}/${e}`:e:i?`${n}/${e}`:e}function Ks(t,e){if(typeof e!="string")throw new Error("name must be a string");return QR(t,e,"cachedContents")}function L_(t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function Va(t){return Bp(t)}function eN(t){return t!=null&&typeof t=="object"&&"name"in t}function tN(t){return t!=null&&typeof t=="object"&&"video"in t}function nN(t){return t!=null&&typeof t=="object"&&"uri"in t}function U_(t){var e;let n;if(eN(t)&&(n=t.name),!(nN(t)&&(n=t.uri,n===void 0))&&!(tN(t)&&(n=(e=t.video)===null||e===void 0?void 0:e.uri,n===void 0))){if(typeof t=="string"&&(n=t),n===void 0)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){const i=n.split("files/")[1].match(/[a-z0-9]+/);if(i===null)throw new Error(`Could not extract file name from URI ${n}`);n=i[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function O_(t,e){let n;return t.isVertexAI()?n=e?"publishers/google/models":"models":n=e?"models":"tunedModels",n}function B_(t){for(const e of["models","tunedModels","publisherModels"])if(sN(t,e))return t[e];return[]}function sN(t,e){return t!==null&&typeof t=="object"&&e in t}function aN(t,e={}){const n=t,s={name:n.name,description:n.description,parametersJsonSchema:n.inputSchema};return n.outputSchema&&(s.responseJsonSchema=n.outputSchema),e.behavior&&(s.behavior=e.behavior),{functionDeclarations:[s]}}function rN(t,e={}){const n=[],s=new Set;for(const i of t){const o=i.name;if(s.has(o))throw new Error(`Duplicate function name ${o} found in MCP tools. Please ensure function names are unique.`);s.add(o);const u=aN(i,e);u.functionDeclarations&&n.push(...u.functionDeclarations)}return{functionDeclarations:n}}function V_(t,e){let n;if(typeof e=="string")if(t.isVertexAI())if(e.startsWith("gs://"))n={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))n={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))n={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(t.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:e}}else n=e;const s=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,i=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(t.isVertexAI()){if(i>0||s!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(s>0||i!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function iN(t){if(typeof t!="string")return t;const e=t;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function q_(t){if(typeof t!="object"||t===null)return{};const e=t,n=e.inlinedResponses;if(typeof n!="object"||n===null)return t;const i=n.inlinedResponses;if(!Array.isArray(i)||i.length===0)return t;let o=!1;for(const u of i){if(typeof u!="object"||u===null)continue;const p=u.response;if(typeof p!="object"||p===null)continue;if(p.embedding!==void 0){o=!0;break}}return o&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),t}function Oi(t,e){const n=e;if(!t.isVertexAI()){if(/batches\/[^/]+$/.test(n))return n.split("/").pop();throw new Error(`Invalid batch job name: ${n}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(n))return n.split("/").pop();if(/^\d+$/.test(n))return n;throw new Error(`Invalid batch job name: ${n}.`)}function F_(t){const e=t;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function oN(t){const e={},n=f(t,["responsesFile"]);n!=null&&h(e,["fileName"],n);const s=f(t,["inlinedResponses","inlinedResponses"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(u=>BN(u))),h(e,["inlinedResponses"],o)}const i=f(t,["inlinedEmbedContentResponses","inlinedResponses"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(u=>u)),h(e,["inlinedEmbedContentResponses"],o)}return e}function lN(t){const e={},n=f(t,["predictionsFormat"]);n!=null&&h(e,["format"],n);const s=f(t,["gcsDestination","outputUriPrefix"]);s!=null&&h(e,["gcsUri"],s);const i=f(t,["bigqueryDestination","outputUri"]);return i!=null&&h(e,["bigqueryUri"],i),e}function uN(t){const e={},n=f(t,["format"]);n!=null&&h(e,["predictionsFormat"],n);const s=f(t,["gcsUri"]);s!=null&&h(e,["gcsDestination","outputUriPrefix"],s);const i=f(t,["bigqueryUri"]);if(i!=null&&h(e,["bigqueryDestination","outputUri"],i),f(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(f(t,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(f(t,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function Xu(t){const e={},n=f(t,["name"]);n!=null&&h(e,["name"],n);const s=f(t,["metadata","displayName"]);s!=null&&h(e,["displayName"],s);const i=f(t,["metadata","state"]);i!=null&&h(e,["state"],F_(i));const o=f(t,["metadata","createTime"]);o!=null&&h(e,["createTime"],o);const u=f(t,["metadata","endTime"]);u!=null&&h(e,["endTime"],u);const d=f(t,["metadata","updateTime"]);d!=null&&h(e,["updateTime"],d);const p=f(t,["metadata","model"]);p!=null&&h(e,["model"],p);const m=f(t,["metadata","output"]);return m!=null&&h(e,["dest"],oN(q_(m))),e}function Xm(t){const e={},n=f(t,["name"]);n!=null&&h(e,["name"],n);const s=f(t,["displayName"]);s!=null&&h(e,["displayName"],s);const i=f(t,["state"]);i!=null&&h(e,["state"],F_(i));const o=f(t,["error"]);o!=null&&h(e,["error"],o);const u=f(t,["createTime"]);u!=null&&h(e,["createTime"],u);const d=f(t,["startTime"]);d!=null&&h(e,["startTime"],d);const p=f(t,["endTime"]);p!=null&&h(e,["endTime"],p);const m=f(t,["updateTime"]);m!=null&&h(e,["updateTime"],m);const v=f(t,["model"]);v!=null&&h(e,["model"],v);const S=f(t,["inputConfig"]);S!=null&&h(e,["src"],cN(S));const w=f(t,["outputConfig"]);w!=null&&h(e,["dest"],lN(q_(w)));const C=f(t,["completionStats"]);return C!=null&&h(e,["completionStats"],C),e}function cN(t){const e={},n=f(t,["instancesFormat"]);n!=null&&h(e,["format"],n);const s=f(t,["gcsSource","uris"]);s!=null&&h(e,["gcsUri"],s);const i=f(t,["bigquerySource","inputUri"]);return i!=null&&h(e,["bigqueryUri"],i),e}function dN(t,e){const n={};if(f(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(f(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(f(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const s=f(e,["fileName"]);s!=null&&h(n,["fileName"],s);const i=f(e,["inlinedRequests"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(u=>ON(t,u))),h(n,["requests","requests"],o)}return n}function fN(t){const e={},n=f(t,["format"]);n!=null&&h(e,["instancesFormat"],n);const s=f(t,["gcsUri"]);s!=null&&h(e,["gcsSource","uris"],s);const i=f(t,["bigqueryUri"]);if(i!=null&&h(e,["bigquerySource","inputUri"],i),f(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(f(t,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function mN(t){const e={},n=f(t,["data"]);if(n!=null&&h(e,["data"],n),f(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=f(t,["mimeType"]);return s!=null&&h(e,["mimeType"],s),e}function pN(t,e){const n={},s=f(e,["name"]);return s!=null&&h(n,["_url","name"],Oi(t,s)),n}function hN(t,e){const n={},s=f(e,["name"]);return s!=null&&h(n,["_url","name"],Oi(t,s)),n}function gN(t){const e={},n=f(t,["content"]);n!=null&&h(e,["content"],n);const s=f(t,["citationMetadata"]);s!=null&&h(e,["citationMetadata"],yN(s));const i=f(t,["tokenCount"]);i!=null&&h(e,["tokenCount"],i);const o=f(t,["finishReason"]);o!=null&&h(e,["finishReason"],o);const u=f(t,["avgLogprobs"]);u!=null&&h(e,["avgLogprobs"],u);const d=f(t,["groundingMetadata"]);d!=null&&h(e,["groundingMetadata"],d);const p=f(t,["index"]);p!=null&&h(e,["index"],p);const m=f(t,["logprobsResult"]);m!=null&&h(e,["logprobsResult"],m);const v=f(t,["safetyRatings"]);if(v!=null){let w=v;Array.isArray(w)&&(w=w.map(C=>C)),h(e,["safetyRatings"],w)}const S=f(t,["urlContextMetadata"]);return S!=null&&h(e,["urlContextMetadata"],S),e}function yN(t){const e={},n=f(t,["citationSources"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(i=>i)),h(e,["citations"],s)}return e}function $_(t){const e={},n=f(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>zN(o))),h(e,["parts"],i)}const s=f(t,["role"]);return s!=null&&h(e,["role"],s),e}function vN(t,e){const n={},s=f(t,["displayName"]);if(e!==void 0&&s!=null&&h(e,["batch","displayName"],s),f(t,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return n}function xN(t,e){const n={},s=f(t,["displayName"]);e!==void 0&&s!=null&&h(e,["displayName"],s);const i=f(t,["dest"]);return e!==void 0&&i!=null&&h(e,["outputConfig"],uN(iN(i))),n}function cS(t,e){const n={},s=f(e,["model"]);s!=null&&h(n,["_url","model"],Qe(t,s));const i=f(e,["src"]);i!=null&&h(n,["batch","inputConfig"],dN(t,V_(t,i)));const o=f(e,["config"]);return o!=null&&vN(o,n),n}function SN(t,e){const n={},s=f(e,["model"]);s!=null&&h(n,["model"],Qe(t,s));const i=f(e,["src"]);i!=null&&h(n,["inputConfig"],fN(V_(t,i)));const o=f(e,["config"]);return o!=null&&xN(o,n),n}function wN(t,e){const n={},s=f(t,["displayName"]);return e!==void 0&&s!=null&&h(e,["batch","displayName"],s),n}function _N(t,e){const n={},s=f(e,["model"]);s!=null&&h(n,["_url","model"],Qe(t,s));const i=f(e,["src"]);i!=null&&h(n,["batch","inputConfig"],NN(t,i));const o=f(e,["config"]);return o!=null&&wN(o,n),n}function bN(t,e){const n={},s=f(e,["name"]);return s!=null&&h(n,["_url","name"],Oi(t,s)),n}function CN(t,e){const n={},s=f(e,["name"]);return s!=null&&h(n,["_url","name"],Oi(t,s)),n}function TN(t){const e={},n=f(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=f(t,["name"]);s!=null&&h(e,["name"],s);const i=f(t,["done"]);i!=null&&h(e,["done"],i);const o=f(t,["error"]);return o!=null&&h(e,["error"],o),e}function AN(t){const e={},n=f(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=f(t,["name"]);s!=null&&h(e,["name"],s);const i=f(t,["done"]);i!=null&&h(e,["done"],i);const o=f(t,["error"]);return o!=null&&h(e,["error"],o),e}function EN(t,e){const n={},s=f(e,["contents"]);if(s!=null){let o=Fp(t,s);Array.isArray(o)&&(o=o.map(u=>u)),h(n,["requests[]","request","content"],o)}const i=f(e,["config"]);return i!=null&&(h(n,["_self"],RN(i,n)),CR(n,{"requests[].*":"requests[].request.*"})),n}function RN(t,e){const n={},s=f(t,["taskType"]);e!==void 0&&s!=null&&h(e,["requests[]","taskType"],s);const i=f(t,["title"]);e!==void 0&&i!=null&&h(e,["requests[]","title"],i);const o=f(t,["outputDimensionality"]);if(e!==void 0&&o!=null&&h(e,["requests[]","outputDimensionality"],o),f(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(f(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function NN(t,e){const n={},s=f(e,["fileName"]);s!=null&&h(n,["file_name"],s);const i=f(e,["inlinedRequests"]);return i!=null&&h(n,["requests"],EN(t,i)),n}function MN(t){const e={};if(f(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=f(t,["fileUri"]);n!=null&&h(e,["fileUri"],n);const s=f(t,["mimeType"]);return s!=null&&h(e,["mimeType"],s),e}function IN(t,e,n){const s={},i=f(e,["systemInstruction"]);n!==void 0&&i!=null&&h(n,["systemInstruction"],$_(an(i)));const o=f(e,["temperature"]);o!=null&&h(s,["temperature"],o);const u=f(e,["topP"]);u!=null&&h(s,["topP"],u);const d=f(e,["topK"]);d!=null&&h(s,["topK"],d);const p=f(e,["candidateCount"]);p!=null&&h(s,["candidateCount"],p);const m=f(e,["maxOutputTokens"]);m!=null&&h(s,["maxOutputTokens"],m);const v=f(e,["stopSequences"]);v!=null&&h(s,["stopSequences"],v);const S=f(e,["responseLogprobs"]);S!=null&&h(s,["responseLogprobs"],S);const w=f(e,["logprobs"]);w!=null&&h(s,["logprobs"],w);const C=f(e,["presencePenalty"]);C!=null&&h(s,["presencePenalty"],C);const M=f(e,["frequencyPenalty"]);M!=null&&h(s,["frequencyPenalty"],M);const I=f(e,["seed"]);I!=null&&h(s,["seed"],I);const k=f(e,["responseMimeType"]);k!=null&&h(s,["responseMimeType"],k);const F=f(e,["responseSchema"]);F!=null&&h(s,["responseSchema"],$p(F));const V=f(e,["responseJsonSchema"]);if(V!=null&&h(s,["responseJsonSchema"],V),f(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(f(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const G=f(e,["safetySettings"]);if(n!==void 0&&G!=null){let _=G;Array.isArray(_)&&(_=_.map(E=>jN(E))),h(n,["safetySettings"],_)}const z=f(e,["tools"]);if(n!==void 0&&z!=null){let _=Ui(z);Array.isArray(_)&&(_=_.map(E=>JN(Li(E)))),h(n,["tools"],_)}const ae=f(e,["toolConfig"]);if(n!==void 0&&ae!=null&&h(n,["toolConfig"],ae),f(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const Q=f(e,["cachedContent"]);n!==void 0&&Q!=null&&h(n,["cachedContent"],Ks(t,Q));const J=f(e,["responseModalities"]);J!=null&&h(s,["responseModalities"],J);const j=f(e,["mediaResolution"]);j!=null&&h(s,["mediaResolution"],j);const X=f(e,["speechConfig"]);if(X!=null&&h(s,["speechConfig"],Gp(X)),f(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const ne=f(e,["thinkingConfig"]);ne!=null&&h(s,["thinkingConfig"],ne);const le=f(e,["imageConfig"]);return le!=null&&h(s,["imageConfig"],le),s}function DN(t){const e={},n=f(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=f(t,["candidates"]);if(s!=null){let p=s;Array.isArray(p)&&(p=p.map(m=>gN(m))),h(e,["candidates"],p)}const i=f(t,["modelVersion"]);i!=null&&h(e,["modelVersion"],i);const o=f(t,["promptFeedback"]);o!=null&&h(e,["promptFeedback"],o);const u=f(t,["responseId"]);u!=null&&h(e,["responseId"],u);const d=f(t,["usageMetadata"]);return d!=null&&h(e,["usageMetadata"],d),e}function PN(t,e){const n={},s=f(e,["name"]);return s!=null&&h(n,["_url","name"],Oi(t,s)),n}function kN(t,e){const n={},s=f(e,["name"]);return s!=null&&h(n,["_url","name"],Oi(t,s)),n}function LN(t){const e={};if(f(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=f(t,["enableWidget"]);return n!=null&&h(e,["enableWidget"],n),e}function UN(t){const e={};if(f(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=f(t,["timeRangeFilter"]);return n!=null&&h(e,["timeRangeFilter"],n),e}function ON(t,e){const n={},s=f(e,["model"]);s!=null&&h(n,["request","model"],Qe(t,s));const i=f(e,["contents"]);if(i!=null){let d=jn(i);Array.isArray(d)&&(d=d.map(p=>$_(p))),h(n,["request","contents"],d)}const o=f(e,["metadata"]);o!=null&&h(n,["metadata"],o);const u=f(e,["config"]);return u!=null&&h(n,["request","generationConfig"],IN(t,u,f(n,["request"],{}))),n}function BN(t){const e={},n=f(t,["response"]);n!=null&&h(e,["response"],DN(n));const s=f(t,["error"]);return s!=null&&h(e,["error"],s),e}function VN(t,e){const n={},s=f(t,["pageSize"]);e!==void 0&&s!=null&&h(e,["_query","pageSize"],s);const i=f(t,["pageToken"]);if(e!==void 0&&i!=null&&h(e,["_query","pageToken"],i),f(t,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return n}function qN(t,e){const n={},s=f(t,["pageSize"]);e!==void 0&&s!=null&&h(e,["_query","pageSize"],s);const i=f(t,["pageToken"]);e!==void 0&&i!=null&&h(e,["_query","pageToken"],i);const o=f(t,["filter"]);return e!==void 0&&o!=null&&h(e,["_query","filter"],o),n}function FN(t){const e={},n=f(t,["config"]);return n!=null&&VN(n,e),e}function $N(t){const e={},n=f(t,["config"]);return n!=null&&qN(n,e),e}function GN(t){const e={},n=f(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=f(t,["nextPageToken"]);s!=null&&h(e,["nextPageToken"],s);const i=f(t,["operations"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(u=>Xu(u))),h(e,["batchJobs"],o)}return e}function HN(t){const e={},n=f(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=f(t,["nextPageToken"]);s!=null&&h(e,["nextPageToken"],s);const i=f(t,["batchPredictionJobs"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(u=>Xm(u))),h(e,["batchJobs"],o)}return e}function zN(t){const e={},n=f(t,["functionCall"]);n!=null&&h(e,["functionCall"],n);const s=f(t,["codeExecutionResult"]);s!=null&&h(e,["codeExecutionResult"],s);const i=f(t,["executableCode"]);i!=null&&h(e,["executableCode"],i);const o=f(t,["fileData"]);o!=null&&h(e,["fileData"],MN(o));const u=f(t,["functionResponse"]);u!=null&&h(e,["functionResponse"],u);const d=f(t,["inlineData"]);d!=null&&h(e,["inlineData"],mN(d));const p=f(t,["text"]);p!=null&&h(e,["text"],p);const m=f(t,["thought"]);m!=null&&h(e,["thought"],m);const v=f(t,["thoughtSignature"]);v!=null&&h(e,["thoughtSignature"],v);const S=f(t,["videoMetadata"]);return S!=null&&h(e,["videoMetadata"],S),e}function jN(t){const e={},n=f(t,["category"]);if(n!=null&&h(e,["category"],n),f(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const s=f(t,["threshold"]);return s!=null&&h(e,["threshold"],s),e}function JN(t){const e={},n=f(t,["functionDeclarations"]);if(n!=null){let v=n;Array.isArray(v)&&(v=v.map(S=>S)),h(e,["functionDeclarations"],v)}if(f(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=f(t,["googleSearchRetrieval"]);s!=null&&h(e,["googleSearchRetrieval"],s);const i=f(t,["computerUse"]);i!=null&&h(e,["computerUse"],i);const o=f(t,["fileSearch"]);o!=null&&h(e,["fileSearch"],o);const u=f(t,["codeExecution"]);if(u!=null&&h(e,["codeExecution"],u),f(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const d=f(t,["googleMaps"]);d!=null&&h(e,["googleMaps"],LN(d));const p=f(t,["googleSearch"]);p!=null&&h(e,["googleSearch"],UN(p));const m=f(t,["urlContext"]);return m!=null&&h(e,["urlContext"],m),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var js;(function(t){t.PAGED_ITEM_BATCH_JOBS="batchJobs",t.PAGED_ITEM_MODELS="models",t.PAGED_ITEM_TUNING_JOBS="tuningJobs",t.PAGED_ITEM_FILES="files",t.PAGED_ITEM_CACHED_CONTENTS="cachedContents",t.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",t.PAGED_ITEM_DOCUMENTS="documents"})(js||(js={}));class wr{constructor(e,n,s,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=n,this.init(e,s,i)}init(e,n,s){var i,o;this.nameInternal=e,this.pageInternal=n[this.nameInternal]||[],this.sdkHttpResponseInternal=n==null?void 0:n.sdkHttpResponse,this.idxInternal=0;let u={config:{}};!s||Object.keys(s).length===0?u={config:{}}:typeof s=="object"?u=Object.assign({},s):u=s,u.config&&(u.config.pageToken=n.nextPageToken),this.paramsInternal=u,this.pageInternalSize=(o=(i=u.config)===null||i===void 0?void 0:i.pageSize)!==null&&o!==void 0?o:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let YN=class extends Ys{constructor(e){super(),this.apiClient=e,this.create=async n=>(this.apiClient.isVertexAI()&&(n.config=this.formatDestination(n.src,n.config)),this.createInternal(n)),this.createEmbeddings=async n=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(n)},this.list=async(n={})=>new wr(js.PAGED_ITEM_BATCH_JOBS,s=>this.listInternal(s),await this.listInternal(n),n)}createInlinedGenerateContentRequest(e){const n=cS(this.apiClient,e),s=n._url,i=ge("{model}:batchGenerateContent",s),d=n.batch.inputConfig.requests,p=d.requests,m=[];for(const v of p){const S=Object.assign({},v);if(S.systemInstruction){const w=S.systemInstruction;delete S.systemInstruction;const C=S.request;C.systemInstruction=w,S.request=C}m.push(S)}return d.requests=m,delete n.config,delete n._url,delete n._query,{path:i,body:n}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,n){const s=n?Object.assign({},n):{},i=Date.now().toString();if(s.displayName||(s.displayName=`genaiBatchJob_${i}`),s.dest===void 0){const o=this.getGcsUri(e),u=this.getBigqueryUri(e);if(o)o.endsWith(".jsonl")?s.dest=`${o.slice(0,-6)}/dest`:s.dest=`${o}_dest_${i}`;else if(u)s.dest=`${u}_dest_${i}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return s}async createInternal(e){var n,s,i,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const m=SN(this.apiClient,e);return d=ge("batchPredictionJobs",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(v=>v.json()),u.then(v=>Xm(v))}else{const m=cS(this.apiClient,e);return d=ge("{model}:batchGenerateContent",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json()),u.then(v=>Xu(v))}}async createEmbeddingsInternal(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=_N(this.apiClient,e);return o=ge("{model}:asyncBatchEmbedContent",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(p=>p.json()),i.then(p=>Xu(p))}}async get(e){var n,s,i,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const m=kN(this.apiClient,e);return d=ge("batchPredictionJobs/{name}",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(v=>v.json()),u.then(v=>Xm(v))}else{const m=PN(this.apiClient,e);return d=ge("batches/{name}",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json()),u.then(v=>Xu(v))}}async cancel(e){var n,s,i,o;let u="",d={};if(this.apiClient.isVertexAI()){const p=hN(this.apiClient,e);u=ge("batchPredictionJobs/{name}:cancel",p._url),d=p._query,delete p._url,delete p._query,await this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}else{const p=pN(this.apiClient,e);u=ge("batches/{name}:cancel",p._url),d=p._query,delete p._url,delete p._query,await this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}}async listInternal(e){var n,s,i,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const m=$N(e);return d=ge("batchPredictionJobs",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(v=>v.json().then(S=>{const w=S;return w.sdkHttpResponse={headers:v.headers},w})),u.then(v=>{const S=HN(v),w=new iS;return Object.assign(w,S),w})}else{const m=FN(e);return d=ge("batches",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json().then(S=>{const w=S;return w.sdkHttpResponse={headers:v.headers},w})),u.then(v=>{const S=GN(v),w=new iS;return Object.assign(w,S),w})}}async delete(e){var n,s,i,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const m=CN(this.apiClient,e);return d=ge("batchPredictionJobs/{name}",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(v=>v.json().then(S=>{const w=S;return w.sdkHttpResponse={headers:v.headers},w})),u.then(v=>AN(v))}else{const m=bN(this.apiClient,e);return d=ge("batches/{name}",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json().then(S=>{const w=S;return w.sdkHttpResponse={headers:v.headers},w})),u.then(v=>TN(v))}}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function KN(t){const e={},n=f(t,["data"]);if(n!=null&&h(e,["data"],n),f(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=f(t,["mimeType"]);return s!=null&&h(e,["mimeType"],s),e}function dS(t){const e={},n=f(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>g1(o))),h(e,["parts"],i)}const s=f(t,["role"]);return s!=null&&h(e,["role"],s),e}function ZN(t,e){const n={},s=f(t,["ttl"]);e!==void 0&&s!=null&&h(e,["ttl"],s);const i=f(t,["expireTime"]);e!==void 0&&i!=null&&h(e,["expireTime"],i);const o=f(t,["displayName"]);e!==void 0&&o!=null&&h(e,["displayName"],o);const u=f(t,["contents"]);if(e!==void 0&&u!=null){let v=jn(u);Array.isArray(v)&&(v=v.map(S=>dS(S))),h(e,["contents"],v)}const d=f(t,["systemInstruction"]);e!==void 0&&d!=null&&h(e,["systemInstruction"],dS(an(d)));const p=f(t,["tools"]);if(e!==void 0&&p!=null){let v=p;Array.isArray(v)&&(v=v.map(S=>y1(S))),h(e,["tools"],v)}const m=f(t,["toolConfig"]);if(e!==void 0&&m!=null&&h(e,["toolConfig"],m),f(t,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return n}function XN(t,e){const n={},s=f(t,["ttl"]);e!==void 0&&s!=null&&h(e,["ttl"],s);const i=f(t,["expireTime"]);e!==void 0&&i!=null&&h(e,["expireTime"],i);const o=f(t,["displayName"]);e!==void 0&&o!=null&&h(e,["displayName"],o);const u=f(t,["contents"]);if(e!==void 0&&u!=null){let S=jn(u);Array.isArray(S)&&(S=S.map(w=>w)),h(e,["contents"],S)}const d=f(t,["systemInstruction"]);e!==void 0&&d!=null&&h(e,["systemInstruction"],an(d));const p=f(t,["tools"]);if(e!==void 0&&p!=null){let S=p;Array.isArray(S)&&(S=S.map(w=>v1(w))),h(e,["tools"],S)}const m=f(t,["toolConfig"]);e!==void 0&&m!=null&&h(e,["toolConfig"],m);const v=f(t,["kmsKeyName"]);return e!==void 0&&v!=null&&h(e,["encryption_spec","kmsKeyName"],v),n}function WN(t,e){const n={},s=f(e,["model"]);s!=null&&h(n,["model"],M_(t,s));const i=f(e,["config"]);return i!=null&&ZN(i,n),n}function QN(t,e){const n={},s=f(e,["model"]);s!=null&&h(n,["model"],M_(t,s));const i=f(e,["config"]);return i!=null&&XN(i,n),n}function e1(t,e){const n={},s=f(e,["name"]);return s!=null&&h(n,["_url","name"],Ks(t,s)),n}function t1(t,e){const n={},s=f(e,["name"]);return s!=null&&h(n,["_url","name"],Ks(t,s)),n}function n1(t){const e={},n=f(t,["sdkHttpResponse"]);return n!=null&&h(e,["sdkHttpResponse"],n),e}function s1(t){const e={},n=f(t,["sdkHttpResponse"]);return n!=null&&h(e,["sdkHttpResponse"],n),e}function a1(t){const e={};if(f(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=f(t,["fileUri"]);n!=null&&h(e,["fileUri"],n);const s=f(t,["mimeType"]);return s!=null&&h(e,["mimeType"],s),e}function r1(t){const e={};if(f(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=f(t,["description"]);n!=null&&h(e,["description"],n);const s=f(t,["name"]);s!=null&&h(e,["name"],s);const i=f(t,["parameters"]);i!=null&&h(e,["parameters"],i);const o=f(t,["parametersJsonSchema"]);o!=null&&h(e,["parametersJsonSchema"],o);const u=f(t,["response"]);u!=null&&h(e,["response"],u);const d=f(t,["responseJsonSchema"]);return d!=null&&h(e,["responseJsonSchema"],d),e}function i1(t,e){const n={},s=f(e,["name"]);return s!=null&&h(n,["_url","name"],Ks(t,s)),n}function o1(t,e){const n={},s=f(e,["name"]);return s!=null&&h(n,["_url","name"],Ks(t,s)),n}function l1(t){const e={};if(f(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=f(t,["enableWidget"]);return n!=null&&h(e,["enableWidget"],n),e}function u1(t){const e={};if(f(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=f(t,["timeRangeFilter"]);return n!=null&&h(e,["timeRangeFilter"],n),e}function c1(t,e){const n={},s=f(t,["pageSize"]);e!==void 0&&s!=null&&h(e,["_query","pageSize"],s);const i=f(t,["pageToken"]);return e!==void 0&&i!=null&&h(e,["_query","pageToken"],i),n}function d1(t,e){const n={},s=f(t,["pageSize"]);e!==void 0&&s!=null&&h(e,["_query","pageSize"],s);const i=f(t,["pageToken"]);return e!==void 0&&i!=null&&h(e,["_query","pageToken"],i),n}function f1(t){const e={},n=f(t,["config"]);return n!=null&&c1(n,e),e}function m1(t){const e={},n=f(t,["config"]);return n!=null&&d1(n,e),e}function p1(t){const e={},n=f(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=f(t,["nextPageToken"]);s!=null&&h(e,["nextPageToken"],s);const i=f(t,["cachedContents"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(u=>u)),h(e,["cachedContents"],o)}return e}function h1(t){const e={},n=f(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=f(t,["nextPageToken"]);s!=null&&h(e,["nextPageToken"],s);const i=f(t,["cachedContents"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(u=>u)),h(e,["cachedContents"],o)}return e}function g1(t){const e={},n=f(t,["functionCall"]);n!=null&&h(e,["functionCall"],n);const s=f(t,["codeExecutionResult"]);s!=null&&h(e,["codeExecutionResult"],s);const i=f(t,["executableCode"]);i!=null&&h(e,["executableCode"],i);const o=f(t,["fileData"]);o!=null&&h(e,["fileData"],a1(o));const u=f(t,["functionResponse"]);u!=null&&h(e,["functionResponse"],u);const d=f(t,["inlineData"]);d!=null&&h(e,["inlineData"],KN(d));const p=f(t,["text"]);p!=null&&h(e,["text"],p);const m=f(t,["thought"]);m!=null&&h(e,["thought"],m);const v=f(t,["thoughtSignature"]);v!=null&&h(e,["thoughtSignature"],v);const S=f(t,["videoMetadata"]);return S!=null&&h(e,["videoMetadata"],S),e}function y1(t){const e={},n=f(t,["functionDeclarations"]);if(n!=null){let v=n;Array.isArray(v)&&(v=v.map(S=>S)),h(e,["functionDeclarations"],v)}if(f(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=f(t,["googleSearchRetrieval"]);s!=null&&h(e,["googleSearchRetrieval"],s);const i=f(t,["computerUse"]);i!=null&&h(e,["computerUse"],i);const o=f(t,["fileSearch"]);o!=null&&h(e,["fileSearch"],o);const u=f(t,["codeExecution"]);if(u!=null&&h(e,["codeExecution"],u),f(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const d=f(t,["googleMaps"]);d!=null&&h(e,["googleMaps"],l1(d));const p=f(t,["googleSearch"]);p!=null&&h(e,["googleSearch"],u1(p));const m=f(t,["urlContext"]);return m!=null&&h(e,["urlContext"],m),e}function v1(t){const e={},n=f(t,["functionDeclarations"]);if(n!=null){let S=n;Array.isArray(S)&&(S=S.map(w=>r1(w))),h(e,["functionDeclarations"],S)}const s=f(t,["retrieval"]);s!=null&&h(e,["retrieval"],s);const i=f(t,["googleSearchRetrieval"]);i!=null&&h(e,["googleSearchRetrieval"],i);const o=f(t,["computerUse"]);if(o!=null&&h(e,["computerUse"],o),f(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const u=f(t,["codeExecution"]);u!=null&&h(e,["codeExecution"],u);const d=f(t,["enterpriseWebSearch"]);d!=null&&h(e,["enterpriseWebSearch"],d);const p=f(t,["googleMaps"]);p!=null&&h(e,["googleMaps"],p);const m=f(t,["googleSearch"]);m!=null&&h(e,["googleSearch"],m);const v=f(t,["urlContext"]);return v!=null&&h(e,["urlContext"],v),e}function x1(t,e){const n={},s=f(t,["ttl"]);e!==void 0&&s!=null&&h(e,["ttl"],s);const i=f(t,["expireTime"]);return e!==void 0&&i!=null&&h(e,["expireTime"],i),n}function S1(t,e){const n={},s=f(t,["ttl"]);e!==void 0&&s!=null&&h(e,["ttl"],s);const i=f(t,["expireTime"]);return e!==void 0&&i!=null&&h(e,["expireTime"],i),n}function w1(t,e){const n={},s=f(e,["name"]);s!=null&&h(n,["_url","name"],Ks(t,s));const i=f(e,["config"]);return i!=null&&x1(i,n),n}function _1(t,e){const n={},s=f(e,["name"]);s!=null&&h(n,["_url","name"],Ks(t,s));const i=f(e,["config"]);return i!=null&&S1(i,n),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class b1 extends Ys{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new wr(js.PAGED_ITEM_CACHED_CONTENTS,s=>this.listInternal(s),await this.listInternal(n),n)}async create(e){var n,s,i,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const m=QN(this.apiClient,e);return d=ge("cachedContents",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(v=>v.json()),u.then(v=>v)}else{const m=WN(this.apiClient,e);return d=ge("cachedContents",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json()),u.then(v=>v)}}async get(e){var n,s,i,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const m=o1(this.apiClient,e);return d=ge("{name}",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(v=>v.json()),u.then(v=>v)}else{const m=i1(this.apiClient,e);return d=ge("{name}",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json()),u.then(v=>v)}}async delete(e){var n,s,i,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const m=t1(this.apiClient,e);return d=ge("{name}",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(v=>v.json().then(S=>{const w=S;return w.sdkHttpResponse={headers:v.headers},w})),u.then(v=>{const S=s1(v),w=new aS;return Object.assign(w,S),w})}else{const m=e1(this.apiClient,e);return d=ge("{name}",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json().then(S=>{const w=S;return w.sdkHttpResponse={headers:v.headers},w})),u.then(v=>{const S=n1(v),w=new aS;return Object.assign(w,S),w})}}async update(e){var n,s,i,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const m=_1(this.apiClient,e);return d=ge("{name}",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(v=>v.json()),u.then(v=>v)}else{const m=w1(this.apiClient,e);return d=ge("{name}",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json()),u.then(v=>v)}}async listInternal(e){var n,s,i,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const m=m1(e);return d=ge("cachedContents",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(v=>v.json().then(S=>{const w=S;return w.sdkHttpResponse={headers:v.headers},w})),u.then(v=>{const S=h1(v),w=new rS;return Object.assign(w,S),w})}else{const m=f1(e);return d=ge("cachedContents",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json().then(S=>{const w=S;return w.sdkHttpResponse={headers:v.headers},w})),u.then(v=>{const S=p1(v),w=new rS;return Object.assign(w,S),w})}}}function fS(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],s=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function gt(t){return this instanceof gt?(this.v=t,this):new gt(t)}function wi(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=n.apply(t,e||[]),i,o=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),d("next"),d("throw"),d("return",u),i[Symbol.asyncIterator]=function(){return this},i;function u(C){return function(M){return Promise.resolve(M).then(C,S)}}function d(C,M){s[C]&&(i[C]=function(I){return new Promise(function(k,F){o.push([C,I,k,F])>1||p(C,I)})},M&&(i[C]=M(i[C])))}function p(C,M){try{m(s[C](M))}catch(I){w(o[0][3],I)}}function m(C){C.value instanceof gt?Promise.resolve(C.value.v).then(v,S):w(o[0][2],C)}function v(C){p("next",C)}function S(C){p("throw",C)}function w(C,M){C(M),o.shift(),o.length&&p(o[0][0],o[0][1])}}function jo(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof fS=="function"?fS(t):t[Symbol.iterator](),n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n);function s(o){n[o]=t[o]&&function(u){return new Promise(function(d,p){u=t[o](u),i(d,p,u.done,u.value)})}}function i(o,u,d,p){Promise.resolve(p).then(function(m){o({value:m,done:d})},u)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function C1(t){var e;if(t.candidates==null||t.candidates.length===0)return!1;const n=(e=t.candidates[0])===null||e===void 0?void 0:e.content;return n===void 0?!1:G_(n)}function G_(t){if(t.parts===void 0||t.parts.length===0)return!1;for(const e of t.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function T1(t){if(t.length!==0){for(const e of t)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function mS(t){if(t===void 0||t.length===0)return[];const e=[],n=t.length;let s=0;for(;s<n;)if(t[s].role==="user")e.push(t[s]),s++;else{const i=[];let o=!0;for(;s<n&&t[s].role==="model";)i.push(t[s]),o&&!G_(t[s])&&(o=!1),s++;o?e.push(...i):e.pop()}return e}class A1{constructor(e,n){this.modelsModule=e,this.apiClient=n}create(e){return new E1(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}let E1=class{constructor(e,n,s,i={},o=[]){this.apiClient=e,this.modelsModule=n,this.model=s,this.config=i,this.history=o,this.sendPromise=Promise.resolve(),T1(o)}async sendMessage(e){var n;await this.sendPromise;const s=an(e.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(s),config:(n=e.config)!==null&&n!==void 0?n:this.config});return this.sendPromise=(async()=>{var o,u,d;const p=await i,m=(u=(o=p.candidates)===null||o===void 0?void 0:o[0])===null||u===void 0?void 0:u.content,v=p.automaticFunctionCallingHistory,S=this.getHistory(!0).length;let w=[];v!=null&&(w=(d=v.slice(S))!==null&&d!==void 0?d:[]);const C=m?[m]:[];this.recordHistory(s,C,w)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),i}async sendMessageStream(e){var n;await this.sendPromise;const s=an(e.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(s),config:(n=e.config)!==null&&n!==void 0?n:this.config});this.sendPromise=i.then(()=>{}).catch(()=>{});const o=await i;return this.processStreamResponse(o,s)}getHistory(e=!1){const n=e?mS(this.history):this.history;return structuredClone(n)}processStreamResponse(e,n){var s,i;return wi(this,arguments,function*(){var u,d,p,m;const v=[];try{for(var S=!0,w=jo(e),C;C=yield gt(w.next()),u=C.done,!u;S=!0){m=C.value,S=!1;const M=m;if(C1(M)){const I=(i=(s=M.candidates)===null||s===void 0?void 0:s[0])===null||i===void 0?void 0:i.content;I!==void 0&&v.push(I)}yield yield gt(M)}}catch(M){d={error:M}}finally{try{!S&&!u&&(p=w.return)&&(yield gt(p.call(w)))}finally{if(d)throw d.error}}this.recordHistory(n,v)})}recordHistory(e,n,s){let i=[];n.length>0&&n.every(o=>o.role!==void 0)?i=n:i.push({role:"model",parts:[]}),s&&s.length>0?this.history.push(...mS(s)):this.history.push(e),this.history.push(...i)}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ec extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,Ec.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function R1(t){const e={},n=f(t,["file"]);return n!=null&&h(e,["file"],n),e}function N1(t){const e={},n=f(t,["sdkHttpResponse"]);return n!=null&&h(e,["sdkHttpResponse"],n),e}function M1(t){const e={},n=f(t,["name"]);return n!=null&&h(e,["_url","file"],U_(n)),e}function I1(t){const e={},n=f(t,["sdkHttpResponse"]);return n!=null&&h(e,["sdkHttpResponse"],n),e}function D1(t){const e={},n=f(t,["name"]);return n!=null&&h(e,["_url","file"],U_(n)),e}function P1(t,e){const n={},s=f(t,["pageSize"]);e!==void 0&&s!=null&&h(e,["_query","pageSize"],s);const i=f(t,["pageToken"]);return e!==void 0&&i!=null&&h(e,["_query","pageToken"],i),n}function k1(t){const e={},n=f(t,["config"]);return n!=null&&P1(n,e),e}function L1(t){const e={},n=f(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=f(t,["nextPageToken"]);s!=null&&h(e,["nextPageToken"],s);const i=f(t,["files"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(u=>u)),h(e,["files"],o)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let U1=class extends Ys{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new wr(js.PAGED_ITEM_FILES,s=>this.listInternal(s),await this.listInternal(n),n)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(n=>n)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=k1(e);return o=ge("files",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(p=>p.json().then(m=>{const v=m;return v.sdkHttpResponse={headers:p.headers},v})),i.then(p=>{const m=L1(p),v=new JR;return Object.assign(v,m),v})}}async createInternal(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=R1(e);return o=ge("upload/v1beta/files",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(p=>p.json()),i.then(p=>{const m=N1(p),v=new YR;return Object.assign(v,m),v})}}async get(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=D1(e);return o=ge("files/{file}",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(p=>p.json()),i.then(p=>p)}}async delete(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=M1(e);return o=ge("files/{file}",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(p=>p.json().then(m=>{const v=m;return v.sdkHttpResponse={headers:p.headers},v})),i.then(p=>{const m=I1(p),v=new KR;return Object.assign(v,m),v})}}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Wu(t){const e={},n=f(t,["data"]);if(n!=null&&h(e,["data"],n),f(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=f(t,["mimeType"]);return s!=null&&h(e,["mimeType"],s),e}function O1(t){const e={},n=f(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>W1(o))),h(e,["parts"],i)}const s=f(t,["role"]);return s!=null&&h(e,["role"],s),e}function B1(t){const e={};if(f(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=f(t,["fileUri"]);n!=null&&h(e,["fileUri"],n);const s=f(t,["mimeType"]);return s!=null&&h(e,["mimeType"],s),e}function V1(t){const e={};if(f(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=f(t,["description"]);n!=null&&h(e,["description"],n);const s=f(t,["name"]);s!=null&&h(e,["name"],s);const i=f(t,["parameters"]);i!=null&&h(e,["parameters"],i);const o=f(t,["parametersJsonSchema"]);o!=null&&h(e,["parametersJsonSchema"],o);const u=f(t,["response"]);u!=null&&h(e,["response"],u);const d=f(t,["responseJsonSchema"]);return d!=null&&h(e,["responseJsonSchema"],d),e}function q1(t){const e={},n=f(t,["modelSelectionConfig"]);n!=null&&h(e,["modelConfig"],n);const s=f(t,["responseJsonSchema"]);s!=null&&h(e,["responseJsonSchema"],s);const i=f(t,["audioTimestamp"]);i!=null&&h(e,["audioTimestamp"],i);const o=f(t,["candidateCount"]);o!=null&&h(e,["candidateCount"],o);const u=f(t,["enableAffectiveDialog"]);u!=null&&h(e,["enableAffectiveDialog"],u);const d=f(t,["frequencyPenalty"]);d!=null&&h(e,["frequencyPenalty"],d);const p=f(t,["logprobs"]);p!=null&&h(e,["logprobs"],p);const m=f(t,["maxOutputTokens"]);m!=null&&h(e,["maxOutputTokens"],m);const v=f(t,["mediaResolution"]);v!=null&&h(e,["mediaResolution"],v);const S=f(t,["presencePenalty"]);S!=null&&h(e,["presencePenalty"],S);const w=f(t,["responseLogprobs"]);w!=null&&h(e,["responseLogprobs"],w);const C=f(t,["responseMimeType"]);C!=null&&h(e,["responseMimeType"],C);const M=f(t,["responseModalities"]);M!=null&&h(e,["responseModalities"],M);const I=f(t,["responseSchema"]);I!=null&&h(e,["responseSchema"],I);const k=f(t,["routingConfig"]);k!=null&&h(e,["routingConfig"],k);const F=f(t,["seed"]);F!=null&&h(e,["seed"],F);const V=f(t,["speechConfig"]);V!=null&&h(e,["speechConfig"],H_(V));const G=f(t,["stopSequences"]);G!=null&&h(e,["stopSequences"],G);const z=f(t,["temperature"]);z!=null&&h(e,["temperature"],z);const ae=f(t,["thinkingConfig"]);ae!=null&&h(e,["thinkingConfig"],ae);const Q=f(t,["topK"]);Q!=null&&h(e,["topK"],Q);const J=f(t,["topP"]);if(J!=null&&h(e,["topP"],J),f(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function F1(t){const e={};if(f(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=f(t,["enableWidget"]);return n!=null&&h(e,["enableWidget"],n),e}function $1(t){const e={};if(f(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=f(t,["timeRangeFilter"]);return n!=null&&h(e,["timeRangeFilter"],n),e}function G1(t,e){const n={},s=f(t,["generationConfig"]);e!==void 0&&s!=null&&h(e,["setup","generationConfig"],s);const i=f(t,["responseModalities"]);e!==void 0&&i!=null&&h(e,["setup","generationConfig","responseModalities"],i);const o=f(t,["temperature"]);e!==void 0&&o!=null&&h(e,["setup","generationConfig","temperature"],o);const u=f(t,["topP"]);e!==void 0&&u!=null&&h(e,["setup","generationConfig","topP"],u);const d=f(t,["topK"]);e!==void 0&&d!=null&&h(e,["setup","generationConfig","topK"],d);const p=f(t,["maxOutputTokens"]);e!==void 0&&p!=null&&h(e,["setup","generationConfig","maxOutputTokens"],p);const m=f(t,["mediaResolution"]);e!==void 0&&m!=null&&h(e,["setup","generationConfig","mediaResolution"],m);const v=f(t,["seed"]);e!==void 0&&v!=null&&h(e,["setup","generationConfig","seed"],v);const S=f(t,["speechConfig"]);e!==void 0&&S!=null&&h(e,["setup","generationConfig","speechConfig"],Hp(S));const w=f(t,["thinkingConfig"]);e!==void 0&&w!=null&&h(e,["setup","generationConfig","thinkingConfig"],w);const C=f(t,["enableAffectiveDialog"]);e!==void 0&&C!=null&&h(e,["setup","generationConfig","enableAffectiveDialog"],C);const M=f(t,["systemInstruction"]);e!==void 0&&M!=null&&h(e,["setup","systemInstruction"],O1(an(M)));const I=f(t,["tools"]);if(e!==void 0&&I!=null){let Q=Ui(I);Array.isArray(Q)&&(Q=Q.map(J=>eM(Li(J)))),h(e,["setup","tools"],Q)}const k=f(t,["sessionResumption"]);e!==void 0&&k!=null&&h(e,["setup","sessionResumption"],Q1(k));const F=f(t,["inputAudioTranscription"]);e!==void 0&&F!=null&&h(e,["setup","inputAudioTranscription"],F);const V=f(t,["outputAudioTranscription"]);e!==void 0&&V!=null&&h(e,["setup","outputAudioTranscription"],V);const G=f(t,["realtimeInputConfig"]);e!==void 0&&G!=null&&h(e,["setup","realtimeInputConfig"],G);const z=f(t,["contextWindowCompression"]);e!==void 0&&z!=null&&h(e,["setup","contextWindowCompression"],z);const ae=f(t,["proactivity"]);return e!==void 0&&ae!=null&&h(e,["setup","proactivity"],ae),n}function H1(t,e){const n={},s=f(t,["generationConfig"]);e!==void 0&&s!=null&&h(e,["setup","generationConfig"],q1(s));const i=f(t,["responseModalities"]);e!==void 0&&i!=null&&h(e,["setup","generationConfig","responseModalities"],i);const o=f(t,["temperature"]);e!==void 0&&o!=null&&h(e,["setup","generationConfig","temperature"],o);const u=f(t,["topP"]);e!==void 0&&u!=null&&h(e,["setup","generationConfig","topP"],u);const d=f(t,["topK"]);e!==void 0&&d!=null&&h(e,["setup","generationConfig","topK"],d);const p=f(t,["maxOutputTokens"]);e!==void 0&&p!=null&&h(e,["setup","generationConfig","maxOutputTokens"],p);const m=f(t,["mediaResolution"]);e!==void 0&&m!=null&&h(e,["setup","generationConfig","mediaResolution"],m);const v=f(t,["seed"]);e!==void 0&&v!=null&&h(e,["setup","generationConfig","seed"],v);const S=f(t,["speechConfig"]);e!==void 0&&S!=null&&h(e,["setup","generationConfig","speechConfig"],H_(Hp(S)));const w=f(t,["thinkingConfig"]);e!==void 0&&w!=null&&h(e,["setup","generationConfig","thinkingConfig"],w);const C=f(t,["enableAffectiveDialog"]);e!==void 0&&C!=null&&h(e,["setup","generationConfig","enableAffectiveDialog"],C);const M=f(t,["systemInstruction"]);e!==void 0&&M!=null&&h(e,["setup","systemInstruction"],an(M));const I=f(t,["tools"]);if(e!==void 0&&I!=null){let Q=Ui(I);Array.isArray(Q)&&(Q=Q.map(J=>tM(Li(J)))),h(e,["setup","tools"],Q)}const k=f(t,["sessionResumption"]);e!==void 0&&k!=null&&h(e,["setup","sessionResumption"],k);const F=f(t,["inputAudioTranscription"]);e!==void 0&&F!=null&&h(e,["setup","inputAudioTranscription"],F);const V=f(t,["outputAudioTranscription"]);e!==void 0&&V!=null&&h(e,["setup","outputAudioTranscription"],V);const G=f(t,["realtimeInputConfig"]);e!==void 0&&G!=null&&h(e,["setup","realtimeInputConfig"],G);const z=f(t,["contextWindowCompression"]);e!==void 0&&z!=null&&h(e,["setup","contextWindowCompression"],z);const ae=f(t,["proactivity"]);return e!==void 0&&ae!=null&&h(e,["setup","proactivity"],ae),n}function z1(t,e){const n={},s=f(e,["model"]);s!=null&&h(n,["setup","model"],Qe(t,s));const i=f(e,["config"]);return i!=null&&h(n,["config"],G1(i,n)),n}function j1(t,e){const n={},s=f(e,["model"]);s!=null&&h(n,["setup","model"],Qe(t,s));const i=f(e,["config"]);return i!=null&&h(n,["config"],H1(i,n)),n}function J1(t){const e={},n=f(t,["musicGenerationConfig"]);return n!=null&&h(e,["musicGenerationConfig"],n),e}function Y1(t){const e={},n=f(t,["weightedPrompts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(i=>i)),h(e,["weightedPrompts"],s)}return e}function K1(t){const e={},n=f(t,["media"]);if(n!=null){let m=I_(n);Array.isArray(m)&&(m=m.map(v=>Wu(v))),h(e,["mediaChunks"],m)}const s=f(t,["audio"]);s!=null&&h(e,["audio"],Wu(P_(s)));const i=f(t,["audioStreamEnd"]);i!=null&&h(e,["audioStreamEnd"],i);const o=f(t,["video"]);o!=null&&h(e,["video"],Wu(D_(o)));const u=f(t,["text"]);u!=null&&h(e,["text"],u);const d=f(t,["activityStart"]);d!=null&&h(e,["activityStart"],d);const p=f(t,["activityEnd"]);return p!=null&&h(e,["activityEnd"],p),e}function Z1(t){const e={},n=f(t,["media"]);if(n!=null){let m=I_(n);Array.isArray(m)&&(m=m.map(v=>v)),h(e,["mediaChunks"],m)}const s=f(t,["audio"]);s!=null&&h(e,["audio"],P_(s));const i=f(t,["audioStreamEnd"]);i!=null&&h(e,["audioStreamEnd"],i);const o=f(t,["video"]);o!=null&&h(e,["video"],D_(o));const u=f(t,["text"]);u!=null&&h(e,["text"],u);const d=f(t,["activityStart"]);d!=null&&h(e,["activityStart"],d);const p=f(t,["activityEnd"]);return p!=null&&h(e,["activityEnd"],p),e}function X1(t){const e={},n=f(t,["setupComplete"]);n!=null&&h(e,["setupComplete"],n);const s=f(t,["serverContent"]);s!=null&&h(e,["serverContent"],s);const i=f(t,["toolCall"]);i!=null&&h(e,["toolCall"],i);const o=f(t,["toolCallCancellation"]);o!=null&&h(e,["toolCallCancellation"],o);const u=f(t,["usageMetadata"]);u!=null&&h(e,["usageMetadata"],nM(u));const d=f(t,["goAway"]);d!=null&&h(e,["goAway"],d);const p=f(t,["sessionResumptionUpdate"]);return p!=null&&h(e,["sessionResumptionUpdate"],p),e}function W1(t){const e={},n=f(t,["functionCall"]);n!=null&&h(e,["functionCall"],n);const s=f(t,["codeExecutionResult"]);s!=null&&h(e,["codeExecutionResult"],s);const i=f(t,["executableCode"]);i!=null&&h(e,["executableCode"],i);const o=f(t,["fileData"]);o!=null&&h(e,["fileData"],B1(o));const u=f(t,["functionResponse"]);u!=null&&h(e,["functionResponse"],u);const d=f(t,["inlineData"]);d!=null&&h(e,["inlineData"],Wu(d));const p=f(t,["text"]);p!=null&&h(e,["text"],p);const m=f(t,["thought"]);m!=null&&h(e,["thought"],m);const v=f(t,["thoughtSignature"]);v!=null&&h(e,["thoughtSignature"],v);const S=f(t,["videoMetadata"]);return S!=null&&h(e,["videoMetadata"],S),e}function Q1(t){const e={},n=f(t,["handle"]);if(n!=null&&h(e,["handle"],n),f(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function H_(t){const e={},n=f(t,["languageCode"]);n!=null&&h(e,["languageCode"],n);const s=f(t,["voiceConfig"]);if(s!=null&&h(e,["voiceConfig"],s),f(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function eM(t){const e={},n=f(t,["functionDeclarations"]);if(n!=null){let v=n;Array.isArray(v)&&(v=v.map(S=>S)),h(e,["functionDeclarations"],v)}if(f(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=f(t,["googleSearchRetrieval"]);s!=null&&h(e,["googleSearchRetrieval"],s);const i=f(t,["computerUse"]);i!=null&&h(e,["computerUse"],i);const o=f(t,["fileSearch"]);o!=null&&h(e,["fileSearch"],o);const u=f(t,["codeExecution"]);if(u!=null&&h(e,["codeExecution"],u),f(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const d=f(t,["googleMaps"]);d!=null&&h(e,["googleMaps"],F1(d));const p=f(t,["googleSearch"]);p!=null&&h(e,["googleSearch"],$1(p));const m=f(t,["urlContext"]);return m!=null&&h(e,["urlContext"],m),e}function tM(t){const e={},n=f(t,["functionDeclarations"]);if(n!=null){let S=n;Array.isArray(S)&&(S=S.map(w=>V1(w))),h(e,["functionDeclarations"],S)}const s=f(t,["retrieval"]);s!=null&&h(e,["retrieval"],s);const i=f(t,["googleSearchRetrieval"]);i!=null&&h(e,["googleSearchRetrieval"],i);const o=f(t,["computerUse"]);if(o!=null&&h(e,["computerUse"],o),f(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const u=f(t,["codeExecution"]);u!=null&&h(e,["codeExecution"],u);const d=f(t,["enterpriseWebSearch"]);d!=null&&h(e,["enterpriseWebSearch"],d);const p=f(t,["googleMaps"]);p!=null&&h(e,["googleMaps"],p);const m=f(t,["googleSearch"]);m!=null&&h(e,["googleSearch"],m);const v=f(t,["urlContext"]);return v!=null&&h(e,["urlContext"],v),e}function nM(t){const e={},n=f(t,["promptTokenCount"]);n!=null&&h(e,["promptTokenCount"],n);const s=f(t,["cachedContentTokenCount"]);s!=null&&h(e,["cachedContentTokenCount"],s);const i=f(t,["candidatesTokenCount"]);i!=null&&h(e,["responseTokenCount"],i);const o=f(t,["toolUsePromptTokenCount"]);o!=null&&h(e,["toolUsePromptTokenCount"],o);const u=f(t,["thoughtsTokenCount"]);u!=null&&h(e,["thoughtsTokenCount"],u);const d=f(t,["totalTokenCount"]);d!=null&&h(e,["totalTokenCount"],d);const p=f(t,["promptTokensDetails"]);if(p!=null){let C=p;Array.isArray(C)&&(C=C.map(M=>M)),h(e,["promptTokensDetails"],C)}const m=f(t,["cacheTokensDetails"]);if(m!=null){let C=m;Array.isArray(C)&&(C=C.map(M=>M)),h(e,["cacheTokensDetails"],C)}const v=f(t,["candidatesTokensDetails"]);if(v!=null){let C=v;Array.isArray(C)&&(C=C.map(M=>M)),h(e,["responseTokensDetails"],C)}const S=f(t,["toolUsePromptTokensDetails"]);if(S!=null){let C=S;Array.isArray(C)&&(C=C.map(M=>M)),h(e,["toolUsePromptTokensDetails"],C)}const w=f(t,["trafficType"]);return w!=null&&h(e,["trafficType"],w),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function sM(t){const e={},n=f(t,["data"]);if(n!=null&&h(e,["data"],n),f(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=f(t,["mimeType"]);return s!=null&&h(e,["mimeType"],s),e}function aM(t){const e={},n=f(t,["content"]);n!=null&&h(e,["content"],n);const s=f(t,["citationMetadata"]);s!=null&&h(e,["citationMetadata"],rM(s));const i=f(t,["tokenCount"]);i!=null&&h(e,["tokenCount"],i);const o=f(t,["finishReason"]);o!=null&&h(e,["finishReason"],o);const u=f(t,["avgLogprobs"]);u!=null&&h(e,["avgLogprobs"],u);const d=f(t,["groundingMetadata"]);d!=null&&h(e,["groundingMetadata"],d);const p=f(t,["index"]);p!=null&&h(e,["index"],p);const m=f(t,["logprobsResult"]);m!=null&&h(e,["logprobsResult"],m);const v=f(t,["safetyRatings"]);if(v!=null){let w=v;Array.isArray(w)&&(w=w.map(C=>C)),h(e,["safetyRatings"],w)}const S=f(t,["urlContextMetadata"]);return S!=null&&h(e,["urlContextMetadata"],S),e}function rM(t){const e={},n=f(t,["citationSources"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(i=>i)),h(e,["citations"],s)}return e}function iM(t,e){const n={},s=f(e,["model"]);s!=null&&h(n,["_url","model"],Qe(t,s));const i=f(e,["contents"]);if(i!=null){let o=jn(i);Array.isArray(o)&&(o=o.map(u=>u)),h(n,["contents"],o)}return n}function oM(t){const e={},n=f(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=f(t,["tokensInfo"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(o=>o)),h(e,["tokensInfo"],i)}return e}function lM(t){const e={},n=f(t,["values"]);n!=null&&h(e,["values"],n);const s=f(t,["statistics"]);return s!=null&&h(e,["statistics"],uM(s)),e}function uM(t){const e={},n=f(t,["truncated"]);n!=null&&h(e,["truncated"],n);const s=f(t,["token_count"]);return s!=null&&h(e,["tokenCount"],s),e}function Rc(t){const e={},n=f(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>pI(o))),h(e,["parts"],i)}const s=f(t,["role"]);return s!=null&&h(e,["role"],s),e}function cM(t){const e={},n=f(t,["controlType"]);n!=null&&h(e,["controlType"],n);const s=f(t,["enableControlImageComputation"]);return s!=null&&h(e,["computeControl"],s),e}function dM(t){const e={};if(f(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(f(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(f(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function fM(t,e){const n={},s=f(t,["systemInstruction"]);e!==void 0&&s!=null&&h(e,["systemInstruction"],an(s));const i=f(t,["tools"]);if(e!==void 0&&i!=null){let u=i;Array.isArray(u)&&(u=u.map(d=>K_(d))),h(e,["tools"],u)}const o=f(t,["generationConfig"]);return e!==void 0&&o!=null&&h(e,["generationConfig"],tI(o)),n}function mM(t,e){const n={},s=f(e,["model"]);s!=null&&h(n,["_url","model"],Qe(t,s));const i=f(e,["contents"]);if(i!=null){let u=jn(i);Array.isArray(u)&&(u=u.map(d=>Rc(d))),h(n,["contents"],u)}const o=f(e,["config"]);return o!=null&&dM(o),n}function pM(t,e){const n={},s=f(e,["model"]);s!=null&&h(n,["_url","model"],Qe(t,s));const i=f(e,["contents"]);if(i!=null){let u=jn(i);Array.isArray(u)&&(u=u.map(d=>d)),h(n,["contents"],u)}const o=f(e,["config"]);return o!=null&&fM(o,n),n}function hM(t){const e={},n=f(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=f(t,["totalTokens"]);s!=null&&h(e,["totalTokens"],s);const i=f(t,["cachedContentTokenCount"]);return i!=null&&h(e,["cachedContentTokenCount"],i),e}function gM(t){const e={},n=f(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=f(t,["totalTokens"]);return s!=null&&h(e,["totalTokens"],s),e}function yM(t,e){const n={},s=f(e,["model"]);return s!=null&&h(n,["_url","name"],Qe(t,s)),n}function vM(t,e){const n={},s=f(e,["model"]);return s!=null&&h(n,["_url","name"],Qe(t,s)),n}function xM(t){const e={},n=f(t,["sdkHttpResponse"]);return n!=null&&h(e,["sdkHttpResponse"],n),e}function SM(t){const e={},n=f(t,["sdkHttpResponse"]);return n!=null&&h(e,["sdkHttpResponse"],n),e}function wM(t,e){const n={},s=f(t,["outputGcsUri"]);e!==void 0&&s!=null&&h(e,["parameters","storageUri"],s);const i=f(t,["negativePrompt"]);e!==void 0&&i!=null&&h(e,["parameters","negativePrompt"],i);const o=f(t,["numberOfImages"]);e!==void 0&&o!=null&&h(e,["parameters","sampleCount"],o);const u=f(t,["aspectRatio"]);e!==void 0&&u!=null&&h(e,["parameters","aspectRatio"],u);const d=f(t,["guidanceScale"]);e!==void 0&&d!=null&&h(e,["parameters","guidanceScale"],d);const p=f(t,["seed"]);e!==void 0&&p!=null&&h(e,["parameters","seed"],p);const m=f(t,["safetyFilterLevel"]);e!==void 0&&m!=null&&h(e,["parameters","safetySetting"],m);const v=f(t,["personGeneration"]);e!==void 0&&v!=null&&h(e,["parameters","personGeneration"],v);const S=f(t,["includeSafetyAttributes"]);e!==void 0&&S!=null&&h(e,["parameters","includeSafetyAttributes"],S);const w=f(t,["includeRaiReason"]);e!==void 0&&w!=null&&h(e,["parameters","includeRaiReason"],w);const C=f(t,["language"]);e!==void 0&&C!=null&&h(e,["parameters","language"],C);const M=f(t,["outputMimeType"]);e!==void 0&&M!=null&&h(e,["parameters","outputOptions","mimeType"],M);const I=f(t,["outputCompressionQuality"]);e!==void 0&&I!=null&&h(e,["parameters","outputOptions","compressionQuality"],I);const k=f(t,["addWatermark"]);e!==void 0&&k!=null&&h(e,["parameters","addWatermark"],k);const F=f(t,["labels"]);e!==void 0&&F!=null&&h(e,["labels"],F);const V=f(t,["editMode"]);e!==void 0&&V!=null&&h(e,["parameters","editMode"],V);const G=f(t,["baseSteps"]);return e!==void 0&&G!=null&&h(e,["parameters","editConfig","baseSteps"],G),n}function _M(t,e){const n={},s=f(e,["model"]);s!=null&&h(n,["_url","model"],Qe(t,s));const i=f(e,["prompt"]);i!=null&&h(n,["instances[0]","prompt"],i);const o=f(e,["referenceImages"]);if(o!=null){let d=o;Array.isArray(d)&&(d=d.map(p=>SI(p))),h(n,["instances[0]","referenceImages"],d)}const u=f(e,["config"]);return u!=null&&wM(u,n),n}function bM(t){const e={},n=f(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=f(t,["predictions"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(o=>Nc(o))),h(e,["generatedImages"],i)}return e}function CM(t,e){const n={},s=f(t,["taskType"]);e!==void 0&&s!=null&&h(e,["requests[]","taskType"],s);const i=f(t,["title"]);e!==void 0&&i!=null&&h(e,["requests[]","title"],i);const o=f(t,["outputDimensionality"]);if(e!==void 0&&o!=null&&h(e,["requests[]","outputDimensionality"],o),f(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(f(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function TM(t,e){const n={},s=f(t,["taskType"]);e!==void 0&&s!=null&&h(e,["instances[]","task_type"],s);const i=f(t,["title"]);e!==void 0&&i!=null&&h(e,["instances[]","title"],i);const o=f(t,["outputDimensionality"]);e!==void 0&&o!=null&&h(e,["parameters","outputDimensionality"],o);const u=f(t,["mimeType"]);e!==void 0&&u!=null&&h(e,["instances[]","mimeType"],u);const d=f(t,["autoTruncate"]);return e!==void 0&&d!=null&&h(e,["parameters","autoTruncate"],d),n}function AM(t,e){const n={},s=f(e,["model"]);s!=null&&h(n,["_url","model"],Qe(t,s));const i=f(e,["contents"]);if(i!=null){let d=Fp(t,i);Array.isArray(d)&&(d=d.map(p=>p)),h(n,["requests[]","content"],d)}const o=f(e,["config"]);o!=null&&CM(o,n);const u=f(e,["model"]);return u!==void 0&&h(n,["requests[]","model"],Qe(t,u)),n}function EM(t,e){const n={},s=f(e,["model"]);s!=null&&h(n,["_url","model"],Qe(t,s));const i=f(e,["contents"]);if(i!=null){let u=Fp(t,i);Array.isArray(u)&&(u=u.map(d=>d)),h(n,["instances[]","content"],u)}const o=f(e,["config"]);return o!=null&&TM(o,n),n}function RM(t){const e={},n=f(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=f(t,["embeddings"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(u=>u)),h(e,["embeddings"],o)}const i=f(t,["metadata"]);return i!=null&&h(e,["metadata"],i),e}function NM(t){const e={},n=f(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=f(t,["predictions[]","embeddings"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(u=>lM(u))),h(e,["embeddings"],o)}const i=f(t,["metadata"]);return i!=null&&h(e,["metadata"],i),e}function MM(t){const e={},n=f(t,["endpoint"]);n!=null&&h(e,["name"],n);const s=f(t,["deployedModelId"]);return s!=null&&h(e,["deployedModelId"],s),e}function IM(t){const e={};if(f(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=f(t,["fileUri"]);n!=null&&h(e,["fileUri"],n);const s=f(t,["mimeType"]);return s!=null&&h(e,["mimeType"],s),e}function DM(t){const e={};if(f(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=f(t,["description"]);n!=null&&h(e,["description"],n);const s=f(t,["name"]);s!=null&&h(e,["name"],s);const i=f(t,["parameters"]);i!=null&&h(e,["parameters"],i);const o=f(t,["parametersJsonSchema"]);o!=null&&h(e,["parametersJsonSchema"],o);const u=f(t,["response"]);u!=null&&h(e,["response"],u);const d=f(t,["responseJsonSchema"]);return d!=null&&h(e,["responseJsonSchema"],d),e}function PM(t,e,n){const s={},i=f(e,["systemInstruction"]);n!==void 0&&i!=null&&h(n,["systemInstruction"],Rc(an(i)));const o=f(e,["temperature"]);o!=null&&h(s,["temperature"],o);const u=f(e,["topP"]);u!=null&&h(s,["topP"],u);const d=f(e,["topK"]);d!=null&&h(s,["topK"],d);const p=f(e,["candidateCount"]);p!=null&&h(s,["candidateCount"],p);const m=f(e,["maxOutputTokens"]);m!=null&&h(s,["maxOutputTokens"],m);const v=f(e,["stopSequences"]);v!=null&&h(s,["stopSequences"],v);const S=f(e,["responseLogprobs"]);S!=null&&h(s,["responseLogprobs"],S);const w=f(e,["logprobs"]);w!=null&&h(s,["logprobs"],w);const C=f(e,["presencePenalty"]);C!=null&&h(s,["presencePenalty"],C);const M=f(e,["frequencyPenalty"]);M!=null&&h(s,["frequencyPenalty"],M);const I=f(e,["seed"]);I!=null&&h(s,["seed"],I);const k=f(e,["responseMimeType"]);k!=null&&h(s,["responseMimeType"],k);const F=f(e,["responseSchema"]);F!=null&&h(s,["responseSchema"],$p(F));const V=f(e,["responseJsonSchema"]);if(V!=null&&h(s,["responseJsonSchema"],V),f(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(f(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const G=f(e,["safetySettings"]);if(n!==void 0&&G!=null){let _=G;Array.isArray(_)&&(_=_.map(E=>wI(E))),h(n,["safetySettings"],_)}const z=f(e,["tools"]);if(n!==void 0&&z!=null){let _=Ui(z);Array.isArray(_)&&(_=_.map(E=>EI(Li(E)))),h(n,["tools"],_)}const ae=f(e,["toolConfig"]);if(n!==void 0&&ae!=null&&h(n,["toolConfig"],ae),f(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const Q=f(e,["cachedContent"]);n!==void 0&&Q!=null&&h(n,["cachedContent"],Ks(t,Q));const J=f(e,["responseModalities"]);J!=null&&h(s,["responseModalities"],J);const j=f(e,["mediaResolution"]);j!=null&&h(s,["mediaResolution"],j);const X=f(e,["speechConfig"]);if(X!=null&&h(s,["speechConfig"],Gp(X)),f(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const ne=f(e,["thinkingConfig"]);ne!=null&&h(s,["thinkingConfig"],ne);const le=f(e,["imageConfig"]);return le!=null&&h(s,["imageConfig"],le),s}function kM(t,e,n){const s={},i=f(e,["systemInstruction"]);n!==void 0&&i!=null&&h(n,["systemInstruction"],an(i));const o=f(e,["temperature"]);o!=null&&h(s,["temperature"],o);const u=f(e,["topP"]);u!=null&&h(s,["topP"],u);const d=f(e,["topK"]);d!=null&&h(s,["topK"],d);const p=f(e,["candidateCount"]);p!=null&&h(s,["candidateCount"],p);const m=f(e,["maxOutputTokens"]);m!=null&&h(s,["maxOutputTokens"],m);const v=f(e,["stopSequences"]);v!=null&&h(s,["stopSequences"],v);const S=f(e,["responseLogprobs"]);S!=null&&h(s,["responseLogprobs"],S);const w=f(e,["logprobs"]);w!=null&&h(s,["logprobs"],w);const C=f(e,["presencePenalty"]);C!=null&&h(s,["presencePenalty"],C);const M=f(e,["frequencyPenalty"]);M!=null&&h(s,["frequencyPenalty"],M);const I=f(e,["seed"]);I!=null&&h(s,["seed"],I);const k=f(e,["responseMimeType"]);k!=null&&h(s,["responseMimeType"],k);const F=f(e,["responseSchema"]);F!=null&&h(s,["responseSchema"],$p(F));const V=f(e,["responseJsonSchema"]);V!=null&&h(s,["responseJsonSchema"],V);const G=f(e,["routingConfig"]);G!=null&&h(s,["routingConfig"],G);const z=f(e,["modelSelectionConfig"]);z!=null&&h(s,["modelConfig"],z);const ae=f(e,["safetySettings"]);if(n!==void 0&&ae!=null){let T=ae;Array.isArray(T)&&(T=T.map(R=>R)),h(n,["safetySettings"],T)}const Q=f(e,["tools"]);if(n!==void 0&&Q!=null){let T=Ui(Q);Array.isArray(T)&&(T=T.map(R=>K_(Li(R)))),h(n,["tools"],T)}const J=f(e,["toolConfig"]);n!==void 0&&J!=null&&h(n,["toolConfig"],J);const j=f(e,["labels"]);n!==void 0&&j!=null&&h(n,["labels"],j);const X=f(e,["cachedContent"]);n!==void 0&&X!=null&&h(n,["cachedContent"],Ks(t,X));const ne=f(e,["responseModalities"]);ne!=null&&h(s,["responseModalities"],ne);const le=f(e,["mediaResolution"]);le!=null&&h(s,["mediaResolution"],le);const _=f(e,["speechConfig"]);_!=null&&h(s,["speechConfig"],Y_(Gp(_)));const E=f(e,["audioTimestamp"]);E!=null&&h(s,["audioTimestamp"],E);const P=f(e,["thinkingConfig"]);P!=null&&h(s,["thinkingConfig"],P);const D=f(e,["imageConfig"]);return D!=null&&h(s,["imageConfig"],D),s}function pS(t,e){const n={},s=f(e,["model"]);s!=null&&h(n,["_url","model"],Qe(t,s));const i=f(e,["contents"]);if(i!=null){let u=jn(i);Array.isArray(u)&&(u=u.map(d=>Rc(d))),h(n,["contents"],u)}const o=f(e,["config"]);return o!=null&&h(n,["generationConfig"],PM(t,o,n)),n}function hS(t,e){const n={},s=f(e,["model"]);s!=null&&h(n,["_url","model"],Qe(t,s));const i=f(e,["contents"]);if(i!=null){let u=jn(i);Array.isArray(u)&&(u=u.map(d=>d)),h(n,["contents"],u)}const o=f(e,["config"]);return o!=null&&h(n,["generationConfig"],kM(t,o,n)),n}function gS(t){const e={},n=f(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=f(t,["candidates"]);if(s!=null){let p=s;Array.isArray(p)&&(p=p.map(m=>aM(m))),h(e,["candidates"],p)}const i=f(t,["modelVersion"]);i!=null&&h(e,["modelVersion"],i);const o=f(t,["promptFeedback"]);o!=null&&h(e,["promptFeedback"],o);const u=f(t,["responseId"]);u!=null&&h(e,["responseId"],u);const d=f(t,["usageMetadata"]);return d!=null&&h(e,["usageMetadata"],d),e}function yS(t){const e={},n=f(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=f(t,["candidates"]);if(s!=null){let m=s;Array.isArray(m)&&(m=m.map(v=>v)),h(e,["candidates"],m)}const i=f(t,["createTime"]);i!=null&&h(e,["createTime"],i);const o=f(t,["modelVersion"]);o!=null&&h(e,["modelVersion"],o);const u=f(t,["promptFeedback"]);u!=null&&h(e,["promptFeedback"],u);const d=f(t,["responseId"]);d!=null&&h(e,["responseId"],d);const p=f(t,["usageMetadata"]);return p!=null&&h(e,["usageMetadata"],p),e}function LM(t,e){const n={};if(f(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(f(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const s=f(t,["numberOfImages"]);e!==void 0&&s!=null&&h(e,["parameters","sampleCount"],s);const i=f(t,["aspectRatio"]);e!==void 0&&i!=null&&h(e,["parameters","aspectRatio"],i);const o=f(t,["guidanceScale"]);if(e!==void 0&&o!=null&&h(e,["parameters","guidanceScale"],o),f(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const u=f(t,["safetyFilterLevel"]);e!==void 0&&u!=null&&h(e,["parameters","safetySetting"],u);const d=f(t,["personGeneration"]);e!==void 0&&d!=null&&h(e,["parameters","personGeneration"],d);const p=f(t,["includeSafetyAttributes"]);e!==void 0&&p!=null&&h(e,["parameters","includeSafetyAttributes"],p);const m=f(t,["includeRaiReason"]);e!==void 0&&m!=null&&h(e,["parameters","includeRaiReason"],m);const v=f(t,["language"]);e!==void 0&&v!=null&&h(e,["parameters","language"],v);const S=f(t,["outputMimeType"]);e!==void 0&&S!=null&&h(e,["parameters","outputOptions","mimeType"],S);const w=f(t,["outputCompressionQuality"]);if(e!==void 0&&w!=null&&h(e,["parameters","outputOptions","compressionQuality"],w),f(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(f(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const C=f(t,["imageSize"]);if(e!==void 0&&C!=null&&h(e,["parameters","sampleImageSize"],C),f(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function UM(t,e){const n={},s=f(t,["outputGcsUri"]);e!==void 0&&s!=null&&h(e,["parameters","storageUri"],s);const i=f(t,["negativePrompt"]);e!==void 0&&i!=null&&h(e,["parameters","negativePrompt"],i);const o=f(t,["numberOfImages"]);e!==void 0&&o!=null&&h(e,["parameters","sampleCount"],o);const u=f(t,["aspectRatio"]);e!==void 0&&u!=null&&h(e,["parameters","aspectRatio"],u);const d=f(t,["guidanceScale"]);e!==void 0&&d!=null&&h(e,["parameters","guidanceScale"],d);const p=f(t,["seed"]);e!==void 0&&p!=null&&h(e,["parameters","seed"],p);const m=f(t,["safetyFilterLevel"]);e!==void 0&&m!=null&&h(e,["parameters","safetySetting"],m);const v=f(t,["personGeneration"]);e!==void 0&&v!=null&&h(e,["parameters","personGeneration"],v);const S=f(t,["includeSafetyAttributes"]);e!==void 0&&S!=null&&h(e,["parameters","includeSafetyAttributes"],S);const w=f(t,["includeRaiReason"]);e!==void 0&&w!=null&&h(e,["parameters","includeRaiReason"],w);const C=f(t,["language"]);e!==void 0&&C!=null&&h(e,["parameters","language"],C);const M=f(t,["outputMimeType"]);e!==void 0&&M!=null&&h(e,["parameters","outputOptions","mimeType"],M);const I=f(t,["outputCompressionQuality"]);e!==void 0&&I!=null&&h(e,["parameters","outputOptions","compressionQuality"],I);const k=f(t,["addWatermark"]);e!==void 0&&k!=null&&h(e,["parameters","addWatermark"],k);const F=f(t,["labels"]);e!==void 0&&F!=null&&h(e,["labels"],F);const V=f(t,["imageSize"]);e!==void 0&&V!=null&&h(e,["parameters","sampleImageSize"],V);const G=f(t,["enhancePrompt"]);return e!==void 0&&G!=null&&h(e,["parameters","enhancePrompt"],G),n}function OM(t,e){const n={},s=f(e,["model"]);s!=null&&h(n,["_url","model"],Qe(t,s));const i=f(e,["prompt"]);i!=null&&h(n,["instances[0]","prompt"],i);const o=f(e,["config"]);return o!=null&&LM(o,n),n}function BM(t,e){const n={},s=f(e,["model"]);s!=null&&h(n,["_url","model"],Qe(t,s));const i=f(e,["prompt"]);i!=null&&h(n,["instances[0]","prompt"],i);const o=f(e,["config"]);return o!=null&&UM(o,n),n}function VM(t){const e={},n=f(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=f(t,["predictions"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(u=>XM(u))),h(e,["generatedImages"],o)}const i=f(t,["positivePromptSafetyAttributes"]);return i!=null&&h(e,["positivePromptSafetyAttributes"],j_(i)),e}function qM(t){const e={},n=f(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=f(t,["predictions"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(u=>Nc(u))),h(e,["generatedImages"],o)}const i=f(t,["positivePromptSafetyAttributes"]);return i!=null&&h(e,["positivePromptSafetyAttributes"],J_(i)),e}function FM(t,e){const n={},s=f(t,["numberOfVideos"]);if(e!==void 0&&s!=null&&h(e,["parameters","sampleCount"],s),f(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(f(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const i=f(t,["durationSeconds"]);if(e!==void 0&&i!=null&&h(e,["parameters","durationSeconds"],i),f(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const o=f(t,["aspectRatio"]);e!==void 0&&o!=null&&h(e,["parameters","aspectRatio"],o);const u=f(t,["resolution"]);e!==void 0&&u!=null&&h(e,["parameters","resolution"],u);const d=f(t,["personGeneration"]);if(e!==void 0&&d!=null&&h(e,["parameters","personGeneration"],d),f(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const p=f(t,["negativePrompt"]);e!==void 0&&p!=null&&h(e,["parameters","negativePrompt"],p);const m=f(t,["enhancePrompt"]);if(e!==void 0&&m!=null&&h(e,["parameters","enhancePrompt"],m),f(t,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const v=f(t,["lastFrame"]);e!==void 0&&v!=null&&h(e,["instances[0]","lastFrame"],Mc(v));const S=f(t,["referenceImages"]);if(e!==void 0&&S!=null){let w=S;Array.isArray(w)&&(w=w.map(C=>qI(C))),h(e,["instances[0]","referenceImages"],w)}if(f(t,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(f(t,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return n}function $M(t,e){const n={},s=f(t,["numberOfVideos"]);e!==void 0&&s!=null&&h(e,["parameters","sampleCount"],s);const i=f(t,["outputGcsUri"]);e!==void 0&&i!=null&&h(e,["parameters","storageUri"],i);const o=f(t,["fps"]);e!==void 0&&o!=null&&h(e,["parameters","fps"],o);const u=f(t,["durationSeconds"]);e!==void 0&&u!=null&&h(e,["parameters","durationSeconds"],u);const d=f(t,["seed"]);e!==void 0&&d!=null&&h(e,["parameters","seed"],d);const p=f(t,["aspectRatio"]);e!==void 0&&p!=null&&h(e,["parameters","aspectRatio"],p);const m=f(t,["resolution"]);e!==void 0&&m!=null&&h(e,["parameters","resolution"],m);const v=f(t,["personGeneration"]);e!==void 0&&v!=null&&h(e,["parameters","personGeneration"],v);const S=f(t,["pubsubTopic"]);e!==void 0&&S!=null&&h(e,["parameters","pubsubTopic"],S);const w=f(t,["negativePrompt"]);e!==void 0&&w!=null&&h(e,["parameters","negativePrompt"],w);const C=f(t,["enhancePrompt"]);e!==void 0&&C!=null&&h(e,["parameters","enhancePrompt"],C);const M=f(t,["generateAudio"]);e!==void 0&&M!=null&&h(e,["parameters","generateAudio"],M);const I=f(t,["lastFrame"]);e!==void 0&&I!=null&&h(e,["instances[0]","lastFrame"],as(I));const k=f(t,["referenceImages"]);if(e!==void 0&&k!=null){let G=k;Array.isArray(G)&&(G=G.map(z=>FI(z))),h(e,["instances[0]","referenceImages"],G)}const F=f(t,["mask"]);e!==void 0&&F!=null&&h(e,["instances[0]","mask"],VI(F));const V=f(t,["compressionQuality"]);return e!==void 0&&V!=null&&h(e,["parameters","compressionQuality"],V),n}function GM(t){const e={},n=f(t,["name"]);n!=null&&h(e,["name"],n);const s=f(t,["metadata"]);s!=null&&h(e,["metadata"],s);const i=f(t,["done"]);i!=null&&h(e,["done"],i);const o=f(t,["error"]);o!=null&&h(e,["error"],o);const u=f(t,["response","generateVideoResponse"]);return u!=null&&h(e,["response"],JM(u)),e}function HM(t){const e={},n=f(t,["name"]);n!=null&&h(e,["name"],n);const s=f(t,["metadata"]);s!=null&&h(e,["metadata"],s);const i=f(t,["done"]);i!=null&&h(e,["done"],i);const o=f(t,["error"]);o!=null&&h(e,["error"],o);const u=f(t,["response"]);return u!=null&&h(e,["response"],YM(u)),e}function zM(t,e){const n={},s=f(e,["model"]);s!=null&&h(n,["_url","model"],Qe(t,s));const i=f(e,["prompt"]);i!=null&&h(n,["instances[0]","prompt"],i);const o=f(e,["image"]);o!=null&&h(n,["instances[0]","image"],Mc(o));const u=f(e,["video"]);u!=null&&h(n,["instances[0]","video"],Z_(u));const d=f(e,["source"]);d!=null&&KM(d,n);const p=f(e,["config"]);return p!=null&&FM(p,n),n}function jM(t,e){const n={},s=f(e,["model"]);s!=null&&h(n,["_url","model"],Qe(t,s));const i=f(e,["prompt"]);i!=null&&h(n,["instances[0]","prompt"],i);const o=f(e,["image"]);o!=null&&h(n,["instances[0]","image"],as(o));const u=f(e,["video"]);u!=null&&h(n,["instances[0]","video"],X_(u));const d=f(e,["source"]);d!=null&&ZM(d,n);const p=f(e,["config"]);return p!=null&&$M(p,n),n}function JM(t){const e={},n=f(t,["generatedSamples"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(u=>QM(u))),h(e,["generatedVideos"],o)}const s=f(t,["raiMediaFilteredCount"]);s!=null&&h(e,["raiMediaFilteredCount"],s);const i=f(t,["raiMediaFilteredReasons"]);return i!=null&&h(e,["raiMediaFilteredReasons"],i),e}function YM(t){const e={},n=f(t,["videos"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(u=>eI(u))),h(e,["generatedVideos"],o)}const s=f(t,["raiMediaFilteredCount"]);s!=null&&h(e,["raiMediaFilteredCount"],s);const i=f(t,["raiMediaFilteredReasons"]);return i!=null&&h(e,["raiMediaFilteredReasons"],i),e}function KM(t,e){const n={},s=f(t,["prompt"]);e!==void 0&&s!=null&&h(e,["instances[0]","prompt"],s);const i=f(t,["image"]);e!==void 0&&i!=null&&h(e,["instances[0]","image"],Mc(i));const o=f(t,["video"]);return e!==void 0&&o!=null&&h(e,["instances[0]","video"],Z_(o)),n}function ZM(t,e){const n={},s=f(t,["prompt"]);e!==void 0&&s!=null&&h(e,["instances[0]","prompt"],s);const i=f(t,["image"]);e!==void 0&&i!=null&&h(e,["instances[0]","image"],as(i));const o=f(t,["video"]);return e!==void 0&&o!=null&&h(e,["instances[0]","video"],X_(o)),n}function XM(t){const e={},n=f(t,["_self"]);n!=null&&h(e,["image"],iI(n));const s=f(t,["raiFilteredReason"]);s!=null&&h(e,["raiFilteredReason"],s);const i=f(t,["_self"]);return i!=null&&h(e,["safetyAttributes"],j_(i)),e}function Nc(t){const e={},n=f(t,["_self"]);n!=null&&h(e,["image"],z_(n));const s=f(t,["raiFilteredReason"]);s!=null&&h(e,["raiFilteredReason"],s);const i=f(t,["_self"]);i!=null&&h(e,["safetyAttributes"],J_(i));const o=f(t,["prompt"]);return o!=null&&h(e,["enhancedPrompt"],o),e}function WM(t){const e={},n=f(t,["_self"]);n!=null&&h(e,["mask"],z_(n));const s=f(t,["labels"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(o=>o)),h(e,["labels"],i)}return e}function QM(t){const e={},n=f(t,["video"]);return n!=null&&h(e,["video"],OI(n)),e}function eI(t){const e={},n=f(t,["_self"]);return n!=null&&h(e,["video"],BI(n)),e}function tI(t){const e={},n=f(t,["modelSelectionConfig"]);n!=null&&h(e,["modelConfig"],n);const s=f(t,["responseJsonSchema"]);s!=null&&h(e,["responseJsonSchema"],s);const i=f(t,["audioTimestamp"]);i!=null&&h(e,["audioTimestamp"],i);const o=f(t,["candidateCount"]);o!=null&&h(e,["candidateCount"],o);const u=f(t,["enableAffectiveDialog"]);u!=null&&h(e,["enableAffectiveDialog"],u);const d=f(t,["frequencyPenalty"]);d!=null&&h(e,["frequencyPenalty"],d);const p=f(t,["logprobs"]);p!=null&&h(e,["logprobs"],p);const m=f(t,["maxOutputTokens"]);m!=null&&h(e,["maxOutputTokens"],m);const v=f(t,["mediaResolution"]);v!=null&&h(e,["mediaResolution"],v);const S=f(t,["presencePenalty"]);S!=null&&h(e,["presencePenalty"],S);const w=f(t,["responseLogprobs"]);w!=null&&h(e,["responseLogprobs"],w);const C=f(t,["responseMimeType"]);C!=null&&h(e,["responseMimeType"],C);const M=f(t,["responseModalities"]);M!=null&&h(e,["responseModalities"],M);const I=f(t,["responseSchema"]);I!=null&&h(e,["responseSchema"],I);const k=f(t,["routingConfig"]);k!=null&&h(e,["routingConfig"],k);const F=f(t,["seed"]);F!=null&&h(e,["seed"],F);const V=f(t,["speechConfig"]);V!=null&&h(e,["speechConfig"],Y_(V));const G=f(t,["stopSequences"]);G!=null&&h(e,["stopSequences"],G);const z=f(t,["temperature"]);z!=null&&h(e,["temperature"],z);const ae=f(t,["thinkingConfig"]);ae!=null&&h(e,["thinkingConfig"],ae);const Q=f(t,["topK"]);Q!=null&&h(e,["topK"],Q);const J=f(t,["topP"]);if(J!=null&&h(e,["topP"],J),f(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function nI(t,e){const n={},s=f(e,["model"]);return s!=null&&h(n,["_url","name"],Qe(t,s)),n}function sI(t,e){const n={},s=f(e,["model"]);return s!=null&&h(n,["_url","name"],Qe(t,s)),n}function aI(t){const e={};if(f(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=f(t,["enableWidget"]);return n!=null&&h(e,["enableWidget"],n),e}function rI(t){const e={};if(f(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=f(t,["timeRangeFilter"]);return n!=null&&h(e,["timeRangeFilter"],n),e}function iI(t){const e={},n=f(t,["bytesBase64Encoded"]);n!=null&&h(e,["imageBytes"],Va(n));const s=f(t,["mimeType"]);return s!=null&&h(e,["mimeType"],s),e}function z_(t){const e={},n=f(t,["gcsUri"]);n!=null&&h(e,["gcsUri"],n);const s=f(t,["bytesBase64Encoded"]);s!=null&&h(e,["imageBytes"],Va(s));const i=f(t,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function Mc(t){const e={};if(f(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=f(t,["imageBytes"]);n!=null&&h(e,["bytesBase64Encoded"],Va(n));const s=f(t,["mimeType"]);return s!=null&&h(e,["mimeType"],s),e}function as(t){const e={},n=f(t,["gcsUri"]);n!=null&&h(e,["gcsUri"],n);const s=f(t,["imageBytes"]);s!=null&&h(e,["bytesBase64Encoded"],Va(s));const i=f(t,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function oI(t,e,n){const s={},i=f(e,["pageSize"]);n!==void 0&&i!=null&&h(n,["_query","pageSize"],i);const o=f(e,["pageToken"]);n!==void 0&&o!=null&&h(n,["_query","pageToken"],o);const u=f(e,["filter"]);n!==void 0&&u!=null&&h(n,["_query","filter"],u);const d=f(e,["queryBase"]);return n!==void 0&&d!=null&&h(n,["_url","models_url"],O_(t,d)),s}function lI(t,e,n){const s={},i=f(e,["pageSize"]);n!==void 0&&i!=null&&h(n,["_query","pageSize"],i);const o=f(e,["pageToken"]);n!==void 0&&o!=null&&h(n,["_query","pageToken"],o);const u=f(e,["filter"]);n!==void 0&&u!=null&&h(n,["_query","filter"],u);const d=f(e,["queryBase"]);return n!==void 0&&d!=null&&h(n,["_url","models_url"],O_(t,d)),s}function uI(t,e){const n={},s=f(e,["config"]);return s!=null&&oI(t,s,n),n}function cI(t,e){const n={},s=f(e,["config"]);return s!=null&&lI(t,s,n),n}function dI(t){const e={},n=f(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=f(t,["nextPageToken"]);s!=null&&h(e,["nextPageToken"],s);const i=f(t,["_self"]);if(i!=null){let o=B_(i);Array.isArray(o)&&(o=o.map(u=>Wm(u))),h(e,["models"],o)}return e}function fI(t){const e={},n=f(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=f(t,["nextPageToken"]);s!=null&&h(e,["nextPageToken"],s);const i=f(t,["_self"]);if(i!=null){let o=B_(i);Array.isArray(o)&&(o=o.map(u=>Qm(u))),h(e,["models"],o)}return e}function mI(t){const e={},n=f(t,["maskMode"]);n!=null&&h(e,["maskMode"],n);const s=f(t,["segmentationClasses"]);s!=null&&h(e,["maskClasses"],s);const i=f(t,["maskDilation"]);return i!=null&&h(e,["dilation"],i),e}function Wm(t){const e={},n=f(t,["name"]);n!=null&&h(e,["name"],n);const s=f(t,["displayName"]);s!=null&&h(e,["displayName"],s);const i=f(t,["description"]);i!=null&&h(e,["description"],i);const o=f(t,["version"]);o!=null&&h(e,["version"],o);const u=f(t,["_self"]);u!=null&&h(e,["tunedModelInfo"],RI(u));const d=f(t,["inputTokenLimit"]);d!=null&&h(e,["inputTokenLimit"],d);const p=f(t,["outputTokenLimit"]);p!=null&&h(e,["outputTokenLimit"],p);const m=f(t,["supportedGenerationMethods"]);return m!=null&&h(e,["supportedActions"],m),e}function Qm(t){const e={},n=f(t,["name"]);n!=null&&h(e,["name"],n);const s=f(t,["displayName"]);s!=null&&h(e,["displayName"],s);const i=f(t,["description"]);i!=null&&h(e,["description"],i);const o=f(t,["versionId"]);o!=null&&h(e,["version"],o);const u=f(t,["deployedModels"]);if(u!=null){let S=u;Array.isArray(S)&&(S=S.map(w=>MM(w))),h(e,["endpoints"],S)}const d=f(t,["labels"]);d!=null&&h(e,["labels"],d);const p=f(t,["_self"]);p!=null&&h(e,["tunedModelInfo"],NI(p));const m=f(t,["defaultCheckpointId"]);m!=null&&h(e,["defaultCheckpointId"],m);const v=f(t,["checkpoints"]);if(v!=null){let S=v;Array.isArray(S)&&(S=S.map(w=>w)),h(e,["checkpoints"],S)}return e}function pI(t){const e={},n=f(t,["functionCall"]);n!=null&&h(e,["functionCall"],n);const s=f(t,["codeExecutionResult"]);s!=null&&h(e,["codeExecutionResult"],s);const i=f(t,["executableCode"]);i!=null&&h(e,["executableCode"],i);const o=f(t,["fileData"]);o!=null&&h(e,["fileData"],IM(o));const u=f(t,["functionResponse"]);u!=null&&h(e,["functionResponse"],u);const d=f(t,["inlineData"]);d!=null&&h(e,["inlineData"],sM(d));const p=f(t,["text"]);p!=null&&h(e,["text"],p);const m=f(t,["thought"]);m!=null&&h(e,["thought"],m);const v=f(t,["thoughtSignature"]);v!=null&&h(e,["thoughtSignature"],v);const S=f(t,["videoMetadata"]);return S!=null&&h(e,["videoMetadata"],S),e}function hI(t){const e={},n=f(t,["productImage"]);return n!=null&&h(e,["image"],as(n)),e}function gI(t,e){const n={},s=f(t,["numberOfImages"]);e!==void 0&&s!=null&&h(e,["parameters","sampleCount"],s);const i=f(t,["baseSteps"]);e!==void 0&&i!=null&&h(e,["parameters","editConfig","baseSteps"],i);const o=f(t,["outputGcsUri"]);e!==void 0&&o!=null&&h(e,["parameters","storageUri"],o);const u=f(t,["seed"]);e!==void 0&&u!=null&&h(e,["parameters","seed"],u);const d=f(t,["safetyFilterLevel"]);e!==void 0&&d!=null&&h(e,["parameters","safetySetting"],d);const p=f(t,["personGeneration"]);e!==void 0&&p!=null&&h(e,["parameters","personGeneration"],p);const m=f(t,["addWatermark"]);e!==void 0&&m!=null&&h(e,["parameters","addWatermark"],m);const v=f(t,["outputMimeType"]);e!==void 0&&v!=null&&h(e,["parameters","outputOptions","mimeType"],v);const S=f(t,["outputCompressionQuality"]);e!==void 0&&S!=null&&h(e,["parameters","outputOptions","compressionQuality"],S);const w=f(t,["enhancePrompt"]);e!==void 0&&w!=null&&h(e,["parameters","enhancePrompt"],w);const C=f(t,["labels"]);return e!==void 0&&C!=null&&h(e,["labels"],C),n}function yI(t,e){const n={},s=f(e,["model"]);s!=null&&h(n,["_url","model"],Qe(t,s));const i=f(e,["source"]);i!=null&&xI(i,n);const o=f(e,["config"]);return o!=null&&gI(o,n),n}function vI(t){const e={},n=f(t,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(i=>Nc(i))),h(e,["generatedImages"],s)}return e}function xI(t,e){const n={},s=f(t,["prompt"]);e!==void 0&&s!=null&&h(e,["instances[0]","prompt"],s);const i=f(t,["personImage"]);e!==void 0&&i!=null&&h(e,["instances[0]","personImage","image"],as(i));const o=f(t,["productImages"]);if(e!==void 0&&o!=null){let u=o;Array.isArray(u)&&(u=u.map(d=>hI(d))),h(e,["instances[0]","productImages"],u)}return n}function SI(t){const e={},n=f(t,["referenceImage"]);n!=null&&h(e,["referenceImage"],as(n));const s=f(t,["referenceId"]);s!=null&&h(e,["referenceId"],s);const i=f(t,["referenceType"]);i!=null&&h(e,["referenceType"],i);const o=f(t,["maskImageConfig"]);o!=null&&h(e,["maskImageConfig"],mI(o));const u=f(t,["controlImageConfig"]);u!=null&&h(e,["controlImageConfig"],cM(u));const d=f(t,["styleImageConfig"]);d!=null&&h(e,["styleImageConfig"],d);const p=f(t,["subjectImageConfig"]);return p!=null&&h(e,["subjectImageConfig"],p),e}function j_(t){const e={},n=f(t,["safetyAttributes","categories"]);n!=null&&h(e,["categories"],n);const s=f(t,["safetyAttributes","scores"]);s!=null&&h(e,["scores"],s);const i=f(t,["contentType"]);return i!=null&&h(e,["contentType"],i),e}function J_(t){const e={},n=f(t,["safetyAttributes","categories"]);n!=null&&h(e,["categories"],n);const s=f(t,["safetyAttributes","scores"]);s!=null&&h(e,["scores"],s);const i=f(t,["contentType"]);return i!=null&&h(e,["contentType"],i),e}function wI(t){const e={},n=f(t,["category"]);if(n!=null&&h(e,["category"],n),f(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const s=f(t,["threshold"]);return s!=null&&h(e,["threshold"],s),e}function _I(t){const e={},n=f(t,["image"]);return n!=null&&h(e,["image"],as(n)),e}function bI(t,e){const n={},s=f(t,["mode"]);e!==void 0&&s!=null&&h(e,["parameters","mode"],s);const i=f(t,["maxPredictions"]);e!==void 0&&i!=null&&h(e,["parameters","maxPredictions"],i);const o=f(t,["confidenceThreshold"]);e!==void 0&&o!=null&&h(e,["parameters","confidenceThreshold"],o);const u=f(t,["maskDilation"]);e!==void 0&&u!=null&&h(e,["parameters","maskDilation"],u);const d=f(t,["binaryColorThreshold"]);e!==void 0&&d!=null&&h(e,["parameters","binaryColorThreshold"],d);const p=f(t,["labels"]);return e!==void 0&&p!=null&&h(e,["labels"],p),n}function CI(t,e){const n={},s=f(e,["model"]);s!=null&&h(n,["_url","model"],Qe(t,s));const i=f(e,["source"]);i!=null&&AI(i,n);const o=f(e,["config"]);return o!=null&&bI(o,n),n}function TI(t){const e={},n=f(t,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(i=>WM(i))),h(e,["generatedMasks"],s)}return e}function AI(t,e){const n={},s=f(t,["prompt"]);e!==void 0&&s!=null&&h(e,["instances[0]","prompt"],s);const i=f(t,["image"]);e!==void 0&&i!=null&&h(e,["instances[0]","image"],as(i));const o=f(t,["scribbleImage"]);return e!==void 0&&o!=null&&h(e,["instances[0]","scribble"],_I(o)),n}function Y_(t){const e={},n=f(t,["languageCode"]);n!=null&&h(e,["languageCode"],n);const s=f(t,["voiceConfig"]);if(s!=null&&h(e,["voiceConfig"],s),f(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function EI(t){const e={},n=f(t,["functionDeclarations"]);if(n!=null){let v=n;Array.isArray(v)&&(v=v.map(S=>S)),h(e,["functionDeclarations"],v)}if(f(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=f(t,["googleSearchRetrieval"]);s!=null&&h(e,["googleSearchRetrieval"],s);const i=f(t,["computerUse"]);i!=null&&h(e,["computerUse"],i);const o=f(t,["fileSearch"]);o!=null&&h(e,["fileSearch"],o);const u=f(t,["codeExecution"]);if(u!=null&&h(e,["codeExecution"],u),f(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const d=f(t,["googleMaps"]);d!=null&&h(e,["googleMaps"],aI(d));const p=f(t,["googleSearch"]);p!=null&&h(e,["googleSearch"],rI(p));const m=f(t,["urlContext"]);return m!=null&&h(e,["urlContext"],m),e}function K_(t){const e={},n=f(t,["functionDeclarations"]);if(n!=null){let S=n;Array.isArray(S)&&(S=S.map(w=>DM(w))),h(e,["functionDeclarations"],S)}const s=f(t,["retrieval"]);s!=null&&h(e,["retrieval"],s);const i=f(t,["googleSearchRetrieval"]);i!=null&&h(e,["googleSearchRetrieval"],i);const o=f(t,["computerUse"]);if(o!=null&&h(e,["computerUse"],o),f(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const u=f(t,["codeExecution"]);u!=null&&h(e,["codeExecution"],u);const d=f(t,["enterpriseWebSearch"]);d!=null&&h(e,["enterpriseWebSearch"],d);const p=f(t,["googleMaps"]);p!=null&&h(e,["googleMaps"],p);const m=f(t,["googleSearch"]);m!=null&&h(e,["googleSearch"],m);const v=f(t,["urlContext"]);return v!=null&&h(e,["urlContext"],v),e}function RI(t){const e={},n=f(t,["baseModel"]);n!=null&&h(e,["baseModel"],n);const s=f(t,["createTime"]);s!=null&&h(e,["createTime"],s);const i=f(t,["updateTime"]);return i!=null&&h(e,["updateTime"],i),e}function NI(t){const e={},n=f(t,["labels","google-vertex-llm-tuning-base-model-id"]);n!=null&&h(e,["baseModel"],n);const s=f(t,["createTime"]);s!=null&&h(e,["createTime"],s);const i=f(t,["updateTime"]);return i!=null&&h(e,["updateTime"],i),e}function MI(t,e){const n={},s=f(t,["displayName"]);e!==void 0&&s!=null&&h(e,["displayName"],s);const i=f(t,["description"]);e!==void 0&&i!=null&&h(e,["description"],i);const o=f(t,["defaultCheckpointId"]);return e!==void 0&&o!=null&&h(e,["defaultCheckpointId"],o),n}function II(t,e){const n={},s=f(t,["displayName"]);e!==void 0&&s!=null&&h(e,["displayName"],s);const i=f(t,["description"]);e!==void 0&&i!=null&&h(e,["description"],i);const o=f(t,["defaultCheckpointId"]);return e!==void 0&&o!=null&&h(e,["defaultCheckpointId"],o),n}function DI(t,e){const n={},s=f(e,["model"]);s!=null&&h(n,["_url","name"],Qe(t,s));const i=f(e,["config"]);return i!=null&&MI(i,n),n}function PI(t,e){const n={},s=f(e,["model"]);s!=null&&h(n,["_url","model"],Qe(t,s));const i=f(e,["config"]);return i!=null&&II(i,n),n}function kI(t,e){const n={},s=f(t,["outputGcsUri"]);e!==void 0&&s!=null&&h(e,["parameters","storageUri"],s);const i=f(t,["safetyFilterLevel"]);e!==void 0&&i!=null&&h(e,["parameters","safetySetting"],i);const o=f(t,["personGeneration"]);e!==void 0&&o!=null&&h(e,["parameters","personGeneration"],o);const u=f(t,["includeRaiReason"]);e!==void 0&&u!=null&&h(e,["parameters","includeRaiReason"],u);const d=f(t,["outputMimeType"]);e!==void 0&&d!=null&&h(e,["parameters","outputOptions","mimeType"],d);const p=f(t,["outputCompressionQuality"]);e!==void 0&&p!=null&&h(e,["parameters","outputOptions","compressionQuality"],p);const m=f(t,["enhanceInputImage"]);e!==void 0&&m!=null&&h(e,["parameters","upscaleConfig","enhanceInputImage"],m);const v=f(t,["imagePreservationFactor"]);e!==void 0&&v!=null&&h(e,["parameters","upscaleConfig","imagePreservationFactor"],v);const S=f(t,["labels"]);e!==void 0&&S!=null&&h(e,["labels"],S);const w=f(t,["numberOfImages"]);e!==void 0&&w!=null&&h(e,["parameters","sampleCount"],w);const C=f(t,["mode"]);return e!==void 0&&C!=null&&h(e,["parameters","mode"],C),n}function LI(t,e){const n={},s=f(e,["model"]);s!=null&&h(n,["_url","model"],Qe(t,s));const i=f(e,["image"]);i!=null&&h(n,["instances[0]","image"],as(i));const o=f(e,["upscaleFactor"]);o!=null&&h(n,["parameters","upscaleConfig","upscaleFactor"],o);const u=f(e,["config"]);return u!=null&&kI(u,n),n}function UI(t){const e={},n=f(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=f(t,["predictions"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(o=>Nc(o))),h(e,["generatedImages"],i)}return e}function OI(t){const e={},n=f(t,["uri"]);n!=null&&h(e,["uri"],n);const s=f(t,["encodedVideo"]);s!=null&&h(e,["videoBytes"],Va(s));const i=f(t,["encoding"]);return i!=null&&h(e,["mimeType"],i),e}function BI(t){const e={},n=f(t,["gcsUri"]);n!=null&&h(e,["uri"],n);const s=f(t,["bytesBase64Encoded"]);s!=null&&h(e,["videoBytes"],Va(s));const i=f(t,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function VI(t){const e={},n=f(t,["image"]);n!=null&&h(e,["_self"],as(n));const s=f(t,["maskMode"]);return s!=null&&h(e,["maskMode"],s),e}function qI(t){const e={},n=f(t,["image"]);n!=null&&h(e,["image"],Mc(n));const s=f(t,["referenceType"]);return s!=null&&h(e,["referenceType"],s),e}function FI(t){const e={},n=f(t,["image"]);n!=null&&h(e,["image"],as(n));const s=f(t,["referenceType"]);return s!=null&&h(e,["referenceType"],s),e}function Z_(t){const e={},n=f(t,["uri"]);n!=null&&h(e,["uri"],n);const s=f(t,["videoBytes"]);s!=null&&h(e,["encodedVideo"],Va(s));const i=f(t,["mimeType"]);return i!=null&&h(e,["encoding"],i),e}function X_(t){const e={},n=f(t,["uri"]);n!=null&&h(e,["gcsUri"],n);const s=f(t,["videoBytes"]);s!=null&&h(e,["bytesBase64Encoded"],Va(s));const i=f(t,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const $I="Content-Type",GI="X-Server-Timeout",HI="User-Agent",ep="x-goog-api-client",zI="1.29.0",jI=`google-genai-sdk/${zI}`,JI="v1beta1",YI="v1beta",vS=/^\s*data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class KI{constructor(e){var n,s;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const i={};this.clientOptions.vertexai?(i.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:JI,i.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(i.apiVersion=(s=this.clientOptions.apiVersion)!==null&&s!==void 0?s:YI,i.baseUrl="https://generativelanguage.googleapis.com/"),i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const s=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&s.push(e.apiVersion),s.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),n=new URL(e);return n.protocol=n.protocol=="http:"?"ws":"wss",n.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,n,s){const i=[this.getRequestUrlInternal(n)];return s&&i.push(this.getBaseResourcePath()),e!==""&&i.push(e),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const s=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,n,s);if(e.queryParams)for(const[u,d]of Object.entries(e.queryParams))i.searchParams.append(u,String(d));let o={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else o.body=e.body;return o=await this.includeExtraHttpOptionsToRequestInit(o,n,i.toString(),e.abortSignal),this.unaryApiCall(i,o,e.httpMethod)}patchHttpOptions(e,n){const s=JSON.parse(JSON.stringify(e));for(const[i,o]of Object.entries(n))typeof o=="object"?s[i]=Object.assign(Object.assign({},s[i]),o):o!==void 0&&(s[i]=o);return s}async requestStream(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const s=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,n,s);(!i.searchParams.has("alt")||i.searchParams.get("alt")!=="sse")&&i.searchParams.set("alt","sse");let o={};return o.body=e.body,o=await this.includeExtraHttpOptionsToRequestInit(o,n,i.toString(),e.abortSignal),this.streamApiCall(i,o,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,n,s,i){if(n&&n.timeout||i){const o=new AbortController,u=o.signal;if(n.timeout&&(n==null?void 0:n.timeout)>0){const d=setTimeout(()=>o.abort(),n.timeout);d&&typeof d.unref=="function"&&d.unref()}i&&i.addEventListener("abort",()=>{o.abort()}),e.signal=u}return n&&n.extraBody!==null&&ZI(e,n.extraBody),e.headers=await this.getHeadersInternal(n,s),e}async unaryApiCall(e,n,s){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:s})).then(async i=>(await xS(i),new Km(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(e,n,s){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:s})).then(async i=>(await xS(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(e){var n;return wi(this,arguments,function*(){const i=(n=e==null?void 0:e.body)===null||n===void 0?void 0:n.getReader(),o=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let u="";for(;;){const{done:d,value:p}=yield gt(i.read());if(d){if(u.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const m=o.decode(p,{stream:!0});try{const S=JSON.parse(m);if("error"in S){const w=JSON.parse(JSON.stringify(S.error)),C=w.status,M=w.code,I=`got status: ${C}. ${JSON.stringify(S)}`;if(M>=400&&M<600)throw new Ec({message:I,status:M})}}catch(S){if(S.name==="ApiError")throw S}u+=m;let v=u.match(vS);for(;v;){const S=v[1];try{const w=new Response(S,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield gt(new Km(w)),u=u.slice(v[0].length),v=u.match(vS)}catch(w){throw new Error(`exception parsing stream chunk ${S}. ${w}`)}}}}finally{i.releaseLock()}})}async apiCall(e,n){return fetch(e,n).catch(s=>{throw new Error(`exception ${s} sending request`)})}getDefaultHeaders(){const e={},n=jI+" "+this.clientOptions.userAgentExtra;return e[HI]=n,e[ep]=n,e[$I]="application/json",e}async getHeadersInternal(e,n){const s=new Headers;if(e&&e.headers){for(const[i,o]of Object.entries(e.headers))s.append(i,o);e.timeout&&e.timeout>0&&s.append(GI,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(s,n),s}getFileName(e){var n;let s="";return typeof e=="string"&&(s=e.replace(/[/\\]+$/,""),s=(n=s.split(/[/\\]/).pop())!==null&&n!==void 0?n:""),s}async uploadFile(e,n){var s;const i={};n!=null&&(i.mimeType=n.mimeType,i.name=n.name,i.displayName=n.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);const o=this.clientOptions.uploader,u=await o.stat(e);i.sizeBytes=String(u.size);const d=(s=n==null?void 0:n.mimeType)!==null&&s!==void 0?s:u.type;if(d===void 0||d==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=d;const p={file:i},m=this.getFileName(e),v=ge("upload/v1beta/files",p._url),S=await this.fetchUploadUrl(v,i.sizeBytes,i.mimeType,m,p,n==null?void 0:n.httpOptions);return o.upload(e,S,this)}async uploadFileToFileSearchStore(e,n,s){var i;const o=this.clientOptions.uploader,u=await o.stat(n),d=String(u.size),p=(i=s==null?void 0:s.mimeType)!==null&&i!==void 0?i:u.type;if(p===void 0||p==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const m=`upload/v1beta/${e}:uploadToFileSearchStore`,v=this.getFileName(n),S={};s!=null&&s.customMetadata&&(S.customMetadata=s.customMetadata),s!=null&&s.chunkingConfig&&(S.chunkingConfig=s.chunkingConfig);const w=await this.fetchUploadUrl(m,d,p,v,S,s==null?void 0:s.httpOptions);return o.uploadToFileSearchStore(n,w,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,n,s,i,o,u){var d;let p={};u?p=u:p={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${n}`,"X-Goog-Upload-Header-Content-Type":`${s}`},i?{"X-Goog-Upload-File-Name":i}:{})};const m=await this.request({path:e,body:JSON.stringify(o),httpMethod:"POST",httpOptions:p});if(!m||!(m!=null&&m.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const v=(d=m==null?void 0:m.headers)===null||d===void 0?void 0:d["x-goog-upload-url"];if(v===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return v}}async function xS(t){var e;if(t===void 0)throw new Error("response is undefined");if(!t.ok){const n=t.status;let s;!((e=t.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?s=await t.json():s={error:{message:await t.text(),code:t.status,status:t.statusText}};const i=JSON.stringify(s);throw n>=400&&n<600?new Ec({message:i,status:n}):new Error(i)}}function ZI(t,e){if(!e||Object.keys(e).length===0)return;if(t.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let n={};if(typeof t.body=="string"&&t.body.length>0)try{const o=JSON.parse(t.body);if(typeof o=="object"&&o!==null&&!Array.isArray(o))n=o;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function s(o,u){const d=Object.assign({},o);for(const p in u)if(Object.prototype.hasOwnProperty.call(u,p)){const m=u[p],v=d[p];m&&typeof m=="object"&&!Array.isArray(m)&&v&&typeof v=="object"&&!Array.isArray(v)?d[p]=s(v,m):(v&&m&&typeof v!=typeof m&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${p}". Original type: ${typeof v}, New type: ${typeof m}. Overwriting.`),d[p]=m)}return d}const i=s(n,e);t.body=JSON.stringify(i)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const XI="mcp_used/unknown";let WI=!1;function W_(t){for(const e of t)if(QI(e)||typeof e=="object"&&"inputSchema"in e)return!0;return WI}function Q_(t){var e;const n=(e=t[ep])!==null&&e!==void 0?e:"";t[ep]=(n+` ${XI}`).trimStart()}function QI(t){return t!==null&&typeof t=="object"&&t instanceof zp}function eD(t,e=100){return wi(this,arguments,function*(){let s,i=0;for(;i<e;){const o=yield gt(t.listTools({cursor:s}));for(const u of o.tools)yield yield gt(u),i++;if(!o.nextCursor)break;s=o.nextCursor}})}class zp{constructor(e=[],n){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=n}static create(e,n){return new zp(e,n)}async initialize(){var e,n,s,i;if(this.mcpTools.length>0)return;const o={},u=[];for(const v of this.mcpClients)try{for(var d=!0,p=(n=void 0,jo(eD(v))),m;m=await p.next(),e=m.done,!e;d=!0){i=m.value,d=!1;const S=i;u.push(S);const w=S.name;if(o[w])throw new Error(`Duplicate function name ${w} found in MCP tools. Please ensure function names are unique.`);o[w]=v}}catch(S){n={error:S}}finally{try{!d&&!e&&(s=p.return)&&await s.call(p)}finally{if(n)throw n.error}}this.mcpTools=u,this.functionNameToMcpClient=o}async tool(){return await this.initialize(),rN(this.mcpTools,this.config)}async callTool(e){await this.initialize();const n=[];for(const s of e)if(s.name in this.functionNameToMcpClient){const i=this.functionNameToMcpClient[s.name];let o;this.config.timeout&&(o={timeout:this.config.timeout});const u=await i.callTool({name:s.name,arguments:s.args},void 0,o);n.push({functionResponse:{name:s.name,response:u.isError?{error:u}:u}})}return n}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function tD(t,e,n){const s=new XR;let i;n.data instanceof Blob?i=JSON.parse(await n.data.text()):i=JSON.parse(n.data),Object.assign(s,i),e(s)}class nD{constructor(e,n,s){this.apiClient=e,this.auth=n,this.webSocketFactory=s}async connect(e){var n,s;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const i=this.apiClient.getWebsocketBaseUrl(),o=this.apiClient.getApiVersion(),u=rD(this.apiClient.getDefaultHeaders()),d=this.apiClient.getApiKey(),p=`${i}/ws/google.ai.generativelanguage.${o}.GenerativeService.BidiGenerateMusic?key=${d}`;let m=()=>{};const v=new Promise(G=>{m=G}),S=e.callbacks,w=function(){m({})},C=this.apiClient,M={onopen:w,onmessage:G=>{tD(C,S.onmessage,G)},onerror:(n=S==null?void 0:S.onerror)!==null&&n!==void 0?n:function(G){},onclose:(s=S==null?void 0:S.onclose)!==null&&s!==void 0?s:function(G){}},I=this.webSocketFactory.create(p,aD(u),M);I.connect(),await v;const V={setup:{model:Qe(this.apiClient,e.model)}};return I.send(JSON.stringify(V)),new sD(I,this.apiClient)}}class sD{constructor(e,n){this.conn=e,this.apiClient=n}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const n=Y1(e);this.conn.send(JSON.stringify({clientContent:n}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const n=J1(e);this.conn.send(JSON.stringify(n))}sendPlaybackControl(e){const n={playbackControl:e};this.conn.send(JSON.stringify(n))}play(){this.sendPlaybackControl(hi.PLAY)}pause(){this.sendPlaybackControl(hi.PAUSE)}stop(){this.sendPlaybackControl(hi.STOP)}resetContext(){this.sendPlaybackControl(hi.RESET_CONTEXT)}close(){this.conn.close()}}function aD(t){const e={};return t.forEach((n,s)=>{e[s]=n}),e}function rD(t){const e=new Headers;for(const[n,s]of Object.entries(t))e.append(n,s);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const iD="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function oD(t,e,n){const s=new ZR;let i;n.data instanceof Blob?i=await n.data.text():n.data instanceof ArrayBuffer?i=new TextDecoder().decode(n.data):i=n.data;const o=JSON.parse(i);if(t.isVertexAI()){const u=X1(o);Object.assign(s,u)}else Object.assign(s,o);e(s)}class lD{constructor(e,n,s){this.apiClient=e,this.auth=n,this.webSocketFactory=s,this.music=new nD(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var n,s,i,o,u,d;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const p=this.apiClient.getWebsocketBaseUrl(),m=this.apiClient.getApiVersion();let v;const S=this.apiClient.getHeaders();e.config&&e.config.tools&&W_(e.config.tools)&&Q_(S);const w=fD(S);if(this.apiClient.isVertexAI())v=`${p}/ws/google.cloud.aiplatform.${m}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(w,v);else{const X=this.apiClient.getApiKey();let ne="BidiGenerateContent",le="key";X!=null&&X.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),m!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),ne="BidiGenerateContentConstrained",le="access_token"),v=`${p}/ws/google.ai.generativelanguage.${m}.GenerativeService.${ne}?${le}=${X}`}let C=()=>{};const M=new Promise(X=>{C=X}),I=e.callbacks,k=function(){var X;(X=I==null?void 0:I.onopen)===null||X===void 0||X.call(I),C({})},F=this.apiClient,V={onopen:k,onmessage:X=>{oD(F,I.onmessage,X)},onerror:(n=I==null?void 0:I.onerror)!==null&&n!==void 0?n:function(X){},onclose:(s=I==null?void 0:I.onclose)!==null&&s!==void 0?s:function(X){}},G=this.webSocketFactory.create(v,dD(w),V);G.connect(),await M;let z=Qe(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&z.startsWith("publishers/")){const X=this.apiClient.getProject(),ne=this.apiClient.getLocation();z=`projects/${X}/locations/${ne}/`+z}let ae={};this.apiClient.isVertexAI()&&((i=e.config)===null||i===void 0?void 0:i.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[cc.AUDIO]}:e.config.responseModalities=[cc.AUDIO]),!((o=e.config)===null||o===void 0)&&o.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const Q=(d=(u=e.config)===null||u===void 0?void 0:u.tools)!==null&&d!==void 0?d:[],J=[];for(const X of Q)if(this.isCallableTool(X)){const ne=X;J.push(await ne.tool())}else J.push(X);J.length>0&&(e.config.tools=J);const j={model:z,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?ae=j1(this.apiClient,j):ae=z1(this.apiClient,j),delete ae.config,G.send(JSON.stringify(ae)),new cD(G,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const uD={turnComplete:!0};class cD{constructor(e,n){this.conn=e,this.apiClient=n}tLiveClientContent(e,n){if(n.turns!==null&&n.turns!==void 0){let s=[];try{s=jn(n.turns),e.isVertexAI()||(s=s.map(i=>Rc(i)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof n.turns}'`)}return{clientContent:{turns:s,turnComplete:n.turnComplete}}}return{clientContent:{turnComplete:n.turnComplete}}}tLiveClienttToolResponse(e,n){let s=[];if(n.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(n.functionResponses)?s=n.functionResponses:s=[n.functionResponses],s.length===0)throw new Error("functionResponses is required.");for(const o of s){if(typeof o!="object"||o===null||!("name"in o)||!("response"in o))throw new Error(`Could not parse function response, type '${typeof o}'.`);if(!e.isVertexAI()&&!("id"in o))throw new Error(iD)}return{toolResponse:{functionResponses:s}}}sendClientContent(e){e=Object.assign(Object.assign({},uD),e);const n=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(n))}sendRealtimeInput(e){let n={};this.apiClient.isVertexAI()?n={realtimeInput:Z1(e)}:n={realtimeInput:K1(e)},this.conn.send(JSON.stringify(n))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const n=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(n))}close(){this.conn.close()}}function dD(t){const e={};return t.forEach((n,s)=>{e[s]=n}),e}function fD(t){const e=new Headers;for(const[n,s]of Object.entries(t))e.append(n,s);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const SS=10;function wS(t){var e,n,s;if(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let i=!1;for(const u of(n=t==null?void 0:t.tools)!==null&&n!==void 0?n:[])if(_i(u)){i=!0;break}if(!i)return!0;const o=(s=t==null?void 0:t.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls;return o&&(o<0||!Number.isInteger(o))||o==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",o),!0):!1}function _i(t){return"callTool"in t&&typeof t.callTool=="function"}function mD(t){var e,n,s;return(s=(n=(e=t.config)===null||e===void 0?void 0:e.tools)===null||n===void 0?void 0:n.some(i=>_i(i)))!==null&&s!==void 0?s:!1}function _S(t){var e;const n=[];return!((e=t==null?void 0:t.config)===null||e===void 0)&&e.tools&&t.config.tools.forEach((s,i)=>{if(_i(s))return;const o=s;o.functionDeclarations&&o.functionDeclarations.length>0&&n.push(i)}),n}function bS(t){var e;return!(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let pD=class extends Ys{constructor(e){super(),this.apiClient=e,this.generateContent=async n=>{var s,i,o,u,d;const p=await this.processParamsMaybeAddMcpUsage(n);if(this.maybeMoveToResponseJsonSchem(n),!mD(n)||wS(n.config))return await this.generateContentInternal(p);const m=_S(n);if(m.length>0){const I=m.map(k=>`tools[${k}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${I}.`)}let v,S;const w=jn(p.contents),C=(o=(i=(s=p.config)===null||s===void 0?void 0:s.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&o!==void 0?o:SS;let M=0;for(;M<C&&(v=await this.generateContentInternal(p),!(!v.functionCalls||v.functionCalls.length===0));){const I=v.candidates[0].content,k=[];for(const F of(d=(u=n.config)===null||u===void 0?void 0:u.tools)!==null&&d!==void 0?d:[])if(_i(F)){const G=await F.callTool(v.functionCalls);k.push(...G)}M++,S={role:"user",parts:k},p.contents=jn(p.contents),p.contents.push(I),p.contents.push(S),bS(p.config)&&(w.push(I),w.push(S))}return bS(p.config)&&(v.automaticFunctionCallingHistory=w),v},this.generateContentStream=async n=>{if(this.maybeMoveToResponseJsonSchem(n),wS(n.config)){const i=await this.processParamsMaybeAddMcpUsage(n);return await this.generateContentStreamInternal(i)}const s=_S(n);if(s.length>0){const i=s.map(o=>`tools[${o}]`).join(", ");throw new Error(`Incompatible tools found at ${i}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}return await this.processAfcStream(n)},this.generateImages=async n=>await this.generateImagesInternal(n).then(s=>{var i;let o;const u=[];if(s!=null&&s.generatedImages)for(const p of s.generatedImages)p&&(p!=null&&p.safetyAttributes)&&((i=p==null?void 0:p.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?o=p==null?void 0:p.safetyAttributes:u.push(p);let d;return o?d={generatedImages:u,positivePromptSafetyAttributes:o,sdkHttpResponse:s.sdkHttpResponse}:d={generatedImages:u,sdkHttpResponse:s.sdkHttpResponse},d}),this.list=async n=>{var s;const u={config:Object.assign(Object.assign({},{queryBase:!0}),n==null?void 0:n.config)};if(this.apiClient.isVertexAI()&&!u.config.queryBase){if(!((s=u.config)===null||s===void 0)&&s.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");u.config.filter="labels.tune-type:*"}return new wr(js.PAGED_ITEM_MODELS,d=>this.listInternal(d),await this.listInternal(u),u)},this.editImage=async n=>{const s={model:n.model,prompt:n.prompt,referenceImages:[],config:n.config};return n.referenceImages&&n.referenceImages&&(s.referenceImages=n.referenceImages.map(i=>i.toReferenceImageAPI())),await this.editImageInternal(s)},this.upscaleImage=async n=>{let s={numberOfImages:1,mode:"upscale"};n.config&&(s=Object.assign(Object.assign({},s),n.config));const i={model:n.model,image:n.image,upscaleFactor:n.upscaleFactor,config:s};return await this.upscaleImageInternal(i)},this.generateVideos=async n=>{var s,i,o,u,d,p;if((n.prompt||n.image||n.video)&&n.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((s=n.video)===null||s===void 0)&&s.uri&&(!((i=n.video)===null||i===void 0)&&i.videoBytes)?n.video={uri:n.video.uri,mimeType:n.video.mimeType}:!((u=(o=n.source)===null||o===void 0?void 0:o.video)===null||u===void 0)&&u.uri&&(!((p=(d=n.source)===null||d===void 0?void 0:d.video)===null||p===void 0)&&p.videoBytes)&&(n.source.video={uri:n.source.video.uri,mimeType:n.source.video.mimeType})),await this.generateVideosInternal(n)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var n,s,i;const o=(n=e.config)===null||n===void 0?void 0:n.tools;if(!o)return e;const u=await Promise.all(o.map(async p=>_i(p)?await p.tool():p)),d={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:u})};if(d.config.tools=u,e.config&&e.config.tools&&W_(e.config.tools)){const p=(i=(s=e.config.httpOptions)===null||s===void 0?void 0:s.headers)!==null&&i!==void 0?i:{};let m=Object.assign({},p);Object.keys(m).length===0&&(m=this.apiClient.getDefaultHeaders()),Q_(m),d.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:m})}return d}async initAfcToolsMap(e){var n,s,i;const o=new Map;for(const u of(s=(n=e.config)===null||n===void 0?void 0:n.tools)!==null&&s!==void 0?s:[])if(_i(u)){const d=u,p=await d.tool();for(const m of(i=p.functionDeclarations)!==null&&i!==void 0?i:[]){if(!m.name)throw new Error("Function declaration name is required.");if(o.has(m.name))throw new Error(`Duplicate tool declaration name: ${m.name}`);o.set(m.name,d)}}return o}async processAfcStream(e){var n,s,i;const o=(i=(s=(n=e.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls)!==null&&i!==void 0?i:SS;let u=!1,d=0;const p=await this.initAfcToolsMap(e);return(function(m,v,S){var w,C;return wi(this,arguments,function*(){for(var M,I,k,F;d<o;){u&&(d++,u=!1);const ae=yield gt(m.processParamsMaybeAddMcpUsage(S)),Q=yield gt(m.generateContentStreamInternal(ae)),J=[],j=[];try{for(var V=!0,G=(I=void 0,jo(Q)),z;z=yield gt(G.next()),M=z.done,!M;V=!0){F=z.value,V=!1;const X=F;if(yield yield gt(X),X.candidates&&(!((w=X.candidates[0])===null||w===void 0)&&w.content)){j.push(X.candidates[0].content);for(const ne of(C=X.candidates[0].content.parts)!==null&&C!==void 0?C:[])if(d<o&&ne.functionCall){if(!ne.functionCall.name)throw new Error("Function call name was not returned by the model.");if(v.has(ne.functionCall.name)){const le=yield gt(v.get(ne.functionCall.name).callTool([ne.functionCall]));J.push(...le)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${v.keys()}, mising tool: ${ne.functionCall.name}`)}}}}catch(X){I={error:X}}finally{try{!V&&!M&&(k=G.return)&&(yield gt(k.call(G)))}finally{if(I)throw I.error}}if(J.length>0){u=!0;const X=new Lo;X.candidates=[{content:{role:"user",parts:J}}],yield yield gt(X);const ne=[];ne.push(...j),ne.push({role:"user",parts:J});const le=jn(S.contents).concat(ne);S.contents=le}else break}})})(this,p,e)}async generateContentInternal(e){var n,s,i,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const m=hS(this.apiClient,e);return d=ge("{model}:generateContent",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(v=>v.json().then(S=>{const w=S;return w.sdkHttpResponse={headers:v.headers},w})),u.then(v=>{const S=yS(v),w=new Lo;return Object.assign(w,S),w})}else{const m=pS(this.apiClient,e);return d=ge("{model}:generateContent",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json().then(S=>{const w=S;return w.sdkHttpResponse={headers:v.headers},w})),u.then(v=>{const S=gS(v),w=new Lo;return Object.assign(w,S),w})}}async generateContentStreamInternal(e){var n,s,i,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const m=hS(this.apiClient,e);return d=ge("{model}:streamGenerateContent?alt=sse",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.requestStream({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}),u.then(function(S){return wi(this,arguments,function*(){var w,C,M,I;try{for(var k=!0,F=jo(S),V;V=yield gt(F.next()),w=V.done,!w;k=!0){I=V.value,k=!1;const G=I,z=yS(yield gt(G.json()));z.sdkHttpResponse={headers:G.headers};const ae=new Lo;Object.assign(ae,z),yield yield gt(ae)}}catch(G){C={error:G}}finally{try{!k&&!w&&(M=F.return)&&(yield gt(M.call(F)))}finally{if(C)throw C.error}}})})}else{const m=pS(this.apiClient,e);return d=ge("{model}:streamGenerateContent?alt=sse",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.requestStream({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}),u.then(function(S){return wi(this,arguments,function*(){var w,C,M,I;try{for(var k=!0,F=jo(S),V;V=yield gt(F.next()),w=V.done,!w;k=!0){I=V.value,k=!1;const G=I,z=gS(yield gt(G.json()));z.sdkHttpResponse={headers:G.headers};const ae=new Lo;Object.assign(ae,z),yield yield gt(ae)}}catch(G){C={error:G}}finally{try{!k&&!w&&(M=F.return)&&(yield gt(M.call(F)))}finally{if(C)throw C.error}}})})}}async embedContent(e){var n,s,i,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const m=EM(this.apiClient,e);return d=ge("{model}:predict",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(v=>v.json().then(S=>{const w=S;return w.sdkHttpResponse={headers:v.headers},w})),u.then(v=>{const S=NM(v),w=new Wx;return Object.assign(w,S),w})}else{const m=AM(this.apiClient,e);return d=ge("{model}:batchEmbedContents",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json().then(S=>{const w=S;return w.sdkHttpResponse={headers:v.headers},w})),u.then(v=>{const S=RM(v),w=new Wx;return Object.assign(w,S),w})}}async generateImagesInternal(e){var n,s,i,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const m=BM(this.apiClient,e);return d=ge("{model}:predict",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(v=>v.json().then(S=>{const w=S;return w.sdkHttpResponse={headers:v.headers},w})),u.then(v=>{const S=qM(v),w=new Qx;return Object.assign(w,S),w})}else{const m=OM(this.apiClient,e);return d=ge("{model}:predict",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json().then(S=>{const w=S;return w.sdkHttpResponse={headers:v.headers},w})),u.then(v=>{const S=VM(v),w=new Qx;return Object.assign(w,S),w})}}async editImageInternal(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI()){const d=_M(this.apiClient,e);return o=ge("{model}:predict",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(p=>p.json().then(m=>{const v=m;return v.sdkHttpResponse={headers:p.headers},v})),i.then(p=>{const m=bM(p),v=new VR;return Object.assign(v,m),v})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI()){const d=LI(this.apiClient,e);return o=ge("{model}:predict",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(p=>p.json().then(m=>{const v=m;return v.sdkHttpResponse={headers:p.headers},v})),i.then(p=>{const m=UI(p),v=new qR;return Object.assign(v,m),v})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI()){const d=yI(this.apiClient,e);return o=ge("{model}:predict",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(p=>p.json()),i.then(p=>{const m=vI(p),v=new FR;return Object.assign(v,m),v})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI()){const d=CI(this.apiClient,e);return o=ge("{model}:predict",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(p=>p.json()),i.then(p=>{const m=TI(p),v=new $R;return Object.assign(v,m),v})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var n,s,i,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const m=sI(this.apiClient,e);return d=ge("{name}",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(v=>v.json()),u.then(v=>Qm(v))}else{const m=nI(this.apiClient,e);return d=ge("{name}",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json()),u.then(v=>Wm(v))}}async listInternal(e){var n,s,i,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const m=cI(this.apiClient,e);return d=ge("{models_url}",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(v=>v.json().then(S=>{const w=S;return w.sdkHttpResponse={headers:v.headers},w})),u.then(v=>{const S=fI(v),w=new eS;return Object.assign(w,S),w})}else{const m=uI(this.apiClient,e);return d=ge("{models_url}",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json().then(S=>{const w=S;return w.sdkHttpResponse={headers:v.headers},w})),u.then(v=>{const S=dI(v),w=new eS;return Object.assign(w,S),w})}}async update(e){var n,s,i,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const m=PI(this.apiClient,e);return d=ge("{model}",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(v=>v.json()),u.then(v=>Qm(v))}else{const m=DI(this.apiClient,e);return d=ge("{name}",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json()),u.then(v=>Wm(v))}}async delete(e){var n,s,i,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const m=vM(this.apiClient,e);return d=ge("{name}",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(v=>v.json().then(S=>{const w=S;return w.sdkHttpResponse={headers:v.headers},w})),u.then(v=>{const S=SM(v),w=new tS;return Object.assign(w,S),w})}else{const m=yM(this.apiClient,e);return d=ge("{name}",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json().then(S=>{const w=S;return w.sdkHttpResponse={headers:v.headers},w})),u.then(v=>{const S=xM(v),w=new tS;return Object.assign(w,S),w})}}async countTokens(e){var n,s,i,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const m=pM(this.apiClient,e);return d=ge("{model}:countTokens",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(v=>v.json().then(S=>{const w=S;return w.sdkHttpResponse={headers:v.headers},w})),u.then(v=>{const S=gM(v),w=new nS;return Object.assign(w,S),w})}else{const m=mM(this.apiClient,e);return d=ge("{model}:countTokens",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json().then(S=>{const w=S;return w.sdkHttpResponse={headers:v.headers},w})),u.then(v=>{const S=hM(v),w=new nS;return Object.assign(w,S),w})}}async computeTokens(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI()){const d=iM(this.apiClient,e);return o=ge("{model}:computeTokens",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(p=>p.json().then(m=>{const v=m;return v.sdkHttpResponse={headers:p.headers},v})),i.then(p=>{const m=oM(p),v=new GR;return Object.assign(v,m),v})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var n,s,i,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const m=jM(this.apiClient,e);return d=ge("{model}:predictLongRunning",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(v=>v.json()),u.then(v=>{const S=HM(v),w=new dc;return Object.assign(w,S),w})}else{const m=zM(this.apiClient,e);return d=ge("{model}:predictLongRunning",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json()),u.then(v=>{const S=GM(v),w=new dc;return Object.assign(w,S),w})}}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class hD extends Ys{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const n=e.operation,s=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=n.name.split("/operations/")[0];let o;s&&"httpOptions"in s&&(o=s.httpOptions);const u=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:i,config:{httpOptions:o}});return n._fromAPIResponse({apiResponse:u,_isVertexAI:!0})}else{const i=await this.getVideosOperationInternal({operationName:n.name,config:s});return n._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async get(e){const n=e.operation,s=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=n.name.split("/operations/")[0];let o;s&&"httpOptions"in s&&(o=s.httpOptions);const u=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:i,config:{httpOptions:o}});return n._fromAPIResponse({apiResponse:u,_isVertexAI:!0})}else{const i=await this.getVideosOperationInternal({operationName:n.name,config:s});return n._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async getVideosOperationInternal(e){var n,s,i,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const m=PR(e);return d=ge("{operationName}",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(v=>v.json()),u}else{const m=DR(e);return d=ge("{operationName}",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json()),u}}async fetchPredictVideosOperationInternal(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI()){const d=TR(e);return o=ge("{resourceName}:fetchPredictOperation",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(p=>p.json()),i}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function gD(t){const e={},n=f(t,["data"]);if(n!=null&&h(e,["data"],n),f(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=f(t,["mimeType"]);return s!=null&&h(e,["mimeType"],s),e}function yD(t){const e={},n=f(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>TD(o))),h(e,["parts"],i)}const s=f(t,["role"]);return s!=null&&h(e,["role"],s),e}function vD(t,e,n){const s={},i=f(e,["expireTime"]);n!==void 0&&i!=null&&h(n,["expireTime"],i);const o=f(e,["newSessionExpireTime"]);n!==void 0&&o!=null&&h(n,["newSessionExpireTime"],o);const u=f(e,["uses"]);n!==void 0&&u!=null&&h(n,["uses"],u);const d=f(e,["liveConnectConstraints"]);n!==void 0&&d!=null&&h(n,["bidiGenerateContentSetup"],CD(t,d));const p=f(e,["lockAdditionalFields"]);return n!==void 0&&p!=null&&h(n,["fieldMask"],p),s}function xD(t,e){const n={},s=f(e,["config"]);return s!=null&&h(n,["config"],vD(t,s,n)),n}function SD(t){const e={};if(f(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=f(t,["fileUri"]);n!=null&&h(e,["fileUri"],n);const s=f(t,["mimeType"]);return s!=null&&h(e,["mimeType"],s),e}function wD(t){const e={};if(f(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=f(t,["enableWidget"]);return n!=null&&h(e,["enableWidget"],n),e}function _D(t){const e={};if(f(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=f(t,["timeRangeFilter"]);return n!=null&&h(e,["timeRangeFilter"],n),e}function bD(t,e){const n={},s=f(t,["generationConfig"]);e!==void 0&&s!=null&&h(e,["setup","generationConfig"],s);const i=f(t,["responseModalities"]);e!==void 0&&i!=null&&h(e,["setup","generationConfig","responseModalities"],i);const o=f(t,["temperature"]);e!==void 0&&o!=null&&h(e,["setup","generationConfig","temperature"],o);const u=f(t,["topP"]);e!==void 0&&u!=null&&h(e,["setup","generationConfig","topP"],u);const d=f(t,["topK"]);e!==void 0&&d!=null&&h(e,["setup","generationConfig","topK"],d);const p=f(t,["maxOutputTokens"]);e!==void 0&&p!=null&&h(e,["setup","generationConfig","maxOutputTokens"],p);const m=f(t,["mediaResolution"]);e!==void 0&&m!=null&&h(e,["setup","generationConfig","mediaResolution"],m);const v=f(t,["seed"]);e!==void 0&&v!=null&&h(e,["setup","generationConfig","seed"],v);const S=f(t,["speechConfig"]);e!==void 0&&S!=null&&h(e,["setup","generationConfig","speechConfig"],Hp(S));const w=f(t,["thinkingConfig"]);e!==void 0&&w!=null&&h(e,["setup","generationConfig","thinkingConfig"],w);const C=f(t,["enableAffectiveDialog"]);e!==void 0&&C!=null&&h(e,["setup","generationConfig","enableAffectiveDialog"],C);const M=f(t,["systemInstruction"]);e!==void 0&&M!=null&&h(e,["setup","systemInstruction"],yD(an(M)));const I=f(t,["tools"]);if(e!==void 0&&I!=null){let Q=Ui(I);Array.isArray(Q)&&(Q=Q.map(J=>ED(Li(J)))),h(e,["setup","tools"],Q)}const k=f(t,["sessionResumption"]);e!==void 0&&k!=null&&h(e,["setup","sessionResumption"],AD(k));const F=f(t,["inputAudioTranscription"]);e!==void 0&&F!=null&&h(e,["setup","inputAudioTranscription"],F);const V=f(t,["outputAudioTranscription"]);e!==void 0&&V!=null&&h(e,["setup","outputAudioTranscription"],V);const G=f(t,["realtimeInputConfig"]);e!==void 0&&G!=null&&h(e,["setup","realtimeInputConfig"],G);const z=f(t,["contextWindowCompression"]);e!==void 0&&z!=null&&h(e,["setup","contextWindowCompression"],z);const ae=f(t,["proactivity"]);return e!==void 0&&ae!=null&&h(e,["setup","proactivity"],ae),n}function CD(t,e){const n={},s=f(e,["model"]);s!=null&&h(n,["setup","model"],Qe(t,s));const i=f(e,["config"]);return i!=null&&h(n,["config"],bD(i,n)),n}function TD(t){const e={},n=f(t,["functionCall"]);n!=null&&h(e,["functionCall"],n);const s=f(t,["codeExecutionResult"]);s!=null&&h(e,["codeExecutionResult"],s);const i=f(t,["executableCode"]);i!=null&&h(e,["executableCode"],i);const o=f(t,["fileData"]);o!=null&&h(e,["fileData"],SD(o));const u=f(t,["functionResponse"]);u!=null&&h(e,["functionResponse"],u);const d=f(t,["inlineData"]);d!=null&&h(e,["inlineData"],gD(d));const p=f(t,["text"]);p!=null&&h(e,["text"],p);const m=f(t,["thought"]);m!=null&&h(e,["thought"],m);const v=f(t,["thoughtSignature"]);v!=null&&h(e,["thoughtSignature"],v);const S=f(t,["videoMetadata"]);return S!=null&&h(e,["videoMetadata"],S),e}function AD(t){const e={},n=f(t,["handle"]);if(n!=null&&h(e,["handle"],n),f(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function ED(t){const e={},n=f(t,["functionDeclarations"]);if(n!=null){let v=n;Array.isArray(v)&&(v=v.map(S=>S)),h(e,["functionDeclarations"],v)}if(f(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=f(t,["googleSearchRetrieval"]);s!=null&&h(e,["googleSearchRetrieval"],s);const i=f(t,["computerUse"]);i!=null&&h(e,["computerUse"],i);const o=f(t,["fileSearch"]);o!=null&&h(e,["fileSearch"],o);const u=f(t,["codeExecution"]);if(u!=null&&h(e,["codeExecution"],u),f(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const d=f(t,["googleMaps"]);d!=null&&h(e,["googleMaps"],wD(d));const p=f(t,["googleSearch"]);p!=null&&h(e,["googleSearch"],_D(p));const m=f(t,["urlContext"]);return m!=null&&h(e,["urlContext"],m),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function RD(t){const e=[];for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const s=t[n];if(typeof s=="object"&&s!=null&&Object.keys(s).length>0){const i=Object.keys(s).map(o=>`${n}.${o}`);e.push(...i)}else e.push(n)}return e.join(",")}function ND(t,e){let n=null;const s=t.bidiGenerateContentSetup;if(typeof s=="object"&&s!==null&&"setup"in s){const o=s.setup;typeof o=="object"&&o!==null?(t.bidiGenerateContentSetup=o,n=o):delete t.bidiGenerateContentSetup}else s!==void 0&&delete t.bidiGenerateContentSetup;const i=t.fieldMask;if(n){const o=RD(n);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)o?t.fieldMask=o:delete t.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&i!==null&&Array.isArray(i)&&i.length>0){const u=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let d=[];i.length>0&&(d=i.map(m=>u.includes(m)?`generationConfig.${m}`:m));const p=[];o&&p.push(o),d.length>0&&p.push(...d),p.length>0?t.fieldMask=p.join(","):delete t.fieldMask}else delete t.fieldMask}else i!==null&&Array.isArray(i)&&i.length>0?t.fieldMask=i.join(","):delete t.fieldMask;return t}class MD extends Ys{constructor(e){super(),this.apiClient=e}async create(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const d=xD(this.apiClient,e);o=ge("auth_tokens",d._url),u=d._query,delete d.config,delete d._url,delete d._query;const p=ND(d,e.config);return i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json()),i.then(m=>m)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ID(t,e){const n={},s=f(t,["displayName"]);return e!==void 0&&s!=null&&h(e,["displayName"],s),n}function DD(t){const e={},n=f(t,["config"]);return n!=null&&ID(n,e),e}function PD(t,e){const n={},s=f(t,["force"]);return e!==void 0&&s!=null&&h(e,["_query","force"],s),n}function kD(t){const e={},n=f(t,["name"]);n!=null&&h(e,["_url","name"],n);const s=f(t,["config"]);return s!=null&&PD(s,e),e}function LD(t){const e={},n=f(t,["name"]);return n!=null&&h(e,["_url","name"],n),e}function UD(t,e){const n={},s=f(t,["customMetadata"]);if(e!==void 0&&s!=null){let o=s;Array.isArray(o)&&(o=o.map(u=>u)),h(e,["customMetadata"],o)}const i=f(t,["chunkingConfig"]);return e!==void 0&&i!=null&&h(e,["chunkingConfig"],i),n}function OD(t){const e={},n=f(t,["name"]);n!=null&&h(e,["name"],n);const s=f(t,["metadata"]);s!=null&&h(e,["metadata"],s);const i=f(t,["done"]);i!=null&&h(e,["done"],i);const o=f(t,["error"]);o!=null&&h(e,["error"],o);const u=f(t,["response"]);return u!=null&&h(e,["response"],VD(u)),e}function BD(t){const e={},n=f(t,["fileSearchStoreName"]);n!=null&&h(e,["_url","file_search_store_name"],n);const s=f(t,["fileName"]);s!=null&&h(e,["fileName"],s);const i=f(t,["config"]);return i!=null&&UD(i,e),e}function VD(t){const e={},n=f(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=f(t,["parent"]);s!=null&&h(e,["parent"],s);const i=f(t,["documentName"]);return i!=null&&h(e,["documentName"],i),e}function qD(t,e){const n={},s=f(t,["pageSize"]);e!==void 0&&s!=null&&h(e,["_query","pageSize"],s);const i=f(t,["pageToken"]);return e!==void 0&&i!=null&&h(e,["_query","pageToken"],i),n}function FD(t){const e={},n=f(t,["config"]);return n!=null&&qD(n,e),e}function $D(t){const e={},n=f(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=f(t,["nextPageToken"]);s!=null&&h(e,["nextPageToken"],s);const i=f(t,["fileSearchStores"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(u=>u)),h(e,["fileSearchStores"],o)}return e}function GD(t,e){const n={},s=f(t,["mimeType"]);e!==void 0&&s!=null&&h(e,["mimeType"],s);const i=f(t,["displayName"]);e!==void 0&&i!=null&&h(e,["displayName"],i);const o=f(t,["customMetadata"]);if(e!==void 0&&o!=null){let d=o;Array.isArray(d)&&(d=d.map(p=>p)),h(e,["customMetadata"],d)}const u=f(t,["chunkingConfig"]);return e!==void 0&&u!=null&&h(e,["chunkingConfig"],u),n}function HD(t){const e={},n=f(t,["fileSearchStoreName"]);n!=null&&h(e,["_url","file_search_store_name"],n);const s=f(t,["config"]);return s!=null&&GD(s,e),e}function zD(t){const e={},n=f(t,["sdkHttpResponse"]);return n!=null&&h(e,["sdkHttpResponse"],n),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function jD(t,e){const n={},s=f(t,["force"]);return e!==void 0&&s!=null&&h(e,["_query","force"],s),n}function JD(t){const e={},n=f(t,["name"]);n!=null&&h(e,["_url","name"],n);const s=f(t,["config"]);return s!=null&&jD(s,e),e}function YD(t){const e={},n=f(t,["name"]);return n!=null&&h(e,["_url","name"],n),e}function KD(t,e){const n={},s=f(t,["pageSize"]);e!==void 0&&s!=null&&h(e,["_query","pageSize"],s);const i=f(t,["pageToken"]);return e!==void 0&&i!=null&&h(e,["_query","pageToken"],i),n}function ZD(t){const e={},n=f(t,["parent"]);n!=null&&h(e,["_url","parent"],n);const s=f(t,["config"]);return s!=null&&KD(s,e),e}function XD(t){const e={},n=f(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=f(t,["nextPageToken"]);s!=null&&h(e,["nextPageToken"],s);const i=f(t,["documents"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(u=>u)),h(e,["documents"],o)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class WD extends Ys{constructor(e){super(),this.apiClient=e,this.list=async n=>new wr(js.PAGED_ITEM_DOCUMENTS,s=>this.listInternal({parent:n.parent,config:s.config}),await this.listInternal(n),n)}async get(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=YD(e);return o=ge("{name}",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(p=>p.json()),i.then(p=>p)}}async delete(e){var n,s;let i="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=JD(e);i=ge("{name}",u._url),o=u._query,delete u._url,delete u._query,await this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}}async listInternal(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=ZD(e);return o=ge("{parent}/documents",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(p=>p.json()),i.then(p=>{const m=XD(p),v=new HR;return Object.assign(v,m),v})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class QD extends Ys{constructor(e,n=new WD(e)){super(),this.apiClient=e,this.documents=n,this.list=async(s={})=>new wr(js.PAGED_ITEM_FILE_SEARCH_STORES,i=>this.listInternal(i),await this.listInternal(s),s)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=DD(e);return o=ge("fileSearchStores",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(p=>p.json()),i.then(p=>p)}}async get(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=LD(e);return o=ge("{name}",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(p=>p.json()),i.then(p=>p)}}async delete(e){var n,s;let i="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=kD(e);i=ge("{name}",u._url),o=u._query,delete u._url,delete u._query,await this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}}async listInternal(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=FD(e);return o=ge("fileSearchStores",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(p=>p.json()),i.then(p=>{const m=$D(p),v=new zR;return Object.assign(v,m),v})}}async uploadToFileSearchStoreInternal(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=HD(e);return o=ge("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(p=>p.json()),i.then(p=>{const m=zD(p),v=new jR;return Object.assign(v,m),v})}}async importFile(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=BD(e);return o=ge("{file_search_store_name}:importFile",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(p=>p.json()),i.then(p=>{const m=OD(p),v=new Vp;return Object.assign(v,m),v})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function e2(t,e){const n={},s=f(t,["name"]);return s!=null&&h(n,["_url","name"],s),n}function t2(t,e){const n={},s=f(t,["name"]);return s!=null&&h(n,["_url","name"],s),n}function n2(t,e,n){const s={};if(f(t,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const i=f(t,["tunedModelDisplayName"]);if(e!==void 0&&i!=null&&h(e,["displayName"],i),f(t,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const o=f(t,["epochCount"]);e!==void 0&&o!=null&&h(e,["tuningTask","hyperparameters","epochCount"],o);const u=f(t,["learningRateMultiplier"]);if(u!=null&&h(s,["tuningTask","hyperparameters","learningRateMultiplier"],u),f(t,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(f(t,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(f(t,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const d=f(t,["batchSize"]);e!==void 0&&d!=null&&h(e,["tuningTask","hyperparameters","batchSize"],d);const p=f(t,["learningRate"]);if(e!==void 0&&p!=null&&h(e,["tuningTask","hyperparameters","learningRate"],p),f(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(f(t,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return s}function s2(t,e,n){const s={};let i=f(n,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){const C=f(t,["validationDataset"]);e!==void 0&&C!=null&&h(e,["supervisedTuningSpec"],CS(C))}else if(i==="PREFERENCE_TUNING"){const C=f(t,["validationDataset"]);e!==void 0&&C!=null&&h(e,["preferenceOptimizationSpec"],CS(C))}const o=f(t,["tunedModelDisplayName"]);e!==void 0&&o!=null&&h(e,["tunedModelDisplayName"],o);const u=f(t,["description"]);e!==void 0&&u!=null&&h(e,["description"],u);let d=f(n,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){const C=f(t,["epochCount"]);e!==void 0&&C!=null&&h(e,["supervisedTuningSpec","hyperParameters","epochCount"],C)}else if(d==="PREFERENCE_TUNING"){const C=f(t,["epochCount"]);e!==void 0&&C!=null&&h(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],C)}let p=f(n,["config","method"]);if(p===void 0&&(p="SUPERVISED_FINE_TUNING"),p==="SUPERVISED_FINE_TUNING"){const C=f(t,["learningRateMultiplier"]);e!==void 0&&C!=null&&h(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],C)}else if(p==="PREFERENCE_TUNING"){const C=f(t,["learningRateMultiplier"]);e!==void 0&&C!=null&&h(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],C)}let m=f(n,["config","method"]);if(m===void 0&&(m="SUPERVISED_FINE_TUNING"),m==="SUPERVISED_FINE_TUNING"){const C=f(t,["exportLastCheckpointOnly"]);e!==void 0&&C!=null&&h(e,["supervisedTuningSpec","exportLastCheckpointOnly"],C)}else if(m==="PREFERENCE_TUNING"){const C=f(t,["exportLastCheckpointOnly"]);e!==void 0&&C!=null&&h(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],C)}let v=f(n,["config","method"]);if(v===void 0&&(v="SUPERVISED_FINE_TUNING"),v==="SUPERVISED_FINE_TUNING"){const C=f(t,["adapterSize"]);e!==void 0&&C!=null&&h(e,["supervisedTuningSpec","hyperParameters","adapterSize"],C)}else if(v==="PREFERENCE_TUNING"){const C=f(t,["adapterSize"]);e!==void 0&&C!=null&&h(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],C)}if(f(t,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(f(t,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const S=f(t,["labels"]);e!==void 0&&S!=null&&h(e,["labels"],S);const w=f(t,["beta"]);return e!==void 0&&w!=null&&h(e,["preferenceOptimizationSpec","hyperParameters","beta"],w),s}function a2(t,e){const n={},s=f(t,["baseModel"]);s!=null&&h(n,["baseModel"],s);const i=f(t,["preTunedModel"]);i!=null&&h(n,["preTunedModel"],i);const o=f(t,["trainingDataset"]);o!=null&&h2(o);const u=f(t,["config"]);return u!=null&&n2(u,n),n}function r2(t,e){const n={},s=f(t,["baseModel"]);s!=null&&h(n,["baseModel"],s);const i=f(t,["preTunedModel"]);i!=null&&h(n,["preTunedModel"],i);const o=f(t,["trainingDataset"]);o!=null&&g2(o,n,e);const u=f(t,["config"]);return u!=null&&s2(u,n,e),n}function i2(t,e){const n={},s=f(t,["name"]);return s!=null&&h(n,["_url","name"],s),n}function o2(t,e){const n={},s=f(t,["name"]);return s!=null&&h(n,["_url","name"],s),n}function l2(t,e,n){const s={},i=f(t,["pageSize"]);e!==void 0&&i!=null&&h(e,["_query","pageSize"],i);const o=f(t,["pageToken"]);e!==void 0&&o!=null&&h(e,["_query","pageToken"],o);const u=f(t,["filter"]);return e!==void 0&&u!=null&&h(e,["_query","filter"],u),s}function u2(t,e,n){const s={},i=f(t,["pageSize"]);e!==void 0&&i!=null&&h(e,["_query","pageSize"],i);const o=f(t,["pageToken"]);e!==void 0&&o!=null&&h(e,["_query","pageToken"],o);const u=f(t,["filter"]);return e!==void 0&&u!=null&&h(e,["_query","filter"],u),s}function c2(t,e){const n={},s=f(t,["config"]);return s!=null&&l2(s,n),n}function d2(t,e){const n={},s=f(t,["config"]);return s!=null&&u2(s,n),n}function f2(t,e){const n={},s=f(t,["sdkHttpResponse"]);s!=null&&h(n,["sdkHttpResponse"],s);const i=f(t,["nextPageToken"]);i!=null&&h(n,["nextPageToken"],i);const o=f(t,["tunedModels"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(d=>eb(d))),h(n,["tuningJobs"],u)}return n}function m2(t,e){const n={},s=f(t,["sdkHttpResponse"]);s!=null&&h(n,["sdkHttpResponse"],s);const i=f(t,["nextPageToken"]);i!=null&&h(n,["nextPageToken"],i);const o=f(t,["tuningJobs"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(d=>tp(d))),h(n,["tuningJobs"],u)}return n}function p2(t,e){const n={},s=f(t,["name"]);s!=null&&h(n,["model"],s);const i=f(t,["name"]);return i!=null&&h(n,["endpoint"],i),n}function h2(t,e){const n={};if(f(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(f(t,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const s=f(t,["examples"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(o=>o)),h(n,["examples","examples"],i)}return n}function g2(t,e,n){const s={};let i=f(n,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){const u=f(t,["gcsUri"]);e!==void 0&&u!=null&&h(e,["supervisedTuningSpec","trainingDatasetUri"],u)}else if(i==="PREFERENCE_TUNING"){const u=f(t,["gcsUri"]);e!==void 0&&u!=null&&h(e,["preferenceOptimizationSpec","trainingDatasetUri"],u)}let o=f(n,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){const u=f(t,["vertexDatasetResource"]);e!==void 0&&u!=null&&h(e,["supervisedTuningSpec","trainingDatasetUri"],u)}else if(o==="PREFERENCE_TUNING"){const u=f(t,["vertexDatasetResource"]);e!==void 0&&u!=null&&h(e,["preferenceOptimizationSpec","trainingDatasetUri"],u)}if(f(t,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return s}function eb(t,e){const n={},s=f(t,["sdkHttpResponse"]);s!=null&&h(n,["sdkHttpResponse"],s);const i=f(t,["name"]);i!=null&&h(n,["name"],i);const o=f(t,["state"]);o!=null&&h(n,["state"],L_(o));const u=f(t,["createTime"]);u!=null&&h(n,["createTime"],u);const d=f(t,["tuningTask","startTime"]);d!=null&&h(n,["startTime"],d);const p=f(t,["tuningTask","completeTime"]);p!=null&&h(n,["endTime"],p);const m=f(t,["updateTime"]);m!=null&&h(n,["updateTime"],m);const v=f(t,["description"]);v!=null&&h(n,["description"],v);const S=f(t,["baseModel"]);S!=null&&h(n,["baseModel"],S);const w=f(t,["_self"]);return w!=null&&h(n,["tunedModel"],p2(w)),n}function tp(t,e){const n={},s=f(t,["sdkHttpResponse"]);s!=null&&h(n,["sdkHttpResponse"],s);const i=f(t,["name"]);i!=null&&h(n,["name"],i);const o=f(t,["state"]);o!=null&&h(n,["state"],L_(o));const u=f(t,["createTime"]);u!=null&&h(n,["createTime"],u);const d=f(t,["startTime"]);d!=null&&h(n,["startTime"],d);const p=f(t,["endTime"]);p!=null&&h(n,["endTime"],p);const m=f(t,["updateTime"]);m!=null&&h(n,["updateTime"],m);const v=f(t,["error"]);v!=null&&h(n,["error"],v);const S=f(t,["description"]);S!=null&&h(n,["description"],S);const w=f(t,["baseModel"]);w!=null&&h(n,["baseModel"],w);const C=f(t,["tunedModel"]);C!=null&&h(n,["tunedModel"],C);const M=f(t,["preTunedModel"]);M!=null&&h(n,["preTunedModel"],M);const I=f(t,["supervisedTuningSpec"]);I!=null&&h(n,["supervisedTuningSpec"],I);const k=f(t,["preferenceOptimizationSpec"]);k!=null&&h(n,["preferenceOptimizationSpec"],k);const F=f(t,["tuningDataStats"]);F!=null&&h(n,["tuningDataStats"],F);const V=f(t,["encryptionSpec"]);V!=null&&h(n,["encryptionSpec"],V);const G=f(t,["partnerModelTuningSpec"]);G!=null&&h(n,["partnerModelTuningSpec"],G);const z=f(t,["customBaseModel"]);z!=null&&h(n,["customBaseModel"],z);const ae=f(t,["experiment"]);ae!=null&&h(n,["experiment"],ae);const Q=f(t,["labels"]);Q!=null&&h(n,["labels"],Q);const J=f(t,["outputUri"]);J!=null&&h(n,["outputUri"],J);const j=f(t,["pipelineJob"]);j!=null&&h(n,["pipelineJob"],j);const X=f(t,["serviceAccount"]);X!=null&&h(n,["serviceAccount"],X);const ne=f(t,["tunedModelDisplayName"]);ne!=null&&h(n,["tunedModelDisplayName"],ne);const le=f(t,["veoTuningSpec"]);return le!=null&&h(n,["veoTuningSpec"],le),n}function y2(t,e){const n={},s=f(t,["sdkHttpResponse"]);s!=null&&h(n,["sdkHttpResponse"],s);const i=f(t,["name"]);i!=null&&h(n,["name"],i);const o=f(t,["metadata"]);o!=null&&h(n,["metadata"],o);const u=f(t,["done"]);u!=null&&h(n,["done"],u);const d=f(t,["error"]);return d!=null&&h(n,["error"],d),n}function CS(t,e){const n={},s=f(t,["gcsUri"]);s!=null&&h(n,["validationDatasetUri"],s);const i=f(t,["vertexDatasetResource"]);return i!=null&&h(n,["validationDatasetUri"],i),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class v2 extends Ys{constructor(e){super(),this.apiClient=e,this.get=async n=>await this.getInternal(n),this.list=async(n={})=>new wr(js.PAGED_ITEM_TUNING_JOBS,s=>this.listInternal(s),await this.listInternal(n),n),this.tune=async n=>{var s;if(this.apiClient.isVertexAI())if(n.baseModel.startsWith("projects/")){const i={tunedModelName:n.baseModel};!((s=n.config)===null||s===void 0)&&s.preTunedModelCheckpointId&&(i.checkpointId=n.config.preTunedModelCheckpointId);const o=Object.assign(Object.assign({},n),{preTunedModel:i});return o.baseModel=void 0,await this.tuneInternal(o)}else{const i=Object.assign({},n);return await this.tuneInternal(i)}else{const i=Object.assign({},n),o=await this.tuneMldevInternal(i);let u="";return o.metadata!==void 0&&o.metadata.tunedModel!==void 0?u=o.metadata.tunedModel:o.name!==void 0&&o.name.includes("/operations/")&&(u=o.name.split("/operations/")[0]),{name:u,state:Ym.JOB_STATE_QUEUED}}}}async getInternal(e){var n,s,i,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const m=o2(e);return d=ge("{name}",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(v=>v.json().then(S=>{const w=S;return w.sdkHttpResponse={headers:v.headers},w})),u.then(v=>tp(v))}else{const m=i2(e);return d=ge("{name}",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json().then(S=>{const w=S;return w.sdkHttpResponse={headers:v.headers},w})),u.then(v=>eb(v))}}async listInternal(e){var n,s,i,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const m=d2(e);return d=ge("tuningJobs",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(v=>v.json().then(S=>{const w=S;return w.sdkHttpResponse={headers:v.headers},w})),u.then(v=>{const S=m2(v),w=new sS;return Object.assign(w,S),w})}else{const m=c2(e);return d=ge("tunedModels",m._url),p=m._query,delete m._url,delete m._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(m),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json().then(S=>{const w=S;return w.sdkHttpResponse={headers:v.headers},w})),u.then(v=>{const S=f2(v),w=new sS;return Object.assign(w,S),w})}}async cancel(e){var n,s,i,o;let u="",d={};if(this.apiClient.isVertexAI()){const p=t2(e);u=ge("{name}:cancel",p._url),d=p._query,delete p._url,delete p._query,await this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}else{const p=e2(e);u=ge("{name}:cancel",p._url),d=p._query,delete p._url,delete p._query,await this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}}async tuneInternal(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI()){const d=r2(e,e);return o=ge("tuningJobs",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(p=>p.json().then(m=>{const v=m;return v.sdkHttpResponse={headers:p.headers},v})),i.then(p=>tp(p))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=a2(e);return o=ge("tunedModels",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(p=>p.json().then(m=>{const v=m;return v.sdkHttpResponse={headers:p.headers},v})),i.then(p=>y2(p))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class x2{async download(e,n){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const S2=1024*1024*8,w2=3,_2=1e3,b2=2,mc="x-goog-upload-status";async function C2(t,e,n){var s;const i=await tb(t,e,n),o=await(i==null?void 0:i.json());if(((s=i==null?void 0:i.headers)===null||s===void 0?void 0:s[mc])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return o.file}async function T2(t,e,n){var s;const i=await tb(t,e,n),o=await(i==null?void 0:i.json());if(((s=i==null?void 0:i.headers)===null||s===void 0?void 0:s[mc])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const u=N_(o),d=new qp;return Object.assign(d,u),d}async function tb(t,e,n){var s,i;let o=0,u=0,d=new Km(new Response),p="upload";for(o=t.size;u<o;){const m=Math.min(S2,o-u),v=t.slice(u,u+m);u+m>=o&&(p+=", finalize");let S=0,w=_2;for(;S<w2&&(d=await n.request({path:"",body:v,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":p,"X-Goog-Upload-Offset":String(u),"Content-Length":String(m)}}}),!(!((s=d==null?void 0:d.headers)===null||s===void 0)&&s[mc]));)S++,await E2(w),w=w*b2;if(u+=m,((i=d==null?void 0:d.headers)===null||i===void 0?void 0:i[mc])!=="active")break;if(o<=u)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return d}async function A2(t){return{size:t.size,type:t.type}}function E2(t){return new Promise(e=>setTimeout(e,t))}class R2{async upload(e,n,s){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await C2(e,n,s)}async uploadToFileSearchStore(e,n,s){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await T2(e,n,s)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await A2(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class N2{create(e,n,s){return new M2(e,n,s)}}class M2{constructor(e,n,s){this.url=e,this.headers=n,this.callbacks=s}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const TS="x-goog-api-key";class I2{constructor(e){this.apiKey=e}async addAuthHeaders(e,n){if(e.get(TS)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(TS,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const D2="gl-node/";class P2{constructor(e){var n;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(n=e.vertexai)!==null&&n!==void 0?n:!1,this.apiKey=e.apiKey;const s=bR(e.httpOptions,e.vertexai,void 0,void 0);s&&(e.httpOptions?e.httpOptions.baseUrl=s:e.httpOptions={baseUrl:s}),this.apiVersion=e.apiVersion;const i=new I2(this.apiKey);this.apiClient=new KI({auth:i,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:D2+"web",uploader:new R2,downloader:new x2}),this.models=new pD(this.apiClient),this.live=new lD(this.apiClient,i,new N2),this.batches=new YN(this.apiClient),this.chats=new A1(this.models,this.apiClient),this.caches=new b1(this.apiClient),this.files=new U1(this.apiClient),this.operations=new hD(this.apiClient),this.authTokens=new MD(this.apiClient),this.tunings=new v2(this.apiClient),this.fileSearchStores=new QD(this.apiClient)}}const np="RFC3986",sp={RFC1738:t=>String(t).replace(/%20/g,"+"),RFC3986:t=>String(t)},k2="RFC1738",L2=Array.isArray,cs=(()=>{const t=[];for(let e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t})(),gm=1024,U2=(t,e,n,s,i)=>{if(t.length===0)return t;let o=t;if(typeof t=="symbol"?o=Symbol.prototype.toString.call(t):typeof t!="string"&&(o=String(t)),n==="iso-8859-1")return escape(o).replace(/%u[0-9a-f]{4}/gi,function(d){return"%26%23"+parseInt(d.slice(2),16)+"%3B"});let u="";for(let d=0;d<o.length;d+=gm){const p=o.length>=gm?o.slice(d,d+gm):o,m=[];for(let v=0;v<p.length;++v){let S=p.charCodeAt(v);if(S===45||S===46||S===95||S===126||S>=48&&S<=57||S>=65&&S<=90||S>=97&&S<=122||i===k2&&(S===40||S===41)){m[m.length]=p.charAt(v);continue}if(S<128){m[m.length]=cs[S];continue}if(S<2048){m[m.length]=cs[192|S>>6]+cs[128|S&63];continue}if(S<55296||S>=57344){m[m.length]=cs[224|S>>12]+cs[128|S>>6&63]+cs[128|S&63];continue}v+=1,S=65536+((S&1023)<<10|p.charCodeAt(v)&1023),m[m.length]=cs[240|S>>18]+cs[128|S>>12&63]+cs[128|S>>6&63]+cs[128|S&63]}u+=m.join("")}return u};function O2(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))}function AS(t,e){if(L2(t)){const n=[];for(let s=0;s<t.length;s+=1)n.push(e(t[s]));return n}return e(t)}const B2=Object.prototype.hasOwnProperty,nb={brackets(t){return String(t)+"[]"},comma:"comma",indices(t,e){return String(t)+"["+e+"]"},repeat(t){return String(t)}},ds=Array.isArray,V2=Array.prototype.push,sb=function(t,e){V2.apply(t,ds(e)?e:[e])},q2=Date.prototype.toISOString,$t={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:U2,encodeValuesOnly:!1,format:np,formatter:sp[np],indices:!1,serializeDate(t){return q2.call(t)},skipNulls:!1,strictNullHandling:!1};function F2(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"}const ym={};function ab(t,e,n,s,i,o,u,d,p,m,v,S,w,C,M,I,k,F){let V=t,G=F,z=0,ae=!1;for(;(G=G.get(ym))!==void 0&&!ae;){const ne=G.get(t);if(z+=1,typeof ne<"u"){if(ne===z)throw new RangeError("Cyclic object value");ae=!0}typeof G.get(ym)>"u"&&(z=0)}if(typeof m=="function"?V=m(e,V):V instanceof Date?V=w==null?void 0:w(V):n==="comma"&&ds(V)&&(V=AS(V,function(ne){return ne instanceof Date?w==null?void 0:w(ne):ne})),V===null){if(o)return p&&!I?p(e,$t.encoder,k,"key",C):e;V=""}if(F2(V)||O2(V)){if(p){const ne=I?e:p(e,$t.encoder,k,"key",C);return[(M==null?void 0:M(ne))+"="+(M==null?void 0:M(p(V,$t.encoder,k,"value",C)))]}return[(M==null?void 0:M(e))+"="+(M==null?void 0:M(String(V)))]}const Q=[];if(typeof V>"u")return Q;let J;if(n==="comma"&&ds(V))I&&p&&(V=AS(V,p)),J=[{value:V.length>0?V.join(",")||null:void 0}];else if(ds(m))J=m;else{const ne=Object.keys(V);J=v?ne.sort(v):ne}const j=d?String(e).replace(/\./g,"%2E"):String(e),X=s&&ds(V)&&V.length===1?j+"[]":j;if(i&&ds(V)&&V.length===0)return X+"[]";for(let ne=0;ne<J.length;++ne){const le=J[ne],_=typeof le=="object"&&typeof le.value<"u"?le.value:V[le];if(u&&_===null)continue;const E=S&&d?le.replace(/\./g,"%2E"):le,P=ds(V)?typeof n=="function"?n(X,E):X:X+(S?"."+E:"["+E+"]");F.set(t,z);const D=new WeakMap;D.set(ym,F),sb(Q,ab(_,P,n,s,i,o,u,d,n==="comma"&&I&&ds(V)?null:p,m,v,S,w,C,M,I,k,D))}return Q}function $2(t=$t){if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.encodeDotInKeys<"u"&&typeof t.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=t.charset||$t.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=np;if(typeof t.format<"u"){if(!B2.call(sp,t.format))throw new TypeError("Unknown format option provided.");n=t.format}const s=sp[n];let i=$t.filter;(typeof t.filter=="function"||ds(t.filter))&&(i=t.filter);let o;if(t.arrayFormat&&t.arrayFormat in nb?o=t.arrayFormat:"indices"in t?o=t.indices?"indices":"repeat":o=$t.arrayFormat,"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const u=typeof t.allowDots>"u"?t.encodeDotInKeys?!0:$t.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:$t.addQueryPrefix,allowDots:u,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:$t.allowEmptyArrays,arrayFormat:o,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:$t.charsetSentinel,commaRoundTrip:!!t.commaRoundTrip,delimiter:typeof t.delimiter>"u"?$t.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:$t.encode,encodeDotInKeys:typeof t.encodeDotInKeys=="boolean"?t.encodeDotInKeys:$t.encodeDotInKeys,encoder:typeof t.encoder=="function"?t.encoder:$t.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:$t.encodeValuesOnly,filter:i,format:n,formatter:s,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:$t.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:$t.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:$t.strictNullHandling}}function G2(t,e={}){let n=t;const s=$2(e);let i,o;typeof s.filter=="function"?(o=s.filter,n=o("",n)):ds(s.filter)&&(o=s.filter,i=o);const u=[];if(typeof n!="object"||n===null)return"";const d=nb[s.arrayFormat],p=d==="comma"&&s.commaRoundTrip;i||(i=Object.keys(n)),s.sort&&i.sort(s.sort);const m=new WeakMap;for(let w=0;w<i.length;++w){const C=i[w];s.skipNulls&&n[C]===null||sb(u,ab(n[C],C,d,p,s.allowEmptyArrays,s.strictNullHandling,s.skipNulls,s.encodeDotInKeys,s.encode?s.encoder:null,s.filter,s.sort,s.allowDots,s.serializeDate,s.format,s.formatter,s.encodeValuesOnly,s.charset,m))}const v=u.join(s.delimiter);let S=s.addQueryPrefix===!0?"?":"";return s.charsetSentinel&&(s.charset==="iso-8859-1"?S+="utf8=%26%2310003%3B&":S+="utf8=%E2%9C%93&"),v.length>0?S+v:""}const di="4.104.0";let ES=!1,Jo,rb,ib,ap,ob,lb,ub,cb,db;function H2(t,e={auto:!1}){if(ES)throw new Error(`you must \`import 'openai/shims/${t.kind}'\` before importing anything else from openai`);if(Jo)throw new Error(`can't \`import 'openai/shims/${t.kind}'\` after \`import 'openai/shims/${Jo}'\``);ES=e.auto,Jo=t.kind,rb=t.fetch,ib=t.FormData,ap=t.File,ob=t.ReadableStream,lb=t.getMultipartRequestOptions,ub=t.getDefaultAgent,cb=t.fileFromPath,db=t.isFsReadStream}class z2{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function j2({manuallyImported:t}={}){const e=t?"You may need to use polyfills":"Add one of these imports before your first `import  from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let n,s,i,o;try{n=fetch,s=Request,i=Response,o=Headers}catch(u){throw new Error(`this environment is missing the following Web Fetch API type: ${u.message}. ${e}`)}return{kind:"web",fetch:n,Request:s,Response:i,Headers:o,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(u,d)=>({...d,body:new z2(u)}),getDefaultAgent:u=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:u=>!1}}const fb=()=>{Jo||H2(j2(),{auto:!0})};fb();class Re extends Error{}class Qt extends Re{constructor(e,n,s,i){super(`${Qt.makeMessage(e,n,s)}`),this.status=e,this.headers=i,this.request_id=i==null?void 0:i["x-request-id"],this.error=n;const o=n;this.code=o==null?void 0:o.code,this.param=o==null?void 0:o.param,this.type=o==null?void 0:o.type}static makeMessage(e,n,s){const i=n!=null&&n.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):n?JSON.stringify(n):s;return e&&i?`${e} ${i}`:e?`${e} status code (no body)`:i||"(no status code or body)"}static generate(e,n,s,i){if(!e||!i)return new Ic({message:s,cause:ip(n)});const o=n==null?void 0:n.error;return e===400?new mb(e,o,s,i):e===401?new pb(e,o,s,i):e===403?new hb(e,o,s,i):e===404?new gb(e,o,s,i):e===409?new yb(e,o,s,i):e===422?new vb(e,o,s,i):e===429?new xb(e,o,s,i):e>=500?new Sb(e,o,s,i):new Qt(e,o,s,i)}}class zn extends Qt{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class Ic extends Qt{constructor({message:e,cause:n}){super(void 0,void 0,e||"Connection error.",void 0),n&&(this.cause=n)}}class jp extends Ic{constructor({message:e}={}){super({message:e??"Request timed out."})}}class mb extends Qt{}class pb extends Qt{}class hb extends Qt{}class gb extends Qt{}class yb extends Qt{}class vb extends Qt{}class xb extends Qt{}class Sb extends Qt{}class wb extends Re{constructor(){super("Could not parse response content as the length limit was reached")}}class _b extends Re{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var Uu=function(t,e,n,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(t,n):i?i.value=n:e.set(t,n),n},dr=function(t,e,n,s){if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)},En;class Dc{constructor(){En.set(this,void 0),this.buffer=new Uint8Array,Uu(this,En,null,"f")}decode(e){if(e==null)return[];const n=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e;let s=new Uint8Array(this.buffer.length+n.length);s.set(this.buffer),s.set(n,this.buffer.length),this.buffer=s;const i=[];let o;for(;(o=J2(this.buffer,dr(this,En,"f")))!=null;){if(o.carriage&&dr(this,En,"f")==null){Uu(this,En,o.index,"f");continue}if(dr(this,En,"f")!=null&&(o.index!==dr(this,En,"f")+1||o.carriage)){i.push(this.decodeText(this.buffer.slice(0,dr(this,En,"f")-1))),this.buffer=this.buffer.slice(dr(this,En,"f")),Uu(this,En,null,"f");continue}const u=dr(this,En,"f")!==null?o.preceding-1:o.preceding,d=this.decodeText(this.buffer.slice(0,u));i.push(d),this.buffer=this.buffer.slice(o.index),Uu(this,En,null,"f")}return i}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new Re(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new Re(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new Re("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}}En=new WeakMap;Dc.NEWLINE_CHARS=new Set([`
`,"\r"]);Dc.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function J2(t,e){for(let i=e??0;i<t.length;i++){if(t[i]===10)return{preceding:i,index:i+1,carriage:!1};if(t[i]===13)return{preceding:i,index:i+1,carriage:!0}}return null}function Y2(t){for(let s=0;s<t.length-1;s++){if(t[s]===10&&t[s+1]===10||t[s]===13&&t[s+1]===13)return s+2;if(t[s]===13&&t[s+1]===10&&s+3<t.length&&t[s+2]===13&&t[s+3]===10)return s+4}return-1}function bb(t){if(t[Symbol.asyncIterator])return t;const e=t.getReader();return{async next(){try{const n=await e.read();return n!=null&&n.done&&e.releaseLock(),n}catch(n){throw e.releaseLock(),n}},async return(){const n=e.cancel();return e.releaseLock(),await n,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}class hs{constructor(e,n){this.iterator=e,this.controller=n}static fromSSEResponse(e,n){let s=!1;async function*i(){if(s)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let o=!1;try{for await(const u of K2(e,n))if(!o){if(u.data.startsWith("[DONE]")){o=!0;continue}if(u.event===null||u.event.startsWith("response.")||u.event.startsWith("transcript.")){let d;try{d=JSON.parse(u.data)}catch(p){throw console.error("Could not parse message into JSON:",u.data),console.error("From chunk:",u.raw),p}if(d&&d.error)throw new Qt(void 0,d.error,void 0,Mb(e.headers));yield d}else{let d;try{d=JSON.parse(u.data)}catch(p){throw console.error("Could not parse message into JSON:",u.data),console.error("From chunk:",u.raw),p}if(u.event=="error")throw new Qt(void 0,d.error,d.message,void 0);yield{event:u.event,data:d}}}o=!0}catch(u){if(u instanceof Error&&u.name==="AbortError")return;throw u}finally{o||n.abort()}}return new hs(i,n)}static fromReadableStream(e,n){let s=!1;async function*i(){const u=new Dc,d=bb(e);for await(const p of d)for(const m of u.decode(p))yield m;for(const p of u.flush())yield p}async function*o(){if(s)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let u=!1;try{for await(const d of i())u||d&&(yield JSON.parse(d));u=!0}catch(d){if(d instanceof Error&&d.name==="AbortError")return;throw d}finally{u||n.abort()}}return new hs(o,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],n=[],s=this.iterator(),i=o=>({next:()=>{if(o.length===0){const u=s.next();e.push(u),n.push(u)}return o.shift()}});return[new hs(()=>i(e),this.controller),new hs(()=>i(n),this.controller)]}toReadableStream(){const e=this;let n;const s=new TextEncoder;return new ob({async start(){n=e[Symbol.asyncIterator]()},async pull(i){try{const{value:o,done:u}=await n.next();if(u)return i.close();const d=s.encode(JSON.stringify(o)+`
`);i.enqueue(d)}catch(o){i.error(o)}},async cancel(){var i;await((i=n.return)==null?void 0:i.call(n))}})}}async function*K2(t,e){if(!t.body)throw e.abort(),new Re("Attempted to iterate over a response with no body");const n=new X2,s=new Dc,i=bb(t.body);for await(const o of Z2(i))for(const u of s.decode(o)){const d=n.decode(u);d&&(yield d)}for(const o of s.flush()){const u=n.decode(o);u&&(yield u)}}async function*Z2(t){let e=new Uint8Array;for await(const n of t){if(n==null)continue;const s=n instanceof ArrayBuffer?new Uint8Array(n):typeof n=="string"?new TextEncoder().encode(n):n;let i=new Uint8Array(e.length+s.length);i.set(e),i.set(s,e.length),e=i;let o;for(;(o=Y2(e))!==-1;)yield e.slice(0,o),e=e.slice(o)}e.length>0&&(yield e)}class X2{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const o={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],o}if(this.chunks.push(e),e.startsWith(":"))return null;let[n,s,i]=W2(e,":");return i.startsWith(" ")&&(i=i.substring(1)),n==="event"?this.event=i:n==="data"&&this.data.push(i),null}}function W2(t,e){const n=t.indexOf(e);return n!==-1?[t.substring(0,n),e,t.substring(n+e.length)]:[t,"",""]}const Cb=t=>t!=null&&typeof t=="object"&&typeof t.url=="string"&&typeof t.blob=="function",Tb=t=>t!=null&&typeof t=="object"&&typeof t.name=="string"&&typeof t.lastModified=="number"&&Pc(t),Pc=t=>t!=null&&typeof t=="object"&&typeof t.size=="number"&&typeof t.type=="string"&&typeof t.text=="function"&&typeof t.slice=="function"&&typeof t.arrayBuffer=="function",Q2=t=>Tb(t)||Cb(t)||db(t);async function Ab(t,e,n){var i;if(t=await t,Tb(t))return t;if(Cb(t)){const o=await t.blob();e||(e=new URL(t.url).pathname.split(/[\\/]/).pop()??"unknown_file");const u=Pc(o)?[await o.arrayBuffer()]:[o];return new ap(u,e,n)}const s=await eP(t);if(e||(e=nP(t)??"unknown_file"),!(n!=null&&n.type)){const o=(i=s[0])==null?void 0:i.type;typeof o=="string"&&(n={...n,type:o})}return new ap(s,e,n)}async function eP(t){var n;let e=[];if(typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)e.push(t);else if(Pc(t))e.push(await t.arrayBuffer());else if(sP(t))for await(const s of t)e.push(s);else throw new Error(`Unexpected data type: ${typeof t}; constructor: ${(n=t==null?void 0:t.constructor)==null?void 0:n.name}; props: ${tP(t)}`);return e}function tP(t){return`[${Object.getOwnPropertyNames(t).map(n=>`"${n}"`).join(", ")}]`}function nP(t){var e;return vm(t.name)||vm(t.filename)||((e=vm(t.path))==null?void 0:e.split(/[\\/]/).pop())}const vm=t=>{if(typeof t=="string")return t;if(typeof Buffer<"u"&&t instanceof Buffer)return String(t)},sP=t=>t!=null&&typeof t=="object"&&typeof t[Symbol.asyncIterator]=="function",RS=t=>t&&typeof t=="object"&&t.body&&t[Symbol.toStringTag]==="MultipartBody",vr=async t=>{const e=await aP(t.body);return lb(e,t)},aP=async t=>{const e=new ib;return await Promise.all(Object.entries(t||{}).map(([n,s])=>rp(e,n,s))),e},rp=async(t,e,n)=>{if(n!==void 0){if(n==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")t.append(e,String(n));else if(Q2(n)){const s=await Ab(n);t.append(e,s)}else if(Array.isArray(n))await Promise.all(n.map(s=>rp(t,e+"[]",s)));else if(typeof n=="object")await Promise.all(Object.entries(n).map(([s,i])=>rp(t,`${e}[${s}]`,i)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`)}};var bi={},rP=function(t,e,n,s,i){if(typeof e=="function"?t!==e||!0:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,n),n},iP=function(t,e,n,s){if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)},Ou;fb();async function Eb(t){var u;const{response:e}=t;if(t.options.stream)return La("response",e.status,e.url,e.headers,e.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(e,t.controller):hs.fromSSEResponse(e,t.controller);if(e.status===204)return null;if(t.options.__binaryResponse)return e;const n=e.headers.get("content-type"),s=(u=n==null?void 0:n.split(";")[0])==null?void 0:u.trim();if((s==null?void 0:s.includes("application/json"))||(s==null?void 0:s.endsWith("+json"))){const d=await e.json();return La("response",e.status,e.url,e.headers,d),Rb(d,e)}const o=await e.text();return La("response",e.status,e.url,e.headers,o),o}function Rb(t,e){return!t||typeof t!="object"||Array.isArray(t)?t:Object.defineProperty(t,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}class kc extends Promise{constructor(e,n=Eb){super(s=>{s(null)}),this.responsePromise=e,this.parseResponse=n}_thenUnwrap(e){return new kc(this.responsePromise,async n=>Rb(e(await this.parseResponse(n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,n]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:n,request_id:n.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,n){return this.parse().then(e,n)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class oP{constructor({baseURL:e,maxRetries:n=2,timeout:s=6e5,httpAgent:i,fetch:o}){this.baseURL=e,this.maxRetries=xm("maxRetries",n),this.timeout=xm("timeout",s),this.httpAgent=i,this.fetch=o??rb}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...fP(),...this.authHeaders(e)}}validateHeaders(e,n){}defaultIdempotencyKey(){return`stainless-node-retry-${gP()}`}get(e,n){return this.methodRequest("get",e,n)}post(e,n){return this.methodRequest("post",e,n)}patch(e,n){return this.methodRequest("patch",e,n)}put(e,n){return this.methodRequest("put",e,n)}delete(e,n){return this.methodRequest("delete",e,n)}methodRequest(e,n,s){return this.request(Promise.resolve(s).then(async i=>{const o=i&&Pc(i==null?void 0:i.body)?new DataView(await i.body.arrayBuffer()):(i==null?void 0:i.body)instanceof DataView?i.body:(i==null?void 0:i.body)instanceof ArrayBuffer?new DataView(i.body):i&&ArrayBuffer.isView(i==null?void 0:i.body)?new DataView(i.body.buffer):i==null?void 0:i.body;return{method:e,path:n,...i,body:o}}))}getAPIList(e,n,s){return this.requestAPIList(n,{method:"get",path:e,...s})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:n=0}={}){var I;const s={...e},{method:i,path:o,query:u,headers:d={}}=s,p=ArrayBuffer.isView(s.body)||s.__binaryRequest&&typeof s.body=="string"?s.body:RS(s.body)?s.body.body:s.body?JSON.stringify(s.body,null,2):null,m=this.calculateContentLength(p),v=this.buildURL(o,u);"timeout"in s&&xm("timeout",s.timeout),s.timeout=s.timeout??this.timeout;const S=s.httpAgent??this.httpAgent??ub(v),w=s.timeout+1e3;typeof((I=S==null?void 0:S.options)==null?void 0:I.timeout)=="number"&&w>(S.options.timeout??0)&&(S.options.timeout=w),this.idempotencyHeader&&i!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),d[this.idempotencyHeader]=e.idempotencyKey);const C=this.buildHeaders({options:s,headers:d,contentLength:m,retryCount:n});return{req:{method:i,...p&&{body:p},headers:C,...S&&{agent:S},signal:s.signal??null},url:v,timeout:s.timeout}}buildHeaders({options:e,headers:n,contentLength:s,retryCount:i}){const o={};s&&(o["content-length"]=s);const u=this.defaultHeaders(e);return DS(o,u),DS(o,n),RS(e.body)&&Jo!=="node"&&delete o["content-type"],Vu(u,"x-stainless-retry-count")===void 0&&Vu(n,"x-stainless-retry-count")===void 0&&(o["x-stainless-retry-count"]=String(i)),Vu(u,"x-stainless-timeout")===void 0&&Vu(n,"x-stainless-timeout")===void 0&&e.timeout&&(o["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(o,n),o}async prepareOptions(e){}async prepareRequest(e,{url:n,options:s}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(n=>[...n])):{...e}:{}}makeStatusError(e,n,s,i){return Qt.generate(e,n,s,i)}request(e,n=null){return new kc(this.makeRequest(e,n))}async makeRequest(e,n){var S,w;const s=await e,i=s.maxRetries??this.maxRetries;n==null&&(n=i),await this.prepareOptions(s);const{req:o,url:u,timeout:d}=this.buildRequest(s,{retryCount:i-n});if(await this.prepareRequest(o,{url:u,options:s}),La("request",u,s,o.headers),(S=s.signal)!=null&&S.aborted)throw new zn;const p=new AbortController,m=await this.fetchWithTimeout(u,o,d,p).catch(ip);if(m instanceof Error){if((w=s.signal)!=null&&w.aborted)throw new zn;if(n)return this.retryRequest(s,n);throw m.name==="AbortError"?new jp:new Ic({cause:m})}const v=Mb(m.headers);if(!m.ok){if(n&&this.shouldRetry(m)){const V=`retrying, ${n} attempts remaining`;return La(`response (error; ${V})`,m.status,u,v),this.retryRequest(s,n,v)}const C=await m.text().catch(V=>ip(V).message),M=mP(C),I=M?void 0:C;throw La(`response (error; ${n?"(error; no more retries left)":"(error; not retryable)"})`,m.status,u,v,I),this.makeStatusError(m.status,M,I,v)}return{response:m,options:s,controller:p}}requestAPIList(e,n){const s=this.makeRequest(n,null);return new lP(this,s,e)}buildURL(e,n){const s=hP(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return Ib(i)||(n={...i,...n}),typeof n=="object"&&n&&!Array.isArray(n)&&(s.search=this.stringifyQuery(n)),s.toString()}stringifyQuery(e){return Object.entries(e).filter(([n,s])=>typeof s<"u").map(([n,s])=>{if(typeof s=="string"||typeof s=="number"||typeof s=="boolean")return`${encodeURIComponent(n)}=${encodeURIComponent(s)}`;if(s===null)return`${encodeURIComponent(n)}=`;throw new Re(`Cannot stringify type ${typeof s}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,n,s,i){const{signal:o,...u}=n||{};o&&o.addEventListener("abort",()=>i.abort());const d=setTimeout(()=>i.abort(),s),p={signal:i.signal,...u};return p.method&&(p.method=p.method.toUpperCase()),this.fetch.call(void 0,e,p).finally(()=>{clearTimeout(d)})}shouldRetry(e){const n=e.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,n,s){let i;const o=s==null?void 0:s["retry-after-ms"];if(o){const d=parseFloat(o);Number.isNaN(d)||(i=d)}const u=s==null?void 0:s["retry-after"];if(u&&!i){const d=parseFloat(u);Number.isNaN(d)?i=Date.parse(u)-Date.now():i=d*1e3}if(!(i&&0<=i&&i<60*1e3)){const d=e.maxRetries??this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(n,d)}return await ol(i),this.makeRequest(e,n-1)}calculateDefaultRetryTimeoutMillis(e,n){const o=n-e,u=Math.min(.5*Math.pow(2,o),8),d=1-Math.random()*.25;return u*d*1e3}getUserAgent(){return`${this.constructor.name}/JS ${di}`}}class Nb{constructor(e,n,s,i){Ou.set(this,void 0),rP(this,Ou,e),this.options=i,this.response=n,this.body=s}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new Re("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const n={...this.options};if("params"in e&&typeof n.query=="object")n.query={...n.query,...e.params};else if("url"in e){const s=[...Object.entries(n.query||{}),...e.url.searchParams.entries()];for(const[i,o]of s)e.url.searchParams.set(i,o);n.query=void 0,n.path=e.url.toString()}return await iP(this,Ou,"f").requestAPIList(this.constructor,n)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Ou=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const n of e.getPaginatedItems())yield n}}class lP extends kc{constructor(e,n,s){super(n,async i=>new s(e,i.response,await Eb(i),i.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const n of e)yield n}}const Mb=t=>new Proxy(Object.fromEntries(t.entries()),{get(e,n){const s=n.toString();return e[s.toLowerCase()]||e[s]}}),uP={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},St=t=>typeof t=="object"&&t!==null&&!Ib(t)&&Object.keys(t).every(e=>Db(uP,e)),cP=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":di,"X-Stainless-OS":MS(Deno.build.os),"X-Stainless-Arch":NS(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":di,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":di,"X-Stainless-OS":MS(process.platform),"X-Stainless-Arch":NS(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const t=dP();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":di,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":di,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function dP(){if(typeof navigator>"u"||!navigator)return null;const t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:n}of t){const s=n.exec(navigator.userAgent);if(s){const i=s[1]||0,o=s[2]||0,u=s[3]||0;return{browser:e,version:`${i}.${o}.${u}`}}}return null}const NS=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",MS=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown");let IS;const fP=()=>IS??(IS=cP()),mP=t=>{try{return JSON.parse(t)}catch{return}},pP=/^[a-z][a-z0-9+.-]*:/i,hP=t=>pP.test(t),ol=t=>new Promise(e=>setTimeout(e,t)),xm=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new Re(`${t} must be an integer`);if(e<0)throw new Re(`${t} must be a positive integer`);return e},ip=t=>{if(t instanceof Error)return t;if(typeof t=="object"&&t!==null)try{return new Error(JSON.stringify(t))}catch{}return new Error(t)},Bu=t=>{var e,n,s,i;if(typeof process<"u")return((e=bi==null?void 0:bi[t])==null?void 0:e.trim())??void 0;if(typeof Deno<"u")return(i=(s=(n=Deno.env)==null?void 0:n.get)==null?void 0:s.call(n,t))==null?void 0:i.trim()};function Ib(t){if(!t)return!0;for(const e in t)return!1;return!0}function Db(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function DS(t,e){for(const n in e){if(!Db(e,n))continue;const s=n.toLowerCase();if(!s)continue;const i=e[n];i===null?delete t[s]:i!==void 0&&(t[s]=i)}}const PS=new Set(["authorization","api-key"]);function La(t,...e){if(typeof process<"u"&&(bi==null?void 0:bi.DEBUG)==="true"){const n=e.map(s=>{if(!s)return s;if(s.headers){const o={...s,headers:{...s.headers}};for(const u in s.headers)PS.has(u.toLowerCase())&&(o.headers[u]="REDACTED");return o}let i=null;for(const o in s)PS.has(o.toLowerCase())&&(i??(i={...s}),i[o]="REDACTED");return i??s});console.log(`OpenAI:DEBUG:${t}`,...n)}}const gP=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),yP=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",vP=t=>typeof(t==null?void 0:t.get)=="function",Vu=(t,e)=>{var s;const n=e.toLowerCase();if(vP(t)){const i=((s=e[0])==null?void 0:s.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(o,u,d)=>u+d.toUpperCase());for(const o of[e,n,e.toUpperCase(),i]){const u=t.get(o);if(u)return u}}for(const[i,o]of Object.entries(t))if(i.toLowerCase()===n)return Array.isArray(o)?(o.length<=1||console.warn(`Received ${o.length} entries for the ${e} header, using the first entry.`),o[0]):o},xP=t=>{if(typeof Buffer<"u"){const e=Buffer.from(t,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{const e=atob(t),n=e.length,s=new Uint8Array(n);for(let i=0;i<n;i++)s[i]=e.charCodeAt(i);return Array.from(new Float32Array(s.buffer))}};function Sm(t){return t!=null&&typeof t=="object"&&!Array.isArray(t)}class Lc extends Nb{constructor(e,n,s,i){super(e,n,s,i),this.data=s.data||[],this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class Gt extends Nb{constructor(e,n,s,i){super(e,n,s,i),this.data=s.data||[],this.has_more=s.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const n=Object.fromEntries(e.url.searchParams);return Object.keys(n).length?n:null}nextPageInfo(){var s;const e=this.getPaginatedItems();if(!e.length)return null;const n=(s=e[e.length-1])==null?void 0:s.id;return n?{params:{after:n}}:null}}class Ne{constructor(e){this._client=e}}let Pb=class extends Ne{list(e,n={},s){return St(n)?this.list(e,{},n):this._client.getAPIList(`/chat/completions/${e}/messages`,SP,{query:n,...s})}},Uc=class extends Ne{constructor(){super(...arguments),this.messages=new Pb(this._client)}create(e,n){return this._client.post("/chat/completions",{body:e,...n,stream:e.stream??!1})}retrieve(e,n){return this._client.get(`/chat/completions/${e}`,n)}update(e,n,s){return this._client.post(`/chat/completions/${e}`,{body:n,...s})}list(e={},n){return St(e)?this.list({},e):this._client.getAPIList("/chat/completions",Oc,{query:e,...n})}del(e,n){return this._client.delete(`/chat/completions/${e}`,n)}};class Oc extends Gt{}class SP extends Gt{}Uc.ChatCompletionsPage=Oc;Uc.Messages=Pb;let Bc=class extends Ne{constructor(){super(...arguments),this.completions=new Uc(this._client)}};Bc.Completions=Uc;Bc.ChatCompletionsPage=Oc;class kb extends Ne{create(e,n){return this._client.post("/audio/speech",{body:e,...n,headers:{Accept:"application/octet-stream",...n==null?void 0:n.headers},__binaryResponse:!0})}}class Lb extends Ne{create(e,n){return this._client.post("/audio/transcriptions",vr({body:e,...n,stream:e.stream??!1,__metadata:{model:e.model}}))}}class Ub extends Ne{create(e,n){return this._client.post("/audio/translations",vr({body:e,...n,__metadata:{model:e.model}}))}}class ll extends Ne{constructor(){super(...arguments),this.transcriptions=new Lb(this._client),this.translations=new Ub(this._client),this.speech=new kb(this._client)}}ll.Transcriptions=Lb;ll.Translations=Ub;ll.Speech=kb;class Jp extends Ne{create(e,n){return this._client.post("/batches",{body:e,...n})}retrieve(e,n){return this._client.get(`/batches/${e}`,n)}list(e={},n){return St(e)?this.list({},e):this._client.getAPIList("/batches",Yp,{query:e,...n})}cancel(e,n){return this._client.post(`/batches/${e}/cancel`,n)}}class Yp extends Gt{}Jp.BatchesPage=Yp;var ts=function(t,e,n,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(t,n):i?i.value=n:e.set(t,n),n},xt=function(t,e,n,s){if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)},op,Qu,ec,Bo,Vo,tc,qo,Fs,Fo,pc,hc,fi,Ob;class Kp{constructor(){op.add(this),this.controller=new AbortController,Qu.set(this,void 0),ec.set(this,()=>{}),Bo.set(this,()=>{}),Vo.set(this,void 0),tc.set(this,()=>{}),qo.set(this,()=>{}),Fs.set(this,{}),Fo.set(this,!1),pc.set(this,!1),hc.set(this,!1),fi.set(this,!1),ts(this,Qu,new Promise((e,n)=>{ts(this,ec,e,"f"),ts(this,Bo,n,"f")}),"f"),ts(this,Vo,new Promise((e,n)=>{ts(this,tc,e,"f"),ts(this,qo,n,"f")}),"f"),xt(this,Qu,"f").catch(()=>{}),xt(this,Vo,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},xt(this,op,"m",Ob).bind(this))},0)}_connected(){this.ended||(xt(this,ec,"f").call(this),this._emit("connect"))}get ended(){return xt(this,Fo,"f")}get errored(){return xt(this,pc,"f")}get aborted(){return xt(this,hc,"f")}abort(){this.controller.abort()}on(e,n){return(xt(this,Fs,"f")[e]||(xt(this,Fs,"f")[e]=[])).push({listener:n}),this}off(e,n){const s=xt(this,Fs,"f")[e];if(!s)return this;const i=s.findIndex(o=>o.listener===n);return i>=0&&s.splice(i,1),this}once(e,n){return(xt(this,Fs,"f")[e]||(xt(this,Fs,"f")[e]=[])).push({listener:n,once:!0}),this}emitted(e){return new Promise((n,s)=>{ts(this,fi,!0,"f"),e!=="error"&&this.once("error",s),this.once(e,n)})}async done(){ts(this,fi,!0,"f"),await xt(this,Vo,"f")}_emit(e,...n){if(xt(this,Fo,"f"))return;e==="end"&&(ts(this,Fo,!0,"f"),xt(this,tc,"f").call(this));const s=xt(this,Fs,"f")[e];if(s&&(xt(this,Fs,"f")[e]=s.filter(i=>!i.once),s.forEach(({listener:i})=>i(...n))),e==="abort"){const i=n[0];!xt(this,fi,"f")&&!(s!=null&&s.length)&&Promise.reject(i),xt(this,Bo,"f").call(this,i),xt(this,qo,"f").call(this,i),this._emit("end");return}if(e==="error"){const i=n[0];!xt(this,fi,"f")&&!(s!=null&&s.length)&&Promise.reject(i),xt(this,Bo,"f").call(this,i),xt(this,qo,"f").call(this,i),this._emit("end")}}_emitFinal(){}}Qu=new WeakMap,ec=new WeakMap,Bo=new WeakMap,Vo=new WeakMap,tc=new WeakMap,qo=new WeakMap,Fs=new WeakMap,Fo=new WeakMap,pc=new WeakMap,hc=new WeakMap,fi=new WeakMap,op=new WeakSet,Ob=function(e){if(ts(this,pc,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new zn),e instanceof zn)return ts(this,hc,!0,"f"),this._emit("abort",e);if(e instanceof Re)return this._emit("error",e);if(e instanceof Error){const n=new Re(e.message);return n.cause=e,this._emit("error",n)}return this._emit("error",new Re(String(e)))};var Ce=function(t,e,n,s){if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)},An=function(t,e,n,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(t,n):i?i.value=n:e.set(t,n),n},Wt,lp,fs,nc,ns,pr,gi,mr,gc,Rn,sc,ac,Yo,$o,Go,kS,LS,US,OS,BS,VS,qS;class ss extends Kp{constructor(){super(...arguments),Wt.add(this),lp.set(this,[]),fs.set(this,{}),nc.set(this,{}),ns.set(this,void 0),pr.set(this,void 0),gi.set(this,void 0),mr.set(this,void 0),gc.set(this,void 0),Rn.set(this,void 0),sc.set(this,void 0),ac.set(this,void 0),Yo.set(this,void 0)}[(lp=new WeakMap,fs=new WeakMap,nc=new WeakMap,ns=new WeakMap,pr=new WeakMap,gi=new WeakMap,mr=new WeakMap,gc=new WeakMap,Rn=new WeakMap,sc=new WeakMap,ac=new WeakMap,Yo=new WeakMap,Wt=new WeakSet,Symbol.asyncIterator)](){const e=[],n=[];let s=!1;return this.on("event",i=>{const o=n.shift();o?o.resolve(i):e.push(i)}),this.on("end",()=>{s=!0;for(const i of n)i.resolve(void 0);n.length=0}),this.on("abort",i=>{s=!0;for(const o of n)o.reject(i);n.length=0}),this.on("error",i=>{s=!0;for(const o of n)o.reject(i);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((o,u)=>n.push({resolve:o,reject:u})).then(o=>o?{value:o,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const n=new ss;return n._run(()=>n._fromReadableStream(e)),n}async _fromReadableStream(e,n){var o;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),this._connected();const i=hs.fromReadableStream(e,this.controller);for await(const u of i)Ce(this,Wt,"m",$o).call(this,u);if((o=i.controller.signal)!=null&&o.aborted)throw new zn;return this._addRun(Ce(this,Wt,"m",Go).call(this))}toReadableStream(){return new hs(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,n,s,i,o){const u=new ss;return u._run(()=>u._runToolAssistantStream(e,n,s,i,{...o,headers:{...o==null?void 0:o.headers,"X-Stainless-Helper-Method":"stream"}})),u}async _createToolAssistantStream(e,n,s,i,o){var m;const u=o==null?void 0:o.signal;u&&(u.aborted&&this.controller.abort(),u.addEventListener("abort",()=>this.controller.abort()));const d={...i,stream:!0},p=await e.submitToolOutputs(n,s,d,{...o,signal:this.controller.signal});this._connected();for await(const v of p)Ce(this,Wt,"m",$o).call(this,v);if((m=p.controller.signal)!=null&&m.aborted)throw new zn;return this._addRun(Ce(this,Wt,"m",Go).call(this))}static createThreadAssistantStream(e,n,s){const i=new ss;return i._run(()=>i._threadAssistantStream(e,n,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}static createAssistantStream(e,n,s,i){const o=new ss;return o._run(()=>o._runAssistantStream(e,n,s,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),o}currentEvent(){return Ce(this,sc,"f")}currentRun(){return Ce(this,ac,"f")}currentMessageSnapshot(){return Ce(this,ns,"f")}currentRunStepSnapshot(){return Ce(this,Yo,"f")}async finalRunSteps(){return await this.done(),Object.values(Ce(this,fs,"f"))}async finalMessages(){return await this.done(),Object.values(Ce(this,nc,"f"))}async finalRun(){if(await this.done(),!Ce(this,pr,"f"))throw Error("Final run was not received.");return Ce(this,pr,"f")}async _createThreadAssistantStream(e,n,s){var d;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const o={...n,stream:!0},u=await e.createAndRun(o,{...s,signal:this.controller.signal});this._connected();for await(const p of u)Ce(this,Wt,"m",$o).call(this,p);if((d=u.controller.signal)!=null&&d.aborted)throw new zn;return this._addRun(Ce(this,Wt,"m",Go).call(this))}async _createAssistantStream(e,n,s,i){var p;const o=i==null?void 0:i.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));const u={...s,stream:!0},d=await e.create(n,u,{...i,signal:this.controller.signal});this._connected();for await(const m of d)Ce(this,Wt,"m",$o).call(this,m);if((p=d.controller.signal)!=null&&p.aborted)throw new zn;return this._addRun(Ce(this,Wt,"m",Go).call(this))}static accumulateDelta(e,n){for(const[s,i]of Object.entries(n)){if(!e.hasOwnProperty(s)){e[s]=i;continue}let o=e[s];if(o==null){e[s]=i;continue}if(s==="index"||s==="type"){e[s]=i;continue}if(typeof o=="string"&&typeof i=="string")o+=i;else if(typeof o=="number"&&typeof i=="number")o+=i;else if(Sm(o)&&Sm(i))o=this.accumulateDelta(o,i);else if(Array.isArray(o)&&Array.isArray(i)){if(o.every(u=>typeof u=="string"||typeof u=="number")){o.push(...i);continue}for(const u of i){if(!Sm(u))throw new Error(`Expected array delta entry to be an object but got: ${u}`);const d=u.index;if(d==null)throw console.error(u),new Error("Expected array delta entry to have an `index` property");if(typeof d!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${d}`);const p=o[d];p==null?o.push(u):o[d]=this.accumulateDelta(p,u)}continue}else throw Error(`Unhandled record type: ${s}, deltaValue: ${i}, accValue: ${o}`);e[s]=o}return e}_addRun(e){return e}async _threadAssistantStream(e,n,s){return await this._createThreadAssistantStream(n,e,s)}async _runAssistantStream(e,n,s,i){return await this._createAssistantStream(n,e,s,i)}async _runToolAssistantStream(e,n,s,i,o){return await this._createToolAssistantStream(s,e,n,i,o)}}$o=function(e){if(!this.ended)switch(An(this,sc,e,"f"),Ce(this,Wt,"m",US).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":Ce(this,Wt,"m",qS).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Ce(this,Wt,"m",LS).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":Ce(this,Wt,"m",kS).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Go=function(){if(this.ended)throw new Re("stream has ended, this shouldn't happen");if(!Ce(this,pr,"f"))throw Error("Final run has not been received");return Ce(this,pr,"f")},kS=function(e){const[n,s]=Ce(this,Wt,"m",BS).call(this,e,Ce(this,ns,"f"));An(this,ns,n,"f"),Ce(this,nc,"f")[n.id]=n;for(const i of s){const o=n.content[i.index];(o==null?void 0:o.type)=="text"&&this._emit("textCreated",o.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,n),e.data.delta.content)for(const i of e.data.delta.content){if(i.type=="text"&&i.text){let o=i.text,u=n.content[i.index];if(u&&u.type=="text")this._emit("textDelta",o,u.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(i.index!=Ce(this,gi,"f")){if(Ce(this,mr,"f"))switch(Ce(this,mr,"f").type){case"text":this._emit("textDone",Ce(this,mr,"f").text,Ce(this,ns,"f"));break;case"image_file":this._emit("imageFileDone",Ce(this,mr,"f").image_file,Ce(this,ns,"f"));break}An(this,gi,i.index,"f")}An(this,mr,n.content[i.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(Ce(this,gi,"f")!==void 0){const i=e.data.content[Ce(this,gi,"f")];if(i)switch(i.type){case"image_file":this._emit("imageFileDone",i.image_file,Ce(this,ns,"f"));break;case"text":this._emit("textDone",i.text,Ce(this,ns,"f"));break}}Ce(this,ns,"f")&&this._emit("messageDone",e.data),An(this,ns,void 0,"f")}},LS=function(e){const n=Ce(this,Wt,"m",OS).call(this,e);switch(An(this,Yo,n,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const s=e.data.delta;if(s.step_details&&s.step_details.type=="tool_calls"&&s.step_details.tool_calls&&n.step_details.type=="tool_calls")for(const o of s.step_details.tool_calls)o.index==Ce(this,gc,"f")?this._emit("toolCallDelta",o,n.step_details.tool_calls[o.index]):(Ce(this,Rn,"f")&&this._emit("toolCallDone",Ce(this,Rn,"f")),An(this,gc,o.index,"f"),An(this,Rn,n.step_details.tool_calls[o.index],"f"),Ce(this,Rn,"f")&&this._emit("toolCallCreated",Ce(this,Rn,"f")));this._emit("runStepDelta",e.data.delta,n);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":An(this,Yo,void 0,"f"),e.data.step_details.type=="tool_calls"&&Ce(this,Rn,"f")&&(this._emit("toolCallDone",Ce(this,Rn,"f")),An(this,Rn,void 0,"f")),this._emit("runStepDone",e.data,n);break}},US=function(e){Ce(this,lp,"f").push(e),this._emit("event",e)},OS=function(e){switch(e.event){case"thread.run.step.created":return Ce(this,fs,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let n=Ce(this,fs,"f")[e.data.id];if(!n)throw Error("Received a RunStepDelta before creation of a snapshot");let s=e.data;if(s.delta){const i=ss.accumulateDelta(n,s.delta);Ce(this,fs,"f")[e.data.id]=i}return Ce(this,fs,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":Ce(this,fs,"f")[e.data.id]=e.data;break}if(Ce(this,fs,"f")[e.data.id])return Ce(this,fs,"f")[e.data.id];throw new Error("No snapshot available")},BS=function(e,n){let s=[];switch(e.event){case"thread.message.created":return[e.data,s];case"thread.message.delta":if(!n)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let i=e.data;if(i.delta.content)for(const o of i.delta.content)if(o.index in n.content){let u=n.content[o.index];n.content[o.index]=Ce(this,Wt,"m",VS).call(this,o,u)}else n.content[o.index]=o,s.push(o);return[n,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(n)return[n,s];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},VS=function(e,n){return ss.accumulateDelta(n,e)},qS=function(e){switch(An(this,ac,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":An(this,pr,e.data,"f"),Ce(this,Rn,"f")&&(this._emit("toolCallDone",Ce(this,Rn,"f")),An(this,Rn,void 0,"f"));break}};class Zp extends Ne{create(e,n){return this._client.post("/assistants",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,n){return this._client.get(`/assistants/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,n,s){return this._client.post(`/assistants/${e}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e={},n){return St(e)?this.list({},e):this._client.getAPIList("/assistants",Xp,{query:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,n){return this._client.delete(`/assistants/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Xp extends Gt{}Zp.AssistantsPage=Xp;function FS(t){return typeof t.parse=="function"}const Ci=t=>(t==null?void 0:t.role)==="assistant",Bb=t=>(t==null?void 0:t.role)==="function",Vb=t=>(t==null?void 0:t.role)==="tool";function Wp(t){return(t==null?void 0:t.$brand)==="auto-parseable-response-format"}function ul(t){return(t==null?void 0:t.$brand)==="auto-parseable-tool"}function wP(t,e){return!e||!qb(e)?{...t,choices:t.choices.map(n=>({...n,message:{...n.message,parsed:null,...n.message.tool_calls?{tool_calls:n.message.tool_calls}:void 0}}))}:Qp(t,e)}function Qp(t,e){const n=t.choices.map(s=>{var i;if(s.finish_reason==="length")throw new wb;if(s.finish_reason==="content_filter")throw new _b;return{...s,message:{...s.message,...s.message.tool_calls?{tool_calls:((i=s.message.tool_calls)==null?void 0:i.map(o=>bP(e,o)))??void 0}:void 0,parsed:s.message.content&&!s.message.refusal?_P(e,s.message.content):null}}});return{...t,choices:n}}function _P(t,e){var n,s;return((n=t.response_format)==null?void 0:n.type)!=="json_schema"?null:((s=t.response_format)==null?void 0:s.type)==="json_schema"?"$parseRaw"in t.response_format?t.response_format.$parseRaw(e):JSON.parse(e):null}function bP(t,e){var s;const n=(s=t.tools)==null?void 0:s.find(i=>{var o;return((o=i.function)==null?void 0:o.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:ul(n)?n.$parseRaw(e.function.arguments):n!=null&&n.function.strict?JSON.parse(e.function.arguments):null}}}function CP(t,e){var s;if(!t)return!1;const n=(s=t.tools)==null?void 0:s.find(i=>{var o;return((o=i.function)==null?void 0:o.name)===e.function.name});return ul(n)||(n==null?void 0:n.function.strict)||!1}function qb(t){var e;return Wp(t.response_format)?!0:((e=t.tools)==null?void 0:e.some(n=>ul(n)||n.type==="function"&&n.function.strict===!0))??!1}function TP(t){for(const e of t??[]){if(e.type!=="function")throw new Re(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new Re(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var gn=function(t,e,n,s){if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)},sn,up,yc,cp,dp,fp,Fb,mp;const $S=10;class $b extends Kp{constructor(){super(...arguments),sn.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var s;this._chatCompletions.push(e),this._emit("chatCompletion",e);const n=(s=e.choices[0])==null?void 0:s.message;return n&&this._addMessage(n),e}_addMessage(e,n=!0){if("content"in e||(e.content=null),this.messages.push(e),n){if(this._emit("message",e),(Bb(e)||Vb(e))&&e.content)this._emit("functionCallResult",e.content);else if(Ci(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(Ci(e)&&e.tool_calls)for(const s of e.tool_calls)s.type==="function"&&this._emit("functionCall",s.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new Re("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),gn(this,sn,"m",up).call(this)}async finalMessage(){return await this.done(),gn(this,sn,"m",yc).call(this)}async finalFunctionCall(){return await this.done(),gn(this,sn,"m",cp).call(this)}async finalFunctionCallResult(){return await this.done(),gn(this,sn,"m",dp).call(this)}async totalUsage(){return await this.done(),gn(this,sn,"m",fp).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const n=gn(this,sn,"m",yc).call(this);n&&this._emit("finalMessage",n);const s=gn(this,sn,"m",up).call(this);s&&this._emit("finalContent",s);const i=gn(this,sn,"m",cp).call(this);i&&this._emit("finalFunctionCall",i);const o=gn(this,sn,"m",dp).call(this);o!=null&&this._emit("finalFunctionCallResult",o),this._chatCompletions.some(u=>u.usage)&&this._emit("totalUsage",gn(this,sn,"m",fp).call(this))}async _createChatCompletion(e,n,s){const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),gn(this,sn,"m",Fb).call(this,n);const o=await e.chat.completions.create({...n,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Qp(o,n))}async _runChatCompletion(e,n,s){for(const i of n.messages)this._addMessage(i,!1);return await this._createChatCompletion(e,n,s)}async _runFunctions(e,n,s){var w;const i="function",{function_call:o="auto",stream:u,...d}=n,p=typeof o!="string"&&(o==null?void 0:o.name),{maxChatCompletions:m=$S}=s||{},v={};for(const C of n.functions)v[C.name||C.function.name]=C;const S=n.functions.map(C=>({name:C.name||C.function.name,parameters:C.parameters,description:C.description}));for(const C of n.messages)this._addMessage(C,!1);for(let C=0;C<m;++C){const I=(w=(await this._createChatCompletion(e,{...d,function_call:o,functions:S,messages:[...this.messages]},s)).choices[0])==null?void 0:w.message;if(!I)throw new Re("missing message in ChatCompletion response");if(!I.function_call)return;const{name:k,arguments:F}=I.function_call,V=v[k];if(V){if(p&&p!==k){const Q=`Invalid function_call: ${JSON.stringify(k)}. ${JSON.stringify(p)} requested. Please try again`;this._addMessage({role:i,name:k,content:Q});continue}}else{const Q=`Invalid function_call: ${JSON.stringify(k)}. Available options are: ${S.map(J=>JSON.stringify(J.name)).join(", ")}. Please try again`;this._addMessage({role:i,name:k,content:Q});continue}let G;try{G=FS(V)?await V.parse(F):F}catch(Q){this._addMessage({role:i,name:k,content:Q instanceof Error?Q.message:String(Q)});continue}const z=await V.function(G,this),ae=gn(this,sn,"m",mp).call(this,z);if(this._addMessage({role:i,name:k,content:ae}),p)return}}async _runTools(e,n,s){var C,M,I;const i="tool",{tool_choice:o="auto",stream:u,...d}=n,p=typeof o!="string"&&((C=o==null?void 0:o.function)==null?void 0:C.name),{maxChatCompletions:m=$S}=s||{},v=n.tools.map(k=>{if(ul(k)){if(!k.$callback)throw new Re("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:k.$callback,name:k.function.name,description:k.function.description||"",parameters:k.function.parameters,parse:k.$parseRaw,strict:!0}}}return k}),S={};for(const k of v)k.type==="function"&&(S[k.function.name||k.function.function.name]=k.function);const w="tools"in n?v.map(k=>k.type==="function"?{type:"function",function:{name:k.function.name||k.function.function.name,parameters:k.function.parameters,description:k.function.description,strict:k.function.strict}}:k):void 0;for(const k of n.messages)this._addMessage(k,!1);for(let k=0;k<m;++k){const V=(M=(await this._createChatCompletion(e,{...d,tool_choice:o,tools:w,messages:[...this.messages]},s)).choices[0])==null?void 0:M.message;if(!V)throw new Re("missing message in ChatCompletion response");if(!((I=V.tool_calls)!=null&&I.length))return;for(const G of V.tool_calls){if(G.type!=="function")continue;const z=G.id,{name:ae,arguments:Q}=G.function,J=S[ae];if(J){if(p&&p!==ae){const le=`Invalid tool_call: ${JSON.stringify(ae)}. ${JSON.stringify(p)} requested. Please try again`;this._addMessage({role:i,tool_call_id:z,content:le});continue}}else{const le=`Invalid tool_call: ${JSON.stringify(ae)}. Available options are: ${Object.keys(S).map(_=>JSON.stringify(_)).join(", ")}. Please try again`;this._addMessage({role:i,tool_call_id:z,content:le});continue}let j;try{j=FS(J)?await J.parse(Q):Q}catch(le){const _=le instanceof Error?le.message:String(le);this._addMessage({role:i,tool_call_id:z,content:_});continue}const X=await J.function(j,this),ne=gn(this,sn,"m",mp).call(this,X);if(this._addMessage({role:i,tool_call_id:z,content:ne}),p)return}}}}sn=new WeakSet,up=function(){return gn(this,sn,"m",yc).call(this).content??null},yc=function(){let e=this.messages.length;for(;e-- >0;){const n=this.messages[e];if(Ci(n)){const{function_call:s,...i}=n,o={...i,content:n.content??null,refusal:n.refusal??null};return s&&(o.function_call=s),o}}throw new Re("stream ended without producing a ChatCompletionMessage with role=assistant")},cp=function(){var e,n;for(let s=this.messages.length-1;s>=0;s--){const i=this.messages[s];if(Ci(i)&&(i!=null&&i.function_call))return i.function_call;if(Ci(i)&&((e=i==null?void 0:i.tool_calls)!=null&&e.length))return(n=i.tool_calls.at(-1))==null?void 0:n.function}},dp=function(){for(let e=this.messages.length-1;e>=0;e--){const n=this.messages[e];if(Bb(n)&&n.content!=null||Vb(n)&&n.content!=null&&typeof n.content=="string"&&this.messages.some(s=>{var i;return s.role==="assistant"&&((i=s.tool_calls)==null?void 0:i.some(o=>o.type==="function"&&o.id===n.tool_call_id))}))return n.content}},fp=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:n}of this._chatCompletions)n&&(e.completion_tokens+=n.completion_tokens,e.prompt_tokens+=n.prompt_tokens,e.total_tokens+=n.total_tokens);return e},Fb=function(e){if(e.n!=null&&e.n>1)throw new Re("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},mp=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class Qo extends $b{static runFunctions(e,n,s){const i=new Qo,o={...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"runFunctions"}};return i._run(()=>i._runFunctions(e,n,o)),i}static runTools(e,n,s){const i=new Qo,o={...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,n,o)),i}_addMessage(e,n=!0){super._addMessage(e,n),Ci(e)&&e.content&&this._emit("content",e.content)}}const Gb=1,Hb=2,zb=4,jb=8,Jb=16,Yb=32,Kb=64,Zb=128,Xb=256,Wb=Zb|Xb,Qb=Jb|Yb|Wb|Kb,eC=Gb|Hb|Qb,tC=zb|jb,AP=eC|tC,jt={STR:Gb,NUM:Hb,ARR:zb,OBJ:jb,NULL:Jb,BOOL:Yb,NAN:Kb,INFINITY:Zb,MINUS_INFINITY:Xb,INF:Wb,SPECIAL:Qb,ATOM:eC,COLLECTION:tC,ALL:AP};class EP extends Error{}class RP extends Error{}function NP(t,e=jt.ALL){if(typeof t!="string")throw new TypeError(`expecting str, got ${typeof t}`);if(!t.trim())throw new Error(`${t} is empty`);return MP(t.trim(),e)}const MP=(t,e)=>{const n=t.length;let s=0;const i=w=>{throw new EP(`${w} at position ${s}`)},o=w=>{throw new RP(`${w} at position ${s}`)},u=()=>(S(),s>=n&&i("Unexpected end of input"),t[s]==='"'?d():t[s]==="{"?p():t[s]==="["?m():t.substring(s,s+4)==="null"||jt.NULL&e&&n-s<4&&"null".startsWith(t.substring(s))?(s+=4,null):t.substring(s,s+4)==="true"||jt.BOOL&e&&n-s<4&&"true".startsWith(t.substring(s))?(s+=4,!0):t.substring(s,s+5)==="false"||jt.BOOL&e&&n-s<5&&"false".startsWith(t.substring(s))?(s+=5,!1):t.substring(s,s+8)==="Infinity"||jt.INFINITY&e&&n-s<8&&"Infinity".startsWith(t.substring(s))?(s+=8,1/0):t.substring(s,s+9)==="-Infinity"||jt.MINUS_INFINITY&e&&1<n-s&&n-s<9&&"-Infinity".startsWith(t.substring(s))?(s+=9,-1/0):t.substring(s,s+3)==="NaN"||jt.NAN&e&&n-s<3&&"NaN".startsWith(t.substring(s))?(s+=3,NaN):v()),d=()=>{const w=s;let C=!1;for(s++;s<n&&(t[s]!=='"'||C&&t[s-1]==="\\");)C=t[s]==="\\"?!C:!1,s++;if(t.charAt(s)=='"')try{return JSON.parse(t.substring(w,++s-Number(C)))}catch(M){o(String(M))}else if(jt.STR&e)try{return JSON.parse(t.substring(w,s-Number(C))+'"')}catch{return JSON.parse(t.substring(w,t.lastIndexOf("\\"))+'"')}i("Unterminated string literal")},p=()=>{s++,S();const w={};try{for(;t[s]!=="}";){if(S(),s>=n&&jt.OBJ&e)return w;const C=d();S(),s++;try{const M=u();Object.defineProperty(w,C,{value:M,writable:!0,enumerable:!0,configurable:!0})}catch(M){if(jt.OBJ&e)return w;throw M}S(),t[s]===","&&s++}}catch{if(jt.OBJ&e)return w;i("Expected '}' at end of object")}return s++,w},m=()=>{s++;const w=[];try{for(;t[s]!=="]";)w.push(u()),S(),t[s]===","&&s++}catch{if(jt.ARR&e)return w;i("Expected ']' at end of array")}return s++,w},v=()=>{if(s===0){t==="-"&&jt.NUM&e&&i("Not sure what '-' is");try{return JSON.parse(t)}catch(C){if(jt.NUM&e)try{return t[t.length-1]==="."?JSON.parse(t.substring(0,t.lastIndexOf("."))):JSON.parse(t.substring(0,t.lastIndexOf("e")))}catch{}o(String(C))}}const w=s;for(t[s]==="-"&&s++;t[s]&&!",]}".includes(t[s]);)s++;s==n&&!(jt.NUM&e)&&i("Unterminated number literal");try{return JSON.parse(t.substring(w,s))}catch{t.substring(w,s)==="-"&&jt.NUM&e&&i("Not sure what '-' is");try{return JSON.parse(t.substring(w,t.lastIndexOf("e")))}catch(M){o(String(M))}}},S=()=>{for(;s<n&&` 
\r	`.includes(t[s]);)s++};return u()},GS=t=>NP(t,jt.ALL^jt.NUM);var ii=function(t,e,n,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(t,n):i?i.value=n:e.set(t,n),n},lt=function(t,e,n,s){if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)},Ft,Vs,oi,Ra,wm,qu,_m,bm,Cm,Fu,Tm,HS;class el extends $b{constructor(e){super(),Ft.add(this),Vs.set(this,void 0),oi.set(this,void 0),Ra.set(this,void 0),ii(this,Vs,e,"f"),ii(this,oi,[],"f")}get currentChatCompletionSnapshot(){return lt(this,Ra,"f")}static fromReadableStream(e){const n=new el(null);return n._run(()=>n._fromReadableStream(e)),n}static createChatCompletion(e,n,s){const i=new el(n);return i._run(()=>i._runChatCompletion(e,{...n,stream:!0},{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createChatCompletion(e,n,s){var u;super._createChatCompletion;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),lt(this,Ft,"m",wm).call(this);const o=await e.chat.completions.create({...n,stream:!0},{...s,signal:this.controller.signal});this._connected();for await(const d of o)lt(this,Ft,"m",_m).call(this,d);if((u=o.controller.signal)!=null&&u.aborted)throw new zn;return this._addChatCompletion(lt(this,Ft,"m",Fu).call(this))}async _fromReadableStream(e,n){var u;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),lt(this,Ft,"m",wm).call(this),this._connected();const i=hs.fromReadableStream(e,this.controller);let o;for await(const d of i)o&&o!==d.id&&this._addChatCompletion(lt(this,Ft,"m",Fu).call(this)),lt(this,Ft,"m",_m).call(this,d),o=d.id;if((u=i.controller.signal)!=null&&u.aborted)throw new zn;return this._addChatCompletion(lt(this,Ft,"m",Fu).call(this))}[(Vs=new WeakMap,oi=new WeakMap,Ra=new WeakMap,Ft=new WeakSet,wm=function(){this.ended||ii(this,Ra,void 0,"f")},qu=function(n){let s=lt(this,oi,"f")[n.index];return s||(s={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},lt(this,oi,"f")[n.index]=s,s)},_m=function(n){var i,o,u,d,p,m,v,S,w,C,M,I,k,F,V;if(this.ended)return;const s=lt(this,Ft,"m",HS).call(this,n);this._emit("chunk",n,s);for(const G of n.choices){const z=s.choices[G.index];G.delta.content!=null&&((i=z.message)==null?void 0:i.role)==="assistant"&&((o=z.message)!=null&&o.content)&&(this._emit("content",G.delta.content,z.message.content),this._emit("content.delta",{delta:G.delta.content,snapshot:z.message.content,parsed:z.message.parsed})),G.delta.refusal!=null&&((u=z.message)==null?void 0:u.role)==="assistant"&&((d=z.message)!=null&&d.refusal)&&this._emit("refusal.delta",{delta:G.delta.refusal,snapshot:z.message.refusal}),((p=G.logprobs)==null?void 0:p.content)!=null&&((m=z.message)==null?void 0:m.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(v=G.logprobs)==null?void 0:v.content,snapshot:((S=z.logprobs)==null?void 0:S.content)??[]}),((w=G.logprobs)==null?void 0:w.refusal)!=null&&((C=z.message)==null?void 0:C.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(M=G.logprobs)==null?void 0:M.refusal,snapshot:((I=z.logprobs)==null?void 0:I.refusal)??[]});const ae=lt(this,Ft,"m",qu).call(this,z);z.finish_reason&&(lt(this,Ft,"m",Cm).call(this,z),ae.current_tool_call_index!=null&&lt(this,Ft,"m",bm).call(this,z,ae.current_tool_call_index));for(const Q of G.delta.tool_calls??[])ae.current_tool_call_index!==Q.index&&(lt(this,Ft,"m",Cm).call(this,z),ae.current_tool_call_index!=null&&lt(this,Ft,"m",bm).call(this,z,ae.current_tool_call_index)),ae.current_tool_call_index=Q.index;for(const Q of G.delta.tool_calls??[]){const J=(k=z.message.tool_calls)==null?void 0:k[Q.index];J!=null&&J.type&&((J==null?void 0:J.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(F=J.function)==null?void 0:F.name,index:Q.index,arguments:J.function.arguments,parsed_arguments:J.function.parsed_arguments,arguments_delta:((V=Q.function)==null?void 0:V.arguments)??""}):(J==null||J.type,void 0))}}},bm=function(n,s){var u,d,p;if(lt(this,Ft,"m",qu).call(this,n).done_tool_calls.has(s))return;const o=(u=n.message.tool_calls)==null?void 0:u[s];if(!o)throw new Error("no tool call snapshot");if(!o.type)throw new Error("tool call snapshot missing `type`");if(o.type==="function"){const m=(p=(d=lt(this,Vs,"f"))==null?void 0:d.tools)==null?void 0:p.find(v=>v.type==="function"&&v.function.name===o.function.name);this._emit("tool_calls.function.arguments.done",{name:o.function.name,index:s,arguments:o.function.arguments,parsed_arguments:ul(m)?m.$parseRaw(o.function.arguments):m!=null&&m.function.strict?JSON.parse(o.function.arguments):null})}else o.type},Cm=function(n){var i,o;const s=lt(this,Ft,"m",qu).call(this,n);if(n.message.content&&!s.content_done){s.content_done=!0;const u=lt(this,Ft,"m",Tm).call(this);this._emit("content.done",{content:n.message.content,parsed:u?u.$parseRaw(n.message.content):null})}n.message.refusal&&!s.refusal_done&&(s.refusal_done=!0,this._emit("refusal.done",{refusal:n.message.refusal})),(i=n.logprobs)!=null&&i.content&&!s.logprobs_content_done&&(s.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:n.logprobs.content})),(o=n.logprobs)!=null&&o.refusal&&!s.logprobs_refusal_done&&(s.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:n.logprobs.refusal}))},Fu=function(){if(this.ended)throw new Re("stream has ended, this shouldn't happen");const n=lt(this,Ra,"f");if(!n)throw new Re("request ended without sending any chunks");return ii(this,Ra,void 0,"f"),ii(this,oi,[],"f"),IP(n,lt(this,Vs,"f"))},Tm=function(){var s;const n=(s=lt(this,Vs,"f"))==null?void 0:s.response_format;return Wp(n)?n:null},HS=function(n){var s,i,o,u;let d=lt(this,Ra,"f");const{choices:p,...m}=n;d?Object.assign(d,m):d=ii(this,Ra,{...m,choices:[]},"f");for(const{delta:v,finish_reason:S,index:w,logprobs:C=null,...M}of n.choices){let I=d.choices[w];if(I||(I=d.choices[w]={finish_reason:S,index:w,message:{},logprobs:C,...M}),C)if(!I.logprobs)I.logprobs=Object.assign({},C);else{const{content:Q,refusal:J,...j}=C;Object.assign(I.logprobs,j),Q&&((s=I.logprobs).content??(s.content=[]),I.logprobs.content.push(...Q)),J&&((i=I.logprobs).refusal??(i.refusal=[]),I.logprobs.refusal.push(...J))}if(S&&(I.finish_reason=S,lt(this,Vs,"f")&&qb(lt(this,Vs,"f")))){if(S==="length")throw new wb;if(S==="content_filter")throw new _b}if(Object.assign(I,M),!v)continue;const{content:k,refusal:F,function_call:V,role:G,tool_calls:z,...ae}=v;if(Object.assign(I.message,ae),F&&(I.message.refusal=(I.message.refusal||"")+F),G&&(I.message.role=G),V&&(I.message.function_call?(V.name&&(I.message.function_call.name=V.name),V.arguments&&((o=I.message.function_call).arguments??(o.arguments=""),I.message.function_call.arguments+=V.arguments)):I.message.function_call=V),k&&(I.message.content=(I.message.content||"")+k,!I.message.refusal&&lt(this,Ft,"m",Tm).call(this)&&(I.message.parsed=GS(I.message.content))),z){I.message.tool_calls||(I.message.tool_calls=[]);for(const{index:Q,id:J,type:j,function:X,...ne}of z){const le=(u=I.message.tool_calls)[Q]??(u[Q]={});Object.assign(le,ne),J&&(le.id=J),j&&(le.type=j),X&&(le.function??(le.function={name:X.name??"",arguments:""})),X!=null&&X.name&&(le.function.name=X.name),X!=null&&X.arguments&&(le.function.arguments+=X.arguments,CP(lt(this,Vs,"f"),le)&&(le.function.parsed_arguments=GS(le.function.arguments)))}}}return d},Symbol.asyncIterator)](){const e=[],n=[];let s=!1;return this.on("chunk",i=>{const o=n.shift();o?o.resolve(i):e.push(i)}),this.on("end",()=>{s=!0;for(const i of n)i.resolve(void 0);n.length=0}),this.on("abort",i=>{s=!0;for(const o of n)o.reject(i);n.length=0}),this.on("error",i=>{s=!0;for(const o of n)o.reject(i);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((o,u)=>n.push({resolve:o,reject:u})).then(o=>o?{value:o,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new hs(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function IP(t,e){const{id:n,choices:s,created:i,model:o,system_fingerprint:u,...d}=t,p={...d,id:n,choices:s.map(({message:m,finish_reason:v,index:S,logprobs:w,...C})=>{if(!v)throw new Re(`missing finish_reason for choice ${S}`);const{content:M=null,function_call:I,tool_calls:k,...F}=m,V=m.role;if(!V)throw new Re(`missing role for choice ${S}`);if(I){const{arguments:G,name:z}=I;if(G==null)throw new Re(`missing function_call.arguments for choice ${S}`);if(!z)throw new Re(`missing function_call.name for choice ${S}`);return{...C,message:{content:M,function_call:{arguments:G,name:z},role:V,refusal:m.refusal??null},finish_reason:v,index:S,logprobs:w}}return k?{...C,index:S,finish_reason:v,logprobs:w,message:{...F,role:V,content:M,refusal:m.refusal??null,tool_calls:k.map((G,z)=>{const{function:ae,type:Q,id:J,...j}=G,{arguments:X,name:ne,...le}=ae||{};if(J==null)throw new Re(`missing choices[${S}].tool_calls[${z}].id
${$u(t)}`);if(Q==null)throw new Re(`missing choices[${S}].tool_calls[${z}].type
${$u(t)}`);if(ne==null)throw new Re(`missing choices[${S}].tool_calls[${z}].function.name
${$u(t)}`);if(X==null)throw new Re(`missing choices[${S}].tool_calls[${z}].function.arguments
${$u(t)}`);return{...j,id:J,type:Q,function:{...le,name:ne,arguments:X}}})}}:{...C,message:{...F,content:M,role:V,refusal:m.refusal??null},finish_reason:v,index:S,logprobs:w}}),created:i,model:o,object:"chat.completion",...u?{system_fingerprint:u}:{}};return wP(p,e)}function $u(t){return JSON.stringify(t)}class Ti extends el{static fromReadableStream(e){const n=new Ti(null);return n._run(()=>n._fromReadableStream(e)),n}static runFunctions(e,n,s){const i=new Ti(null),o={...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"runFunctions"}};return i._run(()=>i._runFunctions(e,n,o)),i}static runTools(e,n,s){const i=new Ti(n),o={...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,n,o)),i}}let nC=class extends Ne{parse(e,n){return TP(e.tools),this._client.chat.completions.create(e,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(s=>Qp(s,e))}runFunctions(e,n){return e.stream?Ti.runFunctions(this._client,e,n):Qo.runFunctions(this._client,e,n)}runTools(e,n){return e.stream?Ti.runTools(this._client,e,n):Qo.runTools(this._client,e,n)}stream(e,n){return el.createChatCompletion(this._client,e,n)}};class pp extends Ne{constructor(){super(...arguments),this.completions=new nC(this._client)}}(function(t){t.Completions=nC})(pp||(pp={}));class sC extends Ne{create(e,n){return this._client.post("/realtime/sessions",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class aC extends Ne{create(e,n){return this._client.post("/realtime/transcription_sessions",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Vc extends Ne{constructor(){super(...arguments),this.sessions=new sC(this._client),this.transcriptionSessions=new aC(this._client)}}Vc.Sessions=sC;Vc.TranscriptionSessions=aC;class eh extends Ne{create(e,n,s){return this._client.post(`/threads/${e}/messages`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}retrieve(e,n,s){return this._client.get(`/threads/${e}/messages/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}update(e,n,s,i){return this._client.post(`/threads/${e}/messages/${n}`,{body:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,n={},s){return St(n)?this.list(e,{},n):this._client.getAPIList(`/threads/${e}/messages`,th,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}del(e,n,s){return this._client.delete(`/threads/${e}/messages/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class th extends Gt{}eh.MessagesPage=th;class nh extends Ne{retrieve(e,n,s,i={},o){return St(i)?this.retrieve(e,n,s,{},i):this._client.get(`/threads/${e}/runs/${n}/steps/${s}`,{query:i,...o,headers:{"OpenAI-Beta":"assistants=v2",...o==null?void 0:o.headers}})}list(e,n,s={},i){return St(s)?this.list(e,n,{},s):this._client.getAPIList(`/threads/${e}/runs/${n}/steps`,sh,{query:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}}class sh extends Gt{}nh.RunStepsPage=sh;let cl=class extends Ne{constructor(){super(...arguments),this.steps=new nh(this._client)}create(e,n,s){const{include:i,...o}=n;return this._client.post(`/threads/${e}/runs`,{query:{include:i},body:o,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:n.stream??!1})}retrieve(e,n,s){return this._client.get(`/threads/${e}/runs/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}update(e,n,s,i){return this._client.post(`/threads/${e}/runs/${n}`,{body:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,n={},s){return St(n)?this.list(e,{},n):this._client.getAPIList(`/threads/${e}/runs`,ah,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}cancel(e,n,s){return this._client.post(`/threads/${e}/runs/${n}/cancel`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async createAndPoll(e,n,s){const i=await this.create(e,n,s);return await this.poll(e,i.id,s)}createAndStream(e,n,s){return ss.createAssistantStream(e,this._client.beta.threads.runs,n,s)}async poll(e,n,s){const i={...s==null?void 0:s.headers,"X-Stainless-Poll-Helper":"true"};for(s!=null&&s.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){const{data:o,response:u}=await this.retrieve(e,n,{...s,headers:{...s==null?void 0:s.headers,...i}}).withResponse();switch(o.status){case"queued":case"in_progress":case"cancelling":let d=5e3;if(s!=null&&s.pollIntervalMs)d=s.pollIntervalMs;else{const p=u.headers.get("openai-poll-after-ms");if(p){const m=parseInt(p);isNaN(m)||(d=m)}}await ol(d);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return o}}}stream(e,n,s){return ss.createAssistantStream(e,this._client.beta.threads.runs,n,s)}submitToolOutputs(e,n,s,i){return this._client.post(`/threads/${e}/runs/${n}/submit_tool_outputs`,{body:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers},stream:s.stream??!1})}async submitToolOutputsAndPoll(e,n,s,i){const o=await this.submitToolOutputs(e,n,s,i);return await this.poll(e,o.id,i)}submitToolOutputsStream(e,n,s,i){return ss.createToolAssistantStream(e,n,this._client.beta.threads.runs,s,i)}};class ah extends Gt{}cl.RunsPage=ah;cl.Steps=nh;cl.RunStepsPage=sh;class Bi extends Ne{constructor(){super(...arguments),this.runs=new cl(this._client),this.messages=new eh(this._client)}create(e={},n){return St(e)?this.create({},e):this._client.post("/threads",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,n){return this._client.get(`/threads/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,n,s){return this._client.post(`/threads/${e}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}del(e,n){return this._client.delete(`/threads/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}createAndRun(e,n){return this._client.post("/threads/runs",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:e.stream??!1})}async createAndRunPoll(e,n){const s=await this.createAndRun(e,n);return await this.runs.poll(s.thread_id,s.id,n)}createAndRunStream(e,n){return ss.createThreadAssistantStream(e,this._client.beta.threads,n)}}Bi.Runs=cl;Bi.RunsPage=ah;Bi.Messages=eh;Bi.MessagesPage=th;class Vi extends Ne{constructor(){super(...arguments),this.realtime=new Vc(this._client),this.chat=new pp(this._client),this.assistants=new Zp(this._client),this.threads=new Bi(this._client)}}Vi.Realtime=Vc;Vi.Assistants=Zp;Vi.AssistantsPage=Xp;Vi.Threads=Bi;class rC extends Ne{create(e,n){return this._client.post("/completions",{body:e,...n,stream:e.stream??!1})}}class iC extends Ne{retrieve(e,n,s){return this._client.get(`/containers/${e}/files/${n}/content`,{...s,headers:{Accept:"application/binary",...s==null?void 0:s.headers},__binaryResponse:!0})}}let qc=class extends Ne{constructor(){super(...arguments),this.content=new iC(this._client)}create(e,n,s){return this._client.post(`/containers/${e}/files`,vr({body:n,...s}))}retrieve(e,n,s){return this._client.get(`/containers/${e}/files/${n}`,s)}list(e,n={},s){return St(n)?this.list(e,{},n):this._client.getAPIList(`/containers/${e}/files`,rh,{query:n,...s})}del(e,n,s){return this._client.delete(`/containers/${e}/files/${n}`,{...s,headers:{Accept:"*/*",...s==null?void 0:s.headers}})}};class rh extends Gt{}qc.FileListResponsesPage=rh;qc.Content=iC;class dl extends Ne{constructor(){super(...arguments),this.files=new qc(this._client)}create(e,n){return this._client.post("/containers",{body:e,...n})}retrieve(e,n){return this._client.get(`/containers/${e}`,n)}list(e={},n){return St(e)?this.list({},e):this._client.getAPIList("/containers",ih,{query:e,...n})}del(e,n){return this._client.delete(`/containers/${e}`,{...n,headers:{Accept:"*/*",...n==null?void 0:n.headers}})}}class ih extends Gt{}dl.ContainerListResponsesPage=ih;dl.Files=qc;dl.FileListResponsesPage=rh;class oC extends Ne{create(e,n){const s=!!e.encoding_format;let i=s?e.encoding_format:"base64";s&&La("Request","User defined encoding_format:",e.encoding_format);const o=this._client.post("/embeddings",{body:{...e,encoding_format:i},...n});return s?o:(La("response","Decoding base64 embeddings to float32 array"),o._thenUnwrap(u=>(u&&u.data&&u.data.forEach(d=>{const p=d.embedding;d.embedding=xP(p)}),u)))}}class oh extends Ne{retrieve(e,n,s,i){return this._client.get(`/evals/${e}/runs/${n}/output_items/${s}`,i)}list(e,n,s={},i){return St(s)?this.list(e,n,{},s):this._client.getAPIList(`/evals/${e}/runs/${n}/output_items`,lh,{query:s,...i})}}class lh extends Gt{}oh.OutputItemListResponsesPage=lh;class fl extends Ne{constructor(){super(...arguments),this.outputItems=new oh(this._client)}create(e,n,s){return this._client.post(`/evals/${e}/runs`,{body:n,...s})}retrieve(e,n,s){return this._client.get(`/evals/${e}/runs/${n}`,s)}list(e,n={},s){return St(n)?this.list(e,{},n):this._client.getAPIList(`/evals/${e}/runs`,uh,{query:n,...s})}del(e,n,s){return this._client.delete(`/evals/${e}/runs/${n}`,s)}cancel(e,n,s){return this._client.post(`/evals/${e}/runs/${n}`,s)}}class uh extends Gt{}fl.RunListResponsesPage=uh;fl.OutputItems=oh;fl.OutputItemListResponsesPage=lh;class ml extends Ne{constructor(){super(...arguments),this.runs=new fl(this._client)}create(e,n){return this._client.post("/evals",{body:e,...n})}retrieve(e,n){return this._client.get(`/evals/${e}`,n)}update(e,n,s){return this._client.post(`/evals/${e}`,{body:n,...s})}list(e={},n){return St(e)?this.list({},e):this._client.getAPIList("/evals",ch,{query:e,...n})}del(e,n){return this._client.delete(`/evals/${e}`,n)}}class ch extends Gt{}ml.EvalListResponsesPage=ch;ml.Runs=fl;ml.RunListResponsesPage=uh;let dh=class extends Ne{create(e,n){return this._client.post("/files",vr({body:e,...n}))}retrieve(e,n){return this._client.get(`/files/${e}`,n)}list(e={},n){return St(e)?this.list({},e):this._client.getAPIList("/files",fh,{query:e,...n})}del(e,n){return this._client.delete(`/files/${e}`,n)}content(e,n){return this._client.get(`/files/${e}/content`,{...n,headers:{Accept:"application/binary",...n==null?void 0:n.headers},__binaryResponse:!0})}retrieveContent(e,n){return this._client.get(`/files/${e}/content`,n)}async waitForProcessing(e,{pollInterval:n=5e3,maxWait:s=1800*1e3}={}){const i=new Set(["processed","error","deleted"]),o=Date.now();let u=await this.retrieve(e);for(;!u.status||!i.has(u.status);)if(await ol(n),u=await this.retrieve(e),Date.now()-o>s)throw new jp({message:`Giving up on waiting for file ${e} to finish processing after ${s} milliseconds.`});return u}};class fh extends Gt{}dh.FileObjectsPage=fh;class lC extends Ne{}let uC=class extends Ne{run(e,n){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...n})}validate(e,n){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...n})}};class mh extends Ne{constructor(){super(...arguments),this.graders=new uC(this._client)}}mh.Graders=uC;class ph extends Ne{create(e,n,s){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,hh,{body:n,method:"post",...s})}retrieve(e,n={},s){return St(n)?this.retrieve(e,{},n):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:n,...s})}del(e,n,s){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions/${n}`,s)}}class hh extends Lc{}ph.PermissionCreateResponsesPage=hh;let Fc=class extends Ne{constructor(){super(...arguments),this.permissions=new ph(this._client)}};Fc.Permissions=ph;Fc.PermissionCreateResponsesPage=hh;class gh extends Ne{list(e,n={},s){return St(n)?this.list(e,{},n):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,yh,{query:n,...s})}}class yh extends Gt{}gh.FineTuningJobCheckpointsPage=yh;class qi extends Ne{constructor(){super(...arguments),this.checkpoints=new gh(this._client)}create(e,n){return this._client.post("/fine_tuning/jobs",{body:e,...n})}retrieve(e,n){return this._client.get(`/fine_tuning/jobs/${e}`,n)}list(e={},n){return St(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",vh,{query:e,...n})}cancel(e,n){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,n)}listEvents(e,n={},s){return St(n)?this.listEvents(e,{},n):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,xh,{query:n,...s})}pause(e,n){return this._client.post(`/fine_tuning/jobs/${e}/pause`,n)}resume(e,n){return this._client.post(`/fine_tuning/jobs/${e}/resume`,n)}}class vh extends Gt{}class xh extends Gt{}qi.FineTuningJobsPage=vh;qi.FineTuningJobEventsPage=xh;qi.Checkpoints=gh;qi.FineTuningJobCheckpointsPage=yh;class qa extends Ne{constructor(){super(...arguments),this.methods=new lC(this._client),this.jobs=new qi(this._client),this.checkpoints=new Fc(this._client),this.alpha=new mh(this._client)}}qa.Methods=lC;qa.Jobs=qi;qa.FineTuningJobsPage=vh;qa.FineTuningJobEventsPage=xh;qa.Checkpoints=Fc;qa.Alpha=mh;class cC extends Ne{}class Sh extends Ne{constructor(){super(...arguments),this.graderModels=new cC(this._client)}}Sh.GraderModels=cC;class dC extends Ne{createVariation(e,n){return this._client.post("/images/variations",vr({body:e,...n}))}edit(e,n){return this._client.post("/images/edits",vr({body:e,...n}))}generate(e,n){return this._client.post("/images/generations",{body:e,...n})}}class wh extends Ne{retrieve(e,n){return this._client.get(`/models/${e}`,n)}list(e){return this._client.getAPIList("/models",_h,e)}del(e,n){return this._client.delete(`/models/${e}`,n)}}class _h extends Lc{}wh.ModelsPage=_h;class fC extends Ne{create(e,n){return this._client.post("/moderations",{body:e,...n})}}function DP(t,e){return!e||!kP(e)?{...t,output_parsed:null,output:t.output.map(n=>n.type==="function_call"?{...n,parsed_arguments:null}:n.type==="message"?{...n,content:n.content.map(s=>({...s,parsed:null}))}:n)}:mC(t,e)}function mC(t,e){const n=t.output.map(i=>{if(i.type==="function_call")return{...i,parsed_arguments:OP(e,i)};if(i.type==="message"){const o=i.content.map(u=>u.type==="output_text"?{...u,parsed:PP(e,u.text)}:u);return{...i,content:o}}return i}),s=Object.assign({},t,{output:n});return Object.getOwnPropertyDescriptor(t,"output_text")||pC(s),Object.defineProperty(s,"output_parsed",{enumerable:!0,get(){for(const i of s.output)if(i.type==="message"){for(const o of i.content)if(o.type==="output_text"&&o.parsed!==null)return o.parsed}return null}}),s}function PP(t,e){var n,s,i,o;return((s=(n=t.text)==null?void 0:n.format)==null?void 0:s.type)!=="json_schema"?null:"$parseRaw"in((i=t.text)==null?void 0:i.format)?((o=t.text)==null?void 0:o.format).$parseRaw(e):JSON.parse(e)}function kP(t){var e;return!!Wp((e=t.text)==null?void 0:e.format)}function LP(t){return(t==null?void 0:t.$brand)==="auto-parseable-tool"}function UP(t,e){return t.find(n=>n.type==="function"&&n.name===e)}function OP(t,e){const n=UP(t.tools??[],e.name);return{...e,...e,parsed_arguments:LP(n)?n.$parseRaw(e.arguments):n!=null&&n.strict?JSON.parse(e.arguments):null}}function pC(t){const e=[];for(const n of t.output)if(n.type==="message")for(const s of n.content)s.type==="output_text"&&e.push(s.text);t.output_text=e.join("")}class hC extends Ne{list(e,n={},s){return St(n)?this.list(e,{},n):this._client.getAPIList(`/responses/${e}/input_items`,VP,{query:n,...s})}}var li=function(t,e,n,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(t,n):i?i.value=n:e.set(t,n),n},Na=function(t,e,n,s){if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)},ui,Gu,Ma,Hu,zS,jS,JS,YS;class bh extends Kp{constructor(e){super(),ui.add(this),Gu.set(this,void 0),Ma.set(this,void 0),Hu.set(this,void 0),li(this,Gu,e,"f")}static createResponse(e,n,s){const i=new bh(n);return i._run(()=>i._createOrRetrieveResponse(e,n,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createOrRetrieveResponse(e,n,s){var d;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),Na(this,ui,"m",zS).call(this);let o,u=null;"response_id"in n?(o=await e.responses.retrieve(n.response_id,{stream:!0},{...s,signal:this.controller.signal,stream:!0}),u=n.starting_after??null):o=await e.responses.create({...n,stream:!0},{...s,signal:this.controller.signal}),this._connected();for await(const p of o)Na(this,ui,"m",jS).call(this,p,u);if((d=o.controller.signal)!=null&&d.aborted)throw new zn;return Na(this,ui,"m",JS).call(this)}[(Gu=new WeakMap,Ma=new WeakMap,Hu=new WeakMap,ui=new WeakSet,zS=function(){this.ended||li(this,Ma,void 0,"f")},jS=function(n,s){if(this.ended)return;const i=(u,d)=>{(s==null||d.sequence_number>s)&&this._emit(u,d)},o=Na(this,ui,"m",YS).call(this,n);switch(i("event",n),n.type){case"response.output_text.delta":{const u=o.output[n.output_index];if(!u)throw new Re(`missing output at index ${n.output_index}`);if(u.type==="message"){const d=u.content[n.content_index];if(!d)throw new Re(`missing content at index ${n.content_index}`);if(d.type!=="output_text")throw new Re(`expected content to be 'output_text', got ${d.type}`);i("response.output_text.delta",{...n,snapshot:d.text})}break}case"response.function_call_arguments.delta":{const u=o.output[n.output_index];if(!u)throw new Re(`missing output at index ${n.output_index}`);u.type==="function_call"&&i("response.function_call_arguments.delta",{...n,snapshot:u.arguments});break}default:i(n.type,n);break}},JS=function(){if(this.ended)throw new Re("stream has ended, this shouldn't happen");const n=Na(this,Ma,"f");if(!n)throw new Re("request ended without sending any events");li(this,Ma,void 0,"f");const s=BP(n,Na(this,Gu,"f"));return li(this,Hu,s,"f"),s},YS=function(n){let s=Na(this,Ma,"f");if(!s){if(n.type!=="response.created")throw new Re(`When snapshot hasn't been set yet, expected 'response.created' event, got ${n.type}`);return s=li(this,Ma,n.response,"f"),s}switch(n.type){case"response.output_item.added":{s.output.push(n.item);break}case"response.content_part.added":{const i=s.output[n.output_index];if(!i)throw new Re(`missing output at index ${n.output_index}`);i.type==="message"&&i.content.push(n.part);break}case"response.output_text.delta":{const i=s.output[n.output_index];if(!i)throw new Re(`missing output at index ${n.output_index}`);if(i.type==="message"){const o=i.content[n.content_index];if(!o)throw new Re(`missing content at index ${n.content_index}`);if(o.type!=="output_text")throw new Re(`expected content to be 'output_text', got ${o.type}`);o.text+=n.delta}break}case"response.function_call_arguments.delta":{const i=s.output[n.output_index];if(!i)throw new Re(`missing output at index ${n.output_index}`);i.type==="function_call"&&(i.arguments+=n.delta);break}case"response.completed":{li(this,Ma,n.response,"f");break}}return s},Symbol.asyncIterator)](){const e=[],n=[];let s=!1;return this.on("event",i=>{const o=n.shift();o?o.resolve(i):e.push(i)}),this.on("end",()=>{s=!0;for(const i of n)i.resolve(void 0);n.length=0}),this.on("abort",i=>{s=!0;for(const o of n)o.reject(i);n.length=0}),this.on("error",i=>{s=!0;for(const o of n)o.reject(i);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((o,u)=>n.push({resolve:o,reject:u})).then(o=>o?{value:o,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=Na(this,Hu,"f");if(!e)throw new Re("stream ended without producing a ChatCompletion");return e}}function BP(t,e){return DP(t,e)}class Ch extends Ne{constructor(){super(...arguments),this.inputItems=new hC(this._client)}create(e,n){return this._client.post("/responses",{body:e,...n,stream:e.stream??!1})._thenUnwrap(s=>("object"in s&&s.object==="response"&&pC(s),s))}retrieve(e,n={},s){return this._client.get(`/responses/${e}`,{query:n,...s,stream:(n==null?void 0:n.stream)??!1})}del(e,n){return this._client.delete(`/responses/${e}`,{...n,headers:{Accept:"*/*",...n==null?void 0:n.headers}})}parse(e,n){return this._client.responses.create(e,n)._thenUnwrap(s=>mC(s,e))}stream(e,n){return bh.createResponse(this._client,e,n)}cancel(e,n){return this._client.post(`/responses/${e}/cancel`,{...n,headers:{Accept:"*/*",...n==null?void 0:n.headers}})}}class VP extends Gt{}Ch.InputItems=hC;class gC extends Ne{create(e,n,s){return this._client.post(`/uploads/${e}/parts`,vr({body:n,...s}))}}class Th extends Ne{constructor(){super(...arguments),this.parts=new gC(this._client)}create(e,n){return this._client.post("/uploads",{body:e,...n})}cancel(e,n){return this._client.post(`/uploads/${e}/cancel`,n)}complete(e,n,s){return this._client.post(`/uploads/${e}/complete`,{body:n,...s})}}Th.Parts=gC;const qP=async t=>{const e=await Promise.allSettled(t),n=e.filter(i=>i.status==="rejected");if(n.length){for(const i of n)console.error(i.reason);throw new Error(`${n.length} promise(s) failed - see the above errors`)}const s=[];for(const i of e)i.status==="fulfilled"&&s.push(i.value);return s};class $c extends Ne{create(e,n,s){return this._client.post(`/vector_stores/${e}/files`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}retrieve(e,n,s){return this._client.get(`/vector_stores/${e}/files/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}update(e,n,s,i){return this._client.post(`/vector_stores/${e}/files/${n}`,{body:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,n={},s){return St(n)?this.list(e,{},n):this._client.getAPIList(`/vector_stores/${e}/files`,Gc,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}del(e,n,s){return this._client.delete(`/vector_stores/${e}/files/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async createAndPoll(e,n,s){const i=await this.create(e,n,s);return await this.poll(e,i.id,s)}async poll(e,n,s){const i={...s==null?void 0:s.headers,"X-Stainless-Poll-Helper":"true"};for(s!=null&&s.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){const o=await this.retrieve(e,n,{...s,headers:i}).withResponse(),u=o.data;switch(u.status){case"in_progress":let d=5e3;if(s!=null&&s.pollIntervalMs)d=s.pollIntervalMs;else{const p=o.response.headers.get("openai-poll-after-ms");if(p){const m=parseInt(p);isNaN(m)||(d=m)}}await ol(d);break;case"failed":case"completed":return u}}}async upload(e,n,s){const i=await this._client.files.create({file:n,purpose:"assistants"},s);return this.create(e,{file_id:i.id},s)}async uploadAndPoll(e,n,s){const i=await this.upload(e,n,s);return await this.poll(e,i.id,s)}content(e,n,s){return this._client.getAPIList(`/vector_stores/${e}/files/${n}/content`,Ah,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class Gc extends Gt{}class Ah extends Lc{}$c.VectorStoreFilesPage=Gc;$c.FileContentResponsesPage=Ah;class yC extends Ne{create(e,n,s){return this._client.post(`/vector_stores/${e}/file_batches`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}retrieve(e,n,s){return this._client.get(`/vector_stores/${e}/file_batches/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}cancel(e,n,s){return this._client.post(`/vector_stores/${e}/file_batches/${n}/cancel`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async createAndPoll(e,n,s){const i=await this.create(e,n);return await this.poll(e,i.id,s)}listFiles(e,n,s={},i){return St(s)?this.listFiles(e,n,{},s):this._client.getAPIList(`/vector_stores/${e}/file_batches/${n}/files`,Gc,{query:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}async poll(e,n,s){const i={...s==null?void 0:s.headers,"X-Stainless-Poll-Helper":"true"};for(s!=null&&s.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){const{data:o,response:u}=await this.retrieve(e,n,{...s,headers:i}).withResponse();switch(o.status){case"in_progress":let d=5e3;if(s!=null&&s.pollIntervalMs)d=s.pollIntervalMs;else{const p=u.headers.get("openai-poll-after-ms");if(p){const m=parseInt(p);isNaN(m)||(d=m)}}await ol(d);break;case"failed":case"cancelled":case"completed":return o}}}async uploadAndPoll(e,{files:n,fileIds:s=[]},i){if(n==null||n.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const o=(i==null?void 0:i.maxConcurrency)??5,u=Math.min(o,n.length),d=this._client,p=n.values(),m=[...s];async function v(w){for(let C of w){const M=await d.files.create({file:C,purpose:"assistants"},i);m.push(M.id)}}const S=Array(u).fill(p).map(v);return await qP(S),await this.createAndPoll(e,{file_ids:m})}}class Fa extends Ne{constructor(){super(...arguments),this.files=new $c(this._client),this.fileBatches=new yC(this._client)}create(e,n){return this._client.post("/vector_stores",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,n){return this._client.get(`/vector_stores/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,n,s){return this._client.post(`/vector_stores/${e}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e={},n){return St(e)?this.list({},e):this._client.getAPIList("/vector_stores",Eh,{query:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,n){return this._client.delete(`/vector_stores/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}search(e,n,s){return this._client.getAPIList(`/vector_stores/${e}/search`,Rh,{body:n,method:"post",...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class Eh extends Gt{}class Rh extends Lc{}Fa.VectorStoresPage=Eh;Fa.VectorStoreSearchResponsesPage=Rh;Fa.Files=$c;Fa.VectorStoreFilesPage=Gc;Fa.FileContentResponsesPage=Ah;Fa.FileBatches=yC;var vC;class Ue extends oP{constructor({baseURL:e=Bu("OPENAI_BASE_URL"),apiKey:n=Bu("OPENAI_API_KEY"),organization:s=Bu("OPENAI_ORG_ID")??null,project:i=Bu("OPENAI_PROJECT_ID")??null,...o}={}){if(n===void 0)throw new Re("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const u={apiKey:n,organization:s,project:i,...o,baseURL:e||"https://api.openai.com/v1"};if(!u.dangerouslyAllowBrowser&&yP())throw new Re(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:u.baseURL,timeout:u.timeout??6e5,httpAgent:u.httpAgent,maxRetries:u.maxRetries,fetch:u.fetch}),this.completions=new rC(this),this.chat=new Bc(this),this.embeddings=new oC(this),this.files=new dh(this),this.images=new dC(this),this.audio=new ll(this),this.moderations=new fC(this),this.models=new wh(this),this.fineTuning=new qa(this),this.graders=new Sh(this),this.vectorStores=new Fa(this),this.beta=new Vi(this),this.batches=new Jp(this),this.uploads=new Th(this),this.responses=new Ch(this),this.evals=new ml(this),this.containers=new dl(this),this._options=u,this.apiKey=n,this.organization=s,this.project=i}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return G2(e,{arrayFormat:"brackets"})}}vC=Ue;Ue.OpenAI=vC;Ue.DEFAULT_TIMEOUT=6e5;Ue.OpenAIError=Re;Ue.APIError=Qt;Ue.APIConnectionError=Ic;Ue.APIConnectionTimeoutError=jp;Ue.APIUserAbortError=zn;Ue.NotFoundError=gb;Ue.ConflictError=yb;Ue.RateLimitError=xb;Ue.BadRequestError=mb;Ue.AuthenticationError=pb;Ue.InternalServerError=Sb;Ue.PermissionDeniedError=hb;Ue.UnprocessableEntityError=vb;Ue.toFile=Ab;Ue.fileFromPath=cb;Ue.Completions=rC;Ue.Chat=Bc;Ue.ChatCompletionsPage=Oc;Ue.Embeddings=oC;Ue.Files=dh;Ue.FileObjectsPage=fh;Ue.Images=dC;Ue.Audio=ll;Ue.Moderations=fC;Ue.Models=wh;Ue.ModelsPage=_h;Ue.FineTuning=qa;Ue.Graders=Sh;Ue.VectorStores=Fa;Ue.VectorStoresPage=Eh;Ue.VectorStoreSearchResponsesPage=Rh;Ue.Beta=Vi;Ue.Batches=Jp;Ue.BatchesPage=Yp;Ue.Uploads=Th;Ue.Responses=Ch;Ue.Evals=ml;Ue.EvalListResponsesPage=ch;Ue.Containers=dl;Ue.ContainerListResponsesPage=ih;const FP=t=>typeof t=="object"&&t!==null&&"aborted"in t,xC=t=>t?FP(t)?{signal:t}:t:{},$P=async(t,e=2,n)=>{let s;for(let i=0;i<e;i++){if(n!=null&&n.aborted)throw new DOMException("Aborted","AbortError");try{return await t()}catch(o){if(s=o,n!=null&&n.aborted||i===e-1)throw s;console.warn(`API call failed, retrying... (${i+1}/${e})`,o),await new Promise(u=>setTimeout(u,500))}}throw s};class Ho extends Error{constructor(e,n){super(e),this.name="PlanParsingError",this.rawContent=n}}const hp=t=>{try{return JSON.parse(t)}catch{return null}},GP=t=>{const e=[["[","]"],["{","}"]];for(const[n,s]of e){const i=t.indexOf(n),o=t.lastIndexOf(s);if(i!==-1&&o!==-1&&o>i){const u=t.slice(i,o+1).trim();if(u&&hp(u)!==null)return u}}return null},vc=(t,e)=>{let n=t.trim();const s=n.match(/```(?:json)?\s*([\s\S]*?)\s*```/);s&&s[1]&&(n=s[1]);let o=hp(n);if(o===null){const u=GP(n);u&&(o=hp(u))}if(o!==null){const u=o;if(Array.isArray(u))return u;if(typeof u=="object"&&u!==null){if(e!=null&&e.rootKey){if(!(e.rootKey in u))throw new Ho(`Response is missing required "${e.rootKey}" property.`,n);if(e.requireRootKeyOnly&&Object.keys(u).some(m=>m!==e.rootKey))throw new Ho(`Response must only include the "${e.rootKey}" property.`,n);const p=u[e.rootKey];if(!Array.isArray(p))throw new Ho(`"${e.rootKey}" must be an array.`,n);return p}const d=Object.values(u).find(p=>Array.isArray(p));if(d&&Array.isArray(d))return d;if("chartType"in u&&"title"in u)return[u]}}throw console.error("Failed to parse AI response as JSON. Content:",n),new Ho(`AI response could not be parsed as JSON. Content starts with: "${n.substring(0,150)}..."`,n)},HP=new Set(["user","assistant","system","developer"]),zP=t=>HP.has(t)?t:"user",jP=t=>{if(typeof t=="string")return t;if(Array.isArray(t))return t.map(e=>typeof e=="string"?e:"text"in e&&typeof e.text=="string"?e.text:JSON.stringify(e)).join(`
`);if(t&&typeof t=="object"&&"text"in t){const e=t.text;if(typeof e=="string")return e}return""},JP=t=>t.map(e=>({role:zP(e.role),content:jP(e.content),type:"message"})),YP=t=>{if(typeof t=="boolean")return t?{type:"json_object"}:void 0;if(t)return{type:"json_schema",name:t.name,schema:t.schema,strict:t.strict??!0}},KP=t=>{var e,n,s;return(t==null?void 0:t.status)??((e=t==null?void 0:t.response)==null?void 0:e.status)??(t==null?void 0:t.code)??((n=t==null?void 0:t.error)==null?void 0:n.status)??((s=t==null?void 0:t.cause)==null?void 0:s.status)},ZP=(t,e)=>new Promise((n,s)=>{if(e!=null&&e.aborted){s(new DOMException("Aborted","AbortError"));return}const i=setTimeout(n,t);if(e){const o=()=>{clearTimeout(i),s(new DOMException("Aborted","AbortError"))};e.addEventListener("abort",o,{once:!0})}}),Zs=async(t,e,n,s)=>{var C;if(!t.openAIApiKey)throw new Error("OpenAI API key is not set.");const i=new Ue({apiKey:t.openAIApiKey,dangerouslyAllowBrowser:!0}),o=xC(s),u=YP(n),d={model:t.model,input:JP(e)};u&&(d.text={format:u});const p=2,m=3e4,v=Date.now();let S=0,w;for(;S<p;){if((C=o.signal)!=null&&C.aborted)throw new DOMException("Aborted","AbortError");try{const M=await i.responses.create(d,o.signal?{signal:o.signal}:void 0),I=M==null?void 0:M.usage;I&&o.onUsage&&o.onUsage({provider:"openai",model:t.model,promptTokens:I.prompt_tokens??I.input_tokens??I.input_token_count,completionTokens:I.completion_tokens??I.output_tokens??I.output_token_count,totalTokens:I.total_tokens??I.total_token_count,operation:o.operation});const k=(M.output_text??"").trim();if(!k)throw new Error("OpenAI returned an empty response.");return k}catch(M){w=M;const I=KP(M),k=I===429||typeof I=="number"&&I>=500,F=Date.now()-v;if(!k||S===p-1||F>=m)throw M;const V=Math.min(2e3,500*Math.pow(2,S));await ZP(V,o.signal),S+=1}}throw w instanceof Error?w:new Error("OpenAI request failed.")},Xs=async(t,e,n,s)=>{if(!t.geminiApiKey)throw new Error("Gemini API key is not set.");const i=new P2({apiKey:t.geminiApiKey}),o=xC(s),u=n?`

SCHEMA (for reference only):
${JSON.stringify(n,null,2)}

Return a JSON object that matches this structure exactly.`:"",d=`${e}${u}`.trim(),p=await $P(()=>i.models.generateContent({model:t.model,contents:d},o.signal?{signal:o.signal}:void 0),2,o.signal),m=p.usageMetadata;return m&&o.onUsage&&o.onUsage({provider:"gemini",model:t.model,promptTokens:m.promptTokenCount??void 0,completionTokens:m.candidatesTokenCount??void 0,totalTokens:m.totalTokenCount??void 0,operation:o.operation}),p.text.trim()};var We;(function(t){t.assertEqual=i=>{};function e(i){}t.assertIs=e;function n(i){throw new Error}t.assertNever=n,t.arrayToEnum=i=>{const o={};for(const u of i)o[u]=u;return o},t.getValidEnumValues=i=>{const o=t.objectKeys(i).filter(d=>typeof i[i[d]]!="number"),u={};for(const d of o)u[d]=i[d];return t.objectValues(u)},t.objectValues=i=>t.objectKeys(i).map(function(o){return i[o]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{const o=[];for(const u in i)Object.prototype.hasOwnProperty.call(i,u)&&o.push(u);return o},t.find=(i,o)=>{for(const u of i)if(o(u))return u},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&Number.isFinite(i)&&Math.floor(i)===i;function s(i,o=" | "){return i.map(u=>typeof u=="string"?`'${u}'`:u).join(o)}t.joinValues=s,t.jsonStringifyReplacer=(i,o)=>typeof o=="bigint"?o.toString():o})(We||(We={}));var KS;(function(t){t.mergeShapes=(e,n)=>({...e,...n})})(KS||(KS={}));const we=We.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Da=t=>{switch(typeof t){case"undefined":return we.undefined;case"string":return we.string;case"number":return Number.isNaN(t)?we.nan:we.number;case"boolean":return we.boolean;case"function":return we.function;case"bigint":return we.bigint;case"symbol":return we.symbol;case"object":return Array.isArray(t)?we.array:t===null?we.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?we.promise:typeof Map<"u"&&t instanceof Map?we.map:typeof Set<"u"&&t instanceof Set?we.set:typeof Date<"u"&&t instanceof Date?we.date:we.object;default:return we.unknown}},me=We.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Js extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=e}format(e){const n=e||function(o){return o.message},s={_errors:[]},i=o=>{for(const u of o.issues)if(u.code==="invalid_union")u.unionErrors.map(i);else if(u.code==="invalid_return_type")i(u.returnTypeError);else if(u.code==="invalid_arguments")i(u.argumentsError);else if(u.path.length===0)s._errors.push(n(u));else{let d=s,p=0;for(;p<u.path.length;){const m=u.path[p];p===u.path.length-1?(d[m]=d[m]||{_errors:[]},d[m]._errors.push(n(u))):d[m]=d[m]||{_errors:[]},d=d[m],p++}}};return i(this),s}static assert(e){if(!(e instanceof Js))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,We.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=n=>n.message){const n={},s=[];for(const i of this.issues)if(i.path.length>0){const o=i.path[0];n[o]=n[o]||[],n[o].push(e(i))}else s.push(e(i));return{formErrors:s,fieldErrors:n}}get formErrors(){return this.flatten()}}Js.create=t=>new Js(t);const gp=(t,e)=>{let n;switch(t.code){case me.invalid_type:t.received===we.undefined?n="Required":n=`Expected ${t.expected}, received ${t.received}`;break;case me.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(t.expected,We.jsonStringifyReplacer)}`;break;case me.unrecognized_keys:n=`Unrecognized key(s) in object: ${We.joinValues(t.keys,", ")}`;break;case me.invalid_union:n="Invalid input";break;case me.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${We.joinValues(t.options)}`;break;case me.invalid_enum_value:n=`Invalid enum value. Expected ${We.joinValues(t.options)}, received '${t.received}'`;break;case me.invalid_arguments:n="Invalid function arguments";break;case me.invalid_return_type:n="Invalid function return type";break;case me.invalid_date:n="Invalid date";break;case me.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(n=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?n=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?n=`Invalid input: must end with "${t.validation.endsWith}"`:We.assertNever(t.validation):t.validation!=="regex"?n=`Invalid ${t.validation}`:n="Invalid";break;case me.too_small:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:n="Invalid input";break;case me.too_big:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?n=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:n="Invalid input";break;case me.custom:n="Invalid input";break;case me.invalid_intersection_types:n="Intersection results could not be merged";break;case me.not_multiple_of:n=`Number must be a multiple of ${t.multipleOf}`;break;case me.not_finite:n="Number must be finite";break;default:n=e.defaultError,We.assertNever(t)}return{message:n}};let XP=gp;function WP(){return XP}const QP=t=>{const{data:e,path:n,errorMaps:s,issueData:i}=t,o=[...n,...i.path||[]],u={...i,path:o};if(i.message!==void 0)return{...i,path:o,message:i.message};let d="";const p=s.filter(m=>!!m).slice().reverse();for(const m of p)d=m(u,{data:e,defaultError:d}).message;return{...i,path:o,message:d}};function ve(t,e){const n=WP(),s=QP({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,n,n===gp?void 0:gp].filter(i=>!!i)});t.common.issues.push(s)}class Mn{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,n){const s=[];for(const i of n){if(i.status==="aborted")return ke;i.status==="dirty"&&e.dirty(),s.push(i.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,n){const s=[];for(const i of n){const o=await i.key,u=await i.value;s.push({key:o,value:u})}return Mn.mergeObjectSync(e,s)}static mergeObjectSync(e,n){const s={};for(const i of n){const{key:o,value:u}=i;if(o.status==="aborted"||u.status==="aborted")return ke;o.status==="dirty"&&e.dirty(),u.status==="dirty"&&e.dirty(),o.value!=="__proto__"&&(typeof u.value<"u"||i.alwaysSet)&&(s[o.value]=u.value)}return{status:e.value,value:s}}}const ke=Object.freeze({status:"aborted"}),zo=t=>({status:"dirty",value:t}),Yn=t=>({status:"valid",value:t}),ZS=t=>t.status==="aborted",XS=t=>t.status==="dirty",Ni=t=>t.status==="valid",xc=t=>typeof Promise<"u"&&t instanceof Promise;var be;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(be||(be={}));class Oa{constructor(e,n,s,i){this._cachedPath=[],this.parent=e,this.data=n,this._path=s,this._key=i}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const WS=(t,e)=>{if(Ni(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new Js(t.common.issues);return this._error=n,this._error}}};function $e(t){if(!t)return{};const{errorMap:e,invalid_type_error:n,required_error:s,description:i}=t;if(e&&(n||s))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(u,d)=>{const{message:p}=t;return u.code==="invalid_enum_value"?{message:p??d.defaultError}:typeof d.data>"u"?{message:p??s??d.defaultError}:u.code!=="invalid_type"?{message:d.defaultError}:{message:p??n??d.defaultError}},description:i}}class Ke{get description(){return this._def.description}_getType(e){return Da(e.data)}_getOrReturnCtx(e,n){return n||{common:e.parent.common,data:e.data,parsedType:Da(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Mn,ctx:{common:e.parent.common,data:e.data,parsedType:Da(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const n=this._parse(e);if(xc(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(e){const n=this._parse(e);return Promise.resolve(n)}parse(e,n){const s=this.safeParse(e,n);if(s.success)return s.data;throw s.error}safeParse(e,n){const s={common:{issues:[],async:(n==null?void 0:n.async)??!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Da(e)},i=this._parseSync({data:e,path:s.path,parent:s});return WS(s,i)}"~validate"(e){var s,i;const n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Da(e)};if(!this["~standard"].async)try{const o=this._parseSync({data:e,path:[],parent:n});return Ni(o)?{value:o.value}:{issues:n.common.issues}}catch(o){(i=(s=o==null?void 0:o.message)==null?void 0:s.toLowerCase())!=null&&i.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(o=>Ni(o)?{value:o.value}:{issues:n.common.issues})}async parseAsync(e,n){const s=await this.safeParseAsync(e,n);if(s.success)return s.data;throw s.error}async safeParseAsync(e,n){const s={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Da(e)},i=this._parse({data:e,path:s.path,parent:s}),o=await(xc(i)?i:Promise.resolve(i));return WS(s,o)}refine(e,n){const s=i=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(i):n;return this._refinement((i,o)=>{const u=e(i),d=()=>o.addIssue({code:me.custom,...s(i)});return typeof Promise<"u"&&u instanceof Promise?u.then(p=>p?!0:(d(),!1)):u?!0:(d(),!1)})}refinement(e,n){return this._refinement((s,i)=>e(s)?!0:(i.addIssue(typeof n=="function"?n(s,i):n),!1))}_refinement(e){return new Di({schema:this,typeName:Le.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return Ua.create(this,this._def)}nullable(){return Pi.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return gs.create(this)}promise(){return bc.create(this,this._def)}or(e){return wc.create([this,e],this._def)}and(e){return _c.create(this,e,this._def)}transform(e){return new Di({...$e(this._def),schema:this,typeName:Le.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const n=typeof e=="function"?e:()=>e;return new xp({...$e(this._def),innerType:this,defaultValue:n,typeName:Le.ZodDefault})}brand(){return new _k({typeName:Le.ZodBranded,type:this,...$e(this._def)})}catch(e){const n=typeof e=="function"?e:()=>e;return new Sp({...$e(this._def),innerType:this,catchValue:n,typeName:Le.ZodCatch})}describe(e){const n=this.constructor;return new n({...this._def,description:e})}pipe(e){return Nh.create(this,e)}readonly(){return wp.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const ek=/^c[^\s-]{8,}$/i,tk=/^[0-9a-z]+$/,nk=/^[0-9A-HJKMNP-TV-Z]{26}$/i,sk=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,ak=/^[a-z0-9_-]{21}$/i,rk=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,ik=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,ok=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,lk="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Am;const uk=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ck=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,dk=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,fk=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,mk=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,pk=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,SC="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",hk=new RegExp(`^${SC}$`);function wC(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);const n=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${n}`}function gk(t){return new RegExp(`^${wC(t)}$`)}function yk(t){let e=`${SC}T${wC(t)}`;const n=[];return n.push(t.local?"Z?":"Z"),t.offset&&n.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${n.join("|")})`,new RegExp(`^${e}$`)}function vk(t,e){return!!((e==="v4"||!e)&&uk.test(t)||(e==="v6"||!e)&&dk.test(t))}function xk(t,e){if(!rk.test(t))return!1;try{const[n]=t.split(".");if(!n)return!1;const s=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),i=JSON.parse(atob(s));return!(typeof i!="object"||i===null||"typ"in i&&(i==null?void 0:i.typ)!=="JWT"||!i.alg||e&&i.alg!==e)}catch{return!1}}function Sk(t,e){return!!((e==="v4"||!e)&&ck.test(t)||(e==="v6"||!e)&&fk.test(t))}class Pa extends Ke{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==we.string){const o=this._getOrReturnCtx(e);return ve(o,{code:me.invalid_type,expected:we.string,received:o.parsedType}),ke}const s=new Mn;let i;for(const o of this._def.checks)if(o.kind==="min")e.data.length<o.value&&(i=this._getOrReturnCtx(e,i),ve(i,{code:me.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),s.dirty());else if(o.kind==="max")e.data.length>o.value&&(i=this._getOrReturnCtx(e,i),ve(i,{code:me.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),s.dirty());else if(o.kind==="length"){const u=e.data.length>o.value,d=e.data.length<o.value;(u||d)&&(i=this._getOrReturnCtx(e,i),u?ve(i,{code:me.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}):d&&ve(i,{code:me.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}),s.dirty())}else if(o.kind==="email")ok.test(e.data)||(i=this._getOrReturnCtx(e,i),ve(i,{validation:"email",code:me.invalid_string,message:o.message}),s.dirty());else if(o.kind==="emoji")Am||(Am=new RegExp(lk,"u")),Am.test(e.data)||(i=this._getOrReturnCtx(e,i),ve(i,{validation:"emoji",code:me.invalid_string,message:o.message}),s.dirty());else if(o.kind==="uuid")sk.test(e.data)||(i=this._getOrReturnCtx(e,i),ve(i,{validation:"uuid",code:me.invalid_string,message:o.message}),s.dirty());else if(o.kind==="nanoid")ak.test(e.data)||(i=this._getOrReturnCtx(e,i),ve(i,{validation:"nanoid",code:me.invalid_string,message:o.message}),s.dirty());else if(o.kind==="cuid")ek.test(e.data)||(i=this._getOrReturnCtx(e,i),ve(i,{validation:"cuid",code:me.invalid_string,message:o.message}),s.dirty());else if(o.kind==="cuid2")tk.test(e.data)||(i=this._getOrReturnCtx(e,i),ve(i,{validation:"cuid2",code:me.invalid_string,message:o.message}),s.dirty());else if(o.kind==="ulid")nk.test(e.data)||(i=this._getOrReturnCtx(e,i),ve(i,{validation:"ulid",code:me.invalid_string,message:o.message}),s.dirty());else if(o.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),ve(i,{validation:"url",code:me.invalid_string,message:o.message}),s.dirty()}else o.kind==="regex"?(o.regex.lastIndex=0,o.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),ve(i,{validation:"regex",code:me.invalid_string,message:o.message}),s.dirty())):o.kind==="trim"?e.data=e.data.trim():o.kind==="includes"?e.data.includes(o.value,o.position)||(i=this._getOrReturnCtx(e,i),ve(i,{code:me.invalid_string,validation:{includes:o.value,position:o.position},message:o.message}),s.dirty()):o.kind==="toLowerCase"?e.data=e.data.toLowerCase():o.kind==="toUpperCase"?e.data=e.data.toUpperCase():o.kind==="startsWith"?e.data.startsWith(o.value)||(i=this._getOrReturnCtx(e,i),ve(i,{code:me.invalid_string,validation:{startsWith:o.value},message:o.message}),s.dirty()):o.kind==="endsWith"?e.data.endsWith(o.value)||(i=this._getOrReturnCtx(e,i),ve(i,{code:me.invalid_string,validation:{endsWith:o.value},message:o.message}),s.dirty()):o.kind==="datetime"?yk(o).test(e.data)||(i=this._getOrReturnCtx(e,i),ve(i,{code:me.invalid_string,validation:"datetime",message:o.message}),s.dirty()):o.kind==="date"?hk.test(e.data)||(i=this._getOrReturnCtx(e,i),ve(i,{code:me.invalid_string,validation:"date",message:o.message}),s.dirty()):o.kind==="time"?gk(o).test(e.data)||(i=this._getOrReturnCtx(e,i),ve(i,{code:me.invalid_string,validation:"time",message:o.message}),s.dirty()):o.kind==="duration"?ik.test(e.data)||(i=this._getOrReturnCtx(e,i),ve(i,{validation:"duration",code:me.invalid_string,message:o.message}),s.dirty()):o.kind==="ip"?vk(e.data,o.version)||(i=this._getOrReturnCtx(e,i),ve(i,{validation:"ip",code:me.invalid_string,message:o.message}),s.dirty()):o.kind==="jwt"?xk(e.data,o.alg)||(i=this._getOrReturnCtx(e,i),ve(i,{validation:"jwt",code:me.invalid_string,message:o.message}),s.dirty()):o.kind==="cidr"?Sk(e.data,o.version)||(i=this._getOrReturnCtx(e,i),ve(i,{validation:"cidr",code:me.invalid_string,message:o.message}),s.dirty()):o.kind==="base64"?mk.test(e.data)||(i=this._getOrReturnCtx(e,i),ve(i,{validation:"base64",code:me.invalid_string,message:o.message}),s.dirty()):o.kind==="base64url"?pk.test(e.data)||(i=this._getOrReturnCtx(e,i),ve(i,{validation:"base64url",code:me.invalid_string,message:o.message}),s.dirty()):We.assertNever(o);return{status:s.value,value:e.data}}_regex(e,n,s){return this.refinement(i=>e.test(i),{validation:n,code:me.invalid_string,...be.errToObj(s)})}_addCheck(e){return new Pa({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...be.errToObj(e)})}url(e){return this._addCheck({kind:"url",...be.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...be.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...be.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...be.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...be.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...be.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...be.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...be.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...be.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...be.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...be.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...be.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...be.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...be.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...be.errToObj(e)})}regex(e,n){return this._addCheck({kind:"regex",regex:e,...be.errToObj(n)})}includes(e,n){return this._addCheck({kind:"includes",value:e,position:n==null?void 0:n.position,...be.errToObj(n==null?void 0:n.message)})}startsWith(e,n){return this._addCheck({kind:"startsWith",value:e,...be.errToObj(n)})}endsWith(e,n){return this._addCheck({kind:"endsWith",value:e,...be.errToObj(n)})}min(e,n){return this._addCheck({kind:"min",value:e,...be.errToObj(n)})}max(e,n){return this._addCheck({kind:"max",value:e,...be.errToObj(n)})}length(e,n){return this._addCheck({kind:"length",value:e,...be.errToObj(n)})}nonempty(e){return this.min(1,be.errToObj(e))}trim(){return new Pa({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Pa({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Pa({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxLength(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}Pa.create=t=>new Pa({checks:[],typeName:Le.ZodString,coerce:(t==null?void 0:t.coerce)??!1,...$e(t)});function wk(t,e){const n=(t.toString().split(".")[1]||"").length,s=(e.toString().split(".")[1]||"").length,i=n>s?n:s,o=Number.parseInt(t.toFixed(i).replace(".","")),u=Number.parseInt(e.toFixed(i).replace(".",""));return o%u/10**i}class Mi extends Ke{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==we.number){const o=this._getOrReturnCtx(e);return ve(o,{code:me.invalid_type,expected:we.number,received:o.parsedType}),ke}let s;const i=new Mn;for(const o of this._def.checks)o.kind==="int"?We.isInteger(e.data)||(s=this._getOrReturnCtx(e,s),ve(s,{code:me.invalid_type,expected:"integer",received:"float",message:o.message}),i.dirty()):o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(s=this._getOrReturnCtx(e,s),ve(s,{code:me.too_small,minimum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),i.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(s=this._getOrReturnCtx(e,s),ve(s,{code:me.too_big,maximum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),i.dirty()):o.kind==="multipleOf"?wk(e.data,o.value)!==0&&(s=this._getOrReturnCtx(e,s),ve(s,{code:me.not_multiple_of,multipleOf:o.value,message:o.message}),i.dirty()):o.kind==="finite"?Number.isFinite(e.data)||(s=this._getOrReturnCtx(e,s),ve(s,{code:me.not_finite,message:o.message}),i.dirty()):We.assertNever(o);return{status:i.value,value:e.data}}gte(e,n){return this.setLimit("min",e,!0,be.toString(n))}gt(e,n){return this.setLimit("min",e,!1,be.toString(n))}lte(e,n){return this.setLimit("max",e,!0,be.toString(n))}lt(e,n){return this.setLimit("max",e,!1,be.toString(n))}setLimit(e,n,s,i){return new Mi({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:s,message:be.toString(i)}]})}_addCheck(e){return new Mi({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:be.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:be.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:be.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:be.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:be.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:be.toString(n)})}finite(e){return this._addCheck({kind:"finite",message:be.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:be.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:be.toString(e)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&We.isInteger(e.value))}get isFinite(){let e=null,n=null;for(const s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(n===null||s.value>n)&&(n=s.value):s.kind==="max"&&(e===null||s.value<e)&&(e=s.value)}return Number.isFinite(n)&&Number.isFinite(e)}}Mi.create=t=>new Mi({checks:[],typeName:Le.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...$e(t)});class tl extends Ke{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==we.bigint)return this._getInvalidInput(e);let s;const i=new Mn;for(const o of this._def.checks)o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(s=this._getOrReturnCtx(e,s),ve(s,{code:me.too_small,type:"bigint",minimum:o.value,inclusive:o.inclusive,message:o.message}),i.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(s=this._getOrReturnCtx(e,s),ve(s,{code:me.too_big,type:"bigint",maximum:o.value,inclusive:o.inclusive,message:o.message}),i.dirty()):o.kind==="multipleOf"?e.data%o.value!==BigInt(0)&&(s=this._getOrReturnCtx(e,s),ve(s,{code:me.not_multiple_of,multipleOf:o.value,message:o.message}),i.dirty()):We.assertNever(o);return{status:i.value,value:e.data}}_getInvalidInput(e){const n=this._getOrReturnCtx(e);return ve(n,{code:me.invalid_type,expected:we.bigint,received:n.parsedType}),ke}gte(e,n){return this.setLimit("min",e,!0,be.toString(n))}gt(e,n){return this.setLimit("min",e,!1,be.toString(n))}lte(e,n){return this.setLimit("max",e,!0,be.toString(n))}lt(e,n){return this.setLimit("max",e,!1,be.toString(n))}setLimit(e,n,s,i){return new tl({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:s,message:be.toString(i)}]})}_addCheck(e){return new tl({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:be.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:be.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:be.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:be.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:be.toString(n)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}tl.create=t=>new tl({checks:[],typeName:Le.ZodBigInt,coerce:(t==null?void 0:t.coerce)??!1,...$e(t)});class yp extends Ke{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==we.boolean){const s=this._getOrReturnCtx(e);return ve(s,{code:me.invalid_type,expected:we.boolean,received:s.parsedType}),ke}return Yn(e.data)}}yp.create=t=>new yp({typeName:Le.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...$e(t)});class Sc extends Ke{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==we.date){const o=this._getOrReturnCtx(e);return ve(o,{code:me.invalid_type,expected:we.date,received:o.parsedType}),ke}if(Number.isNaN(e.data.getTime())){const o=this._getOrReturnCtx(e);return ve(o,{code:me.invalid_date}),ke}const s=new Mn;let i;for(const o of this._def.checks)o.kind==="min"?e.data.getTime()<o.value&&(i=this._getOrReturnCtx(e,i),ve(i,{code:me.too_small,message:o.message,inclusive:!0,exact:!1,minimum:o.value,type:"date"}),s.dirty()):o.kind==="max"?e.data.getTime()>o.value&&(i=this._getOrReturnCtx(e,i),ve(i,{code:me.too_big,message:o.message,inclusive:!0,exact:!1,maximum:o.value,type:"date"}),s.dirty()):We.assertNever(o);return{status:s.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Sc({...this._def,checks:[...this._def.checks,e]})}min(e,n){return this._addCheck({kind:"min",value:e.getTime(),message:be.toString(n)})}max(e,n){return this._addCheck({kind:"max",value:e.getTime(),message:be.toString(n)})}get minDate(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e!=null?new Date(e):null}}Sc.create=t=>new Sc({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:Le.ZodDate,...$e(t)});class QS extends Ke{_parse(e){if(this._getType(e)!==we.symbol){const s=this._getOrReturnCtx(e);return ve(s,{code:me.invalid_type,expected:we.symbol,received:s.parsedType}),ke}return Yn(e.data)}}QS.create=t=>new QS({typeName:Le.ZodSymbol,...$e(t)});class ew extends Ke{_parse(e){if(this._getType(e)!==we.undefined){const s=this._getOrReturnCtx(e);return ve(s,{code:me.invalid_type,expected:we.undefined,received:s.parsedType}),ke}return Yn(e.data)}}ew.create=t=>new ew({typeName:Le.ZodUndefined,...$e(t)});class tw extends Ke{_parse(e){if(this._getType(e)!==we.null){const s=this._getOrReturnCtx(e);return ve(s,{code:me.invalid_type,expected:we.null,received:s.parsedType}),ke}return Yn(e.data)}}tw.create=t=>new tw({typeName:Le.ZodNull,...$e(t)});class nw extends Ke{constructor(){super(...arguments),this._any=!0}_parse(e){return Yn(e.data)}}nw.create=t=>new nw({typeName:Le.ZodAny,...$e(t)});class sw extends Ke{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Yn(e.data)}}sw.create=t=>new sw({typeName:Le.ZodUnknown,...$e(t)});class Ba extends Ke{_parse(e){const n=this._getOrReturnCtx(e);return ve(n,{code:me.invalid_type,expected:we.never,received:n.parsedType}),ke}}Ba.create=t=>new Ba({typeName:Le.ZodNever,...$e(t)});class aw extends Ke{_parse(e){if(this._getType(e)!==we.undefined){const s=this._getOrReturnCtx(e);return ve(s,{code:me.invalid_type,expected:we.void,received:s.parsedType}),ke}return Yn(e.data)}}aw.create=t=>new aw({typeName:Le.ZodVoid,...$e(t)});class gs extends Ke{_parse(e){const{ctx:n,status:s}=this._processInputParams(e),i=this._def;if(n.parsedType!==we.array)return ve(n,{code:me.invalid_type,expected:we.array,received:n.parsedType}),ke;if(i.exactLength!==null){const u=n.data.length>i.exactLength.value,d=n.data.length<i.exactLength.value;(u||d)&&(ve(n,{code:u?me.too_big:me.too_small,minimum:d?i.exactLength.value:void 0,maximum:u?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),s.dirty())}if(i.minLength!==null&&n.data.length<i.minLength.value&&(ve(n,{code:me.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),s.dirty()),i.maxLength!==null&&n.data.length>i.maxLength.value&&(ve(n,{code:me.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),s.dirty()),n.common.async)return Promise.all([...n.data].map((u,d)=>i.type._parseAsync(new Oa(n,u,n.path,d)))).then(u=>Mn.mergeArray(s,u));const o=[...n.data].map((u,d)=>i.type._parseSync(new Oa(n,u,n.path,d)));return Mn.mergeArray(s,o)}get element(){return this._def.type}min(e,n){return new gs({...this._def,minLength:{value:e,message:be.toString(n)}})}max(e,n){return new gs({...this._def,maxLength:{value:e,message:be.toString(n)}})}length(e,n){return new gs({...this._def,exactLength:{value:e,message:be.toString(n)}})}nonempty(e){return this.min(1,e)}}gs.create=(t,e)=>new gs({type:t,minLength:null,maxLength:null,exactLength:null,typeName:Le.ZodArray,...$e(e)});function mi(t){if(t instanceof Bt){const e={};for(const n in t.shape){const s=t.shape[n];e[n]=Ua.create(mi(s))}return new Bt({...t._def,shape:()=>e})}else return t instanceof gs?new gs({...t._def,type:mi(t.element)}):t instanceof Ua?Ua.create(mi(t.unwrap())):t instanceof Pi?Pi.create(mi(t.unwrap())):t instanceof xr?xr.create(t.items.map(e=>mi(e))):t}class Bt extends Ke{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),n=We.objectKeys(e);return this._cached={shape:e,keys:n},this._cached}_parse(e){if(this._getType(e)!==we.object){const m=this._getOrReturnCtx(e);return ve(m,{code:me.invalid_type,expected:we.object,received:m.parsedType}),ke}const{status:s,ctx:i}=this._processInputParams(e),{shape:o,keys:u}=this._getCached(),d=[];if(!(this._def.catchall instanceof Ba&&this._def.unknownKeys==="strip"))for(const m in i.data)u.includes(m)||d.push(m);const p=[];for(const m of u){const v=o[m],S=i.data[m];p.push({key:{status:"valid",value:m},value:v._parse(new Oa(i,S,i.path,m)),alwaysSet:m in i.data})}if(this._def.catchall instanceof Ba){const m=this._def.unknownKeys;if(m==="passthrough")for(const v of d)p.push({key:{status:"valid",value:v},value:{status:"valid",value:i.data[v]}});else if(m==="strict")d.length>0&&(ve(i,{code:me.unrecognized_keys,keys:d}),s.dirty());else if(m!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const m=this._def.catchall;for(const v of d){const S=i.data[v];p.push({key:{status:"valid",value:v},value:m._parse(new Oa(i,S,i.path,v)),alwaysSet:v in i.data})}}return i.common.async?Promise.resolve().then(async()=>{const m=[];for(const v of p){const S=await v.key,w=await v.value;m.push({key:S,value:w,alwaysSet:v.alwaysSet})}return m}).then(m=>Mn.mergeObjectSync(s,m)):Mn.mergeObjectSync(s,p)}get shape(){return this._def.shape()}strict(e){return be.errToObj,new Bt({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(n,s)=>{var o,u;const i=((u=(o=this._def).errorMap)==null?void 0:u.call(o,n,s).message)??s.defaultError;return n.code==="unrecognized_keys"?{message:be.errToObj(e).message??i}:{message:i}}}:{}})}strip(){return new Bt({...this._def,unknownKeys:"strip"})}passthrough(){return new Bt({...this._def,unknownKeys:"passthrough"})}extend(e){return new Bt({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Bt({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Le.ZodObject})}setKey(e,n){return this.augment({[e]:n})}catchall(e){return new Bt({...this._def,catchall:e})}pick(e){const n={};for(const s of We.objectKeys(e))e[s]&&this.shape[s]&&(n[s]=this.shape[s]);return new Bt({...this._def,shape:()=>n})}omit(e){const n={};for(const s of We.objectKeys(this.shape))e[s]||(n[s]=this.shape[s]);return new Bt({...this._def,shape:()=>n})}deepPartial(){return mi(this)}partial(e){const n={};for(const s of We.objectKeys(this.shape)){const i=this.shape[s];e&&!e[s]?n[s]=i:n[s]=i.optional()}return new Bt({...this._def,shape:()=>n})}required(e){const n={};for(const s of We.objectKeys(this.shape))if(e&&!e[s])n[s]=this.shape[s];else{let o=this.shape[s];for(;o instanceof Ua;)o=o._def.innerType;n[s]=o}return new Bt({...this._def,shape:()=>n})}keyof(){return _C(We.objectKeys(this.shape))}}Bt.create=(t,e)=>new Bt({shape:()=>t,unknownKeys:"strip",catchall:Ba.create(),typeName:Le.ZodObject,...$e(e)});Bt.strictCreate=(t,e)=>new Bt({shape:()=>t,unknownKeys:"strict",catchall:Ba.create(),typeName:Le.ZodObject,...$e(e)});Bt.lazycreate=(t,e)=>new Bt({shape:t,unknownKeys:"strip",catchall:Ba.create(),typeName:Le.ZodObject,...$e(e)});class wc extends Ke{_parse(e){const{ctx:n}=this._processInputParams(e),s=this._def.options;function i(o){for(const d of o)if(d.result.status==="valid")return d.result;for(const d of o)if(d.result.status==="dirty")return n.common.issues.push(...d.ctx.common.issues),d.result;const u=o.map(d=>new Js(d.ctx.common.issues));return ve(n,{code:me.invalid_union,unionErrors:u}),ke}if(n.common.async)return Promise.all(s.map(async o=>{const u={...n,common:{...n.common,issues:[]},parent:null};return{result:await o._parseAsync({data:n.data,path:n.path,parent:u}),ctx:u}})).then(i);{let o;const u=[];for(const p of s){const m={...n,common:{...n.common,issues:[]},parent:null},v=p._parseSync({data:n.data,path:n.path,parent:m});if(v.status==="valid")return v;v.status==="dirty"&&!o&&(o={result:v,ctx:m}),m.common.issues.length&&u.push(m.common.issues)}if(o)return n.common.issues.push(...o.ctx.common.issues),o.result;const d=u.map(p=>new Js(p));return ve(n,{code:me.invalid_union,unionErrors:d}),ke}}get options(){return this._def.options}}wc.create=(t,e)=>new wc({options:t,typeName:Le.ZodUnion,...$e(e)});function vp(t,e){const n=Da(t),s=Da(e);if(t===e)return{valid:!0,data:t};if(n===we.object&&s===we.object){const i=We.objectKeys(e),o=We.objectKeys(t).filter(d=>i.indexOf(d)!==-1),u={...t,...e};for(const d of o){const p=vp(t[d],e[d]);if(!p.valid)return{valid:!1};u[d]=p.data}return{valid:!0,data:u}}else if(n===we.array&&s===we.array){if(t.length!==e.length)return{valid:!1};const i=[];for(let o=0;o<t.length;o++){const u=t[o],d=e[o],p=vp(u,d);if(!p.valid)return{valid:!1};i.push(p.data)}return{valid:!0,data:i}}else return n===we.date&&s===we.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}class _c extends Ke{_parse(e){const{status:n,ctx:s}=this._processInputParams(e),i=(o,u)=>{if(ZS(o)||ZS(u))return ke;const d=vp(o.value,u.value);return d.valid?((XS(o)||XS(u))&&n.dirty(),{status:n.value,value:d.data}):(ve(s,{code:me.invalid_intersection_types}),ke)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([o,u])=>i(o,u)):i(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}}_c.create=(t,e,n)=>new _c({left:t,right:e,typeName:Le.ZodIntersection,...$e(n)});class xr extends Ke{_parse(e){const{status:n,ctx:s}=this._processInputParams(e);if(s.parsedType!==we.array)return ve(s,{code:me.invalid_type,expected:we.array,received:s.parsedType}),ke;if(s.data.length<this._def.items.length)return ve(s,{code:me.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ke;!this._def.rest&&s.data.length>this._def.items.length&&(ve(s,{code:me.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const o=[...s.data].map((u,d)=>{const p=this._def.items[d]||this._def.rest;return p?p._parse(new Oa(s,u,s.path,d)):null}).filter(u=>!!u);return s.common.async?Promise.all(o).then(u=>Mn.mergeArray(n,u)):Mn.mergeArray(n,o)}get items(){return this._def.items}rest(e){return new xr({...this._def,rest:e})}}xr.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new xr({items:t,typeName:Le.ZodTuple,rest:null,...$e(e)})};class rw extends Ke{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:s}=this._processInputParams(e);if(s.parsedType!==we.map)return ve(s,{code:me.invalid_type,expected:we.map,received:s.parsedType}),ke;const i=this._def.keyType,o=this._def.valueType,u=[...s.data.entries()].map(([d,p],m)=>({key:i._parse(new Oa(s,d,s.path,[m,"key"])),value:o._parse(new Oa(s,p,s.path,[m,"value"]))}));if(s.common.async){const d=new Map;return Promise.resolve().then(async()=>{for(const p of u){const m=await p.key,v=await p.value;if(m.status==="aborted"||v.status==="aborted")return ke;(m.status==="dirty"||v.status==="dirty")&&n.dirty(),d.set(m.value,v.value)}return{status:n.value,value:d}})}else{const d=new Map;for(const p of u){const m=p.key,v=p.value;if(m.status==="aborted"||v.status==="aborted")return ke;(m.status==="dirty"||v.status==="dirty")&&n.dirty(),d.set(m.value,v.value)}return{status:n.value,value:d}}}}rw.create=(t,e,n)=>new rw({valueType:e,keyType:t,typeName:Le.ZodMap,...$e(n)});class nl extends Ke{_parse(e){const{status:n,ctx:s}=this._processInputParams(e);if(s.parsedType!==we.set)return ve(s,{code:me.invalid_type,expected:we.set,received:s.parsedType}),ke;const i=this._def;i.minSize!==null&&s.data.size<i.minSize.value&&(ve(s,{code:me.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),n.dirty()),i.maxSize!==null&&s.data.size>i.maxSize.value&&(ve(s,{code:me.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),n.dirty());const o=this._def.valueType;function u(p){const m=new Set;for(const v of p){if(v.status==="aborted")return ke;v.status==="dirty"&&n.dirty(),m.add(v.value)}return{status:n.value,value:m}}const d=[...s.data.values()].map((p,m)=>o._parse(new Oa(s,p,s.path,m)));return s.common.async?Promise.all(d).then(p=>u(p)):u(d)}min(e,n){return new nl({...this._def,minSize:{value:e,message:be.toString(n)}})}max(e,n){return new nl({...this._def,maxSize:{value:e,message:be.toString(n)}})}size(e,n){return this.min(e,n).max(e,n)}nonempty(e){return this.min(1,e)}}nl.create=(t,e)=>new nl({valueType:t,minSize:null,maxSize:null,typeName:Le.ZodSet,...$e(e)});class iw extends Ke{get schema(){return this._def.getter()}_parse(e){const{ctx:n}=this._processInputParams(e);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}iw.create=(t,e)=>new iw({getter:t,typeName:Le.ZodLazy,...$e(e)});class ow extends Ke{_parse(e){if(e.data!==this._def.value){const n=this._getOrReturnCtx(e);return ve(n,{received:n.data,code:me.invalid_literal,expected:this._def.value}),ke}return{status:"valid",value:e.data}}get value(){return this._def.value}}ow.create=(t,e)=>new ow({value:t,typeName:Le.ZodLiteral,...$e(e)});function _C(t,e){return new Ii({values:t,typeName:Le.ZodEnum,...$e(e)})}class Ii extends Ke{_parse(e){if(typeof e.data!="string"){const n=this._getOrReturnCtx(e),s=this._def.values;return ve(n,{expected:We.joinValues(s),received:n.parsedType,code:me.invalid_type}),ke}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const n=this._getOrReturnCtx(e),s=this._def.values;return ve(n,{received:n.data,code:me.invalid_enum_value,options:s}),ke}return Yn(e.data)}get options(){return this._def.values}get enum(){const e={};for(const n of this._def.values)e[n]=n;return e}get Values(){const e={};for(const n of this._def.values)e[n]=n;return e}get Enum(){const e={};for(const n of this._def.values)e[n]=n;return e}extract(e,n=this._def){return Ii.create(e,{...this._def,...n})}exclude(e,n=this._def){return Ii.create(this.options.filter(s=>!e.includes(s)),{...this._def,...n})}}Ii.create=_C;class lw extends Ke{_parse(e){const n=We.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==we.string&&s.parsedType!==we.number){const i=We.objectValues(n);return ve(s,{expected:We.joinValues(i),received:s.parsedType,code:me.invalid_type}),ke}if(this._cache||(this._cache=new Set(We.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const i=We.objectValues(n);return ve(s,{received:s.data,code:me.invalid_enum_value,options:i}),ke}return Yn(e.data)}get enum(){return this._def.values}}lw.create=(t,e)=>new lw({values:t,typeName:Le.ZodNativeEnum,...$e(e)});class bc extends Ke{unwrap(){return this._def.type}_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==we.promise&&n.common.async===!1)return ve(n,{code:me.invalid_type,expected:we.promise,received:n.parsedType}),ke;const s=n.parsedType===we.promise?n.data:Promise.resolve(n.data);return Yn(s.then(i=>this._def.type.parseAsync(i,{path:n.path,errorMap:n.common.contextualErrorMap})))}}bc.create=(t,e)=>new bc({type:t,typeName:Le.ZodPromise,...$e(e)});class Di extends Ke{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Le.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:n,ctx:s}=this._processInputParams(e),i=this._def.effect||null,o={addIssue:u=>{ve(s,u),u.fatal?n.abort():n.dirty()},get path(){return s.path}};if(o.addIssue=o.addIssue.bind(o),i.type==="preprocess"){const u=i.transform(s.data,o);if(s.common.async)return Promise.resolve(u).then(async d=>{if(n.value==="aborted")return ke;const p=await this._def.schema._parseAsync({data:d,path:s.path,parent:s});return p.status==="aborted"?ke:p.status==="dirty"||n.value==="dirty"?zo(p.value):p});{if(n.value==="aborted")return ke;const d=this._def.schema._parseSync({data:u,path:s.path,parent:s});return d.status==="aborted"?ke:d.status==="dirty"||n.value==="dirty"?zo(d.value):d}}if(i.type==="refinement"){const u=d=>{const p=i.refinement(d,o);if(s.common.async)return Promise.resolve(p);if(p instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return d};if(s.common.async===!1){const d=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return d.status==="aborted"?ke:(d.status==="dirty"&&n.dirty(),u(d.value),{status:n.value,value:d.value})}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(d=>d.status==="aborted"?ke:(d.status==="dirty"&&n.dirty(),u(d.value).then(()=>({status:n.value,value:d.value}))))}if(i.type==="transform")if(s.common.async===!1){const u=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!Ni(u))return ke;const d=i.transform(u.value,o);if(d instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:d}}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(u=>Ni(u)?Promise.resolve(i.transform(u.value,o)).then(d=>({status:n.value,value:d})):ke);We.assertNever(i)}}Di.create=(t,e,n)=>new Di({schema:t,typeName:Le.ZodEffects,effect:e,...$e(n)});Di.createWithPreprocess=(t,e,n)=>new Di({schema:e,effect:{type:"preprocess",transform:t},typeName:Le.ZodEffects,...$e(n)});class Ua extends Ke{_parse(e){return this._getType(e)===we.undefined?Yn(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ua.create=(t,e)=>new Ua({innerType:t,typeName:Le.ZodOptional,...$e(e)});class Pi extends Ke{_parse(e){return this._getType(e)===we.null?Yn(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Pi.create=(t,e)=>new Pi({innerType:t,typeName:Le.ZodNullable,...$e(e)});class xp extends Ke{_parse(e){const{ctx:n}=this._processInputParams(e);let s=n.data;return n.parsedType===we.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:n.path,parent:n})}removeDefault(){return this._def.innerType}}xp.create=(t,e)=>new xp({innerType:t,typeName:Le.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...$e(e)});class Sp extends Ke{_parse(e){const{ctx:n}=this._processInputParams(e),s={...n,common:{...n.common,issues:[]}},i=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return xc(i)?i.then(o=>({status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new Js(s.common.issues)},input:s.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Js(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}}Sp.create=(t,e)=>new Sp({innerType:t,typeName:Le.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...$e(e)});class uw extends Ke{_parse(e){if(this._getType(e)!==we.nan){const s=this._getOrReturnCtx(e);return ve(s,{code:me.invalid_type,expected:we.nan,received:s.parsedType}),ke}return{status:"valid",value:e.data}}}uw.create=t=>new uw({typeName:Le.ZodNaN,...$e(t)});class _k extends Ke{_parse(e){const{ctx:n}=this._processInputParams(e),s=n.data;return this._def.type._parse({data:s,path:n.path,parent:n})}unwrap(){return this._def.type}}class Nh extends Ke{_parse(e){const{status:n,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{const o=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return o.status==="aborted"?ke:o.status==="dirty"?(n.dirty(),zo(o.value)):this._def.out._parseAsync({data:o.value,path:s.path,parent:s})})();{const i=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return i.status==="aborted"?ke:i.status==="dirty"?(n.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:s.path,parent:s})}}static create(e,n){return new Nh({in:e,out:n,typeName:Le.ZodPipeline})}}class wp extends Ke{_parse(e){const n=this._def.innerType._parse(e),s=i=>(Ni(i)&&(i.value=Object.freeze(i.value)),i);return xc(n)?n.then(i=>s(i)):s(n)}unwrap(){return this._def.innerType}}wp.create=(t,e)=>new wp({innerType:t,typeName:Le.ZodReadonly,...$e(e)});var Le;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(Le||(Le={}));const ms=Pa.create,Ko=Mi.create,_p=yp.create;Ba.create;const bp=gs.create,Mh=Bt.create,cw=wc.create;_c.create;xr.create;const Cc=Ii.create;bc.create;Ua.create;Pi.create;const bk=["aggregate","profile","clean","detect_anomaly","remove_card","save_view","ask_clarify"],Ck=["csv.aggregate","csv.profile","csv.clean_invoice_month","csv.detect_outliers","ui.remove_card","idb.save_view"],Tk={aggregate:["csv.aggregate"],profile:["csv.profile"],clean:["csv.clean_invoice_month"],detect_anomaly:["csv.detect_outliers"],remove_card:["ui.remove_card"],save_view:["idb.save_view"],ask_clarify:[]},Ak=Cc(["=","!=",">",">=","<","<=","in","contains"]),Ek=Mh({column:ms().min(1,"Filter column is required."),op:Ak.default("="),value:cw([ms(),Ko(),_p(),bp(cw([ms(),Ko(),_p()])).nonempty()])}).strict(),Rk=Mh({datasetId:ms().min(1).optional().nullable(),column:ms().min(1).optional(),valueColumn:ms().min(1).optional(),groupBy:bp(ms().min(1)).default([]),aggregation:Cc(["sum","avg","count","min","max"]).default("sum"),filters:bp(Ek).default([]),limit:Ko().int().positive().optional(),topN:Ko().int().positive().optional(),thresholdMultiplier:Ko().positive().optional(),viewTitle:ms().min(1).optional(),cardId:ms().min(1).optional()}).strict(),bC=Mh({intent:Cc(bk),tool:Cc(Ck).nullable().default(null),args:Rk.default({}),awaitUser:_p().default(!1),message:ms().max(280).optional().nullable()}).superRefine((t,e)=>{const n=Tk[t.intent]??[];n.length===0?t.tool!==null&&e.addIssue({code:me.custom,message:`Intent "${t.intent}" should not specify a tool.`,path:["tool"]}):(!t.tool||!n.includes(t.tool))&&e.addIssue({code:me.custom,message:`Tool "${t.tool}" is not allowed for intent "${t.intent}".`,path:["tool"]}),t.intent==="ask_clarify"&&!t.awaitUser&&e.addIssue({code:me.custom,message:"ask_clarify intent must set awaitUser=true.",path:["awaitUser"]})}),Nk=t=>{const e={awaitUser:!1,args:{groupBy:[],aggregation:"sum",filters:[]},...t},n=bC.safeParse(e);if(!n.success)throw n.error;return n.data},Hc=t=>{const e={...t};if(Array.isArray(e.enum))return e.enum.includes(null)||(e.enum=[...e.enum,null]),e;const n=e.type;return Array.isArray(n)?n.includes("null")||(e.type=[...n,"null"]):n?e.type=[n,"null"]:e.type=["null"],e},pl=(t,e)=>{const n={...t};return e.forEach(s=>{if(!n[s])throw new Error(`Attempted to mark missing property "${s}" as nullable.`);n[s]=Hc(n[s])}),n},CC={type:Z.OBJECT,properties:{chartType:{type:Z.STRING,enum:["bar","line","pie","doughnut","scatter","combo"],description:"Type of chart to generate."},title:{type:Z.STRING,description:"A concise title for the analysis."},description:{type:Z.STRING,minLength:8,description:"A brief explanation of what the analysis shows. Must be a full sentence with at least 8 characters."},aggregation:{type:Z.STRING,enum:["sum","count","avg"],description:"The aggregation function to apply. Omit for scatter plots."},groupByColumn:{type:Z.STRING,description:"The column to group data by (categorical). Omit for scatter plots."},valueColumn:{type:Z.STRING,description:'The column for aggregation (numerical). Not needed for "count".'},xValueColumn:{type:Z.STRING,description:"The column for the X-axis of a scatter plot (numerical). Required for scatter plots."},yValueColumn:{type:Z.STRING,description:"The column for the Y-axis of a scatter plot (numerical). Required for scatter plots."},secondaryValueColumn:{type:Z.STRING,description:"For combo charts, the secondary column for aggregation (numerical)."},secondaryAggregation:{type:Z.STRING,enum:["sum","count","avg"],description:"For combo charts, the aggregation for the secondary value column."},defaultTopN:{type:Z.INTEGER,description:"Optional. If the analysis has many categories, this suggests a default Top N view (e.g., 8)."},defaultHideOthers:{type:Z.BOOLEAN,description:'Optional. If using defaultTopN, suggests whether to hide the "Others" category by default.'},orderBy:{type:Z.ARRAY,description:"Optional ordering instructions applied before limiting rows.",items:{type:Z.OBJECT,properties:{column:{type:Z.STRING,description:"Column to sort by (group or metric alias)."},direction:{type:Z.STRING,enum:["asc","desc"],description:"Sort direction (default desc)."}},required:["column","direction"],additionalProperties:!1}},limit:{type:Z.INTEGER,description:"Optional limit applied after sorting (e.g., Top N rows)."},rowFilter:{type:Z.OBJECT,description:"Optional row-level filter to limit rows before aggregation (e.g., single customer or region).",properties:{column:{type:Z.STRING,description:"Column to filter on. Must be categorical."},values:{type:Z.ARRAY,minItems:1,description:"Exact values to keep (case-sensitive, as they appear in the dataset).",items:{type:Z.STRING}}},required:["column","values"],additionalProperties:!1}},required:["chartType","title","description","aggregation","groupByColumn","valueColumn","xValueColumn","yValueColumn","secondaryValueColumn","secondaryAggregation","defaultTopN","defaultHideOthers","orderBy","limit","rowFilter"],additionalProperties:!1},Ih={type:Z.OBJECT,properties:{plans:{type:Z.ARRAY,description:"Array of analysis plans to execute.",items:CC}},required:["plans"],additionalProperties:!1},Mk={type:Z.OBJECT,properties:{name:{type:Z.STRING,description:"The column name."},type:{type:Z.STRING,enum:["numerical","categorical","date","time","currency","percentage"],description:"The data type of the column. Identify specific types like 'date', 'currency', etc., where possible."}},required:["name","type"],additionalProperties:!1},TC={type:Z.OBJECT,properties:{explanation:{type:Z.STRING,description:"A brief, user-facing explanation of the transformations that will be applied to the data (e.g., 'Removed 3 summary rows and reshaped the data from a cross-tab format')."},jsFunctionBody:Hc({type:Z.STRING,description:"The body of a JavaScript function that takes two arguments `data` (an array of objects) and `_util` (a helper object) and returns the transformed array of objects. This code will be executed to clean and reshape the data."}),outputColumns:{type:Z.ARRAY,description:"A list of column profiles describing the structure of the data AFTER the transformation. If no transformation is performed, this should be the same as the input column profiles.",items:Mk}},required:["explanation","jsFunctionBody","outputColumns"],additionalProperties:!1},AC={type:Z.OBJECT,properties:{explanation:{type:Z.STRING,description:"A brief, user-facing explanation of the filter that was created from the natural language query."},jsFunctionBody:{type:Z.STRING,description:"The body of a JavaScript function that takes 'data' and '_util' as arguments and returns a filtered array of objects. It should be a single line starting with 'return data.filter(...);'."}},required:["explanation","jsFunctionBody"],additionalProperties:!1},EC={type:Z.OBJECT,properties:{insight:{type:Z.STRING,description:"A concise, user-facing message describing the single most important finding."},cardId:{type:Z.STRING,description:"The ID of the card where this insight was observed."}},required:["insight","cardId"],additionalProperties:!1},Ik=CC,RC={chartType:{type:Z.STRING,enum:["bar","line","pie","doughnut","scatter","combo"]},title:{type:Z.STRING},description:{type:Z.STRING},aggregation:{type:Z.STRING,enum:["sum","count","avg"]},groupByColumn:{type:Z.STRING},valueColumn:{type:Z.STRING},xValueColumn:{type:Z.STRING},yValueColumn:{type:Z.STRING},secondaryValueColumn:{type:Z.STRING},secondaryAggregation:{type:Z.STRING,enum:["sum","count","avg"]},defaultTopN:{type:Z.INTEGER},defaultHideOthers:{type:Z.BOOLEAN},orderBy:{type:Z.ARRAY,items:{type:Z.OBJECT,properties:{column:{type:Z.STRING},direction:{type:Z.STRING,enum:["asc","desc"]}},required:["column","direction"],additionalProperties:!1}},limit:{type:Z.INTEGER},rowFilter:{type:Z.OBJECT,properties:{column:{type:Z.STRING},values:{type:Z.ARRAY,items:{type:Z.STRING}}},additionalProperties:!1,required:["column","values"]}},dw=Object.keys(RC),Dk={type:Z.OBJECT,properties:{question:{type:Z.STRING,description:"The clear, user-facing question to ask for clarification."},options:{type:Z.ARRAY,items:{type:Z.OBJECT,properties:{label:{type:Z.STRING,description:"The user-friendly text for the option button."},value:{type:Z.STRING,description:"The exact column name (case-sensitive) or literal value that should be assigned to the plan when this option is selected. Do not invent new names."}},required:["label","value"],additionalProperties:!1}},pendingPlan:{type:Z.OBJECT,description:"The partial analysis plan that is waiting for the user's input. It should contain all known parameters.",properties:pl(RC,dw),required:dw,additionalProperties:!1},targetProperty:{type:Z.STRING,description:"The name of the property in the 'pendingPlan' that the user's selected value should be assigned to."},reasonHint:Hc({type:Z.STRING,description:"Optional short explanation describing why the clarification is required."})},required:["question","options","pendingPlan","targetProperty"],additionalProperties:!1},Pk={type:Z.OBJECT,description:"Declarative representation of a pending plan step.",properties:{id:{type:Z.STRING,minLength:3,description:"Stable identifier (kebab-case recommended) used to reference this step in future actions."},label:{type:Z.STRING,minLength:4,description:"Human-readable summary of the step."}},required:["id","label"],additionalProperties:!1},kk={goal:{type:Z.STRING,minLength:6},contextSummary:{type:Z.STRING},progress:{type:Z.STRING,minLength:6},nextSteps:{type:Z.ARRAY,minItems:1,items:Pk},planId:{type:Z.STRING},blockedBy:{type:Z.STRING},observationIds:{type:Z.ARRAY,items:{type:Z.STRING}},confidence:{type:Z.NUMBER,minimum:0,maximum:1},updatedAt:{type:Z.STRING},currentStepId:{type:Z.STRING},steps:{type:Z.ARRAY,minItems:1,items:{type:Z.OBJECT,properties:{id:{type:Z.STRING},label:{type:Z.STRING},intent:{type:Z.STRING},status:{type:Z.STRING,enum:["ready","in_progress","done","waiting_user"]}},required:["id","label","intent","status"],additionalProperties:!1}},stateTag:{type:Z.STRING}},Lk={type:Z.OBJECT,properties:pl(kk,["contextSummary","planId","blockedBy","confidence"]),required:["goal","contextSummary","progress","nextSteps","planId","blockedBy","observationIds","confidence","updatedAt","currentStepId","steps","stateTag"],additionalProperties:!1},Uk={type:Z.OBJECT,properties:{awaitUser:{type:Z.BOOLEAN},haltAfter:{type:Z.BOOLEAN},resumePlanner:{type:Z.BOOLEAN},promptId:{type:Z.STRING}},required:["awaitUser","haltAfter","resumePlanner","promptId"],additionalProperties:!1},Ok={type:Z.OBJECT,properties:{id:{type:Z.STRING},label:{type:Z.STRING}},required:["id","label"],additionalProperties:!1},Bk={type:Z.OBJECT,properties:{promptId:{type:Z.STRING},question:{type:Z.STRING},options:{type:Z.ARRAY,minItems:1,items:Ok},allowFreeText:{type:Z.BOOLEAN},placeholder:{type:Z.STRING}},required:["promptId","question","options","allowFreeText","placeholder"],additionalProperties:!1},Em={byId:{type:Z.STRING},byTitle:{type:Z.STRING},selector:{type:Z.STRING}},Vk={type:Z.OBJECT,properties:pl(Em,Object.keys(Em)),required:Object.keys(Em),additionalProperties:!1},Rm={cardId:{type:Z.STRING},cardTitle:{type:Z.STRING},newType:{type:Z.STRING,enum:["bar","line","pie","doughnut","scatter","combo"]},visible:{type:Z.BOOLEAN},column:{type:Z.STRING},values:{type:Z.ARRAY,items:{type:Z.STRING}},topN:{type:Z.INTEGER},hide:{type:Z.BOOLEAN},label:{type:Z.STRING},format:{type:Z.STRING,enum:["png","csv","html"]}},qk={type:Z.OBJECT,properties:pl(Rm,Object.keys(Rm)),required:Object.keys(Rm),additionalProperties:!1},Fk={type:Z.OBJECT,properties:{toolName:{type:Z.STRING,enum:["highlightCard","changeCardChartType","showCardData","filterCard","setTopN","toggleHideOthers","toggleLegendLabel","exportCard","removeCard"]},target:Vk,args:qk},required:["toolName","target","args"],additionalProperties:!1},$k={type:Z.OBJECT,properties:{explanation:{type:Z.STRING},jsFunctionBody:{type:Z.STRING,minLength:10}},required:["explanation","jsFunctionBody"],additionalProperties:!1},Gk={type:Z.OBJECT,properties:{query:{type:Z.STRING}},required:["query"],additionalProperties:!1},Hk=["plan_state_update","text_response","await_user","plan_creation","dom_action","execute_js_code","proceed_to_analysis","filter_spreadsheet","clarification_request"],zk=["intentContract","meta","planState","text","cardId","awaitUserPayload","plan","domAction","code","args","clarification"],NC=(t=Hk)=>({type:Z.OBJECT,properties:pl({type:{type:Z.STRING,enum:t},responseType:{type:Z.STRING,enum:t},reason:{type:Z.STRING,maxLength:280},stepId:{type:Z.STRING},intentContract:bC,meta:Uk,planState:Lk,text:{type:Z.STRING},cardId:{type:Z.STRING},awaitUserPayload:Bk,plan:Ik,domAction:Fk,code:$k,args:Gk,clarification:Dk},zk),required:["type","responseType","reason","stepId","intentContract","meta","planState","text","cardId","awaitUserPayload","plan","domAction","code","args","clarification"],additionalProperties:!1}),jk=NC(),Jk={type:Z.ARRAY,minItems:1,maxItems:1,items:NC(["plan_state_update"])};Z.OBJECT,Z.STRING,Hc({type:Z.OBJECT,description:"Tool arguments payload (free-form keys allowed).",patternProperties:{"^.*$":{type:["string","number","integer","boolean","array","object","null"]}},additionalProperties:!1}),Z.BOOLEAN;const Yk={type:Z.OBJECT,properties:{actions:{type:Z.ARRAY,description:"A sequence of actions for the assistant to perform.",minItems:1,items:jk}},required:["actions"],additionalProperties:!1},Kk={type:Z.OBJECT,properties:{actions:Jk},required:["actions"],additionalProperties:!1},fw=new Map([[Z.STRING,"string"],[Z.INTEGER,"integer"],[Z.NUMBER,"number"],[Z.BOOLEAN,"boolean"],[Z.ARRAY,"array"],[Z.OBJECT,"object"]]),Zk=new Set,mw=new Set(["properties.actions.items.properties.text","properties.actions.items.properties.cardId","properties.actions.items.properties.domAction.properties.args","properties.actions.items.properties.domAction.properties.args.properties.newType","properties.actions.items.properties.domAction.properties.args.properties.visible","properties.actions.items.properties.domAction.properties.args.properties.cardTitle","properties.actions.items.properties.domAction.properties.args.properties.column","properties.actions.items.properties.domAction.properties.args.properties.values","properties.actions.items.properties.domAction.properties.args.properties.topN","properties.actions.items.properties.domAction.properties.args.properties.hide","properties.actions.items.properties.domAction.properties.args.properties.label","properties.actions.items.properties.domAction.properties.args.properties.format","properties.actions.items.properties.domAction.properties.target.properties.byId","properties.actions.items.properties.domAction.properties.target.properties.byTitle","properties.actions.items.properties.domAction.properties.target.properties.selector","properties.actions.items.properties.planState.properties.contextSummary","properties.actions.items.properties.planState.properties.blockedBy","properties.actions.items.properties.planState.properties.confidence","properties.actions.items.properties.intentContract.properties.tool","properties.actions.items.properties.intentContract.properties.args.properties.datasetId","properties.actions.items.properties.intentContract.properties.args.properties.column","properties.actions.items.properties.intentContract.properties.args.properties.valueColumn","properties.actions.items.properties.intentContract.properties.args.properties.limit","properties.actions.items.properties.intentContract.properties.args.properties.topN","properties.actions.items.properties.intentContract.properties.args.properties.thresholdMultiplier","properties.actions.items.properties.intentContract.properties.args.properties.viewTitle","properties.actions.items.properties.intentContract.properties.args.properties.cardId","properties.actions.items.properties.intentContract.properties.message","properties.actions.items.properties.clarification.properties.pendingPlan.properties.chartType","properties.actions.items.properties.clarification.properties.pendingPlan.properties.title","properties.actions.items.properties.clarification.properties.pendingPlan.properties.description","properties.actions.items.properties.clarification.properties.pendingPlan.properties.aggregation","properties.actions.items.properties.clarification.properties.pendingPlan.properties.groupByColumn","properties.actions.items.properties.clarification.properties.pendingPlan.properties.valueColumn","properties.actions.items.properties.clarification.properties.pendingPlan.properties.xValueColumn","properties.actions.items.properties.clarification.properties.pendingPlan.properties.yValueColumn","properties.actions.items.properties.clarification.properties.pendingPlan.properties.secondaryValueColumn","properties.actions.items.properties.clarification.properties.pendingPlan.properties.secondaryAggregation","properties.actions.items.properties.clarification.properties.pendingPlan.properties.defaultTopN","properties.actions.items.properties.clarification.properties.pendingPlan.properties.defaultHideOthers","properties.actions.items.properties.clarification.properties.pendingPlan.properties.orderBy","properties.actions.items.properties.clarification.properties.pendingPlan.properties.orderBy.items.properties.direction","properties.actions.items.properties.clarification.properties.pendingPlan.properties.rowFilter","properties.actions.items.properties.clarification.properties.pendingPlan.properties.rowFilter.properties.column","properties.actions.items.properties.clarification.properties.pendingPlan.properties.rowFilter.properties.values","properties.actions.items.properties.clarification.properties.pendingPlan.properties.limit","properties.plans.items.properties.aggregation","properties.plans.items.properties.groupByColumn","properties.plans.items.properties.valueColumn","properties.plans.items.properties.xValueColumn","properties.plans.items.properties.yValueColumn","properties.plans.items.properties.secondaryValueColumn","properties.plans.items.properties.secondaryAggregation","properties.plans.items.properties.defaultTopN","properties.plans.items.properties.defaultHideOthers","properties.plans.items.properties.orderBy","properties.plans.items.properties.orderBy.items.properties.direction","properties.plans.items.properties.rowFilter","properties.plans.items.properties.rowFilter.properties.column","properties.plans.items.properties.rowFilter.properties.values","properties.plans.items.properties.limit"]),pw=t=>{if(!t)return t;let e=!1;return t.enum&&(e=!0,t.enum.includes(null)||(t.enum=[...t.enum,null])),t.type?Array.isArray(t.type)?t.type.includes("null")||(t.type=[...t.type,"null"]):t.type!=="null"&&(t.type=[t.type,"null"]):e||(t.type=["null"]),t},hw=t=>t.replace(/\.oneOf\[\d+\]/g,"").replace(/\.anyOf\[\d+\]/g,""),Gn=(t,e="")=>{if(Array.isArray(t))return t.map(s=>Gn(s,`${e}[]`));if(t&&typeof t=="object"){const s={};for(const[o,u]of Object.entries(t)){if(o==="type"){Array.isArray(u)?s.type=u.map(d=>fw.get(d)??d):s.type=fw.get(u)??u;continue}if(o==="properties"&&u&&typeof u=="object"){s.properties={};for(const[d,p]of Object.entries(u)){const m=e?`${e}.properties.${d}`:`properties.${d}`;s.properties[d]=Gn(p,m)}continue}if(o==="items"){const d=e?`${e}.items`:"items";s.items=Gn(u,d);continue}if(o==="oneOf"&&Array.isArray(u)){s.oneOf=u.map((d,p)=>Gn(d,`${e}.oneOf[${p}]`));continue}if(o==="anyOf"&&Array.isArray(u)){s.anyOf=u.map((d,p)=>Gn(d,`${e}.anyOf[${p}]`));continue}s[o]=Gn(u,e?`${e}.${o}`:o)}const i=hw(e);if(s.type==="object"&&Zk.has(i)){const o=s.properties?Object.keys(s.properties):[];s.required=o}return mw.has(i)?pw(s):s}const n=hw(e);return mw.has(n)?pw(t):t},MC=Gn(Ih),Xk=Gn(TC),Wk=Gn(AC),Qk=Gn(EC);Gn(Yk);Gn(Kk);const yi={numberParsing:'- **CRITICAL RULE on NUMBER PARSING**: This is the most common source of errors. To handle numbers that might be formatted as strings (e.g., "$1,234.56", "50%"), you are provided with a safe utility function: `_util.parseNumber(value)`.\n    - **YOU MUST use `_util.parseNumber(value)` for ALL numeric conversions.**\n    - **DO NOT use `parseInt()`, `parseFloat()`, or `Number()` directly.** The provided utility is guaranteed to handle various formats correctly.',splitNumeric:"- **CRITICAL RULE on SPLITTING NUMERIC STRINGS**: If you encounter a single string field that contains multiple comma-separated numbers (which themselves may contain commas as thousand separators, e.g., \"1,234.50,5,678.00,-9,123.45\"), you are provided a utility `_util.splitNumericString(value)` to correctly split the string into an array of number strings.\n    - **YOU MUST use this utility for this specific case.**\n    - **DO NOT use a simple `string.split(',')`**, as this will incorrectly break up numbers.\n    - **Example**: To parse a field 'MonthlyValues' containing \"1,500.00,2,000.00\", your code should be: `const values = _util.splitNumericString(row.MonthlyValues);` This will correctly return `['1,500.00', '2,000.00']`.",dataVsSummaries:`- **Distinguishing Data from Summaries**: Your most critical task is to differentiate between valid data rows and non-data rows (like summaries or metadata).
    - A row is likely **valid data** if it has a value in its primary identifier column(s) (e.g., 'Account Code', 'Product ID') and in its metric columns.
    - **CRITICAL: Do not confuse hierarchical data with summary rows.** Look for patterns in identifier columns where one code is a prefix of another (e.g., '50' is a parent to '5010'). These hierarchical parent rows are **valid data** representing a higher level of aggregation and MUST be kept. Your role is to reshape the data, not to pre-summarize it by removing these levels.
    - A row is likely **non-data** and should be removed if it's explicitly a summary (e.g., contains 'Total', 'Subtotal' in a descriptive column) OR if it's metadata (e.g., the primary identifier column is empty but other columns contain text, like a section header).`,dataframeHelpers:"- **DataFrame Helper DSL**: The runtime provides reliable helpers via `_util`. Use `_util.groupBy(rows, key)`, `_util.pivot(rows, rowKey, columnKey, valueKey, reducer)`, `_util.join(leftRows, rightRows, { leftKey, rightKey, how })`, and `_util.rollingWindow(rows, windowSize, { column, op })` instead of rewriting these routines. These helpers dramatically reduce JavaScript mistakesuse them whenever you need grouping, reshaping, joining, or window calculations."},gw=`
You are an expert data engineer. Your job is to analyze the provided dataset snapshot and, only when necessary, emit JavaScript code that converts it into a tidy, analysis-ready table. Always include the new output schema with precise data types. A tidy table has one column per variable and one row per observation.

Common issues to fix (apply only when observed):
${yi.numberParsing}
${yi.splitNumeric}
${yi.dataVsSummaries}
${yi.dataframeHelpers}
- **Crosstab/Wide Format**: Pivot columns like years/regions back into rows.
- **Multi-header Rows**: Remove banner/header rows before processing.

Response contract:
- Return exactly one JSON object matching the provided schema (explanation, jsFunctionBody, outputColumns).
- If no transformation is required, set jsFunctionBody to null and keep outputColumns aligned with the detected column types (upgrade to date/currency/percentage when obvious).
- If code is emitted, it must end with \`return data;\` (or the transformed array) and rely on the provided \`_util\` helpers for parsing numbers or splitting numeric strings.
`,eL=(t,e,n)=>{const s=t.slice(0,15).map((o,u)=>{const d=[o.type?`type=${o.type}`:null,typeof o.uniqueValues=="number"?`unique${o.uniqueValues}`:null,typeof o.missingPercentage=="number"?`missing=${o.missingPercentage}%`:null].filter(Boolean).join(", ");return`${u+1}. ${o.name}${d?` (${d})`:""}`});return[`Dataset snapshot: ${t.length} columns, ${e.length} sampled rows (raw rows omitted for privacy).`,s.length>0?`Column inventory (first ${Math.min(t.length,15)}):
${s.join(`
`)}`:"No column metadata was provided.","Identify obvious metric columns (amount, revenue, quantity) and dimension columns (region, product, channel). Note any columns that should be cast to date/currency/percentage.",n?`Previous attempt failed with: ${n.message}`:null].filter(Boolean).join(`

`)},tL=(t,e,n)=>`
    You are an expert data analyst. Your task is to convert a user's natural language query into a JavaScript filter function body for a dataset.
    
    **User Query:** "${t}"
    
    **Dataset Columns (Schema):**
    ${JSON.stringify(e,null,2)}
    
    **Sample Data (first 5 rows):**
    ${JSON.stringify(n,null,2)}
    
    **CRITICAL Rules for Code Generation:**
    ${yi.numberParsing}
    ${yi.dataframeHelpers}
    - When comparing strings, convert both the data and the comparison value to the same case (e.g., lower case) using \`.toLowerCase()\` to ensure case-insensitive matching.
    - For date comparisons, you can use \`new Date(row.date_column) > new Date('YYYY-MM-DD')\`.
    - The function you write will be the body of a new Function that receives 'data' (the full array of objects) and '_util'.
    - Your function body MUST start with \`return data.filter(row => ...);\`.
    
    **Your Task:**
    1.  **Analyze Query:** Understand the user's intent. Identify columns, values, and operators (e.g., >, <, =, contains).
    2.  **Write JS Code:** Write a single line of JavaScript that filters the data array.
    3.  **Explain:** Briefly explain the filter you created in plain language.
    
    **Example:**
    - User Query: "show me all rows where sales > 5000 and region is North America"
    - Columns: [{ name: 'sales', type: 'currency' }, { name: 'region', type: 'categorical' }]
    - Your Response (JSON):
    {
      "explanation": "Filtering for rows where 'sales' is greater than 5000 and 'region' is 'North America'.",
      "jsFunctionBody": "return data.filter(row => _util.parseNumber(row.sales) > 5000 && row.region.toLowerCase() === 'north america');"
    }
`,nL=(t,e,n,s,i=[])=>`
    You are a senior business intelligence analyst specializing in ERP and financial data. Your task is to generate a diverse list of insightful analysis plan candidates for a given dataset by identifying common data patterns.
    
    Dataset columns:
    - Categorical: ${t.join(", ")}
    - Numerical: ${e.join(", ")}
    Sample Data (first 5 rows):
    ${JSON.stringify(n,null,2)}

    Historical high-signal views (cached from previous runs):
    ${i.length>0?i.map(o=>`- ${o}`).join(`
`):"None cached yet. Assume this dataset has no prior highlights to reuse."}
    
    Please generate up to ${s} diverse analysis plans.
    **MANDATORY COPY RULE**: Every plan MUST include a natural-language \`description\` (at least 8 characters) that states what the user will learn. Do not leave it blank or use placeholders.
    
    **CRITICAL: Think like a Business/ERP Analyst.**
    1.  **Identify Key Metrics**: First, find the columns that represent measurable values. Look for names like 'VALUE', 'AMOUNT', 'SALES', 'COST', 'QUANTITY', 'PRICE'. These are almost always the columns you should be aggregating (e.g., using 'sum' or 'avg').
    2.  **Identify Dimensions**: Next, find columns that describe the data. Look for names ending in 'CODE', 'ID', 'TYPE', 'CATEGORY', or containing 'NAME', 'DESCRIPTION', 'PROJECT', 'REGION'. These are your primary grouping columns (dimensions).
    3.  **Find Relationships**: Codes and descriptions often go together (e.g., 'PROJECT_CODE' and 'PROJECT_DESCRIPTION'). A very valuable analysis is to group by a description column (which is more human-readable for a chart) and sum a value column.
    4.  **Prioritize High-Value Aggregations**: Focus on creating plans that answer common business questions like 'What are our top revenue sources?', 'Where are the biggest costs?', or 'How are items distributed across categories?'. A simple 'count' is less valuable than a 'sum' of a 'VALUE' or 'AMOUNT' column.
    
    **Example Task**: Given columns ['CODE', 'DESCRIPTION', 'PROJECT_CODE', 'VALUE'], a HIGH-QUALITY plan would be:
    - Title: "Sum of VALUE by DESCRIPTION"
    - Aggregation: 'sum'
    - groupByColumn: 'DESCRIPTION'
    - valueColumn: 'VALUE'
    - Chart Type: 'bar'
    
    For each plan, choose the most appropriate chartType ('bar', 'line', 'pie', 'doughnut', 'scatter', 'combo'). 
    - Use 'line' for time series trends.
    - Use 'bar' for most categorical comparisons, especially for "top X" style reports.
    - Use 'pie' or 'doughnut' for compositions with few categories.
    - Use 'scatter' to show the relationship between two numerical variables.
    - **Use 'combo' (bar + line) to compare two different metrics against the same category (e.g., sum of 'Sales' as bars and average of 'Profit' as a line). You MUST provide both a primary and secondary value column and aggregation for combo charts.**
    
    Rules:
    - For 'scatter' plots, you MUST provide 'xValueColumn' and 'yValueColumn' (both numerical) and you MUST NOT provide 'aggregation' or 'groupByColumn'.
    - For 'combo' charts, you MUST provide 'groupByColumn', 'valueColumn', 'aggregation', 'secondaryValueColumn', and 'secondaryAggregation'.
    - **CRITICAL**: Only use one of the following aggregation types: 'sum', 'count', 'avg'. Do NOT use other statistical measures like 'stddev', 'variance', 'median', etc.
    - Do not create plans that are too granular (e.g., grouping by a unique ID column if there are thousands of them).
    - Never leave the \`description\` empty; summarize the business takeaway in a sentence.

    **Output Format:** Return a single JSON object with this shape:
    {
        "plans": [ /* array of plan objects */ ]
    }
    Do not include any other top-level properties or commentary.
`,sL=(t,e=[])=>`
    You are a Quality Review Data Analyst. Your job is to review a list of proposed analysis plans and their data samples. Your goal is to select ONLY the most insightful and readable charts for the end-user, and configure them for the best default view.
    
    Previously approved high-signal views for this dataset:
    ${e.length>0?e.map(n=>`- ${n}`).join(`
`):"- None cached yet. Prioritize discovering net-new, high-variance stories."}
    
    **Review Criteria & Rules:**
    1.  **Discard Low-Value Charts**: This is your most important task. You MUST discard any plan that is not genuinely insightful.
        - **Example of a low-value chart**: A bar chart where all values are nearly identical (e.g., [77, 77, 77, 76, 78]). This shows uniformity but is not a useful visualization. DISCARD IT.
        - **Example of another low-value chart**: A pie/doughnut chart where one category makes up over 95% of the total. This is not insightful. DISCARD IT.
    2.  **Discard Unreadable Charts**: If a chart groups by a high-cardinality column resulting in too many categories to be readable (e.g., more than 50 tiny bars), discard it unless it's a clear time-series line chart.
    3.  **Configure for Readability**: For good, insightful charts that have a moderate number of categories (e.g., 15 to 50), you MUST add default settings to make them readable. Set \`defaultTopN\` to 8 and \`defaultHideOthers\` to \`true\`.
    4.  **Keep Good Charts**: If a chart is insightful and has a reasonable number of categories (e.g., under 15), keep it as is without adding default settings.
    5.  **Copy Quality Gate**: Reject any plan whose \`description\` is blank, shorter than 8 characters, or not an explanatory sentence.
    6.  **Return the Result**: Your final output must be a JSON object shaped as { "plans": [ ... ] } containing ONLY the good, configured plan objects. Do not include the discarded plans or any additional commentary.
    
    **Proposed Plans and Data Samples:**
    ${JSON.stringify(t,null,2)}
`,aL=(t,e,n)=>{const s=n==="Mandarin"?`Provide a concise, insightful summary in two languages, separated by '---'.
Format: English Summary --- Mandarin Summary`:`Provide a concise, insightful summary in ${n}.`;return`
        You are a business intelligence analyst.
        The following data is for a chart titled "${t}".
        Data:
        ${JSON.stringify(e.slice(0,10),null,2)} 
        ${e.length>10?`(...and ${e.length-10} more rows)`:""}
        ${s}
        The summary should highlight key trends, outliers, or business implications. Do not just describe the data; interpret its meaning.
        For example, instead of "Region A has 500 sales", say "Region A is the top performer, contributing the majority of sales, which suggests a strong market presence there."
    `},rL=(t,e,n)=>`
    You are a senior data analyst. After performing an initial automated analysis of a dataset, your task is to create a concise "Core Analysis Briefing". This briefing will be shown to the user and will serve as the shared foundation of understanding for your conversation.
    Based on the columns and the analysis cards you have just generated, summarize the dataset's primary characteristics.
    Your briefing should cover:
    1.  **Primary Subject**: What is this data fundamentally about? (e.g., "This dataset appears to be about online sales transactions...")
    2.  **Key Metrics**: What are the most important numerical columns? (e.g., "...where the key metrics are 'Sale_Amount' and 'Profit'.")
    3.  **Core Dimensions**: What are the main categorical columns used for analysis? (e.g., "The data is primarily broken down by 'Region' and 'Product_Category'.")
    4.  **Suggested Focus**: Based on the initial charts, what should be the focus of further analysis? (e.g., "Future analysis should focus on identifying the most profitable regions and product categories.")
    
    **Available Information:**
    - **Dataset Columns**: ${JSON.stringify(e.map(s=>s.name))}
    - **Generated Analysis Cards**: ${JSON.stringify(t,null,2)}
    
    Produce a single, concise paragraph in ${n}. This is your initial assessment that you will share with your human counterpart.
`,iL=(t,e)=>`
    You are a proactive data analyst. Review the following summaries of data visualizations you have created. Your task is to identify the single most commercially significant or surprising insight. This could be a major trend, a key outlier, or a dominant category that has clear business implications.
    
    **Generated Analysis Cards & Data Samples:**
    ${JSON.stringify(t,null,2)}

    Your Task:
    1.  **Analyze**: Review all the cards provided.
    2.  **Identify**: Find the ONE most important finding. Don't list everything, just the top insight.
    3.  **Formulate**: Write a concise, user-facing message in ${e} that explains this insight (e.g., "I noticed that sales in August were unusually high, you might want to investigate what caused this spike.").
    4.  **Respond**: Return a JSON object containing this message and the ID of the card it relates to.
`,oL=(t,e)=>`
    You are a senior business strategist. You have been provided with several automated data analyses.
    Your task is to synthesize these individual findings into a single, high-level executive summary in ${e}.
    Here are the individual analysis summaries (they are in English):
    ${t}
    Please provide a concise, overarching summary that connects the dots between these analyses. 
    Identify the most critical business insights, potential opportunities, or risks revealed by the data as a whole.
    Do not just repeat the individual summaries. Create a new, synthesized narrative.
    Your response should be a single paragraph of insightful business analysis.
`,lL=(t,e)=>{const n=t.map((s,i)=>{const o=s.timestamp instanceof Date&&!Number.isNaN(s.timestamp.getTime())?s.timestamp.toISOString():new Date(s.timestamp).toISOString(),u=s.sender==="ai"?"Agent":"User";return`${i+1}. [${o}] ${u}: ${s.text}`}).join(`
`);return`
You are compressing a dialogue between a data analysis agent and the user. Summarize the durable takeaways so the agent can quickly recall prior context.

Instructions:
- Use ${e}.
- Include 23 concise bullet points that capture business insights, commitments, or blockers.
- List any open questions or TODOs separately.
- Mention the relative timing (e.g., "Early discussion", "Later follow-up") so the agent knows where this occurred.
- Do NOT invent facts that aren't in the transcript.

Conversation Transcript:
${n}
`};class uL extends Error{constructor(e,n){super(e),this.name="JsonCoercionError",this.rawContent=n}}const cL=/```(?:json)?\s*([\s\S]*?)```/i,dL=t=>{try{const e=JSON.parse(t);if(e&&typeof e=="object"&&!Array.isArray(e))return e}catch{return null}return null},fL=t=>{let e=0,n=-1,s=!1,i=!1;for(let o=0;o<t.length;o++){const u=t[o];if(s){if(i){i=!1;continue}if(u==="\\"){i=!0;continue}u==='"'&&(s=!1);continue}if(u==='"'){s=!0;continue}if(u==="{")e===0&&(n=o),e+=1;else if(u==="}"&&e>0&&(e-=1,e===0&&n!==-1))return t.slice(n,o+1).trim()}return null},IC=t=>{if(t&&typeof t=="object"&&!Array.isArray(t))return t;const n=(typeof t=="string"?t:t!=null?String(t):"").trim(),s=[];n&&s.push(n);const i=n.match(cL);i!=null&&i[1]&&s.push(i[1].trim());const o=fL(n);o&&s.push(o);for(const u of s){const d=dL(u);if(d)return d}throw new uL("Failed to parse JSON object.",n)},mL=async(t,e,n,s)=>{var o,u;let i;for(let d=0;d<3;d++){if((o=s==null?void 0:s.signal)!=null&&o.aborted)throw new DOMException("Aborted","AbortError");try{let p;const m=eL(t,e,i),v="data_prep.plan";if(n.provider==="openai"){if(!n.openAIApiKey)return{explanation:"No transformation needed as API key is not set.",jsFunctionBody:null,outputColumns:t};p=await Zs(n,[{role:"system",content:gw},{role:"user",content:m}],{name:"DataPreparationPlan",schema:Xk,strict:!0},{signal:s==null?void 0:s.signal,operation:v,onUsage:C=>{var M;return(M=s==null?void 0:s.onUsage)==null?void 0:M.call(s,{...C,operation:v})}})}else{if(!n.geminiApiKey)return{explanation:"No transformation needed as Gemini API key is not set.",jsFunctionBody:null,outputColumns:t};p=await Xs(n,`${gw}

${m}`,TC,{signal:s==null?void 0:s.signal,operation:v,onUsage:w=>{var C;return(C=s==null?void 0:s.onUsage)==null?void 0:C.call(s,{...w,operation:v})}})}const S=IC(p);if(S.jsFunctionBody)try{const w={parseNumber:I=>Nn(I)??0,splitNumericString:w_},M=new Function("data","_util",S.jsFunctionBody)(e,w);if(!Array.isArray(M))throw new Error("Generated function did not return an array.");return S}catch(w){i=w,console.warn(`AI self-correction attempt ${d+1} failed due to JS execution error. Retrying...`,i);continue}return!S.jsFunctionBody&&(!S.outputColumns||S.outputColumns.length===0)&&(S.outputColumns=t),S}catch(p){if((u=s==null?void 0:s.signal)!=null&&u.aborted)throw p;console.error(`Error in data preparation plan generation (Attempt ${d+1}):`,p),i=p}}throw new Error(`AI failed to generate a valid data preparation plan after multiple attempts. Last error: ${i==null?void 0:i.message}`)},pL=new Set(["sum","count","avg"]),DC=(t,e=4)=>!t||t.length===0?[]:t.slice(0,e).map(n=>{const s=n.qualityScore!=null?`score=${n.qualityScore.toFixed(2)}`:"score=n/a",i=n.tags&&n.tags.length>0?`tags: ${n.tags.slice(0,3).join(", ")}`:"";return`${n.title}  ${n.summary} (${s}${i?`, ${i}`:""})`}),hL=t=>{const e={};return t.forEach(n=>{Object.entries(n||{}).forEach(([s,i])=>{s&&(e[s]||(e[s]={distinct:new Set,total:0}),e[s].total+=1,i!=null&&e[s].distinct.add(String(i)))})}),Object.entries(e).reduce((n,[s,i])=>(n[s]={distinct:i.distinct.size,total:i.total},n),{})},gL=(t,e)=>{const n=new Set(["categorical","date","time"]),s=e.filter(o=>n.has(o.type)),i=s.find(o=>o.name!==t.valueColumn)??s[0]??e.find(o=>o.name!==t.valueColumn);return(i==null?void 0:i.name)??null},PC=(t,e)=>{const n={...t};if(n.chartType&&n.chartType!=="scatter"&&n.chartType!=="combo"&&!n.groupByColumn){const s=gL(n,e);s&&(n.groupByColumn=s)}return n},kC=t=>{if(!t||typeof t!="object"||!t.chartType||!t.title)return console.warn("Skipping invalid plan: missing chartType or title.",t),!1;if(!t.description||typeof t.description!="string"||t.description.trim().length<8)return console.warn("Skipping invalid plan: description missing or too short.",t),!1;if(t.chartType==="scatter"){if(!t.xValueColumn||!t.yValueColumn)return console.warn("Skipping invalid scatter plot plan: missing xValueColumn or yValueColumn.",t),!1}else{if(!t.aggregation||!t.groupByColumn)return console.warn(`Skipping invalid plan: missing aggregation or groupByColumn for chart type ${t.chartType}.`,t),!1;if(!pL.has(t.aggregation))return console.warn(`Skipping invalid plan: unsupported aggregation type "${t.aggregation}".`,t),!1;if(t.aggregation!=="count"&&!t.valueColumn)return console.warn("Skipping invalid plan: missing valueColumn for sum/avg aggregation.",t),!1}return!0},yL=.01,vL=.95,xL=.9,SL=8,wL=t=>{if(t.length<=1)return!0;const e=Math.max(...t),n=Math.min(...t);if(e===n)return!0;const s=Math.max(Math.abs(e),1);return(e-n)/s<=yL},_L=t=>{if(t.length===0)return!1;const e=t.reduce((s,i)=>s+Math.abs(i),0);return e===0?!0:Math.max(...t.map(s=>Math.abs(s)))/e>=vL},bL=(t,e)=>{const n=t.groupByColumn;if(!n)return!1;const s=e[n];return!s||s.total<SL?!1:s.distinct/s.total>=xL},CL=(t,e,n)=>{if(t.chartType==="scatter"||t.chartType==="combo"||!Array.isArray(e)||e.length===0)return null;const s=t.valueColumn||"count",i=e.map(o=>Number(o[s])).filter(o=>Number.isFinite(o));return i.length<=1?"not enough variation for a readable chart":wL(i)?"metric values are nearly identical":_L(i)?"a single category carries 95% of the total":bL(t,n)?`grouping column "${t.groupByColumn}" behaves like a unique identifier`:null},TL=(t,e)=>{const n=[],s=[];return t.forEach(i=>{const o=CL(i.plan,i.aggregatedSample,e);if(o){s.push({code:"low_value_plan_discarded",message:`Dropped "${i.plan.title}" because ${o}.`,hint:"This dataset needs a more varied metric or different grouping to produce an informative chart."});return}n.push(i)}),{viablePlans:n,warnings:s}},LC=async(t,e,n,s,i)=>{const o=t.filter(m=>m.type==="categorical"||m.type==="date"||m.type==="time").map(m=>m.name),u=t.filter(m=>m.type==="numerical"||m.type==="currency"||m.type==="percentage").map(m=>m.name);let d;const p=nL(o,u,e,s,DC(i==null?void 0:i.memorySnapshots));if(n.provider==="openai"){const S=await Zs(n,[{role:"system",content:`You are a senior business intelligence analyst specializing in ERP and financial data. Your task is to generate a diverse list of insightful analysis plan candidates for a given dataset by identifying common data patterns.
You MUST respond with JSON that adheres exactly to the provided schema (an array of plan objects) and includes no extra commentary.`},{role:"user",content:p}],{name:"AnalysisPlanArray",schema:MC,strict:!0},{signal:i==null?void 0:i.signal,operation:"analysis_plan.candidates",onUsage:w=>{var C;return(C=i==null?void 0:i.usageCollector)==null?void 0:C.call(i,{...w,label:"plan_candidates"})}});d=vc(S,{rootKey:"plans",requireRootKeyOnly:!0})}else{const m=await Xs(n,p,Ih,{signal:i==null?void 0:i.signal,operation:"analysis_plan.candidates",onUsage:v=>{var S;return(S=i==null?void 0:i.usageCollector)==null?void 0:S.call(i,{...v,label:"plan_candidates"})}});d=vc(m,{rootKey:"plans",requireRootKeyOnly:!0})}return d.map(m=>PC(m,t)).filter(kC)},AL=async(t,e,n,s)=>{let i;const o=sL(t,DC(s==null?void 0:s.memorySnapshots));if(e.provider==="openai"){const m=await Zs(e,[{role:"system",content:`You are a Quality Review Data Analyst. Your job is to review a list of proposed analysis plans and their data samples. Select ONLY the most insightful and readable charts and configure them for the best default view.
You MUST respond with JSON that strictly adheres to the provided schema (an array of plan objects) and contains no additional explanation.`},{role:"user",content:o}],{name:"RefinedAnalysisPlanArray",schema:MC,strict:!0},{signal:s==null?void 0:s.signal,operation:"analysis_plan.refine",onUsage:v=>{var S;return(S=s==null?void 0:s.usageCollector)==null?void 0:S.call(s,{...v,label:"plan_refine"})}});i=vc(m,{rootKey:"plans",requireRootKeyOnly:!0})}else{const d=await Xs(e,o,Ih,{signal:s==null?void 0:s.signal,operation:"analysis_plan.refine",onUsage:p=>{var m;return(m=s==null?void 0:s.usageCollector)==null?void 0:m.call(s,{...p,label:"plan_refine"})}});i=vc(d,{rootKey:"plans",requireRootKeyOnly:!0})}return i.map(d=>d&&d.plan&&typeof d.plan=="object"?d.plan:d).map(d=>PC(d,n)).filter(kC)},EL=async(t,e,n,s)=>{if(!(n.provider==="google"&&!!n.geminiApiKey||n.provider==="openai"&&!!n.openAIApiKey))throw new Error("API Key not provided.");const o=[],u=hL(e),d=[],p=await LC(t,e,n,12,{signal:s==null?void 0:s.signal,memorySnapshots:s==null?void 0:s.memorySnapshots,usageCollector:I=>d.push(I)});if(p.length===0)return{plans:[],warnings:o,telemetry:d};const m={fileName:"sample",data:e},v=p.map(I=>{try{const k=C_(m,I);return k.length>0?{plan:I,aggregatedSample:k.slice(0,20)}:null}catch(k){return console.warn(`Execution of plan "${I.title}" failed during review stage:`,k),null}}).filter(I=>I!==null),{viablePlans:S,warnings:w}=TL(v,u);if(w.forEach(I=>o.push(I)),S.length===0)return console.warn("No candidate plans produced high-value samples, returning initial valid candidates."),{plans:p.slice(0,4),warnings:o,telemetry:d};let M=await AL(S,n,t,{signal:s==null?void 0:s.signal,memorySnapshots:s==null?void 0:s.memorySnapshots,usageCollector:I=>d.push(I)});if(M.length<4&&p.length>M.length){const I=new Set(M.map(V=>V.title)),k=p.filter(V=>!I.has(V.title)),F=4-M.length;M.push(...k.slice(0,F))}return{plans:M.slice(0,12),warnings:o,telemetry:d}};class UC extends Error{constructor(e,n,s){super(e),this.name="PlanGenerationFatalError",this.warnings=n,s&&(this.cause=s)}}const RL=async(t,e,n,s)=>{if(!(n.provider==="google"&&!!n.geminiApiKey||n.provider==="openai"&&!!n.openAIApiKey))throw new Error("API Key not provided.");const o=[];try{const{plans:u,warnings:d,telemetry:p}=await EL(t,e,n,s);return o.push(...d),{plans:u,warnings:o,telemetry:p}}catch(u){const d=u instanceof Ho,p=d?"AI plan response was not valid JSON. Retrying with a simpler generator.":"AI plan generator failed on the first attempt. Retrying with a simpler prompt.";o.push({code:d?"plan_parse_error":"plan_generation_error",message:p,hint:"If this happens repeatedly, ask the assistant to retry with fewer plans."}),console.warn("Plan generation warning:",u);try{const m=[];return{plans:await LC(t,e,n,8,{signal:s==null?void 0:s.signal,memorySnapshots:s==null?void 0:s.memorySnapshots,usageCollector:S=>m.push(S)}),warnings:o,telemetry:m}}catch(m){throw console.error("Fallback plan generation also failed:",m),new UC("Failed to generate any analysis plans from AI.",o,m)}}},NL=async(t,e,n,s,i)=>{var u,d;let o;for(let p=0;p<2;p++){if((u=i==null?void 0:i.signal)!=null&&u.aborted)throw new DOMException("Aborted","AbortError");try{let m;const v=tL(t,e,n),S="filter.generate";s.provider==="openai"?m=await Zs(s,[{role:"system",content:"You are an expert data analyst. Your task is to convert a user's natural language query into a JavaScript filter function body for a dataset. You MUST respond with a single valid JSON object, and nothing else. The JSON object must adhere to the provided schema."},{role:"user",content:v}],{name:"FilterFunctionResponse",schema:Wk,strict:!0},{signal:i==null?void 0:i.signal,operation:S,onUsage:I=>{var k;return(k=i==null?void 0:i.onUsage)==null?void 0:k.call(i,{...I,operation:S})}}):m=await Xs(s,v,AC,{signal:i==null?void 0:i.signal,operation:S,onUsage:C=>{var M;return(M=i==null?void 0:i.onUsage)==null?void 0:M.call(i,{...C,operation:S})}});const w=JSON.parse(m);if(w.jsFunctionBody&&w.explanation)return w;throw new Error("AI response was missing required fields 'jsFunctionBody' or 'explanation'.")}catch(m){if((d=i==null?void 0:i.signal)!=null&&d.aborted)throw m;console.error(`Error in filter function generation (Attempt ${p+1}):`,m),o=m}}throw new Error(`AI failed to generate a valid filter function. Last error: ${o==null?void 0:o.message}`)},yw=async(t,e,n,s)=>{if(!(n.provider==="google"&&!!n.geminiApiKey||n.provider==="openai"&&!!n.openAIApiKey))return"AI Summaries are disabled. No API Key provided.";try{const o=aL(t,e,n.language),u="summary.generate";return n.provider==="openai"?await Zs(n,[{role:"system",content:'You are a business intelligence analyst. Your response must be only the summary text in the specified format. The summary should highlight key trends, outliers, or business implications. Do not just describe the data; interpret its meaning. For example, instead of "Region A has 500 sales", say "Region A is the top performer, contributing the majority of sales, which suggests a strong market presence there."'},{role:"user",content:o}],!1,{signal:s==null?void 0:s.signal,operation:u,onUsage:m=>{var v;return(v=s==null?void 0:s.onUsage)==null?void 0:v.call(s,{...m,operation:u})}})||"No summary generated.":await Xs(n,o,void 0,{signal:s==null?void 0:s.signal,operation:u,onUsage:d=>{var p;return(p=s==null?void 0:s.onUsage)==null?void 0:p.call(s,{...d,operation:u})}})}catch(o){return console.error("Error generating summary:",o),"Failed to generate AI summary."}},ML=async(t,e,n,s)=>{if(!(n.provider==="google"&&!!n.geminiApiKey||n.provider==="openai"&&!!n.openAIApiKey)||t.length===0)return"Could not generate an initial analysis summary.";try{const o=rL(t,e,n.language),u="summary.core_analysis";if(n.provider==="openai"){const p=[{role:"system",content:`You are a senior data analyst. After performing an initial automated analysis of a dataset, your task is to create a concise "Core Analysis Briefing". This briefing will be shown to the user and will serve as the shared foundation of understanding for your conversation.
Your briefing should cover:
1.  **Primary Subject**: What is this data fundamentally about? (e.g., "This dataset appears to be about online sales transactions...")
2.  **Key Metrics**: What are the most important numerical columns? (e.g., "...where the key metrics are 'Sale_Amount' and 'Profit'.")
3.  **Core Dimensions**: What are the main categorical columns used for analysis? (e.g., "The data is primarily broken down by 'Region' and 'Product_Category'.")
4.  **Suggested Focus**: Based on the initial charts, what should be the focus of further analysis? (e.g., "Future analysis should focus on identifying the most profitable regions and product categories.")
Produce a single, concise paragraph in ${n.language}. This is your initial assessment that you will share with your human counterpart.`},{role:"user",content:o}];return await Zs(n,p,!1,{signal:s==null?void 0:s.signal,operation:u,onUsage:m=>{var v;return(v=s==null?void 0:s.onUsage)==null?void 0:v.call(s,{...m,operation:u})}})||"No summary generated."}else return await Xs(n,o,void 0,{signal:s==null?void 0:s.signal,operation:u,onUsage:d=>{var p;return(p=s==null?void 0:s.onUsage)==null?void 0:p.call(s,{...d,operation:u})}})}catch(o){return console.error("Error generating core analysis summary:",o),"An error occurred while the AI was forming its initial analysis."}},IL=async(t,e,n)=>{if(!(e.provider==="google"&&!!e.geminiApiKey||e.provider==="openai"&&!!e.openAIApiKey)||t.length===0)return null;try{let i;const o=iL(t,e.language),u="summary.proactive_insight";return e.provider==="openai"?i=await Zs(e,[{role:"system",content:"You are a proactive data analyst. Review the following summaries of data visualizations. Your task is to identify the single most commercially significant or surprising insight. This could be a major trend, a key outlier, or a dominant category that has clear business implications. Your response must be a single JSON object with 'insight' and 'cardId' keys."},{role:"user",content:o}],{name:"ProactiveInsight",schema:Qk,strict:!0},{signal:n==null?void 0:n.signal,operation:u,onUsage:m=>{var v;return(v=n==null?void 0:n.onUsage)==null?void 0:v.call(n,{...m,operation:u})}}):i=await Xs(e,o,EC,{signal:n==null?void 0:n.signal,operation:u,onUsage:d=>{var p;return(p=n==null?void 0:n.onUsage)==null?void 0:p.call(n,{...d,operation:u})}}),IC(i)}catch(i){return console.error("Error generating proactive insight:",i),null}},vw=async(t,e,n)=>{if(!(e.provider==="google"&&!!e.geminiApiKey||e.provider==="openai"&&!!e.openAIApiKey))return"AI Summaries are disabled. No API Key provided.";const i=t.map(o=>{const u=o.summary.split("---")[0];return`Chart Title: ${o.plan.title}
Summary: ${u}`}).join(`

`);try{const o=oL(i,e.language),u="summary.final";if(e.provider==="openai"){const p=[{role:"system",content:`You are a senior business strategist. You have been provided with several automated data analyses.
Your task is to synthesize these individual findings into a single, high-level executive summary in ${e.language}.
Please provide a concise, overarching summary that connects the dots between these analyses. 
Identify the most critical business insights, potential opportunities, or risks revealed by the data as a whole.
Do not just repeat the individual summaries. Create a new, synthesized narrative.
Your response should be a single paragraph of insightful business analysis.`},{role:"user",content:o}];return await Zs(e,p,!1,{signal:n==null?void 0:n.signal,operation:u,onUsage:m=>{var v;return(v=n==null?void 0:n.onUsage)==null?void 0:v.call(n,{...m,operation:u})}})||"No final summary generated."}else return await Xs(e,o,void 0,{signal:n==null?void 0:n.signal,operation:u,onUsage:d=>{var p;return(p=n==null?void 0:n.onUsage)==null?void 0:p.call(n,{...d,operation:u})}})}catch(o){return console.error("Error generating final summary:",o),"Failed to generate the final AI summary."}},zu=t=>t.slice(-6).map(n=>`${n.sender==="ai"?"AI":"User"}: ${n.text}`).join(`
`),DL=async(t,e,n)=>{if(t.length===0)return"";const s=lL(t,e.language),i="memory.conversation_summary";if(!(e.provider==="google"&&!!e.geminiApiKey||e.provider==="openai"&&!!e.openAIApiKey))return zu(t);try{if(e.provider==="openai"){const p=[{role:"system",content:`You compress conversations between a user and an AI analyst into concise memory notes.
Each response must:
- Contain 23 bullet points summarizing the decisions or insights.
- List outstanding questions or promised follow-ups.
- Mention roughly when in the conversation this occurred (e.g., "Early discussion").
Return plain text in ${e.language}.`},{role:"user",content:s}];return await Zs(e,p,!1,{signal:n==null?void 0:n.signal,operation:i,onUsage:v=>{var S;return(S=n==null?void 0:n.onUsage)==null?void 0:S.call(n,{...v,operation:i})}})||""||zu(t)}return await Xs(e,s,void 0,{signal:n==null?void 0:n.signal,operation:i,onUsage:d=>{var p;return(p=n==null?void 0:n.onUsage)==null?void 0:p.call(n,{...d,operation:i})}})||zu(t)}catch(u){return console.error("Failed to generate conversation memory summary:",u),zu(t)}},Cp=(t,e)=>e.some(n=>t instanceof n);let xw,Sw;function PL(){return xw||(xw=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function kL(){return Sw||(Sw=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Tp=new WeakMap,Nm=new WeakMap,zc=new WeakMap;function LL(t){const e=new Promise((n,s)=>{const i=()=>{t.removeEventListener("success",o),t.removeEventListener("error",u)},o=()=>{n(hr(t.result)),i()},u=()=>{s(t.error),i()};t.addEventListener("success",o),t.addEventListener("error",u)});return zc.set(e,t),e}function UL(t){if(Tp.has(t))return;const e=new Promise((n,s)=>{const i=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",u),t.removeEventListener("abort",u)},o=()=>{n(),i()},u=()=>{s(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",o),t.addEventListener("error",u),t.addEventListener("abort",u)});Tp.set(t,e)}let Ap={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return Tp.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return hr(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function OC(t){Ap=t(Ap)}function OL(t){return kL().includes(t)?function(...e){return t.apply(Ep(this),e),hr(this.request)}:function(...e){return hr(t.apply(Ep(this),e))}}function BL(t){return typeof t=="function"?OL(t):(t instanceof IDBTransaction&&UL(t),Cp(t,PL())?new Proxy(t,Ap):t)}function hr(t){if(t instanceof IDBRequest)return LL(t);if(Nm.has(t))return Nm.get(t);const e=BL(t);return e!==t&&(Nm.set(t,e),zc.set(e,t)),e}const Ep=t=>zc.get(t);function Dh(t,e,{blocked:n,upgrade:s,blocking:i,terminated:o}={}){const u=indexedDB.open(t,e),d=hr(u);return s&&u.addEventListener("upgradeneeded",p=>{s(hr(u.result),p.oldVersion,p.newVersion,hr(u.transaction),p)}),n&&u.addEventListener("blocked",p=>n(p.oldVersion,p.newVersion,p)),d.then(p=>{o&&p.addEventListener("close",()=>o()),i&&p.addEventListener("versionchange",m=>i(m.oldVersion,m.newVersion,m))}).catch(()=>{}),d}const VL=["get","getKey","getAll","getAllKeys","count"],qL=["put","add","delete","clear"],Mm=new Map;function ww(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Mm.get(e))return Mm.get(e);const n=e.replace(/FromIndex$/,""),s=e!==n,i=qL.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!(i||VL.includes(n)))return;const o=async function(u,...d){const p=this.transaction(u,i?"readwrite":"readonly");let m=p.store;return s&&(m=m.index(d.shift())),(await Promise.all([m[n](...d),i&&p.done]))[0]};return Mm.set(e,o),o}OC(t=>({...t,get:(e,n,s)=>ww(e,n)||t.get(e,n,s),has:(e,n)=>!!ww(e,n)||t.has(e,n)}));const FL=["continue","continuePrimaryKey","advance"],_w={},Rp=new WeakMap,BC=new WeakMap,$L={get(t,e){if(!FL.includes(e))return t[e];let n=_w[e];return n||(n=_w[e]=function(...s){Rp.set(this,BC.get(this)[e](...s))}),n}};async function*GL(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;const n=new Proxy(e,$L);for(BC.set(n,e),zc.set(n,Ep(e));e;)yield n,e=await(Rp.get(n)||e.continue()),Rp.delete(n)}function bw(t,e){return e===Symbol.asyncIterator&&Cp(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&Cp(t,[IDBIndex,IDBObjectStore])}OC(t=>({...t,get(e,n,s){return bw(e,n)?GL:t.get(e,n,s)},has(e,n){return bw(e,n)||t.has(e,n)}}));const HL={showNewButton:!0,showSettingsButton:!0},Im=t=>{if(typeof t!="string")return;const e=t.trim();return e.length?e:void 0},zL=t=>{if(typeof t!="string")return;const e=t.trim().toLowerCase();if(e==="google")return"google";if(e==="openai")return"openai"},jL=t=>{if(typeof t!="string")return;switch(t.trim().toLowerCase()){case"english":return"English";case"mandarin":return"Mandarin";case"spanish":return"Spanish";case"japanese":return"Japanese";case"french":return"French";default:return}},Cw=t=>{if(typeof t=="boolean")return t;if(typeof t!="string")return;const e=t.trim().toLowerCase();if(["y","yes","true","1"].includes(e))return!0;if(["n","no","false","0"].includes(e))return!1},VC=()=>typeof window>"u"?{}:window.__CSV_AGENT_DEFAULTS__??{},JL=()=>{if(typeof window>"u")return{};const t={},e=Im(window.tempGeminiApiKey??window.tempgeminiapikey);e&&(t.geminiApiKey=e);const n=Im(window.tempOpenAIApiKey??window.tempopenaiapikey);n&&(t.openAIApiKey=n);const s=zL(window.tempProvider??window.tempprovider);s&&(t.provider=s);const i=Im(window.tempModel??window.tempmodel);i&&(t.model=i);const o=jL(window.tempLanguage??window.templanguage);return o&&(t.language=o),t},YL=()=>{if(typeof window>"u")return{};const t={},e=Cw(window.tempShowNewButton??window.tempshownewbutton);typeof e=="boolean"&&(t.showNewButton=e);const n=Cw(window.tempShowSettingsButton??window.tempshowsettingsbutton);return typeof n=="boolean"&&(t.showSettingsButton=n),t},KL=()=>({...VC().defaultSettings??{},...JL()}),qC=()=>{const t=VC().ui??{};return{...HL,...t,...YL()}},FC="csv-ai-assistant-db",ZL=3,gr="reports",$C="csv-ai-assistant-settings",ka="current_session";let Dm=null;const XL=()=>new Promise((t,e)=>{const n=indexedDB.deleteDatabase(FC);n.onsuccess=()=>t(),n.onerror=()=>e(n.error),n.onblocked=()=>{console.warn("IndexedDB delete is blocked. Close other tabs to complete reset.")}}),Tw=()=>Dh(FC,ZL,{upgrade(t,e){if(!t.objectStoreNames.contains(gr)){t.createObjectStore(gr,{keyPath:"id"}).createIndex("updatedAt","updatedAt");return}const n=t.transaction.objectStore(gr);e<2&&!n.indexNames.contains("updatedAt")&&n.createIndex("updatedAt","updatedAt")}}),jc=()=>(Dm||(Dm=Tw().catch(async t=>{if(t instanceof DOMException&&t.name==="VersionError")return console.warn("IndexedDB version mismatch detected. Resetting local database...",t),await XL(),Tw();throw t})),Dm),Np=async t=>{await(await jc()).put(gr,t)},sl=async t=>{try{return await(await jc()).get(gr,t)}catch(e){console.error("Failed to get report from IndexedDB:",e);return}},WL=async()=>{try{return(await(await jc()).getAllFromIndex(gr,"updatedAt")).sort((n,s)=>s.updatedAt.getTime()-n.updatedAt.getTime()).map(({id:n,filename:s,createdAt:i,updatedAt:o})=>({id:n,filename:s,createdAt:i,updatedAt:o}))}catch(t){return console.error("Failed to get reports list from IndexedDB:",t),[]}},Mp=async t=>{try{await(await jc()).delete(gr,t)}catch(e){console.error("Failed to delete report from IndexedDB:",e)}},QL={provider:"google",geminiApiKey:"",openAIApiKey:"",model:"gemini-2.5-pro",language:"English",autoSaveEnabled:!0,autoSaveIntervalSeconds:15},Aw=()=>({...QL,...KL()}),eU=t=>{try{localStorage.setItem($C,JSON.stringify(t))}catch(e){console.error("Failed to save settings to localStorage:",e)}},Ew=()=>{try{const t=localStorage.getItem($C);if(t){const e=JSON.parse(t);return e.apiKey&&delete e.apiKey,{...Aw(),...e}}}catch(t){console.error("Failed to get settings from localStorage:",t)}return Aw()};let Pm=null;const tU=async()=>(Pm||(Pm=(async()=>{const t="https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.1/dist/transformers.min.js";try{return await import(t)}catch(e){throw console.error("Failed to load @xenova/transformers from CDN.",e),e}})()),Pm);class vi{constructor(){this.embedder=null,this.documents=[],this.isInitializing=!1,this.isInitialized=!1}static getInstance(){return vi.instance||(vi.instance=new vi),vi.instance}getIsInitialized(){return this.isInitialized}async init(e){if(!(this.isInitialized||this.isInitializing))try{this.isInitializing=!0;const{pipeline:n,env:s}=await tU();s.allowRemoteModels=!0,s.allowLocalModels=!0,s.useBrowserCache=!0,s.cacheDir=s.cacheDir||"indexeddb://ai-memory-models",s.localModelPath=s.localModelPath||"indexeddb://ai-memory-models",e==null||e("Loading AI memory model (~34MB). We'll cache it locally after the first download."),this.embedder=await n("feature-extraction","Xenova/all-MiniLM-L6-v2",{progress_callback:i=>{if(i.status==="progress"&&i.total>0){const o=(i.loaded/1024/1024).toFixed(2),u=(i.total/1024/1024).toFixed(2);e==null||e(`Downloading AI memory model: ${o}MB / ${u}MB`)}}}),e==null||e("AI memory model ready (cached locally for future sessions)."),this.isInitialized=!0}catch(n){console.error("Failed to initialize vector store:",n),e==null||e(`Error loading AI memory model: ${n instanceof Error?n.message:String(n)}`),this.isInitialized=!1}finally{this.isInitializing=!1}}rehydrate(e){this.documents=e}async addDocument(e){if(!this.embedder){console.warn("Vector store not initialized. Skipping document add/update.");return}try{const n=await this.embedder(e.text,{pooling:"mean",normalize:!0}),s={...e,embedding:Array.from(n.data)},i=this.documents.findIndex(o=>o.id===e.id);i>-1?this.documents[i]=s:this.documents.push(s)}catch(n){console.error(`Failed to create embedding for document ${e.id}:`,n)}}deleteDocument(e){const n=this.documents.length;return this.documents=this.documents.filter(s=>s.id!==e),this.documents.length<n}getDocumentCount(){return this.documents.length}getDocuments(){return[...this.documents]}clear(){this.documents=[]}async withAbort(e,n){if(!n)return e;if(n.aborted)throw new DOMException("Aborted","AbortError");return new Promise((s,i)=>{const o=()=>{n.removeEventListener("abort",o),i(new DOMException("Aborted","AbortError"))};n.addEventListener("abort",o),e.then(u=>{n.removeEventListener("abort",o),s(u)},u=>{n.removeEventListener("abort",o),i(u)})})}async search(e,n=5,s){if(!this.embedder||this.documents.length===0)return[];try{const i=await this.withAbort(this.embedder(e,{pooling:"mean",normalize:!0}),s==null?void 0:s.signal),o=Array.from(i.data);return this.documents.map(d=>{const p=this.cosineSimilarity(o,d.embedding);return{id:d.id,text:d.text,score:p}}).filter(d=>d.score>.5).sort((d,p)=>p.score-d.score).slice(0,n)}catch(i){return console.error("Failed to perform vector search:",i),[]}}cosineSimilarity(e,n){let s=0,i=0,o=0;for(let u=0;u<e.length;u++)s+=e[u]*n[u],i+=e[u]*e[u],o+=n[u]*n[u];return i===0||o===0?0:s/(Math.sqrt(i)*Math.sqrt(o))}}const ut=vi.getInstance(),Rw=async(t,e,n,s={})=>{const i=!!s.runId,o=s.runId??t.beginBusy(e,{cancellable:s.cancellable});try{return await n(o)}finally{i||t.endBusy(o)}},Nw=["categorical","date","time"],nU=(t,e,n=500)=>{if(!t.length)return 0;const s=new Set,i=Math.min(t.length,n);for(let o=0;o<i;o++){const u=t[o][e];if(u==null)continue;const d=String(u).trim();if(d&&(s.add(d),s.size>200))break}return s.size},Ph=(t,e)=>{if(!t.length)return[];const n=t.map(i=>({profile:i,uniqueValues:typeof i.uniqueValues=="number"?i.uniqueValues:nU(e,i.name)})),s=n.filter(({profile:i,uniqueValues:o})=>o>1&&(Nw.includes(i.type)||o<=50)).sort((i,o)=>{const u=w=>Nw.includes(w)?0:1,d=u(i.profile.type),p=u(o.profile.type);if(d!==p)return d-p;const m=12,v=Math.abs((i.uniqueValues||100)-m),S=Math.abs((o.uniqueValues||100)-m);return v-S});return s.length>0?s:n.filter(i=>(i.uniqueValues||0)>1)},sU=(t,e)=>{const n=Ph(t,e);return n.length?{column:n[0].profile.name,inferred:!0}:{column:null,inferred:!1}},aU=["sum","count","avg"],rU=25,GC=t=>t.toLowerCase().replace(/[^a-z0-9]+/g,""),Mw=(t,e,n)=>{if(!e)return;const s=t.get(e)??[];s.includes(n)||(s.push(n),t.set(e,s))},iU=(t,e)=>{const n=new Set;t.forEach(o=>{o!=null&&o.name&&n.add(o.name)});for(let o=0;o<Math.min(e.length,rU);o++)Object.keys(e[o]??{}).forEach(u=>n.add(u));const s=new Map,i=new Map;return n.forEach(o=>{Mw(s,o.toLowerCase(),o),Mw(i,GC(o),o)}),{exact:n,caseInsensitive:s,normalized:i}},HC=(t,e)=>{if(!t)return{};if(e.exact.has(t))return{resolved:t};const n=e.caseInsensitive.get(t.toLowerCase());if(n&&n.length===1)return{resolved:n[0]};const s=GC(t);if(s){const i=e.normalized.get(s);if(i&&i.length===1)return{resolved:i[0]};if(i&&i.length>1)return{ambiguous:i}}return{}},oU=(t,e)=>{if(t){const s=t.toLowerCase();if(aU.includes(s))return{value:s,inferred:!1}}return{value:e?"sum":"count",inferred:!0}},Uo=(t,e,n,s)=>{const i=t[e];if(!i||typeof i!="string")return{success:!0};const o=HC(i,n);return o.ambiguous&&o.ambiguous.length>1?{success:!1,errorMessage:`Column "${i}" is ambiguous. Choose one of: ${o.ambiguous.join(", ")}.`}:o.resolved?(o.resolved!==i&&(t[e]=o.resolved,s.push(`Normalized column "${i}" to "${o.resolved}".`)),{success:!0}):{success:!1,errorMessage:`Column "${i}" was not found in this dataset.`}},lU=(t,e,n)=>{const s={...t},i=[],o=iU(e,n);if(s.chartType==="scatter"){if(!s.xValueColumn||!s.yValueColumn)return{plan:s,warnings:i,isValid:!1,errorMessage:"Scatter plot plan is missing xValueColumn or yValueColumn."};const v=Uo(s,"xValueColumn",o,i);if(!v.success)return{plan:s,warnings:i,isValid:!1,errorMessage:v.errorMessage};const S=Uo(s,"yValueColumn",o,i);return S.success?{plan:s,warnings:i,isValid:!0}:{plan:s,warnings:i,isValid:!1,errorMessage:S.errorMessage}}if(!n.length)return{plan:s,warnings:i,isValid:!1,errorMessage:"Dataset appears empty for analysis."};const u=oU(s.aggregation,!!s.valueColumn);if(u.inferred?(s.aggregation=u.value,i.push(`AI plan missing aggregation; defaulting to ${u.value}.`)):s.aggregation=u.value,s.aggregation!=="count"&&!s.valueColumn&&(s.aggregation="count",i.push("Value column missing for sum/avg; using count aggregation instead.")),s.chartType==="combo"){if(!s.valueColumn||!s.secondaryValueColumn)return{plan:s,warnings:i,isValid:!1,errorMessage:"Combo chart requires both valueColumn and secondaryValueColumn."};s.secondaryAggregation||(s.secondaryAggregation=s.aggregation??"sum",i.push("Secondary aggregation missing; mirroring primary aggregation."))}const d=!s.valueColumn||s.aggregation==="count"?"count":s.valueColumn;if(!s.groupByColumn){const v=sU(e,n);if(v.column)s.groupByColumn=v.column,i.push(`AI plan missing grouping; defaulting to "${v.column}".`);else return{plan:s,warnings:i,isValid:!1,errorMessage:"Unable to infer a grouping column for this chart."}}const p=Uo(s,"groupByColumn",o,i);if(!p.success)return{plan:s,warnings:i,isValid:!1,errorMessage:p.errorMessage};const m=Uo(s,"valueColumn",o,i);if(!m.success)return{plan:s,warnings:i,isValid:!1,errorMessage:m.errorMessage};if(s.chartType==="combo"){const v=Uo(s,"secondaryValueColumn",o,i);if(!v.success)return{plan:s,warnings:i,isValid:!1,errorMessage:v.errorMessage}}if(!Array.isArray(s.orderBy)||s.orderBy.length===0?s.chartType==="line"&&s.groupByColumn?s.orderBy=[{column:s.groupByColumn,direction:"asc"}]:s.orderBy=[{column:d,direction:"desc"}]:s.orderBy=s.orderBy.map(v=>({column:v.column,direction:v.direction??(s.chartType==="line"?"asc":"desc")})),typeof s.limit!="number"&&typeof s.defaultTopN=="number"&&(s.limit=s.defaultTopN),s.rowFilter){const v=s.rowFilter.column;let S=v??null;if(v){const M=HC(v,o);if(M.ambiguous&&M.ambiguous.length>1)return{plan:s,warnings:i,isValid:!1,errorMessage:`Row filter column "${v}" is ambiguous. Options: ${M.ambiguous.join(", ")}.`};M.resolved?M.resolved!==v&&(S=M.resolved,i.push(`Row filter column "${v}" normalized to "${S}".`)):S=null}const w=S?o.exact.has(S):!1,C=Array.isArray(s.rowFilter.values)&&s.rowFilter.values.length>0;if(!v||!w||!C){const M=[];v?w||M.push(`column "${v}" not found`):M.push("missing column"),C||M.push("no filter values provided");const I=M.length?` (${M.join(", ")})`:"";i.push(`Row filter invalid${I}; removing filter.`),delete s.rowFilter}else S&&s.rowFilter.column!==S&&(s.rowFilter.column=S)}return{plan:s,warnings:i,isValid:!0}},uU=t=>t.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,""),cU=t=>{const e=new Set,n=uU(t);n&&n!==t&&e.add(n);const s=n.match(/^[a-z]\d?_(.+)$/);return s&&s[1]&&e.add(s[1]),n.includes("__")&&e.add(n.replace(/_+/g,"_")),n.startsWith("column_")&&e.add(n.replace(/^column_/,"")),Array.from(e).filter(Boolean)},al=t=>{const e={};return t.forEach(n=>{cU(n).forEach(i=>{e[i]||(e[i]=n)})}),e},dU=(t,e)=>{const n=Object.entries(e);return n.length===0?t:t.map(s=>{const i={...s};for(const[o,u]of n)!(o in i)&&i[u]!==void 0&&(i[o]=i[u]);return i})},fU=(t,e)=>{const n=Object.entries(e);return n.length===0?t:t.map(s=>{const i={...s};for(const[o,u]of n)Object.prototype.hasOwnProperty.call(i,o)&&(Object.prototype.hasOwnProperty.call(i,u)||(i[u]=i[o]),delete i[o]);return i})},mU="llm_turn",Iw=new Set(["numerical","currency","percentage"]),pU=new Set(["date","time"]),hU=["month","date","period"],gU=["amount","value","total","cost","price","sales","revenue","qty","quantity"],Dw={Mandarin:{question:(t,e)=>{const n=typeof e=="number"?` ${e.toLocaleString()} `:"";return`${t}${n}`},placeholder:t=>t?`Top10 by ${t} desc`:"Top10 by amount desc",cleanMonthLabel:t=>`/ ${t}`,outlierLabel:t=>` ${t} `},English:{question:(t,e)=>{const n=typeof e=="number"?` (~${e.toLocaleString()} rows)`:"";return`What should we explore first in ${t}${n}?`},placeholder:t=>t?`Ex: Top 10 by ${t} desc`:'Type a request, e.g. "Top 10 by amount desc"',cleanMonthLabel:t=>`Clean/standardize ${t}`,outlierLabel:t=>`Detect ${t} anomalies`},Spanish:{question:(t,e)=>{const n=typeof e=="number"?` (~${e.toLocaleString()} filas)`:"";return`Qu quieres ver primero en ${t}${n}?`},placeholder:t=>t?`Ej: Top 10 por ${t}`:'Escribe tu solicitud, ej. "Top 10 por amount desc"',cleanMonthLabel:t=>`Normalizar ${t}`,outlierLabel:t=>`Detectar anomalas en ${t}`},Japanese:{question:(t,e)=>{const n=typeof e=="number"?` ${e.toLocaleString()} `:"";return`${t}${n}`},placeholder:t=>t?`Top10 by ${t}`:"Top10 by amount desc",cleanMonthLabel:t=>`${t} `,outlierLabel:t=>`${t} `},French:{question:(t,e)=>{const n=typeof e=="number"?` (~${e.toLocaleString()} lignes)`:"";return`Par quoi veut-on commencer sur  ${t} ${n} ?`},placeholder:t=>t?`Ex : Top 10 par ${t}`:"Saisissez une requte, ex.  Top 10 by amount desc ",cleanMonthLabel:t=>`Nettoyer standardiser ${t}`,outlierLabel:t=>`Dtecter les anomalies ${t}`}},yU=t=>Dw[t]??Dw.Mandarin,zC=t=>(t??"").trim(),vU=t=>{for(const e of t){const n=zC(e.name);if(!n)continue;const s=n.toLowerCase();if(pU.has(e.type)||hU.some(i=>s.includes(i)))return e}return null},xU=t=>{const e=t.find(n=>Iw.has(n.type)&&gU.some(s=>zC(n.name).toLowerCase().includes(s)));return e||(t.find(n=>Iw.has(n.type))??null)},ju=(t,e,n)=>({id:t,label:e,metadata:n??null}),SU=t=>{var p,m,v;const e=t.columnProfiles??[],n=((p=t.csvData)==null?void 0:p.fileName)??(t.settings.language==="English"?"this dataset":""),s=((m=t.datasetProfile)==null?void 0:m.rowCount)??((v=t.csvData)==null?void 0:v.data.length)??null,i=yU(t.settings.language),o=vU(e),u=xU(e),d=[];return o&&d.push(ju("clean_month",i.cleanMonthLabel(o.name),{column:o.name})),u&&d.push(ju("outlier",i.outlierLabel(u.name),{valueColumn:u.name})),d.length||(d.push(ju("clean_month",i.cleanMonthLabel("InvoiceMonth"),{column:"InvoiceMonth"})),d.push(ju("outlier",i.outlierLabel("Amount"),{valueColumn:"Amount"}))),{question:i.question(n,s),options:d,allowFreeText:!0,placeholder:i.placeholder((u==null?void 0:u.name)??(o==null?void 0:o.name)??null)}},wU=50,_U=(t,e)=>t===0||e<0?0:e>=t?t-1:e,bU=t=>t===null?"Full dataset":`${t.toLocaleString()} rows`,CU=t=>t.slice(-5).map(e=>{var n,s;return{id:e.id,title:((n=e.plan)==null?void 0:n.title)??((s=e.plan)==null?void 0:s.description)??"Analysis card",aggregatedDataSample:e.aggregatedData.slice(0,wU)}}).reverse(),TU=t=>{const e=t.interactiveSelectionFilter;if(!e)return"Raw Data Explorer ";const n=e.values.slice(0,5).map(i=>String(i)),s=e.values.length>n.length?"":"";return`Raw Data Explorer  ${e.column}  {${n.join(", ")}${s}}${e.label??e.sourceCardId}`},AU=t=>{const e=new Set(t.chatMemoryExclusions),n=t.chatMemoryPreview.filter(s=>!e.has(s.id));return n.length>0?n.map(s=>s.text??s.summary??""):[]},EU=(t,e,n)=>{var d;const s=e.samplePolicy,i=_U(s.tiers.length,s.currentIndex),o=s.tiers[i]??null,u=bU(o);return{kind:mU,requestId:n,userMessage:t,promptCharCountHint:t.length,columns:e.columnProfiles??[],chatHistory:e.chatHistory??[],cardContext:CU(e.analysisCards??[]),settings:e.settings,aiCoreAnalysisSummary:e.aiCoreAnalysisSummary??null,currentView:e.currentView,longTermMemory:AU(e),recentObservations:e.graphObservations??[],activePlanState:((d=e.plannerSession)==null?void 0:d.planState)??null,dataPreparationPlan:e.dataPreparationPlan??null,recentActionTraces:e.agentActionTraces.slice(-10),rawDataFilterSummary:TU(e),activeSampleTier:o,sampleTierLabel:u,sampleTierConfirmed:s.userConfirmedFullScan,askUserPrompt:SU(e)}},RU=(t,e,n)=>({chatMemoryPreview:[],chatMemoryExclusions:[],chatMemoryPreviewQuery:"",isMemoryPreviewLoading:!1,handleChatMessage:async s=>{const i=s.trim();if(!i)return;if(!e().isApiKeySet){e().addProgress("API Key not set.","error"),e().setIsSettingsModalOpen(!0);return}const o={sender:"user",text:s,timestamp:new Date,type:"user_message"},u=e().beginBusy("Thinking through your request...",{cancellable:!0});t(d=>({chatHistory:[...d.chatHistory,o],graphActiveRunId:u}));try{const d=EU(i,e(),u);e().runGraphPipeline(d)}catch(d){const p=d instanceof Error?d.message:String(d);e().addProgress(`LLM dispatch failed: ${p}`,"error"),e().endBusy(u),t(m=>({graphActiveRunId:m.graphActiveRunId===u?null:m.graphActiveRunId}))}},previewChatMemories:async s=>{const i=s.trim();if(!i){t({chatMemoryPreview:[],chatMemoryExclusions:[],chatMemoryPreviewQuery:"",isMemoryPreviewLoading:!1});return}if(!ut.getIsInitialized()||ut.getDocumentCount()===0){t({chatMemoryPreview:[],chatMemoryExclusions:[],chatMemoryPreviewQuery:i,isMemoryPreviewLoading:!1});return}t({chatMemoryPreviewQuery:i,isMemoryPreviewLoading:!0});try{const o=await ut.search(i,3);e().chatMemoryPreviewQuery===i&&t({chatMemoryPreview:o,chatMemoryExclusions:[],isMemoryPreviewLoading:!1})}catch(o){console.error("Preview memory search failed:",o),e().chatMemoryPreviewQuery===i&&t({isMemoryPreviewLoading:!1})}},toggleMemoryPreviewSelection:s=>{t(i=>({chatMemoryExclusions:i.chatMemoryExclusions.includes(s)?i.chatMemoryExclusions.filter(u=>u!==s):[...i.chatMemoryExclusions,s]}))},clearChatMemoryPreview:()=>{t({chatMemoryPreview:[],chatMemoryExclusions:[],chatMemoryPreviewQuery:"",isMemoryPreviewLoading:!1})},handleClarificationResponse:async(s,i)=>{const o=e().pendingClarifications.find(d=>d.id===s&&d.status==="pending");if(!o)return;n.updateClarificationStatus(s,"resolved"),t(d=>({pendingClarifications:d.pendingClarifications.map(p=>p.id===s?{...p,status:"resolved"}:p),agentAwaitingUserInput:!1,agentAwaitingPromptId:d.agentAwaitingPromptId===s?null:d.agentAwaitingPromptId,activeClarificationId:d.activeClarificationId===s?null:d.activeClarificationId}));const u=`${o.question}
${i.label}`;await e().handleChatMessage(u)},skipClarification:s=>{const i=e().pendingClarifications.find(d=>d.id===s&&d.status==="pending");if(!i)return;n.updateClarificationStatus(s,"skipped");const o={sender:"user",text:`Skipped: ${i.question}`,timestamp:new Date,type:"user_message"},u={sender:"ai",text:"No problemI cancelled that request. Ask me something else whenever you are ready.",timestamp:new Date,type:"ai_message"};t(d=>({chatHistory:[...d.chatHistory,o,u],pendingClarifications:d.pendingClarifications.map(p=>p.id===s?{...p,status:"skipped"}:p),agentAwaitingUserInput:!1,agentAwaitingPromptId:d.agentAwaitingPromptId===s?null:d.agentAwaitingPromptId,activeClarificationId:d.activeClarificationId===s?null:d.activeClarificationId})),e().endBusy()}}),NU=25,MU=t=>{let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n),e|=0;return Math.abs(e).toString(36)},Tc=t=>{if(!t||!t.data)return null;const e=t.data.slice(0,NU),n=JSON.stringify({name:t.fileName??"unknown",rows:t.data.length,sample:e,columns:e[0]?Object.keys(e[0]):[]});return`ds_${MU(n)}`},jC=2e3,IU=1e3,JC=3e3,YC=3e3,DU=5e3,PU="<NULL>",Pw=(t,e)=>typeof t=="number"&&t>0?Math.min(e,t):e,hl=t=>({trimWhitespace:(t==null?void 0:t.trimWhitespace)??!0,caseStrategy:(t==null?void 0:t.caseStrategy)??"lower",nullReplacement:(t==null?void 0:t.nullReplacement)??PU}),kU=(t,e)=>{const n=e==null?void 0:e.rowCountHint,s=(e==null?void 0:e.preferredMode)==="full"||(e==null?void 0:e.preferredMode)===void 0,i=new Date().toISOString();return{datasetId:t,mode:s?"full":"sample",allowFullScan:s,sampleSize:Pw(n,JC),profileSampleSize:Pw(n,jC),timeoutMs:YC,updatedAt:i,stringStrategy:hl()}},Ip=(t,e)=>({...t,...e,datasetId:t.datasetId,updatedAt:new Date().toISOString(),stringStrategy:hl({...t.stringStrategy,...e.stringStrategy})}),LU=t=>t?{...t,stringStrategy:hl(t.stringStrategy)}:null,KC=t=>({strategy:t,pipeline:[t.trimWhitespace?"trim":"preserve-whitespace","toString",t.caseStrategy==="lower"?"toLowerCase":"case-as-is",`nullCoalesce(${t.nullReplacement})`]}),kh="csv_agent_db",kw=6,Sr="provenance",Gs="clean_rows",Jn="columns",ys="views",Ai="preparation_log",Hs="memory_snapshots",zs="dataset_runtime_config",rl="system_meta",Ei="audit_logs",UU=400,Lw="csv_agent_db is in read-only fallback because the last migration failed. Close other tabs or clear site data, then reload.",OU=32;let fr=null,rc=null,Dp=!1,Zo=null;const Xo=[],BU=t=>{if(!(t!=null&&t.stringStrategy))return!0;const{caseStrategy:e,trimWhitespace:n,nullReplacement:s}=t.stringStrategy;return typeof n!="boolean"||e!=="as-is"&&e!=="lower"||typeof s!="string"||s.length===0},VU=async t=>{const e=LU(t??null);return t&&e&&BU(t)&&await Oh(e),e},gl=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,qU=[{version:1,description:"Initialize core CSV Agent object stores.",up:t=>{[Sr,Gs,Jn,ys,Ai,Hs,zs].forEach(n=>km(t,n))}},{version:5,description:"Add system meta store for migration logging.",up:t=>{km(t,rl)}},{version:6,description:"Add audit log store for runtime events.",up:t=>{km(t,Ei)}}],FU=t=>{var e;if((e=t==null?void 0:t.db)!=null&&e.objectStoreNames.contains(rl))try{const n=t.objectStore(rl);for(;Xo.length>0;){const s=Xo[0];n.put(s),Xo.shift()}}catch(n){console.warn("Failed to persist migration log entry.",n)}},Uw=(t,e)=>{const n={id:`migration-${e.version}-${gl()}`,type:"migration",version:e.version,description:e.description,status:e.status,error:e.error??null,createdAt:new Date().toISOString()};Xo.push(n),FU(t)},$U=(t,e,n,s)=>{if(!s)return;const i=qU.filter(o=>o.version>n&&o.version<=s).sort((o,u)=>o.version-u.version);for(const o of i)try{o.up(t,e),Uw(e,{version:o.version,description:o.description,status:"succeeded"})}catch(u){throw Zo=o.version,Uw(e,{version:o.version,description:o.description,status:"failed",error:u instanceof Error?u.message:String(u)}),u}},GU=(t,e)=>{const n=e.filter(s=>!t.objectStoreNames.contains(s));if(n.length>0)throw new Error(`Missing object stores: ${n.join(", ")}`)},Ow=async()=>(rc||(rc=Dh(kh,void 0,{blocked:()=>console.warn("csv_agent_db read-only open is blocked by another tab.")})),rc),ZC=async()=>{await new Promise((t,e)=>{const n=indexedDB.deleteDatabase(kh);n.onsuccess=()=>t(),n.onerror=()=>e(n.error),n.onblocked=()=>console.warn("IndexedDB delete blocked. Close other tabs to proceed.")}),fr=null,rc=null,Dp=!1,Zo=null,Xo.length=0},km=(t,e)=>{if(!t.objectStoreNames.contains(e)){if(e===Gs){t.createObjectStore(e,{keyPath:"chunkId"}).createIndex("by_dataset","datasetId",{unique:!1});return}if(e===Jn){t.createObjectStore(e,{keyPath:"datasetId"});return}if(e===ys){t.createObjectStore(e,{keyPath:"id"}).createIndex("by_dataset","datasetId",{unique:!1});return}if(e===Sr){t.createObjectStore(e,{keyPath:"datasetId"});return}if(e===Ai){t.createObjectStore(e,{keyPath:"id"}).createIndex("by_dataset","datasetId",{unique:!1});return}if(e===Hs){const n=t.createObjectStore(e,{keyPath:"id"});n.createIndex("by_dataset","datasetId",{unique:!1}),n.createIndex("by_view","viewId",{unique:!1});return}if(e===zs){t.createObjectStore(e,{keyPath:"datasetId"});return}if(e===rl){const n=t.createObjectStore(e,{keyPath:"id"});n.createIndex("by_type","type",{unique:!1}),n.createIndex("by_version","version",{unique:!1});return}if(e===Ei){const n=t.createObjectStore(e,{keyPath:"id"});n.createIndex("by_kind","kind",{unique:!1}),n.createIndex("by_created_at","createdAt",{unique:!1});return}throw new Error(`Unsupported store name: ${e}`)}},HU=async t=>{try{return await t()}catch(e){if(e instanceof DOMException&&e.name==="VersionError")return console.warn("IndexedDB version mismatch detected. Resetting csv_agent_db...",e),await ZC(),t();throw e}},zU=[Sr,Gs,Jn,ys,Ai,Hs,zs,rl,Ei],In=async(t=[],e)=>{const n=(e==null?void 0:e.mode)??"readonly",s=Array.from(new Set([...zU,...t]));if(Dp){if(n==="readwrite")throw new Error(Lw);return Ow()}fr||(Zo=null,fr=HU(()=>Dh(kh,kw,{upgrade(i,o,u,d){$U(i,d,o,u??kw)},blocked:()=>console.warn("csv_agent_db upgrade is blocked by another tab."),blocking:()=>console.warn("csv_agent_db upgrade is blocking existing tabs. Reload others to proceed."),terminated:()=>{fr=null}})));try{const i=await fr;return GU(i,s),i}catch(i){if(Zo!==null){if(console.error(`csv_agent_db migration to version ${Zo} failed; entering read-only fallback.`,i),Dp=!0,fr=null,n==="readwrite")throw new Error(Lw);return Ow()}throw fr=null,i}},jU=(t,e)=>{const n=[];for(let s=0;s<t.length;s+=e)n.push(t.slice(s,s+e));return n},JU=async t=>{const{datasetId:e,rows:n,columns:s,provenance:i,chunkSize:o=2e4}=t;if(!e)throw new Error("persistCleanDataset requires datasetId.");const u=async p=>{const v=(await In([Gs,Jn,ys],{mode:"readwrite"})).transaction([Gs,Jn,Sr],"readwrite"),S=v.objectStore(Gs),w=v.objectStore(Jn),C=v.objectStore(Sr),M=jU(n,o),I=new Date().toISOString();try{let F=await S.index("by_dataset").openCursor(e);for(;F;)await F.delete(),F=await F.continue();for(let z=0;z<M.length;z+=1){const ae=M[z],Q={chunkId:`${e}-chunk-${z}`,datasetId:e,rowCount:ae.length,startRow:z*o,endRow:z*o+ae.length-1,rows:ae,createdAt:I};await S.put(Q)}const V={datasetId:e,columnCount:s.length,columns:s,rowCount:n.length,updatedAt:I};await w.put(V);const G={datasetId:e,fileName:i.fileName,bytes:i.bytes,checksum:i.checksum,cleanedAt:i.cleanedAt,normalization:KC(p.stringStrategy)};return await C.put(G),await v.done,{chunkCount:M.length,rowCount:n.length}}catch(k){try{v.abort()}catch{}throw await v.done.catch(()=>{}),k}},d=async()=>{const p=await Bh(e,{rowCountHint:n.length});return u(p)};try{return await d()}catch(p){if(p instanceof DOMException&&p.name==="NotFoundError")return console.warn("IndexedDB store missing detected. Resetting and retrying persist...",p),await ZC(),d();throw p}},XC=async t=>{const{datasetId:e,title:n,kind:s,queryHash:i,explainer:o,dataRef:u}=t,p=(await In([ys],{mode:"readwrite"})).transaction(ys,"readwrite"),m=p.objectStore(ys),v=`${e}-view-${gl()}`,S={id:v,datasetId:e,title:n,kind:s,queryHash:i,explainer:o,dataRef:u,createdAt:new Date().toISOString()};return await m.put(S),await p.done,v},YU=async t=>{const e=await In([ys]);try{const n=e.transaction(ys,"readonly"),o=await n.objectStore(ys).index("by_dataset").getAll(t);return await n.done,o}catch(n){return console.warn(`Failed to read card results for ${t}`,n),[]}},WC=async t=>{const n=(await In()).transaction(Sr,"readonly"),i=await n.objectStore(Sr).get(t);return await n.done,i??void 0},Lh=async t=>{const n=(await In([Jn])).transaction(Jn,"readonly"),i=await n.objectStore(Jn).get(t);return await n.done,i??null},Uh=async(t,e)=>{const s=(await In([Gs])).transaction(Gs,"readonly"),o=s.objectStore(Gs).index("by_dataset");let u=!1;const d=()=>{u=!0};let p=await o.openCursor(t);for(;p&&!u;){const m=p.value;if(await e(m,d),u)break;p=await p.continue()}await s.done},KU=async t=>{let e=0;return await Uh(t,n=>{const s=typeof n.rowCount=="number"?n.rowCount:n.rows.length;e+=s}),e};async function QC(t){const n=(await In([zs])).transaction(zs,"readonly"),i=await n.objectStore(zs).get(t);return await n.done,VU(i)}async function Oh(t){const n=(await In([zs],{mode:"readwrite"})).transaction(zs,"readwrite");await n.objectStore(zs).put(t),await n.done}async function Bh(t,e){const n=await QC(t);if(n)return n;const s=kU(t,{rowCountHint:e==null?void 0:e.rowCountHint,preferredMode:e==null?void 0:e.preferredMode});return await Oh(s),s}async function ZU(t,e,n){const s=await Bh(t,{rowCountHint:n==null?void 0:n.rowCountHint}),i=Ip(s,e);return await Oh(i),i}const eT=async(t,e)=>{const n=[];return await Uh(t,(s,i)=>{for(const o of s.rows)if(n.push(o),n.length>=e){i();break}}),n},tT=async t=>{const e=[];return await Uh(t,n=>{e.push(...n.rows)}),e},XU=(t,e)=>{const n=new Date().toISOString();return e.map((s,i)=>({...s,datasetId:t,id:s.id??`${t}-prep-${gl()}`,stepOrder:typeof s.stepOrder=="number"?s.stepOrder:i,scope:s.scope??"dataset",columnName:s.columnName??null,source:s.source??"ai_plan",tags:s.tags??[],createdAt:s.createdAt??n}))},Bw=async(t,e=[])=>{if(!t)throw new Error("replacePreparationLog requires datasetId.");const s=(await In([Ai],{mode:"readwrite"})).transaction(Ai,"readwrite"),i=s.objectStore(Ai);let u=await i.index("by_dataset").openCursor(t);for(;u;)await u.delete(),u=await u.continue();if(e.length>0){const d=XU(t,e).sort((p,m)=>p.stepOrder-m.stepOrder||new Date(p.createdAt).getTime()-new Date(m.createdAt).getTime());for(const p of d)await i.put(p)}await s.done},WU=async(t,e,n=OU)=>{const s=await t.index("by_dataset").getAll(e);if(s.length<=n)return;const i=s.sort((d,p)=>{const m=(p.qualityScore??0)-(d.qualityScore??0);return m!==0?m:new Date(p.createdAt).getTime()-new Date(d.createdAt).getTime()}).slice(0,n),o=new Set(i.map(d=>d.id)),u=s.filter(d=>!o.has(d.id));for(const d of u)await t.delete(d.id)},Vw=async t=>{var o,u;if(!t.datasetId)throw new Error("saveMemorySnapshot requires datasetId.");const n=(await In([Hs],{mode:"readwrite"})).transaction(Hs,"readwrite"),s=n.objectStore(Hs),i={...t,id:t.id??t.viewId??t.cardId??`${t.datasetId}-memo-${gl()}`,createdAt:t.createdAt??new Date().toISOString(),plan:t.plan??null,viewId:t.viewId??null,cardId:t.cardId??null,summary:t.summary??"",title:t.title??"Untitled View",sampleRows:t.sampleRows??[],tags:t.tags??[],chartType:t.chartType??((o=t.plan)==null?void 0:o.chartType),queryHash:t.queryHash??null,rowCount:typeof t.rowCount=="number"?t.rowCount:((u=t.sampleRows)==null?void 0:u.length)??0,sampled:t.sampled??!1,expiresAt:t.expiresAt??null};return await s.put(i),await WU(s,i.datasetId),await n.done,i.id},QU=async(t,e)=>{if(!t)return[];const n=await In([Hs]);try{const s=n.transaction(Hs,"readonly"),u=await s.objectStore(Hs).index("by_dataset").getAll(t);await s.done;const d=u.filter(m=>e!=null&&e.minScore?(m.qualityScore??0)>=e.minScore:!0).filter(m=>{var v;return e!=null&&e.tag?(v=m.tags)==null?void 0:v.includes(e.tag):!0}).sort((m,v)=>{const S=(v.qualityScore??0)-(m.qualityScore??0);return S!==0?S:new Date(v.createdAt).getTime()-new Date(m.createdAt).getTime()}),p=(e==null?void 0:e.limit)??d.length;return d.slice(0,p)}catch(s){return console.warn(`Failed to read memory snapshots for ${t}`,s),[]}},eO=2e3,tO=async t=>{try{const[e,n]=await Promise.all([eT(t,eO),KU(t)]);if(n===0||e.length===0)return console.warn(`CSV Agent: unable to rebuild column metadata for ${t} because the dataset has no cached rows.`),null;const s=Wo(e),i={datasetId:t,columnCount:s.length,columns:s,rowCount:n,updatedAt:new Date().toISOString()},u=(await In([Jn],{mode:"readwrite"})).transaction(Jn,"readwrite");return await u.objectStore(Jn).put(i),await u.done,console.info(`CSV Agent: rebuilt missing column metadata for dataset ${t}.`),i}catch(e){return console.error(`CSV Agent: failed to rebuild column metadata for dataset ${t}.`,e),null}},nO=async t=>{const e=await Lh(t);return e||tO(t)},sO=t=>({id:t.id??`audit-${Date.now()}-${gl()}`,kind:t.kind,severity:t.severity,message:t.message,details:t.details??null,tags:t.tags??[],createdAt:t.createdAt??new Date().toISOString()}),aO=async(t,e)=>{const n=t.index("by_created_at"),s=await n.count();if(s<=e)return;let i=await n.openCursor(void 0,"next"),o=s-e;for(;i&&o>0;)await i.delete(),o-=1,i=await i.continue()},rO=async(t,e)=>{const n=sO(t),i=(await In([Ei],{mode:"readwrite"})).transaction(Ei,"readwrite"),o=i.objectStore(Ei);return await o.put(n),await aO(o,UU),await i.done,n},Mt={FULL_SCAN_BLOCKED:"FULL_SCAN_BLOCKED",AGG_TIMEOUT:"AGG_TIMEOUT",COLUMN_METADATA_MISSING:"COLUMN_METADATA_MISSING",VERSION_ERROR:"VERSION_ERROR",ORIGIN_BLOCKED:"ORIGIN_BLOCKED",DATASET_UNCHANGED:"DATASET_UNCHANGED",INDEXEDDB_UNAVAILABLE:"INDEXEDDB_UNAVAILABLE",UNKNOWN:"UNKNOWN"},iO="COLUMN_METADATA_MISSING",Vh=()=>{throw Object.assign(new Error(Mt.COLUMN_METADATA_MISSING),{code:Mt.COLUMN_METADATA_MISSING})},oO=t=>{let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n),e|=0;return Math.abs(e).toString(36)},nT=t=>{const e=t.caseStrategy==="lower"?n=>n.toLowerCase():n=>n;return n=>{if(n==null)return t.nullReplacement;let s=typeof n=="string"?n:String(n);return t.trimWhitespace&&(s=s.trim()),s.length===0?t.nullReplacement:e(s)}},lO=nT(hl()),uO=(t,e=lO)=>e(t),cO=(t,e,n=3)=>{const s=[];for(const i of t){const o=i[e];if(o==null||o==="")continue;const u=uO(o);if(u&&(s.includes(u)||s.push(u),s.length>=n))break}return s},dO=async(t,e)=>{const{datasetId:n,sampleSize:s=jC}=e;if(!n)throw new Error("datasetId is required for profiling.");const[i,o]=await Promise.all([t.readColumnStoreRecord(n),t.readSampledRows(n,s)]);if(i||Vh(),o.length===0)throw new Error("No rows available to profile.");const d=Wo(o).map(m=>({name:m.name,type:m.type,distinct:m.uniqueValues??new Set(o.map(v=>v[m.name])).size,emptyPercentage:m.missingPercentage??0,examples:cO(o,m.name)})),p=[];return i.rowCount>o.length&&p.push(`Profiled ${o.length.toLocaleString()} rows (sample) out of ${i.rowCount.toLocaleString()}.`),{rowCount:i.rowCount,sampledRows:o.length,columns:d,warnings:p}},fO=(t,e,n)=>!e||e.length===0?!0:e.every(s=>{const i=t[s.column],o=n(i),u=n(s.value??""),d=p=>s.caseInsensitive?p.toLowerCase():p;switch(s.op){case"eq":return d(o)===d(u);case"neq":return d(o)!==d(u);case"gt":return Number(o)>Number(u);case"gte":return Number(o)>=Number(u);case"lt":return Number(o)<Number(u);case"lte":return Number(o)<=Number(u);case"contains":{const p=o.toLowerCase(),m=u.toLowerCase();return p.includes(m)}case"in":{if(!Array.isArray(s.values))return!1;const p=s.values.map(S=>n(S)),m=new Set(p.map(S=>s.caseInsensitive?S.toLowerCase():S)),v=s.caseInsensitive?o.toLowerCase():o;return m.has(v)}default:return!0}}),qw=(t,e,n,s,i)=>{var z;const o=e.mode??"full";if(!Array.isArray(e.metrics)||e.metrics.length===0)throw new Error("metrics[] is required for aggregation.");if(o==="full"&&!e.allowFullScan)throw Object.assign(new Error(Mt.FULL_SCAN_BLOCKED),{code:Mt.FULL_SCAN_BLOCKED});const u=e.by??[],d=new Map,p=((z=e.filter)==null?void 0:z.length)??0,m=e.timeoutMs??YC,v=(typeof performance<"u"?performance.now():Date.now())+m,S=hl(i),w=nT(S);for(const ae of t){if(!fO(ae,e.filter,w))continue;if((typeof performance<"u"?performance.now():Date.now())>v){if(o==="full")throw new Error("AGG_TIMEOUT");break}const J=u.map(ne=>w(ae[ne])),j=J.length>0?J.join("||"):"__total__";if(!d.has(j)){const ne={};u.forEach((_,E)=>{ne[_]=J[E]});const le={};e.metrics.forEach(_=>{const E=_.as??`${_.fn}_${_.column??"rows"}`;le[E]={sum:0,count:0,min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY}}),d.set(j,{keys:ne,accumulators:le})}const X=d.get(j);e.metrics.forEach(ne=>{const le=ne.as??`${ne.fn}_${ne.column??"rows"}`,_=X.accumulators[le];if(ne.fn==="count"){_.count+=1,_.sum+=1;return}if(!ne.column)throw new Error(`Metric ${ne.fn} requires a column.`);const E=Nn(ae[ne.column]);E!==null&&(_.count+=1,_.sum+=E,_.min=Math.min(_.min,E),_.max=Math.max(_.max,E))})}const C=ae=>{if(!ae||!s)return"number";const Q=s.find(J=>J.name===ae);return!Q||Q.type==="numerical"?"number":Q.type},M=[...u.map(ae=>{var Q;return{name:ae,type:((Q=s==null?void 0:s.find(J=>J.name===ae))==null?void 0:Q.type)??"string"}}),...e.metrics.map(ae=>({name:ae.as??`${ae.fn}_${ae.column??"rows"}`,type:ae.fn==="count"?"number":C(ae.column)}))],I=[];for(const ae of d.values()){const Q={...ae.keys};e.metrics.forEach(J=>{const j=J.as??`${J.fn}_${J.column??"rows"}`,X=ae.accumulators[j];let ne=null;switch(J.fn){case"sum":ne=X.sum;break;case"avg":ne=X.count>0?X.sum/X.count:null;break;case"count":ne=X.count;break;case"min":ne=X.min===Number.POSITIVE_INFINITY?null:X.min;break;case"max":ne=X.max===Number.NEGATIVE_INFINITY?null:X.max;break}Q[j]=ne??0}),I.push(Q)}e.orderBy&&e.orderBy.length>0&&I.sort((ae,Q)=>{for(const J of e.orderBy){const j=(J.direction??"desc").toLowerCase()==="asc"?1:-1,X=ae[J.column],ne=Q[J.column];if(X===ne)continue;if(X==null)return 1;if(ne==null)return-1;if(typeof X=="number"&&typeof ne=="number")return X>ne?j:-j;const le=String(X).localeCompare(String(ne));if(le!==0)return le*j}return 0});const k=typeof e.limit=="number"?I.slice(0,e.limit):I,F=t.length,V=o!=="full"&&F<n,G=[];return V&&G.push("Aggregated on sampled rows. Retry with allowFullScan for full coverage."),{schema:M,rows:k,provenance:{datasetId:e.datasetId,sampled:V,mode:o,processedRows:F,totalRows:n,queryHash:oO(JSON.stringify({by:u,metrics:e.metrics,filter:e.filter,orderBy:e.orderBy,limit:e.limit,mode:o})),filterCount:p,warnings:G,normalization:KC(S)}}},mO=async(t,e)=>{const[n,s]=await Promise.all([t.readColumnStoreRecord(e.datasetId),t.readDatasetRuntimeConfig(e.datasetId)]);n||Vh();const i=e.mode??"full",o=i;e.mode=o;const u=e.sampleSize??JC;try{const d=o==="full"?await t.readAllRows(e.datasetId):await t.readSampledRows(e.datasetId,u);if(d.length===0)throw new Error("No rows available for aggregation.");const p=qw(d,e,n.rowCount,n.columns,s==null?void 0:s.stringStrategy);return p.provenance.requestedMode=i,p}catch(d){if(d instanceof Error&&(d.code===Mt.FULL_SCAN_BLOCKED||d.message===Mt.FULL_SCAN_BLOCKED))throw Object.assign(new Error("Full scan requires confirmation."),{code:Mt.FULL_SCAN_BLOCKED});if(d instanceof Error&&d.message==="AGG_TIMEOUT"&&o==="full"){const p=await t.readSampledRows(e.datasetId,u),m=qw(p,{...e,mode:"sample"},n.rowCount,n.columns,s==null?void 0:s.stringStrategy);return m.provenance.warnings.push("Full scan timed out. "),m.provenance.requestedMode=i,m.provenance.downgradedFrom=i,m.provenance.downgradeReason="timeout",m}throw d instanceof Error&&d.message==="AGG_TIMEOUT"?Object.assign(d,{code:Mt.AGG_TIMEOUT}):d}},pO=async(t,e)=>{const{datasetId:n,n:s=IU,withColumns:i=!1}=e;if(!n)throw new Error("datasetId is required for sampling.");const[o,u]=await Promise.all([t.readSampledRows(n,s),i?t.readColumnStoreRecord(n):Promise.resolve(null)]);if(i&&!u&&Vh(),o.length===0)throw new Error("No rows available to sample.");return{rows:o,sampled:!0,columns:u==null?void 0:u.columns}};let yr=null;const xi=new Map;let ic=null;const hO=()=>{if(typeof window>"u"||typeof Worker>"u")throw new Error("Web Workers are not supported in this environment.");const t=new Worker(new URL("/agent_csv_dataWorker-BBZr3Tqp.js",import.meta.url),{type:"module"});return t.onmessage=e=>{const n=e.data;if(!n||typeof n.id!="string")return;const s=xi.get(n.id);s&&(xi.delete(n.id),s(n))},t.onerror=e=>{console.error("dataWorker runtime error:",e);const n=e!=null&&e.message&&typeof e.message=="string"?`Data worker crashed: ${e.message}`:"Data worker crashed.";xi.forEach(s=>s({id:"error",ok:!1,reason:n,hint:"Reload and retry your action."})),xi.clear(),t.terminate(),yr=null},t},gO=()=>(yr=yr??hO(),yr),yO=async(t,e)=>{try{const n=gO(),s=`${t}-${Date.now()}-${Math.random().toString(36).slice(2,8)}`;return await new Promise(i=>{xi.set(s,o=>{o.ok&&o.result?i({ok:!0,data:o.result,durationMs:o.durationMs??0}):i({ok:!1,reason:o.reason??"Worker failed to respond.",hint:o.hint,durationMs:o.durationMs,code:o.code})}),n.postMessage({id:s,action:t,payload:e})})}catch(n){return{ok:!1,reason:n instanceof Error?n.message:"Failed to start worker.",hint:"This browser may not support Web Workers. Try a modern Chromium-based browser."}}},vO=t=>{ic||(ic=t??"Data worker disabled due to browser limitations.",yr&&(yr.terminate(),yr=null),xi.clear(),console.warn(`[dataTools] Worker disabled: ${ic}`))},xO=(t,e)=>{const n=`${t??""} ${e??""}`.toLowerCase();return n.includes("indexeddb")||n.includes("falling back to main thread")},ki=()=>typeof performance<"u"?performance.now():Date.now(),qh=t=>t instanceof Error?t.message:String(t??"Unknown error"),Fw=t=>typeof t!="string"?!1:t.toUpperCase().includes(iO),SO=async t=>{try{return await nO(t)?(console.info(`[dataTools] Rebuilt column metadata for dataset ${t}.`),!0):(console.warn(`[dataTools] Unable to rebuild column metadata for dataset ${t}.`),!1)}catch(e){return console.error(`[dataTools] Failed to recover column metadata for dataset ${t}.`,e),!1}},Lm=async(t,e)=>{let n=await e();if(!t||n.ok||!Fw(n.reason))return n;if(!await SO(t))return{ok:!1,reason:"Cached column metadata is unavailable and auto-recovery failed. Please re-upload your CSV.",hint:n.hint,durationMs:n.durationMs};const i=await e();return!i.ok&&Fw(i.reason)?{ok:!1,reason:"Cached column metadata is still missing. Please re-upload your CSV.",hint:i.hint,durationMs:i.durationMs}:i},Fh={readColumnStoreRecord:Lh,readSampledRows:eT,readAllRows:tT,readDatasetRuntimeConfig:QC},wO=async(t,e)=>{try{const n=ki();return{ok:!0,data:await dO(Fh,{datasetId:t,sampleSize:e}),durationMs:ki()-n}}catch(n){return{ok:!1,reason:qh(n)}}},_O=async(t,e)=>{try{const n=ki();return{ok:!0,data:await pO(Fh,{datasetId:t,...e}),durationMs:ki()-n}}catch(n){return{ok:!1,reason:qh(n)}}},bO=async t=>{try{const e=ki();return{ok:!0,data:await mO(Fh,t),durationMs:ki()-e}}catch(e){return{ok:!1,reason:qh(e)}}},Um=async(t,e,n)=>{if(ic)return n();const s=await yO(t,e);return!s.ok&&xO(s.reason,s.hint)?(vO(s.reason??s.hint),n()):s},ps={profile:(t,e)=>Lm(t,()=>Um("profile",{datasetId:t,sampleSize:e},()=>wO(t,e))),sample:(t,e)=>Lm(t,()=>Um("sample",{datasetId:t,...e??{}},()=>_O(t,e??{}))),aggregate:t=>Lm(t.datasetId,()=>Um("aggregate",t,()=>bO(t))),createCardFromResult:async({datasetId:t,title:e,kind:n,explainer:s,result:i,plan:o})=>{try{const u={schema:i.schema,rows:i.rows,sampled:i.provenance.sampled,source:"aggregate",planSnapshot:o};return{ok:!0,data:{cardId:await XC({datasetId:t,title:e,kind:n,queryHash:i.provenance.queryHash,explainer:s,dataRef:u})},durationMs:0}}catch(u){return{ok:!1,reason:u instanceof Error?u.message:"Failed to store card.",hint:"Retry after checking IndexedDB permissions."}}}},$h="csv_agent_last_dataset",sT=t=>{try{t()}catch(e){console.warn("Dataset cache error:",e)}},aT=t=>{sT(()=>{typeof localStorage>"u"||localStorage.setItem($h,t)})},CO=()=>{sT(()=>{typeof localStorage>"u"||localStorage.removeItem($h)})},TO=()=>{try{return typeof localStorage>"u"?null:localStorage.getItem($h)}catch(t){return console.warn("Dataset cache read error:",t),null}},AO=t=>{if(!t)return"AI transformation applied (row delta unknown).";const e=[`Rows ${t.rowsBefore.toLocaleString()}  ${t.rowsAfter.toLocaleString()}`];return t.removedRows>0&&e.push(`${t.removedRows.toLocaleString()} removed`),t.addedRows>0&&e.push(`${t.addedRows.toLocaleString()} added`),t.modifiedRows>0&&e.push(`${t.modifiedRows.toLocaleString()} modified`),t.noOp&&e.push("no row changes detected"),e.join(", ")},EO=(t,e,n,s)=>{if(!t)return[];const i=[],o=new Map(n.map(p=>[p.name,p])),u=new Map(s.map(p=>[p.name,p]));i.push({stepOrder:0,scope:"rows",columnName:null,rule:"ai_transformation",impactSummary:AO(e),impactMetrics:e?{...e,totalColumnsBefore:n.length,totalColumnsAfter:s.length}:{totalColumnsBefore:n.length,totalColumnsAfter:s.length},details:{explanation:t.explanation,beforeColumns:n.map(p=>({name:p.name,type:p.type})),afterColumns:s.map(p=>({name:p.name,type:p.type}))},source:"ai_plan",tags:["transformation"]});let d=1;return n.filter(p=>!u.has(p.name)).forEach(p=>{i.push({stepOrder:d++,scope:"column",columnName:p.name,rule:"column_removed",impactSummary:`Column "${p.name}" removed during AI cleanup.`,details:{previousType:p.type},source:"ai_plan",tags:["schema","removed"]})}),s.filter(p=>!o.has(p.name)).forEach(p=>{i.push({stepOrder:d++,scope:"column",columnName:p.name,rule:"column_added",impactSummary:`Column "${p.name}" added by AI transformation.`,details:{newType:p.type},source:"ai_plan",tags:["schema","added"]})}),s.filter(p=>{const m=o.get(p.name);return m&&m.type!==p.type}).forEach(p=>{const m=o.get(p.name);i.push({stepOrder:d++,scope:"column",columnName:p.name,rule:"column_type_change",impactSummary:`Column "${p.name}" type normalized from ${(m==null?void 0:m.type)??"unknown"} to ${p.type}.`,details:{previousType:m==null?void 0:m.type,newType:p.type},source:"ai_plan",tags:["schema","type_change"]})}),i},RO=(t,e,n)=>({handleFileUpload:async s=>{var u;const i=e();if(i.csvData&&i.csvData.data.length>0){const d=await sl(ka);if(d){const p=`report-${d.createdAt.getTime()}`,m={...d,id:p,updatedAt:new Date};try{await Np(m)}catch(v){console.error("Failed to archive current session before upload:",v)}}}ut.clear(),await Mp(ka),n.resetAutoSaveSession(),await e().loadReportsList(),t({...n.initialAppState,csvData:{fileName:s.name,data:[]},datasetHash:null,busyRunId:null,isCancellationRequested:!1,aiFilterRunId:null,abortControllers:{},toasts:[],chatMemoryPreview:[],chatMemoryExclusions:[],chatMemoryPreviewQuery:"",isMemoryPreviewLoading:!1});const o=e().beginBusy(`Processing ${s.name}...`,{cancellable:!0});try{const d=async I=>{try{const k=await ps.profile(I);k.ok?e().applyDatasetProfileSnapshot(k.data):e().addProgress(`Profiling failed: ${k.reason}`,"error")}catch(k){console.error("Failed to profile dataset via worker:",k),e().addProgress("Profiling worker failedretry later from chat.","error")}},p=async I=>{try{const k=await ps.sample(I,{n:200});k.ok&&t({initialDataSample:k.data.rows})}catch(k){console.error("Failed to sample dataset via worker:",k)}},m=async(I,k)=>{try{const F=await WC(I);if(F!=null&&F.checksum&&F.checksum===I){if(!(typeof window>"u"?!0:window.confirm(""))){e().addProgress(" CSV ","system");return}e().addProgress("")}t(G=>({analysisTimeline:{...G.analysisTimeline,stage:"persisting",totalCards:0,completedCards:0}})),e().addProgress("Persisting cleaned dataset for offline reuse");const V=await JU({datasetId:I,rows:S.data,columns:k,provenance:{fileName:s.name,bytes:s.size,checksum:I,cleanedAt:new Date().toISOString()}});aT(I),e().addProgress(`Cached ${V.rowCount} rows in ${V.chunkCount} chunks.`),t(G=>({analysisTimeline:{...G.analysisTimeline,stage:"profiling"}})),await Promise.all([d(I),p(I)])}catch(F){console.error("Failed to persist cleaned dataset:",F),e().addProgress("IndexedDB cache failedrefreshing may lose progress.","error"),t(V=>({analysisTimeline:{...V.analysisTimeline,stage:"idle"}}))}};e().updateBusyStatus("Parsing CSV file...");const v=await ZE(s);if(e().addProgress(`Parsed ${v.data.length} rows.`),e().isRunCancellationRequested(o)){e().addProgress("Upload cancelled before analysis.");return}t({initialDataSample:v.data.slice(0,20)});let S=v,w,C=null,M=[];if(e().isApiKeySet){e().updateBusyStatus("Initializing AI memory..."),await ut.init(e().addProgress),e().addProgress("AI is analyzing data for cleaning and reshaping...");const I=Wo(S.data);e().updateBusyStatus("Drafting data preparation plan...");const k=(u=e().createAbortController(o))==null?void 0:u.signal;if(C=await mL(I,S.data.slice(0,20),e().settings,{signal:k,onUsage:z=>{e().recordLlmUsage({provider:z.provider,model:z.model,promptTokens:z.promptTokens,completionTokens:z.completionTokens,totalTokens:z.totalTokens,context:z.operation??"data_prep.plan"})}}),e().isRunCancellationRequested(o)){e().addProgress("Upload cancelled during preparation.");return}const F=typeof(C==null?void 0:C.jsFunctionBody)=="string"?C.jsFunctionBody.trim():null;if(C&&F){e().addProgress(`AI Plan: ${C.explanation}`),e().addProgress("Executing AI data transformation...");try{const z=b_(S.data,C.jsFunctionBody);S.data=z.data;const{rowsBefore:ae,rowsAfter:Q,removedRows:J,addedRows:j,modifiedRows:X}=z.meta,ne=[`${ae}  ${Q} rows`];J&&ne.push(`${J} removed`),j&&ne.push(`${j} added`),X&&ne.push(`${X} modified`),e().addProgress(`Transformation complete (${ne.join(", ")}).`),M=EO(C,z.meta,I,C.outputColumns)}catch(z){const ae=z instanceof Error?z.message:String(z);throw e().addProgress(`Data transformation failed: ${ae}`,"error"),z}}else C&&e().addProgress(`AI Plan: ${C.explanation}`),e().addProgress("AI found no necessary data transformations.");if(w=C.outputColumns,S.data.length===0)throw new Error("Dataset empty after transformation.");const V=al(w.map(z=>z.name)),G=Tc(S);if(!G)throw new Error(" fingerprint");await m(G,w);try{await Bw(G,M)}catch(z){console.warn("Failed to persist preparation log entries:",z)}t({csvData:S,columnProfiles:w,columnAliasMap:V,datasetHash:G,datasetRuntimeConfig:null,dataPreparationPlan:C,currentView:"analysis_dashboard"}),await e().handleInitialAnalysis(S,{runId:o})}else{e().addProgress("API Key not set. Please add it in the settings.","error"),e().setIsSettingsModalOpen(!0),w=Wo(S.data);const I=al(w.map(F=>F.name)),k=Tc(S);if(!k)throw new Error("");await m(k,w);try{await Bw(k,[])}catch(F){console.warn("Failed to clear preparation log for dataset:",F)}t({csvData:S,columnProfiles:w,columnAliasMap:I,datasetHash:k,datasetRuntimeConfig:null,currentView:"analysis_dashboard"})}}catch(d){if(!e().isRunCancellationRequested(o)){console.error("File processing error:",d);const p=d instanceof Error?d.message:String(d);e().addProgress(`File Processing Error: ${p}`,"error"),t({currentView:"file_upload"})}}finally{e().endBusy(o)}},handleNewSession:async()=>{if(e().csvData){const s=await sl(ka);if(s){const i=`report-${s.createdAt.getTime()}`;try{await Np({...s,id:i,updatedAt:new Date})}catch(o){console.error("Failed to archive session before starting new one:",o)}}}ut.clear(),await Mp(ka),n.resetAutoSaveSession(),CO(),t({...n.initialAppState,busyRunId:null,isCancellationRequested:!1,aiFilterRunId:null,abortControllers:{},toasts:[],chatMemoryPreview:[],chatMemoryExclusions:[],chatMemoryPreviewQuery:"",isMemoryPreviewLoading:!1}),await e().loadReportsList()}}),NO=(t,e,n)=>({handleNaturalLanguageQuery:async s=>{var d;if(!e().isApiKeySet||!e().csvData){e().addProgress("Cannot perform AI query: API Key is not set or no data is loaded.","error");return}const i=e().aiFilterRunId;i&&e().abortRunControllers(i);const o=n.createRunId();t({isAiFiltering:!0,aiFilterRunId:o,spreadsheetFilterFunction:null,aiFilterExplanation:null}),e().addProgress(`AI is processing your data query: "${s}"...`);const u=(d=e().createAbortController(o))==null?void 0:d.signal;try{const p=await NL(s,e().columnProfiles,e().csvData.data.slice(0,5),e().settings,{signal:u,onUsage:m=>{e().recordLlmUsage({provider:m.provider,model:m.model,promptTokens:m.promptTokens,completionTokens:m.completionTokens,totalTokens:m.totalTokens,context:m.operation??"filter.generate"})}});t({spreadsheetFilterFunction:p.jsFunctionBody,aiFilterExplanation:p.explanation}),e().addProgress(`AI filter applied: ${p.explanation}`),e().addToast("AI filter applied successfully.","success")}catch(p){if(p instanceof DOMException&&p.name==="AbortError")e().addProgress("AI filter request cancelled."),e().addToast("AI filter cancelled.","info");else{const m=p instanceof Error?p.message:String(p);e().addProgress(`AI query failed: ${m}`,"error"),e().addToast(`AI filter failed: ${m}`,"error")}}finally{e().clearRunControllers(o),t(p=>p.aiFilterRunId===o?{isAiFiltering:!1,aiFilterRunId:null}:{})}},clearAiFilter:()=>{const s=e().aiFilterRunId;s&&e().abortRunControllers(s);const i=!!e().spreadsheetFilterFunction;if(t({spreadsheetFilterFunction:null,aiFilterExplanation:null,aiFilterRunId:null,isAiFiltering:!1}),i){const o={sender:"ai",text:"System note: Raw Data Explorer AI filter was cleared, so the table now shows all rows.",timestamp:new Date,type:"ai_message"};t(u=>({chatHistory:[...u.chatHistory,o]}))}e().addProgress("AI data filter cleared."),e().addToast("AI filter cleared.","info")},cancelAiFilterRequest:()=>{const{aiFilterRunId:s,isAiFiltering:i}=e();!s||!i||(e().abortRunControllers(s),t({isAiFiltering:!1,aiFilterRunId:null}),e().addProgress("AI data filter cancelled."),e().addToast("AI filter cancelled.","info"))}}),rT=5e3,$w=6e4;class MO{constructor(e){this.deps=e,this.timer=null,this.inFlight=!1,this.failureToastId=null,this.config={enabled:!0,intervalMs:15e3},this.backoffMs=0,this.lastCreatedAt=null}configure(e){const n={enabled:e.enabled,intervalMs:Math.max(rT,e.intervalMs)};if(this.config=n,!e.enabled){this.stop(),this.clearFailureToast();return}this.restart()}triggerImmediateSave(e=!1){!this.config.enabled&&!e||this.schedule(0,e)}resetSessionMetadata(){this.lastCreatedAt=null}seedCreatedAt(e){this.lastCreatedAt=e}stop(){this.timer&&(clearTimeout(this.timer),this.timer=null)}restart(){this.stop(),this.schedule(this.config.intervalMs)}schedule(e,n=!1){this.stop(),this.timer=setTimeout(()=>{this.performSave(n).finally(()=>{if(this.config.enabled){const s=this.config.intervalMs+this.backoffMs;this.schedule(s)}})},Math.max(0,e))}async performSave(e=!1){var s;if(this.inFlight||!this.config.enabled&&!e)return;const n=this.deps.getStore();if(this.shouldSave(n)){this.inFlight=!0;try{const i=this.deps.buildSnapshot(n),o=await this.ensureCreatedAt(),u={id:ka,filename:((s=n.csvData)==null?void 0:s.fileName)||"Current Session",createdAt:o,updatedAt:new Date,appState:i};await Np(u),this.backoffMs=0,this.clearFailureToast()}catch(i){console.error("Auto-save failed:",i),this.backoffMs=this.backoffMs===0?Math.min(this.config.intervalMs,$w):Math.min(this.backoffMs*2,$w),this.showFailureToast()}finally{this.inFlight=!1}}}async ensureCreatedAt(){if(this.lastCreatedAt)return this.lastCreatedAt;const e=await sl(ka);return this.lastCreatedAt=(e==null?void 0:e.createdAt)??new Date,this.lastCreatedAt}shouldSave(e){return!!(e.csvData&&e.csvData.data.length>0)}showFailureToast(){this.failureToastId||(this.failureToastId=this.deps.addToast("Auto-save failed. Click to retry now.","error",0,{label:"Retry now",onClick:()=>this.triggerImmediateSave(!0)}))}clearFailureToast(){this.failureToastId&&(this.deps.dismissToast(this.failureToastId),this.failureToastId=null)}}const IO=t=>({enabled:t.autoSaveEnabled,intervalMs:Math.max(rT,t.autoSaveIntervalSeconds*1e3)}),DO="modulepreload",PO=function(t){return"/"+t},Gw={},iT=function(e,n,s){let i=Promise.resolve();if(n&&n.length>0){let u=function(m){return Promise.all(m.map(v=>Promise.resolve(v).then(S=>({status:"fulfilled",value:S}),S=>({status:"rejected",reason:S}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),p=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));i=u(n.map(m=>{if(m=PO(m),m in Gw)return;Gw[m]=!0;const v=m.endsWith(".css"),S=v?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${S}`))return;const w=document.createElement("link");if(w.rel=v?"stylesheet":DO,v||(w.as="script"),w.crossOrigin="",w.href=m,p&&w.setAttribute("nonce",p),document.head.appendChild(w),v)return new Promise((C,M)=>{w.addEventListener("load",C),w.addEventListener("error",()=>M(new Error(`Unable to preload CSS for ${m}`)))})}))}function o(u){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=u,window.dispatchEvent(d),!d.defaultPrevented)throw u}return i.then(u=>{for(const d of u||[])d.status==="rejected"&&o(d.reason);return e().catch(o)})},oT=t=>{if(!t||typeof t!="object")return!1;const e=t;return typeof e.type=="string"&&e.type.startsWith("graph/")};let Om=null;const kO=async()=>typeof window>"u"?null:(Om||(Om=iT(()=>import("./agent_csv_runner-CMfmysBM.js"),[]).then(t=>t.default)),Om);class LO{constructor(){this.worker=null,this.listeners=new Set,this.pendingMessages=[],this.isReady=!1,this.isBooting=!1,this.handleWorkerMessage=e=>{oT(e.data)&&(e.data.type==="graph/ready"&&!this.isReady&&(this.isReady=!0,this.flushQueue()),this.listeners.forEach(n=>n(e.data)))},this.handleWorkerError=e=>{const n={type:"graph/error",message:e.message||"Graph worker error",timestamp:Date.now()};this.listeners.forEach(s=>s(n)),this.isReady=!1},this.isSupported=typeof window<"u"&&typeof Worker<"u"}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}ensureWorker(){!this.isSupported||this.worker||this.isBooting||(this.isBooting=!0,kO().then(e=>{!e||this.worker||(this.worker=new Worker(e,{name:"csv-agent-graph-worker",type:"module"}),this.worker.addEventListener("message",this.handleWorkerMessage),this.worker.addEventListener("error",this.handleWorkerError))}).catch(e=>{console.error("Failed to initialize graph worker:",e),this.handleWorkerError(new ErrorEvent("error",{message:(e==null?void 0:e.message)??String(e)}))}).finally(()=>{this.isBooting=!1}))}post(e){if(this.isSupported){if(this.ensureWorker(),!this.worker){this.pendingMessages.push(e);return}if(e.type==="graph/init"||this.isReady){this.worker.postMessage(e);return}this.pendingMessages.push(e)}}flushQueue(){if(!(!this.worker||!this.isReady||this.pendingMessages.length===0))for(;this.pendingMessages.length>0;){const e=this.pendingMessages.shift();e&&this.worker.postMessage(e)}}}const UO=new LO;let Bm=null;const OO=async()=>typeof window>"u"?null:(Bm||(Bm=iT(()=>import("./agent_csv_worker-AZMFhW9Z.js"),[]).then(t=>t.default)),Bm);class BO{constructor(){this.worker=null,this.listeners=new Set,this.pendingMessages=[],this.isReady=!1,this.isBooting=!1,this.handleWorkerMessage=e=>{oT(e.data)&&(e.data.type==="graph/ready"&&!this.isReady&&(this.isReady=!0,this.flushQueue()),this.listeners.forEach(n=>n(e.data)))},this.handleWorkerError=e=>{const n={type:"graph/error",message:e.message||"LangGraph worker error",timestamp:Date.now()};this.listeners.forEach(s=>s(n)),this.isReady=!1},this.isSupported=typeof window<"u"&&typeof Worker<"u"}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}async ensureWorker(){if(!(!this.isSupported||this.worker||this.isBooting)){this.isBooting=!0;try{const e=await OO();if(!e||this.worker)return;this.worker=new Worker(e,{name:"csv-agent-langgraph-worker",type:"module"}),this.worker.addEventListener("message",this.handleWorkerMessage),this.worker.addEventListener("error",this.handleWorkerError)}catch(e){console.error("Failed to initialize LangGraph worker:",e),this.handleWorkerError(new ErrorEvent("error",{message:(e==null?void 0:e.message)??String(e)}))}finally{this.isBooting=!1}}}post(e){if(this.isSupported){if(this.ensureWorker(),!this.worker){this.pendingMessages.push(e);return}if(e.type==="graph/init"||this.isReady){this.worker.postMessage(e);return}this.pendingMessages.push(e)}}flushQueue(){if(!(!this.worker||!this.isReady||this.pendingMessages.length===0))for(;this.pendingMessages.length>0;){const e=this.pendingMessages.shift();e&&this.worker.postMessage(e)}}}const VO=new BO,Pp=(t,e,n,s,i)=>{var k;if(!e||t.chartType==="scatter"||t.chartType==="combo"||!t.groupByColumn||!t.aggregation||t.aggregation!=="count"&&!t.valueColumn)return null;const o=t.valueColumn??"count",u=t.chartType==="line"?[{column:t.groupByColumn,direction:"asc"}]:[{column:o,direction:"desc"}],d=t.orderBy&&t.orderBy.length>0?t.orderBy.map(F=>({column:F.column,direction:F.direction??(t.chartType==="line"?"asc":"desc")})):u,p=(i==null?void 0:i.runtimeConfig)??null,m=s??((k=n==null?void 0:n.data)==null?void 0:k.length)??0,v=m>0?Math.min(5e3,m):5e3,S=(p==null?void 0:p.sampleSize)??v,w=m>0&&m<=DU,C=typeof t.limit=="number"?t.limit:t.defaultTopN,M={datasetId:e,by:[t.groupByColumn],metrics:[{fn:t.aggregation,column:t.aggregation==="count"?void 0:t.valueColumn,as:o}],filter:t.rowFilter?[{column:t.rowFilter.column,op:"in",values:t.rowFilter.values}]:void 0,limit:typeof C=="number"?C:void 0,mode:w?"full":"sample",sampleSize:S,orderBy:d,allowFullScan:(p==null?void 0:p.allowFullScan)??w,timeoutMs:p==null?void 0:p.timeoutMs},I=(i==null?void 0:i.preferredMode)??(p==null?void 0:p.mode);return w||I==="full"?(M.mode="full",M.allowFullScan=!0):(M.mode="sample",M.allowFullScan=(p==null?void 0:p.allowFullScan)??!1),M};class Hn extends Error{constructor(e,n){super(e),this.name="GraphToolExecutionError",this.code=n==null?void 0:n.code,this.suggestion=n==null?void 0:n.suggestion}}const qO=t=>{if(typeof t=="string"){const e=t.match(/(\d{4})[-/.](\d{1,2})/);if(e){const n=String(e[2]).padStart(2,"0");return`${e[1]}-${n}`}}return null},FO=async t=>{const{plan:e,datasetId:n,csvData:s,rowCountHint:i,options:o}=t,u=Pp(e,n,s,i,o);if(!u)throw new Hn("Plan is not eligible for aggregate tool.");const d=await ps.aggregate(u);if(!d.ok)throw new Hn(d.reason??"Aggregate tool failed.",{code:d.code,suggestion:d.hint});const p=d.data,m={source:p.provenance.mode,rows:p.rows.length,warnings:p.provenance.warnings??[],processedRows:p.provenance.processedRows,totalRows:p.provenance.totalRows,durationMs:d.durationMs??0},v=` ${e.title??"analysis"}: ${m.rows} ${m.source} ${m.warnings.length}`,S={kind:"aggregate_plan",planTitle:e.title??"analysis",rows:m.rows,viewId:p.provenance.queryHash};return{summary:v,meta:m,payload:S,rows:p.rows,schema:p.schema,viewId:p.provenance.queryHash,context:p}},$O=async(t,e)=>{if(!t)throw new Hn("Dataset unavailable for profiling.");const n=await ps.profile(t,e);if(!n.ok)throw new Hn(n.reason??"Profile tool failed.",{code:n.code,suggestion:n.hint});const s=`${n.data.columns.length}   ${n.data.rowCount.toLocaleString()}  ${n.data.sampledRows.toLocaleString()}`,i={source:n.data.sampledRows===n.data.rowCount?"full":"sample",rows:n.data.rowCount,warnings:n.data.warnings??[],processedRows:n.data.sampledRows,totalRows:n.data.rowCount,durationMs:n.durationMs??0},o={kind:"profile_dataset",columns:n.data.columns.length,rowCount:n.data.rowCount,sampledRows:n.data.sampledRows};return{summary:s,meta:i,payload:o,context:n.data}},GO=(t,e="InvoiceMonth")=>{if(!t)throw new Hn("Dataset unavailable for normalization.");let n=0,s=0;const i=new Set;for(const m of t.data){const v=qO(m[e]);v?(n++,i.size<6&&i.add(v)):s++}const o=n+s,u=` ${e} ${n.toLocaleString()} ${s.toLocaleString()}`,d={source:"full",rows:n,warnings:s?[`Skipped ${s} rows`]:[],processedRows:o,totalRows:o,durationMs:0},p={kind:"normalize_invoice_month",column:e,normalizedCount:n,skippedCount:s,sampleValues:Array.from(i)};return{summary:u,meta:d,payload:p}},HO=(t,e,n=2)=>{if(!t)throw new Hn("Dataset unavailable for outlier detection.");const s=t.data.map(w=>Number(w[e])).filter(w=>Number.isFinite(w));if(s.length===0)return{summary:` ${e}`,meta:{source:"full",rows:0,warnings:["No numeric values detected."],processedRows:t.data.length,totalRows:t.data.length,durationMs:0},payload:{kind:"detect_outliers",column:e,threshold:0,count:0,rows:[]}};const i=s.reduce((w,C)=>w+C,0)/s.length,o=s.reduce((w,C)=>w+Math.pow(C-i,2),0)/s.length,u=Math.sqrt(o),d=i+n*u,p=t.data.filter(w=>Number(w[e])>d).map(w=>{var C;return{label:w.id??((C=w[e])==null?void 0:C.toString())??"row",value:Number(w[e])}}).sort((w,C)=>C.value-w.value).slice(0,5),m=` ${e} ${p.length.toLocaleString()}  ${d.toFixed(2)}`,v={source:"full",rows:p.length,warnings:[],processedRows:t.data.length,totalRows:t.data.length,durationMs:0},S={kind:"detect_outliers",column:e,threshold:Number(d.toFixed(2)),count:p.length,rows:p};return{summary:m,meta:v,payload:S}},ci={aggregatePlan:FO,profileDataset:$O,normalizeInvoiceMonth:GO,detectOutliers:HO},zO=t=>{if(!(!t||t.length===0))for(const e of t){const n=typeof e.column=="string"&&e.column.trim().length>0?e.column.trim():null;if(n){if(e.op==="in"&&Array.isArray(e.value)){const s=e.value.filter(i=>typeof i=="string"||typeof i=="number");if(s.length>0)return{column:n,values:s};continue}if(!e.op||e.op==="="){const s=e.value;if(typeof s=="string"||typeof s=="number")return{column:n,values:[s]}}}}},jO=t=>{var p;if(t.tool!=="csv.aggregate")return null;const e=t.args.valueColumn??t.args.column;if(!e)return null;const n=((p=t.args.groupBy)==null?void 0:p[0])??void 0,s=t.args.aggregation??"sum",i=t.args.viewTitle??(n?`${s.toUpperCase()} of ${e} by ${n}`:`${s.toUpperCase()} of ${e}`),o=t.message??(n?`Aggregate ${e} by ${n} using ${s}.`:`Aggregate ${e} using ${s}.`),u=zO(t.args.filters),d=typeof t.args.topN=="number"?t.args.topN:n?8:void 0;return{chartType:"bar",title:i,description:o,aggregation:s,groupByColumn:n,valueColumn:e,defaultTopN:d,rowFilter:u,limit:t.args.limit??t.args.topN??void 0}},JO=t=>{if(!t||t.length===0)return[];const e=t[0];return Object.keys(e).map(n=>{const i=typeof e[n];return{name:n,type:i==="number"?"number":i==="boolean"?"boolean":i==="string"?"string":"unknown"}})},Ju={[Mt.FULL_SCAN_BLOCKED]:{title:"Full scan needs confirmation",detail:"Please ask the user before scanning every cached row."},[Mt.AGG_TIMEOUT]:{title:"Full scan timed out",detail:"The analysis fell back to a sampled preview. Retry or limit the scope."},[Mt.COLUMN_METADATA_MISSING]:{title:"Dataset cache incomplete",detail:"The cached schema is missing. Re-upload or rebuild the dataset to continue."},[Mt.VERSION_ERROR]:{title:"Browser storage mismatch",detail:"Local IndexedDB version changed. Refresh or clear site data, then retry."},[Mt.ORIGIN_BLOCKED]:{title:"Source not allowed",detail:"The embedding origin is not on the allow list for CSV hand-off."},[Mt.DATASET_UNCHANGED]:{title:"Dataset unchanged",detail:"This CSV matches the cached dataset. You can skip the import or force a refresh."},[Mt.INDEXEDDB_UNAVAILABLE]:{title:"Browser blocked storage access",detail:"IndexedDB is unavailable in this context. Enable storage permissions and retry."},[Mt.UNKNOWN]:{title:"Action failed",detail:"The agent could not finish this step. Try again or adjust your request."}},YO=(t,e)=>t&&Ju[t]?Ju[t]:e?{title:Ju[Mt.UNKNOWN].title,detail:e}:Ju[Mt.UNKNOWN],KO=[{provider:"openai",pattern:/gpt-4o-mini/i,tier:{promptPerMillion:.15,completionPerMillion:.6}},{provider:"openai",pattern:/gpt-4o-?mini-?audio/i,tier:{promptPerMillion:.3,completionPerMillion:1.2}},{provider:"openai",pattern:/gpt-4o/i,tier:{promptPerMillion:5,completionPerMillion:15}},{provider:"openai",pattern:/gpt-4-turbo/i,tier:{promptPerMillion:10,completionPerMillion:30}},{provider:"openai",pattern:/gpt-3\.5-turbo/i,tier:{promptPerMillion:.5,completionPerMillion:1.5}},{provider:"gemini",pattern:/gemini-1\.5-pro/i,tier:{promptPerMillion:7,completionPerMillion:21}},{provider:"gemini",pattern:/gemini-1\.5-flash/i,tier:{promptPerMillion:.35,completionPerMillion:1.05}},{provider:"gemini",pattern:/gemini-1\.(0|1)-pro/i,tier:{promptPerMillion:3.5,completionPerMillion:10.5}}],ZO={openai:{promptPerMillion:5,completionPerMillion:15},gemini:{promptPerMillion:3.5,completionPerMillion:10.5}},XO=(t,e)=>{const n=KO.find(s=>s.provider===t&&s.pattern.test(e));return(n==null?void 0:n.tier)??ZO[t]},WO=t=>{if(t.promptTokens==null&&t.completionTokens==null)return null;const e=XO(t.provider,t.model);if(!e)return null;const n=t.promptTokens??0,s=t.completionTokens??0,i=n/1e6*e.promptPerMillion,o=s/1e6*e.completionPerMillion,u=i+o;return!Number.isFinite(u)||u===0?null:Number(u.toFixed(6))},Hw=t=>t??"none",Yu=t=>`busy=${t.isBusy?"1":"0"} busyRunId=${Hw(t.busyRunId)} awaiting=${t.agentAwaitingUserInput?"1":"0"} graphRun=${Hw(t.graphActiveRunId)}`,QO=t=>{const e=[];return t.agentAwaitingUserInput&&t.isBusy&&e.push({code:"awaiting_still_busy",message:`Await prompt entered but busy flag still active (${Yu(t)}).`}),t.agentAwaitingUserInput&&t.graphActiveRunId&&e.push({code:"awaiting_has_active_run",message:`Await prompt entered but graphActiveRunId is still set (${Yu(t)}).`}),t.graphActiveRunId&&!t.isBusy&&e.push({code:"active_run_without_busy",message:`graphActiveRunId is set but busy flag is false (${Yu(t)}).`}),!t.isBusy&&t.busyRunId&&e.push({code:"stale_busy_run",message:`busyRunId remains populated after busy finished (${Yu(t)}).`}),{ok:e.length===0,violations:e}},e4=(t,e)=>{const n=QO(t);if(!n.ok){const s=(e==null?void 0:e.reporter)??(i=>console.warn(i.message));n.violations.forEach(i=>{s({...i,message:e!=null&&e.context?`[${e.context}] ${i.message}`:i.message})})}return n},t4=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`clar-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,n4=()=>`plan-warning-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,zw=()=>`run-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,s4=()=>`toast-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,a4=()=>`val-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,Ri=[100,300,1e3,null],r4=t=>t===null?" (Full dataset)":`${t.toLocaleString()} `,jw=t=>{if(!t)return 0;if(t.mode==="full"||t.allowFullScan)return Ri.length-1;const e=t.sampleSize??Ri[0]??100;let n=0;return Ri.forEach((s,i)=>{s!==null&&e>=s&&(n=i)}),n},Jw=(t,e,n)=>{if(!t)return null;if(e===null)return Ip(t,{mode:"full",allowFullScan:!0});const s=n?Math.min(e,n):e;return Ip(t,{mode:"sample",allowFullScan:!1,sampleSize:s,profileSampleSize:s})};let yn=null,Ac=null,Vm=!1,qm=null,Fm=!1,qs=null;const lT=t=>{Ac=IO(t),yn==null||yn.configure(Ac)},i4=()=>{yn==null||yn.resetSessionMetadata()},Yw=t=>{yn==null||yn.seedCreatedAt(t)},Kw=()=>{yn==null||yn.triggerImmediateSave(!0)},$m=(t,e)=>YO(t,e).detail,o4=(t,e,n,s)=>({id:`obs-tool-${t}-${Date.now().toString(36)}`,actionId:t,responseType:"execute_js_code",status:"success",timestamp:new Date().toISOString(),outputs:{summary:e,meta:n,payload:s}}),l4=(t,e,n,s)=>({id:`obs-tool-${t}-err-${Date.now().toString(36)}`,actionId:t,responseType:"execute_js_code",status:"error",timestamp:new Date().toISOString(),outputs:{summary:e,...n??{}},errorCode:s??Mt.UNKNOWN}),Zw=t=>typeof window>"u"?!0:window.confirm(`${t} 
`),Gm=6,u4=12,Xw=2,c4=10,uT=()=>({lastIndexedMessage:0,rawChunks:[],summaryChunks:[]}),d4=t=>({...t,id:`llm-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,timestamp:new Date().toISOString()}),f4=t=>{const e=[];return typeof t.promptTokens=="number"&&e.push(`in ${t.promptTokens}`),typeof t.completionTokens=="number"&&e.push(`out ${t.completionTokens}`),typeof t.totalTokens=="number"&&e.push(`total ${t.totalTokens}`),e.length>0?`tokens ${e.join(" / ")}`:"tokens n/a"},m4=t=>{const e=t.estimatedCostUsd!=null?`$${t.estimatedCostUsd.toFixed(4)}`:"cost n/a";return`${t.context}: ${t.provider}/${t.model}  ${f4(t)}, ${e}`},Ia=(t,e)=>({provider:t.provider,model:t.model,promptTokens:t.promptTokens,completionTokens:t.completionTokens,totalTokens:t.totalTokens,context:t.operation??e}),p4=t=>{const e=t.timestamp instanceof Date&&!Number.isNaN(t.timestamp.getTime())?t.timestamp:new Date(t.timestamp),n=t.sender==="ai"?"AI":"User";return`[${Number.isNaN(e.getTime())?"Unknown time":e.toLocaleString(void 0,{hour12:!1})}] ${n}: ${t.text}`},h4=(t,e=0)=>t.map((n,s)=>`${e+s+1}. ${p4(n)}`).join(`
`),kp={aggregate_plan:"Plan Preview",profile_dataset:"Dataset Profile",normalize_invoice_month:"Invoice Month Cleanup",detect_outliers:"Outlier Detection",tool_result:"Tool Result"},g4=t=>{const e=t.payload??{},s=[`[Observation] ${kp[t.kind]??t.kind}`];typeof e.summary=="string"?s.push(e.summary):typeof e.description=="string"&&s.push(e.description);const i=e.meta??{};typeof i.rows=="number"&&s.push(`${i.rows} `),typeof i.source=="string"&&s.push(i.source==="full"?"":"");const o=e.telemetry??i.telemetry;if(o){const u=o.tokenUsage;if(u){const d=[];u.promptTokens!=null&&d.push(`in ${u.promptTokens}`),u.completionTokens!=null&&d.push(`out ${u.completionTokens}`),u.totalTokens!=null&&d.push(`total ${u.totalTokens}`),d.length&&s.push(`Tok ${d.join(" / ")}`)}o.estimatedCostUsd!=null?s.push(`$${o.estimatedCostUsd.toFixed(4)}`):o.latencyMs!=null&&s.push(`${Math.round(o.latencyMs)} ms`)}else typeof i.durationMs=="number"&&s.push(`${Math.round(i.durationMs)} ms`);return s.join("  ")},y4=new Set(["numerical","currency","percentage"]),v4=new Set(["categorical","date","time"]),x4=t=>t.filter(e=>y4.has(e.type)).sort((e,n)=>{const s=e.numericSampleCount??e.nonNullCount??0;return(n.numericSampleCount??n.nonNullCount??0)-s})[0]??null,S4=(t,e)=>{var v;const n=Ph(t.filter(S=>v4.has(S.type)),e);if(n.length===0)return null;const s=n.find(S=>{const w=S.uniqueValues??0;return w>=4&&w<=40})??n[0],i=(v=s==null?void 0:s.profile)==null?void 0:v.name;if(!i)return null;const o=x4(t),u=(o==null?void 0:o.name)??null,d=u?`Top ${i} by ${u}`:`Top ${i} by count`,p=u?`Summarize the largest ${i} values using ${u}.`:`Show the most frequent ${i} categories.`;return{chartType:"bar",title:d,description:p,aggregation:u?"sum":"count",groupByColumn:i,valueColumn:u??void 0,defaultTopN:8,defaultHideOthers:!0,limit:8,orderBy:[{column:u??"count",direction:"desc"}]}},w4=t=>{var e;return((e=t.find(n=>n.status==="pending"))==null?void 0:e.id)??null},Ww=6,_4=(t,e,n)=>{if(e.promptId){const o=t.findIndex(u=>u.promptId===e.promptId);if(o>=0){const u=[...t];return u[o]={...u[o],question:e.question,optionsSnapshot:e.options,allowFreeText:e.allowFreeText,placeholder:e.placeholder,status:u[o].status==="answered"?"answered":"waiting"},u}}const s={promptId:e.promptId??null,question:e.question,optionsSnapshot:e.options,allowFreeText:e.allowFreeText,placeholder:e.placeholder,askedAt:n,status:"waiting"},i=[...t,s];return i.length>Ww?i.slice(-Ww):i},b4=(t,e,n,s)=>{if(!t.length)return t;let i=-1;if(e&&(i=t.findIndex(u=>u.promptId===e)),i===-1){for(let u=t.length-1;u>=0;u-=1)if(t[u].status==="waiting"){i=u;break}}if(i===-1)return t;const o=[...t];return o[i]={...o[i],status:"answered",respondedAt:n,responseLabel:s.label??s.value??null,responseValue:s.value,responseType:s.type},o},Qw=t=>{postGraphClientEvent({type:"graph/tool_result",verification:t,timestamp:Date.now()})&&postGraphClientEvent({type:"graph/runPipeline",payload:{reason:"verification"},timestamp:Date.now()})},C4=t=>{var e,n;switch(t.kind){case"profile_dataset":return"";case"normalize_invoice_month":return` ${typeof((e=t.params)==null?void 0:e.column)=="string"?t.params.column:"InvoiceMonth"}`;case"detect_outliers":return` ${typeof((n=t.params)==null?void 0:n.valueColumn)=="string"?t.params.valueColumn:"Amount"} `;case"aggregate_plan":default:return""}},e_=t=>(t??[]).map(e=>({id:typeof(e==null?void 0:e.id)=="string"?e.id.trim():"",label:typeof(e==null?void 0:e.label)=="string"?e.label.trim():"",intent:typeof(e==null?void 0:e.intent)=="string"&&e.intent.trim()||void 0,status:typeof(e==null?void 0:e.status)=="string"?e.status:void 0})).filter(e=>e.id.length>=3&&e.label.length>=3),T4=t=>{if(!t)return"report";const e=t.split(/\r?\n/).map(s=>s.trim()).find(Boolean);return e&&e.replace(/[^a-z0-9-_]+/gi,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||"report"},A4=t=>({currentView:t.currentView,isBusy:t.isBusy,busyMessage:t.busyMessage,canCancelBusy:t.canCancelBusy,progressMessages:t.progressMessages,csvData:t.csvData,columnProfiles:t.columnProfiles,analysisCards:t.analysisCards,chatHistory:t.chatHistory,finalSummary:t.finalSummary,aiCoreAnalysisSummary:t.aiCoreAnalysisSummary,dataPreparationPlan:t.dataPreparationPlan,initialDataSample:t.initialDataSample,datasetHash:t.datasetHash,vectorStoreDocuments:ut.getDocuments(),conversationMemoryState:t.conversationMemoryState,spreadsheetFilterFunction:t.spreadsheetFilterFunction,aiFilterExplanation:t.aiFilterExplanation,datasetProfile:t.datasetProfile,pendingClarifications:t.pendingClarifications,activeClarificationId:t.activeClarificationId,toasts:[],agentActionTraces:t.agentActionTraces,agentValidationEvents:t.agentValidationEvents,columnAliasMap:t.columnAliasMap,pendingDataTransform:t.pendingDataTransform,lastAppliedDataTransform:t.lastAppliedDataTransform,isLastAppliedDataTransformBannerDismissed:t.isLastAppliedDataTransformBannerDismissed,interactiveSelectionFilter:t.interactiveSelectionFilter,plannerSession:t.plannerSession,agentPhase:t.agentPhase,plannerPendingSteps:t.plannerPendingSteps,agentPromptMetrics:t.agentPromptMetrics,plannerDatasetHash:t.plannerDatasetHash,agentAwaitingUserInput:t.agentAwaitingUserInput,agentAwaitingPromptId:t.agentAwaitingPromptId,graphToolInFlight:t.graphToolInFlight,analysisTimeline:t.analysisTimeline,useLangGraphRuntime:t.useLangGraphRuntime,llmUsageLog:t.llmUsageLog,graphObservations:t.graphObservations,graphPhase:t.graphPhase,graphLoopBudget:t.graphLoopBudget}),E4=t=>{const e=new Date().toISOString().replace(/[:.]/g,"-");return`${T4(t)}-${e}.csv`},t_=async(t,e,n,s,i,o,u)=>{if(!t||t.length===0)return;let d=null;try{if(!(!!e&&!!n&&e===n)){ut.clear(),s("Skipped AI memory restore because the dataset changed since last session."),i("AI memory reset for this dataset.","info",5e3);return}if(!ut.getIsInitialized()&&(d=i("Preparing AI memory from history...","info",0),await ut.init(s)),!ut.getIsInitialized()){s("AI memory model failed to load; saved chat context is unavailable right now.","error"),d&&o(d);return}d&&o(d),ut.rehydrate(t),s(u),i("AI memory ready for this report.","success")}catch(p){d&&o(d),console.error("Failed to restore AI memory from saved session:",p),s("Restoring AI memory failed; chat recall may be incomplete this session.","error"),i("AI memory failed to load. Try reloading or re-importing the file.","error",6e3)}},Hm=320,R4=800,N4=600,n_=12,s_=(t=[])=>al(t.map(e=>e.name)),a_=(t,e,n)=>{const s=Math.min(t,60)/60,i=Math.max(.4,1-e*.15),o=n?.9:1;return Number(((.5+s*.5)*i*o).toFixed(3))},r_=t=>{const e=["auto-memory"];return t.chartType&&e.push(`chart:${t.chartType}`),t.groupByColumn&&e.push(`group:${t.groupByColumn}`),t.valueColumn&&e.push(`value:${t.valueColumn}`),t.aggregation&&e.push(`agg:${t.aggregation}`),e},Lp=t=>({observations:(t==null?void 0:t.observations)??[],planState:(t==null?void 0:t.planState)??null}),M4=(t,e)=>t.length!==e.length?!1:t.every((n,s)=>n===e[s]),zm=t=>{switch(t.chartType){case"line":return"trend";case"bar":case"pie":case"doughnut":case"combo":return"topn";default:return"kpi"}},I4=t=>{const e=t.dataRef.planSnapshot??{},n=e.chartType??"bar",s={chartType:n,title:e.title??t.title,description:e.description??t.explainer??"",aggregation:e.aggregation,groupByColumn:e.groupByColumn,valueColumn:e.valueColumn,xValueColumn:e.xValueColumn,yValueColumn:e.yValueColumn,secondaryValueColumn:e.secondaryValueColumn,secondaryAggregation:e.secondaryAggregation,defaultTopN:e.defaultTopN,defaultHideOthers:e.defaultHideOthers,rowFilter:e.rowFilter,orderBy:e.orderBy,limit:e.limit??null};return{id:t.id,plan:s,aggregatedData:t.dataRef.rows,summary:t.explainer,displayChartType:n,isDataVisible:!1,topN:e.defaultTopN??null,hideOthers:e.defaultHideOthers??!1,disableAnimation:!0,hiddenLabels:[],dataRefId:t.id,queryHash:t.queryHash,isSampledResult:t.dataRef.sampled,aggregationMeta:{mode:t.dataRef.sampled?"sample":"full",sampled:t.dataRef.sampled,processedRows:t.dataRef.rows.length,totalRows:t.dataRef.rows.length,warnings:[],lastRunAt:t.createdAt??new Date().toISOString(),requestedMode:t.dataRef.sampled?"sample":"full"},valueSchema:t.dataRef.schema}},Oo={currentView:"file_upload",isBusy:!1,busyMessage:null,canCancelBusy:!1,progressMessages:[],csvData:null,columnProfiles:[],analysisCards:[],chatHistory:[],finalSummary:null,aiCoreAnalysisSummary:null,dataPreparationPlan:null,initialDataSample:null,datasetHash:null,datasetRuntimeConfig:null,vectorStoreDocuments:[],conversationMemoryState:uT(),spreadsheetFilterFunction:null,aiFilterExplanation:null,datasetProfile:null,pendingClarifications:[],activeClarificationId:null,toasts:[],agentActionTraces:[],agentValidationEvents:[],columnAliasMap:{},pendingDataTransform:null,lastAppliedDataTransform:null,isLastAppliedDataTransformBannerDismissed:!1,interactiveSelectionFilter:null,plannerSession:Lp(),agentPhase:{phase:"idle",message:null,enteredAt:null},plannerPendingSteps:[],agentPromptMetrics:[],plannerDatasetHash:null,agentAwaitingUserInput:!1,agentAwaitingPromptId:null,analysisTimeline:{stage:"idle",totalCards:0,completedCards:0},aggregationModePreference:"full",graphStatus:"idle",graphStatusMessage:null,graphVersion:null,graphLastReadyAt:null,graphAwaitPrompt:null,graphAwaitPromptId:null,graphAwaitReason:null,graphAwaitHistory:[],graphSessionId:null,graphLastToolSummary:null,graphToolInFlight:null,useLangGraphRuntime:!0,llmUsageLog:[],graphObservations:[],graphPhase:"idle",graphLoopBudget:{maxActs:3,actsUsed:0,exceeded:!1},samplePolicy:{tiers:Ri,currentIndex:0,userConfirmedFullScan:!1,lastUpgradeReason:null},planValidationNotices:[],activeSchemaPhase:"plan"},qe=xR((t,e)=>{const n=_=>{const E=_.reasonHint??"Need your choice before I can keep the plan moving.",P={..._,reasonHint:E,id:t4(),status:"pending",contextType:_.contextType??"plan"};return t(D=>({pendingClarifications:[...D.pendingClarifications,P],activeClarificationId:P.id})),P},s=()=>e().useLangGraphRuntime?VO:UO,i=_=>{const E=s();return E.isSupported?(E.post(_),!0):!1},o=(_,E)=>{e().pendingClarifications.some(D=>D.id===_)&&t(D=>{const T=D.pendingClarifications.map(L=>L.id===_?{...L,status:E}:L),R=E==="pending"||E==="resolving"?_:w4(T);return{pendingClarifications:T,activeClarificationId:R}})},u=(_,E)=>{if(!E||E.length===0)return;const P=e().recordLlmUsage;E.forEach(D=>{P(Ia(D,`${_}.${D.label}`))})},d=_=>_?`Prompt ${_.charCount} chars (~${_.estimatedTokens} tok, ${_.promptLabel})`:null,p=_=>_?`Tier ${_.value===null?"Full dataset":`${_.value.toLocaleString()} rows`}${_.userConfirmedFullScan?" (user-approved full scan)":""}`:null,m=_=>{var R,L;if(!_)return;const E=[];_.requestId&&E.push(`req ${_.requestId}`);const P=d(_.promptProfile);P?E.push(P):typeof _.promptCharCountHint=="number"&&E.push(`Prompt ${_.promptCharCountHint} chars`);const D=p(_.sampleTier);D&&E.push(D),typeof _.latencyMs=="number"&&E.push(`${Math.round(_.latencyMs)} ms`),e().addProgress(`Graph LLM turn: ${E.join("  ")}`);const T=_.tokenUsage;if(T!=null&&T.provider&&(T!=null&&T.model)){const B=((R=_.promptProfile)==null?void 0:R.promptLabel)??"graph.turn";e().recordLlmUsage({provider:T.provider,model:T.model,promptTokens:T.promptTokens,completionTokens:T.completionTokens,totalTokens:T.totalTokens,estimatedCostUsd:T.estimatedCostUsd??void 0,context:`${B}.${((L=_.sampleTier)==null?void 0:L.label)??"tier_unknown"}`})}},v=_=>{if(!_)return null;try{return Nk(_)}catch(E){return console.warn("[IntentContract] Unable to normalize contract.",E),e().addProgress("Intent contract validation failed","error"),null}},S=_=>{switch(_.tool){case"csv.profile":return{kind:"profile_dataset",params:_.args.limit?{sampleSize:_.args.limit}:void 0};case"csv.clean_invoice_month":return{kind:"normalize_invoice_month",params:{column:_.args.column??"InvoiceMonth"}};case"csv.detect_outliers":return{kind:"detect_outliers",params:{valueColumn:_.args.valueColumn??_.args.column??"Amount",multiplier:_.args.thresholdMultiplier??2}};default:return null}},w=_=>{const E={kind:_.kind,label:C4(_),startedAt:new Date().toISOString()};t({graphToolInFlight:E})},C=()=>{t({graphToolInFlight:null})},M=(_,E)=>{const P=_.viewId?{..._.payload,viewId:_.viewId}:_.payload,D=(E==null?void 0:E.description)??kp[P.kind]??P.kind;t({graphLastToolSummary:_.summary}),e().addProgress(_.summary),Qw({description:D,summary:_.summary,meta:_.meta,payload:P}),e().appendPlannerObservation(o4(P.kind,_.summary,_.meta,P))},I=(_,E,P,D)=>{const T=$m(E,P),R=`${kp[_]??_} failed${T}`,L={suggestion:D??T,detail:P??null};return t({graphLastToolSummary:R}),e().addProgress(R,"error"),e().appendPlannerObservation(l4(_,T,L,E)),R},k=async _=>{var E,P;switch(_.tool){case"csv.aggregate":{const D=e().csvData;if(!D)return e().addProgress("","error"),!1;const T=jO(_);if(!T)return e().addProgress(" valueColumn  column","error"),!1;const R=e().datasetHash,L=((E=e().datasetProfile)==null?void 0:E.rowCount)??D.data.length,B={kind:"aggregate_plan",params:{planTitle:T.title??"analysis"}};w(B);try{const H=await ci.aggregatePlan({plan:T,datasetId:R,csvData:D,rowCountHint:L,options:{preferredMode:e().aggregationModePreference,runtimeConfig:e().datasetRuntimeConfig}});return M(H,{description:T.title??"analysis"}),await G(T,H)?(e().addProgress(` "${T.title}" `),!0):(e().addProgress(` "${T.title}" `,"error"),!1)}catch(H){const N=H instanceof Hn?H:null;return I("aggregate_plan",N==null?void 0:N.code,(N==null?void 0:N.message)??(H instanceof Error?H.message:String(H)),N==null?void 0:N.suggestion),!1}finally{C()}}case"ui.remove_card":{const D=_.args.cardId??null;if(!D)return e().addProgress("contract  cardId","error"),!1;const T={toolName:"removeCard",target:{byId:D},args:{cardId:D}};return e().executeDomAction(T),!0}case"idb.save_view":{const D=e().datasetHash;if(!D)return e().addProgress("","error"),!1;const T=_.args.cardId??null;if(!T)return e().addProgress("contract  cardId","error"),!1;const R=e().analysisCards.find(q=>q.id===T);if(!R)return e().addProgress(` ${T}`,"error"),!1;if(!R.aggregatedData||R.aggregatedData.length===0)return e().addProgress(` "${R.plan.title}"`,"error"),!1;if(R.dataRefId)return e().addProgress(` "${R.plan.title}" `),!0;const B={schema:R.valueSchema??JO(R.aggregatedData),rows:R.aggregatedData,sampled:R.isSampledResult??((P=R.aggregationMeta)==null?void 0:P.sampled)??!1,source:"aggregate",planSnapshot:R.plan},H=_.args.viewTitle??R.plan.title??"Saved view",N=R.queryHash??`manual-${Date.now().toString(36)}`;try{const q=await XC({datasetId:D,title:H,kind:zm(R.plan),queryHash:N,explainer:R.summary,dataRef:B});return t(te=>({analysisCards:te.analysisCards.map(re=>re.id===T?{...re,dataRefId:q,queryHash:N}:re)})),e().addProgress(` "${H}" `),!0}catch(q){const te=q instanceof Error?q.message:String(q);return e().addProgress(`${te}`,"error"),!1}}default:return!1}},F=_=>{if(!_||typeof _!="object")return!1;const E=_;return typeof E.provenance=="object"&&E.provenance!==null},V=(_,E)=>{const P=E==null?void 0:E.provenance,D=new Date().toISOString();return{mode:(P==null?void 0:P.mode)??(_.meta.source==="full"?"full":"sample"),sampled:(P==null?void 0:P.sampled)??_.meta.source!=="full",processedRows:(P==null?void 0:P.processedRows)??_.meta.processedRows??_.meta.rows,totalRows:(P==null?void 0:P.totalRows)??_.meta.totalRows??_.meta.rows,warnings:(P==null?void 0:P.warnings)??_.meta.warnings??[],durationMs:_.meta.durationMs,lastRunAt:D,filterCount:P==null?void 0:P.filterCount,requestedMode:P==null?void 0:P.requestedMode,downgradedFrom:P==null?void 0:P.downgradedFrom,downgradeReason:P==null?void 0:P.downgradeReason,normalization:P==null?void 0:P.normalization}},G=async(_,E)=>{var ue;const P=Array.isArray(E.rows)?E.rows:[];if(P.length===0)return e().addProgress(`Graph plan "${_.title??"analysis"}" `,"error"),null;const D=e().settings;let T=` "${_.title??"analysis"}"`;try{T=await yw(_.title??"analysis",P,D,{onUsage:pe=>{e().recordLlmUsage(Ia(pe,"summary.generate"))}})}catch(pe){console.warn("Graph aggregate summary failed:",pe)}const R=F(E.context)?E.context:null,L=V(E,R),B=e().datasetHash;let H=null,N=(R==null?void 0:R.provenance.queryHash)??E.viewId??E.payload.viewId??null;if(R&&B)try{const pe=await ps.createCardFromResult({datasetId:B,title:_.title,kind:zm(_),explainer:T,result:R,plan:_});pe.ok?H=pe.data.cardId:e().addProgress(`View cache save failed for "${_.title}": ${pe.reason}`,"error")}catch(pe){console.warn("Failed to persist aggregate plan result:",pe)}const q=P.length,te=_.chartType!=="scatter"&&q>15,re={id:`card-${Date.now()}-${Math.random()}`,plan:_,aggregatedData:P,summary:T,displayChartType:_.chartType,isDataVisible:!1,topN:te?8:_.defaultTopN??null,hideOthers:te?!0:_.defaultHideOthers??!1,disableAnimation:e().analysisCards.length>0,hiddenLabels:[],dataRefId:H,queryHash:N,isSampledResult:L.sampled,aggregationMeta:L,valueSchema:E.schema??(R==null?void 0:R.schema)};t(pe=>({analysisCards:[...pe.analysisCards,re]}));const de=`[Chart: ${_.title}] Description: ${_.description}. AI Summary: ${T.split("---")[0]}`;try{await ut.addDocument({id:re.id,text:de,metadata:{kind:"card",summaryLevel:"summary",cardId:re.id,createdAt:new Date().toISOString()}}),e().addProgress(`View #${re.id.slice(-6)} indexed for long-term memory.`)}catch(pe){console.warn("Failed to index view in vector store:",pe)}if(B&&H){const pe=((ue=L.warnings)==null?void 0:ue.length)??0,Ae={datasetId:B,viewId:H,cardId:re.id,title:_.title,summary:T,plan:_,chartType:_.chartType,schema:E.schema??(R==null?void 0:R.schema)??[],sampleRows:P.slice(0,n_),rowCount:P.length,sampled:L.sampled,queryHash:N,qualityScore:a_(P.length,pe,L.sampled),tags:r_(_)};Vw(Ae).catch(Fe=>console.warn("Failed to persist memory snapshot for dataset cache:",Fe))}return e().addProgress(`Graph  "${_.title}"${P.length} `),re},z=async _=>{var E,P,D,T;if(!_)return!1;switch(_.kind){case"profile_dataset":{const R=e().datasetHash;if(!R)return e().addProgress("Graph profile request skipped","error"),!1;w(_);try{const L=typeof((E=_.params)==null?void 0:E.sampleSize)=="number"?_.params.sampleSize:e().getSampleSizeHint("profile"),B=await ci.profileDataset(R,L);return M(B,{description:"Dataset profile"}),!0}catch(L){const B=L instanceof Hn?L:null;return I("profile_dataset",B==null?void 0:B.code,(B==null?void 0:B.message)??(L instanceof Error?L.message:String(L)),B==null?void 0:B.suggestion),!1}finally{C()}}case"normalize_invoice_month":{const R=e().csvData;if(!R)return e().addProgress("Graph normalize request skipped CSV ","error"),!1;const L=typeof((P=_.params)==null?void 0:P.column)=="string"?_.params.column:"InvoiceMonth";w(_);try{const B=ci.normalizeInvoiceMonth(R,L);return M(B,{description:`Normalize ${L}`}),!0}catch(B){const H=B instanceof Hn?B:null;return I("normalize_invoice_month",H==null?void 0:H.code,(H==null?void 0:H.message)??(B instanceof Error?B.message:String(B)),H==null?void 0:H.suggestion),!1}finally{C()}}case"detect_outliers":{const R=e().csvData;if(!R)return e().addProgress("Graph outlier request skipped CSV ","error"),!1;const L=typeof((D=_.params)==null?void 0:D.valueColumn)=="string"?_.params.valueColumn:null;if(!L)return e().addProgress("Graph outlier request failed valueColumn","error"),!1;const B=typeof((T=_.params)==null?void 0:T.multiplier)=="number"?_.params.multiplier:2;w(_);try{const H=ci.detectOutliers(R,L,B);return M(H,{description:`Detect outliers (${L})`}),!0}catch(H){const N=H instanceof Hn?H:null;return I("detect_outliers",N==null?void 0:N.code,(N==null?void 0:N.message)??(H instanceof Error?H.message:String(H)),N==null?void 0:N.suggestion),!1}finally{C()}}default:return!1}},ae=_=>{var E;return _?(E=e().createAbortController(_))==null?void 0:E.signal:void 0},Q=async(_,E)=>{if(!_)return null;try{const P=await Bh(_,{rowCountHint:E});return t(D=>{const T=jw(P),R={...D.samplePolicy,currentIndex:T,userConfirmedFullScan:P.mode==="full"||P.allowFullScan,lastUpgradeReason:null};return{datasetRuntimeConfig:P,aggregationModePreference:P.mode,samplePolicy:R}}),P}catch(P){return console.error("Failed to sync dataset runtime config:",P),null}},J=async(_,E,P)=>{try{const D=await ZU(_,E,P);return t(T=>{const R=jw(D),L={...T.samplePolicy,currentIndex:R,userConfirmedFullScan:D.mode==="full"||D.allowFullScan};return{datasetRuntimeConfig:D,aggregationModePreference:D.mode,samplePolicy:L}}),D}catch(D){return console.error("Failed to update dataset runtime config:",D),null}},j=RU(t,e,{registerClarification:n,updateClarificationStatus:o,getRunSignal:ae}),X=async _=>{var E;e().addProgress("Restoring cached dataset from IndexedDB");try{const[P,D,T,R]=await Promise.all([WC(_),Lh(_),tT(_),YU(_)]);if(!T||T.length===0)return e().addProgress("Cached dataset was empty. Please re-upload your CSV.","error"),!1;const L={fileName:(P==null?void 0:P.fileName)??"cached.csv",data:T},B=(D==null?void 0:D.columns)??[],H=al(B.map(re=>re.name)),N=R.map(I4);t({...Oo,csvData:L,columnProfiles:B,columnAliasMap:H,analysisCards:N,datasetHash:_,currentView:"analysis_dashboard",analysisTimeline:N.length?{stage:"insight",totalCards:N.length,completedCards:N.length}:{stage:"profiling",totalCards:0,completedCards:0},initialDataSample:T.slice(0,50)}),await Q(_,(D==null?void 0:D.rowCount)??T.length),aT(_);const q=(E=e().datasetRuntimeConfig)==null?void 0:E.profileSampleSize,te=await ps.profile(_,q);return te.ok?e().applyDatasetProfileSnapshot(te.data):addProgress(`Profiling worker failed: ${te.reason}`,"error"),!0}catch(P){return console.error("Failed to restore cached dataset:",P),e().addProgress("Cached dataset restore failed. Please re-upload.","error"),!1}},ne=RO(t,e,{initialAppState:Oo,resetAutoSaveSession:i4}),le=NO(t,e,{createRunId:zw});return{...Oo,...j,...ne,...le,busyRunId:null,graphActiveRunId:null,isCancellationRequested:!1,aiFilterRunId:null,abortControllers:{},isAsideVisible:!0,asideWidth:window.innerWidth/4>Hm?window.innerWidth/4:Hm,isSpreadsheetVisible:!0,isDataPrepDebugVisible:!1,isSettingsModalOpen:!1,isHistoryPanelOpen:!1,isMemoryPanelOpen:!1,isAiFiltering:!1,settings:Ew(),reportsList:[],isResizing:!1,isApiKeySet:(()=>{const _=Ew();return _.provider==="google"?!!_.geminiApiKey:!!_.openAIApiKey})(),beginBusy:(_,E)=>{const P=zw();return t({isBusy:!0,busyMessage:_,canCancelBusy:!!(E!=null&&E.cancellable),busyRunId:P,isCancellationRequested:!1}),P},updateBusyStatus:_=>{e().isBusy&&t({busyMessage:_})},endBusy:_=>{const E=e().busyRunId;if(_&&E&&E!==_)return;t({isBusy:!1,busyMessage:null,canCancelBusy:!1,busyRunId:null,isCancellationRequested:!1});const P=_??E;P&&e().clearRunControllers(P)},requestBusyCancel:()=>{if(!e().busyRunId||e().isCancellationRequested)return;t({isCancellationRequested:!0,canCancelBusy:!1,busyMessage:"Cancelling wrapping up safely."}),e().addProgress("Cancelling current request...");const _=e().busyRunId;_&&e().abortRunControllers(_)},isBusyRunActive:_=>e().busyRunId===_,isRunCancellationRequested:_=>e().isCancellationRequested&&e().busyRunId===_,createAbortController:_=>{if(!_)return null;const E=new AbortController;return t(P=>({abortControllers:{...P.abortControllers,[_]:[...P.abortControllers[_]??[],E]}})),E},abortRunControllers:_=>{t(E=>{const P=E.abortControllers[_];if(P==null||P.forEach(T=>{T.signal.aborted||T.abort()}),!P)return{};const D={...E.abortControllers};return delete D[_],{abortControllers:D}})},clearRunControllers:_=>{t(E=>{if(!E.abortControllers[_])return{};const P={...E.abortControllers};return delete P[_],{abortControllers:P}})},addToast:(_,E="info",P=4e3,D)=>{const T=s4();return t(R=>({toasts:[...R.toasts,{id:T,message:_,type:E,actionLabel:D==null?void 0:D.label,onAction:D==null?void 0:D.onClick}]})),P>0&&setTimeout(()=>{e().dismissToast(T)},P),T},dismissToast:_=>{t(E=>({toasts:E.toasts.filter(P=>P.id!==_)}))},queuePendingDataTransform:_=>{if(e().pendingDataTransform){e().addProgress("An AI data transformation is already awaiting approval. Please confirm or discard it first.","error");return}t({pendingDataTransform:_}),e().addProgress("AI proposed a data transformation. Review it above the dashboard before applying."),e().addToast("AI data change pending confirmation.","info",5e3)},confirmPendingDataTransform:async()=>{const _=e().pendingDataTransform;if(!_){e().addProgress("No pending data transformation to confirm.","error");return}const E=e().csvData,P=e().columnProfiles,D=e().columnAliasMap,T=Tc(_.nextData);t({csvData:_.nextData,columnProfiles:_.nextColumnProfiles,columnAliasMap:_.nextAliasMap,datasetHash:T,datasetRuntimeConfig:null,pendingDataTransform:null,isLastAppliedDataTransformBannerDismissed:!1,lastAppliedDataTransform:{id:_.id,summary:_.summary,explanation:_.explanation,meta:_.meta,previousData:E,previousColumnProfiles:P,previousAliasMap:D,appliedAt:new Date().toISOString()}}),e().addProgress("Applied the AI data transformation after confirmation."),await Q(T,_.nextData.data.length),await e().regenerateAnalyses(_.nextData);const R=de=>{if(!de||de.length===0)return"(none)";const ue=de.slice(0,8).join(", ");return de.length>8?`${ue}, `:ue},L=(de,ue)=>{if(de&&de.length>0)return de.map(Ae=>Ae.name);const pe=ue==null?void 0:ue.find(Ae=>Ae&&typeof Ae=="object");return pe?Object.keys(pe):[]},B=_.beforeColumns??L(P,(E==null?void 0:E.data)??void 0),H=_.afterColumns??_.nextColumnProfiles.map(de=>de.name),N=B.filter(de=>!H.includes(de)),q=H.filter(de=>!B.includes(de)),te=[`Before (${B.length}): ${R(B)}`,`After (${H.length}): ${R(H)}`,N.length?`Removed: ${R(N)}`:null,q.length?`Added: ${R(q)}`:null].filter(Boolean).join(`
`),re={sender:"ai",text:`Applied transform "${_.summary}".
${te}`,timestamp:new Date,type:"ai_message"};t(de=>({chatHistory:[...de.chatHistory,re]}))},discardPendingDataTransform:()=>{if(!e().pendingDataTransform){e().addProgress("No pending data transformation to discard.","error");return}t({pendingDataTransform:null}),e().addProgress("Discarded the pending AI data transformation.")},undoLastDataTransform:async()=>{if(e().pendingDataTransform){e().addProgress("Resolve the pending AI transformation before undoing.","error");return}const _=e().lastAppliedDataTransform;if(!_||!_.previousData){e().addProgress("No AI data transformation is available to undo.","error");return}const E=Tc(_.previousData);t({csvData:_.previousData,columnProfiles:_.previousColumnProfiles,columnAliasMap:_.previousAliasMap,datasetHash:E,datasetRuntimeConfig:null,lastAppliedDataTransform:null,isLastAppliedDataTransformBannerDismissed:!1}),e().addProgress("Reverted the last AI data transformation."),await Q(E,_.previousData.data.length),await e().regenerateAnalyses(_.previousData)},dismissLastAppliedDataTransformBanner:()=>{e().lastAppliedDataTransform&&t({isLastAppliedDataTransformBannerDismissed:!0})},linkChartSelectionToRawData:(_,E,P,D)=>{const T=!!E&&P.length>0,R=e().interactiveSelectionFilter;if(!T){R&&R.sourceCardId===_&&t({interactiveSelectionFilter:null});return}const L=P.map(B=>typeof B=="number"?B:String(B));R&&R.sourceCardId===_&&R.column===E&&M4(R.values,L)||(t({interactiveSelectionFilter:{sourceCardId:_,column:E,values:L,label:D,createdAt:new Date().toISOString()},isSpreadsheetVisible:!0}),setTimeout(()=>{var B;(B=document.getElementById("raw-data-explorer"))==null||B.scrollIntoView({behavior:"smooth",block:"center"})},150))},clearInteractiveSelectionFilter:()=>{const _=e().interactiveSelectionFilter;if(!_)return;const E={sender:"ai",text:`System note: Cleared chart drilldown "${_.label}" (${_.column}); Raw Data Explorer now shows all rows.`,timestamp:new Date,type:"ai_message"};t(D=>({interactiveSelectionFilter:null,chatHistory:[...D.chatHistory,E]})),e().addProgress("Cleared the linked chart selection filter.");const P=e().beginAgentActionTrace("dom_action","User cleared chart drilldown","system");e().updateAgentActionTrace(P,"succeeded","Chart drilldown reset via UI",{metadata:{drilldownLabel:_.label,drilldownColumn:_.column,valueCount:_.values.length}})},init:async()=>{const _=await sl(ka);if(_){const E=_.appState.useLangGraphRuntime===!1;t({...Oo,..._.appState,useLangGraphRuntime:!0,isBusy:!1,busyMessage:null,canCancelBusy:!1,busyRunId:null,isCancellationRequested:!1,aiFilterRunId:null,abortControllers:{},toasts:[],currentView:_.appState.csvData?"analysis_dashboard":"file_upload",pendingClarifications:_.appState.pendingClarifications??[],activeClarificationId:_.appState.activeClarificationId??null,agentActionTraces:_.appState.agentActionTraces??[],agentValidationEvents:_.appState.agentValidationEvents??[],chatMemoryPreview:[],chatMemoryExclusions:[],chatMemoryPreviewQuery:"",isMemoryPreviewLoading:!1,columnAliasMap:_.appState.columnAliasMap??s_(_.appState.columnProfiles??[]),pendingDataTransform:null,lastAppliedDataTransform:null,interactiveSelectionFilter:null,plannerSession:Lp(_.appState.plannerSession),plannerDatasetHash:_.appState.plannerDatasetHash??_.appState.datasetHash??null,datasetProfile:_.appState.datasetProfile??null,analysisTimeline:_.appState.analysisTimeline??{...Oo.analysisTimeline},graphObservations:_.appState.graphObservations??[]}),await t_(_.appState.vectorStoreDocuments,_.appState.datasetHash,e().datasetHash,e().addProgress,e().addToast,e().dismissToast,"Restored AI long-term memory from last session."),Yw(_.createdAt),E&&Kw()}else{const E=TO();E&&await X(E)}await e().loadReportsList()},connectGraphRuntime:()=>{const _=e().useLangGraphRuntime?"langgraph":"legacy",E=_==="langgraph"?"LangGraph":"Graph";if(Vm&&qm===_)return;qs==null||qs(),qs=null,Vm=!0,qm=_;const P=s();if(!P.isSupported){t({graphStatus:"error",graphStatusMessage:` ${E} Web Workerruntime `});return}t({graphStatus:"connecting",graphStatusMessage:`Spinning up ${E} runtime`}),qs=P.subscribe(D=>{var T,R;switch(D.type){case"graph/ready":{const L=new Date(D.timestamp).toISOString();t({graphStatus:"ready",graphStatusMessage:`Graph Ready (v${D.version})`,graphVersion:D.version,graphLastReadyAt:L}),e().addProgress(`Graph runtime ready (v${D.version}).`);return}case"graph/log":e().addProgress(`Graph: ${D.message}`,D.level==="error"?"error":"system");return;case"graph/error":t({graphStatus:"error",graphStatusMessage:D.message}),e().addProgress(`Graph error: ${D.message}`,"error");return;case"graph/pipeline":{const L=e(),B=L.graphObservations??[],H=new Set(B.map(Ae=>Ae.id)),q=(D.state.observations??[]).filter(Ae=>!H.has(Ae.id)),te=new Date(D.timestamp).toISOString(),re=D.state.awaitPrompt??null,de=Array.isArray(D.actions)?((R=(T=D.actions.find(Ae=>Ae.responseType==="await_user"))==null?void 0:T.reason)==null?void 0:R.trim())??null:null,ue=D.phase??L.graphPhase??"idle",pe=D.loopBudget??L.graphLoopBudget;if(m(D.telemetry),t(Ae=>({graphStatus:"ready",graphStatusMessage:`Pipeline node ${D.node} emitted ${D.actions.length} action(s).`,graphLastReadyAt:te,graphPhase:ue,graphLoopBudget:pe,graphAwaitPrompt:re,graphAwaitPromptId:(re==null?void 0:re.promptId)??null,graphAwaitReason:re?de??Ae.graphAwaitReason??null:null,agentAwaitingUserInput:!!re,graphSessionId:D.state.sessionId??Ae.graphSessionId??null,graphAwaitHistory:re?_4(Ae.graphAwaitHistory,re,te):Ae.graphAwaitHistory,graphObservations:D.state.observations??Ae.graphObservations})),q.forEach(Ae=>{e().addProgress(g4(Ae))}),re)e().addProgress(`Graph awaiting your choice: ${re.question}`),L.graphActiveRunId&&(e().endBusy(L.graphActiveRunId),t({graphActiveRunId:null}));else{const Ae=pe?`Loop ${pe.actsUsed}/${pe.maxActs}${pe.exceeded?" (max reached)":""}`:null,Fe=`Phase ${ue}`,en=Ae?`${Fe}  ${Ae}`:Fe;e().addProgress(`Graph ${en}  node ${D.node} completed.`),pe!=null&&pe.exceeded&&e().addProgress("Loop budget reached  awaiting confirmation before further automation.","error"),t({agentAwaitingUserInput:!1}),L.graphActiveRunId&&(e().endBusy(L.graphActiveRunId),t({graphActiveRunId:null}))}e().processGraphActions(D.actions??[]);return}case"graph/pong":t({graphLastReadyAt:new Date(D.timestamp).toISOString()});return;default:return}}),P.ensureWorker(),P.post({type:"graph/init",origin:"ui",timestamp:Date.now()})},runGraphPipeline:_=>{i({type:"graph/runPipeline",payload:_,timestamp:Date.now()})},sendGraphUserReply:async(_,E)=>{var N;const P=s();if(!P.isSupported)return;const D=e().graphAwaitPrompt,T=new Date().toISOString(),R=typeof E=="string"?E.trim():void 0;if(!_&&!R)return;const L=_&&D?((N=D.options.find(q=>q.id===_))==null?void 0:N.label)??_:null,B=_?`${L??_}`:`${R??""}`,H=D?`${D.question}
${B}`:B;t(q=>({graphAwaitHistory:D?b4(q.graphAwaitHistory,D.promptId??null,T,{label:L??R??null,value:_??R??null,type:_?"option":"free_text"}):q.graphAwaitHistory})),P.post({type:"graph/userReply",optionId:_,freeText:R,timestamp:Date.now()}),e().addProgress(`  Graph ${B}`),await e().handleChatMessage(H)},processGraphActions:async _=>{var P,D,T,R,L;if(!Array.isArray(_)||_.length===0)return;const E=async B=>{var rs,Kn,vs,on,It,Jt,xs,ft,ln,bt,vn,Ht;const H=e().csvData;if(!H){e().addProgress("Graph  CSV ","error");return}const N=typeof((rs=B.code)==null?void 0:rs.jsFunctionBody)=="string"?B.code.jsFunctionBody.trim():"";if(!N){e().addProgress("Graph  jsFunctionBody","error");return}if(e().pendingDataTransform){e().addProgress("","error");return}const q=e().columnAliasMap??{},te=(Dt,Ws)=>{if(Dt.length>0)return Dt.map(Zn=>Zn.name);const $a=Ws.find(Zn=>Zn&&typeof Zn=="object");return $a?Object.keys($a):[]},re=Dt=>{if(!Dt.length)return"(none)";const Ws=Dt.slice(0,8).join(", ");return Dt.length>8?`${Ws}, `:Ws},de=dU(H.data,q),ue=b_(de,N);if((Kn=ue.meta)!=null&&Kn.noOp){e().addProgress("","error");return}const pe=fU(ue.data,q),Ae={...H,data:pe},Fe=Wo(Ae.data),en=al(Fe.map(Dt=>Dt.name)),yt=te(e().columnProfiles??[],H.data),tn=te(Fe,pe),Ie=yt.filter(Dt=>!tn.includes(Dt)),Oe=tn.filter(Dt=>!yt.includes(Dt)),et=[`Before (${yt.length}): ${re(yt)}`,`After (${tn.length}): ${re(tn)}`,Ie.length?`Removed: ${re(Ie)}`:null,Oe.length?`Added: ${re(Oe)}`:null].filter(Boolean).join(`
`),Ye=((vs=ue.meta)==null?void 0:vs.rowsBefore)??H.data.length,he=((on=ue.meta)==null?void 0:on.rowsAfter)??pe.length,ye=((It=ue.meta)==null?void 0:It.removedRows)??0,wt=((Jt=ue.meta)==null?void 0:Jt.addedRows)??0,Me=((xs=ue.meta)==null?void 0:xs.modifiedRows)??0,rn=[`${Ye}  ${he} rows`,ye?`${ye} removed`:null,wt?`${wt} added`:null,Me?`${Me} modified`:null].filter(Boolean),dt=rn.length>0?rn.join(", "):"dataset updated",Dn=`transform-${Date.now()}`;e().queuePendingDataTransform({id:Dn,summary:dt,explanation:((ft=B.code)==null?void 0:ft.explanation)??"AI-generated data transform",meta:ue.meta,previewRows:pe.slice(0,5),nextData:Ae,nextColumnProfiles:Fe,nextAliasMap:en,sourceCode:N,createdAt:new Date().toISOString(),beforeColumns:yt,afterColumns:tn});const _t={sender:"ai",text:`${dt}

${et}`,timestamp:new Date,type:"ai_message"};t(Dt=>({chatHistory:[...Dt.chatHistory,_t]})),Qw({description:B.reason??"",summary:`${dt}`,meta:{source:"full",rows:he,processedRows:Ye,totalRows:he,durationMs:0,warnings:[],summary:dt},payload:{kind:"execute_js_code",rowsBefore:Ye,rowsAfter:he,removedRows:ye,addedRows:wt,modifiedRows:Me,column:((bt=(ln=B.meta)==null?void 0:ln.removalContext)==null?void 0:bt.column)??null,values:((Ht=(vn=B.meta)==null?void 0:vn.removalContext)==null?void 0:Ht.values)??null}})};for(const B of _){const H=v(B.intentContract);switch(B.responseType){case"plan_state_update":B.planState&&e().updatePlannerPlanState(B.planState);break;case"plan_creation":if(B.plan){const N=e().csvData;if(!N){e().addProgress("Graph plan creation skipped: dataset unavailable.","error");break}const q=e().datasetHash,te=((P=e().datasetProfile)==null?void 0:P.rowCount)??N.data.length,re={kind:"aggregate_plan",params:{planTitle:B.plan.title??"analysis"}};w(re);try{const de=await ci.aggregatePlan({plan:B.plan,datasetId:q,csvData:N,rowCountHint:te,options:{preferredMode:e().aggregationModePreference,runtimeConfig:e().datasetRuntimeConfig}});M(de,{description:B.plan.title??"analysis"}),await G(B.plan,de)}catch(de){const ue=de instanceof Hn?de:null;I("aggregate_plan",ue==null?void 0:ue.code,(ue==null?void 0:ue.message)??(de instanceof Error?de.message:String(de)),ue==null?void 0:ue.suggestion)}finally{C()}}break;case"execute_js_code":if(H){if(await k(H))break;const q=S(H);if(q){await z(q);break}}B.toolCall||(D=B.meta)!=null&&D.toolCall?await z(B.toolCall??((T=B.meta)==null?void 0:T.toolCall)):(R=B.code)!=null&&R.jsFunctionBody?await E(B):H?e().addProgress(`Intent ${H.intent} tool=${H.tool??"n/a"}`,"error"):e().addProgress("execute_js_code  payload","error");break;case"text_response":case"await_user":{const N=(L=B.text)==null?void 0:L.trim();if(!N)break;const q={sender:"ai",text:N,timestamp:B.timestamp?new Date(B.timestamp):new Date,type:B.responseType==="await_user"?"ai_clarification":"ai_message",cardId:B.cardId,meta:B.meta};t(te=>({chatHistory:[...te.chatHistory,q]}));break}}}},addProgress:(_,E="system")=>{const P={text:_,type:E,timestamp:new Date};t(D=>({progressMessages:[...D.progressMessages,P]}))},loadReportsList:async()=>{const _=await WL();t({reportsList:_})},handleSaveSettings:_=>{eU(_);const E=_.provider==="google"?!!_.geminiApiKey:!!_.openAIApiKey;t({settings:_,isApiKeySet:E}),lT(_)},handleAsideMouseDown:_=>{_.preventDefault(),e().setIsResizing(!0);const E=D=>{const T=window.innerWidth-N4;let R=window.innerWidth-D.clientX;R=Math.max(Hm,R),R=Math.min(R4,R,T),e().setAsideWidth(R)},P=()=>{e().setIsResizing(!1),document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",P)};document.addEventListener("mousemove",E),document.addEventListener("mouseup",P)},runAnalysisPipeline:async(_,E,P={})=>{var tn;const{isChatRequest:D=!1,runId:T}=P,R=e().addProgress,L=e().settings,B=()=>T?e().isRunCancellationRequested(T):!1,H=()=>ae(T);let N=!0;const q=e().beginAgentActionTrace,te=e().updateAgentActionTrace,re=e().datasetHash,de=!D,ue=()=>{de&&t(Ie=>{const Oe=Ie.analysisTimeline;if(!Oe.totalCards)return{};const et=Math.min(Oe.totalCards,Oe.completedCards+1),Ye=Oe.stage==="profiling"&&et>0?"insight":Oe.stage;return{analysisTimeline:{...Oe,completedCards:et,stage:Ye}}})},pe=((tn=e().datasetProfile)==null?void 0:tn.rowCount)??E.data.length,Ae=Ie=>{var et;const Oe=e();return Pp(Ie,re,E,pe,{preferredMode:((et=Oe.datasetRuntimeConfig)==null?void 0:et.mode)??Oe.aggregationModePreference,runtimeConfig:Oe.datasetRuntimeConfig})},Fe=async(Ie,Oe)=>{const et=Ae(Ie);if(!et)return null;Oe!=null&&Oe.mode&&(et.mode=Oe.mode),Oe!=null&&Oe.allowFullScan&&(et.allowFullScan=!0);const Ye=await ps.aggregate(et);if(!Ye.ok){if(Ye.code===Mt.FULL_SCAN_BLOCKED&&!et.allowFullScan)return Zw(Ie.title)?(R(`User enabled full scan for "${Ie.title}".`,"system"),Fe(Ie,{mode:"full",allowFullScan:!0})):(R(`Skipped "${Ie.title}" because full scan was not approved.`,"error"),null);const he=$m(Ye.code,Ye.reason);return R(`Aggregation worker failed for "${Ie.title}": ${he}`,"error"),Ye.hint&&R(Ye.hint,"error"),null}return Ye.data.rows.length===0?(R(`Skipping "${Ie.title}" due to empty aggregation result.`,"error"),null):{result:Ye.data,durationMs:Ye.durationMs??0}};de&&_.length>0&&t(Ie=>({analysisTimeline:{stage:Ie.analysisTimeline.stage==="persisting"?"profiling":Ie.analysisTimeline.stage,totalCards:_.length,completedCards:0}}));const en=async Ie=>{var Ye;const Oe=q("proceed_to_analysis",`Run analysis "${Ie.title}"`,"pipeline"),et=(he,ye)=>te(Oe,he,ye);if(B())return null;try{R(`Executing plan: ${Ie.title}...`),T&&e().updateBusyStatus(`Executing "${Ie.title}"...`);const he=lU(Ie,e().columnProfiles,E.data);if(!he.isValid)return R(`Skipping "${Ie.title}" because ${he.errorMessage??"the plan is invalid."}`,"error"),et("failed",he.errorMessage??"Plan invalid."),null;he.warnings.forEach(ft=>{R(`${Ie.title}: ${ft}`),e().recordPlanValidationNotice(Ie.title,ft)});const ye=he.plan;let wt=null,Me=null,rn=0,dt=[];try{re&&(wt=await Fe(ye),wt&&(Me=wt.result,rn=wt.durationMs)),Me?dt=Me.rows:dt=C_(E,ye)}catch(ft){if(ft instanceof h_&&ft.code==="no_rows"){const ln=ye.rowFilter?`${ye.rowFilter.column}  ${ye.rowFilter.values.join(", ")}`:"the requested filter";return R(`Skipping "${Ie.title}" because ${ln} returned no rows.`,"error"),et("failed",ft.message),ue(),null}throw ft}if(dt.length===0)return R(`Skipping "${Ie.title}" due to empty result.`,"error"),et("failed","Aggregation returned 0 rows."),ue(),null;if(B())return null;R(`AI is summarizing: ${Ie.title}...`),T&&e().updateBusyStatus(`Summarizing "${Ie.title}"...`);const Dn=await yw(ye.title,dt,L,{signal:H(),onUsage:ft=>{e().recordLlmUsage(Ia(ft,"summary.generate"))}});if(B())return null;let _t=null,rs=(Me==null?void 0:Me.provenance.queryHash)??null;const Kn=(Me==null?void 0:Me.provenance.sampled)??!1;if(Me&&re){const ft=await ps.createCardFromResult({datasetId:re,title:ye.title,kind:zm(ye),explainer:Dn,result:Me,plan:ye});ft.ok?_t=ft.data.cardId:R(`View cache save failed for "${ye.title}": ${ft.reason}`,"error")}const vs=dt.length,on=ye.chartType!=="scatter"&&vs>15,It=Me?{mode:Me.provenance.mode,sampled:Me.provenance.sampled,processedRows:Me.provenance.processedRows,totalRows:Me.provenance.totalRows,warnings:Me.provenance.warnings,durationMs:rn,lastRunAt:new Date().toISOString(),filterCount:Me.provenance.filterCount,requestedMode:Me.provenance.requestedMode??Me.provenance.mode,downgradedFrom:Me.provenance.downgradedFrom,downgradeReason:Me.provenance.downgradeReason,normalization:Me.provenance.normalization}:{mode:"full",sampled:!1,processedRows:dt.length,totalRows:dt.length,warnings:re?["Aggregated on main thread because the worker response was unavailable."]:[],durationMs:rn||void 0,lastRunAt:new Date().toISOString(),filterCount:ye.rowFilter?1:0,requestedMode:e().aggregationModePreference??"full",normalization:Me==null?void 0:Me.provenance.normalization},Jt={id:`card-${Date.now()}-${Math.random()}`,plan:ye,aggregatedData:dt,summary:Dn,displayChartType:ye.chartType,isDataVisible:!1,topN:on?8:ye.defaultTopN||null,hideOthers:on?!0:ye.defaultHideOthers||!1,disableAnimation:D||!N||e().analysisCards.length>0,hiddenLabels:[],dataRefId:_t,queryHash:rs,isSampledResult:(It==null?void 0:It.sampled)??Kn,aggregationMeta:It,valueSchema:Me==null?void 0:Me.schema};t(ft=>({analysisCards:[...ft.analysisCards,Jt]})),ue();const xs=`[Chart: ${ye.title}] Description: ${ye.description}. AI Summary: ${Dn.split("---")[0]}`;if(await ut.addDocument({id:Jt.id,text:xs,metadata:{kind:"card",summaryLevel:"summary",cardId:Jt.id,createdAt:new Date().toISOString()}}),R(`View #${Jt.id.slice(-6)} indexed for long-term memory.`),re&&_t){const ft=((Ye=It==null?void 0:It.warnings)==null?void 0:Ye.length)??0,ln={datasetId:re,viewId:_t,cardId:Jt.id,title:ye.title,summary:Dn,plan:ye,chartType:ye.chartType,schema:Me==null?void 0:Me.schema,sampleRows:dt.slice(0,n_),rowCount:dt.length,sampled:(It==null?void 0:It.sampled)??Kn??!1,queryHash:rs,qualityScore:a_(dt.length,ft,(It==null?void 0:It.sampled)??Kn??!1),tags:r_(ye)};Vw(ln).catch(bt=>console.warn("Failed to persist memory snapshot for dataset cache:",bt))}return N=!1,R(`Saved as View #${Jt.id.slice(-6)}`),et("succeeded",`Created card with ${dt.length} rows.`),Jt}catch(he){if(B())return R(`Cancelled "${Ie.title}" before completion.`),te(Oe,"failed","Cancelled before completion."),ue(),null;console.error("Error executing plan:",Ie.title,he);const ye=he instanceof Error?he.message:String(he);return R(`Error executing plan "${Ie.title}": ${ye}`,"error"),et("failed",ye),ue(),null}},yt=(await Promise.all(_.map(en))).filter(Ie=>Ie!==null);if(!D&&yt.length>0&&!B()){R("AI is forming its core understanding of the data..."),T&&e().updateBusyStatus("Forming core understanding...");const Ie=yt.map(ye=>({id:ye.id,title:ye.plan.title,aggregatedDataSample:ye.aggregatedData.slice(0,10)})),Oe=await ML(Ie,e().columnProfiles,L,{signal:H(),onUsage:ye=>{e().recordLlmUsage(Ia(ye,"summary.core_analysis"))}});if(B())return yt;const et={sender:"ai",text:Oe,timestamp:new Date,type:"ai_thinking"};if(t(ye=>({aiCoreAnalysisSummary:Oe,chatHistory:[...ye.chatHistory,et]})),R("Indexing core analysis for long-term memory..."),await ut.addDocument({id:"core-summary",text:`Core Analysis Summary: ${Oe}`,metadata:{kind:"card",summaryLevel:"summary",createdAt:new Date().toISOString(),cardId:"core-summary"}}),R("Core analysis indexed."),B())return yt;R("AI is looking for key insights..."),T&&e().updateBusyStatus("Looking for key insights...");const Ye=await IL(Ie,L,{signal:H(),onUsage:ye=>{e().recordLlmUsage(Ia(ye,"summary.proactive_insight"))}});if(B())return yt;if(Ye){const ye={sender:"ai",text:Ye.insight,timestamp:new Date,type:"ai_proactive_insight",cardId:Ye.cardId};t(wt=>({chatHistory:[...wt.chatHistory,ye]})),R(`AI proactively identified an insight in View #${Ye.cardId.slice(-6)}.`)}if(B())return yt;const he=await vw(yt,L,{signal:H(),onUsage:ye=>{e().recordLlmUsage(Ia(ye,"summary.final"))}});if(B())return yt;t({finalSummary:he}),R("Overall summary generated.")}return yt},handleInitialAnalysis:async(_,E={})=>{if(!_)return;t(D=>D.analysisTimeline.stage==="persisting"?{}:{analysisTimeline:{...D.analysisTimeline,stage:"profiling",totalCards:0,completedCards:0}});const{runId:P}=E;await Rw({beginBusy:e().beginBusy,endBusy:e().endBusy},"Running analysis...",async D=>{e().addProgress("Starting main analysis...");try{e().addProgress("AI is generating analysis plans..."),e().updateBusyStatus("Drafting analysis plans...");const T=e().datasetHash;T&&await Q(T,_.data.length);const R=T?await QU(T,{limit:6,minScore:.4}):[],L=await RL(e().columnProfiles,_.data.slice(0,50),e().settings,{signal:ae(D),memorySnapshots:R});L.warnings.forEach(H=>{const N=`Plan generator warning: ${H.message}`;e().addProgress(N,"error"),e().addToast(H.message,"error",6e3)});const B=L.plans;if(u("analysis_plan",L.telemetry),D&&e().isRunCancellationRequested(D)){e().addProgress("Analysis cancelled before execution.");return}e().addProgress(`AI proposed ${B.length} plans.`),B.length>0?await e().runAnalysisPipeline(B,_,{runId:D}):(e().addProgress("AI did not propose any analysis plans.","error"),t(H=>({analysisTimeline:{...H.analysisTimeline,stage:"idle",totalCards:0,completedCards:0}})))}catch(T){if(T instanceof UC)T.warnings.forEach(R=>{e().addProgress(`Plan generator warning: ${R.message}`,"error"),e().addToast(R.message,"error",7e3)}),e().addProgress("Plan generation failed. Please retry analysis or adjust your prompt.","error"),e().addToast("Plan generation failed. Retry?","error",0,{label:"Retry analysis",onClick:()=>{const R=e().csvData;R&&e().handleInitialAnalysis(R)}}),t(R=>({analysisTimeline:{...R.analysisTimeline,stage:"idle"}}));else if(!(D&&e().isRunCancellationRequested(D))){console.error("Analysis pipeline error:",T);const R=T instanceof Error?T.message:String(T);e().addProgress(`Error during analysis: ${R}`,"error"),e().addToast("Analysis failed. Retry?","error",0,{label:"Retry",onClick:()=>{const L=e().csvData;L&&e().handleInitialAnalysis(L)}})}}finally{D&&e().isRunCancellationRequested(D)?e().addProgress("Stopped current analysis."):e().addProgress("Analysis complete. Ready for chat.")}},{runId:P,cancellable:!0})},regenerateAnalyses:async _=>{e().addProgress("Data has changed. Regenerating all analysis cards...");const E=e().analysisCards.map(P=>P.plan);t({analysisCards:[],finalSummary:null}),await Rw({beginBusy:e().beginBusy,endBusy:e().endBusy},"Regenerating insight cards...",async P=>{try{if(E.length>0){const D=await e().runAnalysisPipeline(E,_,{isChatRequest:!0,runId:P});if(D.length>0&&!(P&&e().isRunCancellationRequested(P))){const T=await vw(D,e().settings,{signal:ae(P),onUsage:R=>{e().recordLlmUsage(Ia(R,"summary.final"))}});P&&e().isRunCancellationRequested(P)||(t({finalSummary:T}),e().addProgress("All analysis cards have been updated."))}}else e().addProgress("No existing plans found to regenerate.","error")}catch(D){if(!(P&&e().isRunCancellationRequested(P))){console.error("Error regenerating analyses:",D);const T=D instanceof Error?D.message:String(D);e().addProgress(`Error updating analyses: ${T}`,"error")}}},{cancellable:!0})},executeQuickAction:async _=>{const E=()=>e().addToast(" CSV ","error",4e3);switch(_){case"profile_dataset":{const P=e().datasetHash;if(!P){E();return}e().addProgress("Running quick data profile");try{const D=await ci.profileDataset(P,e().getSampleSizeHint("profile")),T=D.context??null;T&&e().applyDatasetProfileSnapshot(T),M(D,{description:"Dataset profile (quick action)"});const R=D.summary,L={sender:"ai",text:`  ${D.payload.columns} ${D.payload.rowCount.toLocaleString()}  Data Profile `,timestamp:new Date,type:"ai_message"};t(B=>({chatHistory:[...B.chatHistory,L]}))}catch(D){const T=D instanceof Hn?D:null;I("profile_dataset",T==null?void 0:T.code,(T==null?void 0:T.message)??(D instanceof Error?D.message:String(D)),T==null?void 0:T.suggestion)}break}case"open_raw_preview":{e().focusDataPreview();const P={sender:"ai",text:" Raw Data Explorer ",timestamp:new Date,type:"ai_message"};t(D=>({chatHistory:[...D.chatHistory,P]}));break}case"topn_quick_chart":{const P=e().csvData;if(!P||P.data.length===0){E();return}const D=S4(e().columnProfiles,P.data.slice(0,200));if(!D){e().addProgress(" /  Top-N ","error");return}e().addProgress(`Running quick Top-N chart: ${D.title}`);const R=(await e().runAnalysisPipeline([D],P,{isChatRequest:!0}))[0];if(R){const L={sender:"ai",text:`  Top-N ${R.plan.title}`,timestamp:new Date,type:"ai_message",cardId:R.id};t(B=>({chatHistory:[...B.chatHistory,L]}))}else e().addProgress("Quick Top-N ","error");break}default:e().addProgress("Unknown quick action.","error")}},executeDomAction:_=>{e().addProgress(`AI is performing action: ${_.toolName}...`);const E=(T,R)=>{t(L=>{const B=L.analysisCards.findIndex(q=>q.id===T);if(B===-1)return{};const H=R(L.analysisCards[B]);if(!H)return{};const N=[...L.analysisCards];return N[B]=H,{analysisCards:N}})},P=T=>e().analysisCards.find(R=>R.id===T),D=T=>{const R=T.plan.groupByColumn||"",L=T.plan.valueColumn||"count";let B=T.aggregatedData;const H=T.filter;if(H!=null&&H.column&&H.values&&H.values.length>0&&(B=B.filter(N=>H.values.includes(N[H.column]))),T.plan.chartType!=="scatter"&&R&&T.topN&&(B=S_(B,R,L,T.topN)),T.topN&&T.hideOthers&&R&&(B=B.filter(N=>N[R]!=="Others")),R&&T.hiddenLabels&&T.hiddenLabels.length>0){const N=new Set(T.hiddenLabels.map(String));B=B.filter(q=>!N.has(String(q[R])))}return B};switch(_.toolName){case"highlightCard":{const T=_.args.cardId,R=document.getElementById(T);R&&(R.scrollIntoView({behavior:"smooth",block:"center"}),R.classList.add("ring-4","ring-blue-500","transition-all","duration-500"),setTimeout(()=>R.classList.remove("ring-4","ring-blue-500"),2500));break}case"changeCardChartType":{const{cardId:T,newType:R}=_.args;E(T,L=>({...L,displayChartType:R}));break}case"showCardData":{const{cardId:T,visible:R}=_.args,L=typeof R=="boolean"?R:!0;E(T,B=>({...B,isDataVisible:L}));break}case"filterCard":{const{cardId:T,column:R,values:L}=_.args;if(!R)break;const B=Array.isArray(L)?L:[];E(T,H=>({...H,filter:B.length>0?{column:R,values:B}:void 0}));break}case"setTopN":{const{cardId:T,topN:R}=_.args,L=R==null||R==="all"?null:Number(R);if(L!==null&&(!Number.isFinite(L)||L<=0))break;E(T,B=>({...B,topN:L}));break}case"toggleHideOthers":{const{cardId:T,hide:R}=_.args;E(T,L=>({...L,hideOthers:typeof R=="boolean"?R:!L.hideOthers}));break}case"toggleLegendLabel":{const{cardId:T,label:R}=_.args;if(!R)break;E(T,L=>{const B=L.hiddenLabels||[],N=B.includes(R)?B.filter(q=>q!==R):[...B,R];return{...L,hiddenLabels:N}});break}case"exportCard":{const{cardId:T,format:R="png"}=_.args,L=P(T),B=document.getElementById(T);if(!L||!B){console.warn("exportCard: card or DOM node not found",T);break}const H=D(L),N=typeof R=="string"?R.toLowerCase():"png";(async()=>{try{switch(N){case"csv":A_(H,L.plan.title);break;case"html":await E_(B,L.plan.title,H,L.summary);break;default:await T_(B,L.plan.title);break}e().addProgress(`Exported "${L.plan.title}" as ${N.toUpperCase()}.`)}catch(q){console.error("Failed to export card",q),e().addProgress("Export failed. Please try again.","error")}})();break}case"removeCard":{const{cardId:T}=_.args;if(!T||typeof T!="string")break;let R=null,L=!1;t(B=>{var q,te;const H=B.analysisCards.find(re=>re.id===T);if(!H)return{};L=!0,R=((q=H.plan)==null?void 0:q.title)??T;const N={analysisCards:B.analysisCards.filter(re=>re.id!==T)};return((te=B.interactiveSelectionFilter)==null?void 0:te.sourceCardId)===T&&(N.interactiveSelectionFilter=null),N}),L?e().addProgress(`Removed card "${R??T}" as requested.`):e().addProgress("Unable to remove the requested card because it was not found.","error");break}}},handleExternalCsvPayload:async _=>{var T;if(!_||typeof _.csv!="string"||!_.csv.trim()){e().addToast("Received empty CSV payload from source page.","error");return}const E=((T=_.fileName)==null?void 0:T.trim())||E4(_.header),P=new Blob([_.csv],{type:"text/csv"});let D;try{D=new File([P],E,{type:"text/csv"})}catch{D=Object.assign(P,{name:E,lastModified:Date.now()})}try{await e().handleFileUpload(D)}catch(R){console.error("Failed to import CSV payload from opener.",R),e().addToast("Failed to import CSV from report page.","error")}},applyDatasetProfileSnapshot:_=>{const E=`obs-profile-${Date.now().toString(36)}`,P=new Date().toISOString(),D={id:E,actionId:"dataset_profile",responseType:"plan_state_update",status:"success",timestamp:P,outputs:{rowCount:_.rowCount,sampledRows:_.sampledRows,sampleRatio:_.rowCount>0?Number((_.sampledRows/_.rowCount).toFixed(3)):1}};t(T=>{const R=T.plannerSession.planState;if(!R)return{datasetProfile:_};const L=R.observationIds??[];return L.includes(E)?{datasetProfile:_}:{datasetProfile:_,plannerSession:{...T.plannerSession,planState:{...R,observationIds:[...L,E]}}}}),e().appendPlannerObservation(D)},handleChartTypeChange:(_,E)=>{t(P=>({analysisCards:P.analysisCards.map(D=>D.id===_?{...D,displayChartType:E}:D)}))},handleToggleDataVisibility:_=>{t(E=>({analysisCards:E.analysisCards.map(P=>P.id===_?{...P,isDataVisible:!P.isDataVisible}:P)}))},handleTopNChange:(_,E)=>{t(P=>({analysisCards:P.analysisCards.map(D=>D.id===_?{...D,topN:E}:D)}))},handleHideOthersChange:(_,E)=>{t(P=>({analysisCards:P.analysisCards.map(D=>D.id===_?{...D,hideOthers:E}:D)}))},handleToggleLegendLabel:(_,E)=>{t(P=>({analysisCards:P.analysisCards.map(D=>{if(D.id===_){const T=D.hiddenLabels||[],R=T.includes(E)?T.filter(L=>L!==E):[...T,E];return{...D,hiddenLabels:R}}return D})}))},setAggregationModePreference:_=>{if(e().aggregationModePreference===_)return;t({aggregationModePreference:_});const E=e().datasetHash;E&&J(E,{mode:_,allowFullScan:_==="full"});const P=_==="full"?"":"";e().addProgress(P)},resetConversationMemory:()=>{ut.clear(),t({conversationMemoryState:uT(),vectorStoreDocuments:[],chatMemoryPreview:[],chatMemoryExclusions:[],chatMemoryPreviewQuery:"",isMemoryPreviewLoading:!1}),e().addProgress("Conversation memory has been reset.")},maybeCompactConversationMemory:async()=>{if(Fm)return;const _=e();if(_.chatHistory.length!==0){Fm=!0;try{if(ut.getIsInitialized()||await ut.init(_.addProgress),!ut.getIsInitialized())return;let E={..._.conversationMemoryState};const{chatHistory:P}=_,D=new Date().toISOString(),T=Math.max(0,P.length-u4);for(;E.lastIndexedMessage+Gm<=T&&Gm>0;){const R=E.lastIndexedMessage,L=R+Gm-1,B=P.slice(R,L+1);if(B.length===0)break;const H=`conv-raw-${R}-${L}-${Date.now().toString(36)}`,N=h4(B,R);await ut.addDocument({id:H,text:`Conversation Memory (raw snippet)
${N}`,metadata:{kind:"conversation",summaryLevel:"raw",startIndex:R,endIndex:L,createdAt:D,messageCount:B.length}}),E={...E,lastIndexedMessage:L+1,rawChunks:[...E.rawChunks,{id:H,startIndex:R,endIndex:L,summaryLevel:"raw",createdAt:D}]}}if(E.rawChunks.length>Xw){const R=E.rawChunks.length-Xw,L=E.rawChunks.slice(0,R);if(L.reduce((H,N)=>H+(N.endIndex-N.startIndex+1),0)>=c4){const H=L[0].startIndex,N=L[L.length-1].endIndex,q=P.slice(H,N+1),te=await DL(q,_.settings,{onUsage:de=>_.recordLlmUsage(Ia(de,"memory.conversation"))}),re=`conv-summary-${H}-${N}-${Date.now().toString(36)}`;await ut.addDocument({id:re,text:`Compressed Memory (messages ${H+1}-${N+1})
${te}`,metadata:{kind:"conversation",summaryLevel:"summary",startIndex:H,endIndex:N,createdAt:new Date().toISOString(),sourceDocIds:L.map(de=>de.id),messageCount:q.length}}),L.forEach(de=>ut.deleteDocument(de.id)),E={...E,rawChunks:E.rawChunks.slice(R),summaryChunks:[...E.summaryChunks,{id:re,startIndex:H,endIndex:N,summaryLevel:"summary",createdAt:new Date().toISOString()}]}}}t({conversationMemoryState:E,vectorStoreDocuments:ut.getDocuments()})}catch(E){console.error("Conversation memory compaction failed:",E)}finally{Fm=!1}}},setActiveSchemaPhase:_=>{t(E=>E.activeSchemaPhase===_?{}:{activeSchemaPhase:_})},resetSamplePolicy:()=>{t(_=>{var D,T;const E={tiers:Ri,currentIndex:0,userConfirmedFullScan:!1,lastUpgradeReason:null},P=Jw(_.datasetRuntimeConfig,E.tiers[E.currentIndex],((D=_.datasetProfile)==null?void 0:D.rowCount)??((T=_.csvData)==null?void 0:T.data.length));return{samplePolicy:E,datasetRuntimeConfig:P??_.datasetRuntimeConfig}})},requestSampleUpgrade:_=>{if(e().samplePolicy.currentIndex>=Ri.length-1)return;t(R=>{var q,te;const L=R.samplePolicy.currentIndex+1,B={...R.samplePolicy,currentIndex:L,userConfirmedFullScan:R.samplePolicy.userConfirmedFullScan||_==="user_confirm",lastUpgradeReason:_},H=B.tiers[L],N=Jw(R.datasetRuntimeConfig,H,((q=R.datasetProfile)==null?void 0:q.rowCount)??((te=R.csvData)==null?void 0:te.data.length));return{samplePolicy:B,datasetRuntimeConfig:N??R.datasetRuntimeConfig}});const P=e().samplePolicy,D=P.tiers[P.currentIndex],T=_==="confidence"?"":"";e().addProgress(` ${r4(D)}${T}`,"system")},getSampleSizeHint:_=>{var T,R;const{samplePolicy:E}=e(),P=E.tiers[E.currentIndex];if(P===null)return;const D=((T=e().datasetProfile)==null?void 0:T.rowCount)??((R=e().csvData)==null?void 0:R.data.length)??void 0;return D?Math.min(P,D):P},recordPlanValidationNotice:(_,E)=>{const P={id:n4(),planTitle:_,message:E,at:new Date().toISOString()};t(D=>({planValidationNotices:[...D.planValidationNotices,P].slice(-4)}))},dismissPlanValidationNotice:_=>{t(E=>({planValidationNotices:E.planValidationNotices.filter(P=>P.id!==_)}))},recordLlmUsage:_=>{const E=_.estimatedCostUsd!=null?_.estimatedCostUsd:WO({provider:_.provider,model:_.model,promptTokens:_.promptTokens,completionTokens:_.completionTokens,totalTokens:_.totalTokens}),P=d4({..._,estimatedCostUsd:E??null});t(D=>({llmUsageLog:[...D.llmUsageLog,P].slice(-40)})),e().addProgress(`LLM ${m4(P)}`)},clearLlmUsage:()=>{t({llmUsageLog:[]})},toggleLangGraphRuntime:_=>{e().useLangGraphRuntime!==_&&(qs==null||qs(),qs=null,Vm=!1,qm=null,t({useLangGraphRuntime:_,graphStatus:"idle",graphStatusMessage:"Graph runtime not connected.",graphVersion:null,graphLastReadyAt:null}))},rerunAggregationForCard:async(_,E={})=>{var te,re,de;const P=e().analysisCards.find(ue=>ue.id===_),D=e().datasetHash,T=e().csvData;if(!P||!D)return e().addProgress("Cannot refresh this chart because the dataset is unavailable.","error"),!1;const R=((te=e().datasetProfile)==null?void 0:te.rowCount)??((re=T==null?void 0:T.data)==null?void 0:re.length)??0,L=Pp(P.plan,D,T,R,{preferredMode:((de=e().datasetRuntimeConfig)==null?void 0:de.mode)??e().aggregationModePreference,runtimeConfig:e().datasetRuntimeConfig});if(!L)return e().addProgress(`"${P.plan.title}" cannot be recalculated automatically.`,"error"),!1;E.mode&&(L.mode=E.mode),E.allowFullScan&&(L.allowFullScan=!0);const B=e().beginAgentActionTrace("proceed_to_analysis",`Manual aggregation rerun: ${P.plan.title}`,"system");e().updateAgentActionTrace(B,"executing",void 0,{metadata:{cardId:_,requestedMode:L.mode,allowFullScan:!!L.allowFullScan}});let H=await ps.aggregate(L);if(!H.ok&&H.code===Mt.FULL_SCAN_BLOCKED&&!L.allowFullScan)if(Zw(P.plan.title))e().addProgress(`User enabled full scan for "${P.plan.title}".`,"system"),L.mode="full",L.allowFullScan=!0,H=await ps.aggregate(L);else return e().addProgress(`Skipped "${P.plan.title}" because full scan was not approved.`,"error"),e().updateAgentActionTrace(B,"failed","Full scan not approved.",{metadata:{cardId:_,requestedMode:L.mode,allowFullScan:!!L.allowFullScan}}),!1;if(!H.ok){const ue=$m(H.code,H.reason);return e().addProgress(`Aggregation refresh failed for "${P.plan.title}": ${ue}`,"error"),e().addToast(ue,"error"),e().updateAgentActionTrace(B,"failed",ue??"Aggregation failed.",{metadata:{cardId:_,requestedMode:L.mode,allowFullScan:!!L.allowFullScan}}),!1}const N=H.data,q={mode:N.provenance.mode,sampled:N.provenance.sampled,processedRows:N.provenance.processedRows,totalRows:N.provenance.totalRows,warnings:N.provenance.warnings,durationMs:H.durationMs??0,lastRunAt:new Date().toISOString(),filterCount:N.provenance.filterCount,requestedMode:N.provenance.requestedMode??N.provenance.mode,downgradedFrom:N.provenance.downgradedFrom,downgradeReason:N.provenance.downgradeReason,normalization:N.provenance.normalization};return t(ue=>({analysisCards:ue.analysisCards.map(pe=>pe.id===_?{...pe,aggregatedData:N.rows,isSampledResult:q.sampled,aggregationMeta:q,valueSchema:N.schema}:pe)})),e().addProgress(`${P.plan.title} refreshed (${q.sampled?"sampled":"full scan"}).`),e().addToast(q.sampled?`"${P.plan.title}" refreshed on sampled rows.`:`"${P.plan.title}" full scan completed.`,"success"),e().updateAgentActionTrace(B,"succeeded","Aggregation refreshed.",{metadata:{cardId:_,mode:q.mode,processedRows:q.processedRows,totalRows:q.totalRows,durationMs:q.durationMs,warnings:q.warnings}}),!0},clearCardFilter:_=>{t(E=>({analysisCards:E.analysisCards.map(P=>P.id===_?{...P,filter:void 0}:P)}))},triggerAutoSaveNow:()=>{Kw()},handleLoadReport:async _=>{var P,D;e().addProgress(`Loading report ${_}...`);const E=await sl(_);E?(ut.clear(),t({...E.appState,useLangGraphRuntime:!0,agentAwaitingUserInput:E.appState.agentAwaitingUserInput??!1,agentAwaitingPromptId:E.appState.agentAwaitingPromptId??null,currentView:"analysis_dashboard",isHistoryPanelOpen:!1,chatMemoryPreview:[],chatMemoryExclusions:[],chatMemoryPreviewQuery:"",isMemoryPreviewLoading:!1,agentActionTraces:E.appState.agentActionTraces??[],agentValidationEvents:E.appState.agentValidationEvents??[],columnAliasMap:E.appState.columnAliasMap??s_(E.appState.columnProfiles??[]),plannerSession:Lp(E.appState.plannerSession),plannerDatasetHash:E.appState.plannerDatasetHash??E.appState.datasetHash??null}),await Q(E.appState.datasetHash??null,((P=E.appState.datasetProfile)==null?void 0:P.rowCount)??((D=E.appState.csvData)==null?void 0:D.data.length)),await t_(E.appState.vectorStoreDocuments,E.appState.datasetHash,e().datasetHash,e().addProgress,e().addToast,e().dismissToast,"Restored AI long-term memory from loaded report."),e().addProgress(`Report "${E.filename}" loaded.`),Yw(E.createdAt)):e().addProgress(`Failed to load report ${_}.`,"error")},handleDeleteReport:async _=>{await Mp(_),await e().loadReportsList()},handleShowCardFromChat:_=>{const E=document.getElementById(_);E&&(E.scrollIntoView({behavior:"smooth",block:"center"}),E.classList.add("ring-4","ring-blue-500","transition-all","duration-500"),setTimeout(()=>E.classList.remove("ring-4","ring-blue-500"),2500))},setAgentPhase:(_,E)=>t({agentPhase:{phase:_,message:E??null,enteredAt:new Date().toISOString()}}),setIsAsideVisible:_=>t({isAsideVisible:_}),setAsideWidth:_=>t({asideWidth:_}),setIsSpreadsheetVisible:_=>t({isSpreadsheetVisible:_}),setIsDataPrepDebugVisible:_=>t({isDataPrepDebugVisible:_}),setIsSettingsModalOpen:_=>t({isSettingsModalOpen:_}),setIsHistoryPanelOpen:_=>t({isHistoryPanelOpen:_}),setIsMemoryPanelOpen:_=>t({isMemoryPanelOpen:_}),setIsResizing:_=>t({isResizing:_}),recordAgentValidationEvent:({actionType:_,reason:E,actionIndex:P,runId:D,retryInstruction:T,timestamp:R})=>{const L={id:a4(),actionType:_,reason:E,actionIndex:P,runId:D??null,retryInstruction:T,timestamp:R??new Date().toISOString()};t(B=>({agentValidationEvents:[...B.agentValidationEvents,L].slice(-25)})),typeof window<"u"&&typeof window.dispatchEvent=="function"&&window.dispatchEvent(new CustomEvent("agent-validation-event",{detail:L}))},dismissAgentValidationEvent:_=>{t(E=>({agentValidationEvents:E.agentValidationEvents.filter(P=>P.id!==_)}))},clearAgentValidationEvents:()=>t({agentValidationEvents:[]}),recordPromptMetric:_=>{t(E=>({agentPromptMetrics:[...E.agentPromptMetrics,_].slice(-20)}))},clearPromptMetrics:()=>t({agentPromptMetrics:[]}),beginAgentActionTrace:(_,E,P="chat")=>{const D=`trace-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,T={id:D,actionType:_,status:"observing",summary:E,timestamp:new Date,source:P};return t(R=>({agentActionTraces:[...R.agentActionTraces,T].slice(-40)})),D},updateAgentActionTrace:(_,E,P,D)=>{t(T=>({agentActionTraces:T.agentActionTraces.map(R=>{if(R.id!==_)return R;const L=D!=null&&D.metadata?{...R.metadata??{},...D.metadata}:R.metadata;return{...R,status:E,details:P,timestamp:new Date,durationMs:(D==null?void 0:D.durationMs)??R.durationMs,errorCode:(D==null?void 0:D.errorCode)??R.errorCode,metadata:L}})}))},annotateAgentActionTrace:(_,E)=>{!E||Object.keys(E).length===0||t(P=>({agentActionTraces:P.agentActionTraces.map(D=>D.id===_?{...D,metadata:{...D.metadata??{},...E}}:D)}))},appendPlannerObservation:_=>{t(E=>{const P=[...E.plannerSession.observations,_].slice(-12);return{plannerSession:{...E.plannerSession,observations:P}}})},resetPlannerObservations:()=>{t(_=>({plannerSession:{..._.plannerSession,observations:[]}}))},updatePlannerPlanState:_=>{const E=e_(_.nextSteps);t(P=>({plannerSession:{...P.plannerSession,planState:{..._,nextSteps:E}},plannerPendingSteps:E,plannerDatasetHash:P.datasetHash??null})),typeof _.confidence=="number"&&_.confidence<.6&&e().requestSampleUpgrade("confidence")},clearPlannerPlanState:()=>{t(_=>({plannerSession:{..._.plannerSession,planState:null},plannerPendingSteps:[],plannerDatasetHash:null}))},setPlannerPendingSteps:_=>{t({plannerPendingSteps:e_(_)})},completePlannerPendingStep:()=>{t(_=>{var L,B;if(_.plannerPendingSteps.length===0)return{};const[E,...P]=_.plannerPendingSteps,D=_.plannerSession.planState;if(!D)return{plannerPendingSteps:P};const T=((L=D.steps)==null?void 0:L.map(H=>H.id===E.id?{...H,status:"done"}:H))??D.steps,R=((B=P[0])==null?void 0:B.id)??D.currentStepId;return{plannerPendingSteps:P,plannerSession:{..._.plannerSession,planState:{...D,steps:T,nextSteps:P,currentStepId:R}}}})},focusDataPreview:()=>{t({isSpreadsheetVisible:!0}),setTimeout(()=>{var _;(_=document.getElementById("raw-data-explorer"))==null||_.scrollIntoView({behavior:"smooth",block:"center"})},100)}}}),cT="useAppStore.awaitBusy",Ku=new Set,D4=t=>{console.warn(`[${cT}] ${t.message}`)},dT=async t=>{try{const e=["await_busy",t.status];t.code&&e.push(t.code),await rO({kind:"await_busy_invariant",severity:t.severity,message:t.message,tags:e,details:{code:t.code??null,snapshot:t.snapshot}})}catch(e){console.warn("Failed to persist await/busy audit log entry.",e)}},P4=(t,e)=>{const{addProgress:n,addToast:s}=qe.getState(),i=`Busy/Await state mismatch (${t.code})`;n(`${i}  ${t.message}`,"error"),s(`${i} Await `,"error",6e3),dT({severity:"error",status:"violation",message:t.message,code:t.code,snapshot:e})},k4=t=>{const{addProgress:e}=qe.getState();e("Busy/Await state back in sync ","system"),dT({severity:"info",status:"recovered",message:"Busy/Await invariant recovered",snapshot:t})};qe.subscribe(t=>({isBusy:t.isBusy,busyRunId:t.busyRunId,agentAwaitingUserInput:t.agentAwaitingUserInput,graphActiveRunId:t.graphActiveRunId}),t=>{const e=e4(t,{context:cT,reporter:D4}),n=new Set(e.violations.map(i=>i.code));e.violations.forEach(i=>{Ku.has(i.code)||P4(i,t)});const s=Ku.size>0;Ku.clear(),n.forEach(i=>Ku.add(i)),n.size===0&&s&&k4(t)});qe.subscribe(t=>t.chatHistory.length,(t,e)=>{t>e&&qe.getState().maybeCompactConversationMemory()});lT(qe.getState().settings);yn=new MO({getStore:()=>qe.getState(),buildSnapshot:A4,addToast:(t,e,n,s)=>qe.getState().addToast(t,e,n,s),dismissToast:t=>qe.getState().dismissToast(t)});Ac&&yn.configure(Ac);const L4=()=>x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:x.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),U4=()=>x.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:[x.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 000 2h6a1 1 0 100-2H7z",clipRule:"evenodd"}),x.jsx("path",{d:"M12.293 5.293a1 1 0 011.414 0l2 2a1 1 0 01-1.414 1.414L13 7.414V10a1 1 0 11-2 0V7.414l-1.293 1.293a1 1 0 01-1.414-1.414l2-2zM7.707 14.707a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L7 12.586V10a1 1 0 112 0v2.586l1.293-1.293a1 1 0 011.414 1.414l-2 2z"})]}),O4=()=>x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:x.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})}),i_=()=>x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-amber-600",viewBox:"0 0 20 20",fill:"currentColor",children:x.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.721-1.36 3.486 0l6.518 11.59c.75 1.334-.213 2.987-1.743 2.987H3.482c-1.53 0-2.493-1.653-1.743-2.987l6.518-11.59zM10 7a1 1 0 00-1 1v3.25a1 1 0 002 0V8a1 1 0 00-1-1zm0 8a1.25 1.25 0 100-2.5A1.25 1.25 0 0010 15z",clipRule:"evenodd"})}),B4=t=>typeof t!="number"||Number.isNaN(t)?null:t<1e3?`${Math.round(t)} ms`:`${(t/1e3).toFixed(1)} s`,V4=t=>{if(!t)return null;const e=new Date(t);return Number.isNaN(e.getTime())?null:e.toLocaleTimeString()},q4=({meta:t,onRunFullScan:e,isRefreshing:n})=>{var M;if(!t)return null;const s=t.sampled,i=s?"bg-amber-100 text-amber-800 border-amber-200":"bg-emerald-100 text-emerald-700 border-emerald-200",o=s?"Sampled result":"Full scan",u=s?`${t.processedRows.toLocaleString()} of ${t.totalRows.toLocaleString()} rows`:`${t.totalRows.toLocaleString()} rows`,d=B4(t.durationMs),p=V4(t.lastRunAt),m=((M=t.warnings)==null?void 0:M.filter(Boolean))??[],S=(t.requestedMode??(s?"sample":"full"))==="full"&&t.mode!=="full",w=t.downgradeReason==="timeout"?"Full scan timed out":t.downgradeReason==="fallback"?"Full scan was not available":null,C=S?`${w??"Full scan fell back to a sample"} after processing ${t.processedRows.toLocaleString()} of ${t.totalRows.toLocaleString()} rows.`:null;return x.jsxs("div",{className:"mb-3 rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-600",children:[x.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[x.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-semibold border ${i}`,children:o}),x.jsx("span",{children:u}),d&&x.jsx("span",{className:"text-slate-400",children:""}),d&&x.jsx("span",{children:d}),p&&x.jsxs(x.Fragment,{children:[x.jsx("span",{className:"text-slate-400",children:""}),x.jsxs("span",{children:["Last run ",p]})]}),s&&x.jsxs(x.Fragment,{children:[x.jsx("span",{className:"text-slate-400",children:""}),x.jsx("span",{className:"text-xs text-slate-500",children:"Showing a quick preview. Full scan processes every row."})]}),s&&e&&!S&&x.jsx("button",{type:"button",onClick:()=>e(),disabled:n,className:"ml-auto inline-flex items-center rounded-md border border-slate-300 bg-white px-3 py-1 text-xs font-medium text-slate-700 hover:bg-slate-100 disabled:opacity-50",children:n?"Running":"Run full scan"})]}),C&&x.jsxs("div",{className:"mt-2 flex items-start gap-2 rounded-md border border-amber-200 bg-amber-50 px-3 py-2 text-xs text-amber-800",children:[x.jsx(i_,{}),x.jsxs("span",{className:"flex-1",children:[C," ",e&&x.jsx("button",{type:"button",onClick:()=>e(),disabled:n,className:"ml-1 underline decoration-dotted hover:text-amber-900 disabled:opacity-50",children:n?"Retrying":"Retry full scan"})]})]}),m.length>0&&x.jsxs("div",{className:"mt-2 flex items-start gap-2 text-xs text-amber-700",children:[x.jsx(i_,{}),x.jsx("span",{className:"flex-1",children:m.join("  ")})]})]})},F4=({meta:t,plan:e})=>{if(!t)return null;const n=`${t.processedRows.toLocaleString()} / ${t.totalRows.toLocaleString()}`,s=t.filterCount&&t.filterCount>0?`${t.filterCount} ${t.filterCount===1?"filter":"filters"} applied`:"No filters applied",i=e.orderBy&&e.orderBy.length>0?e.orderBy.map(u=>`${u.column} ${(u.direction??"desc").toUpperCase()}`).join(", "):e.chartType==="line"&&e.groupByColumn?`${e.groupByColumn} ASC`:`${e.valueColumn??"count"} DESC`,o=typeof e.limit=="number"?`${e.limit.toLocaleString()} rows`:e.defaultTopN?`${e.defaultTopN.toLocaleString()} rows (default)`:"All rows";return x.jsx("div",{className:"mt-4 border-t border-slate-200 pt-3 text-xs text-slate-500",children:x.jsxs("div",{className:"flex flex-wrap gap-x-6 gap-y-2",children:[x.jsxs("div",{children:[x.jsx("span",{className:"text-slate-400",children:"Rows processed"}),x.jsx("span",{className:"ml-1 font-semibold text-slate-700",children:n})]}),x.jsxs("div",{children:[x.jsx("span",{className:"text-slate-400",children:"Filters"}),x.jsx("span",{className:"ml-1 text-slate-700",children:s})]}),x.jsxs("div",{children:[x.jsx("span",{className:"text-slate-400",children:"Order"}),x.jsx("span",{className:"ml-1 text-slate-700",children:i})]}),x.jsxs("div",{children:[x.jsx("span",{className:"text-slate-400",children:"Limit"}),x.jsx("span",{className:"ml-1 text-slate-700",children:o})]})]})})},$4=({filter:t})=>{const n=t.values.slice(0,3).map(u=>String(u)).join(", "),s=t.values.length-3,i=s>0?`${n} +${s}`:n,o=`Rows limited to ${t.column}  ${t.values.map(u=>String(u)).join(", ")}`;return x.jsxs("span",{className:"ml-2 inline-flex items-center rounded-full bg-slate-100 px-2 py-0.5 text-xs font-medium text-slate-700 border border-slate-200",title:o,children:["Filtered  ",t.column,": ",i]})},G4=({cardId:t})=>{var et,Ye;const e=qe(he=>he.analysisCards.find(ye=>ye.id===t)),{handleChartTypeChange:n,handleToggleDataVisibility:s,handleTopNChange:i,handleHideOthersChange:o,handleToggleLegendLabel:u,rerunAggregationForCard:d,linkChartSelectionToRawData:p,clearCardFilter:m}=qe(he=>({handleChartTypeChange:he.handleChartTypeChange,handleToggleDataVisibility:he.handleToggleDataVisibility,handleTopNChange:he.handleTopNChange,handleHideOthersChange:he.handleHideOthersChange,handleToggleLegendLabel:he.handleToggleLegendLabel,rerunAggregationForCard:he.rerunAggregationForCard,linkChartSelectionToRawData:he.linkChartSelectionToRawData,clearCardFilter:he.clearCardFilter})),v=ce.useRef(null),S=ce.useRef(null),[w,C]=ce.useState(!1),[M,I]=ce.useState([]),[k,F]=ce.useState(!1),[V,G]=ce.useState(!0),[z,ae]=ce.useState(!1);if(!e)return null;const{id:Q,plan:J,aggregatedData:j,summary:X,displayChartType:ne,isDataVisible:le,topN:_,hideOthers:E,disableAnimation:P,filter:D,hiddenLabels:T=[],aggregationMeta:R,valueSchema:L}=e,B=X.split("---"),H=(et=B[0])==null?void 0:et.trim(),N=(Ye=B[1])==null?void 0:Ye.trim(),q=J.valueColumn||"count",te=J.groupByColumn||"",re=ce.useMemo(()=>{let he=j;return D&&D.column&&D.values.length>0&&(he=he.filter(ye=>D.values.includes(ye[D.column]))),he},[j,D]),de=ce.useMemo(()=>J.chartType!=="scatter"&&te&&_?S_(re,te,q,_):re,[re,J.chartType,te,_,q]),ue=ce.useMemo(()=>{let he=de;return _&&E&&(he=he.filter(ye=>ye[te]!=="Others")),te&&(he=he.filter(ye=>!T.includes(String(ye[te])))),he},[de,_,E,te,T]),pe=ce.useMemo(()=>re.reduce((he,ye)=>he+(Number(ye[q])||0),0),[re,q]),Ae=async he=>{if(v.current){C(!0);try{switch(he){case"png":await T_(v.current,J.title);break;case"csv":A_(ue,J.title);break;case"html":await E_(v.current,J.title,ue,X);break;case"json":nR({plan:J,data:ue,aggregationMeta:R,schema:L??[]});break}}finally{C(!1)}}},Fe=(he,ye)=>{const wt=ye.ctrlKey||ye.metaKey;I(Me=>wt?(Me.includes(he)?Me.filter(dt=>dt!==he):[...Me,he]).sort((dt,Dn)=>dt-Dn):Me.includes(he)?[]:[he])},en=()=>{var he;return(he=S.current)==null?void 0:he.resetZoom()},yt=()=>I([]),tn=he=>{const ye=he.target.value==="all"?null:parseInt(he.target.value,10);i(Q,ye)},Ie=M.map(he=>ue[he]),Oe=ce.useCallback(async()=>{if(d){ae(!0);try{await d(Q,{mode:"full",allowFullScan:!0})}finally{ae(!1)}}},[Q,d]);return ce.useEffect(()=>{if(!te||M.length===0){p(Q,null,[],J.title);return}const he=M.map(ye=>{var wt;return(wt=ue[ye])==null?void 0:wt[te]}).filter(ye=>ye!=null);if(he.length===0){p(Q,null,[],J.title);return}return p(Q,te,he,J.title),()=>{p(Q,null,[],J.title)}},[te,M,ue,Q,p,J.title]),x.jsxs("div",{ref:v,id:Q,className:"bg-white rounded-lg shadow-lg p-4 flex flex-col transition-all duration-300 hover:shadow-blue-500/20 border border-slate-200 w-full",children:[x.jsxs("div",{className:"flex justify-between items-start gap-4 mb-2",children:[x.jsx("div",{className:"flex flex-col flex-1 min-w-0",children:x.jsxs("div",{className:"flex items-center flex-wrap",children:[x.jsx("h3",{className:"text-lg font-bold text-slate-900",children:J.title}),J.rowFilter&&x.jsx($4,{filter:J.rowFilter})]})}),x.jsxs("div",{className:"flex items-center bg-slate-100 rounded-md p-0.5 space-x-0.5 flex-shrink-0",children:[x.jsx(rR,{currentType:ne,onChange:he=>n(Q,he)}),x.jsxs("div",{className:"relative group",children:[x.jsx("button",{disabled:w,className:"p-1.5 text-slate-500 hover:text-slate-900 rounded-md transition-colors hover:bg-slate-200",children:x.jsx(L4,{})}),x.jsxs("div",{className:"absolute right-0 mt-2 w-36 bg-white border border-slate-200 rounded-md shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none group-hover:pointer-events-auto",children:[x.jsx("a",{onClick:()=>Ae("png"),className:"block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 cursor-pointer rounded-t-md",children:"Export as PNG"}),x.jsx("a",{onClick:()=>Ae("csv"),className:"block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 cursor-pointer",children:"Export as CSV"}),x.jsx("a",{onClick:()=>Ae("html"),className:"block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 cursor-pointer",children:"Export as HTML"}),x.jsx("a",{onClick:()=>Ae("json"),className:"block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 cursor-pointer rounded-b-md",children:"Export as JSON"})]})]})]})]}),x.jsx("p",{className:"text-sm text-slate-500 mb-4",children:J.description}),x.jsx(q4,{meta:R,onRunFullScan:R!=null&&R.sampled?Oe:void 0,isRefreshing:z}),x.jsxs("div",{className:"grid gap-4 flex-grow grid-cols-1",children:[x.jsxs("div",{className:"relative h-64",children:[x.jsx(GE,{ref:S,chartType:ne,data:ue,plan:J,selectedIndices:M,onElementClick:Fe,onZoomChange:F,disableAnimation:P}),x.jsxs("div",{className:"absolute top-1 right-1 flex items-center space-x-1",children:[M.length>0&&x.jsx("button",{onClick:yt,title:"Clear selection",className:"p-1 bg-white/50 text-slate-600 rounded-full hover:bg-slate-100 hover:text-slate-800 transition-all backdrop-blur-sm",children:x.jsx(O4,{})}),k&&x.jsx("button",{onClick:en,title:"Reset zoom",className:"p-1 bg-white/50 text-slate-600 rounded-full hover:bg-slate-100 hover:text-slate-800 transition-all backdrop-blur-sm",children:x.jsx(U4,{})})]})]}),te&&x.jsx("div",{className:"flex flex-col",children:x.jsx(iR,{data:de,total:pe,groupByKey:te,valueKey:q,hiddenLabels:T,onLabelClick:he=>u(Q,he)})})]}),D&&x.jsx("div",{className:"text-xs text-yellow-800 bg-yellow-100 p-3 rounded-md my-3 border border-yellow-200",children:x.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[x.jsxs("span",{children:[x.jsx("b",{children:"AI Filter Active:"})," Showing where '",D.column,"' is '",D.values.join(", "),`'. Ask AI to "clear filter" or use the button to remove.`]}),x.jsx("button",{type:"button",onClick:()=>m(Q),className:"px-3 py-1 text-xs font-semibold text-yellow-900 bg-white/70 border border-yellow-300 rounded-md hover:bg-white hover:border-yellow-400 transition",children:"Clear filter"})]})}),x.jsx("div",{className:"mt-4 border-t border-slate-200 pt-4",children:x.jsxs("div",{className:"bg-slate-50 p-3 rounded-md text-sm border border-slate-200",children:[x.jsxs("div",{className:"flex justify-between items-baseline mb-2",children:[x.jsx("p",{className:"font-semibold text-blue-600",children:"AI Summary"}),J.aggregation==="sum"&&x.jsxs("p",{className:"text-xs text-slate-500",children:["Total: ",x.jsx("span",{className:"font-bold text-base text-slate-800",children:pe.toLocaleString(void 0,{maximumFractionDigits:0})})]})]}),x.jsx("p",{className:"text-slate-700 text-xs",children:H}),N&&x.jsx("p",{className:"text-slate-500 mt-2 text-xs",children:N})]})}),x.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[x.jsx("div",{children:x.jsxs("button",{onClick:()=>s(Q),className:"text-sm text-blue-600 hover:underline",children:[le?"Hide":"Show"," Full Data Table"]})}),J.chartType!=="scatter"&&j.length>5&&x.jsxs("div",{className:"flex items-center space-x-2",children:[x.jsx("label",{htmlFor:`top-n-${Q}`,className:"text-xs text-slate-500",children:"Show"}),x.jsxs("select",{id:`top-n-${Q}`,value:_||"all",onChange:tn,className:"bg-white border border-slate-300 text-slate-800 text-xs rounded-md py-1 px-2 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[x.jsx("option",{value:"all",children:"All"}),x.jsx("option",{value:"5",children:"Top 5"}),x.jsx("option",{value:"8",children:"Top 8"}),x.jsx("option",{value:"10",children:"Top 10"}),x.jsx("option",{value:"15",children:"Top 15"}),x.jsx("option",{value:"20",children:"Top 20"})]}),_&&x.jsx("div",{className:"flex items-center",children:x.jsxs("label",{htmlFor:`hide-others-${Q}`,className:"flex items-center space-x-1.5 text-xs text-slate-500",children:[x.jsx("input",{type:"checkbox",id:`hide-others-${Q}`,checked:E,onChange:he=>o(Q,he.target.checked),className:"bg-slate-100 border-slate-300 rounded focus:ring-blue-500 text-blue-600 h-3.5 w-3.5"}),x.jsx("span",{children:'Hide "Others"'})]})})]})]}),M.length>0&&x.jsxs("div",{className:"mt-4 bg-slate-50 p-3 rounded-md text-sm border border-slate-200",children:[x.jsxs("button",{onClick:()=>G(!V),className:"w-full text-left font-semibold text-blue-600 mb-1",children:[V?"":""," Selection Details (",M.length," items)"]}),V&&x.jsx(uc,{data:Ie,schema:L})]}),le&&x.jsx("div",{className:"mt-2 max-h-48 overflow-y-auto border border-slate-200 rounded-md",children:x.jsx(uc,{data:ue,schema:L})}),x.jsx(F4,{meta:R,plan:J})]})},H4=()=>x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 inline-block mr-2 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:x.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),z4=({summary:t})=>x.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg shadow-lg p-6 mb-6",children:[x.jsxs("h2",{className:"text-xl font-bold text-slate-900 mb-3 flex items-center",children:[x.jsx(H4,{}),"Overall Insights"]}),x.jsx("p",{className:"text-slate-700 whitespace-pre-wrap leading-relaxed",children:t})]}),Up=[1,2,3],j4=({isManual:t,statusLabel:e,selectedCount:n,onToggleMode:s,onSelectManualCount:i})=>x.jsx("div",{className:"flex justify-end",children:x.jsxs("div",{className:"flex flex-wrap items-center gap-4 rounded-2xl border border-slate-200 bg-white/80 px-4 py-3 shadow-sm",children:[x.jsxs("div",{className:"text-right",children:[x.jsx("p",{className:"text-sm font-semibold text-slate-600",children:"Cards per row"}),x.jsx("p",{className:"text-xs text-slate-400",children:e})]}),x.jsx("button",{type:"button",onClick:s,className:`rounded-full border px-3 py-1.5 text-xs font-semibold transition ${t?"border-amber-300 bg-amber-50 text-amber-700":"border-slate-200 bg-white text-slate-500 hover:bg-slate-50"}`,children:t?"Switch to Auto":"Manual override"}),x.jsx("div",{className:"inline-flex overflow-hidden rounded-xl border border-slate-200 bg-white shadow-inner",children:Up.map(o=>{const u=n===o;return x.jsx("button",{type:"button",onClick:()=>t&&i(o),disabled:!t,className:`px-4 py-1.5 text-sm font-semibold transition-colors ${u?"bg-slate-100 text-slate-900":"text-slate-500 hover:bg-slate-50"} ${t?"":"cursor-not-allowed opacity-60"}`,"aria-pressed":u,title:t?void 0:"Auto layout is active. Enable manual override to pick.",children:o},o)})})]})}),o_=t=>`${(t*100).toFixed(1)}%`,J4=()=>{const t=qe(o=>o.datasetProfile),[e,n]=ce.useState(!1);if(!t)return null;const s=t.rowCount>0?Math.min(1,t.sampledRows/t.rowCount):1,i=s===1;return x.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg shadow-sm",children:[x.jsxs("button",{type:"button",onClick:()=>n(o=>!o),className:"w-full flex items-center justify-between px-4 py-3 text-left",children:[x.jsxs("div",{children:[x.jsxs("div",{className:"text-sm font-semibold text-slate-800 flex items-center gap-2",children:[x.jsx("span",{className:"text-base",children:""}),x.jsx("span",{children:"Data Profile"})]}),x.jsx("p",{className:"text-xs text-slate-500 mt-0.5",children:i?"Full dataset profiled.":`Sampled ${t.sampledRows.toLocaleString()} of ${t.rowCount.toLocaleString()} rows (${o_(s)}).`})]}),x.jsx("span",{className:"text-sm text-slate-500",children:e?"Hide":"Show"})]}),e&&x.jsxs("div",{className:"px-4 pb-4 space-y-4",children:[x.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-xs",children:[x.jsxs("div",{className:"bg-slate-50 rounded-md p-3 border border-slate-100",children:[x.jsx("p",{className:"text-slate-500",children:"Total rows"}),x.jsx("p",{className:"text-lg font-semibold text-slate-900",children:t.rowCount.toLocaleString()})]}),x.jsxs("div",{className:"bg-slate-50 rounded-md p-3 border border-slate-100",children:[x.jsx("p",{className:"text-slate-500",children:"Sampled rows"}),x.jsx("p",{className:"text-lg font-semibold text-slate-900",children:t.sampledRows.toLocaleString()})]}),x.jsxs("div",{className:"bg-slate-50 rounded-md p-3 border border-slate-100",children:[x.jsx("p",{className:"text-slate-500",children:"Columns"}),x.jsx("p",{className:"text-lg font-semibold text-slate-900",children:t.columns.length})]}),x.jsxs("div",{className:"bg-slate-50 rounded-md p-3 border border-slate-100",children:[x.jsx("p",{className:"text-slate-500",children:"Profile Scope"}),x.jsx("p",{className:"text-lg font-semibold text-slate-900",children:i?"Full":"Sample"})]})]}),x.jsx("div",{className:"overflow-x-auto border border-slate-100 rounded-md",children:x.jsxs("table",{className:"min-w-full text-xs",children:[x.jsx("thead",{className:"bg-slate-100 text-slate-600",children:x.jsxs("tr",{children:[x.jsx("th",{className:"p-2 text-left font-semibold",children:"Column"}),x.jsx("th",{className:"p-2 text-left font-semibold",children:"Type"}),x.jsx("th",{className:"p-2 text-left font-semibold",children:"Distinct"}),x.jsx("th",{className:"p-2 text-left font-semibold",children:"Missing"}),x.jsx("th",{className:"p-2 text-left font-semibold",children:"Examples"})]})}),x.jsx("tbody",{children:t.columns.map(o=>{var u;return x.jsxs("tr",{className:"border-t border-slate-100",children:[x.jsx("td",{className:"p-2 font-medium text-slate-800",children:o.name}),x.jsx("td",{className:"p-2 text-slate-600 capitalize",children:o.type}),x.jsx("td",{className:"p-2 text-slate-600",children:((u=o.distinct)==null?void 0:u.toLocaleString())??""}),x.jsx("td",{className:"p-2 text-slate-600",children:typeof o.emptyPercentage=="number"?o_(o.emptyPercentage/100):""}),x.jsx("td",{className:"p-2 text-slate-600",children:o.examples&&o.examples.length>0?o.examples.slice(0,3).join(", "):""})]},o.name)})})]})}),t.warnings.length>0&&x.jsxs("div",{className:"text-xs text-amber-700 bg-amber-50 border border-amber-200 rounded-md p-3",children:[x.jsx("p",{className:"font-semibold mb-1",children:"Warnings"}),x.jsx("ul",{className:"list-disc list-inside space-y-1",children:t.warnings.map((o,u)=>x.jsx("li",{children:o},`warning-${u}`))})]})]})]})},Y4=Up[Up.length-1],K4=[{minWidth:1280,columns:3},{minWidth:720,columns:2},{minWidth:0,columns:1}],Z4=t=>{if(!t)return 1;for(const e of K4)if(t>=e.minWidth)return Math.min(Y4,e.columns);return 1},X4=()=>{const t=qe(w=>w.analysisCards),e=qe(w=>w.finalSummary),n=ce.useRef(null),s=ce.useRef(null),[i,o]=ce.useState(1),[u,d]=ce.useState(2),[p,m]=ce.useState(!1),v=p?u:i;ce.useLayoutEffect(()=>{if(p)return;const w=n.current;if(!w)return;const C=I=>{s.current!==null&&cancelAnimationFrame(s.current),s.current=requestAnimationFrame(()=>{s.current=null,o(k=>{const F=Z4(I);return k===F?k:F})})};if(C(w.getBoundingClientRect().width),typeof ResizeObserver<"u"){const I=new ResizeObserver(k=>{var F;for(const V of k)if(V.target===w){const G=((F=V.contentRect)==null?void 0:F.width)??w.getBoundingClientRect().width;C(G)}});return I.observe(w),()=>{I.disconnect(),s.current!==null&&cancelAnimationFrame(s.current)}}const M=()=>{C(w.getBoundingClientRect().width)};return window.addEventListener("resize",M),()=>{window.removeEventListener("resize",M),s.current!==null&&cancelAnimationFrame(s.current)}},[p,t.length]);const S=()=>{m(w=>(w||d(v),!w))};return t.length===0?x.jsx("div",{className:"flex items-center justify-center h-full",children:x.jsxs("div",{className:"text-center p-4",children:[x.jsx("p",{className:"text-slate-500",children:"Your analysis results will appear here."}),x.jsx("p",{className:"text-slate-400 text-sm mt-2",children:"The AI is generating the initial analysis..."})]})}):x.jsxs("div",{className:"p-1",ref:n,children:[x.jsxs("div",{className:"mb-6 space-y-4",children:[x.jsx(J4,{}),e&&x.jsx("div",{children:x.jsx(z4,{summary:e})}),x.jsx(j4,{isManual:p,statusLabel:p?"Manual control enabled":"Auto based on panel width",selectedCount:v,onToggleMode:S,onSelectManualCount:w=>d(w)})]}),x.jsx("div",{className:"mt-6",children:x.jsx(p_,{breakpointCols:v,className:"flex w-auto -ml-6",columnClassName:"pl-6 space-y-6",children:t.map(w=>x.jsx("div",{className:"analysis-card",children:x.jsx(G4,{cardId:w.id})},w.id))})})]})};function Jc(t,e){if(Object.is(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;if(t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(const[s,i]of t)if(!Object.is(i,e.get(s)))return!1;return!0}if(t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(const s of t)if(!e.has(s))return!1;return!0}const n=Object.keys(t);if(n.length!==Object.keys(e).length)return!1;for(const s of n)if(!Object.prototype.hasOwnProperty.call(e,s)||!Object.is(t[s],e[s]))return!1;return!0}const W4=240,Q4=(t,e,n)=>{const{maxHeight:s=W4,minHeight:i=0}=n??{};ce.useLayoutEffect(()=>{const o=t.current;if(!o)return;o.style.height="auto";const u=o.scrollHeight,d=Math.min(Math.max(u,i),s);o.style.height=`${d}px`,o.style.overflowY=u>s?"auto":"hidden"},[t,e,s,i])},e3="",t3="",n3="",s3="",a3=t=>{let e=t.trim();return e=e.replace(/^\*\*(.+)\*\*$/,"$1").trim(),e=e.replace(/^\*+/,"").replace(/\*+$/,"").trim(),e=e.replace(/^["']+/,"").replace(/["']+$/,"").trim(),e=e.replace(/\s*\(\s*(?:optional|default)\s*\)\s*$/i,"").trim(),e=e.replace(/[:;]+$/,"").trim(),e},r3=[/^([0-9]+|[A-Za-z])[\.\)\]]\s+(.+)$/,/^([0-9]+|[A-Za-z])[]\s+(.+)$/,/^[(\[]?(?:option|choice)?\s*([0-9]+|[A-Za-z])[\)\]\.:-]\s+(.+)$/i,/^([0-9]+|[A-Za-z])\s*[-]\s+(.+)$/,/^[-]\s*(?:option|choice)?\s*([0-9]+|[A-Za-z])?[:\.\-\)]?\s+(.+)$/i],i3=new RegExp(String.raw`(?:^|\n)\s*(?:[\(\\[]?\s*(?:option|choice)?\s*)?([0-9]+|[A-Za-z])[\)\]\.:-]\s+([^\n]+?)(?=\n|$)`,"gi"),o3=t=>{const e=t.replace(/\r/g,"").replace(new RegExp(e3,"g"),".").replace(new RegExp(t3,"g"),"(").replace(new RegExp(n3,"g"),")").replace(new RegExp(s3,"g"),""),n=e.split(/\n+/).map(o=>o.trim()),s=new Set,i=o=>{if(!o)return;const u=a3(o);!u||u.length<2||u.length>140||s.add(u)};for(const o of n)if(o)for(const u of r3){const d=o.match(u);if(d&&d[2]){i(d[2]);break}}if(s.size===0){let o;for(;(o=i3.exec(e))!==null&&(i(o[2]),!(s.size>=5)););}return Array.from(s).slice(0,5)},l3=({promptId:t,message:e,onSubmit:n,disabled:s=!1,isActive:i})=>{const o=ce.useMemo(()=>o3(e),[e]),[u,d]=ce.useState(""),[p,m]=ce.useState(!1),v=s||p,S=C=>{const M=C.trim();M&&(m(!0),n(M))},w=C=>{C.preventDefault(),!(!u.trim()||v)&&(S(u),d(""))};return x.jsxs("div",{className:`rounded-md border px-3 py-2 ${i?"border-blue-300 bg-blue-50":"border-slate-200 bg-slate-50"} transition-colors`,children:[x.jsxs("div",{className:"flex items-center justify-between text-[11px] uppercase tracking-wide text-slate-500 mb-2",children:[x.jsxs("span",{children:["Prompt ",t]}),p&&x.jsx("span",{className:"text-emerald-600 font-semibold",children:"Sent"})]}),o.length>0&&x.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:o.map(C=>x.jsx("button",{type:"button",onClick:()=>S(C),disabled:v,className:`text-xs px-3 py-1 rounded-full border ${v?"text-slate-400 border-slate-200 bg-white cursor-not-allowed":"text-blue-700 border-blue-200 bg-white hover:bg-blue-100"} transition-colors`,children:C},`${t}-${C}`))}),x.jsxs("form",{onSubmit:w,className:"flex items-center gap-2",children:[x.jsx("input",{type:"text",value:u,onChange:C=>d(C.target.value),placeholder:"Type a custom answer",disabled:v,className:"flex-grow rounded-md border border-slate-200 px-2 py-1 text-sm text-slate-700 placeholder-slate-400 focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:bg-slate-100"}),x.jsx("button",{type:"submit",disabled:v||!u.trim(),className:"text-xs font-semibold px-3 py-1 rounded-md bg-blue-600 text-white disabled:bg-slate-300 disabled:text-slate-500 transition-colors",children:"Send"})]})]})},u3=({prompt:t,onSelect:e,onSubmitFreeText:n,disabled:s,waitingHint:i,reasonText:o,latestObservation:u})=>{const[d,p]=ce.useState(""),m=v=>{v.preventDefault(),!(!d.trim()||s)&&(n(d.trim()),p(""))};return x.jsxs("div",{className:"bg-white border border-amber-200 rounded-xl p-4 shadow-sm space-y-3",children:[x.jsxs("div",{className:"flex items-center gap-2 text-amber-800",children:[x.jsx("span",{className:"text-xl",children:""}),x.jsxs("div",{children:[x.jsx("p",{className:"text-sm font-semibold",children:""}),x.jsx("p",{className:"text-base font-bold",children:t.question}),o&&x.jsx("p",{className:"text-xs text-amber-600 mt-1",children:o})]})]}),u&&x.jsxs("div",{className:"border border-amber-100 bg-amber-50 rounded-lg p-3 text-xs text-amber-800 space-y-1",children:[x.jsxs("p",{className:"font-semibold flex items-center gap-1",children:[x.jsx("span",{children:""}),x.jsxs("span",{children:["",u.title]})]}),u.detail&&x.jsx("p",{className:"text-amber-700",children:u.detail}),u.meta&&x.jsx("p",{className:"text-[11px] text-amber-600",children:u.meta})]}),x.jsx("div",{className:"flex flex-wrap gap-2",children:t.options.map(v=>x.jsx("button",{type:"button",onClick:()=>e(v.id),disabled:s,className:"px-3 py-2 rounded-lg border border-amber-300 bg-amber-50 text-amber-800 text-sm font-semibold hover:bg-amber-100 disabled:opacity-50 disabled:cursor-not-allowed",children:v.label},v.id))}),t.allowFreeText&&x.jsxs("form",{onSubmit:m,className:"flex gap-2 items-center",children:[x.jsx("input",{value:d,onChange:v=>p(v.target.value),placeholder:t.placeholder??"",disabled:s,className:"flex-1 border border-amber-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-300 disabled:opacity-50"}),x.jsx("button",{type:"submit",disabled:!d.trim()||s,className:"px-3 py-2 rounded-lg bg-amber-500 text-white text-sm font-semibold hover:bg-amber-600 disabled:opacity-50 disabled:cursor-not-allowed",children:""})]}),i&&x.jsx("p",{className:"text-xs text-amber-600",children:i})]})},c3=()=>x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:x.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),d3=()=>x.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[x.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),x.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),f3=()=>x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:x.jsx("path",{d:"M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"})}),m3=()=>x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:x.jsx("path",{d:"M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"})}),p3=()=>x.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[x.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),x.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),l_=(t,e=60)=>t.length>e?`${t.slice(0,e)}`:t,h3=/card-\d+-[0-9.]+/g,g3=t=>{if(!t)return[];const e=t.match(h3);return e?Array.from(new Set(e)):[]},u_=240,y3=qC(),v3=1e4,x3=[{id:"upload_csv",label:" CSV  Upload a CSV",intent:"conversation",status:"waiting_user"},{id:"describe_goal",label:"  Describe your KPI",intent:"conversation",status:"waiting_user"}],S3=()=>qe(t=>{var e;return{progressMessages:t.progressMessages,chatHistory:t.chatHistory,isBusy:t.isBusy,handleChatMessage:t.handleChatMessage,isApiKeySet:t.isApiKeySet,setIsAsideVisible:t.setIsAsideVisible,setIsSettingsModalOpen:t.setIsSettingsModalOpen,setIsMemoryPanelOpen:t.setIsMemoryPanelOpen,handleShowCardFromChat:t.handleShowCardFromChat,currentView:t.currentView,pendingClarifications:t.pendingClarifications,activeClarificationId:t.activeClarificationId,handleClarificationResponse:t.handleClarificationResponse,skipClarification:t.skipClarification,columnProfiles:t.columnProfiles,csvData:t.csvData,focusDataPreview:t.focusDataPreview,isCancellationRequested:t.isCancellationRequested,chatMemoryPreview:t.chatMemoryPreview,chatMemoryExclusions:t.chatMemoryExclusions,previewChatMemories:t.previewChatMemories,toggleMemoryPreviewSelection:t.toggleMemoryPreviewSelection,isMemoryPreviewLoading:t.isMemoryPreviewLoading,agentAwaitingUserInput:t.agentAwaitingUserInput,agentAwaitingPromptId:t.agentAwaitingPromptId,executeQuickAction:t.executeQuickAction,graphAwaitPrompt:t.graphAwaitPrompt,graphAwaitPromptId:t.graphAwaitPromptId,graphAwaitReason:t.graphAwaitReason,graphAwaitHistory:t.graphAwaitHistory,graphToolInFlight:t.graphToolInFlight,sendGraphUserReply:t.sendGraphUserReply,runGraphPipeline:t.runGraphPipeline,addProgress:t.addProgress,graphObservations:t.graphObservations,planState:((e=t.plannerSession)==null?void 0:e.planState)??null,samplePolicy:t.samplePolicy,requestSampleUpgrade:t.requestSampleUpgrade,planValidationNotices:t.planValidationNotices,dismissPlanValidationNotice:t.dismissPlanValidationNotice,activeSchemaPhase:t.activeSchemaPhase}},Jc),w3=()=>{var Cr;const t=S3(),{progressMessages:e,chatHistory:n,isBusy:s,handleChatMessage:i,isApiKeySet:o,setIsAsideVisible:u,setIsSettingsModalOpen:d,setIsMemoryPanelOpen:p,handleShowCardFromChat:m,currentView:v,pendingClarifications:S,activeClarificationId:w,handleClarificationResponse:C,skipClarification:M,columnProfiles:I,csvData:k,focusDataPreview:F,isCancellationRequested:V,chatMemoryPreview:G,chatMemoryExclusions:z,previewChatMemories:ae,toggleMemoryPreviewSelection:Q,isMemoryPreviewLoading:J,agentAwaitingUserInput:j,agentAwaitingPromptId:X,executeQuickAction:ne,graphAwaitPrompt:le,graphAwaitPromptId:_,graphAwaitReason:E,graphAwaitHistory:P,graphToolInFlight:D,sendGraphUserReply:T,runGraphPipeline:R,addProgress:L,graphObservations:B,planState:H,samplePolicy:N,requestSampleUpgrade:q,planValidationNotices:te,dismissPlanValidationNotice:re,activeSchemaPhase:de}=t,[ue,pe]=ce.useState(""),[Ae,Fe]=ce.useState(null),[en,yt]=ce.useState({}),[tn,Ie]=ce.useState(null),Oe=ce.useRef(_),et=ce.useRef(null),Ye=ce.useRef(null);Q4(Ye,ue,{maxHeight:u_});const he=ce.useCallback(fe=>{if(!fe)return"";const De=new Date(fe);return Number.isNaN(De.getTime())?"":De.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},[]),ye=s||!!D;ce.useMemo(()=>_?P.find(fe=>fe.promptId===_)??null:null,[P,_]);const wt=ce.useMemo(()=>P.length?[...P].slice(-3).reverse():[],[P]);ce.useMemo(()=>{for(let fe=P.length-1;fe>=0;fe-=1)if(P[fe].status==="answered")return P[fe];return null},[P]);const Me=D?` ${D.label} `:tn,rn=ce.useMemo(()=>(H==null?void 0:H.nextSteps)??[],[H]),dt=ce.useMemo(()=>((H==null?void 0:H.steps)??[]).some(fe=>fe.status==="waiting_user"),[H]),Dn=ce.useMemo(()=>H!=null&&H.currentStepId?H.currentStepId.startsWith("acknowledge_user"):!1,[H]),_t=ce.useMemo(()=>typeof(H==null?void 0:H.blockedBy)=="string"&&H.blockedBy.includes("await"),[H]),rs=!!(H&&(j||dt||Dn||_t)),Kn=rn.length>0?rn:x3,vs=rs&&H!=null&&rn.length===0,on=ce.useMemo(()=>!B||B.length===0?null:pT(B[B.length-1]),[B]),It=on?{title:on.title,detail:on.detail??void 0,meta:on.metaLine??void 0}:void 0,Jt=S.some(fe=>fe.status==="pending"),xs=ce.useMemo(()=>[...n].sort((fe,De)=>fe.timestamp.getTime()-De.timestamp.getTime()),[n]),ft=(k==null?void 0:k.data)??[],ln=ce.useMemo(()=>{if(!I||I.length===0)return[];const fe=Ph(I,ft);return fe.length>0?fe:I.filter(De=>["categorical","date","time"].includes(De.type)).map(De=>({profile:De,uniqueValues:typeof De.uniqueValues=="number"?De.uniqueValues:0}))},[I,ft]);ce.useEffect(()=>{if(!_){Ie(null),Oe.current&&(L(" "),R({reason:"auto_resume"})),Oe.current=null;return}_!==Oe.current&&(L(" Graph "),Oe.current=_),Ie(null);const fe=window.setTimeout(()=>{Ie("")},v3);return()=>{window.clearTimeout(fe)}},[_,L,R]);const bt=ce.useCallback(fe=>{const De=fe.trim();De&&i(De)},[i]),vn=ce.useCallback(fe=>{var mt;const De=((mt=le==null?void 0:le.options.find(Vt=>Vt.id===fe))==null?void 0:mt.label)??fe,Et=le!=null&&le.question?`${le.question}`:"";L(` ${De}${Et}`),T(fe,void 0)},[T,L,le]),Ht=ce.useCallback(fe=>{const De=fe.trim();if(!De)return;const Et=le!=null&&le.question?`${le.question}`:"";L(` ${De}${Et}`),T(void 0,De)},[T,L,le]),Dt=!o||s,Ws=ce.useMemo(()=>{switch(de){case"plan":return"Step 1  Planner Schema";case"act":return"Step 3  Act Schema";default:return"Step 2  Talk Schema"}},[de]),$a=N.tiers[N.currentIndex]??null,Zn=$a===null?"Full dataset":`${$a.toLocaleString()} `,_r=N.currentIndex<N.tiers.length-1&&!s&&o,Ga=ce.useMemo(()=>[...te].slice(-3).reverse(),[te]),Ss=ce.useCallback(fe=>{if(Dt)return;const De=`[plan_step:${fe.id}] ${fe.label}`;L(` ${fe.label} (stepId=${fe.id})`),bt(De)},[Dt,L,bt]),br=ce.useCallback((fe,De)=>{const Et=De.trim();if(!Et||s||!o)return;const mt=fe?`[prompt:${fe}] ${Et}`:Et;i(mt)},[i,s,o]),Ha=G.filter(fe=>!z.includes(fe.id)).length,Yc=G.length>0;w??((Cr=S.find(fe=>fe.status==="pending"))==null||Cr.id);const yl=()=>{var fe;(fe=et.current)==null||fe.scrollIntoView({behavior:"smooth"})},Fi=(fe,De)=>{yt(Et=>({...Et,[fe]:De}))},za=fe=>{const De=en[fe];De&&C(fe,{label:`Manual grouping: ${De}`,value:De})},Kc=async fe=>{if(!Ae){Fe(fe);try{await ne(fe)}finally{Fe(null)}}};ce.useEffect(yl,[xs]),ce.useEffect(()=>{const fe=ue.trim();if(!fe){ae("");return}const De=window.setTimeout(()=>{ae(fe)},400);return()=>window.clearTimeout(De)},[ue,ae]);const $i=fe=>{fe.preventDefault(),ue.trim()&&!s&&(bt(ue),pe(""))},vl=fe=>{fe.key==="Enter"&&!fe.shiftKey&&$i(fe)},xl=()=>{if(!o)return"Set API Key in settings to chat";if(Jt)return"Please resolve or skip the clarification above";if(j)return"Answer the AI question above to resume";switch(v){case"analysis_dashboard":return"New analysis or transformation?";case"file_upload":default:return"Upload a file to begin chatting"}},Gi=(fe,De)=>{var Et,mt,Vt;if("sender"in fe){const Se=fe;if(Se.type==="ai_clarification"&&Se.clarificationRequest){const nt=S.find(Ct=>Ct.id===Se.clarificationRequest.id),Xn=(nt==null?void 0:nt.status)??"resolved",ja=Xn==="pending",ea=Xn==="resolving",Ja=(ja||ea)&&(nt==null?void 0:nt.id)===w,ta=nt?Xn==="pending":!1,na=Se.clarificationRequest.targetProperty==="groupByColumn",sa=en[Se.clarificationRequest.id]??"",aa=na&&ln.length>0,Pt={pending:Ja?"bg-blue-100 text-blue-800 border-blue-200":"bg-slate-100 text-slate-600 border-slate-200",resolving:"bg-amber-100 text-amber-800 border-amber-200",resolved:"bg-emerald-100 text-emerald-800 border-emerald-200",skipped:"bg-slate-200 text-slate-500 border-slate-300"},Sl=`clarification-${(nt==null?void 0:nt.id)??Se.clarificationRequest.id}`,wl=Xn==="pending"?Ja?"Active":"Queued":Xn==="resolving"?"Working":Xn==="skipped"?"Skipped":"Answered";return x.jsxs("div",{id:Sl,className:`my-2 p-3 bg-white border rounded-lg transition-colors ${Ja?"border-blue-400 shadow shadow-blue-100":"border-blue-200"} ${Xn==="resolved"?"opacity-90":""} ${Xn==="skipped"?"opacity-60":""}`,children:[x.jsxs("div",{className:"flex items-center justify-between mb-2",children:[x.jsxs("div",{className:"flex items-center text-blue-700",children:[x.jsx("span",{className:"text-lg mr-2",children:""}),x.jsx("h4",{className:"font-semibold",children:"Clarification Needed"})]}),x.jsx("span",{className:`text-xs px-2 py-1 border rounded-full ${Pt[Xn]??"bg-slate-100 text-slate-600 border-slate-200"}`,children:wl})]}),x.jsx("p",{className:"text-sm text-slate-700 mb-1",children:Se.clarificationRequest.question}),Se.clarificationRequest.reasonHint&&x.jsx("p",{className:"text-xs text-slate-500 mb-2",children:Se.clarificationRequest.reasonHint}),Se.clarificationRequest.columnHints&&Se.clarificationRequest.columnHints.length>0&&x.jsxs("p",{className:"text-xs text-slate-500 mb-2",children:["Column context: ",Se.clarificationRequest.columnHints.join(", ")]}),x.jsx("div",{className:"flex flex-col space-y-2",children:Se.clarificationRequest.options.map(Ct=>x.jsxs("button",{onClick:()=>C(Se.clarificationRequest.id,Ct),disabled:!ja||s,className:"w-full text-left text-sm px-3 py-2 bg-slate-100 rounded-md hover:bg-blue-100 hover:border-blue-500 border border-slate-200 transition-colors disabled:opacity-60 disabled:cursor-not-allowed disabled:hover:bg-slate-100",children:[x.jsx("span",{className:"font-medium text-slate-800",children:Ct.label}),x.jsxs("span",{className:"block text-xs text-slate-500",children:["Column: ",Ct.value]})]},`${Se.clarificationRequest.id}-${Ct.value}`))}),aa&&x.jsxs("div",{className:"mt-3 border-t border-slate-200 pt-3",children:[x.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"  / Pick a grouping column manually"}),x.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[x.jsxs("select",{className:"flex-1 border border-slate-200 rounded-md px-3 py-2 text-sm text-slate-700 bg-white",value:sa,onChange:Ct=>Fi(Se.clarificationRequest.id,Ct.target.value),disabled:!ja||ea,children:[x.jsx("option",{value:"",children:" / Choose a grouping column"}),ln.map(Ct=>x.jsxs("option",{value:Ct.profile.name,children:[Ct.profile.name,Ct.uniqueValues?` (${Ct.uniqueValues} distinct)`:" (distinct unknown)"]},`${Se.clarificationRequest.id}-${Ct.profile.name}`))]}),x.jsx("button",{onClick:()=>za(Se.clarificationRequest.id),disabled:!ja||s||!sa,className:"text-sm px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:" / Use column"})]})]}),x.jsx("div",{className:"flex justify-end mt-3",children:x.jsx("button",{onClick:()=>M(Se.clarificationRequest.id),disabled:!ta,className:"text-xs text-slate-500 hover:text-red-600 border border-slate-200 px-3 py-1 rounded-md transition-colors disabled:opacity-40 disabled:cursor-not-allowed",children:"Skip / Cancel"})})]},`chat-${De}`)}if(Se.type==="ai_plan_start")return x.jsxs("div",{className:"my-2 p-3 bg-slate-100 border border-slate-200 rounded-lg",children:[x.jsxs("div",{className:"flex items-center text-slate-700 mb-2",children:[x.jsx("span",{className:"text-lg mr-2",children:""}),x.jsx("h4",{className:"font-semibold",children:"Plan Execution"})]}),x.jsx("p",{className:"text-sm text-slate-700 whitespace-pre-wrap",children:Se.text})]},`chat-${De}`);if(Se.type==="ai_thinking")return x.jsxs("div",{className:"my-2 p-3 bg-white border border-blue-200 rounded-lg",children:[x.jsxs("div",{className:"flex items-center text-blue-700 mb-2",children:[x.jsx("span",{className:"text-lg mr-2",children:""}),x.jsx("h4",{className:"font-semibold",children:"AI's Initial Analysis"})]}),x.jsx("p",{className:"text-sm text-slate-700 whitespace-pre-wrap",children:Se.text})]},`chat-${De}`);if(Se.type==="ai_proactive_insight")return x.jsxs("div",{className:"my-2 p-3 bg-yellow-50 border border-yellow-300 rounded-lg",children:[x.jsxs("div",{className:"flex items-center text-yellow-800 mb-2",children:[x.jsx("span",{className:"text-lg mr-2",children:""}),x.jsx("h4",{className:"font-semibold",children:"Proactive Insight"})]}),x.jsx("p",{className:"text-sm text-slate-700 whitespace-pre-wrap",children:Se.text}),Se.cardId&&x.jsx("button",{onClick:()=>m(Se.cardId),className:"mt-2 text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-md hover:bg-yellow-200 transition-colors w-full text-left font-medium",children:" Show Related Card"})]},`chat-${De}`);if(Se.sender==="user")return x.jsx("div",{className:"flex justify-end",children:x.jsx("div",{className:"bg-blue-600 rounded-lg px-3 py-2 max-w-xs lg:max-w-md",children:x.jsx("p",{className:"text-sm text-white",style:{whiteSpace:"break-spaces"},children:Se.text})})},`chat-${De}`);const Qs=[];return Se.isError||(Se.cardId&&Qs.push(Se.cardId),g3(Se.text).forEach(nt=>{Qs.includes(nt)||Qs.push(nt)})),x.jsx("div",{className:"flex",children:x.jsxs("div",{className:`rounded-lg px-3 py-2 max-w-xs lg:max-w-md ${Se.isError?"bg-red-100":"bg-slate-200"}`,children:[x.jsx("p",{className:`text-sm ${Se.isError?"text-red-800":"text-slate-800"}`,style:{whiteSpace:"break-spaces"},children:Se.text}),!Se.isError&&Qs.map(nt=>x.jsxs("button",{onClick:()=>m(nt),className:"mt-2 text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-md hover:bg-blue-200 transition-colors w-full text-left font-medium",children:[" Show Related Card (",nt,")"]},`${nt}-${De}`)),((Et=Se.cta)==null?void 0:Et.type)==="open_data_preview"&&x.jsxs("button",{onClick:F,className:"mt-2 text-xs bg-white text-blue-700 border border-blue-200 px-2 py-1 rounded-md hover:bg-blue-50 transition-colors w-full text-left font-medium",children:[" ",Se.cta.label,Se.cta.helperText&&x.jsx("span",{className:"block text-[11px] text-slate-500 mt-0.5",children:Se.cta.helperText})]}),Se.quickActions&&x.jsxs("div",{className:"mt-3 border border-slate-300 rounded-lg bg-white p-3 space-y-2",children:[x.jsxs("div",{children:[x.jsx("p",{className:"text-xs font-semibold text-slate-700",children:Se.quickActions.title??"Quick start actions"}),Se.quickActions.helperText&&x.jsx("p",{className:"text-[11px] text-slate-500 mt-0.5",children:Se.quickActions.helperText})]}),x.jsx("div",{className:"space-y-2",children:Se.quickActions.actions.map(nt=>x.jsxs("button",{onClick:()=>Kc(nt.id),disabled:!!Ae,className:"w-full text-left rounded-md border border-slate-200 bg-blue-50 px-3 py-2 text-sm text-blue-900 hover:bg-blue-100 disabled:opacity-50 disabled:cursor-not-allowed",children:[x.jsx("span",{className:"font-semibold block",children:nt.label}),nt.helperText&&x.jsx("span",{className:"text-xs text-blue-700 block",children:nt.helperText})]},`${nt.id}-${De}`))})]}),Se.usedMemories&&Se.usedMemories.length>0&&x.jsxs("div",{className:"mt-2 border border-blue-100 bg-white rounded-md p-2",children:[x.jsxs("p",{className:"text-[11px] font-semibold text-blue-700 mb-1",children:["Used memory (",Se.usedMemories.length,")"]}),x.jsx("div",{className:"flex flex-wrap gap-1",children:Se.usedMemories.map(nt=>x.jsx("span",{className:"text-[11px] text-slate-600 bg-blue-50 border border-blue-100 rounded-full px-2 py-0.5",children:l_(nt.text,48)},nt.id))})]}),((mt=Se.meta)==null?void 0:mt.awaitUser)&&((Vt=Se.meta)==null?void 0:Vt.promptId)&&x.jsx("div",{className:"mt-3",children:x.jsx(l3,{promptId:Se.meta.promptId,message:Se.text,onSubmit:nt=>br(Se.meta.promptId,nt),disabled:!o||s&&!j,isActive:!X||X===Se.meta.promptId})})]})},`chat-${De}`)}};return x.jsxs("div",{className:"flex flex-col h-full bg-slate-100 rounded-lg md:rounded-none",children:[x.jsxs("div",{className:"p-4 border-b border-slate-200 flex justify-between items-center relative",children:[x.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Assistant"}),x.jsxs("div",{className:"flex items-center space-x-3",children:[x.jsx("button",{onClick:()=>p(!0),className:"p-1 text-slate-500 rounded-full hover:bg-slate-200 hover:text-slate-800 transition-colors",title:"View AI Memory","aria-label":"View AI Memory",children:x.jsx(f3,{})}),y3.showSettingsButton&&x.jsx("button",{onClick:()=>d(!0),className:"p-1 text-slate-500 rounded-full hover:bg-slate-200 hover:text-slate-800 transition-colors",title:"Settings","aria-label":"Open Settings",children:x.jsx(d3,{})}),x.jsx("button",{onClick:()=>u(!1),className:"p-1 text-slate-500 rounded-full hover:bg-slate-200 hover:text-slate-800 transition-colors",title:"Hide Panel","aria-label":"Hide Assistant Panel",children:x.jsx(c3,{})})]})]}),x.jsxs("div",{className:"flex-1 p-4 overflow-y-auto space-y-4",children:[x.jsxs("div",{className:"space-y-2",children:[x.jsxs("div",{className:"rounded-lg border border-blue-200 bg-blue-50 px-3 py-2 text-sm text-blue-800",children:[x.jsx("div",{className:"font-semibold",children:Ws}),(H==null?void 0:H.goal)&&x.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:["",H.goal]})]}),x.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700",children:[x.jsxs("div",{children:[x.jsx("div",{className:"font-semibold text-slate-900",children:""}),x.jsx("div",{className:"text-xs text-slate-500",children:Zn})]}),x.jsx("button",{type:"button",onClick:()=>q("user_confirm"),disabled:!_r,className:"rounded-md bg-blue-600 px-3 py-1 text-xs font-semibold text-white shadow-sm transition disabled:opacity-40 disabled:cursor-not-allowed",children:""})]}),Ga.length>0&&x.jsx("div",{className:"space-y-2",children:Ga.map(fe=>x.jsxs("div",{className:"flex items-start gap-2 rounded-lg border border-amber-200 bg-amber-50 px-3 py-2 text-sm text-amber-900",children:[x.jsxs("div",{children:[x.jsxs("span",{className:"font-semibold",children:[fe.planTitle,""]}),fe.message]}),x.jsx("button",{type:"button",onClick:()=>re(fe.id),className:"text-xs text-amber-500 hover:text-amber-800",children:""})]},fe.id))})]}),x.jsx(mT,{}),rs&&x.jsxs("div",{className:"mb-4 rounded-xl border border-amber-200 bg-amber-50 p-4 shadow-sm","aria-live":"polite",children:[x.jsx("p",{className:"text-xs font-semibold text-amber-700 uppercase tracking-wide",children:"Awaiting your choice  "}),x.jsx("p",{className:"text-sm text-amber-900 mt-1",children:"Pick the next agent step to continue"}),x.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:Kn.map(fe=>x.jsxs("button",{type:"button",onClick:()=>Ss(fe),disabled:Dt,className:"px-3 py-2 rounded-lg border border-amber-300 bg-white text-amber-900 text-sm font-semibold hover:bg-amber-100 disabled:opacity-50 disabled:cursor-not-allowed",children:[x.jsx("span",{children:fe.label}),x.jsx("span",{className:"block text-[11px] text-amber-500",children:fe.intent??"conversation"})]},fe.id))}),vs&&x.jsx("p",{className:"text-[11px] text-amber-600 mt-2",children:" nextSteps"})]}),x.jsx(hT,{}),xs.map(Gi),x.jsx("div",{ref:et})]}),x.jsxs("div",{className:"p-4 border-t border-slate-200 bg-white",children:[Yc&&x.jsxs("div",{className:"mb-3",children:[x.jsxs("div",{className:"flex items-center gap-2 text-[11px] font-semibold text-slate-600 uppercase tracking-wide",children:["Used memory (",Ha,"/",G.length,")",J&&x.jsx("span",{className:"text-slate-400 font-normal normal-case",children:"Updating"})]}),x.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:G.map(fe=>{const De=z.includes(fe.id);return x.jsx("button",{type:"button",onClick:()=>Q(fe.id),className:`text-[11px] px-2 py-1 rounded-full border transition-colors ${De?"bg-white border-slate-300 text-slate-400 line-through":"bg-blue-50 border-blue-200 text-blue-700"}`,title:De?"Click to include this memory":"Click to exclude this memory",children:l_(fe.text,42)},fe.id)})})]}),le&&x.jsxs("div",{className:"mb-4","aria-live":"polite",children:[x.jsx(u3,{prompt:le,onSelect:vn,onSubmitFreeText:Ht,disabled:ye,reasonText:E,waitingHint:Me,latestObservation:It}),D&&x.jsxs("div",{className:"mt-2 rounded-md border border-indigo-200 bg-indigo-50 px-3 py-2 text-xs text-indigo-800",role:"status",children:[x.jsxs("p",{children:[" ",D.label," "]}),x.jsx("p",{className:"text-[11px] mt-1",children:D.startedAt?` ${he(D.startedAt)}`:""})]}),wt.length>0&&x.jsxs("div",{className:"mt-3 rounded-lg border border-slate-200 bg-slate-50 p-3",children:[x.jsx("p",{className:"text-xs font-semibold text-slate-700",children:""}),x.jsx("ul",{className:"mt-2 space-y-1 text-[12px] text-slate-600",children:wt.map(fe=>x.jsxs("li",{className:"flex flex-col",children:[x.jsx("span",{className:"text-slate-800 font-medium",children:fe.question}),x.jsx("span",{children:fe.status==="answered"?`${fe.responseLabel??fe.responseValue??""}  ${he(fe.respondedAt)}`:""})]},`${fe.promptId??fe.askedAt}`))})]})]}),x.jsxs("form",{onSubmit:$i,className:"flex items-start space-x-2",children:[x.jsxs("div",{className:"relative flex-grow",children:[x.jsx("textarea",{ref:Ye,rows:1,value:ue,onChange:fe=>pe(fe.target.value),onKeyDown:vl,placeholder:xl(),disabled:!o||v==="file_upload"||Jt||j,"aria-describedby":"chat-input-char-count",className:"w-full bg-white border border-slate-300 rounded-md py-2 pl-3 pr-14 text-sm leading-5 text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 resize-none",style:{minHeight:"40px",maxHeight:`${u_}px`,overflowY:"hidden"}}),x.jsxs("span",{id:"chat-input-char-count",className:"pointer-events-none absolute bottom-2 right-3 text-[11px] text-slate-400",children:[ue.length," chars"]})]}),x.jsxs("button",{type:"submit",disabled:s||!ue.trim()||!o||v==="file_upload"||Jt||j,className:"flex-shrink-0 px-4 h-10 flex items-center justify-center gap-2 bg-blue-600 text-white font-semibold rounded-md hover:bg-blue-700 transition-colors disabled:bg-blue-300 disabled:cursor-not-allowed","aria-label":s?V?"Cancelling request":"Sending message":"Send message",children:[s?x.jsx(p3,{}):x.jsx(m3,{}),x.jsx("span",{className:"text-sm",children:s?V?"Cancelling":"Sending":"Send"})]})]}),x.jsx("div",{className:"mt-3",children:x.jsx(fT,{className:"mt-0"})})]})]})},_3=t=>{const e=[];let n=0,s=null;return t.forEach(i=>{if(i.text.startsWith("Continuing plan")){n+=1,s=i.timestamp;return}n>0&&(e.push({text:n===1?"Continuing plan":`Continuing plan retried ${n}`,type:"system",timestamp:s??i.timestamp}),n=0,s=null),e.push(i)}),n>0&&e.push({text:n===1?"Continuing plan":`Continuing plan retried ${n}`,type:"system",timestamp:s??new Date}),e.slice(-30)},b3={observing:"bg-slate-400",executing:"bg-blue-500",succeeded:"bg-emerald-500",failed:"bg-red-500"},C3={chat:"Chat",pipeline:"Analysis Pipeline",system:"System"},T3=t=>(t instanceof Date?t:new Date(t)).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),fT=$s.memo(({className:t})=>{const{progressMessages:e,agentActionTraces:n}=qe(m=>({progressMessages:m.progressMessages,agentActionTraces:m.agentActionTraces}),Jc),[s,i]=ce.useState(!0),o=ce.useMemo(()=>_3(e),[e]),u=ce.useMemo(()=>n.slice(-20),[n]),d=ce.useMemo(()=>{const m=o.map((S,w)=>({kind:"progress",id:`sys-${S.timestamp.getTime()}-${w}`,timestamp:S.timestamp,entry:S})),v=u.map(S=>({kind:"action",id:S.id,timestamp:S.timestamp instanceof Date?S.timestamp:new Date(S.timestamp),trace:S}));return[...m,...v].sort((S,w)=>w.timestamp.getTime()-S.timestamp.getTime()).slice(0,40)},[o,u]);if(d.length===0)return null;const p=`${t??"mb-4"} rounded-lg border border-slate-200 bg-white shadow-sm`.trim();return x.jsxs("div",{className:p,children:[x.jsxs("button",{type:"button",onClick:()=>i(m=>!m),className:"w-full flex items-center justify-between px-3 py-2 text-xs font-medium text-slate-600",children:[x.jsx("span",{className:"uppercase tracking-wide",children:"System log"}),x.jsxs("span",{className:"text-[11px] text-slate-400",children:[d.length," events  ",s?"Show":"Hide"]})]}),!s&&x.jsx("div",{className:"max-h-64 overflow-y-auto divide-y divide-slate-100 px-1",children:d.map(m=>{if(m.kind==="progress"){const{entry:C}=m;return x.jsxs("div",{className:`px-2 py-2 text-xs flex gap-2 ${C.type==="error"?"text-red-600":"text-slate-600"}`,children:[x.jsx("span",{className:"text-slate-400",children:C.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),x.jsx("span",{className:"leading-snug",children:C.text})]},m.id)}const v=m.trace,S=v.status??"observing",w=v.source??"chat";return x.jsxs("div",{className:"px-2 py-3 text-sm",children:[x.jsxs("div",{className:"flex items-center text-xs text-slate-500 gap-2",children:[x.jsx("span",{className:`w-2 h-2 rounded-full ${b3[S]}`}),x.jsx("span",{className:"font-medium",children:T3(v.timestamp)}),x.jsx("span",{children:""}),x.jsx("span",{children:C3[w]??"AI"}),x.jsx("span",{children:""}),x.jsx("span",{className:"capitalize",children:S})]}),x.jsx("p",{className:"text-slate-800 mt-0.5 leading-snug whitespace-pre-line",children:v.summary}),v.details&&x.jsx("p",{className:"text-xs text-slate-500 mt-1 leading-snug whitespace-pre-line",children:v.details})]},m.id)})})]})});fT.displayName="SystemLogPanel";const mT=$s.memo(()=>{const{planState:t,pendingClarifications:e,handleClarificationResponse:n,skipClarification:s,agentAwaitingUserInput:i,isBusy:o}=qe(j=>{var X;return{planState:((X=j.plannerSession)==null?void 0:X.planState)??null,pendingClarifications:j.pendingClarifications,handleClarificationResponse:j.handleClarificationResponse,skipClarification:j.skipClarification,agentAwaitingUserInput:j.agentAwaitingUserInput,isBusy:j.isBusy}},Jc),[u,d]=ce.useState(!0),[p,m]=ce.useState({}),v=ce.useMemo(()=>t?t.steps&&t.steps.length>0?t.steps:t.nextSteps??[]:[],[t]);if(!t)return null;const S=v.length,w=v.filter(j=>j.status==="done").length,C=t.currentStepId?v.findIndex(j=>j.id===t.currentStepId):-1,M=t.updatedAt?new Date(t.updatedAt):new Date,I=S>0?`${w} / ${S} completed`:t.progress??"Tracking",k=S>0&&C>=0?`Step ${Math.min(C+1,S)} of ${S}`:S>0?`Tracking ${S} steps`:null,F=e.find(j=>j.status==="pending"||j.status==="resolving")??null,V=t.currentStepId&&v.length>0?v.find(j=>j.id===t.currentStepId):null,G=!!V&&(V.status==="waiting_user"||i)&&!!F,z={done:"bg-emerald-500",in_progress:"bg-blue-500",ready:"bg-slate-400",waiting_user:"bg-amber-500"},ae={done:"Done",in_progress:"In progress",ready:"Queued",waiting_user:"Awaiting you"},Q=(j,X)=>{m(ne=>({...ne,[j]:X}))},J=j=>{const X=(p[j]??"").trim();X&&(n(j,{label:X,value:X}),m(ne=>({...ne,[j]:""})))};return x.jsxs("div",{className:"mb-4 rounded-xl border border-slate-200 bg-gradient-to-b from-white to-slate-50 shadow-sm",children:[x.jsxs("button",{type:"button",className:"w-full px-4 py-3 flex flex-col text-left focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 rounded-t-xl",onClick:()=>d(j=>!j),children:[x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("div",{children:[x.jsx("p",{className:"text-sm font-semibold text-slate-900",children:"Agent Working Status"}),x.jsx("p",{className:"text-xs text-slate-500",children:I})]}),x.jsxs("div",{className:"text-right",children:[k&&x.jsx("p",{className:"text-xs text-slate-500",children:k}),x.jsx("span",{className:"text-[11px] uppercase tracking-wide text-slate-400",children:u?"Show details":"Hide details"})]})]}),t.blockedBy&&x.jsxs("p",{className:"mt-1 text-xs text-amber-600",children:["Blocked: ",t.blockedBy]}),S>0&&x.jsx("div",{className:"mt-3 h-1.5 w-full bg-slate-200 rounded-full overflow-hidden",children:x.jsx("div",{className:"h-full bg-blue-500 transition-all",style:{width:`${Math.min(w/S*100,100)}%`}})}),x.jsxs("p",{className:"mt-1 text-[11px] text-slate-400",children:["Updated ",M.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),!u&&x.jsxs("div",{className:"px-4 pb-4 space-y-4 text-sm text-slate-700",children:[t.goal&&x.jsxs("p",{className:"text-sm",children:[x.jsx("span",{className:"font-medium text-slate-900",children:"Goal:"})," ",t.goal]}),t.contextSummary&&x.jsxs("p",{className:"text-xs text-slate-500",children:[x.jsx("span",{className:"font-semibold text-slate-600",children:"Context:"})," ",t.contextSummary]}),x.jsxs("ol",{className:"relative space-y-3",children:[v.map((j,X)=>{const ne=j.status??"ready",le=j.id===t.currentStepId,_=G&&F&&le;return x.jsxs("li",{className:"relative pl-6",children:[x.jsx("span",{className:`absolute left-0 top-1.5 h-3 w-3 rounded-full ${z[ne]??"bg-slate-300"}`,"aria-hidden":!0}),x.jsxs("div",{className:"flex items-start justify-between gap-3",children:[x.jsxs("div",{children:[x.jsx("p",{className:`font-medium ${le?"text-slate-900":"text-slate-700"}`,children:j.label}),j.intent&&x.jsx("p",{className:"text-xs text-slate-500",children:j.intent})]}),x.jsx("span",{className:"text-xs text-slate-500",children:ae[ne]??ne})]}),_&&x.jsxs("div",{className:"mt-3 rounded-lg border border-blue-100 bg-blue-50 p-3",children:[x.jsxs("p",{className:"text-sm font-medium text-blue-900 flex items-center gap-2 mb-2",children:[x.jsx("span",{className:"text-base",children:""}),F.question]}),F.reasonHint&&x.jsx("p",{className:"text-xs text-blue-700 mb-2",children:F.reasonHint}),x.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:F.options.map(E=>x.jsx("button",{type:"button",onClick:()=>n(F.id,E),disabled:o,className:"text-xs px-3 py-1 rounded-full border border-blue-200 bg-white text-blue-700 hover:bg-blue-100 disabled:opacity-60 disabled:cursor-not-allowed",children:E.label},`${F.id}-${E.value}`))}),x.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[x.jsx("input",{type:"text",value:p[F.id]??"",onChange:E=>Q(F.id,E.target.value),placeholder:"Type your answer",className:"flex-1 rounded-md border border-blue-100 bg-white px-3 py-2 text-sm text-slate-800 placeholder-slate-400 focus:border-blue-300 focus:ring-1 focus:ring-blue-300",disabled:o}),x.jsx("button",{type:"button",onClick:()=>J(F.id),disabled:o||!(p[F.id]??"").trim(),className:"px-4 py-2 rounded-md bg-blue-600 text-white text-xs font-semibold uppercase tracking-wide disabled:opacity-50 disabled:cursor-not-allowed",children:"Send"}),x.jsx("button",{type:"button",onClick:()=>s(F.id),disabled:o,className:"px-3 py-2 rounded-md border border-transparent text-xs text-slate-500 hover:text-red-600",children:"Skip"})]})]})]},j.id??X)}),v.length===0&&x.jsx("li",{className:"text-xs text-slate-500",children:"Waiting for the agent to draft a plan"})]})]})]})});mT.displayName="PlannerGoalTracker";const A3={aggregate_plan:{icon:"",label:"Plan Preview"},profile_dataset:{icon:"",label:"Dataset Profile"},normalize_invoice_month:{icon:"",label:"Invoice Month Clean"},detect_outliers:{icon:"",label:"Outlier Detection"},tool_result:{icon:"",label:"Tool Result"}},E3=t=>{const e=new Date(t);return Number.isNaN(e.getTime())?"":e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},R3=t=>{if(!t)return null;const{promptTokens:e,completionTokens:n,totalTokens:s}=t;if(e==null&&n==null&&s==null)return null;const i=e!=null?`in ${e}`:null,o=n!=null?`out ${n}`:null,u=s!=null?`total ${s}`:e!=null||n!=null?`total ${(e??0)+(n??0)}`:null;return["Tok",i,o,u].filter(Boolean).join("  ")},pT=t=>{const e=t.payload??{},n=A3[t.kind]??{icon:"",label:t.kind.replace(/_/g," ")};let s=null;typeof e.summary=="string"?s=e.summary:typeof e.description=="string"?s=e.description:typeof e.text=="string"&&(s=e.text);const i=[],o=e.meta??{};typeof o.rows=="number"&&i.push(`${o.rows} `),typeof o.source=="string"&&i.push(o.source==="full"?"":""),typeof o.durationMs=="number"&&i.push(`${Math.round(o.durationMs)} ms`);const u=e.telemetry??o.telemetry;(u==null?void 0:u.latencyMs)!=null&&i.push(`Latency ${Math.round(u.latencyMs)} ms`);const d=R3(u==null?void 0:u.tokenUsage);d&&i.push(d),(u==null?void 0:u.estimatedCostUsd)!=null&&i.push(`$${u.estimatedCostUsd.toFixed(4)}`);const p=i.length>0?i.join("  "):null;return{id:t.id,timestamp:t.at,icon:n.icon,title:n.label,detail:s,metaLine:p}},hT=$s.memo(()=>{const{observations:t,isBusy:e}=qe(s=>({observations:s.graphObservations,isBusy:s.isBusy}),Jc),n=ce.useMemo(()=>t.slice(-10).reverse(),[t]);return n.length===0?null:x.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg p-3 shadow-sm",children:[x.jsxs("div",{className:"flex items-center justify-between mb-3",children:[x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx("span",{className:"text-lg",children:""}),x.jsxs("div",{children:[x.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Realtime Observation Timeline"}),x.jsx("p",{className:"text-xs text-slate-500",children:"Newest events shown first"})]})]}),e&&x.jsx("span",{className:"text-xs uppercase tracking-wide text-blue-600 font-semibold",children:"Running"})]}),x.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto pr-1",children:n.map(s=>{const i=pT(s);return x.jsxs("div",{className:"relative border-l-2 border-slate-100 pl-3",children:[x.jsx("span",{className:"absolute -left-[5px] top-2 text-sm",children:i.icon}),x.jsx("div",{className:"flex items-center justify-between text-[11px] text-slate-500",children:x.jsx("span",{className:"font-medium",children:E3(i.timestamp)})}),x.jsx("p",{className:"text-sm font-semibold text-slate-800 mt-1",children:i.title}),i.detail&&x.jsx("p",{className:"text-xs text-slate-600 mt-1 whitespace-pre-line",children:i.detail}),i.metaLine&&x.jsx("p",{className:"text-[11px] text-slate-500 mt-1",children:i.metaLine})]},i.id)})})]})});hT.displayName="GraphObservationTimeline";const N3=()=>{const{handleFileUpload:t,isBusy:e,isApiKeySet:n,progressMessages:s,fileName:i}=qe(S=>{var w;return{handleFileUpload:S.handleFileUpload,isBusy:S.isBusy,isApiKeySet:S.isApiKeySet,progressMessages:S.progressMessages,fileName:((w=S.csvData)==null?void 0:w.fileName)||null}}),[o,u]=ce.useState(!1),d={id:"file-upload-panel"},p=ce.useCallback(S=>{S.preventDefault(),S.stopPropagation(),n&&(S.type==="dragenter"||S.type==="dragover"?u(!0):S.type==="dragleave"&&u(!1))},[n]),m=ce.useCallback(S=>{S.preventDefault(),S.stopPropagation(),u(!1),n&&S.dataTransfer.files&&S.dataTransfer.files[0]&&t(S.dataTransfer.files[0])},[t,n]),v=S=>{n&&S.target.files&&S.target.files[0]&&t(S.target.files[0])};return e&&i?x.jsxs("div",{...d,className:"flex flex-col items-center justify-center p-12 border-2 border-dashed rounded-lg border-blue-500 bg-slate-100 h-full",children:[x.jsxs("div",{className:"flex items-center text-xl text-slate-800 mb-4",children:[x.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[x.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),x.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),x.jsxs("span",{children:['Processing "',i,'"...']})]}),x.jsx("div",{className:"w-full max-w-lg bg-white rounded-md p-4 max-h-64 overflow-y-auto border border-slate-200",children:x.jsx("ul",{className:"space-y-1",children:s.map((S,w)=>x.jsxs("li",{className:`flex text-xs ${S.type==="error"?"text-red-600":"text-slate-500"}`,children:[x.jsx("span",{className:"mr-2 text-slate-400",children:S.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})}),x.jsx("span",{children:S.text})]},w))})}),x.jsx("p",{className:"mt-4 text-xs text-slate-500",children:"All processing is done locally in your browser. Your data stays private."})]}):n?x.jsxs("div",{...d,onDragEnter:p,onDragLeave:p,onDragOver:p,onDrop:m,className:`flex flex-col items-center justify-center p-12 border-2 border-dashed rounded-lg transition-colors duration-300 h-full ${o?"border-blue-500 bg-slate-100":"border-slate-300 hover:border-blue-500"}`,children:[x.jsx("svg",{className:"w-16 h-16 text-slate-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:x.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V7a2 2 0 012-2h10a2 2 0 012 2v10a2 2 0 01-2 2z"})}),x.jsx("p",{className:"text-xl text-slate-500 mb-2",children:"Drag & drop your CSV file here"}),x.jsx("p",{className:"text-slate-400",children:"or"}),x.jsx("label",{htmlFor:"file-upload",className:"mt-4 cursor-pointer bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors",children:"Select a file"}),x.jsx("input",{id:"file-upload",type:"file",accept:".csv",onChange:v,className:"hidden",disabled:e}),x.jsx("p",{className:"mt-4 text-xs text-slate-500",children:"All processing is done locally in your browser. Your data stays private."})]}):x.jsxs("div",{...d,className:"flex flex-col items-center justify-center p-12 border-2 border-dashed rounded-lg border-slate-300 h-full",children:[x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-16 h-16 text-slate-400 mb-4",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:x.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 5.25a3 3 0 013 3m3 0a6 6 0 01-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1121.75 8.25z"})}),x.jsx("h3",{className:"text-xl font-semibold text-slate-800",children:"API Key Required"}),x.jsx("p",{className:"mt-2 max-w-sm text-center text-slate-500",children:"To unlock the AI analysis features, please add your Google Gemini API key in the Assistant's settings panel."}),x.jsx("p",{className:"mt-6 text-xs text-slate-400",children:"Your data remains local and private even when using the AI."})]})},M3=["English","Mandarin","Spanish","Japanese","French"],c_=["gemini-2.5-flash","gemini-2.5-pro"],d_=["gpt-5","gpt-5-mini"],I3=[{label:"Every 15 seconds",value:15},{label:"Every 30 seconds",value:30},{label:"Every minute",value:60},{label:"Every 2 minutes",value:120}],D3=()=>{const{isOpen:t,onClose:e,onSave:n,currentSettings:s,aggregationMode:i,setAggregationMode:o}=qe(w=>({isOpen:w.isSettingsModalOpen,onClose:()=>w.setIsSettingsModalOpen(!1),onSave:w.handleSaveSettings,currentSettings:w.settings,aggregationMode:w.aggregationModePreference,setAggregationMode:w.setAggregationModePreference})),[u,d]=ce.useState(s);if(ce.useEffect(()=>{d(s)},[s,t]),!t)return null;const p=()=>{n(u),e()},m=w=>{const{name:C,value:M}=w.target;d(C==="autoSaveIntervalSeconds"?I=>({...I,[C]:Number(M)}):I=>({...I,[C]:M}))},v=w=>{d(C=>{const M=c_.includes(C.model),I=d_.includes(C.model);let k=C.model;return w==="google"&&!M?k="gemini-2.5-pro":w==="openai"&&!I&&(k="gpt-5"),{...C,provider:w,model:k}})},S=w=>`px-3 py-1 text-xs font-semibold rounded-md transition ${i===w?"bg-blue-600 text-white shadow-sm":"bg-white text-slate-600 hover:bg-slate-100 border border-slate-200"}`;return x.jsx("div",{className:"fixed inset-0 bg-slate-900 bg-opacity-50 flex items-center justify-center z-50",onClick:e,children:x.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-md border border-slate-200 max-h-[80vh] flex flex-col overflow-hidden",onClick:w=>w.stopPropagation(),children:[x.jsxs("div",{className:"flex-1 overflow-y-auto pr-1",children:[x.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-6",children:"Settings"}),x.jsxs("div",{className:"space-y-6 pb-4",children:[x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"AI Provider"}),x.jsxs("div",{className:"flex space-x-2 rounded-lg bg-slate-200 p-1",children:[x.jsx("button",{onClick:()=>v("google"),className:`w-full rounded-md py-1.5 text-sm font-medium transition-colors ${u.provider==="google"?"bg-blue-600 text-white shadow":"text-slate-700 hover:bg-slate-300"}`,children:"Google Gemini"}),x.jsx("button",{onClick:()=>v("openai"),className:`w-full rounded-md py-1.5 text-sm font-medium transition-colors ${u.provider==="openai"?"bg-blue-600 text-white shadow":"text-slate-700 hover:bg-slate-300"}`,children:"OpenAI"})]})]}),u.provider==="google"&&x.jsxs("div",{children:[x.jsx("label",{htmlFor:"geminiApiKey",className:"block text-sm font-medium text-slate-700",children:"Gemini API Key"}),x.jsx("input",{type:"password",id:"geminiApiKey",name:"geminiApiKey",value:u.geminiApiKey,onChange:m,className:"mt-1 block w-full bg-white border border-slate-300 rounded-md py-2 px-3 text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter your API key"}),x.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Get your key from ",x.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"Google AI Studio"}),"."]})]}),u.provider==="openai"&&x.jsxs("div",{children:[x.jsx("label",{htmlFor:"openAIApiKey",className:"block text-sm font-medium text-slate-700",children:"OpenAI API Key"}),x.jsx("input",{type:"password",id:"openAIApiKey",name:"openAIApiKey",value:u.openAIApiKey,onChange:m,className:"mt-1 block w-full bg-white border border-slate-300 rounded-md py-2 px-3 text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter your API key (sk-...)"}),x.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Get your key from ",x.jsx("a",{href:"https://platform.openai.com/api-keys",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"OpenAI Platform"}),"."]})]}),x.jsxs("div",{children:[x.jsx("label",{htmlFor:"model",className:"block text-sm font-medium text-slate-700",children:"AI Model"}),x.jsx("input",{type:"text",id:"model",name:"model",value:u.model,onChange:m,list:"model-list",className:"mt-1 block w-full bg-white border border-slate-300 rounded-md py-2 px-3 text-slate-900 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., gpt-5"}),x.jsx("datalist",{id:"model-list",children:(u.provider==="google"?c_:d_).map(w=>x.jsx("option",{value:w},w))}),x.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Select a suggested model or type a custom one."})]}),x.jsxs("div",{children:[x.jsx("label",{htmlFor:"language",className:"block text-sm font-medium text-slate-700",children:"Agent Language"}),x.jsx("select",{id:"language",name:"language",value:u.language,onChange:m,className:"mt-1 block w-full bg-white border border-slate-300 rounded-md py-2 px-3 text-slate-900 focus:outline-none focus:ring-2 focus:ring-blue-500",children:M3.map(w=>x.jsx("option",{value:w,children:w},w))}),x.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Primary language for AI summaries and chat responses."})]}),x.jsxs("div",{className:"border-t border-slate-200 pt-4",children:[x.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Aggregation Mode  "}),x.jsx("p",{className:"text-xs text-slate-500 mb-3 max-w-sm",children:" = DuckDB  =  5k "}),x.jsxs("div",{className:"inline-flex items-center gap-1 rounded-lg bg-slate-100 p-1",children:[x.jsx("button",{type:"button",className:S("full"),onClick:()=>o("full"),children:""}),x.jsx("button",{type:"button",className:S("sample"),onClick:()=>o("sample"),children:""})]})]}),x.jsxs("div",{className:"border-t border-slate-200 pt-4",children:[x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Auto-Save"}),x.jsx("p",{className:"text-xs text-slate-500",children:"Periodically store the current analysis so you can recover it later."})]}),x.jsx("button",{onClick:()=>d(w=>({...w,autoSaveEnabled:!w.autoSaveEnabled})),className:`px-3 py-1 rounded-full text-sm font-medium transition-colors ${u.autoSaveEnabled?"bg-blue-600 text-white":"bg-slate-200 text-slate-700"}`,children:u.autoSaveEnabled?"Enabled":"Paused"})]}),u.autoSaveEnabled&&x.jsxs("div",{className:"mt-4",children:[x.jsx("label",{htmlFor:"autoSaveIntervalSeconds",className:"block text-sm font-medium text-slate-700",children:"Auto-Save Frequency"}),x.jsx("select",{id:"autoSaveIntervalSeconds",name:"autoSaveIntervalSeconds",value:u.autoSaveIntervalSeconds,onChange:m,className:"mt-1 block w-full bg-white border border-slate-300 rounded-md py-2 px-3 text-slate-900 focus:outline-none focus:ring-2 focus:ring-blue-500",children:I3.map(w=>x.jsx("option",{value:w.value,children:w.label},w.value))})]})]})]})]}),x.jsxs("div",{className:"mt-6 flex justify-end space-x-3 border-t border-slate-200 pt-4 shrink-0 bg-white",children:[x.jsx("button",{onClick:e,className:"px-4 py-2 bg-slate-200 text-slate-800 rounded-md hover:bg-slate-300 transition-colors",children:"Cancel"}),x.jsx("button",{onClick:p,className:"px-4 py-2 bg-blue-600 text-white font-semibold rounded-md hover:bg-blue-700 transition-colors",children:"Save Settings"})]})]})})},P3=()=>x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:x.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),k3=()=>x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:x.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),L3=()=>{const{isOpen:t,onClose:e,reports:n,onLoadReport:s,onDeleteReport:i}=qe(u=>({isOpen:u.isHistoryPanelOpen,onClose:()=>u.setIsHistoryPanelOpen(!1),reports:u.reportsList,onLoadReport:u.handleLoadReport,onDeleteReport:u.handleDeleteReport}));if(!t)return null;const o=(u,d,p)=>{u.stopPropagation(),window.confirm(`Are you sure you want to delete the report for "${p}"? This cannot be undone.`)&&i(d)};return x.jsx("div",{className:"fixed inset-0 bg-slate-900 bg-opacity-50 flex items-center justify-center z-50",onClick:e,children:x.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-2xl h-full max-h-[80vh] border border-slate-200 flex flex-col",onClick:u=>u.stopPropagation(),children:[x.jsxs("div",{className:"flex justify-between items-center mb-4",children:[x.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"Analysis History"}),x.jsx("button",{onClick:e,className:"p-1 text-slate-500 rounded-full hover:bg-slate-100 hover:text-slate-800 transition-colors",title:"Close History",children:x.jsx(P3,{})})]}),x.jsx("div",{className:"flex-grow overflow-y-auto pr-2",children:n.length===0?x.jsx("div",{className:"flex items-center justify-center h-full",children:x.jsx("p",{className:"text-slate-500",children:"No past reports found. Upload a CSV to start."})}):x.jsx("ul",{className:"space-y-3",children:n.map(u=>{const d=u.id===ka;return x.jsx("li",{children:x.jsx("div",{onClick:()=>!d&&s(u.id),className:`block p-4 bg-slate-50 rounded-lg transition-all ${d?"ring-2 ring-blue-500 cursor-default":"hover:bg-slate-100 hover:ring-2 hover:ring-blue-500 cursor-pointer"}`,children:x.jsxs("div",{className:"flex justify-between items-center",children:[x.jsxs("div",{children:[x.jsxs("p",{className:"font-semibold text-slate-800 truncate",children:[d?x.jsx("span",{className:"text-blue-600 font-bold",children:"[Current Session] "}):null,u.filename]}),x.jsxs("p",{className:"text-sm text-slate-500",children:["Last saved: ",new Date(u.updatedAt).toLocaleString()]})]}),!d&&x.jsx("button",{onClick:p=>o(p,u.id,u.filename),className:"p-2 text-slate-500 rounded-full hover:bg-red-100 hover:text-red-600 transition-colors flex-shrink-0 ml-4",title:"Delete Report",children:x.jsx(k3,{})})]})})},u.id)})})}),x.jsx("p",{className:"text-xs text-slate-500 mt-4 text-center",children:"Your reports are saved securely in your browser's IndexedDB."})]})})},U3=()=>x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:x.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),O3=()=>x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:x.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),B3=5*1024,V3=()=>{const t=qe(j=>j.isMemoryPanelOpen),e=qe(j=>j.addToast),n=qe(j=>j.resetConversationMemory),s=()=>qe.getState().setIsMemoryPanelOpen(!1),[i,o]=ce.useState([]),[u,d]=ce.useState(""),[p,m]=ce.useState([]),[v,S]=ce.useState(!1),[w,C]=ce.useState(null),M=ce.useRef(null),I=ut.getIsInitialized(),k=ce.useCallback(()=>{o(ut.getDocuments())},[]),F=ce.useMemo(()=>{if(i.length===0)return 0;const j=i.reduce((ne,le)=>ne+le.text.length*2,0),X=i.length*384*4;return(j+X)/1024},[i]);ce.useEffect(()=>{t?k():(d(""),m([]),C(null))},[t,k]),ce.useEffect(()=>()=>{var j;(j=M.current)==null||j.abort()},[]);const V=async j=>{var ne;if(j.preventDefault(),!u.trim()||!I)return;(ne=M.current)==null||ne.abort();const X=new AbortController;M.current=X,S(!0),C(null);try{const le=await ut.search(u,5,{signal:X.signal});X.signal.aborted||m(le)}catch(le){le instanceof DOMException&&le.name==="AbortError"||console.error("Memory search failed:",le)}finally{M.current===X&&(M.current=null),S(!1)}},G=()=>{M.current&&(M.current.abort(),M.current=null,S(!1),e("Memory search cancelled.","info"))},z=j=>{window.confirm("Are you sure you want to delete this memory item?")&&(ut.deleteDocument(j),k())},ae=()=>{window.confirm("Reset conversation memory? This clears the AIs long-term memory (including cards and summaries).")&&(n(),k(),m([]),e("Conversation memory reset.","info"))},Q=j=>{C(j);const X=document.getElementById(`memory-doc-${j.substring(0,30)}`);X==null||X.scrollIntoView({behavior:"smooth",block:"center"})};if(!t)return null;const J=Math.min(F/B3*100,100);return x.jsx("div",{className:"fixed inset-0 bg-slate-900 bg-opacity-50 flex items-center justify-center z-50 transition-opacity",onClick:s,children:x.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-4xl h-full max-h-[85vh] border border-slate-200 flex flex-col",onClick:j=>j.stopPropagation(),children:[x.jsxs("header",{className:"flex justify-between items-start mb-4 flex-shrink-0",children:[x.jsxs("div",{children:[x.jsxs("div",{className:"flex items-center space-x-3",children:[x.jsx("span",{className:"text-3xl",children:""}),x.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"AI Long-Term Memory"})]}),x.jsxs("div",{className:"mt-2 pl-12",children:[x.jsxs("div",{className:"flex items-baseline space-x-2 text-sm text-slate-500",children:[x.jsxs("span",{children:[i.length," items"]}),x.jsx("span",{className:"text-slate-300",children:"|"}),x.jsxs("span",{children:["Using ~",F.toFixed(2)," KB"]})]}),x.jsx("div",{className:"w-full bg-slate-200 rounded-full h-1.5 mt-1",children:x.jsx("div",{className:"bg-blue-600 h-1.5 rounded-full",style:{width:`${J}%`}})})]})]}),x.jsx("button",{onClick:s,className:"p-1 text-slate-500 rounded-full hover:bg-slate-100 hover:text-slate-800 transition-colors",title:"Close",children:x.jsx(U3,{})})]}),x.jsxs("div",{className:"flex-grow grid md:grid-cols-2 gap-6 min-h-0",children:[x.jsxs("div",{className:"flex flex-col min-h-0",children:[x.jsxs("div",{className:"mb-4 p-4 bg-slate-50 border border-slate-200 rounded-lg flex-shrink-0",children:[x.jsx("h3",{className:"font-semibold text-slate-800 mb-2",children:"Test Similarity Search"}),x.jsxs("form",{onSubmit:V,className:"flex items-center space-x-2",children:[x.jsx("input",{type:"text",value:u,onChange:j=>d(j.target.value),placeholder:I?"Enter query to find memories...":"Memory model is loading...",disabled:!I||v,className:"flex-grow bg-white border border-slate-300 rounded-md py-1.5 px-3 text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:opacity-50"}),x.jsxs("div",{className:"flex items-center space-x-2",children:[x.jsx("button",{type:"submit",disabled:!I||v||!u.trim(),className:"px-4 py-1.5 bg-blue-600 text-white font-semibold rounded-md hover:bg-blue-700 transition-colors disabled:bg-blue-300 disabled:cursor-not-allowed",children:v?"Searching":"Search"}),v&&x.jsx("button",{type:"button",onClick:G,className:"px-3 py-1.5 border border-slate-300 rounded-md text-slate-600 hover:bg-slate-100 transition-colors",children:"Cancel"})]})]})]}),x.jsx("div",{className:"flex-grow overflow-y-auto pr-2",children:p.length>0&&x.jsxs("div",{className:"space-y-2",children:[x.jsx("h4",{className:"text-sm font-medium text-slate-600",children:"Top Results:"}),p.map(j=>x.jsxs("div",{onClick:()=>Q(j.text),className:"bg-white p-2.5 border border-slate-200 rounded-lg text-xs cursor-pointer hover:border-blue-500 hover:ring-1 hover:ring-blue-500",children:[x.jsxs("div",{className:"flex justify-between items-center mb-1",children:[x.jsx("p",{className:"text-slate-700 font-semibold",children:"Match"}),x.jsxs("p",{className:"text-blue-600 font-bold",children:[(j.score*100).toFixed(1),"%"]})]}),x.jsx("div",{className:"w-full bg-slate-200 rounded-full h-1 mb-2",children:x.jsx("div",{className:"bg-blue-500 h-1 rounded-full",style:{width:`${j.score*100}%`}})}),x.jsxs("p",{className:"text-slate-600 italic",children:['"',j.text,'"']})]},j.id))]})})]}),x.jsxs("div",{className:"flex flex-col min-h-0",children:[x.jsxs("div",{className:"flex justify-between items-center mb-2 flex-shrink-0",children:[x.jsxs("h3",{className:"font-semibold text-slate-800",children:["All Stored Memories (",i.length,")"]}),i.length>0&&x.jsx("button",{onClick:ae,className:"text-xs text-red-600 hover:underline",children:"Reset Conversation Memory"})]}),x.jsx("div",{className:"flex-grow overflow-y-auto pr-2 border-t border-slate-200 pt-2",children:i.length===0?x.jsx("div",{className:"flex items-center justify-center h-full text-slate-500 text-sm",children:x.jsx("p",{children:"The AI's memory is currently empty."})}):x.jsx("ul",{className:"space-y-2",children:i.map(j=>{const X=j.metadata??{},ne=X.summaryLevel??"raw",le=X.kind??"general",_=X.startIndex!=null&&X.endIndex!=null?`Messages ${X.startIndex+1}-${X.endIndex+1}`:null;return x.jsxs("li",{id:`memory-doc-${j.text.substring(0,30)}`,className:`p-3 bg-slate-50 rounded-lg text-sm text-slate-800 border border-slate-200 flex justify-between items-start group transition-all duration-300 ${w===j.text?"border-blue-500 ring-2 ring-blue-500":""}`,children:[x.jsxs("div",{className:"flex-grow pr-4 break-words space-y-1",children:[x.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-[11px] uppercase tracking-wide text-slate-500",children:[x.jsx("span",{className:"px-2 py-0.5 border border-slate-300 rounded-full bg-white",children:le==="conversation"?"Conversation":"Card"}),x.jsx("span",{className:`px-2 py-0.5 rounded-full ${ne==="summary"?"bg-indigo-100 text-indigo-700 border border-indigo-200":"bg-emerald-50 text-emerald-700 border border-emerald-200"}`,children:ne==="summary"?"Compressed":"Raw"}),_&&x.jsx("span",{className:"text-slate-400",children:_})]}),x.jsx("p",{children:j.text})]}),x.jsx("button",{onClick:()=>z(j.id),className:"p-1 text-slate-400 rounded-full hover:bg-red-100 hover:text-red-600 transition-colors opacity-0 group-hover:opacity-100 flex-shrink-0",title:"Delete Memory",children:x.jsx(O3,{})})]},j.id)})})})]})]})]})})},Zu=50,q3=({direction:t})=>t?t==="ascending"?x.jsx("span",{className:"text-slate-800",children:""}):x.jsx("span",{className:"text-slate-800",children:""}):x.jsx("span",{className:"text-slate-400",children:""}),F3=({data:t,sortConfig:e,onSort:n,columnWidths:s,onColumnResizeStart:i})=>{const[o,u]=ce.useState(0);if(!t||t.length===0)return x.jsx("p",{className:"text-slate-500 p-4 text-center",children:"No data matches your search."});const d=Object.keys(t[0]),p=Math.ceil(t.length/Zu),m=o*Zu,v=t.slice(m,m+Zu),S=()=>u(M=>Math.max(0,M-1)),w=()=>u(M=>Math.min(p-1,M+1)),C=M=>{let I,k="";for(;M>=0;)I=M%26,k=String.fromCharCode(I+65)+k,M=Math.floor(M/26)-1;return k};return x.jsxs("div",{className:"w-full text-sm h-full flex flex-col",children:[x.jsx("div",{className:"flex-grow overflow-auto",children:x.jsxs("table",{className:"w-full text-left border-collapse",style:{tableLayout:"fixed"},children:[x.jsx("thead",{className:"bg-slate-100 text-slate-600 sticky top-0 z-10",children:x.jsxs("tr",{children:[x.jsx("th",{className:"p-2 font-semibold text-slate-500 text-center sticky left-0 z-20 bg-slate-100 border-r border-slate-200",style:{width:"60px"},children:"#"}),d.map((M,I)=>x.jsxs("th",{className:"p-2 font-semibold whitespace-nowrap border-r border-l border-slate-200 relative",style:{width:s[M]||150},children:[x.jsxs("button",{onClick:()=>n(M),className:"flex items-center justify-between w-full h-full",children:[x.jsxs("span",{className:"truncate",title:M,children:[C(I)," - ",M]}),x.jsx(q3,{direction:(e==null?void 0:e.key)===M?e.direction:void 0})]}),x.jsx("div",{onMouseDown:k=>i(M,k),className:"absolute top-0 right-0 h-full w-2 cursor-col-resize z-30"})]},M))]})}),x.jsx("tbody",{className:"bg-white",children:v.map((M,I)=>x.jsxs("tr",{className:"border-b border-slate-200 last:border-b-0 hover:bg-slate-50",children:[x.jsx("td",{className:"p-2 text-slate-400 text-center sticky left-0 z-10 bg-white border-r border-slate-200",style:{width:"60px"},children:m+I+1}),d.map(k=>x.jsx("td",{className:"p-2 text-slate-700 whitespace-nowrap overflow-hidden text-ellipsis border-r border-l border-slate-200",children:lc(M[k])},`${I}-${k}`))]},I))})]})}),p>1&&x.jsxs("div",{className:"flex justify-between items-center p-2 bg-slate-100 border-t border-slate-200 flex-shrink-0",children:[x.jsxs("span",{className:"text-xs text-slate-500",children:["Showing ",m+1," - ",Math.min(m+Zu,t.length)," of ",t.length," rows"]}),x.jsxs("div",{className:"flex items-center space-x-2",children:[x.jsx("button",{onClick:S,disabled:o===0,className:"px-2 py-1 text-xs bg-slate-200 rounded disabled:opacity-50 hover:bg-slate-300",children:"Previous"}),x.jsxs("span",{className:"text-xs text-slate-500",children:["Page ",o+1," of ",p]}),x.jsx("button",{onClick:w,disabled:o===p-1,className:"px-2 py-1 text-xs bg-slate-200 rounded disabled:opacity-50 hover:bg-slate-300",children:"Next"})]})]})]})},$3=()=>x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-slate-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:x.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),G3=({isOpen:t})=>x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-6 w-6 transform transition-transform duration-200 ${t?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:x.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),f_=()=>x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:x.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})}),H3=()=>x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:x.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})}),z3=()=>x.jsxs("svg",{className:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[x.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),x.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),j3=t=>{const e=t instanceof Date?t:new Date(t);return Number.isNaN(e.getTime())?"":e.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"})},J3=({isVisible:t})=>{const{csvData:e,spreadsheetFilterFunction:n,aiFilterExplanation:s,isAiFiltering:i,handleNaturalLanguageQuery:o,clearAiFilter:u,cancelAiFilterRequest:d,interactiveSelectionFilter:p,chatHistory:m,datasetHash:v,addToast:S}=qe(_=>({csvData:_.csvData,spreadsheetFilterFunction:_.spreadsheetFilterFunction,aiFilterExplanation:_.aiFilterExplanation,isAiFiltering:_.isAiFiltering,handleNaturalLanguageQuery:_.handleNaturalLanguageQuery,clearAiFilter:_.clearAiFilter,cancelAiFilterRequest:_.cancelAiFilterRequest,interactiveSelectionFilter:_.interactiveSelectionFilter,chatHistory:_.chatHistory,datasetHash:_.datasetHash,addToast:_.addToast})),w=()=>qe.getState().setIsSpreadsheetVisible(!t),[C,M]=ce.useState(null),[I,k]=ce.useState(""),F=ce.useMemo(()=>(e==null?void 0:e.data.length)>0?Object.keys(e.data[0]):[],[e==null?void 0:e.data]),[V,G]=ce.useState({});ce.useEffect(()=>{if(!e)return;const _={};F.forEach(E=>{var T;const P=E.length*8+30,D=String(((T=e.data[0])==null?void 0:T[E])||"").length*7;_[E]=Math.max(120,P,D)}),G(_)},[F,e]);const z=_=>{let E="ascending";C&&C.key===_&&C.direction==="ascending"&&(E="descending"),M({key:_,direction:E})},ae=(_,E)=>{E.preventDefault();const P=E.clientX,D=V[_],T=L=>{const B=D+(L.clientX-P);B>60&&G(H=>({...H,[_]:B}))},R=()=>{document.removeEventListener("mousemove",T),document.removeEventListener("mouseup",R),document.body.style.cursor=""};document.body.style.cursor="col-resize",document.addEventListener("mousemove",T),document.addEventListener("mouseup",R)},Q=()=>{if(!e||e.data.length===0||F.length===0)return;const _=R=>{const L=R==null?"":String(R);return/[",\n]/.test(L)?`"${L.replace(/"/g,'""')}"`:L},E=[F.join(","),...e.data.map(R=>F.map(L=>_(R[L])).join(","))],P=new Blob([E.join(`
`)],{type:"text/csv;charset=utf-8;"}),D=URL.createObjectURL(P),T=document.createElement("a");T.href=D,T.download=e.fileName||"dataset.csv",T.click(),URL.revokeObjectURL(D)},J=async()=>{if(v)try{await navigator.clipboard.writeText(v),S("Checksum copied.","success",2e3)}catch(_){console.error("Failed to copy checksum:",_),S("Copy failed. Please copy manually.","error",3e3)}},j=()=>{I.trim()&&o(I.trim())},X=_=>{_.key==="Enter"&&j()},ne=ce.useMemo(()=>{if(!e)return[];let _=[...e.data];if(p&&p.column){const E=p.values.map(P=>String(P));_=_.filter(P=>{const D=P[p.column];return E.includes(D==null?"":String(D))})}if(n)try{_=QE(_,n)}catch(E){console.error("AI filter execution failed:",E)}else if(I){const E=I.toLowerCase();_=_.filter(P=>Object.values(P).some(D=>String(D).toLowerCase().includes(E)))}return C!==null&&_.sort((E,P)=>{const D=E[C.key],T=P[C.key];if(D==null)return 1;if(T==null)return-1;const R=typeof D=="number"?D:parseFloat(String(D).replace(/[^0-9.-]+/g,"")),L=typeof T=="number"?T:parseFloat(String(T).replace(/[^0-9.-]+/g,""));if(!isNaN(R)&&!isNaN(L))return C.direction==="ascending"?R-L:L-R;const B=String(D).toLowerCase(),H=String(T).toLowerCase();return B<H?C.direction==="ascending"?-1:1:B>H?C.direction==="ascending"?1:-1:0}),_},[e,C,I,n,p]),le=ce.useMemo(()=>m.filter(_=>typeof _.text=="string"&&_.text.startsWith("System note:")&&(_.text.includes("Raw Data Explorer")||_.text.includes("chart drilldown"))).slice(-5).reverse(),[m]);return e?x.jsxs("div",{id:"raw-data-explorer",className:"bg-white rounded-lg shadow-lg flex flex-col transition-all duration-300 border border-slate-200",children:[x.jsxs("button",{onClick:w,className:"flex justify-between items-center p-4 cursor-pointer w-full text-left rounded-t-lg hover:bg-slate-50","aria-expanded":t,children:[x.jsxs("div",{children:[x.jsx("h3",{className:"text-lg font-bold text-slate-900",children:"Raw Data Explorer"}),x.jsxs("p",{className:"text-sm text-slate-500",children:["File: ",e.fileName]}),x.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-xs text-slate-500",children:[x.jsx("button",{type:"button",onClick:Q,className:"underline decoration-dotted hover:text-slate-700",children:"Download Original"}),x.jsx("span",{className:"text-slate-300",children:""}),x.jsx("button",{type:"button",onClick:J,disabled:!v,className:`underline decoration-dotted ${v?"hover:text-slate-700":"text-slate-300 cursor-not-allowed"}`,children:"Copy checksum"})]})]}),x.jsx(G3,{isOpen:t})]}),t&&x.jsxs("div",{className:"flex flex-col h-full p-4 pt-0",children:[p&&x.jsxs("div",{className:"bg-amber-50 text-amber-900 border border-amber-200 rounded-md p-2 text-xs mb-2",children:[x.jsx("p",{className:"font-semibold",children:"Chart Drilldown Active"}),x.jsxs("p",{className:"mt-1",children:[p.label,"  ",p.column," "," ",p.values.map(_=>String(_)).join(", ")]}),x.jsx("p",{className:"mt-1 text-amber-800",children:"Adjust or clear the selection directly on the chart to remove this link."})]}),le.length>0&&x.jsxs("div",{className:"bg-slate-50 text-slate-700 border border-slate-200 rounded-md p-2 text-xs mb-2",children:[x.jsx("p",{className:"font-semibold mb-1",children:"Filter Provenance"}),x.jsx("ul",{className:"space-y-1",children:le.map((_,E)=>x.jsxs("li",{className:"flex justify-between items-start gap-2",children:[x.jsx("span",{className:"flex-1 text-slate-600",children:_.text}),x.jsx("span",{className:"text-slate-400 whitespace-nowrap",children:j3(_.timestamp)})]},`${_.timestamp}-${E}`))})]}),x.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[x.jsxs("div",{className:"flex flex-col flex-grow space-y-1",children:[x.jsxs("div",{className:"relative",children:[x.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:x.jsx($3,{})}),x.jsx("input",{type:"text",placeholder:"Search table or ask AI (e.g., 'show rows where column_3 > 100')",value:I,onChange:_=>k(_.target.value),onKeyDown:X,className:"bg-white border border-slate-300 rounded-md py-1.5 pl-10 pr-4 text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-1 focus:ring-blue-500 w-full"})]}),x.jsxs("div",{className:"text-xs text-slate-500 flex items-center space-x-3 flex-wrap",children:[x.jsxs("span",{children:["Filtered rows: ",ne.length,"/",e.data.length]}),n&&x.jsxs("button",{type:"button",onClick:u,className:"flex items-center space-x-1 text-blue-600 hover:text-blue-800 underline decoration-dotted",title:"Clear AI filter",children:[x.jsx(f_,{}),x.jsx("span",{children:"AI filter active (click to clear)"})]}),p&&x.jsxs("span",{className:"text-amber-700",children:['Drilldown from "',p.label,'"']})]})]}),x.jsxs("div",{className:"flex items-center space-x-2",children:[x.jsxs("button",{onClick:j,disabled:i||!I.trim(),className:"flex items-center space-x-2 px-3 py-1.5 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:bg-blue-300 disabled:cursor-not-allowed",title:"Use AI to filter data based on your query",children:[i?x.jsx(z3,{}):x.jsx(f_,{}),x.jsx("span",{children:i?"Working":"Ask AI"})]}),i&&x.jsx("button",{type:"button",onClick:d,className:"px-3 py-1.5 border border-slate-300 rounded-md text-slate-600 hover:bg-slate-100 transition-colors",children:"Cancel"})]})]}),s&&x.jsxs("div",{className:"bg-blue-50 text-blue-800 border border-blue-200 rounded-md p-2 text-sm flex justify-between items-center mb-2",children:[x.jsxs("p",{children:[x.jsx("span",{className:"font-semibold",children:"AI Filter:"})," ",s]}),x.jsx("button",{onClick:u,className:"p-1 rounded-full hover:bg-blue-200",title:"Clear AI filter",children:x.jsx(H3,{})})]}),x.jsx("div",{className:"flex-grow overflow-auto border border-slate-200 rounded-md",style:{maxHeight:"60vh"},children:x.jsx(F3,{data:ne,sortConfig:C,onSort:z,columnWidths:V,onColumnResizeStart:ae})})]})]}):null},Y3=({isOpen:t})=>x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-6 w-6 transform transition-transform duration-200 ${t?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:x.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),K3=()=>x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:x.jsx("path",{fillRule:"evenodd",d:"M12.316 3.051a1 1 0 01.633 1.265l-4 12a1 1 0 11-1.898-.632l4-12a1 1 0 011.265-.633zM5.707 6.293a1 1 0 010 1.414L3.414 10l2.293 2.293a1 1 0 11-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0zm8.586 0a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 11-1.414-1.414L16.586 10l-2.293-2.293a1 1 0 010-1.414z",clipRule:"evenodd"})}),Z3=({isVisible:t})=>{const{plan:e,originalSample:n,transformedSample:s}=qe(o=>{var u;return{plan:o.dataPreparationPlan,originalSample:o.initialDataSample,transformedSample:((u=o.csvData)==null?void 0:u.data.slice(0,20))||[]}}),i=()=>qe.getState().setIsDataPrepDebugVisible(!t);return!e||!n?null:x.jsxs("div",{className:"bg-white rounded-lg shadow-lg flex flex-col transition-all duration-300 border border-slate-200",children:[x.jsxs("button",{onClick:i,className:"flex justify-between items-center p-4 cursor-pointer w-full text-left rounded-t-lg hover:bg-slate-50","aria-expanded":t,children:[x.jsxs("div",{children:[x.jsxs("h3",{className:"text-lg font-bold text-slate-900 flex items-center",children:[x.jsx(K3,{})," AI Data Transformation Log"]}),x.jsx("p",{className:"text-sm text-slate-500",children:"See how the AI cleaned and reshaped your data."})]}),x.jsx(Y3,{isOpen:t})]}),t&&x.jsxs("div",{className:"p-4 pt-0 space-y-6",children:[x.jsxs("div",{children:[x.jsx("h4",{className:"font-semibold text-slate-800 mb-2",children:"AI's Plan"}),x.jsxs("p",{className:"text-sm bg-slate-50 p-3 rounded-md border border-slate-200 text-slate-700 italic",children:['"',e.explanation,'"']})]}),x.jsxs("div",{children:[x.jsx("h4",{className:"font-semibold text-slate-800 mb-2",children:"Transformation Code"}),x.jsx("pre",{className:"bg-slate-900 text-slate-100 p-3 rounded-md text-xs overflow-x-auto",children:x.jsx("code",{children:`// AI-generated function to transform data
function transform(data, _util) {
${e.jsFunctionBody}
}`})})]}),x.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[x.jsxs("div",{children:[x.jsx("h4",{className:"font-semibold text-slate-800 mb-2",children:"Data Before (Raw Sample)"}),x.jsx("div",{className:"max-h-64 overflow-y-auto border border-slate-200 rounded-md",children:x.jsx(uc,{data:n})})]}),x.jsxs("div",{children:[x.jsx("h4",{className:"font-semibold text-slate-800 mb-2",children:"Data After (Transformed Sample)"}),x.jsx("div",{className:"max-h-64 overflow-y-auto border border-slate-200 rounded-md",children:x.jsx(uc,{data:s})})]})]})]})]})},X3=()=>x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:x.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),W3=()=>x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:x.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),Q3=()=>x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:x.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2-2z"})}),eB=qC(),tB=()=>{const{onNewSession:t,onOpenHistory:e,isAsideVisible:n,onShowAssistant:s,graphStatus:i,graphStatusMessage:o,graphVersion:u,graphLastReadyAt:d}=qe(S=>({onNewSession:S.handleNewSession,onOpenHistory:()=>{S.loadReportsList(),S.setIsHistoryPanelOpen(!0)},isAsideVisible:S.isAsideVisible,onShowAssistant:()=>S.setIsAsideVisible(!0),graphStatus:S.graphStatus,graphStatusMessage:S.graphStatusMessage,graphVersion:S.graphVersion,graphLastReadyAt:S.graphLastReadyAt})),p=(()=>{switch(i){case"ready":return`Graph Ready (v${u??""})`;case"connecting":return"Graph Initializing";case"error":return o??"Graph Offline";default:return"Graph Idle"}})(),m={ready:"bg-emerald-100 text-emerald-700 border-emerald-200",connecting:"bg-amber-100 text-amber-700 border-amber-200",error:"bg-rose-100 text-rose-700 border-rose-200",idle:"bg-slate-100 text-slate-600 border-slate-200"},v=m[i]??m.idle;return x.jsxs("header",{className:"mb-6 flex justify-between items-start flex-shrink-0",children:[x.jsxs("div",{className:"max-w-xs",children:[x.jsx("h1",{className:"text-xl font-extrabold text-slate-900 leading-tight",children:"CSV Data Analysis Agent"}),x.jsxs("div",{className:"mt-2 flex flex-col gap-1",children:[x.jsxs("span",{className:`inline-flex items-center gap-2 rounded-full border px-3 py-1 text-[11px] font-semibold ${v}`,children:["  ",p]}),d&&x.jsxs("span",{className:"text-[11px] text-slate-400",children:["Last heartbeat: ",new Date(d).toLocaleTimeString()]})]})]}),x.jsx("div",{className:"flex flex-col items-end gap-4 sm:flex-row sm:items-center sm:gap-6",children:x.jsxs("div",{className:"flex items-center space-x-2",children:[eB.showNewButton&&x.jsxs("button",{onClick:t,className:"flex items-center space-x-2 px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",title:"Start a new analysis session",children:[x.jsx(Q3,{}),x.jsx("span",{className:"hidden sm:inline",children:"New"})]}),x.jsxs("button",{onClick:e,className:"flex items-center space-x-2 px-3 py-2 bg-white border border-slate-300 text-slate-700 rounded-md hover:bg-slate-100 transition-colors",title:"View analysis history",children:[x.jsx(W3,{}),x.jsx("span",{className:"hidden sm:inline",children:"History"})]}),!n&&x.jsx("button",{onClick:s,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors","aria-label":"Show Assistant Panel",title:"Show Assistant Panel",children:x.jsx(X3,{})})]})})]})},nB=({className:t="h-4 w-4 text-blue-600 animate-spin",ariaLabel:e="Loading"})=>x.jsxs("svg",{className:t,viewBox:"0 0 24 24",fill:"none",role:"status","aria-label":e,children:[x.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),x.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),sB={observe:"Observe",plan:"Plan",act:"Act",verify:"Verify",idle:"Idle"},aB=({runtimeLabel:t,graphStatus:e,graphStatusMessage:n,graphToolInFlight:s,graphLastToolSummary:i,agentAwaitingUserInput:o,graphAwaitPrompt:u})=>s?{headline:`${t}  ${s.label}`,detail:n??""}:o?{headline:`${t} `,detail:(u==null?void 0:u.question)??n??""}:e==="connecting"?{headline:`${t} runtime `,detail:n??"Spinning up worker"}:e==="error"?{headline:`${t} runtime `,detail:n??" System Log"}:i?{headline:`${t} runtime `,detail:i}:{headline:`${t} runtime`,detail:n},rB=()=>{const{runtimeLabel:t,graphStatus:e,graphStatusMessage:n,graphToolInFlight:s,graphLastToolSummary:i,agentAwaitingUserInput:o,graphAwaitPrompt:u,graphPhase:d,graphLoopBudget:p}=qe(m=>({runtimeLabel:m.useLangGraphRuntime?"LangGraph":"Graph",graphStatus:m.graphStatus,graphStatusMessage:m.graphStatusMessage,graphToolInFlight:m.graphToolInFlight,graphLastToolSummary:m.graphLastToolSummary,agentAwaitingUserInput:m.agentAwaitingUserInput,graphAwaitPrompt:m.graphAwaitPrompt,graphPhase:m.graphPhase,graphLoopBudget:m.graphLoopBudget}));return ce.useMemo(()=>{const C=!!s||o||e==="connecting"||e==="error"||!!i,{headline:M,detail:I}=aB({runtimeLabel:t,graphStatus:e,graphStatusMessage:n,graphToolInFlight:s,graphLastToolSummary:i,agentAwaitingUserInput:o,graphAwaitPrompt:u}),k=d?sB[d]??d:null,F=p?`${p.actsUsed}/${p.maxActs}${p.exceeded?" (max reached)":""}`:null;return{shouldRender:C,headline:M,detail:I,runtimeLabel:t,agentAwaitingUserInput:o,activeToolLabel:(s==null?void 0:s.label)??null,graphStatus:e,phaseLabel:k,loopSummary:F}},[t,e,n,s,i,o,u,d,p])},iB=()=>{const{isBusy:t,busyMessage:e,canCancelBusy:n,requestBusyCancel:s,isCancellationRequested:i}=qe(S=>({isBusy:S.isBusy,busyMessage:S.busyMessage,canCancelBusy:S.canCancelBusy,requestBusyCancel:S.requestBusyCancel,isCancellationRequested:S.isCancellationRequested})),o=rB(),u=t,d=!t&&o.shouldRender;if(!u&&!d)return null;const p=u?e||"Thinking through your question...":o.headline,m=o.phaseLabel||o.loopSummary?`Phase: ${o.phaseLabel??"Idle"}${o.loopSummary?`  Loop ${o.loopSummary}`:""}`:null,v=o.detail;return x.jsxs("div",{className:"mb-4 rounded-lg border border-blue-200 bg-blue-50 px-4 py-3 shadow-sm flex flex-col gap-2 md:flex-row md:items-center md:justify-between",role:"status","aria-live":"polite",children:[x.jsxs("div",{className:"flex items-center gap-3 text-blue-900",children:[x.jsx(nB,{}),x.jsxs("div",{children:[x.jsx("p",{className:"text-sm font-semibold",children:p}),u&&i&&x.jsx("p",{className:"text-xs text-blue-700",children:"Cancelling wrapping up safely."}),v&&x.jsx("p",{className:"text-xs text-blue-700",children:v}),m&&x.jsx("p",{className:"text-xs text-blue-700",children:m})]})]}),u&&n?x.jsx("button",{type:"button",onClick:s,disabled:i,className:"text-sm font-semibold rounded-md border border-blue-300 px-3 py-1.5 text-blue-700 hover:bg-blue-100 disabled:opacity-60 disabled:cursor-not-allowed",children:i?"Cancelling":"Cancel"}):d&&x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsxs("span",{className:"inline-flex items-center rounded-full bg-blue-100 px-2 py-0.5 text-xs font-semibold text-blue-700",children:[o.runtimeLabel," runtime"]}),o.phaseLabel&&x.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-200 px-2 py-0.5 text-xs font-semibold text-slate-700",children:o.phaseLabel}),o.loopSummary&&x.jsxs("span",{className:"text-xs text-slate-600",children:["Loop ",o.loopSummary]}),o.agentAwaitingUserInput&&x.jsx("span",{className:"text-xs font-semibold text-orange-600",children:"Waiting for your input"}),o.activeToolLabel&&x.jsxs("span",{className:"text-xs text-blue-700",children:["",o.activeToolLabel]})]})]})},oB={info:"bg-slate-800 text-white",success:"bg-emerald-600 text-white",error:"bg-red-600 text-white"},lB=()=>{const{toasts:t,dismissToast:e}=qe(n=>({toasts:n.toasts,dismissToast:n.dismissToast}));return t.length===0?null:x.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-3 max-w-sm",children:t.map(n=>x.jsxs("div",{className:`flex items-start justify-between rounded-lg shadow-lg px-4 py-3 text-sm ${oB[n.type]}`,children:[x.jsxs("div",{className:"pr-4 space-y-2",children:[x.jsx("p",{children:n.message}),n.actionLabel&&n.onAction&&x.jsx("button",{className:"underline text-white/90 hover:text-white text-xs font-medium",onClick:()=>{var s;(s=n.onAction)==null||s.call(n),e(n.id)},children:n.actionLabel})]}),x.jsx("button",{onClick:()=>e(n.id),className:"text-white/70 hover:text-white text-lg leading-none","aria-label":"Dismiss notification",children:""})]},n.id))})},uB=(t,e,n,s,i)=>{const o=[`${t}  ${e} rows`];return n&&o.push(`${n} removed`),s&&o.push(`${s} added`),i&&o.push(`${i} modified`),o.join("  ")},cB=()=>{const{pendingDataTransform:t,lastAppliedDataTransform:e,isLastAppliedDataTransformBannerDismissed:n,confirmPendingDataTransform:s,discardPendingDataTransform:i,undoLastDataTransform:o,dismissLastAppliedDataTransformBanner:u}=qe(m=>({pendingDataTransform:m.pendingDataTransform,lastAppliedDataTransform:m.lastAppliedDataTransform,isLastAppliedDataTransformBannerDismissed:m.isLastAppliedDataTransformBannerDismissed,confirmPendingDataTransform:m.confirmPendingDataTransform,discardPendingDataTransform:m.discardPendingDataTransform,undoLastDataTransform:m.undoLastDataTransform,dismissLastAppliedDataTransformBanner:m.dismissLastAppliedDataTransformBanner})),d=n?null:e,p=!!d;return!t&&!p?null:x.jsxs("div",{className:"space-y-3 mt-4",children:[t&&x.jsxs("div",{className:"border border-amber-200 bg-amber-50 rounded-md p-4 shadow-sm",children:[x.jsx("p",{className:"text-sm font-semibold text-amber-900",children:"AI Data Change Pending Confirmation"}),x.jsx("p",{className:"text-xs text-amber-900 mt-1",children:t.explanation||"The AI prepared a dataset update."}),x.jsx("p",{className:"text-xs text-amber-800 mt-1",children:uB(t.meta.rowsBefore,t.meta.rowsAfter,t.meta.removedRows,t.meta.addedRows,t.meta.modifiedRows)}),t.previewRows.length>0&&x.jsx("pre",{className:"bg-white text-amber-900 text-xs rounded-md mt-2 p-2 overflow-auto max-h-40 border border-amber-200",children:JSON.stringify(t.previewRows.slice(0,2),null,2)}),x.jsxs("div",{className:"flex flex-wrap gap-2 mt-3",children:[x.jsx("button",{onClick:s,className:"px-3 py-1.5 bg-amber-600 text-white rounded-md text-sm hover:bg-amber-700 transition-colors",children:"Apply Change"}),x.jsx("button",{onClick:i,className:"px-3 py-1.5 border border-amber-400 text-amber-900 rounded-md text-sm hover:bg-amber-100 transition-colors",children:"Discard"})]})]}),p&&x.jsx("div",{className:"border border-emerald-200 bg-emerald-50 rounded-md p-3",children:x.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[x.jsxs("div",{children:[x.jsx("p",{className:"text-sm font-semibold text-emerald-900",children:"Last Applied AI Change"}),x.jsx("p",{className:"text-xs text-emerald-800 mt-1",children:d.summary})]}),x.jsxs("div",{className:"flex items-center gap-2 self-start sm:self-auto",children:[x.jsx("button",{onClick:o,className:"px-3 py-1.5 border border-emerald-400 text-emerald-900 rounded-md text-sm hover:bg-emerald-100 transition-colors",children:"Undo Change"}),x.jsx("button",{type:"button",onClick:u,"aria-label":"Dismiss last applied AI change",className:"p-1.5 rounded-full text-emerald-700 hover:text-emerald-900 hover:bg-emerald-100 transition-colors",children:x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-4 h-4","aria-hidden":"true",children:x.jsx("path",{fillRule:"evenodd",d:"M5.22 5.22a.75.75 0 0 1 1.06 0L10 8.94l3.72-3.72a.75.75 0 1 1 1.06 1.06L11.06 10l3.72 3.72a.75.75 0 1 1-1.06 1.06L10 11.06l-3.72 3.72a.75.75 0 1 1-1.06-1.06L8.94 10 5.22 6.28a.75.75 0 0 1 0-1.06Z",clipRule:"evenodd"})})})]})]})})]})},jm=new Intl.NumberFormat(void 0,{maximumFractionDigits:2}),m_=new Intl.NumberFormat(void 0,{style:"currency",currency:"USD",maximumFractionDigits:4}),dB=()=>{const{usageLog:t,clearUsage:e}=qe(s=>({usageLog:s.llmUsageLog,clearUsage:s.clearLlmUsage})),n=t.reduce((s,i)=>s+(i.estimatedCostUsd??0),0);return x.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl shadow-sm p-4 space-y-4",children:[x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("div",{children:[x.jsx("p",{className:"text-sm font-semibold text-slate-900",children:"LLM Usage"}),x.jsx("p",{className:"text-xs text-slate-500",children:" 40  LLM  tokens / cost "})]}),x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsxs("span",{className:"text-xs text-slate-500",children:[" ",m_.format(n)]}),x.jsx("button",{type:"button",onClick:e,disabled:t.length===0,className:"px-2 py-1 text-xs font-semibold rounded-md border border-slate-300 text-slate-700 hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed",children:""})]})]}),t.length===0?x.jsx("p",{className:"text-xs text-slate-500",children:" LLM "}):x.jsx("div",{className:"max-h-64 overflow-y-auto",children:x.jsxs("table",{className:"min-w-full text-xs text-left",children:[x.jsx("thead",{className:"text-slate-500",children:x.jsxs("tr",{children:[x.jsx("th",{className:"pb-2 pr-4 font-medium",children:""}),x.jsx("th",{className:"pb-2 pr-4 font-medium",children:"Context"}),x.jsx("th",{className:"pb-2 pr-4 font-medium",children:"Provider  Model"}),x.jsx("th",{className:"pb-2 pr-4 font-medium",children:"Tokens (in/out/total)"}),x.jsx("th",{className:"pb-2 font-medium",children:"Cost"})]})}),x.jsx("tbody",{className:"text-slate-700",children:t.slice().reverse().map(s=>x.jsxs("tr",{className:"border-t border-slate-100",children:[x.jsx("td",{className:"py-2 pr-4 whitespace-nowrap",children:new Date(s.timestamp).toLocaleTimeString()}),x.jsx("td",{className:"py-2 pr-4",children:s.context}),x.jsxs("td",{className:"py-2 pr-4 whitespace-nowrap",children:[s.provider,"/",s.model]}),x.jsxs("td",{className:"py-2 pr-4 whitespace-nowrap",children:[jm.format(s.promptTokens??0)," /"," ",jm.format(s.completionTokens??0)," /"," ",jm.format(s.totalTokens??(s.promptTokens??0)+(s.completionTokens??0))]}),x.jsx("td",{className:"py-2 whitespace-nowrap",children:s.estimatedCostUsd!=null?m_.format(s.estimatedCostUsd):""})]},s.id))})]})})]})},fB=()=>{const{init:t,currentView:e,csvData:n,isAsideVisible:s,asideWidth:i,isResizing:o,handleAsideMouseDown:u,isDataPrepDebugVisible:d,isSpreadsheetVisible:p,dataPreparationPlan:m,initialDataSample:v}=qe(k=>({init:k.init,currentView:k.currentView,csvData:k.csvData,isAsideVisible:k.isAsideVisible,asideWidth:k.asideWidth,isResizing:k.isResizing,handleAsideMouseDown:k.handleAsideMouseDown,isDataPrepDebugVisible:k.isDataPrepDebugVisible,isSpreadsheetVisible:k.isSpreadsheetVisible,dataPreparationPlan:k.dataPreparationPlan,initialDataSample:k.initialDataSample})),S=qe(k=>k.setIsAsideVisible),w=qe(k=>k.addToast),C=qe(k=>k.handleExternalCsvPayload),M=qe(k=>k.connectGraphRuntime);ce.useEffect(()=>{t()},[t]),ce.useEffect(()=>{M()},[M]),ce.useEffect(()=>{const k=G=>{!G||typeof G.csv!="string"||C(G).catch(z=>{console.error("Failed to process external CSV payload.",z)})},F=()=>{if(typeof window>"u"||typeof window.__getNextCsvPayload!="function")return;let G;do G=window.__getNextCsvPayload(),G&&k(G);while(G)},V=G=>{k(G.detail||null)};return F(),window.addEventListener("ai-table-csv",V),()=>{window.removeEventListener("ai-table-csv",V)}},[C]),ce.useEffect(()=>{if(typeof window>"u")return;const k=()=>{if(!Array.isArray(window.__CSV_AGENT_PENDING_NOTICES__))return;window.__CSV_AGENT_PENDING_NOTICES__.splice(0).forEach(G=>{w(G,"warning",6e3)})},F=V=>{var z;const G=V;(z=G.detail)!=null&&z.message&&w(G.detail.message,"warning",6e3)};return k(),window.addEventListener("ai-table-csv-notice",F),()=>{window.removeEventListener("ai-table-csv-notice",F)}},[w]);const I=()=>e==="file_upload"||!n?x.jsx("div",{className:"flex-grow min-h-0",children:x.jsx(N3,{})}):x.jsxs("div",{className:"flex-grow min-h-0 overflow-y-auto",children:[x.jsx(X4,{}),m&&m.jsFunctionBody&&v&&x.jsx("div",{className:"mt-8",children:x.jsx(Z3,{isVisible:d})}),x.jsx("div",{className:"mt-8 space-y-8",children:x.jsx(dB,{})}),x.jsx("div",{className:"mt-8",children:x.jsx(J3,{isVisible:p})})]});return x.jsxs("div",{className:"flex flex-col md:flex-row h-screen bg-slate-50 text-slate-800 font-sans",children:[x.jsx(D3,{}),x.jsx(L3,{}),x.jsx(V3,{}),x.jsx(lB,{}),x.jsxs("main",{className:"flex-1 overflow-hidden p-4 flex flex-col",children:[x.jsx(tB,{}),x.jsx(iB,{}),x.jsx(cB,{}),I()]}),s&&x.jsxs(x.Fragment,{children:[x.jsx("div",{onMouseDown:u,onDoubleClick:()=>S(!1),className:"hidden md:flex group items-center justify-center w-2.5 cursor-col-resize",title:"Drag to resize, double-click to hide",children:x.jsx("div",{className:`w-0.5 h-8 bg-slate-300 rounded-full transition-colors duration-200 group-hover:bg-brand-secondary ${o?"!bg-blue-600":""}`})}),x.jsx("aside",{className:"w-full md:w-auto bg-white flex flex-col h-full border-l border-slate-200",style:{width:i},children:x.jsx("div",{className:"flex-1 overflow-hidden flex flex-col",children:x.jsx(w3,{})})})]})]})},gT=document.getElementById("root");if(!gT)throw new Error("Could not find root element to mount to");const mB=UE.createRoot(gT);mB.render(x.jsx($s.StrictMode,{children:x.jsx(fB,{})}));
