const lu="0.1.0",uu="context_ready",cu=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`session-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,du=(t,e)=>{const n=new Date().toISOString(),s={sessionId:cu(),planId:null,stateTag:uu,phase:"observe",awaitingUser:!1,awaitPrompt:null,awaitPromptId:null,pendingUserReply:null,pendingPlan:null,pendingVerification:null,steps:[],currentStepId:null,blockedBy:null,observations:[],viewIds:[],warnings:[],loopBudget:{maxActs:3,actsUsed:0,exceeded:!1},updatedAt:n};return{...s,...e,steps:s.steps,observations:s.observations,viewIds:s.viewIds,warnings:s.warnings,loopBudget:s.loopBudget,phase:s.phase}},fu=["ready","in_progress","done"],ea=t=>t?["context_ready","awaiting_clarification","needs_clarification"].includes(t)?!0:/^\d{5,}-\d+$/.test(t)||/^ts[0-9a-z]{2,}-[0-9a-z_-]+$/i.test(t):!1,pu=t=>{if(!Array.isArray(t))return[];const e=new Set,n=[];return t.forEach(s=>{const i=typeof(s==null?void 0:s.id)=="string"?s.id.trim():"",r=typeof(s==null?void 0:s.label)=="string"?s.label.trim():"",a=typeof(s==null?void 0:s.intent)=="string"?s.intent.trim():"conversation";if(i.length<3||r.length<3||e.has(i))return;const u=fu.includes(s.status)?s.status:"ready";n.push({id:i,label:r,intent:a,status:u}),e.add(i)}),n},hu=(t,e)=>{var r;if(!e)return t;const n=pu(e.steps??e.nextSteps),s=typeof e.currentStepId=="string"&&e.currentStepId.trim().length>=3?e.currentStepId.trim():((r=n[0])==null?void 0:r.id)??t.currentStepId,i=typeof e.planId=="string"&&e.planId.trim().length>=3?e.planId.trim():t.planId;return{...t,planId:i,steps:n,currentStepId:s,blockedBy:e.blockedBy??t.blockedBy,stateTag:e.stateTag&&ea(e.stateTag)?e.stateTag:t.stateTag,updatedAt:new Date().toISOString(),awaitPrompt:t.awaitPrompt,awaitPromptId:t.awaitPromptId,pendingUserReply:t.pendingUserReply,phase:t.phase,loopBudget:t.loopBudget}},_n=t=>t?ea(t):!1,mu=["text_response","await_user","dom_action","execute_js_code","proceed_to_analysis","filter_spreadsheet","clarification_request"],ta=(t,e)=>{if(!Array.isArray(e)||e.length===0)return{ok:!0,nextState:t,acceptedActions:[]};if(t.awaitingUser)return Fe("awaiting_user","Graph is waiting for user input; no actions can run.",t);if(e.length>2)return Fe("turn_budget_exceeded","Each turn may include at most 2 actions.",t);const n=e[0];if(n.responseType!=="plan_state_update")return Fe("first_action_plan_required","First action must be plan_state_update.",t);if(!_n(n.stateTag))return Fe("invalid_state_tag","plan_state_update is missing a valid stateTag.",t);if(!n.planState)return Fe("missing_plan_state","plan_state_update is missing planState payload.",t);const s=e[1];if(s){if(s.responseType==="plan_state_update")return Fe("atomic_type_invalid","Second action must be atomic, not plan_state_update.",t);if(!mu.includes(s.responseType))return Fe("atomic_type_invalid",`Atomic action ${s.responseType} is not permitted in this turn.`,t);if(!_n(s.stateTag))return Fe("invalid_state_tag","Atomic action is missing a valid stateTag.",t)}return{ok:!0,nextState:gu(t,n,s),acceptedActions:e}},gu=(t,e,n)=>{var r,a,u,d,c,f;let s=hu(t,e.planState);return s={...s,stateTag:e.stateTag??s.stateTag,updatedAt:new Date().toISOString()},!!((r=e.meta)!=null&&r.awaitUser)||((a=e.planState)==null?void 0:a.blockedBy)==="awaiting_user_choice"||!!((u=n==null?void 0:n.meta)!=null&&u.awaitUser)||(n==null?void 0:n.responseType)==="await_user"?s={...s,awaitingUser:!0,blockedBy:((d=e.planState)==null?void 0:d.blockedBy)??(n==null?void 0:n.reason)??"awaiting_user_choice",awaitPrompt:(n==null?void 0:n.awaitUserPayload)??s.awaitPrompt,awaitPromptId:((c=n==null?void 0:n.awaitUserPayload)==null?void 0:c.promptId)??s.awaitPromptId}:s={...s,awaitingUser:!1,blockedBy:((f=e.planState)==null?void 0:f.blockedBy)??null,awaitPrompt:null,awaitPromptId:null},s},Fe=(t,e,n)=>({ok:!1,violations:[{code:t,message:e}],nextState:n}),yu=t=>du();var W;(function(t){t.assertEqual=i=>{};function e(i){}t.assertIs=e;function n(i){throw new Error}t.assertNever=n,t.arrayToEnum=i=>{const r={};for(const a of i)r[a]=a;return r},t.getValidEnumValues=i=>{const r=t.objectKeys(i).filter(u=>typeof i[i[u]]!="number"),a={};for(const u of r)a[u]=i[u];return t.objectValues(a)},t.objectValues=i=>t.objectKeys(i).map(function(r){return i[r]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{const r=[];for(const a in i)Object.prototype.hasOwnProperty.call(i,a)&&r.push(a);return r},t.find=(i,r)=>{for(const a of i)if(r(a))return a},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&Number.isFinite(i)&&Math.floor(i)===i;function s(i,r=" | "){return i.map(a=>typeof a=="string"?`'${a}'`:a).join(r)}t.joinValues=s,t.jsonStringifyReplacer=(i,r)=>typeof r=="bigint"?r.toString():r})(W||(W={}));var Li;(function(t){t.mergeShapes=(e,n)=>({...e,...n})})(Li||(Li={}));const k=W.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Ge=t=>{switch(typeof t){case"undefined":return k.undefined;case"string":return k.string;case"number":return Number.isNaN(t)?k.nan:k.number;case"boolean":return k.boolean;case"function":return k.function;case"bigint":return k.bigint;case"symbol":return k.symbol;case"object":return Array.isArray(t)?k.array:t===null?k.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?k.promise:typeof Map<"u"&&t instanceof Map?k.map:typeof Set<"u"&&t instanceof Set?k.set:typeof Date<"u"&&t instanceof Date?k.date:k.object;default:return k.unknown}},E=W.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class ke extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=e}format(e){const n=e||function(r){return r.message},s={_errors:[]},i=r=>{for(const a of r.issues)if(a.code==="invalid_union")a.unionErrors.map(i);else if(a.code==="invalid_return_type")i(a.returnTypeError);else if(a.code==="invalid_arguments")i(a.argumentsError);else if(a.path.length===0)s._errors.push(n(a));else{let u=s,d=0;for(;d<a.path.length;){const c=a.path[d];d===a.path.length-1?(u[c]=u[c]||{_errors:[]},u[c]._errors.push(n(a))):u[c]=u[c]||{_errors:[]},u=u[c],d++}}};return i(this),s}static assert(e){if(!(e instanceof ke))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,W.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=n=>n.message){const n={},s=[];for(const i of this.issues)if(i.path.length>0){const r=i.path[0];n[r]=n[r]||[],n[r].push(e(i))}else s.push(e(i));return{formErrors:s,fieldErrors:n}}get formErrors(){return this.flatten()}}ke.create=t=>new ke(t);const fs=(t,e)=>{let n;switch(t.code){case E.invalid_type:t.received===k.undefined?n="Required":n=`Expected ${t.expected}, received ${t.received}`;break;case E.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(t.expected,W.jsonStringifyReplacer)}`;break;case E.unrecognized_keys:n=`Unrecognized key(s) in object: ${W.joinValues(t.keys,", ")}`;break;case E.invalid_union:n="Invalid input";break;case E.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${W.joinValues(t.options)}`;break;case E.invalid_enum_value:n=`Invalid enum value. Expected ${W.joinValues(t.options)}, received '${t.received}'`;break;case E.invalid_arguments:n="Invalid function arguments";break;case E.invalid_return_type:n="Invalid function return type";break;case E.invalid_date:n="Invalid date";break;case E.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(n=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?n=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?n=`Invalid input: must end with "${t.validation.endsWith}"`:W.assertNever(t.validation):t.validation!=="regex"?n=`Invalid ${t.validation}`:n="Invalid";break;case E.too_small:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:n="Invalid input";break;case E.too_big:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?n=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:n="Invalid input";break;case E.custom:n="Invalid input";break;case E.invalid_intersection_types:n="Intersection results could not be merged";break;case E.not_multiple_of:n=`Number must be a multiple of ${t.multipleOf}`;break;case E.not_finite:n="Number must be finite";break;default:n=e.defaultError,W.assertNever(t)}return{message:n}};let _u=fs;function Tu(){return _u}const vu=t=>{const{data:e,path:n,errorMaps:s,issueData:i}=t,r=[...n,...i.path||[]],a={...i,path:r};if(i.message!==void 0)return{...i,path:r,message:i.message};let u="";const d=s.filter(c=>!!c).slice().reverse();for(const c of d)u=c(a,{data:e,defaultError:u}).message;return{...i,path:r,message:u}};function x(t,e){const n=Tu(),s=vu({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,n,n===fs?void 0:fs].filter(i=>!!i)});t.common.issues.push(s)}class fe{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,n){const s=[];for(const i of n){if(i.status==="aborted")return $;i.status==="dirty"&&e.dirty(),s.push(i.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,n){const s=[];for(const i of n){const r=await i.key,a=await i.value;s.push({key:r,value:a})}return fe.mergeObjectSync(e,s)}static mergeObjectSync(e,n){const s={};for(const i of n){const{key:r,value:a}=i;if(r.status==="aborted"||a.status==="aborted")return $;r.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),r.value!=="__proto__"&&(typeof a.value<"u"||i.alwaysSet)&&(s[r.value]=a.value)}return{status:e.value,value:s}}}const $=Object.freeze({status:"aborted"}),Nt=t=>({status:"dirty",value:t}),_e=t=>({status:"valid",value:t}),$i=t=>t.status==="aborted",Vi=t=>t.status==="dirty",_t=t=>t.status==="valid",Tn=t=>typeof Promise<"u"&&t instanceof Promise;var b;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(b||(b={}));class We{constructor(e,n,s,i){this._cachedPath=[],this.parent=e,this.data=n,this._path=s,this._key=i}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Gi=(t,e)=>{if(_t(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new ke(t.common.issues);return this._error=n,this._error}}};function B(t){if(!t)return{};const{errorMap:e,invalid_type_error:n,required_error:s,description:i}=t;if(e&&(n||s))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(a,u)=>{const{message:d}=t;return a.code==="invalid_enum_value"?{message:d??u.defaultError}:typeof u.data>"u"?{message:d??s??u.defaultError}:a.code!=="invalid_type"?{message:u.defaultError}:{message:d??n??u.defaultError}},description:i}}class J{get description(){return this._def.description}_getType(e){return Ge(e.data)}_getOrReturnCtx(e,n){return n||{common:e.parent.common,data:e.data,parsedType:Ge(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new fe,ctx:{common:e.parent.common,data:e.data,parsedType:Ge(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const n=this._parse(e);if(Tn(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(e){const n=this._parse(e);return Promise.resolve(n)}parse(e,n){const s=this.safeParse(e,n);if(s.success)return s.data;throw s.error}safeParse(e,n){const s={common:{issues:[],async:(n==null?void 0:n.async)??!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ge(e)},i=this._parseSync({data:e,path:s.path,parent:s});return Gi(s,i)}"~validate"(e){var s,i;const n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ge(e)};if(!this["~standard"].async)try{const r=this._parseSync({data:e,path:[],parent:n});return _t(r)?{value:r.value}:{issues:n.common.issues}}catch(r){(i=(s=r==null?void 0:r.message)==null?void 0:s.toLowerCase())!=null&&i.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(r=>_t(r)?{value:r.value}:{issues:n.common.issues})}async parseAsync(e,n){const s=await this.safeParseAsync(e,n);if(s.success)return s.data;throw s.error}async safeParseAsync(e,n){const s={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ge(e)},i=this._parse({data:e,path:s.path,parent:s}),r=await(Tn(i)?i:Promise.resolve(i));return Gi(s,r)}refine(e,n){const s=i=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(i):n;return this._refinement((i,r)=>{const a=e(i),u=()=>r.addIssue({code:E.custom,...s(i)});return typeof Promise<"u"&&a instanceof Promise?a.then(d=>d?!0:(u(),!1)):a?!0:(u(),!1)})}refinement(e,n){return this._refinement((s,i)=>e(s)?!0:(i.addIssue(typeof n=="function"?n(s,i):n),!1))}_refinement(e){return new St({schema:this,typeName:V.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return Be.create(this,this._def)}nullable(){return Ct.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Pe.create(this)}promise(){return En.create(this,this._def)}or(e){return Sn.create([this,e],this._def)}and(e){return Cn.create(this,e,this._def)}transform(e){return new St({...B(this._def),schema:this,typeName:V.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const n=typeof e=="function"?e:()=>e;return new ms({...B(this._def),innerType:this,defaultValue:n,typeName:V.ZodDefault})}brand(){return new Ou({typeName:V.ZodBranded,type:this,...B(this._def)})}catch(e){const n=typeof e=="function"?e:()=>e;return new gs({...B(this._def),innerType:this,catchValue:n,typeName:V.ZodCatch})}describe(e){const n=this.constructor;return new n({...this._def,description:e})}pipe(e){return Bs.create(this,e)}readonly(){return ys.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Su=/^c[^\s-]{8,}$/i,Cu=/^[0-9a-z]+$/,Eu=/^[0-9A-HJKMNP-TV-Z]{26}$/i,wu=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Iu=/^[a-z0-9_-]{21}$/i,Au=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Ru=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Pu=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,xu="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Qn;const Nu=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Mu=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ku=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,bu=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Du=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Uu=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,na="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Fu=new RegExp(`^${na}$`);function sa(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);const n=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${n}`}function Lu(t){return new RegExp(`^${sa(t)}$`)}function $u(t){let e=`${na}T${sa(t)}`;const n=[];return n.push(t.local?"Z?":"Z"),t.offset&&n.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${n.join("|")})`,new RegExp(`^${e}$`)}function Vu(t,e){return!!((e==="v4"||!e)&&Nu.test(t)||(e==="v6"||!e)&&ku.test(t))}function Gu(t,e){if(!Au.test(t))return!1;try{const[n]=t.split(".");if(!n)return!1;const s=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),i=JSON.parse(atob(s));return!(typeof i!="object"||i===null||"typ"in i&&(i==null?void 0:i.typ)!=="JWT"||!i.alg||e&&i.alg!==e)}catch{return!1}}function qu(t,e){return!!((e==="v4"||!e)&&Mu.test(t)||(e==="v6"||!e)&&bu.test(t))}class qe extends J{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==k.string){const r=this._getOrReturnCtx(e);return x(r,{code:E.invalid_type,expected:k.string,received:r.parsedType}),$}const s=new fe;let i;for(const r of this._def.checks)if(r.kind==="min")e.data.length<r.value&&(i=this._getOrReturnCtx(e,i),x(i,{code:E.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),s.dirty());else if(r.kind==="max")e.data.length>r.value&&(i=this._getOrReturnCtx(e,i),x(i,{code:E.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),s.dirty());else if(r.kind==="length"){const a=e.data.length>r.value,u=e.data.length<r.value;(a||u)&&(i=this._getOrReturnCtx(e,i),a?x(i,{code:E.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}):u&&x(i,{code:E.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}),s.dirty())}else if(r.kind==="email")Pu.test(e.data)||(i=this._getOrReturnCtx(e,i),x(i,{validation:"email",code:E.invalid_string,message:r.message}),s.dirty());else if(r.kind==="emoji")Qn||(Qn=new RegExp(xu,"u")),Qn.test(e.data)||(i=this._getOrReturnCtx(e,i),x(i,{validation:"emoji",code:E.invalid_string,message:r.message}),s.dirty());else if(r.kind==="uuid")wu.test(e.data)||(i=this._getOrReturnCtx(e,i),x(i,{validation:"uuid",code:E.invalid_string,message:r.message}),s.dirty());else if(r.kind==="nanoid")Iu.test(e.data)||(i=this._getOrReturnCtx(e,i),x(i,{validation:"nanoid",code:E.invalid_string,message:r.message}),s.dirty());else if(r.kind==="cuid")Su.test(e.data)||(i=this._getOrReturnCtx(e,i),x(i,{validation:"cuid",code:E.invalid_string,message:r.message}),s.dirty());else if(r.kind==="cuid2")Cu.test(e.data)||(i=this._getOrReturnCtx(e,i),x(i,{validation:"cuid2",code:E.invalid_string,message:r.message}),s.dirty());else if(r.kind==="ulid")Eu.test(e.data)||(i=this._getOrReturnCtx(e,i),x(i,{validation:"ulid",code:E.invalid_string,message:r.message}),s.dirty());else if(r.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),x(i,{validation:"url",code:E.invalid_string,message:r.message}),s.dirty()}else r.kind==="regex"?(r.regex.lastIndex=0,r.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),x(i,{validation:"regex",code:E.invalid_string,message:r.message}),s.dirty())):r.kind==="trim"?e.data=e.data.trim():r.kind==="includes"?e.data.includes(r.value,r.position)||(i=this._getOrReturnCtx(e,i),x(i,{code:E.invalid_string,validation:{includes:r.value,position:r.position},message:r.message}),s.dirty()):r.kind==="toLowerCase"?e.data=e.data.toLowerCase():r.kind==="toUpperCase"?e.data=e.data.toUpperCase():r.kind==="startsWith"?e.data.startsWith(r.value)||(i=this._getOrReturnCtx(e,i),x(i,{code:E.invalid_string,validation:{startsWith:r.value},message:r.message}),s.dirty()):r.kind==="endsWith"?e.data.endsWith(r.value)||(i=this._getOrReturnCtx(e,i),x(i,{code:E.invalid_string,validation:{endsWith:r.value},message:r.message}),s.dirty()):r.kind==="datetime"?$u(r).test(e.data)||(i=this._getOrReturnCtx(e,i),x(i,{code:E.invalid_string,validation:"datetime",message:r.message}),s.dirty()):r.kind==="date"?Fu.test(e.data)||(i=this._getOrReturnCtx(e,i),x(i,{code:E.invalid_string,validation:"date",message:r.message}),s.dirty()):r.kind==="time"?Lu(r).test(e.data)||(i=this._getOrReturnCtx(e,i),x(i,{code:E.invalid_string,validation:"time",message:r.message}),s.dirty()):r.kind==="duration"?Ru.test(e.data)||(i=this._getOrReturnCtx(e,i),x(i,{validation:"duration",code:E.invalid_string,message:r.message}),s.dirty()):r.kind==="ip"?Vu(e.data,r.version)||(i=this._getOrReturnCtx(e,i),x(i,{validation:"ip",code:E.invalid_string,message:r.message}),s.dirty()):r.kind==="jwt"?Gu(e.data,r.alg)||(i=this._getOrReturnCtx(e,i),x(i,{validation:"jwt",code:E.invalid_string,message:r.message}),s.dirty()):r.kind==="cidr"?qu(e.data,r.version)||(i=this._getOrReturnCtx(e,i),x(i,{validation:"cidr",code:E.invalid_string,message:r.message}),s.dirty()):r.kind==="base64"?Du.test(e.data)||(i=this._getOrReturnCtx(e,i),x(i,{validation:"base64",code:E.invalid_string,message:r.message}),s.dirty()):r.kind==="base64url"?Uu.test(e.data)||(i=this._getOrReturnCtx(e,i),x(i,{validation:"base64url",code:E.invalid_string,message:r.message}),s.dirty()):W.assertNever(r);return{status:s.value,value:e.data}}_regex(e,n,s){return this.refinement(i=>e.test(i),{validation:n,code:E.invalid_string,...b.errToObj(s)})}_addCheck(e){return new qe({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...b.errToObj(e)})}url(e){return this._addCheck({kind:"url",...b.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...b.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...b.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...b.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...b.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...b.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...b.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...b.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...b.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...b.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...b.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...b.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...b.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...b.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...b.errToObj(e)})}regex(e,n){return this._addCheck({kind:"regex",regex:e,...b.errToObj(n)})}includes(e,n){return this._addCheck({kind:"includes",value:e,position:n==null?void 0:n.position,...b.errToObj(n==null?void 0:n.message)})}startsWith(e,n){return this._addCheck({kind:"startsWith",value:e,...b.errToObj(n)})}endsWith(e,n){return this._addCheck({kind:"endsWith",value:e,...b.errToObj(n)})}min(e,n){return this._addCheck({kind:"min",value:e,...b.errToObj(n)})}max(e,n){return this._addCheck({kind:"max",value:e,...b.errToObj(n)})}length(e,n){return this._addCheck({kind:"length",value:e,...b.errToObj(n)})}nonempty(e){return this.min(1,b.errToObj(e))}trim(){return new qe({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new qe({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new qe({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxLength(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}qe.create=t=>new qe({checks:[],typeName:V.ZodString,coerce:(t==null?void 0:t.coerce)??!1,...B(t)});function Bu(t,e){const n=(t.toString().split(".")[1]||"").length,s=(e.toString().split(".")[1]||"").length,i=n>s?n:s,r=Number.parseInt(t.toFixed(i).replace(".","")),a=Number.parseInt(e.toFixed(i).replace(".",""));return r%a/10**i}class Tt extends J{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==k.number){const r=this._getOrReturnCtx(e);return x(r,{code:E.invalid_type,expected:k.number,received:r.parsedType}),$}let s;const i=new fe;for(const r of this._def.checks)r.kind==="int"?W.isInteger(e.data)||(s=this._getOrReturnCtx(e,s),x(s,{code:E.invalid_type,expected:"integer",received:"float",message:r.message}),i.dirty()):r.kind==="min"?(r.inclusive?e.data<r.value:e.data<=r.value)&&(s=this._getOrReturnCtx(e,s),x(s,{code:E.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),i.dirty()):r.kind==="max"?(r.inclusive?e.data>r.value:e.data>=r.value)&&(s=this._getOrReturnCtx(e,s),x(s,{code:E.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),i.dirty()):r.kind==="multipleOf"?Bu(e.data,r.value)!==0&&(s=this._getOrReturnCtx(e,s),x(s,{code:E.not_multiple_of,multipleOf:r.value,message:r.message}),i.dirty()):r.kind==="finite"?Number.isFinite(e.data)||(s=this._getOrReturnCtx(e,s),x(s,{code:E.not_finite,message:r.message}),i.dirty()):W.assertNever(r);return{status:i.value,value:e.data}}gte(e,n){return this.setLimit("min",e,!0,b.toString(n))}gt(e,n){return this.setLimit("min",e,!1,b.toString(n))}lte(e,n){return this.setLimit("max",e,!0,b.toString(n))}lt(e,n){return this.setLimit("max",e,!1,b.toString(n))}setLimit(e,n,s,i){return new Tt({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:s,message:b.toString(i)}]})}_addCheck(e){return new Tt({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:b.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:b.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:b.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:b.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:b.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:b.toString(n)})}finite(e){return this._addCheck({kind:"finite",message:b.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:b.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:b.toString(e)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&W.isInteger(e.value))}get isFinite(){let e=null,n=null;for(const s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(n===null||s.value>n)&&(n=s.value):s.kind==="max"&&(e===null||s.value<e)&&(e=s.value)}return Number.isFinite(n)&&Number.isFinite(e)}}Tt.create=t=>new Tt({checks:[],typeName:V.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...B(t)});class qt extends J{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==k.bigint)return this._getInvalidInput(e);let s;const i=new fe;for(const r of this._def.checks)r.kind==="min"?(r.inclusive?e.data<r.value:e.data<=r.value)&&(s=this._getOrReturnCtx(e,s),x(s,{code:E.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),i.dirty()):r.kind==="max"?(r.inclusive?e.data>r.value:e.data>=r.value)&&(s=this._getOrReturnCtx(e,s),x(s,{code:E.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),i.dirty()):r.kind==="multipleOf"?e.data%r.value!==BigInt(0)&&(s=this._getOrReturnCtx(e,s),x(s,{code:E.not_multiple_of,multipleOf:r.value,message:r.message}),i.dirty()):W.assertNever(r);return{status:i.value,value:e.data}}_getInvalidInput(e){const n=this._getOrReturnCtx(e);return x(n,{code:E.invalid_type,expected:k.bigint,received:n.parsedType}),$}gte(e,n){return this.setLimit("min",e,!0,b.toString(n))}gt(e,n){return this.setLimit("min",e,!1,b.toString(n))}lte(e,n){return this.setLimit("max",e,!0,b.toString(n))}lt(e,n){return this.setLimit("max",e,!1,b.toString(n))}setLimit(e,n,s,i){return new qt({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:s,message:b.toString(i)}]})}_addCheck(e){return new qt({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:b.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:b.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:b.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:b.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:b.toString(n)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}qt.create=t=>new qt({checks:[],typeName:V.ZodBigInt,coerce:(t==null?void 0:t.coerce)??!1,...B(t)});class ps extends J{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==k.boolean){const s=this._getOrReturnCtx(e);return x(s,{code:E.invalid_type,expected:k.boolean,received:s.parsedType}),$}return _e(e.data)}}ps.create=t=>new ps({typeName:V.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...B(t)});class vn extends J{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==k.date){const r=this._getOrReturnCtx(e);return x(r,{code:E.invalid_type,expected:k.date,received:r.parsedType}),$}if(Number.isNaN(e.data.getTime())){const r=this._getOrReturnCtx(e);return x(r,{code:E.invalid_date}),$}const s=new fe;let i;for(const r of this._def.checks)r.kind==="min"?e.data.getTime()<r.value&&(i=this._getOrReturnCtx(e,i),x(i,{code:E.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),s.dirty()):r.kind==="max"?e.data.getTime()>r.value&&(i=this._getOrReturnCtx(e,i),x(i,{code:E.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),s.dirty()):W.assertNever(r);return{status:s.value,value:new Date(e.data.getTime())}}_addCheck(e){return new vn({...this._def,checks:[...this._def.checks,e]})}min(e,n){return this._addCheck({kind:"min",value:e.getTime(),message:b.toString(n)})}max(e,n){return this._addCheck({kind:"max",value:e.getTime(),message:b.toString(n)})}get minDate(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e!=null?new Date(e):null}}vn.create=t=>new vn({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:V.ZodDate,...B(t)});class qi extends J{_parse(e){if(this._getType(e)!==k.symbol){const s=this._getOrReturnCtx(e);return x(s,{code:E.invalid_type,expected:k.symbol,received:s.parsedType}),$}return _e(e.data)}}qi.create=t=>new qi({typeName:V.ZodSymbol,...B(t)});class Bi extends J{_parse(e){if(this._getType(e)!==k.undefined){const s=this._getOrReturnCtx(e);return x(s,{code:E.invalid_type,expected:k.undefined,received:s.parsedType}),$}return _e(e.data)}}Bi.create=t=>new Bi({typeName:V.ZodUndefined,...B(t)});class Oi extends J{_parse(e){if(this._getType(e)!==k.null){const s=this._getOrReturnCtx(e);return x(s,{code:E.invalid_type,expected:k.null,received:s.parsedType}),$}return _e(e.data)}}Oi.create=t=>new Oi({typeName:V.ZodNull,...B(t)});class Hi extends J{constructor(){super(...arguments),this._any=!0}_parse(e){return _e(e.data)}}Hi.create=t=>new Hi({typeName:V.ZodAny,...B(t)});class Ji extends J{constructor(){super(...arguments),this._unknown=!0}_parse(e){return _e(e.data)}}Ji.create=t=>new Ji({typeName:V.ZodUnknown,...B(t)});class Ye extends J{_parse(e){const n=this._getOrReturnCtx(e);return x(n,{code:E.invalid_type,expected:k.never,received:n.parsedType}),$}}Ye.create=t=>new Ye({typeName:V.ZodNever,...B(t)});class Wi extends J{_parse(e){if(this._getType(e)!==k.undefined){const s=this._getOrReturnCtx(e);return x(s,{code:E.invalid_type,expected:k.void,received:s.parsedType}),$}return _e(e.data)}}Wi.create=t=>new Wi({typeName:V.ZodVoid,...B(t)});class Pe extends J{_parse(e){const{ctx:n,status:s}=this._processInputParams(e),i=this._def;if(n.parsedType!==k.array)return x(n,{code:E.invalid_type,expected:k.array,received:n.parsedType}),$;if(i.exactLength!==null){const a=n.data.length>i.exactLength.value,u=n.data.length<i.exactLength.value;(a||u)&&(x(n,{code:a?E.too_big:E.too_small,minimum:u?i.exactLength.value:void 0,maximum:a?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),s.dirty())}if(i.minLength!==null&&n.data.length<i.minLength.value&&(x(n,{code:E.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),s.dirty()),i.maxLength!==null&&n.data.length>i.maxLength.value&&(x(n,{code:E.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),s.dirty()),n.common.async)return Promise.all([...n.data].map((a,u)=>i.type._parseAsync(new We(n,a,n.path,u)))).then(a=>fe.mergeArray(s,a));const r=[...n.data].map((a,u)=>i.type._parseSync(new We(n,a,n.path,u)));return fe.mergeArray(s,r)}get element(){return this._def.type}min(e,n){return new Pe({...this._def,minLength:{value:e,message:b.toString(n)}})}max(e,n){return new Pe({...this._def,maxLength:{value:e,message:b.toString(n)}})}length(e,n){return new Pe({...this._def,exactLength:{value:e,message:b.toString(n)}})}nonempty(e){return this.min(1,e)}}Pe.create=(t,e)=>new Pe({type:t,minLength:null,maxLength:null,exactLength:null,typeName:V.ZodArray,...B(e)});function at(t){if(t instanceof j){const e={};for(const n in t.shape){const s=t.shape[n];e[n]=Be.create(at(s))}return new j({...t._def,shape:()=>e})}else return t instanceof Pe?new Pe({...t._def,type:at(t.element)}):t instanceof Be?Be.create(at(t.unwrap())):t instanceof Ct?Ct.create(at(t.unwrap())):t instanceof et?et.create(t.items.map(e=>at(e))):t}class j extends J{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),n=W.objectKeys(e);return this._cached={shape:e,keys:n},this._cached}_parse(e){if(this._getType(e)!==k.object){const c=this._getOrReturnCtx(e);return x(c,{code:E.invalid_type,expected:k.object,received:c.parsedType}),$}const{status:s,ctx:i}=this._processInputParams(e),{shape:r,keys:a}=this._getCached(),u=[];if(!(this._def.catchall instanceof Ye&&this._def.unknownKeys==="strip"))for(const c in i.data)a.includes(c)||u.push(c);const d=[];for(const c of a){const f=r[c],p=i.data[c];d.push({key:{status:"valid",value:c},value:f._parse(new We(i,p,i.path,c)),alwaysSet:c in i.data})}if(this._def.catchall instanceof Ye){const c=this._def.unknownKeys;if(c==="passthrough")for(const f of u)d.push({key:{status:"valid",value:f},value:{status:"valid",value:i.data[f]}});else if(c==="strict")u.length>0&&(x(i,{code:E.unrecognized_keys,keys:u}),s.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const f of u){const p=i.data[f];d.push({key:{status:"valid",value:f},value:c._parse(new We(i,p,i.path,f)),alwaysSet:f in i.data})}}return i.common.async?Promise.resolve().then(async()=>{const c=[];for(const f of d){const p=await f.key,h=await f.value;c.push({key:p,value:h,alwaysSet:f.alwaysSet})}return c}).then(c=>fe.mergeObjectSync(s,c)):fe.mergeObjectSync(s,d)}get shape(){return this._def.shape()}strict(e){return b.errToObj,new j({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(n,s)=>{var r,a;const i=((a=(r=this._def).errorMap)==null?void 0:a.call(r,n,s).message)??s.defaultError;return n.code==="unrecognized_keys"?{message:b.errToObj(e).message??i}:{message:i}}}:{}})}strip(){return new j({...this._def,unknownKeys:"strip"})}passthrough(){return new j({...this._def,unknownKeys:"passthrough"})}extend(e){return new j({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new j({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:V.ZodObject})}setKey(e,n){return this.augment({[e]:n})}catchall(e){return new j({...this._def,catchall:e})}pick(e){const n={};for(const s of W.objectKeys(e))e[s]&&this.shape[s]&&(n[s]=this.shape[s]);return new j({...this._def,shape:()=>n})}omit(e){const n={};for(const s of W.objectKeys(this.shape))e[s]||(n[s]=this.shape[s]);return new j({...this._def,shape:()=>n})}deepPartial(){return at(this)}partial(e){const n={};for(const s of W.objectKeys(this.shape)){const i=this.shape[s];e&&!e[s]?n[s]=i:n[s]=i.optional()}return new j({...this._def,shape:()=>n})}required(e){const n={};for(const s of W.objectKeys(this.shape))if(e&&!e[s])n[s]=this.shape[s];else{let r=this.shape[s];for(;r instanceof Be;)r=r._def.innerType;n[s]=r}return new j({...this._def,shape:()=>n})}keyof(){return ia(W.objectKeys(this.shape))}}j.create=(t,e)=>new j({shape:()=>t,unknownKeys:"strip",catchall:Ye.create(),typeName:V.ZodObject,...B(e)});j.strictCreate=(t,e)=>new j({shape:()=>t,unknownKeys:"strict",catchall:Ye.create(),typeName:V.ZodObject,...B(e)});j.lazycreate=(t,e)=>new j({shape:t,unknownKeys:"strip",catchall:Ye.create(),typeName:V.ZodObject,...B(e)});class Sn extends J{_parse(e){const{ctx:n}=this._processInputParams(e),s=this._def.options;function i(r){for(const u of r)if(u.result.status==="valid")return u.result;for(const u of r)if(u.result.status==="dirty")return n.common.issues.push(...u.ctx.common.issues),u.result;const a=r.map(u=>new ke(u.ctx.common.issues));return x(n,{code:E.invalid_union,unionErrors:a}),$}if(n.common.async)return Promise.all(s.map(async r=>{const a={...n,common:{...n.common,issues:[]},parent:null};return{result:await r._parseAsync({data:n.data,path:n.path,parent:a}),ctx:a}})).then(i);{let r;const a=[];for(const d of s){const c={...n,common:{...n.common,issues:[]},parent:null},f=d._parseSync({data:n.data,path:n.path,parent:c});if(f.status==="valid")return f;f.status==="dirty"&&!r&&(r={result:f,ctx:c}),c.common.issues.length&&a.push(c.common.issues)}if(r)return n.common.issues.push(...r.ctx.common.issues),r.result;const u=a.map(d=>new ke(d));return x(n,{code:E.invalid_union,unionErrors:u}),$}}get options(){return this._def.options}}Sn.create=(t,e)=>new Sn({options:t,typeName:V.ZodUnion,...B(e)});function hs(t,e){const n=Ge(t),s=Ge(e);if(t===e)return{valid:!0,data:t};if(n===k.object&&s===k.object){const i=W.objectKeys(e),r=W.objectKeys(t).filter(u=>i.indexOf(u)!==-1),a={...t,...e};for(const u of r){const d=hs(t[u],e[u]);if(!d.valid)return{valid:!1};a[u]=d.data}return{valid:!0,data:a}}else if(n===k.array&&s===k.array){if(t.length!==e.length)return{valid:!1};const i=[];for(let r=0;r<t.length;r++){const a=t[r],u=e[r],d=hs(a,u);if(!d.valid)return{valid:!1};i.push(d.data)}return{valid:!0,data:i}}else return n===k.date&&s===k.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}class Cn extends J{_parse(e){const{status:n,ctx:s}=this._processInputParams(e),i=(r,a)=>{if($i(r)||$i(a))return $;const u=hs(r.value,a.value);return u.valid?((Vi(r)||Vi(a))&&n.dirty(),{status:n.value,value:u.data}):(x(s,{code:E.invalid_intersection_types}),$)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([r,a])=>i(r,a)):i(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}}Cn.create=(t,e,n)=>new Cn({left:t,right:e,typeName:V.ZodIntersection,...B(n)});class et extends J{_parse(e){const{status:n,ctx:s}=this._processInputParams(e);if(s.parsedType!==k.array)return x(s,{code:E.invalid_type,expected:k.array,received:s.parsedType}),$;if(s.data.length<this._def.items.length)return x(s,{code:E.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),$;!this._def.rest&&s.data.length>this._def.items.length&&(x(s,{code:E.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const r=[...s.data].map((a,u)=>{const d=this._def.items[u]||this._def.rest;return d?d._parse(new We(s,a,s.path,u)):null}).filter(a=>!!a);return s.common.async?Promise.all(r).then(a=>fe.mergeArray(n,a)):fe.mergeArray(n,r)}get items(){return this._def.items}rest(e){return new et({...this._def,rest:e})}}et.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new et({items:t,typeName:V.ZodTuple,rest:null,...B(e)})};class Yi extends J{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:s}=this._processInputParams(e);if(s.parsedType!==k.map)return x(s,{code:E.invalid_type,expected:k.map,received:s.parsedType}),$;const i=this._def.keyType,r=this._def.valueType,a=[...s.data.entries()].map(([u,d],c)=>({key:i._parse(new We(s,u,s.path,[c,"key"])),value:r._parse(new We(s,d,s.path,[c,"value"]))}));if(s.common.async){const u=new Map;return Promise.resolve().then(async()=>{for(const d of a){const c=await d.key,f=await d.value;if(c.status==="aborted"||f.status==="aborted")return $;(c.status==="dirty"||f.status==="dirty")&&n.dirty(),u.set(c.value,f.value)}return{status:n.value,value:u}})}else{const u=new Map;for(const d of a){const c=d.key,f=d.value;if(c.status==="aborted"||f.status==="aborted")return $;(c.status==="dirty"||f.status==="dirty")&&n.dirty(),u.set(c.value,f.value)}return{status:n.value,value:u}}}}Yi.create=(t,e,n)=>new Yi({valueType:e,keyType:t,typeName:V.ZodMap,...B(n)});class Bt extends J{_parse(e){const{status:n,ctx:s}=this._processInputParams(e);if(s.parsedType!==k.set)return x(s,{code:E.invalid_type,expected:k.set,received:s.parsedType}),$;const i=this._def;i.minSize!==null&&s.data.size<i.minSize.value&&(x(s,{code:E.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),n.dirty()),i.maxSize!==null&&s.data.size>i.maxSize.value&&(x(s,{code:E.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),n.dirty());const r=this._def.valueType;function a(d){const c=new Set;for(const f of d){if(f.status==="aborted")return $;f.status==="dirty"&&n.dirty(),c.add(f.value)}return{status:n.value,value:c}}const u=[...s.data.values()].map((d,c)=>r._parse(new We(s,d,s.path,c)));return s.common.async?Promise.all(u).then(d=>a(d)):a(u)}min(e,n){return new Bt({...this._def,minSize:{value:e,message:b.toString(n)}})}max(e,n){return new Bt({...this._def,maxSize:{value:e,message:b.toString(n)}})}size(e,n){return this.min(e,n).max(e,n)}nonempty(e){return this.min(1,e)}}Bt.create=(t,e)=>new Bt({valueType:t,minSize:null,maxSize:null,typeName:V.ZodSet,...B(e)});class Ki extends J{get schema(){return this._def.getter()}_parse(e){const{ctx:n}=this._processInputParams(e);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}Ki.create=(t,e)=>new Ki({getter:t,typeName:V.ZodLazy,...B(e)});class zi extends J{_parse(e){if(e.data!==this._def.value){const n=this._getOrReturnCtx(e);return x(n,{received:n.data,code:E.invalid_literal,expected:this._def.value}),$}return{status:"valid",value:e.data}}get value(){return this._def.value}}zi.create=(t,e)=>new zi({value:t,typeName:V.ZodLiteral,...B(e)});function ia(t,e){return new vt({values:t,typeName:V.ZodEnum,...B(e)})}class vt extends J{_parse(e){if(typeof e.data!="string"){const n=this._getOrReturnCtx(e),s=this._def.values;return x(n,{expected:W.joinValues(s),received:n.parsedType,code:E.invalid_type}),$}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const n=this._getOrReturnCtx(e),s=this._def.values;return x(n,{received:n.data,code:E.invalid_enum_value,options:s}),$}return _e(e.data)}get options(){return this._def.values}get enum(){const e={};for(const n of this._def.values)e[n]=n;return e}get Values(){const e={};for(const n of this._def.values)e[n]=n;return e}get Enum(){const e={};for(const n of this._def.values)e[n]=n;return e}extract(e,n=this._def){return vt.create(e,{...this._def,...n})}exclude(e,n=this._def){return vt.create(this.options.filter(s=>!e.includes(s)),{...this._def,...n})}}vt.create=ia;class Zi extends J{_parse(e){const n=W.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==k.string&&s.parsedType!==k.number){const i=W.objectValues(n);return x(s,{expected:W.joinValues(i),received:s.parsedType,code:E.invalid_type}),$}if(this._cache||(this._cache=new Set(W.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const i=W.objectValues(n);return x(s,{received:s.data,code:E.invalid_enum_value,options:i}),$}return _e(e.data)}get enum(){return this._def.values}}Zi.create=(t,e)=>new Zi({values:t,typeName:V.ZodNativeEnum,...B(e)});class En extends J{unwrap(){return this._def.type}_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==k.promise&&n.common.async===!1)return x(n,{code:E.invalid_type,expected:k.promise,received:n.parsedType}),$;const s=n.parsedType===k.promise?n.data:Promise.resolve(n.data);return _e(s.then(i=>this._def.type.parseAsync(i,{path:n.path,errorMap:n.common.contextualErrorMap})))}}En.create=(t,e)=>new En({type:t,typeName:V.ZodPromise,...B(e)});class St extends J{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===V.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:n,ctx:s}=this._processInputParams(e),i=this._def.effect||null,r={addIssue:a=>{x(s,a),a.fatal?n.abort():n.dirty()},get path(){return s.path}};if(r.addIssue=r.addIssue.bind(r),i.type==="preprocess"){const a=i.transform(s.data,r);if(s.common.async)return Promise.resolve(a).then(async u=>{if(n.value==="aborted")return $;const d=await this._def.schema._parseAsync({data:u,path:s.path,parent:s});return d.status==="aborted"?$:d.status==="dirty"||n.value==="dirty"?Nt(d.value):d});{if(n.value==="aborted")return $;const u=this._def.schema._parseSync({data:a,path:s.path,parent:s});return u.status==="aborted"?$:u.status==="dirty"||n.value==="dirty"?Nt(u.value):u}}if(i.type==="refinement"){const a=u=>{const d=i.refinement(u,r);if(s.common.async)return Promise.resolve(d);if(d instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return u};if(s.common.async===!1){const u=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return u.status==="aborted"?$:(u.status==="dirty"&&n.dirty(),a(u.value),{status:n.value,value:u.value})}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(u=>u.status==="aborted"?$:(u.status==="dirty"&&n.dirty(),a(u.value).then(()=>({status:n.value,value:u.value}))))}if(i.type==="transform")if(s.common.async===!1){const a=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!_t(a))return $;const u=i.transform(a.value,r);if(u instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:u}}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(a=>_t(a)?Promise.resolve(i.transform(a.value,r)).then(u=>({status:n.value,value:u})):$);W.assertNever(i)}}St.create=(t,e,n)=>new St({schema:t,typeName:V.ZodEffects,effect:e,...B(n)});St.createWithPreprocess=(t,e,n)=>new St({schema:e,effect:{type:"preprocess",transform:t},typeName:V.ZodEffects,...B(n)});class Be extends J{_parse(e){return this._getType(e)===k.undefined?_e(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Be.create=(t,e)=>new Be({innerType:t,typeName:V.ZodOptional,...B(e)});class Ct extends J{_parse(e){return this._getType(e)===k.null?_e(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ct.create=(t,e)=>new Ct({innerType:t,typeName:V.ZodNullable,...B(e)});class ms extends J{_parse(e){const{ctx:n}=this._processInputParams(e);let s=n.data;return n.parsedType===k.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:n.path,parent:n})}removeDefault(){return this._def.innerType}}ms.create=(t,e)=>new ms({innerType:t,typeName:V.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...B(e)});class gs extends J{_parse(e){const{ctx:n}=this._processInputParams(e),s={...n,common:{...n.common,issues:[]}},i=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return Tn(i)?i.then(r=>({status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new ke(s.common.issues)},input:s.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new ke(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}}gs.create=(t,e)=>new gs({innerType:t,typeName:V.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...B(e)});class Xi extends J{_parse(e){if(this._getType(e)!==k.nan){const s=this._getOrReturnCtx(e);return x(s,{code:E.invalid_type,expected:k.nan,received:s.parsedType}),$}return{status:"valid",value:e.data}}}Xi.create=t=>new Xi({typeName:V.ZodNaN,...B(t)});class Ou extends J{_parse(e){const{ctx:n}=this._processInputParams(e),s=n.data;return this._def.type._parse({data:s,path:n.path,parent:n})}unwrap(){return this._def.type}}class Bs extends J{_parse(e){const{status:n,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{const r=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return r.status==="aborted"?$:r.status==="dirty"?(n.dirty(),Nt(r.value)):this._def.out._parseAsync({data:r.value,path:s.path,parent:s})})();{const i=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return i.status==="aborted"?$:i.status==="dirty"?(n.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:s.path,parent:s})}}static create(e,n){return new Bs({in:e,out:n,typeName:V.ZodPipeline})}}class ys extends J{_parse(e){const n=this._def.innerType._parse(e),s=i=>(_t(i)&&(i.value=Object.freeze(i.value)),i);return Tn(n)?n.then(i=>s(i)):s(n)}unwrap(){return this._def.innerType}}ys.create=(t,e)=>new ys({innerType:t,typeName:V.ZodReadonly,...B(e)});var V;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(V||(V={}));const Ae=qe.create,Lt=Tt.create,_s=ps.create;Ye.create;const Ts=Pe.create,Os=j.create,Qi=Sn.create;Cn.create;et.create;const wn=vt.create;En.create;Be.create;Ct.create;const Hu=["aggregate","profile","clean","detect_anomaly","remove_card","save_view","ask_clarify"],Ju=["csv.aggregate","csv.profile","csv.clean_invoice_month","csv.detect_outliers","ui.remove_card","idb.save_view"],Wu={aggregate:["csv.aggregate"],profile:["csv.profile"],clean:["csv.clean_invoice_month"],detect_anomaly:["csv.detect_outliers"],remove_card:["ui.remove_card"],save_view:["idb.save_view"],ask_clarify:[]},Yu=wn(["=","!=",">",">=","<","<=","in","contains"]),Ku=Os({column:Ae().min(1,"Filter column is required."),op:Yu.default("="),value:Qi([Ae(),Lt(),_s(),Ts(Qi([Ae(),Lt(),_s()])).nonempty()])}).strict(),zu=Os({datasetId:Ae().min(1).optional().nullable(),column:Ae().min(1).optional(),valueColumn:Ae().min(1).optional(),groupBy:Ts(Ae().min(1)).default([]),aggregation:wn(["sum","avg","count","min","max"]).default("sum"),filters:Ts(Ku).default([]),limit:Lt().int().positive().optional(),topN:Lt().int().positive().optional(),thresholdMultiplier:Lt().positive().optional(),viewTitle:Ae().min(1).optional(),cardId:Ae().min(1).optional()}).strict(),ra=Os({intent:wn(Hu),tool:wn(Ju).nullable().default(null),args:zu.default({}),awaitUser:_s().default(!1),message:Ae().max(280).optional().nullable()}).superRefine((t,e)=>{const n=Wu[t.intent]??[];n.length===0?t.tool!==null&&e.addIssue({code:E.custom,message:`Intent "${t.intent}" should not specify a tool.`,path:["tool"]}):(!t.tool||!n.includes(t.tool))&&e.addIssue({code:E.custom,message:`Tool "${t.tool}" is not allowed for intent "${t.intent}".`,path:["tool"]}),t.intent==="ask_clarify"&&!t.awaitUser&&e.addIssue({code:E.custom,message:"ask_clarify intent must set awaitUser=true.",path:["awaitUser"]})}),Zu=t=>{const e={awaitUser:!1,args:{groupBy:[],aggregation:"sum",filters:[]},...t},n=ra.safeParse(e);if(!n.success)throw n.error;return n.data},Xu=({state:t})=>{const e={...t,warnings:t.warnings??[]},n=t.observations.some(i=>i.kind==="profile_dataset"),s=[];return n||s.push({type:"execute_js_code",responseType:"execute_js_code",stepId:t.currentStepId??"diagnose-profile",stateTag:t.stateTag??"context_ready",timestamp:new Date().toISOString(),reason:"",meta:{toolCall:{kind:"profile_dataset"}},toolCall:{kind:"profile_dataset"},intentContract:Zu({intent:"profile",tool:"csv.profile",args:{}})}),{state:e,actions:s,label:"diagnose"}},Qu="llm_turn",oa=t=>!t||typeof t!="object"?!1:t.kind===Qu,ju="",ec=[{id:"clean_month",label:"/ InvoiceMonth",metadata:{column:"InvoiceMonth"}},{id:"outlier",label:"",metadata:{valueColumn:"Amount"}}],tc="Top10 by amount desc",nc=()=>`prompt-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,6)}`,sc=({state:t,payload:e})=>{var p;if(t.pendingUserReply)return{state:t,actions:[],label:"ask_user"};if(t.awaitingUser&&t.awaitPrompt){const h={type:"await_user",responseType:"await_user",stepId:t.currentStepId??"ask-user-choice",stateTag:"awaiting_clarification",timestamp:new Date().toISOString(),reason:"Still waiting for your selection before continuing.",text:t.awaitPrompt.question,meta:{awaitUser:!0,haltAfter:!0,promptId:t.awaitPrompt.promptId},awaitUserPayload:t.awaitPrompt};return{state:t,actions:[h],halted:!0,label:"ask_user"}}const n=oa(e)?e.askUserPrompt:null,s=nc(),i=(p=n==null?void 0:n.question)!=null&&p.trim()?n.question:ju,r=n!=null&&n.options&&n.options.length>0?n.options:ec,a=(n==null?void 0:n.placeholder)??tc,u=(n==null?void 0:n.allowFreeText)??!0,d={promptId:s,question:i,options:r,allowFreeText:u,placeholder:a},c={type:"await_user",responseType:"await_user",stepId:t.currentStepId??"ask-user-choice",stateTag:"awaiting_clarification",timestamp:new Date().toISOString(),reason:"Need user choice before continuing the analysis plan.",text:i,meta:{awaitUser:!0,haltAfter:!0,promptId:s},awaitUserPayload:d},f=t.steps.length>0?t.steps:[{id:"ask-user-choice",intent:"clarification",label:"Await user choice before planning",status:"waiting_user"}];return{state:{...t,awaitingUser:!0,blockedBy:"awaiting_user_choice",stateTag:"awaiting_clarification",steps:f,awaitPrompt:d,awaitPromptId:s,pendingPlan:null,pendingVerification:null,updatedAt:new Date().toISOString()},actions:[c],halted:!0,label:"ask_user"}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let ic,rc;function oc(){return{geminiUrl:ic,vertexUrl:rc}}function ac(t,e,n,s){var i,r;if(!(t!=null&&t.baseUrl)){const a=oc();return e?(i=a.vertexUrl)!==null&&i!==void 0?i:n:(r=a.geminiUrl)!==null&&r!==void 0?r:s}return t.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class De{}function A(t,e){const n=/\{([^}]+)\}/g;return t.replace(n,(s,i)=>{if(Object.prototype.hasOwnProperty.call(e,i)){const r=e[i];return r!=null?String(r):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function l(t,e,n){for(let r=0;r<e.length-1;r++){const a=e[r];if(a.endsWith("[]")){const u=a.slice(0,-2);if(!(u in t))if(Array.isArray(n))t[u]=Array.from({length:n.length},()=>({}));else throw new Error(`Value must be a list given an array path ${a}`);if(Array.isArray(t[u])){const d=t[u];if(Array.isArray(n))for(let c=0;c<d.length;c++){const f=d[c];l(f,e.slice(r+1),n[c])}else for(const c of d)l(c,e.slice(r+1),n)}return}else if(a.endsWith("[0]")){const u=a.slice(0,-3);u in t||(t[u]=[{}]);const d=t[u];l(d[0],e.slice(r+1),n);return}(!t[a]||typeof t[a]!="object")&&(t[a]={}),t=t[a]}const s=e[e.length-1],i=t[s];if(i!==void 0){if(!n||typeof n=="object"&&Object.keys(n).length===0||n===i)return;if(typeof i=="object"&&typeof n=="object"&&i!==null&&n!==null)Object.assign(i,n);else throw new Error(`Cannot set value for an existing key. Key: ${s}`)}else s==="_self"&&typeof n=="object"&&n!==null&&!Array.isArray(n)?Object.assign(t,n):t[s]=n}function o(t,e,n=void 0){try{if(e.length===1&&e[0]==="_self")return t;for(let s=0;s<e.length;s++){if(typeof t!="object"||t===null)return n;const i=e[s];if(i.endsWith("[]")){const r=i.slice(0,-2);if(r in t){const a=t[r];return Array.isArray(a)?a.map(u=>o(u,e.slice(s+1),n)):n}else return n}else t=t[i]}return t}catch(s){if(s instanceof TypeError)return n;throw s}}function lc(t,e){for(const[n,s]of Object.entries(e)){const i=n.split("."),r=s.split("."),a=new Set;let u=-1;for(let d=0;d<i.length;d++)if(i[d]==="*"){u=d;break}if(u!==-1&&r.length>u)for(let d=u;d<r.length;d++){const c=r[d];c!=="*"&&!c.endsWith("[]")&&!c.endsWith("[0]")&&a.add(c)}vs(t,i,r,0,a)}}function vs(t,e,n,s,i){if(s>=e.length||typeof t!="object"||t===null)return;const r=e[s];if(r.endsWith("[]")){const a=r.slice(0,-2),u=t;if(a in u&&Array.isArray(u[a]))for(const d of u[a])vs(d,e,n,s+1,i)}else if(r==="*"){if(typeof t=="object"&&t!==null&&!Array.isArray(t)){const a=t,u=Object.keys(a).filter(c=>!c.startsWith("_")&&!i.has(c)),d={};for(const c of u)d[c]=a[c];for(const[c,f]of Object.entries(d)){const p=[];for(const h of n.slice(s))h==="*"?p.push(c):p.push(h);l(a,p,f)}for(const c of u)delete a[c]}}else{const a=t;r in a&&vs(a[r],e,n,s+1,i)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Hs(t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function uc(t){const e={},n=o(t,["operationName"]);n!=null&&l(e,["operationName"],n);const s=o(t,["resourceName"]);return s!=null&&l(e,["_url","resourceName"],s),e}function cc(t){const e={},n=o(t,["name"]);n!=null&&l(e,["name"],n);const s=o(t,["metadata"]);s!=null&&l(e,["metadata"],s);const i=o(t,["done"]);i!=null&&l(e,["done"],i);const r=o(t,["error"]);r!=null&&l(e,["error"],r);const a=o(t,["response","generateVideoResponse"]);return a!=null&&l(e,["response"],fc(a)),e}function dc(t){const e={},n=o(t,["name"]);n!=null&&l(e,["name"],n);const s=o(t,["metadata"]);s!=null&&l(e,["metadata"],s);const i=o(t,["done"]);i!=null&&l(e,["done"],i);const r=o(t,["error"]);r!=null&&l(e,["error"],r);const a=o(t,["response"]);return a!=null&&l(e,["response"],pc(a)),e}function fc(t){const e={},n=o(t,["generatedSamples"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>hc(a))),l(e,["generatedVideos"],r)}const s=o(t,["raiMediaFilteredCount"]);s!=null&&l(e,["raiMediaFilteredCount"],s);const i=o(t,["raiMediaFilteredReasons"]);return i!=null&&l(e,["raiMediaFilteredReasons"],i),e}function pc(t){const e={},n=o(t,["videos"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>mc(a))),l(e,["generatedVideos"],r)}const s=o(t,["raiMediaFilteredCount"]);s!=null&&l(e,["raiMediaFilteredCount"],s);const i=o(t,["raiMediaFilteredReasons"]);return i!=null&&l(e,["raiMediaFilteredReasons"],i),e}function hc(t){const e={},n=o(t,["video"]);return n!=null&&l(e,["video"],Sc(n)),e}function mc(t){const e={},n=o(t,["_self"]);return n!=null&&l(e,["video"],Cc(n)),e}function gc(t){const e={},n=o(t,["operationName"]);return n!=null&&l(e,["_url","operationName"],n),e}function yc(t){const e={},n=o(t,["operationName"]);return n!=null&&l(e,["_url","operationName"],n),e}function _c(t){const e={},n=o(t,["name"]);n!=null&&l(e,["name"],n);const s=o(t,["metadata"]);s!=null&&l(e,["metadata"],s);const i=o(t,["done"]);i!=null&&l(e,["done"],i);const r=o(t,["error"]);r!=null&&l(e,["error"],r);const a=o(t,["response"]);return a!=null&&l(e,["response"],Tc(a)),e}function Tc(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["parent"]);s!=null&&l(e,["parent"],s);const i=o(t,["documentName"]);return i!=null&&l(e,["documentName"],i),e}function aa(t){const e={},n=o(t,["name"]);n!=null&&l(e,["name"],n);const s=o(t,["metadata"]);s!=null&&l(e,["metadata"],s);const i=o(t,["done"]);i!=null&&l(e,["done"],i);const r=o(t,["error"]);r!=null&&l(e,["error"],r);const a=o(t,["response"]);return a!=null&&l(e,["response"],vc(a)),e}function vc(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["parent"]);s!=null&&l(e,["parent"],s);const i=o(t,["documentName"]);return i!=null&&l(e,["documentName"],i),e}function Sc(t){const e={},n=o(t,["uri"]);n!=null&&l(e,["uri"],n);const s=o(t,["encodedVideo"]);s!=null&&l(e,["videoBytes"],Hs(s));const i=o(t,["encoding"]);return i!=null&&l(e,["mimeType"],i),e}function Cc(t){const e={},n=o(t,["gcsUri"]);n!=null&&l(e,["uri"],n);const s=o(t,["bytesBase64Encoded"]);s!=null&&l(e,["videoBytes"],Hs(s));const i=o(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var ji;(function(t){t.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",t.OUTCOME_OK="OUTCOME_OK",t.OUTCOME_FAILED="OUTCOME_FAILED",t.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(ji||(ji={}));var er;(function(t){t.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",t.PYTHON="PYTHON"})(er||(er={}));var tr;(function(t){t.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",t.SILENT="SILENT",t.WHEN_IDLE="WHEN_IDLE",t.INTERRUPT="INTERRUPT"})(tr||(tr={}));var y;(function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.STRING="STRING",t.NUMBER="NUMBER",t.INTEGER="INTEGER",t.BOOLEAN="BOOLEAN",t.ARRAY="ARRAY",t.OBJECT="OBJECT",t.NULL="NULL"})(y||(y={}));var nr;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(nr||(nr={}));var sr;(function(t){t.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",t.SIMPLE_SEARCH="SIMPLE_SEARCH",t.ELASTIC_SEARCH="ELASTIC_SEARCH"})(sr||(sr={}));var ir;(function(t){t.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",t.NO_AUTH="NO_AUTH",t.API_KEY_AUTH="API_KEY_AUTH",t.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",t.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",t.OAUTH="OAUTH",t.OIDC_AUTH="OIDC_AUTH"})(ir||(ir={}));var rr;(function(t){t.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",t.HTTP_IN_QUERY="HTTP_IN_QUERY",t.HTTP_IN_HEADER="HTTP_IN_HEADER",t.HTTP_IN_PATH="HTTP_IN_PATH",t.HTTP_IN_BODY="HTTP_IN_BODY",t.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(rr||(rr={}));var or;(function(t){t.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",t.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",t.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",t.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(or||(or={}));var ar;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",t.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",t.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",t.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",t.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(ar||(ar={}));var lr;(function(t){t.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",t.SEVERITY="SEVERITY",t.PROBABILITY="PROBABILITY"})(lr||(lr={}));var ur;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE",t.OFF="OFF"})(ur||(ur={}));var cr;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.IMAGE_SAFETY="IMAGE_SAFETY",t.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",t.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",t.NO_IMAGE="NO_IMAGE"})(cr||(cr={}));var dr;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(dr||(dr={}));var fr;(function(t){t.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",t.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",t.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",t.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",t.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(fr||(fr={}));var pr;(function(t){t.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",t.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",t.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",t.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",t.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(pr||(pr={}));var hr;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.IMAGE_SAFETY="IMAGE_SAFETY",t.MODEL_ARMOR="MODEL_ARMOR",t.JAILBREAK="JAILBREAK"})(hr||(hr={}));var mr;(function(t){t.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",t.ON_DEMAND="ON_DEMAND",t.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(mr||(mr={}));var In;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.AUDIO="AUDIO"})(In||(In={}));var gr;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(gr||(gr={}));var yr;(function(t){t.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",t.TUNING_MODE_FULL="TUNING_MODE_FULL",t.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(yr||(yr={}));var _r;(function(t){t.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",t.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",t.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",t.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",t.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",t.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",t.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(_r||(_r={}));var Ss;(function(t){t.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",t.JOB_STATE_QUEUED="JOB_STATE_QUEUED",t.JOB_STATE_PENDING="JOB_STATE_PENDING",t.JOB_STATE_RUNNING="JOB_STATE_RUNNING",t.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",t.JOB_STATE_FAILED="JOB_STATE_FAILED",t.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",t.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",t.JOB_STATE_PAUSED="JOB_STATE_PAUSED",t.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",t.JOB_STATE_UPDATING="JOB_STATE_UPDATING",t.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(Ss||(Ss={}));var Tr;(function(t){t.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",t.TUNING_TASK_I2V="TUNING_TASK_I2V",t.TUNING_TASK_T2V="TUNING_TASK_T2V",t.TUNING_TASK_R2V="TUNING_TASK_R2V"})(Tr||(Tr={}));var vr;(function(t){t.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",t.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",t.BALANCED="BALANCED",t.PRIORITIZE_COST="PRIORITIZE_COST"})(vr||(vr={}));var Sr;(function(t){t.UNSPECIFIED="UNSPECIFIED",t.BLOCKING="BLOCKING",t.NON_BLOCKING="NON_BLOCKING"})(Sr||(Sr={}));var Cr;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(Cr||(Cr={}));var Er;(function(t){t.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",t.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(Er||(Er={}));var wr;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE",t.VALIDATED="VALIDATED"})(wr||(wr={}));var Ir;(function(t){t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(Ir||(Ir={}));var Ar;(function(t){t.DONT_ALLOW="DONT_ALLOW",t.ALLOW_ADULT="ALLOW_ADULT",t.ALLOW_ALL="ALLOW_ALL"})(Ar||(Ar={}));var Rr;(function(t){t.auto="auto",t.en="en",t.ja="ja",t.ko="ko",t.hi="hi",t.zh="zh",t.pt="pt",t.es="es"})(Rr||(Rr={}));var Pr;(function(t){t.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",t.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",t.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",t.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",t.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(Pr||(Pr={}));var xr;(function(t){t.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",t.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",t.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",t.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(xr||(xr={}));var Nr;(function(t){t.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",t.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",t.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",t.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(Nr||(Nr={}));var Mr;(function(t){t.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",t.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",t.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",t.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",t.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",t.EDIT_MODE_STYLE="EDIT_MODE_STYLE",t.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",t.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(Mr||(Mr={}));var kr;(function(t){t.FOREGROUND="FOREGROUND",t.BACKGROUND="BACKGROUND",t.PROMPT="PROMPT",t.SEMANTIC="SEMANTIC",t.INTERACTIVE="INTERACTIVE"})(kr||(kr={}));var br;(function(t){t.ASSET="ASSET",t.STYLE="STYLE"})(br||(br={}));var Dr;(function(t){t.INSERT="INSERT",t.REMOVE="REMOVE",t.REMOVE_STATIC="REMOVE_STATIC",t.OUTPAINT="OUTPAINT"})(Dr||(Dr={}));var Ur;(function(t){t.OPTIMIZED="OPTIMIZED",t.LOSSLESS="LOSSLESS"})(Ur||(Ur={}));var Fr;(function(t){t.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",t.PREFERENCE_TUNING="PREFERENCE_TUNING"})(Fr||(Fr={}));var Lr;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.STATE_PENDING="STATE_PENDING",t.STATE_ACTIVE="STATE_ACTIVE",t.STATE_FAILED="STATE_FAILED"})(Lr||(Lr={}));var $r;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.PROCESSING="PROCESSING",t.ACTIVE="ACTIVE",t.FAILED="FAILED"})($r||($r={}));var Vr;(function(t){t.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",t.UPLOADED="UPLOADED",t.GENERATED="GENERATED"})(Vr||(Vr={}));var Gr;(function(t){t.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.RESPONSE_REJECTED="RESPONSE_REJECTED",t.NEED_MORE_INPUT="NEED_MORE_INPUT"})(Gr||(Gr={}));var qr;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.VIDEO="VIDEO",t.AUDIO="AUDIO",t.DOCUMENT="DOCUMENT"})(qr||(qr={}));var Br;(function(t){t.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",t.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",t.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(Br||(Br={}));var Or;(function(t){t.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",t.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",t.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(Or||(Or={}));var Hr;(function(t){t.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",t.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",t.NO_INTERRUPTION="NO_INTERRUPTION"})(Hr||(Hr={}));var Jr;(function(t){t.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",t.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",t.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(Jr||(Jr={}));var Wr;(function(t){t.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",t.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",t.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",t.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",t.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",t.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",t.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",t.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",t.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",t.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",t.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",t.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",t.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(Wr||(Wr={}));var Yr;(function(t){t.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",t.QUALITY="QUALITY",t.DIVERSITY="DIVERSITY",t.VOCALIZATION="VOCALIZATION"})(Yr||(Yr={}));var ct;(function(t){t.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",t.PLAY="PLAY",t.PAUSE="PAUSE",t.STOP="STOP",t.RESET_CONTEXT="RESET_CONTEXT"})(ct||(ct={}));class Cs{constructor(e){const n={};for(const s of e.headers.entries())n[s[0]]=s[1];this.headers=n,this.responseInternal=e}json(){return this.responseInternal.json()}}class xt{get text(){var e,n,s,i,r,a,u,d;if(((i=(s=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let c="",f=!1;const p=[];for(const h of(d=(u=(a=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)!==null&&d!==void 0?d:[]){for(const[m,_]of Object.entries(h))m!=="text"&&m!=="thought"&&(_!==null||_!==void 0)&&p.push(m);if(typeof h.text=="string"){if(typeof h.thought=="boolean"&&h.thought)continue;f=!0,c+=h.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),f?c:void 0}get data(){var e,n,s,i,r,a,u,d;if(((i=(s=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let c="";const f=[];for(const p of(d=(u=(a=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)!==null&&d!==void 0?d:[]){for(const[h,m]of Object.entries(p))h!=="inlineData"&&(m!==null||m!==void 0)&&f.push(h);p.inlineData&&typeof p.inlineData.data=="string"&&(c+=atob(p.inlineData.data))}return f.length>0&&console.warn(`there are non-data parts ${f} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),c.length>0?btoa(c):void 0}get functionCalls(){var e,n,s,i,r,a,u,d;if(((i=(s=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const c=(d=(u=(a=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)===null||d===void 0?void 0:d.filter(f=>f.functionCall).map(f=>f.functionCall).filter(f=>f!==void 0);if((c==null?void 0:c.length)!==0)return c}get executableCode(){var e,n,s,i,r,a,u,d,c;if(((i=(s=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const f=(d=(u=(a=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)===null||d===void 0?void 0:d.filter(p=>p.executableCode).map(p=>p.executableCode).filter(p=>p!==void 0);if((f==null?void 0:f.length)!==0)return(c=f==null?void 0:f[0])===null||c===void 0?void 0:c.code}get codeExecutionResult(){var e,n,s,i,r,a,u,d,c;if(((i=(s=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const f=(d=(u=(a=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)===null||d===void 0?void 0:d.filter(p=>p.codeExecutionResult).map(p=>p.codeExecutionResult).filter(p=>p!==void 0);if((f==null?void 0:f.length)!==0)return(c=f==null?void 0:f[0])===null||c===void 0?void 0:c.output}}class Kr{}class zr{}class Ec{}class wc{}class Ic{}class Ac{}class Zr{}class Xr{}class Qr{}class Rc{}class An{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const s=new An;let i;const r=e;return n?i=dc(r):i=cc(r),Object.assign(s,i),s}}class jr{}class eo{}class to{}class Pc{}class xc{}class Nc{}class Js{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const s=new Js,r=_c(e);return Object.assign(s,r),s}}class Mc{}class kc{}class bc{}class no{}class Dc{get text(){var e,n,s;let i="",r=!1;const a=[];for(const u of(s=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&s!==void 0?s:[]){for(const[d,c]of Object.entries(u))d!=="text"&&d!=="thought"&&c!==null&&a.push(d);if(typeof u.text=="string"){if(typeof u.thought=="boolean"&&u.thought)continue;r=!0,i+=u.text}}return a.length>0&&console.warn(`there are non-text parts ${a} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),r?i:void 0}get data(){var e,n,s;let i="";const r=[];for(const a of(s=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&s!==void 0?s:[]){for(const[u,d]of Object.entries(a))u!=="inlineData"&&d!==null&&r.push(u);a.inlineData&&typeof a.inlineData.data=="string"&&(i+=atob(a.inlineData.data))}return r.length>0&&console.warn(`there are non-data parts ${r} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}}class Uc{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class Ws{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const s=new Ws,r=aa(e);return Object.assign(s,r),s}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Y(t,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(t.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const n=e.split("/",2);return`publishers/${n[0]}/models/${n[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function la(t,e){const n=Y(t,e);return n?n.startsWith("publishers/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}`:n.startsWith("models/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/publishers/google/${n}`:n:""}function ua(t){return Array.isArray(t)?t.map(e=>Rn(e)):[Rn(t)]}function Rn(t){if(typeof t=="object"&&t!==null)return t;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof t}`)}function ca(t){const e=Rn(t);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function da(t){const e=Rn(t);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function so(t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function fa(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>so(e)):[so(t)]}function Es(t){return t!=null&&typeof t=="object"&&"parts"in t&&Array.isArray(t.parts)}function io(t){return t!=null&&typeof t=="object"&&"functionCall"in t}function ro(t){return t!=null&&typeof t=="object"&&"functionResponse"in t}function ae(t){if(t==null)throw new Error("ContentUnion is required");return Es(t)?t:{role:"user",parts:fa(t)}}function Ys(t,e){if(!e)return[];if(t.isVertexAI()&&Array.isArray(e))return e.flatMap(n=>{const s=ae(n);return s.parts&&s.parts.length>0&&s.parts[0].text!==void 0?[s.parts[0].text]:[]});if(t.isVertexAI()){const n=ae(e);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]}return Array.isArray(e)?e.map(n=>ae(n)):[ae(e)]}function ye(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t)){if(io(t)||ro(t))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[ae(t)]}const e=[],n=[],s=Es(t[0]);for(const i of t){const r=Es(i);if(r!=s)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(r)e.push(i);else{if(io(i)||ro(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(i)}}return s||e.push({role:"user",parts:fa(n)}),e}function Fc(t,e){t.includes("null")&&(e.nullable=!0);const n=t.filter(s=>s!=="null");if(n.length===1)e.type=Object.values(y).includes(n[0].toUpperCase())?n[0].toUpperCase():y.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const s of n)e.anyOf.push({type:Object.values(y).includes(s.toUpperCase())?s.toUpperCase():y.TYPE_UNSPECIFIED})}}function ft(t){const e={},n=["items"],s=["anyOf"],i=["properties"];if(t.type&&t.anyOf)throw new Error("type and anyOf cannot be both populated.");const r=t.anyOf;r!=null&&r.length==2&&(r[0].type==="null"?(e.nullable=!0,t=r[1]):r[1].type==="null"&&(e.nullable=!0,t=r[0])),t.type instanceof Array&&Fc(t.type,e);for(const[a,u]of Object.entries(t))if(u!=null)if(a=="type"){if(u==="null")throw new Error("type: null can not be the only possible type for the field.");if(u instanceof Array)continue;e.type=Object.values(y).includes(u.toUpperCase())?u.toUpperCase():y.TYPE_UNSPECIFIED}else if(n.includes(a))e[a]=ft(u);else if(s.includes(a)){const d=[];for(const c of u){if(c.type=="null"){e.nullable=!0;continue}d.push(ft(c))}e[a]=d}else if(i.includes(a)){const d={};for(const[c,f]of Object.entries(u))d[c]=ft(f);e[a]=d}else{if(a==="additionalProperties")continue;e[a]=u}return e}function Ks(t){return ft(t)}function zs(t){if(typeof t=="object")return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function Zs(t){if("multiSpeakerVoiceConfig"in t)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return t}function Et(t){if(t.functionDeclarations)for(const e of t.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=ft(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=ft(e.response));return t}function wt(t){if(t==null)throw new Error("tools is required");if(!Array.isArray(t))throw new Error("tools is required and must be an array of Tools");const e=[];for(const n of t)e.push(n);return e}function Lc(t,e,n,s=1){const i=!e.startsWith(`${n}/`)&&e.split("/").length===s;return t.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${t.getProject()}/${e}`:e.startsWith(`${n}/`)?`projects/${t.getProject()}/locations/${t.getLocation()}/${e}`:i?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}/${e}`:e:i?`${n}/${e}`:e}function Ue(t,e){if(typeof e!="string")throw new Error("name must be a string");return Lc(t,e,"cachedContents")}function pa(t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function Ke(t){return Hs(t)}function $c(t){return t!=null&&typeof t=="object"&&"name"in t}function Vc(t){return t!=null&&typeof t=="object"&&"video"in t}function Gc(t){return t!=null&&typeof t=="object"&&"uri"in t}function ha(t){var e;let n;if($c(t)&&(n=t.name),!(Gc(t)&&(n=t.uri,n===void 0))&&!(Vc(t)&&(n=(e=t.video)===null||e===void 0?void 0:e.uri,n===void 0))){if(typeof t=="string"&&(n=t),n===void 0)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){const i=n.split("files/")[1].match(/[a-z0-9]+/);if(i===null)throw new Error(`Could not extract file name from URI ${n}`);n=i[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function ma(t,e){let n;return t.isVertexAI()?n=e?"publishers/google/models":"models":n=e?"models":"tunedModels",n}function ga(t){for(const e of["models","tunedModels","publisherModels"])if(qc(t,e))return t[e];return[]}function qc(t,e){return t!==null&&typeof t=="object"&&e in t}function Bc(t,e={}){const n=t,s={name:n.name,description:n.description,parametersJsonSchema:n.inputSchema};return n.outputSchema&&(s.responseJsonSchema=n.outputSchema),e.behavior&&(s.behavior=e.behavior),{functionDeclarations:[s]}}function Oc(t,e={}){const n=[],s=new Set;for(const i of t){const r=i.name;if(s.has(r))throw new Error(`Duplicate function name ${r} found in MCP tools. Please ensure function names are unique.`);s.add(r);const a=Bc(i,e);a.functionDeclarations&&n.push(...a.functionDeclarations)}return{functionDeclarations:n}}function ya(t,e){let n;if(typeof e=="string")if(t.isVertexAI())if(e.startsWith("gs://"))n={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))n={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))n={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(t.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:e}}else n=e;const s=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,i=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(t.isVertexAI()){if(i>0||s!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(s>0||i!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function Hc(t){if(typeof t!="string")return t;const e=t;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function _a(t){if(typeof t!="object"||t===null)return{};const e=t,n=e.inlinedResponses;if(typeof n!="object"||n===null)return t;const i=n.inlinedResponses;if(!Array.isArray(i)||i.length===0)return t;let r=!1;for(const a of i){if(typeof a!="object"||a===null)continue;const d=a.response;if(typeof d!="object"||d===null)continue;if(d.embedding!==void 0){r=!0;break}}return r&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),t}function It(t,e){const n=e;if(!t.isVertexAI()){if(/batches\/[^/]+$/.test(n))return n.split("/").pop();throw new Error(`Invalid batch job name: ${n}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(n))return n.split("/").pop();if(/^\d+$/.test(n))return n;throw new Error(`Invalid batch job name: ${n}.`)}function Ta(t){const e=t;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Jc(t){const e={},n=o(t,["responsesFile"]);n!=null&&l(e,["fileName"],n);const s=o(t,["inlinedResponses","inlinedResponses"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>Cd(a))),l(e,["inlinedResponses"],r)}const i=o(t,["inlinedEmbedContentResponses","inlinedResponses"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(a=>a)),l(e,["inlinedEmbedContentResponses"],r)}return e}function Wc(t){const e={},n=o(t,["predictionsFormat"]);n!=null&&l(e,["format"],n);const s=o(t,["gcsDestination","outputUriPrefix"]);s!=null&&l(e,["gcsUri"],s);const i=o(t,["bigqueryDestination","outputUri"]);return i!=null&&l(e,["bigqueryUri"],i),e}function Yc(t){const e={},n=o(t,["format"]);n!=null&&l(e,["predictionsFormat"],n);const s=o(t,["gcsUri"]);s!=null&&l(e,["gcsDestination","outputUriPrefix"],s);const i=o(t,["bigqueryUri"]);if(i!=null&&l(e,["bigqueryDestination","outputUri"],i),o(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(o(t,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(o(t,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function cn(t){const e={},n=o(t,["name"]);n!=null&&l(e,["name"],n);const s=o(t,["metadata","displayName"]);s!=null&&l(e,["displayName"],s);const i=o(t,["metadata","state"]);i!=null&&l(e,["state"],Ta(i));const r=o(t,["metadata","createTime"]);r!=null&&l(e,["createTime"],r);const a=o(t,["metadata","endTime"]);a!=null&&l(e,["endTime"],a);const u=o(t,["metadata","updateTime"]);u!=null&&l(e,["updateTime"],u);const d=o(t,["metadata","model"]);d!=null&&l(e,["model"],d);const c=o(t,["metadata","output"]);return c!=null&&l(e,["dest"],Jc(_a(c))),e}function ws(t){const e={},n=o(t,["name"]);n!=null&&l(e,["name"],n);const s=o(t,["displayName"]);s!=null&&l(e,["displayName"],s);const i=o(t,["state"]);i!=null&&l(e,["state"],Ta(i));const r=o(t,["error"]);r!=null&&l(e,["error"],r);const a=o(t,["createTime"]);a!=null&&l(e,["createTime"],a);const u=o(t,["startTime"]);u!=null&&l(e,["startTime"],u);const d=o(t,["endTime"]);d!=null&&l(e,["endTime"],d);const c=o(t,["updateTime"]);c!=null&&l(e,["updateTime"],c);const f=o(t,["model"]);f!=null&&l(e,["model"],f);const p=o(t,["inputConfig"]);p!=null&&l(e,["src"],Kc(p));const h=o(t,["outputConfig"]);h!=null&&l(e,["dest"],Wc(_a(h)));const m=o(t,["completionStats"]);return m!=null&&l(e,["completionStats"],m),e}function Kc(t){const e={},n=o(t,["instancesFormat"]);n!=null&&l(e,["format"],n);const s=o(t,["gcsSource","uris"]);s!=null&&l(e,["gcsUri"],s);const i=o(t,["bigquerySource","inputUri"]);return i!=null&&l(e,["bigqueryUri"],i),e}function zc(t,e){const n={};if(o(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(o(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(o(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const s=o(e,["fileName"]);s!=null&&l(n,["fileName"],s);const i=o(e,["inlinedRequests"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(a=>Sd(t,a))),l(n,["requests","requests"],r)}return n}function Zc(t){const e={},n=o(t,["format"]);n!=null&&l(e,["instancesFormat"],n);const s=o(t,["gcsUri"]);s!=null&&l(e,["gcsSource","uris"],s);const i=o(t,["bigqueryUri"]);if(i!=null&&l(e,["bigquerySource","inputUri"],i),o(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(o(t,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function Xc(t){const e={},n=o(t,["data"]);if(n!=null&&l(e,["data"],n),o(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=o(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function Qc(t,e){const n={},s=o(e,["name"]);return s!=null&&l(n,["_url","name"],It(t,s)),n}function jc(t,e){const n={},s=o(e,["name"]);return s!=null&&l(n,["_url","name"],It(t,s)),n}function ed(t){const e={},n=o(t,["content"]);n!=null&&l(e,["content"],n);const s=o(t,["citationMetadata"]);s!=null&&l(e,["citationMetadata"],td(s));const i=o(t,["tokenCount"]);i!=null&&l(e,["tokenCount"],i);const r=o(t,["finishReason"]);r!=null&&l(e,["finishReason"],r);const a=o(t,["avgLogprobs"]);a!=null&&l(e,["avgLogprobs"],a);const u=o(t,["groundingMetadata"]);u!=null&&l(e,["groundingMetadata"],u);const d=o(t,["index"]);d!=null&&l(e,["index"],d);const c=o(t,["logprobsResult"]);c!=null&&l(e,["logprobsResult"],c);const f=o(t,["safetyRatings"]);if(f!=null){let h=f;Array.isArray(h)&&(h=h.map(m=>m)),l(e,["safetyRatings"],h)}const p=o(t,["urlContextMetadata"]);return p!=null&&l(e,["urlContextMetadata"],p),e}function td(t){const e={},n=o(t,["citationSources"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(i=>i)),l(e,["citations"],s)}return e}function va(t){const e={},n=o(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>xd(r))),l(e,["parts"],i)}const s=o(t,["role"]);return s!=null&&l(e,["role"],s),e}function nd(t,e){const n={},s=o(t,["displayName"]);if(e!==void 0&&s!=null&&l(e,["batch","displayName"],s),o(t,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return n}function sd(t,e){const n={},s=o(t,["displayName"]);e!==void 0&&s!=null&&l(e,["displayName"],s);const i=o(t,["dest"]);return e!==void 0&&i!=null&&l(e,["outputConfig"],Yc(Hc(i))),n}function oo(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["src"]);i!=null&&l(n,["batch","inputConfig"],zc(t,ya(t,i)));const r=o(e,["config"]);return r!=null&&nd(r,n),n}function id(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["model"],Y(t,s));const i=o(e,["src"]);i!=null&&l(n,["inputConfig"],Zc(ya(t,i)));const r=o(e,["config"]);return r!=null&&sd(r,n),n}function rd(t,e){const n={},s=o(t,["displayName"]);return e!==void 0&&s!=null&&l(e,["batch","displayName"],s),n}function od(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["src"]);i!=null&&l(n,["batch","inputConfig"],pd(t,i));const r=o(e,["config"]);return r!=null&&rd(r,n),n}function ad(t,e){const n={},s=o(e,["name"]);return s!=null&&l(n,["_url","name"],It(t,s)),n}function ld(t,e){const n={},s=o(e,["name"]);return s!=null&&l(n,["_url","name"],It(t,s)),n}function ud(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["name"]);s!=null&&l(e,["name"],s);const i=o(t,["done"]);i!=null&&l(e,["done"],i);const r=o(t,["error"]);return r!=null&&l(e,["error"],r),e}function cd(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["name"]);s!=null&&l(e,["name"],s);const i=o(t,["done"]);i!=null&&l(e,["done"],i);const r=o(t,["error"]);return r!=null&&l(e,["error"],r),e}function dd(t,e){const n={},s=o(e,["contents"]);if(s!=null){let r=Ys(t,s);Array.isArray(r)&&(r=r.map(a=>a)),l(n,["requests[]","request","content"],r)}const i=o(e,["config"]);return i!=null&&(l(n,["_self"],fd(i,n)),lc(n,{"requests[].*":"requests[].request.*"})),n}function fd(t,e){const n={},s=o(t,["taskType"]);e!==void 0&&s!=null&&l(e,["requests[]","taskType"],s);const i=o(t,["title"]);e!==void 0&&i!=null&&l(e,["requests[]","title"],i);const r=o(t,["outputDimensionality"]);if(e!==void 0&&r!=null&&l(e,["requests[]","outputDimensionality"],r),o(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(o(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function pd(t,e){const n={},s=o(e,["fileName"]);s!=null&&l(n,["file_name"],s);const i=o(e,["inlinedRequests"]);return i!=null&&l(n,["requests"],dd(t,i)),n}function hd(t){const e={};if(o(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=o(t,["fileUri"]);n!=null&&l(e,["fileUri"],n);const s=o(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function md(t,e,n){const s={},i=o(e,["systemInstruction"]);n!==void 0&&i!=null&&l(n,["systemInstruction"],va(ae(i)));const r=o(e,["temperature"]);r!=null&&l(s,["temperature"],r);const a=o(e,["topP"]);a!=null&&l(s,["topP"],a);const u=o(e,["topK"]);u!=null&&l(s,["topK"],u);const d=o(e,["candidateCount"]);d!=null&&l(s,["candidateCount"],d);const c=o(e,["maxOutputTokens"]);c!=null&&l(s,["maxOutputTokens"],c);const f=o(e,["stopSequences"]);f!=null&&l(s,["stopSequences"],f);const p=o(e,["responseLogprobs"]);p!=null&&l(s,["responseLogprobs"],p);const h=o(e,["logprobs"]);h!=null&&l(s,["logprobs"],h);const m=o(e,["presencePenalty"]);m!=null&&l(s,["presencePenalty"],m);const _=o(e,["frequencyPenalty"]);_!=null&&l(s,["frequencyPenalty"],_);const g=o(e,["seed"]);g!=null&&l(s,["seed"],g);const T=o(e,["responseMimeType"]);T!=null&&l(s,["responseMimeType"],T);const w=o(e,["responseSchema"]);w!=null&&l(s,["responseSchema"],Ks(w));const v=o(e,["responseJsonSchema"]);if(v!=null&&l(s,["responseJsonSchema"],v),o(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(o(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const S=o(e,["safetySettings"]);if(n!==void 0&&S!=null){let O=S;Array.isArray(O)&&(O=O.map(Q=>Nd(Q))),l(n,["safetySettings"],O)}const C=o(e,["tools"]);if(n!==void 0&&C!=null){let O=wt(C);Array.isArray(O)&&(O=O.map(Q=>Md(Et(Q)))),l(n,["tools"],O)}const N=o(e,["toolConfig"]);if(n!==void 0&&N!=null&&l(n,["toolConfig"],N),o(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const R=o(e,["cachedContent"]);n!==void 0&&R!=null&&l(n,["cachedContent"],Ue(t,R));const I=o(e,["responseModalities"]);I!=null&&l(s,["responseModalities"],I);const q=o(e,["mediaResolution"]);q!=null&&l(s,["mediaResolution"],q);const P=o(e,["speechConfig"]);if(P!=null&&l(s,["speechConfig"],zs(P)),o(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const M=o(e,["thinkingConfig"]);M!=null&&l(s,["thinkingConfig"],M);const U=o(e,["imageConfig"]);return U!=null&&l(s,["imageConfig"],U),s}function gd(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["candidates"]);if(s!=null){let d=s;Array.isArray(d)&&(d=d.map(c=>ed(c))),l(e,["candidates"],d)}const i=o(t,["modelVersion"]);i!=null&&l(e,["modelVersion"],i);const r=o(t,["promptFeedback"]);r!=null&&l(e,["promptFeedback"],r);const a=o(t,["responseId"]);a!=null&&l(e,["responseId"],a);const u=o(t,["usageMetadata"]);return u!=null&&l(e,["usageMetadata"],u),e}function yd(t,e){const n={},s=o(e,["name"]);return s!=null&&l(n,["_url","name"],It(t,s)),n}function _d(t,e){const n={},s=o(e,["name"]);return s!=null&&l(n,["_url","name"],It(t,s)),n}function Td(t){const e={};if(o(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=o(t,["enableWidget"]);return n!=null&&l(e,["enableWidget"],n),e}function vd(t){const e={};if(o(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(o(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=o(t,["timeRangeFilter"]);return n!=null&&l(e,["timeRangeFilter"],n),e}function Sd(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["request","model"],Y(t,s));const i=o(e,["contents"]);if(i!=null){let u=ye(i);Array.isArray(u)&&(u=u.map(d=>va(d))),l(n,["request","contents"],u)}const r=o(e,["metadata"]);r!=null&&l(n,["metadata"],r);const a=o(e,["config"]);return a!=null&&l(n,["request","generationConfig"],md(t,a,o(n,["request"],{}))),n}function Cd(t){const e={},n=o(t,["response"]);n!=null&&l(e,["response"],gd(n));const s=o(t,["error"]);return s!=null&&l(e,["error"],s),e}function Ed(t,e){const n={},s=o(t,["pageSize"]);e!==void 0&&s!=null&&l(e,["_query","pageSize"],s);const i=o(t,["pageToken"]);if(e!==void 0&&i!=null&&l(e,["_query","pageToken"],i),o(t,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return n}function wd(t,e){const n={},s=o(t,["pageSize"]);e!==void 0&&s!=null&&l(e,["_query","pageSize"],s);const i=o(t,["pageToken"]);e!==void 0&&i!=null&&l(e,["_query","pageToken"],i);const r=o(t,["filter"]);return e!==void 0&&r!=null&&l(e,["_query","filter"],r),n}function Id(t){const e={},n=o(t,["config"]);return n!=null&&Ed(n,e),e}function Ad(t){const e={},n=o(t,["config"]);return n!=null&&wd(n,e),e}function Rd(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["nextPageToken"]);s!=null&&l(e,["nextPageToken"],s);const i=o(t,["operations"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(a=>cn(a))),l(e,["batchJobs"],r)}return e}function Pd(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["nextPageToken"]);s!=null&&l(e,["nextPageToken"],s);const i=o(t,["batchPredictionJobs"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(a=>ws(a))),l(e,["batchJobs"],r)}return e}function xd(t){const e={},n=o(t,["functionCall"]);n!=null&&l(e,["functionCall"],n);const s=o(t,["codeExecutionResult"]);s!=null&&l(e,["codeExecutionResult"],s);const i=o(t,["executableCode"]);i!=null&&l(e,["executableCode"],i);const r=o(t,["fileData"]);r!=null&&l(e,["fileData"],hd(r));const a=o(t,["functionResponse"]);a!=null&&l(e,["functionResponse"],a);const u=o(t,["inlineData"]);u!=null&&l(e,["inlineData"],Xc(u));const d=o(t,["text"]);d!=null&&l(e,["text"],d);const c=o(t,["thought"]);c!=null&&l(e,["thought"],c);const f=o(t,["thoughtSignature"]);f!=null&&l(e,["thoughtSignature"],f);const p=o(t,["videoMetadata"]);return p!=null&&l(e,["videoMetadata"],p),e}function Nd(t){const e={},n=o(t,["category"]);if(n!=null&&l(e,["category"],n),o(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const s=o(t,["threshold"]);return s!=null&&l(e,["threshold"],s),e}function Md(t){const e={},n=o(t,["functionDeclarations"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(p=>p)),l(e,["functionDeclarations"],f)}if(o(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=o(t,["googleSearchRetrieval"]);s!=null&&l(e,["googleSearchRetrieval"],s);const i=o(t,["computerUse"]);i!=null&&l(e,["computerUse"],i);const r=o(t,["fileSearch"]);r!=null&&l(e,["fileSearch"],r);const a=o(t,["codeExecution"]);if(a!=null&&l(e,["codeExecution"],a),o(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const u=o(t,["googleMaps"]);u!=null&&l(e,["googleMaps"],Td(u));const d=o(t,["googleSearch"]);d!=null&&l(e,["googleSearch"],vd(d));const c=o(t,["urlContext"]);return c!=null&&l(e,["urlContext"],c),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var be;(function(t){t.PAGED_ITEM_BATCH_JOBS="batchJobs",t.PAGED_ITEM_MODELS="models",t.PAGED_ITEM_TUNING_JOBS="tuningJobs",t.PAGED_ITEM_FILES="files",t.PAGED_ITEM_CACHED_CONTENTS="cachedContents",t.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",t.PAGED_ITEM_DOCUMENTS="documents"})(be||(be={}));class nt{constructor(e,n,s,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=n,this.init(e,s,i)}init(e,n,s){var i,r;this.nameInternal=e,this.pageInternal=n[this.nameInternal]||[],this.sdkHttpResponseInternal=n==null?void 0:n.sdkHttpResponse,this.idxInternal=0;let a={config:{}};!s||Object.keys(s).length===0?a={config:{}}:typeof s=="object"?a=Object.assign({},s):a=s,a.config&&(a.config.pageToken=n.nextPageToken),this.paramsInternal=a,this.pageInternalSize=(r=(i=a.config)===null||i===void 0?void 0:i.pageSize)!==null&&r!==void 0?r:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let kd=class extends De{constructor(e){super(),this.apiClient=e,this.create=async n=>(this.apiClient.isVertexAI()&&(n.config=this.formatDestination(n.src,n.config)),this.createInternal(n)),this.createEmbeddings=async n=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(n)},this.list=async(n={})=>new nt(be.PAGED_ITEM_BATCH_JOBS,s=>this.listInternal(s),await this.listInternal(n),n)}createInlinedGenerateContentRequest(e){const n=oo(this.apiClient,e),s=n._url,i=A("{model}:batchGenerateContent",s),u=n.batch.inputConfig.requests,d=u.requests,c=[];for(const f of d){const p=Object.assign({},f);if(p.systemInstruction){const h=p.systemInstruction;delete p.systemInstruction;const m=p.request;m.systemInstruction=h,p.request=m}c.push(p)}return u.requests=c,delete n.config,delete n._url,delete n._query,{path:i,body:n}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,n){const s=n?Object.assign({},n):{},i=Date.now().toString();if(s.displayName||(s.displayName=`genaiBatchJob_${i}`),s.dest===void 0){const r=this.getGcsUri(e),a=this.getBigqueryUri(e);if(r)r.endsWith(".jsonl")?s.dest=`${r.slice(0,-6)}/dest`:s.dest=`${r}_dest_${i}`;else if(a)s.dest=`${a}_dest_${i}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return s}async createInternal(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=id(this.apiClient,e);return u=A("batchPredictionJobs",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(f=>ws(f))}else{const c=oo(this.apiClient,e);return u=A("{model}:batchGenerateContent",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),a.then(f=>cn(f))}}async createEmbeddingsInternal(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=od(this.apiClient,e);return r=A("{model}:asyncBatchEmbedContent",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>cn(d))}}async get(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=_d(this.apiClient,e);return u=A("batchPredictionJobs/{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(f=>ws(f))}else{const c=yd(this.apiClient,e);return u=A("batches/{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),a.then(f=>cn(f))}}async cancel(e){var n,s,i,r;let a="",u={};if(this.apiClient.isVertexAI()){const d=jc(this.apiClient,e);a=A("batchPredictionJobs/{name}:cancel",d._url),u=d._query,delete d._url,delete d._query,await this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}else{const d=Qc(this.apiClient,e);a=A("batches/{name}:cancel",d._url),u=d._query,delete d._url,delete d._query,await this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=Ad(e);return u=A("batchPredictionJobs",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=Pd(f),h=new no;return Object.assign(h,p),h})}else{const c=Id(e);return u=A("batches",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=Rd(f),h=new no;return Object.assign(h,p),h})}}async delete(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=ld(this.apiClient,e);return u=A("batchPredictionJobs/{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>cd(f))}else{const c=ad(this.apiClient,e);return u=A("batches/{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>ud(f))}}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function bd(t){const e={},n=o(t,["data"]);if(n!=null&&l(e,["data"],n),o(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=o(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function ao(t){const e={},n=o(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>ef(r))),l(e,["parts"],i)}const s=o(t,["role"]);return s!=null&&l(e,["role"],s),e}function Dd(t,e){const n={},s=o(t,["ttl"]);e!==void 0&&s!=null&&l(e,["ttl"],s);const i=o(t,["expireTime"]);e!==void 0&&i!=null&&l(e,["expireTime"],i);const r=o(t,["displayName"]);e!==void 0&&r!=null&&l(e,["displayName"],r);const a=o(t,["contents"]);if(e!==void 0&&a!=null){let f=ye(a);Array.isArray(f)&&(f=f.map(p=>ao(p))),l(e,["contents"],f)}const u=o(t,["systemInstruction"]);e!==void 0&&u!=null&&l(e,["systemInstruction"],ao(ae(u)));const d=o(t,["tools"]);if(e!==void 0&&d!=null){let f=d;Array.isArray(f)&&(f=f.map(p=>tf(p))),l(e,["tools"],f)}const c=o(t,["toolConfig"]);if(e!==void 0&&c!=null&&l(e,["toolConfig"],c),o(t,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return n}function Ud(t,e){const n={},s=o(t,["ttl"]);e!==void 0&&s!=null&&l(e,["ttl"],s);const i=o(t,["expireTime"]);e!==void 0&&i!=null&&l(e,["expireTime"],i);const r=o(t,["displayName"]);e!==void 0&&r!=null&&l(e,["displayName"],r);const a=o(t,["contents"]);if(e!==void 0&&a!=null){let p=ye(a);Array.isArray(p)&&(p=p.map(h=>h)),l(e,["contents"],p)}const u=o(t,["systemInstruction"]);e!==void 0&&u!=null&&l(e,["systemInstruction"],ae(u));const d=o(t,["tools"]);if(e!==void 0&&d!=null){let p=d;Array.isArray(p)&&(p=p.map(h=>nf(h))),l(e,["tools"],p)}const c=o(t,["toolConfig"]);e!==void 0&&c!=null&&l(e,["toolConfig"],c);const f=o(t,["kmsKeyName"]);return e!==void 0&&f!=null&&l(e,["encryption_spec","kmsKeyName"],f),n}function Fd(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["model"],la(t,s));const i=o(e,["config"]);return i!=null&&Dd(i,n),n}function Ld(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["model"],la(t,s));const i=o(e,["config"]);return i!=null&&Ud(i,n),n}function $d(t,e){const n={},s=o(e,["name"]);return s!=null&&l(n,["_url","name"],Ue(t,s)),n}function Vd(t,e){const n={},s=o(e,["name"]);return s!=null&&l(n,["_url","name"],Ue(t,s)),n}function Gd(t){const e={},n=o(t,["sdkHttpResponse"]);return n!=null&&l(e,["sdkHttpResponse"],n),e}function qd(t){const e={},n=o(t,["sdkHttpResponse"]);return n!=null&&l(e,["sdkHttpResponse"],n),e}function Bd(t){const e={};if(o(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=o(t,["fileUri"]);n!=null&&l(e,["fileUri"],n);const s=o(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function Od(t){const e={};if(o(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=o(t,["description"]);n!=null&&l(e,["description"],n);const s=o(t,["name"]);s!=null&&l(e,["name"],s);const i=o(t,["parameters"]);i!=null&&l(e,["parameters"],i);const r=o(t,["parametersJsonSchema"]);r!=null&&l(e,["parametersJsonSchema"],r);const a=o(t,["response"]);a!=null&&l(e,["response"],a);const u=o(t,["responseJsonSchema"]);return u!=null&&l(e,["responseJsonSchema"],u),e}function Hd(t,e){const n={},s=o(e,["name"]);return s!=null&&l(n,["_url","name"],Ue(t,s)),n}function Jd(t,e){const n={},s=o(e,["name"]);return s!=null&&l(n,["_url","name"],Ue(t,s)),n}function Wd(t){const e={};if(o(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=o(t,["enableWidget"]);return n!=null&&l(e,["enableWidget"],n),e}function Yd(t){const e={};if(o(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(o(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=o(t,["timeRangeFilter"]);return n!=null&&l(e,["timeRangeFilter"],n),e}function Kd(t,e){const n={},s=o(t,["pageSize"]);e!==void 0&&s!=null&&l(e,["_query","pageSize"],s);const i=o(t,["pageToken"]);return e!==void 0&&i!=null&&l(e,["_query","pageToken"],i),n}function zd(t,e){const n={},s=o(t,["pageSize"]);e!==void 0&&s!=null&&l(e,["_query","pageSize"],s);const i=o(t,["pageToken"]);return e!==void 0&&i!=null&&l(e,["_query","pageToken"],i),n}function Zd(t){const e={},n=o(t,["config"]);return n!=null&&Kd(n,e),e}function Xd(t){const e={},n=o(t,["config"]);return n!=null&&zd(n,e),e}function Qd(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["nextPageToken"]);s!=null&&l(e,["nextPageToken"],s);const i=o(t,["cachedContents"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(a=>a)),l(e,["cachedContents"],r)}return e}function jd(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["nextPageToken"]);s!=null&&l(e,["nextPageToken"],s);const i=o(t,["cachedContents"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(a=>a)),l(e,["cachedContents"],r)}return e}function ef(t){const e={},n=o(t,["functionCall"]);n!=null&&l(e,["functionCall"],n);const s=o(t,["codeExecutionResult"]);s!=null&&l(e,["codeExecutionResult"],s);const i=o(t,["executableCode"]);i!=null&&l(e,["executableCode"],i);const r=o(t,["fileData"]);r!=null&&l(e,["fileData"],Bd(r));const a=o(t,["functionResponse"]);a!=null&&l(e,["functionResponse"],a);const u=o(t,["inlineData"]);u!=null&&l(e,["inlineData"],bd(u));const d=o(t,["text"]);d!=null&&l(e,["text"],d);const c=o(t,["thought"]);c!=null&&l(e,["thought"],c);const f=o(t,["thoughtSignature"]);f!=null&&l(e,["thoughtSignature"],f);const p=o(t,["videoMetadata"]);return p!=null&&l(e,["videoMetadata"],p),e}function tf(t){const e={},n=o(t,["functionDeclarations"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(p=>p)),l(e,["functionDeclarations"],f)}if(o(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=o(t,["googleSearchRetrieval"]);s!=null&&l(e,["googleSearchRetrieval"],s);const i=o(t,["computerUse"]);i!=null&&l(e,["computerUse"],i);const r=o(t,["fileSearch"]);r!=null&&l(e,["fileSearch"],r);const a=o(t,["codeExecution"]);if(a!=null&&l(e,["codeExecution"],a),o(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const u=o(t,["googleMaps"]);u!=null&&l(e,["googleMaps"],Wd(u));const d=o(t,["googleSearch"]);d!=null&&l(e,["googleSearch"],Yd(d));const c=o(t,["urlContext"]);return c!=null&&l(e,["urlContext"],c),e}function nf(t){const e={},n=o(t,["functionDeclarations"]);if(n!=null){let p=n;Array.isArray(p)&&(p=p.map(h=>Od(h))),l(e,["functionDeclarations"],p)}const s=o(t,["retrieval"]);s!=null&&l(e,["retrieval"],s);const i=o(t,["googleSearchRetrieval"]);i!=null&&l(e,["googleSearchRetrieval"],i);const r=o(t,["computerUse"]);if(r!=null&&l(e,["computerUse"],r),o(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const a=o(t,["codeExecution"]);a!=null&&l(e,["codeExecution"],a);const u=o(t,["enterpriseWebSearch"]);u!=null&&l(e,["enterpriseWebSearch"],u);const d=o(t,["googleMaps"]);d!=null&&l(e,["googleMaps"],d);const c=o(t,["googleSearch"]);c!=null&&l(e,["googleSearch"],c);const f=o(t,["urlContext"]);return f!=null&&l(e,["urlContext"],f),e}function sf(t,e){const n={},s=o(t,["ttl"]);e!==void 0&&s!=null&&l(e,["ttl"],s);const i=o(t,["expireTime"]);return e!==void 0&&i!=null&&l(e,["expireTime"],i),n}function rf(t,e){const n={},s=o(t,["ttl"]);e!==void 0&&s!=null&&l(e,["ttl"],s);const i=o(t,["expireTime"]);return e!==void 0&&i!=null&&l(e,["expireTime"],i),n}function of(t,e){const n={},s=o(e,["name"]);s!=null&&l(n,["_url","name"],Ue(t,s));const i=o(e,["config"]);return i!=null&&sf(i,n),n}function af(t,e){const n={},s=o(e,["name"]);s!=null&&l(n,["_url","name"],Ue(t,s));const i=o(e,["config"]);return i!=null&&rf(i,n),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class lf extends De{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new nt(be.PAGED_ITEM_CACHED_CONTENTS,s=>this.listInternal(s),await this.listInternal(n),n)}async create(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=Ld(this.apiClient,e);return u=A("cachedContents",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(f=>f)}else{const c=Fd(this.apiClient,e);return u=A("cachedContents",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),a.then(f=>f)}}async get(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=Jd(this.apiClient,e);return u=A("{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(f=>f)}else{const c=Hd(this.apiClient,e);return u=A("{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),a.then(f=>f)}}async delete(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=Vd(this.apiClient,e);return u=A("{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=qd(f),h=new eo;return Object.assign(h,p),h})}else{const c=$d(this.apiClient,e);return u=A("{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=Gd(f),h=new eo;return Object.assign(h,p),h})}}async update(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=af(this.apiClient,e);return u=A("{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(f=>f)}else{const c=of(this.apiClient,e);return u=A("{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),a.then(f=>f)}}async listInternal(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=Xd(e);return u=A("cachedContents",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=jd(f),h=new to;return Object.assign(h,p),h})}else{const c=Zd(e);return u=A("cachedContents",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=Qd(f),h=new to;return Object.assign(h,p),h})}}}function lo(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],s=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function z(t){return this instanceof z?(this.v=t,this):new z(t)}function pt(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=n.apply(t,e||[]),i,r=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",a),i[Symbol.asyncIterator]=function(){return this},i;function a(m){return function(_){return Promise.resolve(_).then(m,p)}}function u(m,_){s[m]&&(i[m]=function(g){return new Promise(function(T,w){r.push([m,g,T,w])>1||d(m,g)})},_&&(i[m]=_(i[m])))}function d(m,_){try{c(s[m](_))}catch(g){h(r[0][3],g)}}function c(m){m.value instanceof z?Promise.resolve(m.value.v).then(f,p):h(r[0][2],m)}function f(m){d("next",m)}function p(m){d("throw",m)}function h(m,_){m(_),r.shift(),r.length&&d(r[0][0],r[0][1])}}function $t(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof lo=="function"?lo(t):t[Symbol.iterator](),n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n);function s(r){n[r]=t[r]&&function(a){return new Promise(function(u,d){a=t[r](a),i(u,d,a.done,a.value)})}}function i(r,a,u,d){Promise.resolve(d).then(function(c){r({value:c,done:u})},a)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function uf(t){var e;if(t.candidates==null||t.candidates.length===0)return!1;const n=(e=t.candidates[0])===null||e===void 0?void 0:e.content;return n===void 0?!1:Sa(n)}function Sa(t){if(t.parts===void 0||t.parts.length===0)return!1;for(const e of t.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function cf(t){if(t.length!==0){for(const e of t)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function uo(t){if(t===void 0||t.length===0)return[];const e=[],n=t.length;let s=0;for(;s<n;)if(t[s].role==="user")e.push(t[s]),s++;else{const i=[];let r=!0;for(;s<n&&t[s].role==="model";)i.push(t[s]),r&&!Sa(t[s])&&(r=!1),s++;r?e.push(...i):e.pop()}return e}class df{constructor(e,n){this.modelsModule=e,this.apiClient=n}create(e){return new ff(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}let ff=class{constructor(e,n,s,i={},r=[]){this.apiClient=e,this.modelsModule=n,this.model=s,this.config=i,this.history=r,this.sendPromise=Promise.resolve(),cf(r)}async sendMessage(e){var n;await this.sendPromise;const s=ae(e.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(s),config:(n=e.config)!==null&&n!==void 0?n:this.config});return this.sendPromise=(async()=>{var r,a,u;const d=await i,c=(a=(r=d.candidates)===null||r===void 0?void 0:r[0])===null||a===void 0?void 0:a.content,f=d.automaticFunctionCallingHistory,p=this.getHistory(!0).length;let h=[];f!=null&&(h=(u=f.slice(p))!==null&&u!==void 0?u:[]);const m=c?[c]:[];this.recordHistory(s,m,h)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),i}async sendMessageStream(e){var n;await this.sendPromise;const s=ae(e.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(s),config:(n=e.config)!==null&&n!==void 0?n:this.config});this.sendPromise=i.then(()=>{}).catch(()=>{});const r=await i;return this.processStreamResponse(r,s)}getHistory(e=!1){const n=e?uo(this.history):this.history;return structuredClone(n)}processStreamResponse(e,n){var s,i;return pt(this,arguments,function*(){var a,u,d,c;const f=[];try{for(var p=!0,h=$t(e),m;m=yield z(h.next()),a=m.done,!a;p=!0){c=m.value,p=!1;const _=c;if(uf(_)){const g=(i=(s=_.candidates)===null||s===void 0?void 0:s[0])===null||i===void 0?void 0:i.content;g!==void 0&&f.push(g)}yield yield z(_)}}catch(_){u={error:_}}finally{try{!p&&!a&&(d=h.return)&&(yield z(d.call(h)))}finally{if(u)throw u.error}}this.recordHistory(n,f)})}recordHistory(e,n,s){let i=[];n.length>0&&n.every(r=>r.role!==void 0)?i=n:i.push({role:"model",parts:[]}),s&&s.length>0?this.history.push(...uo(s)):this.history.push(e),this.history.push(...i)}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class bn extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,bn.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function pf(t){const e={},n=o(t,["file"]);return n!=null&&l(e,["file"],n),e}function hf(t){const e={},n=o(t,["sdkHttpResponse"]);return n!=null&&l(e,["sdkHttpResponse"],n),e}function mf(t){const e={},n=o(t,["name"]);return n!=null&&l(e,["_url","file"],ha(n)),e}function gf(t){const e={},n=o(t,["sdkHttpResponse"]);return n!=null&&l(e,["sdkHttpResponse"],n),e}function yf(t){const e={},n=o(t,["name"]);return n!=null&&l(e,["_url","file"],ha(n)),e}function _f(t,e){const n={},s=o(t,["pageSize"]);e!==void 0&&s!=null&&l(e,["_query","pageSize"],s);const i=o(t,["pageToken"]);return e!==void 0&&i!=null&&l(e,["_query","pageToken"],i),n}function Tf(t){const e={},n=o(t,["config"]);return n!=null&&_f(n,e),e}function vf(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["nextPageToken"]);s!=null&&l(e,["nextPageToken"],s);const i=o(t,["files"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(a=>a)),l(e,["files"],r)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let Sf=class extends De{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new nt(be.PAGED_ITEM_FILES,s=>this.listInternal(s),await this.listInternal(n),n)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(n=>n)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Tf(e);return r=A("files",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(c=>{const f=c;return f.sdkHttpResponse={headers:d.headers},f})),i.then(d=>{const c=vf(d),f=new Mc;return Object.assign(f,c),f})}}async createInternal(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=pf(e);return r=A("upload/v1beta/files",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>{const c=hf(d),f=new kc;return Object.assign(f,c),f})}}async get(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=yf(e);return r=A("files/{file}",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>d)}}async delete(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=mf(e);return r=A("files/{file}",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(c=>{const f=c;return f.sdkHttpResponse={headers:d.headers},f})),i.then(d=>{const c=gf(d),f=new bc;return Object.assign(f,c),f})}}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function dn(t){const e={},n=o(t,["data"]);if(n!=null&&l(e,["data"],n),o(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=o(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function Cf(t){const e={},n=o(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>Lf(r))),l(e,["parts"],i)}const s=o(t,["role"]);return s!=null&&l(e,["role"],s),e}function Ef(t){const e={};if(o(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=o(t,["fileUri"]);n!=null&&l(e,["fileUri"],n);const s=o(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function wf(t){const e={};if(o(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=o(t,["description"]);n!=null&&l(e,["description"],n);const s=o(t,["name"]);s!=null&&l(e,["name"],s);const i=o(t,["parameters"]);i!=null&&l(e,["parameters"],i);const r=o(t,["parametersJsonSchema"]);r!=null&&l(e,["parametersJsonSchema"],r);const a=o(t,["response"]);a!=null&&l(e,["response"],a);const u=o(t,["responseJsonSchema"]);return u!=null&&l(e,["responseJsonSchema"],u),e}function If(t){const e={},n=o(t,["modelSelectionConfig"]);n!=null&&l(e,["modelConfig"],n);const s=o(t,["responseJsonSchema"]);s!=null&&l(e,["responseJsonSchema"],s);const i=o(t,["audioTimestamp"]);i!=null&&l(e,["audioTimestamp"],i);const r=o(t,["candidateCount"]);r!=null&&l(e,["candidateCount"],r);const a=o(t,["enableAffectiveDialog"]);a!=null&&l(e,["enableAffectiveDialog"],a);const u=o(t,["frequencyPenalty"]);u!=null&&l(e,["frequencyPenalty"],u);const d=o(t,["logprobs"]);d!=null&&l(e,["logprobs"],d);const c=o(t,["maxOutputTokens"]);c!=null&&l(e,["maxOutputTokens"],c);const f=o(t,["mediaResolution"]);f!=null&&l(e,["mediaResolution"],f);const p=o(t,["presencePenalty"]);p!=null&&l(e,["presencePenalty"],p);const h=o(t,["responseLogprobs"]);h!=null&&l(e,["responseLogprobs"],h);const m=o(t,["responseMimeType"]);m!=null&&l(e,["responseMimeType"],m);const _=o(t,["responseModalities"]);_!=null&&l(e,["responseModalities"],_);const g=o(t,["responseSchema"]);g!=null&&l(e,["responseSchema"],g);const T=o(t,["routingConfig"]);T!=null&&l(e,["routingConfig"],T);const w=o(t,["seed"]);w!=null&&l(e,["seed"],w);const v=o(t,["speechConfig"]);v!=null&&l(e,["speechConfig"],Ca(v));const S=o(t,["stopSequences"]);S!=null&&l(e,["stopSequences"],S);const C=o(t,["temperature"]);C!=null&&l(e,["temperature"],C);const N=o(t,["thinkingConfig"]);N!=null&&l(e,["thinkingConfig"],N);const R=o(t,["topK"]);R!=null&&l(e,["topK"],R);const I=o(t,["topP"]);if(I!=null&&l(e,["topP"],I),o(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function Af(t){const e={};if(o(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=o(t,["enableWidget"]);return n!=null&&l(e,["enableWidget"],n),e}function Rf(t){const e={};if(o(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(o(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=o(t,["timeRangeFilter"]);return n!=null&&l(e,["timeRangeFilter"],n),e}function Pf(t,e){const n={},s=o(t,["generationConfig"]);e!==void 0&&s!=null&&l(e,["setup","generationConfig"],s);const i=o(t,["responseModalities"]);e!==void 0&&i!=null&&l(e,["setup","generationConfig","responseModalities"],i);const r=o(t,["temperature"]);e!==void 0&&r!=null&&l(e,["setup","generationConfig","temperature"],r);const a=o(t,["topP"]);e!==void 0&&a!=null&&l(e,["setup","generationConfig","topP"],a);const u=o(t,["topK"]);e!==void 0&&u!=null&&l(e,["setup","generationConfig","topK"],u);const d=o(t,["maxOutputTokens"]);e!==void 0&&d!=null&&l(e,["setup","generationConfig","maxOutputTokens"],d);const c=o(t,["mediaResolution"]);e!==void 0&&c!=null&&l(e,["setup","generationConfig","mediaResolution"],c);const f=o(t,["seed"]);e!==void 0&&f!=null&&l(e,["setup","generationConfig","seed"],f);const p=o(t,["speechConfig"]);e!==void 0&&p!=null&&l(e,["setup","generationConfig","speechConfig"],Zs(p));const h=o(t,["thinkingConfig"]);e!==void 0&&h!=null&&l(e,["setup","generationConfig","thinkingConfig"],h);const m=o(t,["enableAffectiveDialog"]);e!==void 0&&m!=null&&l(e,["setup","generationConfig","enableAffectiveDialog"],m);const _=o(t,["systemInstruction"]);e!==void 0&&_!=null&&l(e,["setup","systemInstruction"],Cf(ae(_)));const g=o(t,["tools"]);if(e!==void 0&&g!=null){let R=wt(g);Array.isArray(R)&&(R=R.map(I=>Vf(Et(I)))),l(e,["setup","tools"],R)}const T=o(t,["sessionResumption"]);e!==void 0&&T!=null&&l(e,["setup","sessionResumption"],$f(T));const w=o(t,["inputAudioTranscription"]);e!==void 0&&w!=null&&l(e,["setup","inputAudioTranscription"],w);const v=o(t,["outputAudioTranscription"]);e!==void 0&&v!=null&&l(e,["setup","outputAudioTranscription"],v);const S=o(t,["realtimeInputConfig"]);e!==void 0&&S!=null&&l(e,["setup","realtimeInputConfig"],S);const C=o(t,["contextWindowCompression"]);e!==void 0&&C!=null&&l(e,["setup","contextWindowCompression"],C);const N=o(t,["proactivity"]);return e!==void 0&&N!=null&&l(e,["setup","proactivity"],N),n}function xf(t,e){const n={},s=o(t,["generationConfig"]);e!==void 0&&s!=null&&l(e,["setup","generationConfig"],If(s));const i=o(t,["responseModalities"]);e!==void 0&&i!=null&&l(e,["setup","generationConfig","responseModalities"],i);const r=o(t,["temperature"]);e!==void 0&&r!=null&&l(e,["setup","generationConfig","temperature"],r);const a=o(t,["topP"]);e!==void 0&&a!=null&&l(e,["setup","generationConfig","topP"],a);const u=o(t,["topK"]);e!==void 0&&u!=null&&l(e,["setup","generationConfig","topK"],u);const d=o(t,["maxOutputTokens"]);e!==void 0&&d!=null&&l(e,["setup","generationConfig","maxOutputTokens"],d);const c=o(t,["mediaResolution"]);e!==void 0&&c!=null&&l(e,["setup","generationConfig","mediaResolution"],c);const f=o(t,["seed"]);e!==void 0&&f!=null&&l(e,["setup","generationConfig","seed"],f);const p=o(t,["speechConfig"]);e!==void 0&&p!=null&&l(e,["setup","generationConfig","speechConfig"],Ca(Zs(p)));const h=o(t,["thinkingConfig"]);e!==void 0&&h!=null&&l(e,["setup","generationConfig","thinkingConfig"],h);const m=o(t,["enableAffectiveDialog"]);e!==void 0&&m!=null&&l(e,["setup","generationConfig","enableAffectiveDialog"],m);const _=o(t,["systemInstruction"]);e!==void 0&&_!=null&&l(e,["setup","systemInstruction"],ae(_));const g=o(t,["tools"]);if(e!==void 0&&g!=null){let R=wt(g);Array.isArray(R)&&(R=R.map(I=>Gf(Et(I)))),l(e,["setup","tools"],R)}const T=o(t,["sessionResumption"]);e!==void 0&&T!=null&&l(e,["setup","sessionResumption"],T);const w=o(t,["inputAudioTranscription"]);e!==void 0&&w!=null&&l(e,["setup","inputAudioTranscription"],w);const v=o(t,["outputAudioTranscription"]);e!==void 0&&v!=null&&l(e,["setup","outputAudioTranscription"],v);const S=o(t,["realtimeInputConfig"]);e!==void 0&&S!=null&&l(e,["setup","realtimeInputConfig"],S);const C=o(t,["contextWindowCompression"]);e!==void 0&&C!=null&&l(e,["setup","contextWindowCompression"],C);const N=o(t,["proactivity"]);return e!==void 0&&N!=null&&l(e,["setup","proactivity"],N),n}function Nf(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["setup","model"],Y(t,s));const i=o(e,["config"]);return i!=null&&l(n,["config"],Pf(i,n)),n}function Mf(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["setup","model"],Y(t,s));const i=o(e,["config"]);return i!=null&&l(n,["config"],xf(i,n)),n}function kf(t){const e={},n=o(t,["musicGenerationConfig"]);return n!=null&&l(e,["musicGenerationConfig"],n),e}function bf(t){const e={},n=o(t,["weightedPrompts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(i=>i)),l(e,["weightedPrompts"],s)}return e}function Df(t){const e={},n=o(t,["media"]);if(n!=null){let c=ua(n);Array.isArray(c)&&(c=c.map(f=>dn(f))),l(e,["mediaChunks"],c)}const s=o(t,["audio"]);s!=null&&l(e,["audio"],dn(da(s)));const i=o(t,["audioStreamEnd"]);i!=null&&l(e,["audioStreamEnd"],i);const r=o(t,["video"]);r!=null&&l(e,["video"],dn(ca(r)));const a=o(t,["text"]);a!=null&&l(e,["text"],a);const u=o(t,["activityStart"]);u!=null&&l(e,["activityStart"],u);const d=o(t,["activityEnd"]);return d!=null&&l(e,["activityEnd"],d),e}function Uf(t){const e={},n=o(t,["media"]);if(n!=null){let c=ua(n);Array.isArray(c)&&(c=c.map(f=>f)),l(e,["mediaChunks"],c)}const s=o(t,["audio"]);s!=null&&l(e,["audio"],da(s));const i=o(t,["audioStreamEnd"]);i!=null&&l(e,["audioStreamEnd"],i);const r=o(t,["video"]);r!=null&&l(e,["video"],ca(r));const a=o(t,["text"]);a!=null&&l(e,["text"],a);const u=o(t,["activityStart"]);u!=null&&l(e,["activityStart"],u);const d=o(t,["activityEnd"]);return d!=null&&l(e,["activityEnd"],d),e}function Ff(t){const e={},n=o(t,["setupComplete"]);n!=null&&l(e,["setupComplete"],n);const s=o(t,["serverContent"]);s!=null&&l(e,["serverContent"],s);const i=o(t,["toolCall"]);i!=null&&l(e,["toolCall"],i);const r=o(t,["toolCallCancellation"]);r!=null&&l(e,["toolCallCancellation"],r);const a=o(t,["usageMetadata"]);a!=null&&l(e,["usageMetadata"],qf(a));const u=o(t,["goAway"]);u!=null&&l(e,["goAway"],u);const d=o(t,["sessionResumptionUpdate"]);return d!=null&&l(e,["sessionResumptionUpdate"],d),e}function Lf(t){const e={},n=o(t,["functionCall"]);n!=null&&l(e,["functionCall"],n);const s=o(t,["codeExecutionResult"]);s!=null&&l(e,["codeExecutionResult"],s);const i=o(t,["executableCode"]);i!=null&&l(e,["executableCode"],i);const r=o(t,["fileData"]);r!=null&&l(e,["fileData"],Ef(r));const a=o(t,["functionResponse"]);a!=null&&l(e,["functionResponse"],a);const u=o(t,["inlineData"]);u!=null&&l(e,["inlineData"],dn(u));const d=o(t,["text"]);d!=null&&l(e,["text"],d);const c=o(t,["thought"]);c!=null&&l(e,["thought"],c);const f=o(t,["thoughtSignature"]);f!=null&&l(e,["thoughtSignature"],f);const p=o(t,["videoMetadata"]);return p!=null&&l(e,["videoMetadata"],p),e}function $f(t){const e={},n=o(t,["handle"]);if(n!=null&&l(e,["handle"],n),o(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function Ca(t){const e={},n=o(t,["languageCode"]);n!=null&&l(e,["languageCode"],n);const s=o(t,["voiceConfig"]);if(s!=null&&l(e,["voiceConfig"],s),o(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function Vf(t){const e={},n=o(t,["functionDeclarations"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(p=>p)),l(e,["functionDeclarations"],f)}if(o(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=o(t,["googleSearchRetrieval"]);s!=null&&l(e,["googleSearchRetrieval"],s);const i=o(t,["computerUse"]);i!=null&&l(e,["computerUse"],i);const r=o(t,["fileSearch"]);r!=null&&l(e,["fileSearch"],r);const a=o(t,["codeExecution"]);if(a!=null&&l(e,["codeExecution"],a),o(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const u=o(t,["googleMaps"]);u!=null&&l(e,["googleMaps"],Af(u));const d=o(t,["googleSearch"]);d!=null&&l(e,["googleSearch"],Rf(d));const c=o(t,["urlContext"]);return c!=null&&l(e,["urlContext"],c),e}function Gf(t){const e={},n=o(t,["functionDeclarations"]);if(n!=null){let p=n;Array.isArray(p)&&(p=p.map(h=>wf(h))),l(e,["functionDeclarations"],p)}const s=o(t,["retrieval"]);s!=null&&l(e,["retrieval"],s);const i=o(t,["googleSearchRetrieval"]);i!=null&&l(e,["googleSearchRetrieval"],i);const r=o(t,["computerUse"]);if(r!=null&&l(e,["computerUse"],r),o(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const a=o(t,["codeExecution"]);a!=null&&l(e,["codeExecution"],a);const u=o(t,["enterpriseWebSearch"]);u!=null&&l(e,["enterpriseWebSearch"],u);const d=o(t,["googleMaps"]);d!=null&&l(e,["googleMaps"],d);const c=o(t,["googleSearch"]);c!=null&&l(e,["googleSearch"],c);const f=o(t,["urlContext"]);return f!=null&&l(e,["urlContext"],f),e}function qf(t){const e={},n=o(t,["promptTokenCount"]);n!=null&&l(e,["promptTokenCount"],n);const s=o(t,["cachedContentTokenCount"]);s!=null&&l(e,["cachedContentTokenCount"],s);const i=o(t,["candidatesTokenCount"]);i!=null&&l(e,["responseTokenCount"],i);const r=o(t,["toolUsePromptTokenCount"]);r!=null&&l(e,["toolUsePromptTokenCount"],r);const a=o(t,["thoughtsTokenCount"]);a!=null&&l(e,["thoughtsTokenCount"],a);const u=o(t,["totalTokenCount"]);u!=null&&l(e,["totalTokenCount"],u);const d=o(t,["promptTokensDetails"]);if(d!=null){let m=d;Array.isArray(m)&&(m=m.map(_=>_)),l(e,["promptTokensDetails"],m)}const c=o(t,["cacheTokensDetails"]);if(c!=null){let m=c;Array.isArray(m)&&(m=m.map(_=>_)),l(e,["cacheTokensDetails"],m)}const f=o(t,["candidatesTokensDetails"]);if(f!=null){let m=f;Array.isArray(m)&&(m=m.map(_=>_)),l(e,["responseTokensDetails"],m)}const p=o(t,["toolUsePromptTokensDetails"]);if(p!=null){let m=p;Array.isArray(m)&&(m=m.map(_=>_)),l(e,["toolUsePromptTokensDetails"],m)}const h=o(t,["trafficType"]);return h!=null&&l(e,["trafficType"],h),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Bf(t){const e={},n=o(t,["data"]);if(n!=null&&l(e,["data"],n),o(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=o(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function Of(t){const e={},n=o(t,["content"]);n!=null&&l(e,["content"],n);const s=o(t,["citationMetadata"]);s!=null&&l(e,["citationMetadata"],Hf(s));const i=o(t,["tokenCount"]);i!=null&&l(e,["tokenCount"],i);const r=o(t,["finishReason"]);r!=null&&l(e,["finishReason"],r);const a=o(t,["avgLogprobs"]);a!=null&&l(e,["avgLogprobs"],a);const u=o(t,["groundingMetadata"]);u!=null&&l(e,["groundingMetadata"],u);const d=o(t,["index"]);d!=null&&l(e,["index"],d);const c=o(t,["logprobsResult"]);c!=null&&l(e,["logprobsResult"],c);const f=o(t,["safetyRatings"]);if(f!=null){let h=f;Array.isArray(h)&&(h=h.map(m=>m)),l(e,["safetyRatings"],h)}const p=o(t,["urlContextMetadata"]);return p!=null&&l(e,["urlContextMetadata"],p),e}function Hf(t){const e={},n=o(t,["citationSources"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(i=>i)),l(e,["citations"],s)}return e}function Jf(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["contents"]);if(i!=null){let r=ye(i);Array.isArray(r)&&(r=r.map(a=>a)),l(n,["contents"],r)}return n}function Wf(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["tokensInfo"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(r=>r)),l(e,["tokensInfo"],i)}return e}function Yf(t){const e={},n=o(t,["values"]);n!=null&&l(e,["values"],n);const s=o(t,["statistics"]);return s!=null&&l(e,["statistics"],Kf(s)),e}function Kf(t){const e={},n=o(t,["truncated"]);n!=null&&l(e,["truncated"],n);const s=o(t,["token_count"]);return s!=null&&l(e,["tokenCount"],s),e}function Dn(t){const e={},n=o(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>jp(r))),l(e,["parts"],i)}const s=o(t,["role"]);return s!=null&&l(e,["role"],s),e}function zf(t){const e={},n=o(t,["controlType"]);n!=null&&l(e,["controlType"],n);const s=o(t,["enableControlImageComputation"]);return s!=null&&l(e,["computeControl"],s),e}function Zf(t){const e={};if(o(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(o(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(o(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function Xf(t,e){const n={},s=o(t,["systemInstruction"]);e!==void 0&&s!=null&&l(e,["systemInstruction"],ae(s));const i=o(t,["tools"]);if(e!==void 0&&i!=null){let a=i;Array.isArray(a)&&(a=a.map(u=>Ra(u))),l(e,["tools"],a)}const r=o(t,["generationConfig"]);return e!==void 0&&r!=null&&l(e,["generationConfig"],Gp(r)),n}function Qf(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["contents"]);if(i!=null){let a=ye(i);Array.isArray(a)&&(a=a.map(u=>Dn(u))),l(n,["contents"],a)}const r=o(e,["config"]);return r!=null&&Zf(r),n}function jf(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["contents"]);if(i!=null){let a=ye(i);Array.isArray(a)&&(a=a.map(u=>u)),l(n,["contents"],a)}const r=o(e,["config"]);return r!=null&&Xf(r,n),n}function ep(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["totalTokens"]);s!=null&&l(e,["totalTokens"],s);const i=o(t,["cachedContentTokenCount"]);return i!=null&&l(e,["cachedContentTokenCount"],i),e}function tp(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["totalTokens"]);return s!=null&&l(e,["totalTokens"],s),e}function np(t,e){const n={},s=o(e,["model"]);return s!=null&&l(n,["_url","name"],Y(t,s)),n}function sp(t,e){const n={},s=o(e,["model"]);return s!=null&&l(n,["_url","name"],Y(t,s)),n}function ip(t){const e={},n=o(t,["sdkHttpResponse"]);return n!=null&&l(e,["sdkHttpResponse"],n),e}function rp(t){const e={},n=o(t,["sdkHttpResponse"]);return n!=null&&l(e,["sdkHttpResponse"],n),e}function op(t,e){const n={},s=o(t,["outputGcsUri"]);e!==void 0&&s!=null&&l(e,["parameters","storageUri"],s);const i=o(t,["negativePrompt"]);e!==void 0&&i!=null&&l(e,["parameters","negativePrompt"],i);const r=o(t,["numberOfImages"]);e!==void 0&&r!=null&&l(e,["parameters","sampleCount"],r);const a=o(t,["aspectRatio"]);e!==void 0&&a!=null&&l(e,["parameters","aspectRatio"],a);const u=o(t,["guidanceScale"]);e!==void 0&&u!=null&&l(e,["parameters","guidanceScale"],u);const d=o(t,["seed"]);e!==void 0&&d!=null&&l(e,["parameters","seed"],d);const c=o(t,["safetyFilterLevel"]);e!==void 0&&c!=null&&l(e,["parameters","safetySetting"],c);const f=o(t,["personGeneration"]);e!==void 0&&f!=null&&l(e,["parameters","personGeneration"],f);const p=o(t,["includeSafetyAttributes"]);e!==void 0&&p!=null&&l(e,["parameters","includeSafetyAttributes"],p);const h=o(t,["includeRaiReason"]);e!==void 0&&h!=null&&l(e,["parameters","includeRaiReason"],h);const m=o(t,["language"]);e!==void 0&&m!=null&&l(e,["parameters","language"],m);const _=o(t,["outputMimeType"]);e!==void 0&&_!=null&&l(e,["parameters","outputOptions","mimeType"],_);const g=o(t,["outputCompressionQuality"]);e!==void 0&&g!=null&&l(e,["parameters","outputOptions","compressionQuality"],g);const T=o(t,["addWatermark"]);e!==void 0&&T!=null&&l(e,["parameters","addWatermark"],T);const w=o(t,["labels"]);e!==void 0&&w!=null&&l(e,["labels"],w);const v=o(t,["editMode"]);e!==void 0&&v!=null&&l(e,["parameters","editMode"],v);const S=o(t,["baseSteps"]);return e!==void 0&&S!=null&&l(e,["parameters","editConfig","baseSteps"],S),n}function ap(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["prompt"]);i!=null&&l(n,["instances[0]","prompt"],i);const r=o(e,["referenceImages"]);if(r!=null){let u=r;Array.isArray(u)&&(u=u.map(d=>rh(d))),l(n,["instances[0]","referenceImages"],u)}const a=o(e,["config"]);return a!=null&&op(a,n),n}function lp(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["predictions"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(r=>Un(r))),l(e,["generatedImages"],i)}return e}function up(t,e){const n={},s=o(t,["taskType"]);e!==void 0&&s!=null&&l(e,["requests[]","taskType"],s);const i=o(t,["title"]);e!==void 0&&i!=null&&l(e,["requests[]","title"],i);const r=o(t,["outputDimensionality"]);if(e!==void 0&&r!=null&&l(e,["requests[]","outputDimensionality"],r),o(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(o(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function cp(t,e){const n={},s=o(t,["taskType"]);e!==void 0&&s!=null&&l(e,["instances[]","task_type"],s);const i=o(t,["title"]);e!==void 0&&i!=null&&l(e,["instances[]","title"],i);const r=o(t,["outputDimensionality"]);e!==void 0&&r!=null&&l(e,["parameters","outputDimensionality"],r);const a=o(t,["mimeType"]);e!==void 0&&a!=null&&l(e,["instances[]","mimeType"],a);const u=o(t,["autoTruncate"]);return e!==void 0&&u!=null&&l(e,["parameters","autoTruncate"],u),n}function dp(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["contents"]);if(i!=null){let u=Ys(t,i);Array.isArray(u)&&(u=u.map(d=>d)),l(n,["requests[]","content"],u)}const r=o(e,["config"]);r!=null&&up(r,n);const a=o(e,["model"]);return a!==void 0&&l(n,["requests[]","model"],Y(t,a)),n}function fp(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["contents"]);if(i!=null){let a=Ys(t,i);Array.isArray(a)&&(a=a.map(u=>u)),l(n,["instances[]","content"],a)}const r=o(e,["config"]);return r!=null&&cp(r,n),n}function pp(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["embeddings"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>a)),l(e,["embeddings"],r)}const i=o(t,["metadata"]);return i!=null&&l(e,["metadata"],i),e}function hp(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["predictions[]","embeddings"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>Yf(a))),l(e,["embeddings"],r)}const i=o(t,["metadata"]);return i!=null&&l(e,["metadata"],i),e}function mp(t){const e={},n=o(t,["endpoint"]);n!=null&&l(e,["name"],n);const s=o(t,["deployedModelId"]);return s!=null&&l(e,["deployedModelId"],s),e}function gp(t){const e={};if(o(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=o(t,["fileUri"]);n!=null&&l(e,["fileUri"],n);const s=o(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function yp(t){const e={};if(o(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=o(t,["description"]);n!=null&&l(e,["description"],n);const s=o(t,["name"]);s!=null&&l(e,["name"],s);const i=o(t,["parameters"]);i!=null&&l(e,["parameters"],i);const r=o(t,["parametersJsonSchema"]);r!=null&&l(e,["parametersJsonSchema"],r);const a=o(t,["response"]);a!=null&&l(e,["response"],a);const u=o(t,["responseJsonSchema"]);return u!=null&&l(e,["responseJsonSchema"],u),e}function _p(t,e,n){const s={},i=o(e,["systemInstruction"]);n!==void 0&&i!=null&&l(n,["systemInstruction"],Dn(ae(i)));const r=o(e,["temperature"]);r!=null&&l(s,["temperature"],r);const a=o(e,["topP"]);a!=null&&l(s,["topP"],a);const u=o(e,["topK"]);u!=null&&l(s,["topK"],u);const d=o(e,["candidateCount"]);d!=null&&l(s,["candidateCount"],d);const c=o(e,["maxOutputTokens"]);c!=null&&l(s,["maxOutputTokens"],c);const f=o(e,["stopSequences"]);f!=null&&l(s,["stopSequences"],f);const p=o(e,["responseLogprobs"]);p!=null&&l(s,["responseLogprobs"],p);const h=o(e,["logprobs"]);h!=null&&l(s,["logprobs"],h);const m=o(e,["presencePenalty"]);m!=null&&l(s,["presencePenalty"],m);const _=o(e,["frequencyPenalty"]);_!=null&&l(s,["frequencyPenalty"],_);const g=o(e,["seed"]);g!=null&&l(s,["seed"],g);const T=o(e,["responseMimeType"]);T!=null&&l(s,["responseMimeType"],T);const w=o(e,["responseSchema"]);w!=null&&l(s,["responseSchema"],Ks(w));const v=o(e,["responseJsonSchema"]);if(v!=null&&l(s,["responseJsonSchema"],v),o(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(o(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const S=o(e,["safetySettings"]);if(n!==void 0&&S!=null){let O=S;Array.isArray(O)&&(O=O.map(Q=>oh(Q))),l(n,["safetySettings"],O)}const C=o(e,["tools"]);if(n!==void 0&&C!=null){let O=wt(C);Array.isArray(O)&&(O=O.map(Q=>fh(Et(Q)))),l(n,["tools"],O)}const N=o(e,["toolConfig"]);if(n!==void 0&&N!=null&&l(n,["toolConfig"],N),o(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const R=o(e,["cachedContent"]);n!==void 0&&R!=null&&l(n,["cachedContent"],Ue(t,R));const I=o(e,["responseModalities"]);I!=null&&l(s,["responseModalities"],I);const q=o(e,["mediaResolution"]);q!=null&&l(s,["mediaResolution"],q);const P=o(e,["speechConfig"]);if(P!=null&&l(s,["speechConfig"],zs(P)),o(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const M=o(e,["thinkingConfig"]);M!=null&&l(s,["thinkingConfig"],M);const U=o(e,["imageConfig"]);return U!=null&&l(s,["imageConfig"],U),s}function Tp(t,e,n){const s={},i=o(e,["systemInstruction"]);n!==void 0&&i!=null&&l(n,["systemInstruction"],ae(i));const r=o(e,["temperature"]);r!=null&&l(s,["temperature"],r);const a=o(e,["topP"]);a!=null&&l(s,["topP"],a);const u=o(e,["topK"]);u!=null&&l(s,["topK"],u);const d=o(e,["candidateCount"]);d!=null&&l(s,["candidateCount"],d);const c=o(e,["maxOutputTokens"]);c!=null&&l(s,["maxOutputTokens"],c);const f=o(e,["stopSequences"]);f!=null&&l(s,["stopSequences"],f);const p=o(e,["responseLogprobs"]);p!=null&&l(s,["responseLogprobs"],p);const h=o(e,["logprobs"]);h!=null&&l(s,["logprobs"],h);const m=o(e,["presencePenalty"]);m!=null&&l(s,["presencePenalty"],m);const _=o(e,["frequencyPenalty"]);_!=null&&l(s,["frequencyPenalty"],_);const g=o(e,["seed"]);g!=null&&l(s,["seed"],g);const T=o(e,["responseMimeType"]);T!=null&&l(s,["responseMimeType"],T);const w=o(e,["responseSchema"]);w!=null&&l(s,["responseSchema"],Ks(w));const v=o(e,["responseJsonSchema"]);v!=null&&l(s,["responseJsonSchema"],v);const S=o(e,["routingConfig"]);S!=null&&l(s,["routingConfig"],S);const C=o(e,["modelSelectionConfig"]);C!=null&&l(s,["modelConfig"],C);const N=o(e,["safetySettings"]);if(n!==void 0&&N!=null){let xe=N;Array.isArray(xe)&&(xe=xe.map(Xn=>Xn)),l(n,["safetySettings"],xe)}const R=o(e,["tools"]);if(n!==void 0&&R!=null){let xe=wt(R);Array.isArray(xe)&&(xe=xe.map(Xn=>Ra(Et(Xn)))),l(n,["tools"],xe)}const I=o(e,["toolConfig"]);n!==void 0&&I!=null&&l(n,["toolConfig"],I);const q=o(e,["labels"]);n!==void 0&&q!=null&&l(n,["labels"],q);const P=o(e,["cachedContent"]);n!==void 0&&P!=null&&l(n,["cachedContent"],Ue(t,P));const M=o(e,["responseModalities"]);M!=null&&l(s,["responseModalities"],M);const U=o(e,["mediaResolution"]);U!=null&&l(s,["mediaResolution"],U);const O=o(e,["speechConfig"]);O!=null&&l(s,["speechConfig"],Aa(zs(O)));const Q=o(e,["audioTimestamp"]);Q!=null&&l(s,["audioTimestamp"],Q);const H=o(e,["thinkingConfig"]);H!=null&&l(s,["thinkingConfig"],H);const pe=o(e,["imageConfig"]);return pe!=null&&l(s,["imageConfig"],pe),s}function co(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["contents"]);if(i!=null){let a=ye(i);Array.isArray(a)&&(a=a.map(u=>Dn(u))),l(n,["contents"],a)}const r=o(e,["config"]);return r!=null&&l(n,["generationConfig"],_p(t,r,n)),n}function fo(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["contents"]);if(i!=null){let a=ye(i);Array.isArray(a)&&(a=a.map(u=>u)),l(n,["contents"],a)}const r=o(e,["config"]);return r!=null&&l(n,["generationConfig"],Tp(t,r,n)),n}function po(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["candidates"]);if(s!=null){let d=s;Array.isArray(d)&&(d=d.map(c=>Of(c))),l(e,["candidates"],d)}const i=o(t,["modelVersion"]);i!=null&&l(e,["modelVersion"],i);const r=o(t,["promptFeedback"]);r!=null&&l(e,["promptFeedback"],r);const a=o(t,["responseId"]);a!=null&&l(e,["responseId"],a);const u=o(t,["usageMetadata"]);return u!=null&&l(e,["usageMetadata"],u),e}function ho(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["candidates"]);if(s!=null){let c=s;Array.isArray(c)&&(c=c.map(f=>f)),l(e,["candidates"],c)}const i=o(t,["createTime"]);i!=null&&l(e,["createTime"],i);const r=o(t,["modelVersion"]);r!=null&&l(e,["modelVersion"],r);const a=o(t,["promptFeedback"]);a!=null&&l(e,["promptFeedback"],a);const u=o(t,["responseId"]);u!=null&&l(e,["responseId"],u);const d=o(t,["usageMetadata"]);return d!=null&&l(e,["usageMetadata"],d),e}function vp(t,e){const n={};if(o(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(o(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const s=o(t,["numberOfImages"]);e!==void 0&&s!=null&&l(e,["parameters","sampleCount"],s);const i=o(t,["aspectRatio"]);e!==void 0&&i!=null&&l(e,["parameters","aspectRatio"],i);const r=o(t,["guidanceScale"]);if(e!==void 0&&r!=null&&l(e,["parameters","guidanceScale"],r),o(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const a=o(t,["safetyFilterLevel"]);e!==void 0&&a!=null&&l(e,["parameters","safetySetting"],a);const u=o(t,["personGeneration"]);e!==void 0&&u!=null&&l(e,["parameters","personGeneration"],u);const d=o(t,["includeSafetyAttributes"]);e!==void 0&&d!=null&&l(e,["parameters","includeSafetyAttributes"],d);const c=o(t,["includeRaiReason"]);e!==void 0&&c!=null&&l(e,["parameters","includeRaiReason"],c);const f=o(t,["language"]);e!==void 0&&f!=null&&l(e,["parameters","language"],f);const p=o(t,["outputMimeType"]);e!==void 0&&p!=null&&l(e,["parameters","outputOptions","mimeType"],p);const h=o(t,["outputCompressionQuality"]);if(e!==void 0&&h!=null&&l(e,["parameters","outputOptions","compressionQuality"],h),o(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(o(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const m=o(t,["imageSize"]);if(e!==void 0&&m!=null&&l(e,["parameters","sampleImageSize"],m),o(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function Sp(t,e){const n={},s=o(t,["outputGcsUri"]);e!==void 0&&s!=null&&l(e,["parameters","storageUri"],s);const i=o(t,["negativePrompt"]);e!==void 0&&i!=null&&l(e,["parameters","negativePrompt"],i);const r=o(t,["numberOfImages"]);e!==void 0&&r!=null&&l(e,["parameters","sampleCount"],r);const a=o(t,["aspectRatio"]);e!==void 0&&a!=null&&l(e,["parameters","aspectRatio"],a);const u=o(t,["guidanceScale"]);e!==void 0&&u!=null&&l(e,["parameters","guidanceScale"],u);const d=o(t,["seed"]);e!==void 0&&d!=null&&l(e,["parameters","seed"],d);const c=o(t,["safetyFilterLevel"]);e!==void 0&&c!=null&&l(e,["parameters","safetySetting"],c);const f=o(t,["personGeneration"]);e!==void 0&&f!=null&&l(e,["parameters","personGeneration"],f);const p=o(t,["includeSafetyAttributes"]);e!==void 0&&p!=null&&l(e,["parameters","includeSafetyAttributes"],p);const h=o(t,["includeRaiReason"]);e!==void 0&&h!=null&&l(e,["parameters","includeRaiReason"],h);const m=o(t,["language"]);e!==void 0&&m!=null&&l(e,["parameters","language"],m);const _=o(t,["outputMimeType"]);e!==void 0&&_!=null&&l(e,["parameters","outputOptions","mimeType"],_);const g=o(t,["outputCompressionQuality"]);e!==void 0&&g!=null&&l(e,["parameters","outputOptions","compressionQuality"],g);const T=o(t,["addWatermark"]);e!==void 0&&T!=null&&l(e,["parameters","addWatermark"],T);const w=o(t,["labels"]);e!==void 0&&w!=null&&l(e,["labels"],w);const v=o(t,["imageSize"]);e!==void 0&&v!=null&&l(e,["parameters","sampleImageSize"],v);const S=o(t,["enhancePrompt"]);return e!==void 0&&S!=null&&l(e,["parameters","enhancePrompt"],S),n}function Cp(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["prompt"]);i!=null&&l(n,["instances[0]","prompt"],i);const r=o(e,["config"]);return r!=null&&vp(r,n),n}function Ep(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["prompt"]);i!=null&&l(n,["instances[0]","prompt"],i);const r=o(e,["config"]);return r!=null&&Sp(r,n),n}function wp(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["predictions"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>Fp(a))),l(e,["generatedImages"],r)}const i=o(t,["positivePromptSafetyAttributes"]);return i!=null&&l(e,["positivePromptSafetyAttributes"],wa(i)),e}function Ip(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["predictions"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>Un(a))),l(e,["generatedImages"],r)}const i=o(t,["positivePromptSafetyAttributes"]);return i!=null&&l(e,["positivePromptSafetyAttributes"],Ia(i)),e}function Ap(t,e){const n={},s=o(t,["numberOfVideos"]);if(e!==void 0&&s!=null&&l(e,["parameters","sampleCount"],s),o(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(o(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const i=o(t,["durationSeconds"]);if(e!==void 0&&i!=null&&l(e,["parameters","durationSeconds"],i),o(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const r=o(t,["aspectRatio"]);e!==void 0&&r!=null&&l(e,["parameters","aspectRatio"],r);const a=o(t,["resolution"]);e!==void 0&&a!=null&&l(e,["parameters","resolution"],a);const u=o(t,["personGeneration"]);if(e!==void 0&&u!=null&&l(e,["parameters","personGeneration"],u),o(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const d=o(t,["negativePrompt"]);e!==void 0&&d!=null&&l(e,["parameters","negativePrompt"],d);const c=o(t,["enhancePrompt"]);if(e!==void 0&&c!=null&&l(e,["parameters","enhancePrompt"],c),o(t,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const f=o(t,["lastFrame"]);e!==void 0&&f!=null&&l(e,["instances[0]","lastFrame"],Fn(f));const p=o(t,["referenceImages"]);if(e!==void 0&&p!=null){let h=p;Array.isArray(h)&&(h=h.map(m=>Ih(m))),l(e,["instances[0]","referenceImages"],h)}if(o(t,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(o(t,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return n}function Rp(t,e){const n={},s=o(t,["numberOfVideos"]);e!==void 0&&s!=null&&l(e,["parameters","sampleCount"],s);const i=o(t,["outputGcsUri"]);e!==void 0&&i!=null&&l(e,["parameters","storageUri"],i);const r=o(t,["fps"]);e!==void 0&&r!=null&&l(e,["parameters","fps"],r);const a=o(t,["durationSeconds"]);e!==void 0&&a!=null&&l(e,["parameters","durationSeconds"],a);const u=o(t,["seed"]);e!==void 0&&u!=null&&l(e,["parameters","seed"],u);const d=o(t,["aspectRatio"]);e!==void 0&&d!=null&&l(e,["parameters","aspectRatio"],d);const c=o(t,["resolution"]);e!==void 0&&c!=null&&l(e,["parameters","resolution"],c);const f=o(t,["personGeneration"]);e!==void 0&&f!=null&&l(e,["parameters","personGeneration"],f);const p=o(t,["pubsubTopic"]);e!==void 0&&p!=null&&l(e,["parameters","pubsubTopic"],p);const h=o(t,["negativePrompt"]);e!==void 0&&h!=null&&l(e,["parameters","negativePrompt"],h);const m=o(t,["enhancePrompt"]);e!==void 0&&m!=null&&l(e,["parameters","enhancePrompt"],m);const _=o(t,["generateAudio"]);e!==void 0&&_!=null&&l(e,["parameters","generateAudio"],_);const g=o(t,["lastFrame"]);e!==void 0&&g!=null&&l(e,["instances[0]","lastFrame"],Ce(g));const T=o(t,["referenceImages"]);if(e!==void 0&&T!=null){let S=T;Array.isArray(S)&&(S=S.map(C=>Ah(C))),l(e,["instances[0]","referenceImages"],S)}const w=o(t,["mask"]);e!==void 0&&w!=null&&l(e,["instances[0]","mask"],wh(w));const v=o(t,["compressionQuality"]);return e!==void 0&&v!=null&&l(e,["parameters","compressionQuality"],v),n}function Pp(t){const e={},n=o(t,["name"]);n!=null&&l(e,["name"],n);const s=o(t,["metadata"]);s!=null&&l(e,["metadata"],s);const i=o(t,["done"]);i!=null&&l(e,["done"],i);const r=o(t,["error"]);r!=null&&l(e,["error"],r);const a=o(t,["response","generateVideoResponse"]);return a!=null&&l(e,["response"],kp(a)),e}function xp(t){const e={},n=o(t,["name"]);n!=null&&l(e,["name"],n);const s=o(t,["metadata"]);s!=null&&l(e,["metadata"],s);const i=o(t,["done"]);i!=null&&l(e,["done"],i);const r=o(t,["error"]);r!=null&&l(e,["error"],r);const a=o(t,["response"]);return a!=null&&l(e,["response"],bp(a)),e}function Np(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["prompt"]);i!=null&&l(n,["instances[0]","prompt"],i);const r=o(e,["image"]);r!=null&&l(n,["instances[0]","image"],Fn(r));const a=o(e,["video"]);a!=null&&l(n,["instances[0]","video"],Pa(a));const u=o(e,["source"]);u!=null&&Dp(u,n);const d=o(e,["config"]);return d!=null&&Ap(d,n),n}function Mp(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["prompt"]);i!=null&&l(n,["instances[0]","prompt"],i);const r=o(e,["image"]);r!=null&&l(n,["instances[0]","image"],Ce(r));const a=o(e,["video"]);a!=null&&l(n,["instances[0]","video"],xa(a));const u=o(e,["source"]);u!=null&&Up(u,n);const d=o(e,["config"]);return d!=null&&Rp(d,n),n}function kp(t){const e={},n=o(t,["generatedSamples"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>$p(a))),l(e,["generatedVideos"],r)}const s=o(t,["raiMediaFilteredCount"]);s!=null&&l(e,["raiMediaFilteredCount"],s);const i=o(t,["raiMediaFilteredReasons"]);return i!=null&&l(e,["raiMediaFilteredReasons"],i),e}function bp(t){const e={},n=o(t,["videos"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>Vp(a))),l(e,["generatedVideos"],r)}const s=o(t,["raiMediaFilteredCount"]);s!=null&&l(e,["raiMediaFilteredCount"],s);const i=o(t,["raiMediaFilteredReasons"]);return i!=null&&l(e,["raiMediaFilteredReasons"],i),e}function Dp(t,e){const n={},s=o(t,["prompt"]);e!==void 0&&s!=null&&l(e,["instances[0]","prompt"],s);const i=o(t,["image"]);e!==void 0&&i!=null&&l(e,["instances[0]","image"],Fn(i));const r=o(t,["video"]);return e!==void 0&&r!=null&&l(e,["instances[0]","video"],Pa(r)),n}function Up(t,e){const n={},s=o(t,["prompt"]);e!==void 0&&s!=null&&l(e,["instances[0]","prompt"],s);const i=o(t,["image"]);e!==void 0&&i!=null&&l(e,["instances[0]","image"],Ce(i));const r=o(t,["video"]);return e!==void 0&&r!=null&&l(e,["instances[0]","video"],xa(r)),n}function Fp(t){const e={},n=o(t,["_self"]);n!=null&&l(e,["image"],Jp(n));const s=o(t,["raiFilteredReason"]);s!=null&&l(e,["raiFilteredReason"],s);const i=o(t,["_self"]);return i!=null&&l(e,["safetyAttributes"],wa(i)),e}function Un(t){const e={},n=o(t,["_self"]);n!=null&&l(e,["image"],Ea(n));const s=o(t,["raiFilteredReason"]);s!=null&&l(e,["raiFilteredReason"],s);const i=o(t,["_self"]);i!=null&&l(e,["safetyAttributes"],Ia(i));const r=o(t,["prompt"]);return r!=null&&l(e,["enhancedPrompt"],r),e}function Lp(t){const e={},n=o(t,["_self"]);n!=null&&l(e,["mask"],Ea(n));const s=o(t,["labels"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(r=>r)),l(e,["labels"],i)}return e}function $p(t){const e={},n=o(t,["video"]);return n!=null&&l(e,["video"],Ch(n)),e}function Vp(t){const e={},n=o(t,["_self"]);return n!=null&&l(e,["video"],Eh(n)),e}function Gp(t){const e={},n=o(t,["modelSelectionConfig"]);n!=null&&l(e,["modelConfig"],n);const s=o(t,["responseJsonSchema"]);s!=null&&l(e,["responseJsonSchema"],s);const i=o(t,["audioTimestamp"]);i!=null&&l(e,["audioTimestamp"],i);const r=o(t,["candidateCount"]);r!=null&&l(e,["candidateCount"],r);const a=o(t,["enableAffectiveDialog"]);a!=null&&l(e,["enableAffectiveDialog"],a);const u=o(t,["frequencyPenalty"]);u!=null&&l(e,["frequencyPenalty"],u);const d=o(t,["logprobs"]);d!=null&&l(e,["logprobs"],d);const c=o(t,["maxOutputTokens"]);c!=null&&l(e,["maxOutputTokens"],c);const f=o(t,["mediaResolution"]);f!=null&&l(e,["mediaResolution"],f);const p=o(t,["presencePenalty"]);p!=null&&l(e,["presencePenalty"],p);const h=o(t,["responseLogprobs"]);h!=null&&l(e,["responseLogprobs"],h);const m=o(t,["responseMimeType"]);m!=null&&l(e,["responseMimeType"],m);const _=o(t,["responseModalities"]);_!=null&&l(e,["responseModalities"],_);const g=o(t,["responseSchema"]);g!=null&&l(e,["responseSchema"],g);const T=o(t,["routingConfig"]);T!=null&&l(e,["routingConfig"],T);const w=o(t,["seed"]);w!=null&&l(e,["seed"],w);const v=o(t,["speechConfig"]);v!=null&&l(e,["speechConfig"],Aa(v));const S=o(t,["stopSequences"]);S!=null&&l(e,["stopSequences"],S);const C=o(t,["temperature"]);C!=null&&l(e,["temperature"],C);const N=o(t,["thinkingConfig"]);N!=null&&l(e,["thinkingConfig"],N);const R=o(t,["topK"]);R!=null&&l(e,["topK"],R);const I=o(t,["topP"]);if(I!=null&&l(e,["topP"],I),o(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function qp(t,e){const n={},s=o(e,["model"]);return s!=null&&l(n,["_url","name"],Y(t,s)),n}function Bp(t,e){const n={},s=o(e,["model"]);return s!=null&&l(n,["_url","name"],Y(t,s)),n}function Op(t){const e={};if(o(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=o(t,["enableWidget"]);return n!=null&&l(e,["enableWidget"],n),e}function Hp(t){const e={};if(o(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(o(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=o(t,["timeRangeFilter"]);return n!=null&&l(e,["timeRangeFilter"],n),e}function Jp(t){const e={},n=o(t,["bytesBase64Encoded"]);n!=null&&l(e,["imageBytes"],Ke(n));const s=o(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function Ea(t){const e={},n=o(t,["gcsUri"]);n!=null&&l(e,["gcsUri"],n);const s=o(t,["bytesBase64Encoded"]);s!=null&&l(e,["imageBytes"],Ke(s));const i=o(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function Fn(t){const e={};if(o(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=o(t,["imageBytes"]);n!=null&&l(e,["bytesBase64Encoded"],Ke(n));const s=o(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function Ce(t){const e={},n=o(t,["gcsUri"]);n!=null&&l(e,["gcsUri"],n);const s=o(t,["imageBytes"]);s!=null&&l(e,["bytesBase64Encoded"],Ke(s));const i=o(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function Wp(t,e,n){const s={},i=o(e,["pageSize"]);n!==void 0&&i!=null&&l(n,["_query","pageSize"],i);const r=o(e,["pageToken"]);n!==void 0&&r!=null&&l(n,["_query","pageToken"],r);const a=o(e,["filter"]);n!==void 0&&a!=null&&l(n,["_query","filter"],a);const u=o(e,["queryBase"]);return n!==void 0&&u!=null&&l(n,["_url","models_url"],ma(t,u)),s}function Yp(t,e,n){const s={},i=o(e,["pageSize"]);n!==void 0&&i!=null&&l(n,["_query","pageSize"],i);const r=o(e,["pageToken"]);n!==void 0&&r!=null&&l(n,["_query","pageToken"],r);const a=o(e,["filter"]);n!==void 0&&a!=null&&l(n,["_query","filter"],a);const u=o(e,["queryBase"]);return n!==void 0&&u!=null&&l(n,["_url","models_url"],ma(t,u)),s}function Kp(t,e){const n={},s=o(e,["config"]);return s!=null&&Wp(t,s,n),n}function zp(t,e){const n={},s=o(e,["config"]);return s!=null&&Yp(t,s,n),n}function Zp(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["nextPageToken"]);s!=null&&l(e,["nextPageToken"],s);const i=o(t,["_self"]);if(i!=null){let r=ga(i);Array.isArray(r)&&(r=r.map(a=>Is(a))),l(e,["models"],r)}return e}function Xp(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["nextPageToken"]);s!=null&&l(e,["nextPageToken"],s);const i=o(t,["_self"]);if(i!=null){let r=ga(i);Array.isArray(r)&&(r=r.map(a=>As(a))),l(e,["models"],r)}return e}function Qp(t){const e={},n=o(t,["maskMode"]);n!=null&&l(e,["maskMode"],n);const s=o(t,["segmentationClasses"]);s!=null&&l(e,["maskClasses"],s);const i=o(t,["maskDilation"]);return i!=null&&l(e,["dilation"],i),e}function Is(t){const e={},n=o(t,["name"]);n!=null&&l(e,["name"],n);const s=o(t,["displayName"]);s!=null&&l(e,["displayName"],s);const i=o(t,["description"]);i!=null&&l(e,["description"],i);const r=o(t,["version"]);r!=null&&l(e,["version"],r);const a=o(t,["_self"]);a!=null&&l(e,["tunedModelInfo"],ph(a));const u=o(t,["inputTokenLimit"]);u!=null&&l(e,["inputTokenLimit"],u);const d=o(t,["outputTokenLimit"]);d!=null&&l(e,["outputTokenLimit"],d);const c=o(t,["supportedGenerationMethods"]);return c!=null&&l(e,["supportedActions"],c),e}function As(t){const e={},n=o(t,["name"]);n!=null&&l(e,["name"],n);const s=o(t,["displayName"]);s!=null&&l(e,["displayName"],s);const i=o(t,["description"]);i!=null&&l(e,["description"],i);const r=o(t,["versionId"]);r!=null&&l(e,["version"],r);const a=o(t,["deployedModels"]);if(a!=null){let p=a;Array.isArray(p)&&(p=p.map(h=>mp(h))),l(e,["endpoints"],p)}const u=o(t,["labels"]);u!=null&&l(e,["labels"],u);const d=o(t,["_self"]);d!=null&&l(e,["tunedModelInfo"],hh(d));const c=o(t,["defaultCheckpointId"]);c!=null&&l(e,["defaultCheckpointId"],c);const f=o(t,["checkpoints"]);if(f!=null){let p=f;Array.isArray(p)&&(p=p.map(h=>h)),l(e,["checkpoints"],p)}return e}function jp(t){const e={},n=o(t,["functionCall"]);n!=null&&l(e,["functionCall"],n);const s=o(t,["codeExecutionResult"]);s!=null&&l(e,["codeExecutionResult"],s);const i=o(t,["executableCode"]);i!=null&&l(e,["executableCode"],i);const r=o(t,["fileData"]);r!=null&&l(e,["fileData"],gp(r));const a=o(t,["functionResponse"]);a!=null&&l(e,["functionResponse"],a);const u=o(t,["inlineData"]);u!=null&&l(e,["inlineData"],Bf(u));const d=o(t,["text"]);d!=null&&l(e,["text"],d);const c=o(t,["thought"]);c!=null&&l(e,["thought"],c);const f=o(t,["thoughtSignature"]);f!=null&&l(e,["thoughtSignature"],f);const p=o(t,["videoMetadata"]);return p!=null&&l(e,["videoMetadata"],p),e}function eh(t){const e={},n=o(t,["productImage"]);return n!=null&&l(e,["image"],Ce(n)),e}function th(t,e){const n={},s=o(t,["numberOfImages"]);e!==void 0&&s!=null&&l(e,["parameters","sampleCount"],s);const i=o(t,["baseSteps"]);e!==void 0&&i!=null&&l(e,["parameters","editConfig","baseSteps"],i);const r=o(t,["outputGcsUri"]);e!==void 0&&r!=null&&l(e,["parameters","storageUri"],r);const a=o(t,["seed"]);e!==void 0&&a!=null&&l(e,["parameters","seed"],a);const u=o(t,["safetyFilterLevel"]);e!==void 0&&u!=null&&l(e,["parameters","safetySetting"],u);const d=o(t,["personGeneration"]);e!==void 0&&d!=null&&l(e,["parameters","personGeneration"],d);const c=o(t,["addWatermark"]);e!==void 0&&c!=null&&l(e,["parameters","addWatermark"],c);const f=o(t,["outputMimeType"]);e!==void 0&&f!=null&&l(e,["parameters","outputOptions","mimeType"],f);const p=o(t,["outputCompressionQuality"]);e!==void 0&&p!=null&&l(e,["parameters","outputOptions","compressionQuality"],p);const h=o(t,["enhancePrompt"]);e!==void 0&&h!=null&&l(e,["parameters","enhancePrompt"],h);const m=o(t,["labels"]);return e!==void 0&&m!=null&&l(e,["labels"],m),n}function nh(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["source"]);i!=null&&ih(i,n);const r=o(e,["config"]);return r!=null&&th(r,n),n}function sh(t){const e={},n=o(t,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(i=>Un(i))),l(e,["generatedImages"],s)}return e}function ih(t,e){const n={},s=o(t,["prompt"]);e!==void 0&&s!=null&&l(e,["instances[0]","prompt"],s);const i=o(t,["personImage"]);e!==void 0&&i!=null&&l(e,["instances[0]","personImage","image"],Ce(i));const r=o(t,["productImages"]);if(e!==void 0&&r!=null){let a=r;Array.isArray(a)&&(a=a.map(u=>eh(u))),l(e,["instances[0]","productImages"],a)}return n}function rh(t){const e={},n=o(t,["referenceImage"]);n!=null&&l(e,["referenceImage"],Ce(n));const s=o(t,["referenceId"]);s!=null&&l(e,["referenceId"],s);const i=o(t,["referenceType"]);i!=null&&l(e,["referenceType"],i);const r=o(t,["maskImageConfig"]);r!=null&&l(e,["maskImageConfig"],Qp(r));const a=o(t,["controlImageConfig"]);a!=null&&l(e,["controlImageConfig"],zf(a));const u=o(t,["styleImageConfig"]);u!=null&&l(e,["styleImageConfig"],u);const d=o(t,["subjectImageConfig"]);return d!=null&&l(e,["subjectImageConfig"],d),e}function wa(t){const e={},n=o(t,["safetyAttributes","categories"]);n!=null&&l(e,["categories"],n);const s=o(t,["safetyAttributes","scores"]);s!=null&&l(e,["scores"],s);const i=o(t,["contentType"]);return i!=null&&l(e,["contentType"],i),e}function Ia(t){const e={},n=o(t,["safetyAttributes","categories"]);n!=null&&l(e,["categories"],n);const s=o(t,["safetyAttributes","scores"]);s!=null&&l(e,["scores"],s);const i=o(t,["contentType"]);return i!=null&&l(e,["contentType"],i),e}function oh(t){const e={},n=o(t,["category"]);if(n!=null&&l(e,["category"],n),o(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const s=o(t,["threshold"]);return s!=null&&l(e,["threshold"],s),e}function ah(t){const e={},n=o(t,["image"]);return n!=null&&l(e,["image"],Ce(n)),e}function lh(t,e){const n={},s=o(t,["mode"]);e!==void 0&&s!=null&&l(e,["parameters","mode"],s);const i=o(t,["maxPredictions"]);e!==void 0&&i!=null&&l(e,["parameters","maxPredictions"],i);const r=o(t,["confidenceThreshold"]);e!==void 0&&r!=null&&l(e,["parameters","confidenceThreshold"],r);const a=o(t,["maskDilation"]);e!==void 0&&a!=null&&l(e,["parameters","maskDilation"],a);const u=o(t,["binaryColorThreshold"]);e!==void 0&&u!=null&&l(e,["parameters","binaryColorThreshold"],u);const d=o(t,["labels"]);return e!==void 0&&d!=null&&l(e,["labels"],d),n}function uh(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["source"]);i!=null&&dh(i,n);const r=o(e,["config"]);return r!=null&&lh(r,n),n}function ch(t){const e={},n=o(t,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(i=>Lp(i))),l(e,["generatedMasks"],s)}return e}function dh(t,e){const n={},s=o(t,["prompt"]);e!==void 0&&s!=null&&l(e,["instances[0]","prompt"],s);const i=o(t,["image"]);e!==void 0&&i!=null&&l(e,["instances[0]","image"],Ce(i));const r=o(t,["scribbleImage"]);return e!==void 0&&r!=null&&l(e,["instances[0]","scribble"],ah(r)),n}function Aa(t){const e={},n=o(t,["languageCode"]);n!=null&&l(e,["languageCode"],n);const s=o(t,["voiceConfig"]);if(s!=null&&l(e,["voiceConfig"],s),o(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function fh(t){const e={},n=o(t,["functionDeclarations"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(p=>p)),l(e,["functionDeclarations"],f)}if(o(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=o(t,["googleSearchRetrieval"]);s!=null&&l(e,["googleSearchRetrieval"],s);const i=o(t,["computerUse"]);i!=null&&l(e,["computerUse"],i);const r=o(t,["fileSearch"]);r!=null&&l(e,["fileSearch"],r);const a=o(t,["codeExecution"]);if(a!=null&&l(e,["codeExecution"],a),o(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const u=o(t,["googleMaps"]);u!=null&&l(e,["googleMaps"],Op(u));const d=o(t,["googleSearch"]);d!=null&&l(e,["googleSearch"],Hp(d));const c=o(t,["urlContext"]);return c!=null&&l(e,["urlContext"],c),e}function Ra(t){const e={},n=o(t,["functionDeclarations"]);if(n!=null){let p=n;Array.isArray(p)&&(p=p.map(h=>yp(h))),l(e,["functionDeclarations"],p)}const s=o(t,["retrieval"]);s!=null&&l(e,["retrieval"],s);const i=o(t,["googleSearchRetrieval"]);i!=null&&l(e,["googleSearchRetrieval"],i);const r=o(t,["computerUse"]);if(r!=null&&l(e,["computerUse"],r),o(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const a=o(t,["codeExecution"]);a!=null&&l(e,["codeExecution"],a);const u=o(t,["enterpriseWebSearch"]);u!=null&&l(e,["enterpriseWebSearch"],u);const d=o(t,["googleMaps"]);d!=null&&l(e,["googleMaps"],d);const c=o(t,["googleSearch"]);c!=null&&l(e,["googleSearch"],c);const f=o(t,["urlContext"]);return f!=null&&l(e,["urlContext"],f),e}function ph(t){const e={},n=o(t,["baseModel"]);n!=null&&l(e,["baseModel"],n);const s=o(t,["createTime"]);s!=null&&l(e,["createTime"],s);const i=o(t,["updateTime"]);return i!=null&&l(e,["updateTime"],i),e}function hh(t){const e={},n=o(t,["labels","google-vertex-llm-tuning-base-model-id"]);n!=null&&l(e,["baseModel"],n);const s=o(t,["createTime"]);s!=null&&l(e,["createTime"],s);const i=o(t,["updateTime"]);return i!=null&&l(e,["updateTime"],i),e}function mh(t,e){const n={},s=o(t,["displayName"]);e!==void 0&&s!=null&&l(e,["displayName"],s);const i=o(t,["description"]);e!==void 0&&i!=null&&l(e,["description"],i);const r=o(t,["defaultCheckpointId"]);return e!==void 0&&r!=null&&l(e,["defaultCheckpointId"],r),n}function gh(t,e){const n={},s=o(t,["displayName"]);e!==void 0&&s!=null&&l(e,["displayName"],s);const i=o(t,["description"]);e!==void 0&&i!=null&&l(e,["description"],i);const r=o(t,["defaultCheckpointId"]);return e!==void 0&&r!=null&&l(e,["defaultCheckpointId"],r),n}function yh(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","name"],Y(t,s));const i=o(e,["config"]);return i!=null&&mh(i,n),n}function _h(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["config"]);return i!=null&&gh(i,n),n}function Th(t,e){const n={},s=o(t,["outputGcsUri"]);e!==void 0&&s!=null&&l(e,["parameters","storageUri"],s);const i=o(t,["safetyFilterLevel"]);e!==void 0&&i!=null&&l(e,["parameters","safetySetting"],i);const r=o(t,["personGeneration"]);e!==void 0&&r!=null&&l(e,["parameters","personGeneration"],r);const a=o(t,["includeRaiReason"]);e!==void 0&&a!=null&&l(e,["parameters","includeRaiReason"],a);const u=o(t,["outputMimeType"]);e!==void 0&&u!=null&&l(e,["parameters","outputOptions","mimeType"],u);const d=o(t,["outputCompressionQuality"]);e!==void 0&&d!=null&&l(e,["parameters","outputOptions","compressionQuality"],d);const c=o(t,["enhanceInputImage"]);e!==void 0&&c!=null&&l(e,["parameters","upscaleConfig","enhanceInputImage"],c);const f=o(t,["imagePreservationFactor"]);e!==void 0&&f!=null&&l(e,["parameters","upscaleConfig","imagePreservationFactor"],f);const p=o(t,["labels"]);e!==void 0&&p!=null&&l(e,["labels"],p);const h=o(t,["numberOfImages"]);e!==void 0&&h!=null&&l(e,["parameters","sampleCount"],h);const m=o(t,["mode"]);return e!==void 0&&m!=null&&l(e,["parameters","mode"],m),n}function vh(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["image"]);i!=null&&l(n,["instances[0]","image"],Ce(i));const r=o(e,["upscaleFactor"]);r!=null&&l(n,["parameters","upscaleConfig","upscaleFactor"],r);const a=o(e,["config"]);return a!=null&&Th(a,n),n}function Sh(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["predictions"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(r=>Un(r))),l(e,["generatedImages"],i)}return e}function Ch(t){const e={},n=o(t,["uri"]);n!=null&&l(e,["uri"],n);const s=o(t,["encodedVideo"]);s!=null&&l(e,["videoBytes"],Ke(s));const i=o(t,["encoding"]);return i!=null&&l(e,["mimeType"],i),e}function Eh(t){const e={},n=o(t,["gcsUri"]);n!=null&&l(e,["uri"],n);const s=o(t,["bytesBase64Encoded"]);s!=null&&l(e,["videoBytes"],Ke(s));const i=o(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function wh(t){const e={},n=o(t,["image"]);n!=null&&l(e,["_self"],Ce(n));const s=o(t,["maskMode"]);return s!=null&&l(e,["maskMode"],s),e}function Ih(t){const e={},n=o(t,["image"]);n!=null&&l(e,["image"],Fn(n));const s=o(t,["referenceType"]);return s!=null&&l(e,["referenceType"],s),e}function Ah(t){const e={},n=o(t,["image"]);n!=null&&l(e,["image"],Ce(n));const s=o(t,["referenceType"]);return s!=null&&l(e,["referenceType"],s),e}function Pa(t){const e={},n=o(t,["uri"]);n!=null&&l(e,["uri"],n);const s=o(t,["videoBytes"]);s!=null&&l(e,["encodedVideo"],Ke(s));const i=o(t,["mimeType"]);return i!=null&&l(e,["encoding"],i),e}function xa(t){const e={},n=o(t,["uri"]);n!=null&&l(e,["gcsUri"],n);const s=o(t,["videoBytes"]);s!=null&&l(e,["bytesBase64Encoded"],Ke(s));const i=o(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Rh="Content-Type",Ph="X-Server-Timeout",xh="User-Agent",Rs="x-goog-api-client",Nh="1.29.0",Mh=`google-genai-sdk/${Nh}`,kh="v1beta1",bh="v1beta",mo=/^\s*data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class Dh{constructor(e){var n,s;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const i={};this.clientOptions.vertexai?(i.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:kh,i.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(i.apiVersion=(s=this.clientOptions.apiVersion)!==null&&s!==void 0?s:bh,i.baseUrl="https://generativelanguage.googleapis.com/"),i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const s=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&s.push(e.apiVersion),s.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),n=new URL(e);return n.protocol=n.protocol=="http:"?"ws":"wss",n.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,n,s){const i=[this.getRequestUrlInternal(n)];return s&&i.push(this.getBaseResourcePath()),e!==""&&i.push(e),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const s=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,n,s);if(e.queryParams)for(const[a,u]of Object.entries(e.queryParams))i.searchParams.append(a,String(u));let r={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else r.body=e.body;return r=await this.includeExtraHttpOptionsToRequestInit(r,n,i.toString(),e.abortSignal),this.unaryApiCall(i,r,e.httpMethod)}patchHttpOptions(e,n){const s=JSON.parse(JSON.stringify(e));for(const[i,r]of Object.entries(n))typeof r=="object"?s[i]=Object.assign(Object.assign({},s[i]),r):r!==void 0&&(s[i]=r);return s}async requestStream(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const s=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,n,s);(!i.searchParams.has("alt")||i.searchParams.get("alt")!=="sse")&&i.searchParams.set("alt","sse");let r={};return r.body=e.body,r=await this.includeExtraHttpOptionsToRequestInit(r,n,i.toString(),e.abortSignal),this.streamApiCall(i,r,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,n,s,i){if(n&&n.timeout||i){const r=new AbortController,a=r.signal;if(n.timeout&&(n==null?void 0:n.timeout)>0){const u=setTimeout(()=>r.abort(),n.timeout);u&&typeof u.unref=="function"&&u.unref()}i&&i.addEventListener("abort",()=>{r.abort()}),e.signal=a}return n&&n.extraBody!==null&&Uh(e,n.extraBody),e.headers=await this.getHeadersInternal(n,s),e}async unaryApiCall(e,n,s){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:s})).then(async i=>(await go(i),new Cs(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(e,n,s){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:s})).then(async i=>(await go(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(e){var n;return pt(this,arguments,function*(){const i=(n=e==null?void 0:e.body)===null||n===void 0?void 0:n.getReader(),r=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let a="";for(;;){const{done:u,value:d}=yield z(i.read());if(u){if(a.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const c=r.decode(d,{stream:!0});try{const p=JSON.parse(c);if("error"in p){const h=JSON.parse(JSON.stringify(p.error)),m=h.status,_=h.code,g=`got status: ${m}. ${JSON.stringify(p)}`;if(_>=400&&_<600)throw new bn({message:g,status:_})}}catch(p){if(p.name==="ApiError")throw p}a+=c;let f=a.match(mo);for(;f;){const p=f[1];try{const h=new Response(p,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield z(new Cs(h)),a=a.slice(f[0].length),f=a.match(mo)}catch(h){throw new Error(`exception parsing stream chunk ${p}. ${h}`)}}}}finally{i.releaseLock()}})}async apiCall(e,n){return fetch(e,n).catch(s=>{throw new Error(`exception ${s} sending request`)})}getDefaultHeaders(){const e={},n=Mh+" "+this.clientOptions.userAgentExtra;return e[xh]=n,e[Rs]=n,e[Rh]="application/json",e}async getHeadersInternal(e,n){const s=new Headers;if(e&&e.headers){for(const[i,r]of Object.entries(e.headers))s.append(i,r);e.timeout&&e.timeout>0&&s.append(Ph,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(s,n),s}getFileName(e){var n;let s="";return typeof e=="string"&&(s=e.replace(/[/\\]+$/,""),s=(n=s.split(/[/\\]/).pop())!==null&&n!==void 0?n:""),s}async uploadFile(e,n){var s;const i={};n!=null&&(i.mimeType=n.mimeType,i.name=n.name,i.displayName=n.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);const r=this.clientOptions.uploader,a=await r.stat(e);i.sizeBytes=String(a.size);const u=(s=n==null?void 0:n.mimeType)!==null&&s!==void 0?s:a.type;if(u===void 0||u==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=u;const d={file:i},c=this.getFileName(e),f=A("upload/v1beta/files",d._url),p=await this.fetchUploadUrl(f,i.sizeBytes,i.mimeType,c,d,n==null?void 0:n.httpOptions);return r.upload(e,p,this)}async uploadFileToFileSearchStore(e,n,s){var i;const r=this.clientOptions.uploader,a=await r.stat(n),u=String(a.size),d=(i=s==null?void 0:s.mimeType)!==null&&i!==void 0?i:a.type;if(d===void 0||d==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const c=`upload/v1beta/${e}:uploadToFileSearchStore`,f=this.getFileName(n),p={};s!=null&&s.customMetadata&&(p.customMetadata=s.customMetadata),s!=null&&s.chunkingConfig&&(p.chunkingConfig=s.chunkingConfig);const h=await this.fetchUploadUrl(c,u,d,f,p,s==null?void 0:s.httpOptions);return r.uploadToFileSearchStore(n,h,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,n,s,i,r,a){var u;let d={};a?d=a:d={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${n}`,"X-Goog-Upload-Header-Content-Type":`${s}`},i?{"X-Goog-Upload-File-Name":i}:{})};const c=await this.request({path:e,body:JSON.stringify(r),httpMethod:"POST",httpOptions:d});if(!c||!(c!=null&&c.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const f=(u=c==null?void 0:c.headers)===null||u===void 0?void 0:u["x-goog-upload-url"];if(f===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return f}}async function go(t){var e;if(t===void 0)throw new Error("response is undefined");if(!t.ok){const n=t.status;let s;!((e=t.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?s=await t.json():s={error:{message:await t.text(),code:t.status,status:t.statusText}};const i=JSON.stringify(s);throw n>=400&&n<600?new bn({message:i,status:n}):new Error(i)}}function Uh(t,e){if(!e||Object.keys(e).length===0)return;if(t.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let n={};if(typeof t.body=="string"&&t.body.length>0)try{const r=JSON.parse(t.body);if(typeof r=="object"&&r!==null&&!Array.isArray(r))n=r;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function s(r,a){const u=Object.assign({},r);for(const d in a)if(Object.prototype.hasOwnProperty.call(a,d)){const c=a[d],f=u[d];c&&typeof c=="object"&&!Array.isArray(c)&&f&&typeof f=="object"&&!Array.isArray(f)?u[d]=s(f,c):(f&&c&&typeof f!=typeof c&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${d}". Original type: ${typeof f}, New type: ${typeof c}. Overwriting.`),u[d]=c)}return u}const i=s(n,e);t.body=JSON.stringify(i)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Fh="mcp_used/unknown";let Lh=!1;function Na(t){for(const e of t)if($h(e)||typeof e=="object"&&"inputSchema"in e)return!0;return Lh}function Ma(t){var e;const n=(e=t[Rs])!==null&&e!==void 0?e:"";t[Rs]=(n+` ${Fh}`).trimStart()}function $h(t){return t!==null&&typeof t=="object"&&t instanceof Xs}function Vh(t,e=100){return pt(this,arguments,function*(){let s,i=0;for(;i<e;){const r=yield z(t.listTools({cursor:s}));for(const a of r.tools)yield yield z(a),i++;if(!r.nextCursor)break;s=r.nextCursor}})}class Xs{constructor(e=[],n){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=n}static create(e,n){return new Xs(e,n)}async initialize(){var e,n,s,i;if(this.mcpTools.length>0)return;const r={},a=[];for(const f of this.mcpClients)try{for(var u=!0,d=(n=void 0,$t(Vh(f))),c;c=await d.next(),e=c.done,!e;u=!0){i=c.value,u=!1;const p=i;a.push(p);const h=p.name;if(r[h])throw new Error(`Duplicate function name ${h} found in MCP tools. Please ensure function names are unique.`);r[h]=f}}catch(p){n={error:p}}finally{try{!u&&!e&&(s=d.return)&&await s.call(d)}finally{if(n)throw n.error}}this.mcpTools=a,this.functionNameToMcpClient=r}async tool(){return await this.initialize(),Oc(this.mcpTools,this.config)}async callTool(e){await this.initialize();const n=[];for(const s of e)if(s.name in this.functionNameToMcpClient){const i=this.functionNameToMcpClient[s.name];let r;this.config.timeout&&(r={timeout:this.config.timeout});const a=await i.callTool({name:s.name,arguments:s.args},void 0,r);n.push({functionResponse:{name:s.name,response:a.isError?{error:a}:a}})}return n}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function Gh(t,e,n){const s=new Uc;let i;n.data instanceof Blob?i=JSON.parse(await n.data.text()):i=JSON.parse(n.data),Object.assign(s,i),e(s)}class qh{constructor(e,n,s){this.apiClient=e,this.auth=n,this.webSocketFactory=s}async connect(e){var n,s;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const i=this.apiClient.getWebsocketBaseUrl(),r=this.apiClient.getApiVersion(),a=Hh(this.apiClient.getDefaultHeaders()),u=this.apiClient.getApiKey(),d=`${i}/ws/google.ai.generativelanguage.${r}.GenerativeService.BidiGenerateMusic?key=${u}`;let c=()=>{};const f=new Promise(S=>{c=S}),p=e.callbacks,h=function(){c({})},m=this.apiClient,_={onopen:h,onmessage:S=>{Gh(m,p.onmessage,S)},onerror:(n=p==null?void 0:p.onerror)!==null&&n!==void 0?n:function(S){},onclose:(s=p==null?void 0:p.onclose)!==null&&s!==void 0?s:function(S){}},g=this.webSocketFactory.create(d,Oh(a),_);g.connect(),await f;const v={setup:{model:Y(this.apiClient,e.model)}};return g.send(JSON.stringify(v)),new Bh(g,this.apiClient)}}class Bh{constructor(e,n){this.conn=e,this.apiClient=n}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const n=bf(e);this.conn.send(JSON.stringify({clientContent:n}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const n=kf(e);this.conn.send(JSON.stringify(n))}sendPlaybackControl(e){const n={playbackControl:e};this.conn.send(JSON.stringify(n))}play(){this.sendPlaybackControl(ct.PLAY)}pause(){this.sendPlaybackControl(ct.PAUSE)}stop(){this.sendPlaybackControl(ct.STOP)}resetContext(){this.sendPlaybackControl(ct.RESET_CONTEXT)}close(){this.conn.close()}}function Oh(t){const e={};return t.forEach((n,s)=>{e[s]=n}),e}function Hh(t){const e=new Headers;for(const[n,s]of Object.entries(t))e.append(n,s);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Jh="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function Wh(t,e,n){const s=new Dc;let i;n.data instanceof Blob?i=await n.data.text():n.data instanceof ArrayBuffer?i=new TextDecoder().decode(n.data):i=n.data;const r=JSON.parse(i);if(t.isVertexAI()){const a=Ff(r);Object.assign(s,a)}else Object.assign(s,r);e(s)}class Yh{constructor(e,n,s){this.apiClient=e,this.auth=n,this.webSocketFactory=s,this.music=new qh(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var n,s,i,r,a,u;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const d=this.apiClient.getWebsocketBaseUrl(),c=this.apiClient.getApiVersion();let f;const p=this.apiClient.getHeaders();e.config&&e.config.tools&&Na(e.config.tools)&&Ma(p);const h=Xh(p);if(this.apiClient.isVertexAI())f=`${d}/ws/google.cloud.aiplatform.${c}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(h,f);else{const P=this.apiClient.getApiKey();let M="BidiGenerateContent",U="key";P!=null&&P.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),c!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),M="BidiGenerateContentConstrained",U="access_token"),f=`${d}/ws/google.ai.generativelanguage.${c}.GenerativeService.${M}?${U}=${P}`}let m=()=>{};const _=new Promise(P=>{m=P}),g=e.callbacks,T=function(){var P;(P=g==null?void 0:g.onopen)===null||P===void 0||P.call(g),m({})},w=this.apiClient,v={onopen:T,onmessage:P=>{Wh(w,g.onmessage,P)},onerror:(n=g==null?void 0:g.onerror)!==null&&n!==void 0?n:function(P){},onclose:(s=g==null?void 0:g.onclose)!==null&&s!==void 0?s:function(P){}},S=this.webSocketFactory.create(f,Zh(h),v);S.connect(),await _;let C=Y(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&C.startsWith("publishers/")){const P=this.apiClient.getProject(),M=this.apiClient.getLocation();C=`projects/${P}/locations/${M}/`+C}let N={};this.apiClient.isVertexAI()&&((i=e.config)===null||i===void 0?void 0:i.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[In.AUDIO]}:e.config.responseModalities=[In.AUDIO]),!((r=e.config)===null||r===void 0)&&r.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const R=(u=(a=e.config)===null||a===void 0?void 0:a.tools)!==null&&u!==void 0?u:[],I=[];for(const P of R)if(this.isCallableTool(P)){const M=P;I.push(await M.tool())}else I.push(P);I.length>0&&(e.config.tools=I);const q={model:C,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?N=Mf(this.apiClient,q):N=Nf(this.apiClient,q),delete N.config,S.send(JSON.stringify(N)),new zh(S,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const Kh={turnComplete:!0};class zh{constructor(e,n){this.conn=e,this.apiClient=n}tLiveClientContent(e,n){if(n.turns!==null&&n.turns!==void 0){let s=[];try{s=ye(n.turns),e.isVertexAI()||(s=s.map(i=>Dn(i)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof n.turns}'`)}return{clientContent:{turns:s,turnComplete:n.turnComplete}}}return{clientContent:{turnComplete:n.turnComplete}}}tLiveClienttToolResponse(e,n){let s=[];if(n.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(n.functionResponses)?s=n.functionResponses:s=[n.functionResponses],s.length===0)throw new Error("functionResponses is required.");for(const r of s){if(typeof r!="object"||r===null||!("name"in r)||!("response"in r))throw new Error(`Could not parse function response, type '${typeof r}'.`);if(!e.isVertexAI()&&!("id"in r))throw new Error(Jh)}return{toolResponse:{functionResponses:s}}}sendClientContent(e){e=Object.assign(Object.assign({},Kh),e);const n=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(n))}sendRealtimeInput(e){let n={};this.apiClient.isVertexAI()?n={realtimeInput:Uf(e)}:n={realtimeInput:Df(e)},this.conn.send(JSON.stringify(n))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const n=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(n))}close(){this.conn.close()}}function Zh(t){const e={};return t.forEach((n,s)=>{e[s]=n}),e}function Xh(t){const e=new Headers;for(const[n,s]of Object.entries(t))e.append(n,s);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const yo=10;function _o(t){var e,n,s;if(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let i=!1;for(const a of(n=t==null?void 0:t.tools)!==null&&n!==void 0?n:[])if(ht(a)){i=!0;break}if(!i)return!0;const r=(s=t==null?void 0:t.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls;return r&&(r<0||!Number.isInteger(r))||r==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",r),!0):!1}function ht(t){return"callTool"in t&&typeof t.callTool=="function"}function Qh(t){var e,n,s;return(s=(n=(e=t.config)===null||e===void 0?void 0:e.tools)===null||n===void 0?void 0:n.some(i=>ht(i)))!==null&&s!==void 0?s:!1}function To(t){var e;const n=[];return!((e=t==null?void 0:t.config)===null||e===void 0)&&e.tools&&t.config.tools.forEach((s,i)=>{if(ht(s))return;const r=s;r.functionDeclarations&&r.functionDeclarations.length>0&&n.push(i)}),n}function vo(t){var e;return!(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let jh=class extends De{constructor(e){super(),this.apiClient=e,this.generateContent=async n=>{var s,i,r,a,u;const d=await this.processParamsMaybeAddMcpUsage(n);if(this.maybeMoveToResponseJsonSchem(n),!Qh(n)||_o(n.config))return await this.generateContentInternal(d);const c=To(n);if(c.length>0){const g=c.map(T=>`tools[${T}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${g}.`)}let f,p;const h=ye(d.contents),m=(r=(i=(s=d.config)===null||s===void 0?void 0:s.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&r!==void 0?r:yo;let _=0;for(;_<m&&(f=await this.generateContentInternal(d),!(!f.functionCalls||f.functionCalls.length===0));){const g=f.candidates[0].content,T=[];for(const w of(u=(a=n.config)===null||a===void 0?void 0:a.tools)!==null&&u!==void 0?u:[])if(ht(w)){const S=await w.callTool(f.functionCalls);T.push(...S)}_++,p={role:"user",parts:T},d.contents=ye(d.contents),d.contents.push(g),d.contents.push(p),vo(d.config)&&(h.push(g),h.push(p))}return vo(d.config)&&(f.automaticFunctionCallingHistory=h),f},this.generateContentStream=async n=>{if(this.maybeMoveToResponseJsonSchem(n),_o(n.config)){const i=await this.processParamsMaybeAddMcpUsage(n);return await this.generateContentStreamInternal(i)}const s=To(n);if(s.length>0){const i=s.map(r=>`tools[${r}]`).join(", ");throw new Error(`Incompatible tools found at ${i}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}return await this.processAfcStream(n)},this.generateImages=async n=>await this.generateImagesInternal(n).then(s=>{var i;let r;const a=[];if(s!=null&&s.generatedImages)for(const d of s.generatedImages)d&&(d!=null&&d.safetyAttributes)&&((i=d==null?void 0:d.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?r=d==null?void 0:d.safetyAttributes:a.push(d);let u;return r?u={generatedImages:a,positivePromptSafetyAttributes:r,sdkHttpResponse:s.sdkHttpResponse}:u={generatedImages:a,sdkHttpResponse:s.sdkHttpResponse},u}),this.list=async n=>{var s;const a={config:Object.assign(Object.assign({},{queryBase:!0}),n==null?void 0:n.config)};if(this.apiClient.isVertexAI()&&!a.config.queryBase){if(!((s=a.config)===null||s===void 0)&&s.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");a.config.filter="labels.tune-type:*"}return new nt(be.PAGED_ITEM_MODELS,u=>this.listInternal(u),await this.listInternal(a),a)},this.editImage=async n=>{const s={model:n.model,prompt:n.prompt,referenceImages:[],config:n.config};return n.referenceImages&&n.referenceImages&&(s.referenceImages=n.referenceImages.map(i=>i.toReferenceImageAPI())),await this.editImageInternal(s)},this.upscaleImage=async n=>{let s={numberOfImages:1,mode:"upscale"};n.config&&(s=Object.assign(Object.assign({},s),n.config));const i={model:n.model,image:n.image,upscaleFactor:n.upscaleFactor,config:s};return await this.upscaleImageInternal(i)},this.generateVideos=async n=>{var s,i,r,a,u,d;if((n.prompt||n.image||n.video)&&n.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((s=n.video)===null||s===void 0)&&s.uri&&(!((i=n.video)===null||i===void 0)&&i.videoBytes)?n.video={uri:n.video.uri,mimeType:n.video.mimeType}:!((a=(r=n.source)===null||r===void 0?void 0:r.video)===null||a===void 0)&&a.uri&&(!((d=(u=n.source)===null||u===void 0?void 0:u.video)===null||d===void 0)&&d.videoBytes)&&(n.source.video={uri:n.source.video.uri,mimeType:n.source.video.mimeType})),await this.generateVideosInternal(n)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var n,s,i;const r=(n=e.config)===null||n===void 0?void 0:n.tools;if(!r)return e;const a=await Promise.all(r.map(async d=>ht(d)?await d.tool():d)),u={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:a})};if(u.config.tools=a,e.config&&e.config.tools&&Na(e.config.tools)){const d=(i=(s=e.config.httpOptions)===null||s===void 0?void 0:s.headers)!==null&&i!==void 0?i:{};let c=Object.assign({},d);Object.keys(c).length===0&&(c=this.apiClient.getDefaultHeaders()),Ma(c),u.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:c})}return u}async initAfcToolsMap(e){var n,s,i;const r=new Map;for(const a of(s=(n=e.config)===null||n===void 0?void 0:n.tools)!==null&&s!==void 0?s:[])if(ht(a)){const u=a,d=await u.tool();for(const c of(i=d.functionDeclarations)!==null&&i!==void 0?i:[]){if(!c.name)throw new Error("Function declaration name is required.");if(r.has(c.name))throw new Error(`Duplicate tool declaration name: ${c.name}`);r.set(c.name,u)}}return r}async processAfcStream(e){var n,s,i;const r=(i=(s=(n=e.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls)!==null&&i!==void 0?i:yo;let a=!1,u=0;const d=await this.initAfcToolsMap(e);return(function(c,f,p){var h,m;return pt(this,arguments,function*(){for(var _,g,T,w;u<r;){a&&(u++,a=!1);const N=yield z(c.processParamsMaybeAddMcpUsage(p)),R=yield z(c.generateContentStreamInternal(N)),I=[],q=[];try{for(var v=!0,S=(g=void 0,$t(R)),C;C=yield z(S.next()),_=C.done,!_;v=!0){w=C.value,v=!1;const P=w;if(yield yield z(P),P.candidates&&(!((h=P.candidates[0])===null||h===void 0)&&h.content)){q.push(P.candidates[0].content);for(const M of(m=P.candidates[0].content.parts)!==null&&m!==void 0?m:[])if(u<r&&M.functionCall){if(!M.functionCall.name)throw new Error("Function call name was not returned by the model.");if(f.has(M.functionCall.name)){const U=yield z(f.get(M.functionCall.name).callTool([M.functionCall]));I.push(...U)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${f.keys()}, mising tool: ${M.functionCall.name}`)}}}}catch(P){g={error:P}}finally{try{!v&&!_&&(T=S.return)&&(yield z(T.call(S)))}finally{if(g)throw g.error}}if(I.length>0){a=!0;const P=new xt;P.candidates=[{content:{role:"user",parts:I}}],yield yield z(P);const M=[];M.push(...q),M.push({role:"user",parts:I});const U=ye(p.contents).concat(M);p.contents=U}else break}})})(this,d,e)}async generateContentInternal(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=fo(this.apiClient,e);return u=A("{model}:generateContent",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=ho(f),h=new xt;return Object.assign(h,p),h})}else{const c=co(this.apiClient,e);return u=A("{model}:generateContent",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=po(f),h=new xt;return Object.assign(h,p),h})}}async generateContentStreamInternal(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=fo(this.apiClient,e);return u=A("{model}:streamGenerateContent?alt=sse",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.requestStream({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}),a.then(function(p){return pt(this,arguments,function*(){var h,m,_,g;try{for(var T=!0,w=$t(p),v;v=yield z(w.next()),h=v.done,!h;T=!0){g=v.value,T=!1;const S=g,C=ho(yield z(S.json()));C.sdkHttpResponse={headers:S.headers};const N=new xt;Object.assign(N,C),yield yield z(N)}}catch(S){m={error:S}}finally{try{!T&&!h&&(_=w.return)&&(yield z(_.call(w)))}finally{if(m)throw m.error}}})})}else{const c=co(this.apiClient,e);return u=A("{model}:streamGenerateContent?alt=sse",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.requestStream({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),a.then(function(p){return pt(this,arguments,function*(){var h,m,_,g;try{for(var T=!0,w=$t(p),v;v=yield z(w.next()),h=v.done,!h;T=!0){g=v.value,T=!1;const S=g,C=po(yield z(S.json()));C.sdkHttpResponse={headers:S.headers};const N=new xt;Object.assign(N,C),yield yield z(N)}}catch(S){m={error:S}}finally{try{!T&&!h&&(_=w.return)&&(yield z(_.call(w)))}finally{if(m)throw m.error}}})})}}async embedContent(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=fp(this.apiClient,e);return u=A("{model}:predict",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=hp(f),h=new Kr;return Object.assign(h,p),h})}else{const c=dp(this.apiClient,e);return u=A("{model}:batchEmbedContents",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=pp(f),h=new Kr;return Object.assign(h,p),h})}}async generateImagesInternal(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=Ep(this.apiClient,e);return u=A("{model}:predict",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=Ip(f),h=new zr;return Object.assign(h,p),h})}else{const c=Cp(this.apiClient,e);return u=A("{model}:predict",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=wp(f),h=new zr;return Object.assign(h,p),h})}}async editImageInternal(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI()){const u=ap(this.apiClient,e);return r=A("{model}:predict",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(c=>{const f=c;return f.sdkHttpResponse={headers:d.headers},f})),i.then(d=>{const c=lp(d),f=new Ec;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI()){const u=vh(this.apiClient,e);return r=A("{model}:predict",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(c=>{const f=c;return f.sdkHttpResponse={headers:d.headers},f})),i.then(d=>{const c=Sh(d),f=new wc;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI()){const u=nh(this.apiClient,e);return r=A("{model}:predict",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>{const c=sh(d),f=new Ic;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI()){const u=uh(this.apiClient,e);return r=A("{model}:predict",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>{const c=ch(d),f=new Ac;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=Bp(this.apiClient,e);return u=A("{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(f=>As(f))}else{const c=qp(this.apiClient,e);return u=A("{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),a.then(f=>Is(f))}}async listInternal(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=zp(this.apiClient,e);return u=A("{models_url}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=Xp(f),h=new Zr;return Object.assign(h,p),h})}else{const c=Kp(this.apiClient,e);return u=A("{models_url}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=Zp(f),h=new Zr;return Object.assign(h,p),h})}}async update(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=_h(this.apiClient,e);return u=A("{model}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(f=>As(f))}else{const c=yh(this.apiClient,e);return u=A("{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),a.then(f=>Is(f))}}async delete(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=sp(this.apiClient,e);return u=A("{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=rp(f),h=new Xr;return Object.assign(h,p),h})}else{const c=np(this.apiClient,e);return u=A("{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=ip(f),h=new Xr;return Object.assign(h,p),h})}}async countTokens(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=jf(this.apiClient,e);return u=A("{model}:countTokens",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=tp(f),h=new Qr;return Object.assign(h,p),h})}else{const c=Qf(this.apiClient,e);return u=A("{model}:countTokens",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=ep(f),h=new Qr;return Object.assign(h,p),h})}}async computeTokens(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI()){const u=Jf(this.apiClient,e);return r=A("{model}:computeTokens",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(c=>{const f=c;return f.sdkHttpResponse={headers:d.headers},f})),i.then(d=>{const c=Wf(d),f=new Rc;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=Mp(this.apiClient,e);return u=A("{model}:predictLongRunning",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(f=>{const p=xp(f),h=new An;return Object.assign(h,p),h})}else{const c=Np(this.apiClient,e);return u=A("{model}:predictLongRunning",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),a.then(f=>{const p=Pp(f),h=new An;return Object.assign(h,p),h})}}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class em extends De{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const n=e.operation,s=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=n.name.split("/operations/")[0];let r;s&&"httpOptions"in s&&(r=s.httpOptions);const a=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:i,config:{httpOptions:r}});return n._fromAPIResponse({apiResponse:a,_isVertexAI:!0})}else{const i=await this.getVideosOperationInternal({operationName:n.name,config:s});return n._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async get(e){const n=e.operation,s=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=n.name.split("/operations/")[0];let r;s&&"httpOptions"in s&&(r=s.httpOptions);const a=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:i,config:{httpOptions:r}});return n._fromAPIResponse({apiResponse:a,_isVertexAI:!0})}else{const i=await this.getVideosOperationInternal({operationName:n.name,config:s});return n._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async getVideosOperationInternal(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=yc(e);return u=A("{operationName}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a}else{const c=gc(e);return u=A("{operationName}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),a}}async fetchPredictVideosOperationInternal(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI()){const u=uc(e);return r=A("{resourceName}:fetchPredictOperation",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function tm(t){const e={},n=o(t,["data"]);if(n!=null&&l(e,["data"],n),o(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=o(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function nm(t){const e={},n=o(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>cm(r))),l(e,["parts"],i)}const s=o(t,["role"]);return s!=null&&l(e,["role"],s),e}function sm(t,e,n){const s={},i=o(e,["expireTime"]);n!==void 0&&i!=null&&l(n,["expireTime"],i);const r=o(e,["newSessionExpireTime"]);n!==void 0&&r!=null&&l(n,["newSessionExpireTime"],r);const a=o(e,["uses"]);n!==void 0&&a!=null&&l(n,["uses"],a);const u=o(e,["liveConnectConstraints"]);n!==void 0&&u!=null&&l(n,["bidiGenerateContentSetup"],um(t,u));const d=o(e,["lockAdditionalFields"]);return n!==void 0&&d!=null&&l(n,["fieldMask"],d),s}function im(t,e){const n={},s=o(e,["config"]);return s!=null&&l(n,["config"],sm(t,s,n)),n}function rm(t){const e={};if(o(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=o(t,["fileUri"]);n!=null&&l(e,["fileUri"],n);const s=o(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function om(t){const e={};if(o(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=o(t,["enableWidget"]);return n!=null&&l(e,["enableWidget"],n),e}function am(t){const e={};if(o(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(o(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=o(t,["timeRangeFilter"]);return n!=null&&l(e,["timeRangeFilter"],n),e}function lm(t,e){const n={},s=o(t,["generationConfig"]);e!==void 0&&s!=null&&l(e,["setup","generationConfig"],s);const i=o(t,["responseModalities"]);e!==void 0&&i!=null&&l(e,["setup","generationConfig","responseModalities"],i);const r=o(t,["temperature"]);e!==void 0&&r!=null&&l(e,["setup","generationConfig","temperature"],r);const a=o(t,["topP"]);e!==void 0&&a!=null&&l(e,["setup","generationConfig","topP"],a);const u=o(t,["topK"]);e!==void 0&&u!=null&&l(e,["setup","generationConfig","topK"],u);const d=o(t,["maxOutputTokens"]);e!==void 0&&d!=null&&l(e,["setup","generationConfig","maxOutputTokens"],d);const c=o(t,["mediaResolution"]);e!==void 0&&c!=null&&l(e,["setup","generationConfig","mediaResolution"],c);const f=o(t,["seed"]);e!==void 0&&f!=null&&l(e,["setup","generationConfig","seed"],f);const p=o(t,["speechConfig"]);e!==void 0&&p!=null&&l(e,["setup","generationConfig","speechConfig"],Zs(p));const h=o(t,["thinkingConfig"]);e!==void 0&&h!=null&&l(e,["setup","generationConfig","thinkingConfig"],h);const m=o(t,["enableAffectiveDialog"]);e!==void 0&&m!=null&&l(e,["setup","generationConfig","enableAffectiveDialog"],m);const _=o(t,["systemInstruction"]);e!==void 0&&_!=null&&l(e,["setup","systemInstruction"],nm(ae(_)));const g=o(t,["tools"]);if(e!==void 0&&g!=null){let R=wt(g);Array.isArray(R)&&(R=R.map(I=>fm(Et(I)))),l(e,["setup","tools"],R)}const T=o(t,["sessionResumption"]);e!==void 0&&T!=null&&l(e,["setup","sessionResumption"],dm(T));const w=o(t,["inputAudioTranscription"]);e!==void 0&&w!=null&&l(e,["setup","inputAudioTranscription"],w);const v=o(t,["outputAudioTranscription"]);e!==void 0&&v!=null&&l(e,["setup","outputAudioTranscription"],v);const S=o(t,["realtimeInputConfig"]);e!==void 0&&S!=null&&l(e,["setup","realtimeInputConfig"],S);const C=o(t,["contextWindowCompression"]);e!==void 0&&C!=null&&l(e,["setup","contextWindowCompression"],C);const N=o(t,["proactivity"]);return e!==void 0&&N!=null&&l(e,["setup","proactivity"],N),n}function um(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["setup","model"],Y(t,s));const i=o(e,["config"]);return i!=null&&l(n,["config"],lm(i,n)),n}function cm(t){const e={},n=o(t,["functionCall"]);n!=null&&l(e,["functionCall"],n);const s=o(t,["codeExecutionResult"]);s!=null&&l(e,["codeExecutionResult"],s);const i=o(t,["executableCode"]);i!=null&&l(e,["executableCode"],i);const r=o(t,["fileData"]);r!=null&&l(e,["fileData"],rm(r));const a=o(t,["functionResponse"]);a!=null&&l(e,["functionResponse"],a);const u=o(t,["inlineData"]);u!=null&&l(e,["inlineData"],tm(u));const d=o(t,["text"]);d!=null&&l(e,["text"],d);const c=o(t,["thought"]);c!=null&&l(e,["thought"],c);const f=o(t,["thoughtSignature"]);f!=null&&l(e,["thoughtSignature"],f);const p=o(t,["videoMetadata"]);return p!=null&&l(e,["videoMetadata"],p),e}function dm(t){const e={},n=o(t,["handle"]);if(n!=null&&l(e,["handle"],n),o(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function fm(t){const e={},n=o(t,["functionDeclarations"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(p=>p)),l(e,["functionDeclarations"],f)}if(o(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=o(t,["googleSearchRetrieval"]);s!=null&&l(e,["googleSearchRetrieval"],s);const i=o(t,["computerUse"]);i!=null&&l(e,["computerUse"],i);const r=o(t,["fileSearch"]);r!=null&&l(e,["fileSearch"],r);const a=o(t,["codeExecution"]);if(a!=null&&l(e,["codeExecution"],a),o(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const u=o(t,["googleMaps"]);u!=null&&l(e,["googleMaps"],om(u));const d=o(t,["googleSearch"]);d!=null&&l(e,["googleSearch"],am(d));const c=o(t,["urlContext"]);return c!=null&&l(e,["urlContext"],c),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function pm(t){const e=[];for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const s=t[n];if(typeof s=="object"&&s!=null&&Object.keys(s).length>0){const i=Object.keys(s).map(r=>`${n}.${r}`);e.push(...i)}else e.push(n)}return e.join(",")}function hm(t,e){let n=null;const s=t.bidiGenerateContentSetup;if(typeof s=="object"&&s!==null&&"setup"in s){const r=s.setup;typeof r=="object"&&r!==null?(t.bidiGenerateContentSetup=r,n=r):delete t.bidiGenerateContentSetup}else s!==void 0&&delete t.bidiGenerateContentSetup;const i=t.fieldMask;if(n){const r=pm(n);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)r?t.fieldMask=r:delete t.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&i!==null&&Array.isArray(i)&&i.length>0){const a=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let u=[];i.length>0&&(u=i.map(c=>a.includes(c)?`generationConfig.${c}`:c));const d=[];r&&d.push(r),u.length>0&&d.push(...u),d.length>0?t.fieldMask=d.join(","):delete t.fieldMask}else delete t.fieldMask}else i!==null&&Array.isArray(i)&&i.length>0?t.fieldMask=i.join(","):delete t.fieldMask;return t}class mm extends De{constructor(e){super(),this.apiClient=e}async create(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const u=im(this.apiClient,e);r=A("auth_tokens",u._url),a=u._query,delete u.config,delete u._url,delete u._query;const d=hm(u,e.config);return i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json()),i.then(c=>c)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function gm(t,e){const n={},s=o(t,["displayName"]);return e!==void 0&&s!=null&&l(e,["displayName"],s),n}function ym(t){const e={},n=o(t,["config"]);return n!=null&&gm(n,e),e}function _m(t,e){const n={},s=o(t,["force"]);return e!==void 0&&s!=null&&l(e,["_query","force"],s),n}function Tm(t){const e={},n=o(t,["name"]);n!=null&&l(e,["_url","name"],n);const s=o(t,["config"]);return s!=null&&_m(s,e),e}function vm(t){const e={},n=o(t,["name"]);return n!=null&&l(e,["_url","name"],n),e}function Sm(t,e){const n={},s=o(t,["customMetadata"]);if(e!==void 0&&s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>a)),l(e,["customMetadata"],r)}const i=o(t,["chunkingConfig"]);return e!==void 0&&i!=null&&l(e,["chunkingConfig"],i),n}function Cm(t){const e={},n=o(t,["name"]);n!=null&&l(e,["name"],n);const s=o(t,["metadata"]);s!=null&&l(e,["metadata"],s);const i=o(t,["done"]);i!=null&&l(e,["done"],i);const r=o(t,["error"]);r!=null&&l(e,["error"],r);const a=o(t,["response"]);return a!=null&&l(e,["response"],wm(a)),e}function Em(t){const e={},n=o(t,["fileSearchStoreName"]);n!=null&&l(e,["_url","file_search_store_name"],n);const s=o(t,["fileName"]);s!=null&&l(e,["fileName"],s);const i=o(t,["config"]);return i!=null&&Sm(i,e),e}function wm(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["parent"]);s!=null&&l(e,["parent"],s);const i=o(t,["documentName"]);return i!=null&&l(e,["documentName"],i),e}function Im(t,e){const n={},s=o(t,["pageSize"]);e!==void 0&&s!=null&&l(e,["_query","pageSize"],s);const i=o(t,["pageToken"]);return e!==void 0&&i!=null&&l(e,["_query","pageToken"],i),n}function Am(t){const e={},n=o(t,["config"]);return n!=null&&Im(n,e),e}function Rm(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["nextPageToken"]);s!=null&&l(e,["nextPageToken"],s);const i=o(t,["fileSearchStores"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(a=>a)),l(e,["fileSearchStores"],r)}return e}function Pm(t,e){const n={},s=o(t,["mimeType"]);e!==void 0&&s!=null&&l(e,["mimeType"],s);const i=o(t,["displayName"]);e!==void 0&&i!=null&&l(e,["displayName"],i);const r=o(t,["customMetadata"]);if(e!==void 0&&r!=null){let u=r;Array.isArray(u)&&(u=u.map(d=>d)),l(e,["customMetadata"],u)}const a=o(t,["chunkingConfig"]);return e!==void 0&&a!=null&&l(e,["chunkingConfig"],a),n}function xm(t){const e={},n=o(t,["fileSearchStoreName"]);n!=null&&l(e,["_url","file_search_store_name"],n);const s=o(t,["config"]);return s!=null&&Pm(s,e),e}function Nm(t){const e={},n=o(t,["sdkHttpResponse"]);return n!=null&&l(e,["sdkHttpResponse"],n),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Mm(t,e){const n={},s=o(t,["force"]);return e!==void 0&&s!=null&&l(e,["_query","force"],s),n}function km(t){const e={},n=o(t,["name"]);n!=null&&l(e,["_url","name"],n);const s=o(t,["config"]);return s!=null&&Mm(s,e),e}function bm(t){const e={},n=o(t,["name"]);return n!=null&&l(e,["_url","name"],n),e}function Dm(t,e){const n={},s=o(t,["pageSize"]);e!==void 0&&s!=null&&l(e,["_query","pageSize"],s);const i=o(t,["pageToken"]);return e!==void 0&&i!=null&&l(e,["_query","pageToken"],i),n}function Um(t){const e={},n=o(t,["parent"]);n!=null&&l(e,["_url","parent"],n);const s=o(t,["config"]);return s!=null&&Dm(s,e),e}function Fm(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["nextPageToken"]);s!=null&&l(e,["nextPageToken"],s);const i=o(t,["documents"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(a=>a)),l(e,["documents"],r)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Lm extends De{constructor(e){super(),this.apiClient=e,this.list=async n=>new nt(be.PAGED_ITEM_DOCUMENTS,s=>this.listInternal({parent:n.parent,config:s.config}),await this.listInternal(n),n)}async get(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=bm(e);return r=A("{name}",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>d)}}async delete(e){var n,s;let i="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=km(e);i=A("{name}",a._url),r=a._query,delete a._url,delete a._query,await this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}}async listInternal(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Um(e);return r=A("{parent}/documents",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>{const c=Fm(d),f=new Pc;return Object.assign(f,c),f})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class $m extends De{constructor(e,n=new Lm(e)){super(),this.apiClient=e,this.documents=n,this.list=async(s={})=>new nt(be.PAGED_ITEM_FILE_SEARCH_STORES,i=>this.listInternal(i),await this.listInternal(s),s)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=ym(e);return r=A("fileSearchStores",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>d)}}async get(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=vm(e);return r=A("{name}",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>d)}}async delete(e){var n,s;let i="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=Tm(e);i=A("{name}",a._url),r=a._query,delete a._url,delete a._query,await this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}}async listInternal(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Am(e);return r=A("fileSearchStores",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>{const c=Rm(d),f=new xc;return Object.assign(f,c),f})}}async uploadToFileSearchStoreInternal(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=xm(e);return r=A("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>{const c=Nm(d),f=new Nc;return Object.assign(f,c),f})}}async importFile(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Em(e);return r=A("{file_search_store_name}:importFile",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>{const c=Cm(d),f=new Js;return Object.assign(f,c),f})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Vm(t,e){const n={},s=o(t,["name"]);return s!=null&&l(n,["_url","name"],s),n}function Gm(t,e){const n={},s=o(t,["name"]);return s!=null&&l(n,["_url","name"],s),n}function qm(t,e,n){const s={};if(o(t,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const i=o(t,["tunedModelDisplayName"]);if(e!==void 0&&i!=null&&l(e,["displayName"],i),o(t,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const r=o(t,["epochCount"]);e!==void 0&&r!=null&&l(e,["tuningTask","hyperparameters","epochCount"],r);const a=o(t,["learningRateMultiplier"]);if(a!=null&&l(s,["tuningTask","hyperparameters","learningRateMultiplier"],a),o(t,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(o(t,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(o(t,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const u=o(t,["batchSize"]);e!==void 0&&u!=null&&l(e,["tuningTask","hyperparameters","batchSize"],u);const d=o(t,["learningRate"]);if(e!==void 0&&d!=null&&l(e,["tuningTask","hyperparameters","learningRate"],d),o(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(o(t,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return s}function Bm(t,e,n){const s={};let i=o(n,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){const m=o(t,["validationDataset"]);e!==void 0&&m!=null&&l(e,["supervisedTuningSpec"],So(m))}else if(i==="PREFERENCE_TUNING"){const m=o(t,["validationDataset"]);e!==void 0&&m!=null&&l(e,["preferenceOptimizationSpec"],So(m))}const r=o(t,["tunedModelDisplayName"]);e!==void 0&&r!=null&&l(e,["tunedModelDisplayName"],r);const a=o(t,["description"]);e!==void 0&&a!=null&&l(e,["description"],a);let u=o(n,["config","method"]);if(u===void 0&&(u="SUPERVISED_FINE_TUNING"),u==="SUPERVISED_FINE_TUNING"){const m=o(t,["epochCount"]);e!==void 0&&m!=null&&l(e,["supervisedTuningSpec","hyperParameters","epochCount"],m)}else if(u==="PREFERENCE_TUNING"){const m=o(t,["epochCount"]);e!==void 0&&m!=null&&l(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],m)}let d=o(n,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){const m=o(t,["learningRateMultiplier"]);e!==void 0&&m!=null&&l(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],m)}else if(d==="PREFERENCE_TUNING"){const m=o(t,["learningRateMultiplier"]);e!==void 0&&m!=null&&l(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],m)}let c=o(n,["config","method"]);if(c===void 0&&(c="SUPERVISED_FINE_TUNING"),c==="SUPERVISED_FINE_TUNING"){const m=o(t,["exportLastCheckpointOnly"]);e!==void 0&&m!=null&&l(e,["supervisedTuningSpec","exportLastCheckpointOnly"],m)}else if(c==="PREFERENCE_TUNING"){const m=o(t,["exportLastCheckpointOnly"]);e!==void 0&&m!=null&&l(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],m)}let f=o(n,["config","method"]);if(f===void 0&&(f="SUPERVISED_FINE_TUNING"),f==="SUPERVISED_FINE_TUNING"){const m=o(t,["adapterSize"]);e!==void 0&&m!=null&&l(e,["supervisedTuningSpec","hyperParameters","adapterSize"],m)}else if(f==="PREFERENCE_TUNING"){const m=o(t,["adapterSize"]);e!==void 0&&m!=null&&l(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],m)}if(o(t,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(o(t,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const p=o(t,["labels"]);e!==void 0&&p!=null&&l(e,["labels"],p);const h=o(t,["beta"]);return e!==void 0&&h!=null&&l(e,["preferenceOptimizationSpec","hyperParameters","beta"],h),s}function Om(t,e){const n={},s=o(t,["baseModel"]);s!=null&&l(n,["baseModel"],s);const i=o(t,["preTunedModel"]);i!=null&&l(n,["preTunedModel"],i);const r=o(t,["trainingDataset"]);r!=null&&eg(r);const a=o(t,["config"]);return a!=null&&qm(a,n),n}function Hm(t,e){const n={},s=o(t,["baseModel"]);s!=null&&l(n,["baseModel"],s);const i=o(t,["preTunedModel"]);i!=null&&l(n,["preTunedModel"],i);const r=o(t,["trainingDataset"]);r!=null&&tg(r,n,e);const a=o(t,["config"]);return a!=null&&Bm(a,n,e),n}function Jm(t,e){const n={},s=o(t,["name"]);return s!=null&&l(n,["_url","name"],s),n}function Wm(t,e){const n={},s=o(t,["name"]);return s!=null&&l(n,["_url","name"],s),n}function Ym(t,e,n){const s={},i=o(t,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);const r=o(t,["pageToken"]);e!==void 0&&r!=null&&l(e,["_query","pageToken"],r);const a=o(t,["filter"]);return e!==void 0&&a!=null&&l(e,["_query","filter"],a),s}function Km(t,e,n){const s={},i=o(t,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);const r=o(t,["pageToken"]);e!==void 0&&r!=null&&l(e,["_query","pageToken"],r);const a=o(t,["filter"]);return e!==void 0&&a!=null&&l(e,["_query","filter"],a),s}function zm(t,e){const n={},s=o(t,["config"]);return s!=null&&Ym(s,n),n}function Zm(t,e){const n={},s=o(t,["config"]);return s!=null&&Km(s,n),n}function Xm(t,e){const n={},s=o(t,["sdkHttpResponse"]);s!=null&&l(n,["sdkHttpResponse"],s);const i=o(t,["nextPageToken"]);i!=null&&l(n,["nextPageToken"],i);const r=o(t,["tunedModels"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(u=>ka(u))),l(n,["tuningJobs"],a)}return n}function Qm(t,e){const n={},s=o(t,["sdkHttpResponse"]);s!=null&&l(n,["sdkHttpResponse"],s);const i=o(t,["nextPageToken"]);i!=null&&l(n,["nextPageToken"],i);const r=o(t,["tuningJobs"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(u=>Ps(u))),l(n,["tuningJobs"],a)}return n}function jm(t,e){const n={},s=o(t,["name"]);s!=null&&l(n,["model"],s);const i=o(t,["name"]);return i!=null&&l(n,["endpoint"],i),n}function eg(t,e){const n={};if(o(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(o(t,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const s=o(t,["examples"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(r=>r)),l(n,["examples","examples"],i)}return n}function tg(t,e,n){const s={};let i=o(n,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){const a=o(t,["gcsUri"]);e!==void 0&&a!=null&&l(e,["supervisedTuningSpec","trainingDatasetUri"],a)}else if(i==="PREFERENCE_TUNING"){const a=o(t,["gcsUri"]);e!==void 0&&a!=null&&l(e,["preferenceOptimizationSpec","trainingDatasetUri"],a)}let r=o(n,["config","method"]);if(r===void 0&&(r="SUPERVISED_FINE_TUNING"),r==="SUPERVISED_FINE_TUNING"){const a=o(t,["vertexDatasetResource"]);e!==void 0&&a!=null&&l(e,["supervisedTuningSpec","trainingDatasetUri"],a)}else if(r==="PREFERENCE_TUNING"){const a=o(t,["vertexDatasetResource"]);e!==void 0&&a!=null&&l(e,["preferenceOptimizationSpec","trainingDatasetUri"],a)}if(o(t,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return s}function ka(t,e){const n={},s=o(t,["sdkHttpResponse"]);s!=null&&l(n,["sdkHttpResponse"],s);const i=o(t,["name"]);i!=null&&l(n,["name"],i);const r=o(t,["state"]);r!=null&&l(n,["state"],pa(r));const a=o(t,["createTime"]);a!=null&&l(n,["createTime"],a);const u=o(t,["tuningTask","startTime"]);u!=null&&l(n,["startTime"],u);const d=o(t,["tuningTask","completeTime"]);d!=null&&l(n,["endTime"],d);const c=o(t,["updateTime"]);c!=null&&l(n,["updateTime"],c);const f=o(t,["description"]);f!=null&&l(n,["description"],f);const p=o(t,["baseModel"]);p!=null&&l(n,["baseModel"],p);const h=o(t,["_self"]);return h!=null&&l(n,["tunedModel"],jm(h)),n}function Ps(t,e){const n={},s=o(t,["sdkHttpResponse"]);s!=null&&l(n,["sdkHttpResponse"],s);const i=o(t,["name"]);i!=null&&l(n,["name"],i);const r=o(t,["state"]);r!=null&&l(n,["state"],pa(r));const a=o(t,["createTime"]);a!=null&&l(n,["createTime"],a);const u=o(t,["startTime"]);u!=null&&l(n,["startTime"],u);const d=o(t,["endTime"]);d!=null&&l(n,["endTime"],d);const c=o(t,["updateTime"]);c!=null&&l(n,["updateTime"],c);const f=o(t,["error"]);f!=null&&l(n,["error"],f);const p=o(t,["description"]);p!=null&&l(n,["description"],p);const h=o(t,["baseModel"]);h!=null&&l(n,["baseModel"],h);const m=o(t,["tunedModel"]);m!=null&&l(n,["tunedModel"],m);const _=o(t,["preTunedModel"]);_!=null&&l(n,["preTunedModel"],_);const g=o(t,["supervisedTuningSpec"]);g!=null&&l(n,["supervisedTuningSpec"],g);const T=o(t,["preferenceOptimizationSpec"]);T!=null&&l(n,["preferenceOptimizationSpec"],T);const w=o(t,["tuningDataStats"]);w!=null&&l(n,["tuningDataStats"],w);const v=o(t,["encryptionSpec"]);v!=null&&l(n,["encryptionSpec"],v);const S=o(t,["partnerModelTuningSpec"]);S!=null&&l(n,["partnerModelTuningSpec"],S);const C=o(t,["customBaseModel"]);C!=null&&l(n,["customBaseModel"],C);const N=o(t,["experiment"]);N!=null&&l(n,["experiment"],N);const R=o(t,["labels"]);R!=null&&l(n,["labels"],R);const I=o(t,["outputUri"]);I!=null&&l(n,["outputUri"],I);const q=o(t,["pipelineJob"]);q!=null&&l(n,["pipelineJob"],q);const P=o(t,["serviceAccount"]);P!=null&&l(n,["serviceAccount"],P);const M=o(t,["tunedModelDisplayName"]);M!=null&&l(n,["tunedModelDisplayName"],M);const U=o(t,["veoTuningSpec"]);return U!=null&&l(n,["veoTuningSpec"],U),n}function ng(t,e){const n={},s=o(t,["sdkHttpResponse"]);s!=null&&l(n,["sdkHttpResponse"],s);const i=o(t,["name"]);i!=null&&l(n,["name"],i);const r=o(t,["metadata"]);r!=null&&l(n,["metadata"],r);const a=o(t,["done"]);a!=null&&l(n,["done"],a);const u=o(t,["error"]);return u!=null&&l(n,["error"],u),n}function So(t,e){const n={},s=o(t,["gcsUri"]);s!=null&&l(n,["validationDatasetUri"],s);const i=o(t,["vertexDatasetResource"]);return i!=null&&l(n,["validationDatasetUri"],i),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class sg extends De{constructor(e){super(),this.apiClient=e,this.get=async n=>await this.getInternal(n),this.list=async(n={})=>new nt(be.PAGED_ITEM_TUNING_JOBS,s=>this.listInternal(s),await this.listInternal(n),n),this.tune=async n=>{var s;if(this.apiClient.isVertexAI())if(n.baseModel.startsWith("projects/")){const i={tunedModelName:n.baseModel};!((s=n.config)===null||s===void 0)&&s.preTunedModelCheckpointId&&(i.checkpointId=n.config.preTunedModelCheckpointId);const r=Object.assign(Object.assign({},n),{preTunedModel:i});return r.baseModel=void 0,await this.tuneInternal(r)}else{const i=Object.assign({},n);return await this.tuneInternal(i)}else{const i=Object.assign({},n),r=await this.tuneMldevInternal(i);let a="";return r.metadata!==void 0&&r.metadata.tunedModel!==void 0?a=r.metadata.tunedModel:r.name!==void 0&&r.name.includes("/operations/")&&(a=r.name.split("/operations/")[0]),{name:a,state:Ss.JOB_STATE_QUEUED}}}}async getInternal(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=Wm(e);return u=A("{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>Ps(f))}else{const c=Jm(e);return u=A("{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>ka(f))}}async listInternal(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=Zm(e);return u=A("tuningJobs",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=Qm(f),h=new jr;return Object.assign(h,p),h})}else{const c=zm(e);return u=A("tunedModels",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=Xm(f),h=new jr;return Object.assign(h,p),h})}}async cancel(e){var n,s,i,r;let a="",u={};if(this.apiClient.isVertexAI()){const d=Gm(e);a=A("{name}:cancel",d._url),u=d._query,delete d._url,delete d._query,await this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}else{const d=Vm(e);a=A("{name}:cancel",d._url),u=d._query,delete d._url,delete d._query,await this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async tuneInternal(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI()){const u=Hm(e,e);return r=A("tuningJobs",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(c=>{const f=c;return f.sdkHttpResponse={headers:d.headers},f})),i.then(d=>Ps(d))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Om(e);return r=A("tunedModels",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(c=>{const f=c;return f.sdkHttpResponse={headers:d.headers},f})),i.then(d=>ng(d))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ig{async download(e,n){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const rg=1024*1024*8,og=3,ag=1e3,lg=2,Pn="x-goog-upload-status";async function ug(t,e,n){var s;const i=await ba(t,e,n),r=await(i==null?void 0:i.json());if(((s=i==null?void 0:i.headers)===null||s===void 0?void 0:s[Pn])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return r.file}async function cg(t,e,n){var s;const i=await ba(t,e,n),r=await(i==null?void 0:i.json());if(((s=i==null?void 0:i.headers)===null||s===void 0?void 0:s[Pn])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const a=aa(r),u=new Ws;return Object.assign(u,a),u}async function ba(t,e,n){var s,i;let r=0,a=0,u=new Cs(new Response),d="upload";for(r=t.size;a<r;){const c=Math.min(rg,r-a),f=t.slice(a,a+c);a+c>=r&&(d+=", finalize");let p=0,h=ag;for(;p<og&&(u=await n.request({path:"",body:f,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":d,"X-Goog-Upload-Offset":String(a),"Content-Length":String(c)}}}),!(!((s=u==null?void 0:u.headers)===null||s===void 0)&&s[Pn]));)p++,await fg(h),h=h*lg;if(a+=c,((i=u==null?void 0:u.headers)===null||i===void 0?void 0:i[Pn])!=="active")break;if(r<=a)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return u}async function dg(t){return{size:t.size,type:t.type}}function fg(t){return new Promise(e=>setTimeout(e,t))}class pg{async upload(e,n,s){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await ug(e,n,s)}async uploadToFileSearchStore(e,n,s){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await cg(e,n,s)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await dg(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class hg{create(e,n,s){return new mg(e,n,s)}}class mg{constructor(e,n,s){this.url=e,this.headers=n,this.callbacks=s}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Co="x-goog-api-key";class gg{constructor(e){this.apiKey=e}async addAuthHeaders(e,n){if(e.get(Co)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(Co,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const yg="gl-node/";class _g{constructor(e){var n;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(n=e.vertexai)!==null&&n!==void 0?n:!1,this.apiKey=e.apiKey;const s=ac(e.httpOptions,e.vertexai,void 0,void 0);s&&(e.httpOptions?e.httpOptions.baseUrl=s:e.httpOptions={baseUrl:s}),this.apiVersion=e.apiVersion;const i=new gg(this.apiKey);this.apiClient=new Dh({auth:i,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:yg+"web",uploader:new pg,downloader:new ig}),this.models=new jh(this.apiClient),this.live=new Yh(this.apiClient,i,new hg),this.batches=new kd(this.apiClient),this.chats=new df(this.models,this.apiClient),this.caches=new lf(this.apiClient),this.files=new Sf(this.apiClient),this.operations=new em(this.apiClient),this.authTokens=new mm(this.apiClient),this.tunings=new sg(this.apiClient),this.fileSearchStores=new $m(this.apiClient)}}const xs="RFC3986",Ns={RFC1738:t=>String(t).replace(/%20/g,"+"),RFC3986:t=>String(t)},Tg="RFC1738",vg=Array.isArray,Ee=(()=>{const t=[];for(let e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t})(),jn=1024,Sg=(t,e,n,s,i)=>{if(t.length===0)return t;let r=t;if(typeof t=="symbol"?r=Symbol.prototype.toString.call(t):typeof t!="string"&&(r=String(t)),n==="iso-8859-1")return escape(r).replace(/%u[0-9a-f]{4}/gi,function(u){return"%26%23"+parseInt(u.slice(2),16)+"%3B"});let a="";for(let u=0;u<r.length;u+=jn){const d=r.length>=jn?r.slice(u,u+jn):r,c=[];for(let f=0;f<d.length;++f){let p=d.charCodeAt(f);if(p===45||p===46||p===95||p===126||p>=48&&p<=57||p>=65&&p<=90||p>=97&&p<=122||i===Tg&&(p===40||p===41)){c[c.length]=d.charAt(f);continue}if(p<128){c[c.length]=Ee[p];continue}if(p<2048){c[c.length]=Ee[192|p>>6]+Ee[128|p&63];continue}if(p<55296||p>=57344){c[c.length]=Ee[224|p>>12]+Ee[128|p>>6&63]+Ee[128|p&63];continue}f+=1,p=65536+((p&1023)<<10|d.charCodeAt(f)&1023),c[c.length]=Ee[240|p>>18]+Ee[128|p>>12&63]+Ee[128|p>>6&63]+Ee[128|p&63]}a+=c.join("")}return a};function Cg(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))}function Eo(t,e){if(vg(t)){const n=[];for(let s=0;s<t.length;s+=1)n.push(e(t[s]));return n}return e(t)}const Eg=Object.prototype.hasOwnProperty,Da={brackets(t){return String(t)+"[]"},comma:"comma",indices(t,e){return String(t)+"["+e+"]"},repeat(t){return String(t)}},we=Array.isArray,wg=Array.prototype.push,Ua=function(t,e){wg.apply(t,we(e)?e:[e])},Ig=Date.prototype.toISOString,te={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:Sg,encodeValuesOnly:!1,format:xs,formatter:Ns[xs],indices:!1,serializeDate(t){return Ig.call(t)},skipNulls:!1,strictNullHandling:!1};function Ag(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"}const es={};function Fa(t,e,n,s,i,r,a,u,d,c,f,p,h,m,_,g,T,w){let v=t,S=w,C=0,N=!1;for(;(S=S.get(es))!==void 0&&!N;){const M=S.get(t);if(C+=1,typeof M<"u"){if(M===C)throw new RangeError("Cyclic object value");N=!0}typeof S.get(es)>"u"&&(C=0)}if(typeof c=="function"?v=c(e,v):v instanceof Date?v=h==null?void 0:h(v):n==="comma"&&we(v)&&(v=Eo(v,function(M){return M instanceof Date?h==null?void 0:h(M):M})),v===null){if(r)return d&&!g?d(e,te.encoder,T,"key",m):e;v=""}if(Ag(v)||Cg(v)){if(d){const M=g?e:d(e,te.encoder,T,"key",m);return[(_==null?void 0:_(M))+"="+(_==null?void 0:_(d(v,te.encoder,T,"value",m)))]}return[(_==null?void 0:_(e))+"="+(_==null?void 0:_(String(v)))]}const R=[];if(typeof v>"u")return R;let I;if(n==="comma"&&we(v))g&&d&&(v=Eo(v,d)),I=[{value:v.length>0?v.join(",")||null:void 0}];else if(we(c))I=c;else{const M=Object.keys(v);I=f?M.sort(f):M}const q=u?String(e).replace(/\./g,"%2E"):String(e),P=s&&we(v)&&v.length===1?q+"[]":q;if(i&&we(v)&&v.length===0)return P+"[]";for(let M=0;M<I.length;++M){const U=I[M],O=typeof U=="object"&&typeof U.value<"u"?U.value:v[U];if(a&&O===null)continue;const Q=p&&u?U.replace(/\./g,"%2E"):U,H=we(v)?typeof n=="function"?n(P,Q):P:P+(p?"."+Q:"["+Q+"]");w.set(t,C);const pe=new WeakMap;pe.set(es,w),Ua(R,Fa(O,H,n,s,i,r,a,u,n==="comma"&&g&&we(v)?null:d,c,f,p,h,m,_,g,T,pe))}return R}function Rg(t=te){if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.encodeDotInKeys<"u"&&typeof t.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=t.charset||te.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=xs;if(typeof t.format<"u"){if(!Eg.call(Ns,t.format))throw new TypeError("Unknown format option provided.");n=t.format}const s=Ns[n];let i=te.filter;(typeof t.filter=="function"||we(t.filter))&&(i=t.filter);let r;if(t.arrayFormat&&t.arrayFormat in Da?r=t.arrayFormat:"indices"in t?r=t.indices?"indices":"repeat":r=te.arrayFormat,"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const a=typeof t.allowDots>"u"?t.encodeDotInKeys?!0:te.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:te.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:te.allowEmptyArrays,arrayFormat:r,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:te.charsetSentinel,commaRoundTrip:!!t.commaRoundTrip,delimiter:typeof t.delimiter>"u"?te.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:te.encode,encodeDotInKeys:typeof t.encodeDotInKeys=="boolean"?t.encodeDotInKeys:te.encodeDotInKeys,encoder:typeof t.encoder=="function"?t.encoder:te.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:te.encodeValuesOnly,filter:i,format:n,formatter:s,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:te.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:te.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:te.strictNullHandling}}function Pg(t,e={}){let n=t;const s=Rg(e);let i,r;typeof s.filter=="function"?(r=s.filter,n=r("",n)):we(s.filter)&&(r=s.filter,i=r);const a=[];if(typeof n!="object"||n===null)return"";const u=Da[s.arrayFormat],d=u==="comma"&&s.commaRoundTrip;i||(i=Object.keys(n)),s.sort&&i.sort(s.sort);const c=new WeakMap;for(let h=0;h<i.length;++h){const m=i[h];s.skipNulls&&n[m]===null||Ua(a,Fa(n[m],m,u,d,s.allowEmptyArrays,s.strictNullHandling,s.skipNulls,s.encodeDotInKeys,s.encode?s.encoder:null,s.filter,s.sort,s.allowDots,s.serializeDate,s.format,s.formatter,s.encodeValuesOnly,s.charset,c))}const f=a.join(s.delimiter);let p=s.addQueryPrefix===!0?"?":"";return s.charsetSentinel&&(s.charset==="iso-8859-1"?p+="utf8=%26%2310003%3B&":p+="utf8=%E2%9C%93&"),f.length>0?p+f:""}const lt="4.104.0";let wo=!1,Vt,La,$a,Ms,Va,Ga,qa,Ba,Oa;function xg(t,e={auto:!1}){if(wo)throw new Error(`you must \`import 'openai/shims/${t.kind}'\` before importing anything else from openai`);if(Vt)throw new Error(`can't \`import 'openai/shims/${t.kind}'\` after \`import 'openai/shims/${Vt}'\``);wo=e.auto,Vt=t.kind,La=t.fetch,$a=t.FormData,Ms=t.File,Va=t.ReadableStream,Ga=t.getMultipartRequestOptions,qa=t.getDefaultAgent,Ba=t.fileFromPath,Oa=t.isFsReadStream}class Ng{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function Mg({manuallyImported:t}={}){const e=t?"You may need to use polyfills":"Add one of these imports before your first `import  from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let n,s,i,r;try{n=fetch,s=Request,i=Response,r=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:n,Request:s,Response:i,Headers:r,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,u)=>({...u,body:new Ng(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:a=>!1}}const Ha=()=>{Vt||xg(Mg(),{auto:!0})};Ha();class F extends Error{}class re extends F{constructor(e,n,s,i){super(`${re.makeMessage(e,n,s)}`),this.status=e,this.headers=i,this.request_id=i==null?void 0:i["x-request-id"],this.error=n;const r=n;this.code=r==null?void 0:r.code,this.param=r==null?void 0:r.param,this.type=r==null?void 0:r.type}static makeMessage(e,n,s){const i=n!=null&&n.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):n?JSON.stringify(n):s;return e&&i?`${e} ${i}`:e?`${e} status code (no body)`:i||"(no status code or body)"}static generate(e,n,s,i){if(!e||!i)return new Ln({message:s,cause:bs(n)});const r=n==null?void 0:n.error;return e===400?new Ja(e,r,s,i):e===401?new Wa(e,r,s,i):e===403?new Ya(e,r,s,i):e===404?new Ka(e,r,s,i):e===409?new za(e,r,s,i):e===422?new Za(e,r,s,i):e===429?new Xa(e,r,s,i):e>=500?new Qa(e,r,s,i):new re(e,r,s,i)}}class me extends re{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class Ln extends re{constructor({message:e,cause:n}){super(void 0,void 0,e||"Connection error.",void 0),n&&(this.cause=n)}}class Qs extends Ln{constructor({message:e}={}){super({message:e??"Request timed out."})}}class Ja extends re{}class Wa extends re{}class Ya extends re{}class Ka extends re{}class za extends re{}class Za extends re{}class Xa extends re{}class Qa extends re{}class ja extends F{constructor(){super("Could not parse response content as the length limit was reached")}}class el extends F{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var jt=function(t,e,n,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(t,n):i?i.value=n:e.set(t,n),n},Xe=function(t,e,n,s){if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)},ce;class $n{constructor(){ce.set(this,void 0),this.buffer=new Uint8Array,jt(this,ce,null,"f")}decode(e){if(e==null)return[];const n=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e;let s=new Uint8Array(this.buffer.length+n.length);s.set(this.buffer),s.set(n,this.buffer.length),this.buffer=s;const i=[];let r;for(;(r=kg(this.buffer,Xe(this,ce,"f")))!=null;){if(r.carriage&&Xe(this,ce,"f")==null){jt(this,ce,r.index,"f");continue}if(Xe(this,ce,"f")!=null&&(r.index!==Xe(this,ce,"f")+1||r.carriage)){i.push(this.decodeText(this.buffer.slice(0,Xe(this,ce,"f")-1))),this.buffer=this.buffer.slice(Xe(this,ce,"f")),jt(this,ce,null,"f");continue}const a=Xe(this,ce,"f")!==null?r.preceding-1:r.preceding,u=this.decodeText(this.buffer.slice(0,a));i.push(u),this.buffer=this.buffer.slice(r.index),jt(this,ce,null,"f")}return i}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new F(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new F(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new F("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}}ce=new WeakMap;$n.NEWLINE_CHARS=new Set([`
`,"\r"]);$n.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function kg(t,e){for(let i=e??0;i<t.length;i++){if(t[i]===10)return{preceding:i,index:i+1,carriage:!1};if(t[i]===13)return{preceding:i,index:i+1,carriage:!0}}return null}function bg(t){for(let s=0;s<t.length-1;s++){if(t[s]===10&&t[s+1]===10||t[s]===13&&t[s+1]===13)return s+2;if(t[s]===13&&t[s+1]===10&&s+3<t.length&&t[s+2]===13&&t[s+3]===10)return s+4}return-1}function tl(t){if(t[Symbol.asyncIterator])return t;const e=t.getReader();return{async next(){try{const n=await e.read();return n!=null&&n.done&&e.releaseLock(),n}catch(n){throw e.releaseLock(),n}},async return(){const n=e.cancel();return e.releaseLock(),await n,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}class Re{constructor(e,n){this.iterator=e,this.controller=n}static fromSSEResponse(e,n){let s=!1;async function*i(){if(s)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let r=!1;try{for await(const a of Dg(e,n))if(!r){if(a.data.startsWith("[DONE]")){r=!0;continue}if(a.event===null||a.event.startsWith("response.")||a.event.startsWith("transcript.")){let u;try{u=JSON.parse(a.data)}catch(d){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),d}if(u&&u.error)throw new re(void 0,u.error,void 0,ll(e.headers));yield u}else{let u;try{u=JSON.parse(a.data)}catch(d){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),d}if(a.event=="error")throw new re(void 0,u.error,u.message,void 0);yield{event:a.event,data:u}}}r=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{r||n.abort()}}return new Re(i,n)}static fromReadableStream(e,n){let s=!1;async function*i(){const a=new $n,u=tl(e);for await(const d of u)for(const c of a.decode(d))yield c;for(const d of a.flush())yield d}async function*r(){if(s)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let a=!1;try{for await(const u of i())a||u&&(yield JSON.parse(u));a=!0}catch(u){if(u instanceof Error&&u.name==="AbortError")return;throw u}finally{a||n.abort()}}return new Re(r,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],n=[],s=this.iterator(),i=r=>({next:()=>{if(r.length===0){const a=s.next();e.push(a),n.push(a)}return r.shift()}});return[new Re(()=>i(e),this.controller),new Re(()=>i(n),this.controller)]}toReadableStream(){const e=this;let n;const s=new TextEncoder;return new Va({async start(){n=e[Symbol.asyncIterator]()},async pull(i){try{const{value:r,done:a}=await n.next();if(a)return i.close();const u=s.encode(JSON.stringify(r)+`
`);i.enqueue(u)}catch(r){i.error(r)}},async cancel(){var i;await((i=n.return)==null?void 0:i.call(n))}})}}async function*Dg(t,e){if(!t.body)throw e.abort(),new F("Attempted to iterate over a response with no body");const n=new Fg,s=new $n,i=tl(t.body);for await(const r of Ug(i))for(const a of s.decode(r)){const u=n.decode(a);u&&(yield u)}for(const r of s.flush()){const a=n.decode(r);a&&(yield a)}}async function*Ug(t){let e=new Uint8Array;for await(const n of t){if(n==null)continue;const s=n instanceof ArrayBuffer?new Uint8Array(n):typeof n=="string"?new TextEncoder().encode(n):n;let i=new Uint8Array(e.length+s.length);i.set(e),i.set(s,e.length),e=i;let r;for(;(r=bg(e))!==-1;)yield e.slice(0,r),e=e.slice(r)}e.length>0&&(yield e)}class Fg{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const r={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],r}if(this.chunks.push(e),e.startsWith(":"))return null;let[n,s,i]=Lg(e,":");return i.startsWith(" ")&&(i=i.substring(1)),n==="event"?this.event=i:n==="data"&&this.data.push(i),null}}function Lg(t,e){const n=t.indexOf(e);return n!==-1?[t.substring(0,n),e,t.substring(n+e.length)]:[t,"",""]}const nl=t=>t!=null&&typeof t=="object"&&typeof t.url=="string"&&typeof t.blob=="function",sl=t=>t!=null&&typeof t=="object"&&typeof t.name=="string"&&typeof t.lastModified=="number"&&Vn(t),Vn=t=>t!=null&&typeof t=="object"&&typeof t.size=="number"&&typeof t.type=="string"&&typeof t.text=="function"&&typeof t.slice=="function"&&typeof t.arrayBuffer=="function",$g=t=>sl(t)||nl(t)||Oa(t);async function il(t,e,n){var i;if(t=await t,sl(t))return t;if(nl(t)){const r=await t.blob();e||(e=new URL(t.url).pathname.split(/[\\/]/).pop()??"unknown_file");const a=Vn(r)?[await r.arrayBuffer()]:[r];return new Ms(a,e,n)}const s=await Vg(t);if(e||(e=qg(t)??"unknown_file"),!(n!=null&&n.type)){const r=(i=s[0])==null?void 0:i.type;typeof r=="string"&&(n={...n,type:r})}return new Ms(s,e,n)}async function Vg(t){var n;let e=[];if(typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)e.push(t);else if(Vn(t))e.push(await t.arrayBuffer());else if(Bg(t))for await(const s of t)e.push(s);else throw new Error(`Unexpected data type: ${typeof t}; constructor: ${(n=t==null?void 0:t.constructor)==null?void 0:n.name}; props: ${Gg(t)}`);return e}function Gg(t){return`[${Object.getOwnPropertyNames(t).map(n=>`"${n}"`).join(", ")}]`}function qg(t){var e;return ts(t.name)||ts(t.filename)||((e=ts(t.path))==null?void 0:e.split(/[\\/]/).pop())}const ts=t=>{if(typeof t=="string")return t;if(typeof Buffer<"u"&&t instanceof Buffer)return String(t)},Bg=t=>t!=null&&typeof t=="object"&&typeof t[Symbol.asyncIterator]=="function",Io=t=>t&&typeof t=="object"&&t.body&&t[Symbol.toStringTag]==="MultipartBody",tt=async t=>{const e=await Og(t.body);return Ga(e,t)},Og=async t=>{const e=new $a;return await Promise.all(Object.entries(t||{}).map(([n,s])=>ks(e,n,s))),e},ks=async(t,e,n)=>{if(n!==void 0){if(n==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")t.append(e,String(n));else if($g(n)){const s=await il(n);t.append(e,s)}else if(Array.isArray(n))await Promise.all(n.map(s=>ks(t,e+"[]",s)));else if(typeof n=="object")await Promise.all(Object.entries(n).map(([s,i])=>ks(t,`${e}[${s}]`,i)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`)}};var mt={},Hg=function(t,e,n,s,i){if(typeof e=="function"?t!==e||!0:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,n),n},Jg=function(t,e,n,s){if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)},en;Ha();async function rl(t){var a;const{response:e}=t;if(t.options.stream)return Oe("response",e.status,e.url,e.headers,e.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(e,t.controller):Re.fromSSEResponse(e,t.controller);if(e.status===204)return null;if(t.options.__binaryResponse)return e;const n=e.headers.get("content-type"),s=(a=n==null?void 0:n.split(";")[0])==null?void 0:a.trim();if((s==null?void 0:s.includes("application/json"))||(s==null?void 0:s.endsWith("+json"))){const u=await e.json();return Oe("response",e.status,e.url,e.headers,u),ol(u,e)}const r=await e.text();return Oe("response",e.status,e.url,e.headers,r),r}function ol(t,e){return!t||typeof t!="object"||Array.isArray(t)?t:Object.defineProperty(t,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}class Gn extends Promise{constructor(e,n=rl){super(s=>{s(null)}),this.responsePromise=e,this.parseResponse=n}_thenUnwrap(e){return new Gn(this.responsePromise,async n=>ol(e(await this.parseResponse(n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,n]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:n,request_id:n.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,n){return this.parse().then(e,n)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class Wg{constructor({baseURL:e,maxRetries:n=2,timeout:s=6e5,httpAgent:i,fetch:r}){this.baseURL=e,this.maxRetries=ns("maxRetries",n),this.timeout=ns("timeout",s),this.httpAgent=i,this.fetch=r??La}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...Xg(),...this.authHeaders(e)}}validateHeaders(e,n){}defaultIdempotencyKey(){return`stainless-node-retry-${ty()}`}get(e,n){return this.methodRequest("get",e,n)}post(e,n){return this.methodRequest("post",e,n)}patch(e,n){return this.methodRequest("patch",e,n)}put(e,n){return this.methodRequest("put",e,n)}delete(e,n){return this.methodRequest("delete",e,n)}methodRequest(e,n,s){return this.request(Promise.resolve(s).then(async i=>{const r=i&&Vn(i==null?void 0:i.body)?new DataView(await i.body.arrayBuffer()):(i==null?void 0:i.body)instanceof DataView?i.body:(i==null?void 0:i.body)instanceof ArrayBuffer?new DataView(i.body):i&&ArrayBuffer.isView(i==null?void 0:i.body)?new DataView(i.body.buffer):i==null?void 0:i.body;return{method:e,path:n,...i,body:r}}))}getAPIList(e,n,s){return this.requestAPIList(n,{method:"get",path:e,...s})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:n=0}={}){var g;const s={...e},{method:i,path:r,query:a,headers:u={}}=s,d=ArrayBuffer.isView(s.body)||s.__binaryRequest&&typeof s.body=="string"?s.body:Io(s.body)?s.body.body:s.body?JSON.stringify(s.body,null,2):null,c=this.calculateContentLength(d),f=this.buildURL(r,a);"timeout"in s&&ns("timeout",s.timeout),s.timeout=s.timeout??this.timeout;const p=s.httpAgent??this.httpAgent??qa(f),h=s.timeout+1e3;typeof((g=p==null?void 0:p.options)==null?void 0:g.timeout)=="number"&&h>(p.options.timeout??0)&&(p.options.timeout=h),this.idempotencyHeader&&i!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),u[this.idempotencyHeader]=e.idempotencyKey);const m=this.buildHeaders({options:s,headers:u,contentLength:c,retryCount:n});return{req:{method:i,...d&&{body:d},headers:m,...p&&{agent:p},signal:s.signal??null},url:f,timeout:s.timeout}}buildHeaders({options:e,headers:n,contentLength:s,retryCount:i}){const r={};s&&(r["content-length"]=s);const a=this.defaultHeaders(e);return xo(r,a),xo(r,n),Io(e.body)&&Vt!=="node"&&delete r["content-type"],nn(a,"x-stainless-retry-count")===void 0&&nn(n,"x-stainless-retry-count")===void 0&&(r["x-stainless-retry-count"]=String(i)),nn(a,"x-stainless-timeout")===void 0&&nn(n,"x-stainless-timeout")===void 0&&e.timeout&&(r["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(r,n),r}async prepareOptions(e){}async prepareRequest(e,{url:n,options:s}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(n=>[...n])):{...e}:{}}makeStatusError(e,n,s,i){return re.generate(e,n,s,i)}request(e,n=null){return new Gn(this.makeRequest(e,n))}async makeRequest(e,n){var p,h;const s=await e,i=s.maxRetries??this.maxRetries;n==null&&(n=i),await this.prepareOptions(s);const{req:r,url:a,timeout:u}=this.buildRequest(s,{retryCount:i-n});if(await this.prepareRequest(r,{url:a,options:s}),Oe("request",a,s,r.headers),(p=s.signal)!=null&&p.aborted)throw new me;const d=new AbortController,c=await this.fetchWithTimeout(a,r,u,d).catch(bs);if(c instanceof Error){if((h=s.signal)!=null&&h.aborted)throw new me;if(n)return this.retryRequest(s,n);throw c.name==="AbortError"?new Qs:new Ln({cause:c})}const f=ll(c.headers);if(!c.ok){if(n&&this.shouldRetry(c)){const v=`retrying, ${n} attempts remaining`;return Oe(`response (error; ${v})`,c.status,a,f),this.retryRequest(s,n,f)}const m=await c.text().catch(v=>bs(v).message),_=Qg(m),g=_?void 0:m;throw Oe(`response (error; ${n?"(error; no more retries left)":"(error; not retryable)"})`,c.status,a,f,g),this.makeStatusError(c.status,_,g,f)}return{response:c,options:s,controller:d}}requestAPIList(e,n){const s=this.makeRequest(n,null);return new Yg(this,s,e)}buildURL(e,n){const s=ey(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return ul(i)||(n={...i,...n}),typeof n=="object"&&n&&!Array.isArray(n)&&(s.search=this.stringifyQuery(n)),s.toString()}stringifyQuery(e){return Object.entries(e).filter(([n,s])=>typeof s<"u").map(([n,s])=>{if(typeof s=="string"||typeof s=="number"||typeof s=="boolean")return`${encodeURIComponent(n)}=${encodeURIComponent(s)}`;if(s===null)return`${encodeURIComponent(n)}=`;throw new F(`Cannot stringify type ${typeof s}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,n,s,i){const{signal:r,...a}=n||{};r&&r.addEventListener("abort",()=>i.abort());const u=setTimeout(()=>i.abort(),s),d={signal:i.signal,...a};return d.method&&(d.method=d.method.toUpperCase()),this.fetch.call(void 0,e,d).finally(()=>{clearTimeout(u)})}shouldRetry(e){const n=e.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,n,s){let i;const r=s==null?void 0:s["retry-after-ms"];if(r){const u=parseFloat(r);Number.isNaN(u)||(i=u)}const a=s==null?void 0:s["retry-after"];if(a&&!i){const u=parseFloat(a);Number.isNaN(u)?i=Date.parse(a)-Date.now():i=u*1e3}if(!(i&&0<=i&&i<60*1e3)){const u=e.maxRetries??this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(n,u)}return await Jt(i),this.makeRequest(e,n-1)}calculateDefaultRetryTimeoutMillis(e,n){const r=n-e,a=Math.min(.5*Math.pow(2,r),8),u=1-Math.random()*.25;return a*u*1e3}getUserAgent(){return`${this.constructor.name}/JS ${lt}`}}class al{constructor(e,n,s,i){en.set(this,void 0),Hg(this,en,e),this.options=i,this.response=n,this.body=s}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new F("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const n={...this.options};if("params"in e&&typeof n.query=="object")n.query={...n.query,...e.params};else if("url"in e){const s=[...Object.entries(n.query||{}),...e.url.searchParams.entries()];for(const[i,r]of s)e.url.searchParams.set(i,r);n.query=void 0,n.path=e.url.toString()}return await Jg(this,en,"f").requestAPIList(this.constructor,n)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(en=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const n of e.getPaginatedItems())yield n}}class Yg extends Gn{constructor(e,n,s){super(n,async i=>new s(e,i.response,await rl(i),i.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const n of e)yield n}}const ll=t=>new Proxy(Object.fromEntries(t.entries()),{get(e,n){const s=n.toString();return e[s.toLowerCase()]||e[s]}}),Kg={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},X=t=>typeof t=="object"&&t!==null&&!ul(t)&&Object.keys(t).every(e=>cl(Kg,e)),zg=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":lt,"X-Stainless-OS":Ro(Deno.build.os),"X-Stainless-Arch":Ao(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":lt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":lt,"X-Stainless-OS":Ro(process.platform),"X-Stainless-Arch":Ao(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const t=Zg();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":lt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":lt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Zg(){if(typeof navigator>"u"||!navigator)return null;const t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:n}of t){const s=n.exec(navigator.userAgent);if(s){const i=s[1]||0,r=s[2]||0,a=s[3]||0;return{browser:e,version:`${i}.${r}.${a}`}}}return null}const Ao=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",Ro=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown");let Po;const Xg=()=>Po??(Po=zg()),Qg=t=>{try{return JSON.parse(t)}catch{return}},jg=/^[a-z][a-z0-9+.-]*:/i,ey=t=>jg.test(t),Jt=t=>new Promise(e=>setTimeout(e,t)),ns=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new F(`${t} must be an integer`);if(e<0)throw new F(`${t} must be a positive integer`);return e},bs=t=>{if(t instanceof Error)return t;if(typeof t=="object"&&t!==null)try{return new Error(JSON.stringify(t))}catch{}return new Error(t)},tn=t=>{var e,n,s,i;if(typeof process<"u")return((e=mt==null?void 0:mt[t])==null?void 0:e.trim())??void 0;if(typeof Deno<"u")return(i=(s=(n=Deno.env)==null?void 0:n.get)==null?void 0:s.call(n,t))==null?void 0:i.trim()};function ul(t){if(!t)return!0;for(const e in t)return!1;return!0}function cl(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function xo(t,e){for(const n in e){if(!cl(e,n))continue;const s=n.toLowerCase();if(!s)continue;const i=e[n];i===null?delete t[s]:i!==void 0&&(t[s]=i)}}const No=new Set(["authorization","api-key"]);function Oe(t,...e){if(typeof process<"u"&&(mt==null?void 0:mt.DEBUG)==="true"){const n=e.map(s=>{if(!s)return s;if(s.headers){const r={...s,headers:{...s.headers}};for(const a in s.headers)No.has(a.toLowerCase())&&(r.headers[a]="REDACTED");return r}let i=null;for(const r in s)No.has(r.toLowerCase())&&(i??(i={...s}),i[r]="REDACTED");return i??s});console.log(`OpenAI:DEBUG:${t}`,...n)}}const ty=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),ny=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",sy=t=>typeof(t==null?void 0:t.get)=="function",nn=(t,e)=>{var s;const n=e.toLowerCase();if(sy(t)){const i=((s=e[0])==null?void 0:s.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(r,a,u)=>a+u.toUpperCase());for(const r of[e,n,e.toUpperCase(),i]){const a=t.get(r);if(a)return a}}for(const[i,r]of Object.entries(t))if(i.toLowerCase()===n)return Array.isArray(r)?(r.length<=1||console.warn(`Received ${r.length} entries for the ${e} header, using the first entry.`),r[0]):r},iy=t=>{if(typeof Buffer<"u"){const e=Buffer.from(t,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{const e=atob(t),n=e.length,s=new Uint8Array(n);for(let i=0;i<n;i++)s[i]=e.charCodeAt(i);return Array.from(new Float32Array(s.buffer))}};function ss(t){return t!=null&&typeof t=="object"&&!Array.isArray(t)}class qn extends al{constructor(e,n,s,i){super(e,n,s,i),this.data=s.data||[],this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class ne extends al{constructor(e,n,s,i){super(e,n,s,i),this.data=s.data||[],this.has_more=s.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const n=Object.fromEntries(e.url.searchParams);return Object.keys(n).length?n:null}nextPageInfo(){var s;const e=this.getPaginatedItems();if(!e.length)return null;const n=(s=e[e.length-1])==null?void 0:s.id;return n?{params:{after:n}}:null}}class L{constructor(e){this._client=e}}let dl=class extends L{list(e,n={},s){return X(n)?this.list(e,{},n):this._client.getAPIList(`/chat/completions/${e}/messages`,ry,{query:n,...s})}},Bn=class extends L{constructor(){super(...arguments),this.messages=new dl(this._client)}create(e,n){return this._client.post("/chat/completions",{body:e,...n,stream:e.stream??!1})}retrieve(e,n){return this._client.get(`/chat/completions/${e}`,n)}update(e,n,s){return this._client.post(`/chat/completions/${e}`,{body:n,...s})}list(e={},n){return X(e)?this.list({},e):this._client.getAPIList("/chat/completions",On,{query:e,...n})}del(e,n){return this._client.delete(`/chat/completions/${e}`,n)}};class On extends ne{}class ry extends ne{}Bn.ChatCompletionsPage=On;Bn.Messages=dl;let Hn=class extends L{constructor(){super(...arguments),this.completions=new Bn(this._client)}};Hn.Completions=Bn;Hn.ChatCompletionsPage=On;class fl extends L{create(e,n){return this._client.post("/audio/speech",{body:e,...n,headers:{Accept:"application/octet-stream",...n==null?void 0:n.headers},__binaryResponse:!0})}}class pl extends L{create(e,n){return this._client.post("/audio/transcriptions",tt({body:e,...n,stream:e.stream??!1,__metadata:{model:e.model}}))}}class hl extends L{create(e,n){return this._client.post("/audio/translations",tt({body:e,...n,__metadata:{model:e.model}}))}}class Wt extends L{constructor(){super(...arguments),this.transcriptions=new pl(this._client),this.translations=new hl(this._client),this.speech=new fl(this._client)}}Wt.Transcriptions=pl;Wt.Translations=hl;Wt.Speech=fl;class js extends L{create(e,n){return this._client.post("/batches",{body:e,...n})}retrieve(e,n){return this._client.get(`/batches/${e}`,n)}list(e={},n){return X(e)?this.list({},e):this._client.getAPIList("/batches",ei,{query:e,...n})}cancel(e,n){return this._client.post(`/batches/${e}/cancel`,n)}}class ei extends ne{}js.BatchesPage=ei;var Te=function(t,e,n,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(t,n):i?i.value=n:e.set(t,n),n},Z=function(t,e,n,s){if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)},Ds,fn,pn,Mt,kt,hn,bt,Me,Dt,xn,Nn,ut,ml;class ti{constructor(){Ds.add(this),this.controller=new AbortController,fn.set(this,void 0),pn.set(this,()=>{}),Mt.set(this,()=>{}),kt.set(this,void 0),hn.set(this,()=>{}),bt.set(this,()=>{}),Me.set(this,{}),Dt.set(this,!1),xn.set(this,!1),Nn.set(this,!1),ut.set(this,!1),Te(this,fn,new Promise((e,n)=>{Te(this,pn,e,"f"),Te(this,Mt,n,"f")}),"f"),Te(this,kt,new Promise((e,n)=>{Te(this,hn,e,"f"),Te(this,bt,n,"f")}),"f"),Z(this,fn,"f").catch(()=>{}),Z(this,kt,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},Z(this,Ds,"m",ml).bind(this))},0)}_connected(){this.ended||(Z(this,pn,"f").call(this),this._emit("connect"))}get ended(){return Z(this,Dt,"f")}get errored(){return Z(this,xn,"f")}get aborted(){return Z(this,Nn,"f")}abort(){this.controller.abort()}on(e,n){return(Z(this,Me,"f")[e]||(Z(this,Me,"f")[e]=[])).push({listener:n}),this}off(e,n){const s=Z(this,Me,"f")[e];if(!s)return this;const i=s.findIndex(r=>r.listener===n);return i>=0&&s.splice(i,1),this}once(e,n){return(Z(this,Me,"f")[e]||(Z(this,Me,"f")[e]=[])).push({listener:n,once:!0}),this}emitted(e){return new Promise((n,s)=>{Te(this,ut,!0,"f"),e!=="error"&&this.once("error",s),this.once(e,n)})}async done(){Te(this,ut,!0,"f"),await Z(this,kt,"f")}_emit(e,...n){if(Z(this,Dt,"f"))return;e==="end"&&(Te(this,Dt,!0,"f"),Z(this,hn,"f").call(this));const s=Z(this,Me,"f")[e];if(s&&(Z(this,Me,"f")[e]=s.filter(i=>!i.once),s.forEach(({listener:i})=>i(...n))),e==="abort"){const i=n[0];!Z(this,ut,"f")&&!(s!=null&&s.length)&&Promise.reject(i),Z(this,Mt,"f").call(this,i),Z(this,bt,"f").call(this,i),this._emit("end");return}if(e==="error"){const i=n[0];!Z(this,ut,"f")&&!(s!=null&&s.length)&&Promise.reject(i),Z(this,Mt,"f").call(this,i),Z(this,bt,"f").call(this,i),this._emit("end")}}_emitFinal(){}}fn=new WeakMap,pn=new WeakMap,Mt=new WeakMap,kt=new WeakMap,hn=new WeakMap,bt=new WeakMap,Me=new WeakMap,Dt=new WeakMap,xn=new WeakMap,Nn=new WeakMap,ut=new WeakMap,Ds=new WeakSet,ml=function(e){if(Te(this,xn,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new me),e instanceof me)return Te(this,Nn,!0,"f"),this._emit("abort",e);if(e instanceof F)return this._emit("error",e);if(e instanceof Error){const n=new F(e.message);return n.cause=e,this._emit("error",n)}return this._emit("error",new F(String(e)))};var D=function(t,e,n,s){if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)},ue=function(t,e,n,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(t,n):i?i.value=n:e.set(t,n),n},ie,Us,Ie,mn,ve,je,dt,Qe,Mn,de,gn,yn,Gt,Ut,Ft,Mo,ko,bo,Do,Uo,Fo,Lo;class Se extends ti{constructor(){super(...arguments),ie.add(this),Us.set(this,[]),Ie.set(this,{}),mn.set(this,{}),ve.set(this,void 0),je.set(this,void 0),dt.set(this,void 0),Qe.set(this,void 0),Mn.set(this,void 0),de.set(this,void 0),gn.set(this,void 0),yn.set(this,void 0),Gt.set(this,void 0)}[(Us=new WeakMap,Ie=new WeakMap,mn=new WeakMap,ve=new WeakMap,je=new WeakMap,dt=new WeakMap,Qe=new WeakMap,Mn=new WeakMap,de=new WeakMap,gn=new WeakMap,yn=new WeakMap,Gt=new WeakMap,ie=new WeakSet,Symbol.asyncIterator)](){const e=[],n=[];let s=!1;return this.on("event",i=>{const r=n.shift();r?r.resolve(i):e.push(i)}),this.on("end",()=>{s=!0;for(const i of n)i.resolve(void 0);n.length=0}),this.on("abort",i=>{s=!0;for(const r of n)r.reject(i);n.length=0}),this.on("error",i=>{s=!0;for(const r of n)r.reject(i);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((r,a)=>n.push({resolve:r,reject:a})).then(r=>r?{value:r,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const n=new Se;return n._run(()=>n._fromReadableStream(e)),n}async _fromReadableStream(e,n){var r;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),this._connected();const i=Re.fromReadableStream(e,this.controller);for await(const a of i)D(this,ie,"m",Ut).call(this,a);if((r=i.controller.signal)!=null&&r.aborted)throw new me;return this._addRun(D(this,ie,"m",Ft).call(this))}toReadableStream(){return new Re(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,n,s,i,r){const a=new Se;return a._run(()=>a._runToolAssistantStream(e,n,s,i,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,n,s,i,r){var c;const a=r==null?void 0:r.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const u={...i,stream:!0},d=await e.submitToolOutputs(n,s,u,{...r,signal:this.controller.signal});this._connected();for await(const f of d)D(this,ie,"m",Ut).call(this,f);if((c=d.controller.signal)!=null&&c.aborted)throw new me;return this._addRun(D(this,ie,"m",Ft).call(this))}static createThreadAssistantStream(e,n,s){const i=new Se;return i._run(()=>i._threadAssistantStream(e,n,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}static createAssistantStream(e,n,s,i){const r=new Se;return r._run(()=>r._runAssistantStream(e,n,s,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),r}currentEvent(){return D(this,gn,"f")}currentRun(){return D(this,yn,"f")}currentMessageSnapshot(){return D(this,ve,"f")}currentRunStepSnapshot(){return D(this,Gt,"f")}async finalRunSteps(){return await this.done(),Object.values(D(this,Ie,"f"))}async finalMessages(){return await this.done(),Object.values(D(this,mn,"f"))}async finalRun(){if(await this.done(),!D(this,je,"f"))throw Error("Final run was not received.");return D(this,je,"f")}async _createThreadAssistantStream(e,n,s){var u;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const r={...n,stream:!0},a=await e.createAndRun(r,{...s,signal:this.controller.signal});this._connected();for await(const d of a)D(this,ie,"m",Ut).call(this,d);if((u=a.controller.signal)!=null&&u.aborted)throw new me;return this._addRun(D(this,ie,"m",Ft).call(this))}async _createAssistantStream(e,n,s,i){var d;const r=i==null?void 0:i.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const a={...s,stream:!0},u=await e.create(n,a,{...i,signal:this.controller.signal});this._connected();for await(const c of u)D(this,ie,"m",Ut).call(this,c);if((d=u.controller.signal)!=null&&d.aborted)throw new me;return this._addRun(D(this,ie,"m",Ft).call(this))}static accumulateDelta(e,n){for(const[s,i]of Object.entries(n)){if(!e.hasOwnProperty(s)){e[s]=i;continue}let r=e[s];if(r==null){e[s]=i;continue}if(s==="index"||s==="type"){e[s]=i;continue}if(typeof r=="string"&&typeof i=="string")r+=i;else if(typeof r=="number"&&typeof i=="number")r+=i;else if(ss(r)&&ss(i))r=this.accumulateDelta(r,i);else if(Array.isArray(r)&&Array.isArray(i)){if(r.every(a=>typeof a=="string"||typeof a=="number")){r.push(...i);continue}for(const a of i){if(!ss(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);const u=a.index;if(u==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof u!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${u}`);const d=r[u];d==null?r.push(a):r[u]=this.accumulateDelta(d,a)}continue}else throw Error(`Unhandled record type: ${s}, deltaValue: ${i}, accValue: ${r}`);e[s]=r}return e}_addRun(e){return e}async _threadAssistantStream(e,n,s){return await this._createThreadAssistantStream(n,e,s)}async _runAssistantStream(e,n,s,i){return await this._createAssistantStream(n,e,s,i)}async _runToolAssistantStream(e,n,s,i,r){return await this._createToolAssistantStream(s,e,n,i,r)}}Ut=function(e){if(!this.ended)switch(ue(this,gn,e,"f"),D(this,ie,"m",bo).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":D(this,ie,"m",Lo).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":D(this,ie,"m",ko).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":D(this,ie,"m",Mo).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Ft=function(){if(this.ended)throw new F("stream has ended, this shouldn't happen");if(!D(this,je,"f"))throw Error("Final run has not been received");return D(this,je,"f")},Mo=function(e){const[n,s]=D(this,ie,"m",Uo).call(this,e,D(this,ve,"f"));ue(this,ve,n,"f"),D(this,mn,"f")[n.id]=n;for(const i of s){const r=n.content[i.index];(r==null?void 0:r.type)=="text"&&this._emit("textCreated",r.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,n),e.data.delta.content)for(const i of e.data.delta.content){if(i.type=="text"&&i.text){let r=i.text,a=n.content[i.index];if(a&&a.type=="text")this._emit("textDelta",r,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(i.index!=D(this,dt,"f")){if(D(this,Qe,"f"))switch(D(this,Qe,"f").type){case"text":this._emit("textDone",D(this,Qe,"f").text,D(this,ve,"f"));break;case"image_file":this._emit("imageFileDone",D(this,Qe,"f").image_file,D(this,ve,"f"));break}ue(this,dt,i.index,"f")}ue(this,Qe,n.content[i.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(D(this,dt,"f")!==void 0){const i=e.data.content[D(this,dt,"f")];if(i)switch(i.type){case"image_file":this._emit("imageFileDone",i.image_file,D(this,ve,"f"));break;case"text":this._emit("textDone",i.text,D(this,ve,"f"));break}}D(this,ve,"f")&&this._emit("messageDone",e.data),ue(this,ve,void 0,"f")}},ko=function(e){const n=D(this,ie,"m",Do).call(this,e);switch(ue(this,Gt,n,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const s=e.data.delta;if(s.step_details&&s.step_details.type=="tool_calls"&&s.step_details.tool_calls&&n.step_details.type=="tool_calls")for(const r of s.step_details.tool_calls)r.index==D(this,Mn,"f")?this._emit("toolCallDelta",r,n.step_details.tool_calls[r.index]):(D(this,de,"f")&&this._emit("toolCallDone",D(this,de,"f")),ue(this,Mn,r.index,"f"),ue(this,de,n.step_details.tool_calls[r.index],"f"),D(this,de,"f")&&this._emit("toolCallCreated",D(this,de,"f")));this._emit("runStepDelta",e.data.delta,n);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":ue(this,Gt,void 0,"f"),e.data.step_details.type=="tool_calls"&&D(this,de,"f")&&(this._emit("toolCallDone",D(this,de,"f")),ue(this,de,void 0,"f")),this._emit("runStepDone",e.data,n);break}},bo=function(e){D(this,Us,"f").push(e),this._emit("event",e)},Do=function(e){switch(e.event){case"thread.run.step.created":return D(this,Ie,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let n=D(this,Ie,"f")[e.data.id];if(!n)throw Error("Received a RunStepDelta before creation of a snapshot");let s=e.data;if(s.delta){const i=Se.accumulateDelta(n,s.delta);D(this,Ie,"f")[e.data.id]=i}return D(this,Ie,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":D(this,Ie,"f")[e.data.id]=e.data;break}if(D(this,Ie,"f")[e.data.id])return D(this,Ie,"f")[e.data.id];throw new Error("No snapshot available")},Uo=function(e,n){let s=[];switch(e.event){case"thread.message.created":return[e.data,s];case"thread.message.delta":if(!n)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let i=e.data;if(i.delta.content)for(const r of i.delta.content)if(r.index in n.content){let a=n.content[r.index];n.content[r.index]=D(this,ie,"m",Fo).call(this,r,a)}else n.content[r.index]=r,s.push(r);return[n,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(n)return[n,s];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Fo=function(e,n){return Se.accumulateDelta(n,e)},Lo=function(e){switch(ue(this,yn,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":ue(this,je,e.data,"f"),D(this,de,"f")&&(this._emit("toolCallDone",D(this,de,"f")),ue(this,de,void 0,"f"));break}};class ni extends L{create(e,n){return this._client.post("/assistants",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,n){return this._client.get(`/assistants/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,n,s){return this._client.post(`/assistants/${e}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e={},n){return X(e)?this.list({},e):this._client.getAPIList("/assistants",si,{query:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,n){return this._client.delete(`/assistants/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class si extends ne{}ni.AssistantsPage=si;function $o(t){return typeof t.parse=="function"}const gt=t=>(t==null?void 0:t.role)==="assistant",gl=t=>(t==null?void 0:t.role)==="function",yl=t=>(t==null?void 0:t.role)==="tool";function ii(t){return(t==null?void 0:t.$brand)==="auto-parseable-response-format"}function Yt(t){return(t==null?void 0:t.$brand)==="auto-parseable-tool"}function oy(t,e){return!e||!_l(e)?{...t,choices:t.choices.map(n=>({...n,message:{...n.message,parsed:null,...n.message.tool_calls?{tool_calls:n.message.tool_calls}:void 0}}))}:ri(t,e)}function ri(t,e){const n=t.choices.map(s=>{var i;if(s.finish_reason==="length")throw new ja;if(s.finish_reason==="content_filter")throw new el;return{...s,message:{...s.message,...s.message.tool_calls?{tool_calls:((i=s.message.tool_calls)==null?void 0:i.map(r=>ly(e,r)))??void 0}:void 0,parsed:s.message.content&&!s.message.refusal?ay(e,s.message.content):null}}});return{...t,choices:n}}function ay(t,e){var n,s;return((n=t.response_format)==null?void 0:n.type)!=="json_schema"?null:((s=t.response_format)==null?void 0:s.type)==="json_schema"?"$parseRaw"in t.response_format?t.response_format.$parseRaw(e):JSON.parse(e):null}function ly(t,e){var s;const n=(s=t.tools)==null?void 0:s.find(i=>{var r;return((r=i.function)==null?void 0:r.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:Yt(n)?n.$parseRaw(e.function.arguments):n!=null&&n.function.strict?JSON.parse(e.function.arguments):null}}}function uy(t,e){var s;if(!t)return!1;const n=(s=t.tools)==null?void 0:s.find(i=>{var r;return((r=i.function)==null?void 0:r.name)===e.function.name});return Yt(n)||(n==null?void 0:n.function.strict)||!1}function _l(t){var e;return ii(t.response_format)?!0:((e=t.tools)==null?void 0:e.some(n=>Yt(n)||n.type==="function"&&n.function.strict===!0))??!1}function cy(t){for(const e of t??[]){if(e.type!=="function")throw new F(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new F(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var le=function(t,e,n,s){if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)},oe,Fs,kn,Ls,$s,Vs,Tl,Gs;const Vo=10;class vl extends ti{constructor(){super(...arguments),oe.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var s;this._chatCompletions.push(e),this._emit("chatCompletion",e);const n=(s=e.choices[0])==null?void 0:s.message;return n&&this._addMessage(n),e}_addMessage(e,n=!0){if("content"in e||(e.content=null),this.messages.push(e),n){if(this._emit("message",e),(gl(e)||yl(e))&&e.content)this._emit("functionCallResult",e.content);else if(gt(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(gt(e)&&e.tool_calls)for(const s of e.tool_calls)s.type==="function"&&this._emit("functionCall",s.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new F("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),le(this,oe,"m",Fs).call(this)}async finalMessage(){return await this.done(),le(this,oe,"m",kn).call(this)}async finalFunctionCall(){return await this.done(),le(this,oe,"m",Ls).call(this)}async finalFunctionCallResult(){return await this.done(),le(this,oe,"m",$s).call(this)}async totalUsage(){return await this.done(),le(this,oe,"m",Vs).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const n=le(this,oe,"m",kn).call(this);n&&this._emit("finalMessage",n);const s=le(this,oe,"m",Fs).call(this);s&&this._emit("finalContent",s);const i=le(this,oe,"m",Ls).call(this);i&&this._emit("finalFunctionCall",i);const r=le(this,oe,"m",$s).call(this);r!=null&&this._emit("finalFunctionCallResult",r),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",le(this,oe,"m",Vs).call(this))}async _createChatCompletion(e,n,s){const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),le(this,oe,"m",Tl).call(this,n);const r=await e.chat.completions.create({...n,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion(ri(r,n))}async _runChatCompletion(e,n,s){for(const i of n.messages)this._addMessage(i,!1);return await this._createChatCompletion(e,n,s)}async _runFunctions(e,n,s){var h;const i="function",{function_call:r="auto",stream:a,...u}=n,d=typeof r!="string"&&(r==null?void 0:r.name),{maxChatCompletions:c=Vo}=s||{},f={};for(const m of n.functions)f[m.name||m.function.name]=m;const p=n.functions.map(m=>({name:m.name||m.function.name,parameters:m.parameters,description:m.description}));for(const m of n.messages)this._addMessage(m,!1);for(let m=0;m<c;++m){const g=(h=(await this._createChatCompletion(e,{...u,function_call:r,functions:p,messages:[...this.messages]},s)).choices[0])==null?void 0:h.message;if(!g)throw new F("missing message in ChatCompletion response");if(!g.function_call)return;const{name:T,arguments:w}=g.function_call,v=f[T];if(v){if(d&&d!==T){const R=`Invalid function_call: ${JSON.stringify(T)}. ${JSON.stringify(d)} requested. Please try again`;this._addMessage({role:i,name:T,content:R});continue}}else{const R=`Invalid function_call: ${JSON.stringify(T)}. Available options are: ${p.map(I=>JSON.stringify(I.name)).join(", ")}. Please try again`;this._addMessage({role:i,name:T,content:R});continue}let S;try{S=$o(v)?await v.parse(w):w}catch(R){this._addMessage({role:i,name:T,content:R instanceof Error?R.message:String(R)});continue}const C=await v.function(S,this),N=le(this,oe,"m",Gs).call(this,C);if(this._addMessage({role:i,name:T,content:N}),d)return}}async _runTools(e,n,s){var m,_,g;const i="tool",{tool_choice:r="auto",stream:a,...u}=n,d=typeof r!="string"&&((m=r==null?void 0:r.function)==null?void 0:m.name),{maxChatCompletions:c=Vo}=s||{},f=n.tools.map(T=>{if(Yt(T)){if(!T.$callback)throw new F("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:T.$callback,name:T.function.name,description:T.function.description||"",parameters:T.function.parameters,parse:T.$parseRaw,strict:!0}}}return T}),p={};for(const T of f)T.type==="function"&&(p[T.function.name||T.function.function.name]=T.function);const h="tools"in n?f.map(T=>T.type==="function"?{type:"function",function:{name:T.function.name||T.function.function.name,parameters:T.function.parameters,description:T.function.description,strict:T.function.strict}}:T):void 0;for(const T of n.messages)this._addMessage(T,!1);for(let T=0;T<c;++T){const v=(_=(await this._createChatCompletion(e,{...u,tool_choice:r,tools:h,messages:[...this.messages]},s)).choices[0])==null?void 0:_.message;if(!v)throw new F("missing message in ChatCompletion response");if(!((g=v.tool_calls)!=null&&g.length))return;for(const S of v.tool_calls){if(S.type!=="function")continue;const C=S.id,{name:N,arguments:R}=S.function,I=p[N];if(I){if(d&&d!==N){const U=`Invalid tool_call: ${JSON.stringify(N)}. ${JSON.stringify(d)} requested. Please try again`;this._addMessage({role:i,tool_call_id:C,content:U});continue}}else{const U=`Invalid tool_call: ${JSON.stringify(N)}. Available options are: ${Object.keys(p).map(O=>JSON.stringify(O)).join(", ")}. Please try again`;this._addMessage({role:i,tool_call_id:C,content:U});continue}let q;try{q=$o(I)?await I.parse(R):R}catch(U){const O=U instanceof Error?U.message:String(U);this._addMessage({role:i,tool_call_id:C,content:O});continue}const P=await I.function(q,this),M=le(this,oe,"m",Gs).call(this,P);if(this._addMessage({role:i,tool_call_id:C,content:M}),d)return}}}}oe=new WeakSet,Fs=function(){return le(this,oe,"m",kn).call(this).content??null},kn=function(){let e=this.messages.length;for(;e-- >0;){const n=this.messages[e];if(gt(n)){const{function_call:s,...i}=n,r={...i,content:n.content??null,refusal:n.refusal??null};return s&&(r.function_call=s),r}}throw new F("stream ended without producing a ChatCompletionMessage with role=assistant")},Ls=function(){var e,n;for(let s=this.messages.length-1;s>=0;s--){const i=this.messages[s];if(gt(i)&&(i!=null&&i.function_call))return i.function_call;if(gt(i)&&((e=i==null?void 0:i.tool_calls)!=null&&e.length))return(n=i.tool_calls.at(-1))==null?void 0:n.function}},$s=function(){for(let e=this.messages.length-1;e>=0;e--){const n=this.messages[e];if(gl(n)&&n.content!=null||yl(n)&&n.content!=null&&typeof n.content=="string"&&this.messages.some(s=>{var i;return s.role==="assistant"&&((i=s.tool_calls)==null?void 0:i.some(r=>r.type==="function"&&r.id===n.tool_call_id))}))return n.content}},Vs=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:n}of this._chatCompletions)n&&(e.completion_tokens+=n.completion_tokens,e.prompt_tokens+=n.prompt_tokens,e.total_tokens+=n.total_tokens);return e},Tl=function(e){if(e.n!=null&&e.n>1)throw new F("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Gs=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class Ot extends vl{static runFunctions(e,n,s){const i=new Ot,r={...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"runFunctions"}};return i._run(()=>i._runFunctions(e,n,r)),i}static runTools(e,n,s){const i=new Ot,r={...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,n,r)),i}_addMessage(e,n=!0){super._addMessage(e,n),gt(e)&&e.content&&this._emit("content",e.content)}}const Sl=1,Cl=2,El=4,wl=8,Il=16,Al=32,Rl=64,Pl=128,xl=256,Nl=Pl|xl,Ml=Il|Al|Nl|Rl,kl=Sl|Cl|Ml,bl=El|wl,dy=kl|bl,se={STR:Sl,NUM:Cl,ARR:El,OBJ:wl,NULL:Il,BOOL:Al,NAN:Rl,INFINITY:Pl,MINUS_INFINITY:xl,INF:Nl,SPECIAL:Ml,ATOM:kl,COLLECTION:bl,ALL:dy};class fy extends Error{}class py extends Error{}function hy(t,e=se.ALL){if(typeof t!="string")throw new TypeError(`expecting str, got ${typeof t}`);if(!t.trim())throw new Error(`${t} is empty`);return my(t.trim(),e)}const my=(t,e)=>{const n=t.length;let s=0;const i=h=>{throw new fy(`${h} at position ${s}`)},r=h=>{throw new py(`${h} at position ${s}`)},a=()=>(p(),s>=n&&i("Unexpected end of input"),t[s]==='"'?u():t[s]==="{"?d():t[s]==="["?c():t.substring(s,s+4)==="null"||se.NULL&e&&n-s<4&&"null".startsWith(t.substring(s))?(s+=4,null):t.substring(s,s+4)==="true"||se.BOOL&e&&n-s<4&&"true".startsWith(t.substring(s))?(s+=4,!0):t.substring(s,s+5)==="false"||se.BOOL&e&&n-s<5&&"false".startsWith(t.substring(s))?(s+=5,!1):t.substring(s,s+8)==="Infinity"||se.INFINITY&e&&n-s<8&&"Infinity".startsWith(t.substring(s))?(s+=8,1/0):t.substring(s,s+9)==="-Infinity"||se.MINUS_INFINITY&e&&1<n-s&&n-s<9&&"-Infinity".startsWith(t.substring(s))?(s+=9,-1/0):t.substring(s,s+3)==="NaN"||se.NAN&e&&n-s<3&&"NaN".startsWith(t.substring(s))?(s+=3,NaN):f()),u=()=>{const h=s;let m=!1;for(s++;s<n&&(t[s]!=='"'||m&&t[s-1]==="\\");)m=t[s]==="\\"?!m:!1,s++;if(t.charAt(s)=='"')try{return JSON.parse(t.substring(h,++s-Number(m)))}catch(_){r(String(_))}else if(se.STR&e)try{return JSON.parse(t.substring(h,s-Number(m))+'"')}catch{return JSON.parse(t.substring(h,t.lastIndexOf("\\"))+'"')}i("Unterminated string literal")},d=()=>{s++,p();const h={};try{for(;t[s]!=="}";){if(p(),s>=n&&se.OBJ&e)return h;const m=u();p(),s++;try{const _=a();Object.defineProperty(h,m,{value:_,writable:!0,enumerable:!0,configurable:!0})}catch(_){if(se.OBJ&e)return h;throw _}p(),t[s]===","&&s++}}catch{if(se.OBJ&e)return h;i("Expected '}' at end of object")}return s++,h},c=()=>{s++;const h=[];try{for(;t[s]!=="]";)h.push(a()),p(),t[s]===","&&s++}catch{if(se.ARR&e)return h;i("Expected ']' at end of array")}return s++,h},f=()=>{if(s===0){t==="-"&&se.NUM&e&&i("Not sure what '-' is");try{return JSON.parse(t)}catch(m){if(se.NUM&e)try{return t[t.length-1]==="."?JSON.parse(t.substring(0,t.lastIndexOf("."))):JSON.parse(t.substring(0,t.lastIndexOf("e")))}catch{}r(String(m))}}const h=s;for(t[s]==="-"&&s++;t[s]&&!",]}".includes(t[s]);)s++;s==n&&!(se.NUM&e)&&i("Unterminated number literal");try{return JSON.parse(t.substring(h,s))}catch{t.substring(h,s)==="-"&&se.NUM&e&&i("Not sure what '-' is");try{return JSON.parse(t.substring(h,t.lastIndexOf("e")))}catch(_){r(String(_))}}},p=()=>{for(;s<n&&` 
\r	`.includes(t[s]);)s++};return a()},Go=t=>hy(t,se.ALL^se.NUM);var st=function(t,e,n,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(t,n):i?i.value=n:e.set(t,n),n},K=function(t,e,n,s){if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)},ee,Ne,it,Le,is,sn,rs,os,as,rn,ls,qo;class Ht extends vl{constructor(e){super(),ee.add(this),Ne.set(this,void 0),it.set(this,void 0),Le.set(this,void 0),st(this,Ne,e,"f"),st(this,it,[],"f")}get currentChatCompletionSnapshot(){return K(this,Le,"f")}static fromReadableStream(e){const n=new Ht(null);return n._run(()=>n._fromReadableStream(e)),n}static createChatCompletion(e,n,s){const i=new Ht(n);return i._run(()=>i._runChatCompletion(e,{...n,stream:!0},{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createChatCompletion(e,n,s){var a;super._createChatCompletion;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),K(this,ee,"m",is).call(this);const r=await e.chat.completions.create({...n,stream:!0},{...s,signal:this.controller.signal});this._connected();for await(const u of r)K(this,ee,"m",rs).call(this,u);if((a=r.controller.signal)!=null&&a.aborted)throw new me;return this._addChatCompletion(K(this,ee,"m",rn).call(this))}async _fromReadableStream(e,n){var a;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),K(this,ee,"m",is).call(this),this._connected();const i=Re.fromReadableStream(e,this.controller);let r;for await(const u of i)r&&r!==u.id&&this._addChatCompletion(K(this,ee,"m",rn).call(this)),K(this,ee,"m",rs).call(this,u),r=u.id;if((a=i.controller.signal)!=null&&a.aborted)throw new me;return this._addChatCompletion(K(this,ee,"m",rn).call(this))}[(Ne=new WeakMap,it=new WeakMap,Le=new WeakMap,ee=new WeakSet,is=function(){this.ended||st(this,Le,void 0,"f")},sn=function(n){let s=K(this,it,"f")[n.index];return s||(s={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},K(this,it,"f")[n.index]=s,s)},rs=function(n){var i,r,a,u,d,c,f,p,h,m,_,g,T,w,v;if(this.ended)return;const s=K(this,ee,"m",qo).call(this,n);this._emit("chunk",n,s);for(const S of n.choices){const C=s.choices[S.index];S.delta.content!=null&&((i=C.message)==null?void 0:i.role)==="assistant"&&((r=C.message)!=null&&r.content)&&(this._emit("content",S.delta.content,C.message.content),this._emit("content.delta",{delta:S.delta.content,snapshot:C.message.content,parsed:C.message.parsed})),S.delta.refusal!=null&&((a=C.message)==null?void 0:a.role)==="assistant"&&((u=C.message)!=null&&u.refusal)&&this._emit("refusal.delta",{delta:S.delta.refusal,snapshot:C.message.refusal}),((d=S.logprobs)==null?void 0:d.content)!=null&&((c=C.message)==null?void 0:c.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(f=S.logprobs)==null?void 0:f.content,snapshot:((p=C.logprobs)==null?void 0:p.content)??[]}),((h=S.logprobs)==null?void 0:h.refusal)!=null&&((m=C.message)==null?void 0:m.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(_=S.logprobs)==null?void 0:_.refusal,snapshot:((g=C.logprobs)==null?void 0:g.refusal)??[]});const N=K(this,ee,"m",sn).call(this,C);C.finish_reason&&(K(this,ee,"m",as).call(this,C),N.current_tool_call_index!=null&&K(this,ee,"m",os).call(this,C,N.current_tool_call_index));for(const R of S.delta.tool_calls??[])N.current_tool_call_index!==R.index&&(K(this,ee,"m",as).call(this,C),N.current_tool_call_index!=null&&K(this,ee,"m",os).call(this,C,N.current_tool_call_index)),N.current_tool_call_index=R.index;for(const R of S.delta.tool_calls??[]){const I=(T=C.message.tool_calls)==null?void 0:T[R.index];I!=null&&I.type&&((I==null?void 0:I.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(w=I.function)==null?void 0:w.name,index:R.index,arguments:I.function.arguments,parsed_arguments:I.function.parsed_arguments,arguments_delta:((v=R.function)==null?void 0:v.arguments)??""}):(I==null||I.type,void 0))}}},os=function(n,s){var a,u,d;if(K(this,ee,"m",sn).call(this,n).done_tool_calls.has(s))return;const r=(a=n.message.tool_calls)==null?void 0:a[s];if(!r)throw new Error("no tool call snapshot");if(!r.type)throw new Error("tool call snapshot missing `type`");if(r.type==="function"){const c=(d=(u=K(this,Ne,"f"))==null?void 0:u.tools)==null?void 0:d.find(f=>f.type==="function"&&f.function.name===r.function.name);this._emit("tool_calls.function.arguments.done",{name:r.function.name,index:s,arguments:r.function.arguments,parsed_arguments:Yt(c)?c.$parseRaw(r.function.arguments):c!=null&&c.function.strict?JSON.parse(r.function.arguments):null})}else r.type},as=function(n){var i,r;const s=K(this,ee,"m",sn).call(this,n);if(n.message.content&&!s.content_done){s.content_done=!0;const a=K(this,ee,"m",ls).call(this);this._emit("content.done",{content:n.message.content,parsed:a?a.$parseRaw(n.message.content):null})}n.message.refusal&&!s.refusal_done&&(s.refusal_done=!0,this._emit("refusal.done",{refusal:n.message.refusal})),(i=n.logprobs)!=null&&i.content&&!s.logprobs_content_done&&(s.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:n.logprobs.content})),(r=n.logprobs)!=null&&r.refusal&&!s.logprobs_refusal_done&&(s.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:n.logprobs.refusal}))},rn=function(){if(this.ended)throw new F("stream has ended, this shouldn't happen");const n=K(this,Le,"f");if(!n)throw new F("request ended without sending any chunks");return st(this,Le,void 0,"f"),st(this,it,[],"f"),gy(n,K(this,Ne,"f"))},ls=function(){var s;const n=(s=K(this,Ne,"f"))==null?void 0:s.response_format;return ii(n)?n:null},qo=function(n){var s,i,r,a;let u=K(this,Le,"f");const{choices:d,...c}=n;u?Object.assign(u,c):u=st(this,Le,{...c,choices:[]},"f");for(const{delta:f,finish_reason:p,index:h,logprobs:m=null,..._}of n.choices){let g=u.choices[h];if(g||(g=u.choices[h]={finish_reason:p,index:h,message:{},logprobs:m,..._}),m)if(!g.logprobs)g.logprobs=Object.assign({},m);else{const{content:R,refusal:I,...q}=m;Object.assign(g.logprobs,q),R&&((s=g.logprobs).content??(s.content=[]),g.logprobs.content.push(...R)),I&&((i=g.logprobs).refusal??(i.refusal=[]),g.logprobs.refusal.push(...I))}if(p&&(g.finish_reason=p,K(this,Ne,"f")&&_l(K(this,Ne,"f")))){if(p==="length")throw new ja;if(p==="content_filter")throw new el}if(Object.assign(g,_),!f)continue;const{content:T,refusal:w,function_call:v,role:S,tool_calls:C,...N}=f;if(Object.assign(g.message,N),w&&(g.message.refusal=(g.message.refusal||"")+w),S&&(g.message.role=S),v&&(g.message.function_call?(v.name&&(g.message.function_call.name=v.name),v.arguments&&((r=g.message.function_call).arguments??(r.arguments=""),g.message.function_call.arguments+=v.arguments)):g.message.function_call=v),T&&(g.message.content=(g.message.content||"")+T,!g.message.refusal&&K(this,ee,"m",ls).call(this)&&(g.message.parsed=Go(g.message.content))),C){g.message.tool_calls||(g.message.tool_calls=[]);for(const{index:R,id:I,type:q,function:P,...M}of C){const U=(a=g.message.tool_calls)[R]??(a[R]={});Object.assign(U,M),I&&(U.id=I),q&&(U.type=q),P&&(U.function??(U.function={name:P.name??"",arguments:""})),P!=null&&P.name&&(U.function.name=P.name),P!=null&&P.arguments&&(U.function.arguments+=P.arguments,uy(K(this,Ne,"f"),U)&&(U.function.parsed_arguments=Go(U.function.arguments)))}}}return u},Symbol.asyncIterator)](){const e=[],n=[];let s=!1;return this.on("chunk",i=>{const r=n.shift();r?r.resolve(i):e.push(i)}),this.on("end",()=>{s=!0;for(const i of n)i.resolve(void 0);n.length=0}),this.on("abort",i=>{s=!0;for(const r of n)r.reject(i);n.length=0}),this.on("error",i=>{s=!0;for(const r of n)r.reject(i);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((r,a)=>n.push({resolve:r,reject:a})).then(r=>r?{value:r,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Re(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function gy(t,e){const{id:n,choices:s,created:i,model:r,system_fingerprint:a,...u}=t,d={...u,id:n,choices:s.map(({message:c,finish_reason:f,index:p,logprobs:h,...m})=>{if(!f)throw new F(`missing finish_reason for choice ${p}`);const{content:_=null,function_call:g,tool_calls:T,...w}=c,v=c.role;if(!v)throw new F(`missing role for choice ${p}`);if(g){const{arguments:S,name:C}=g;if(S==null)throw new F(`missing function_call.arguments for choice ${p}`);if(!C)throw new F(`missing function_call.name for choice ${p}`);return{...m,message:{content:_,function_call:{arguments:S,name:C},role:v,refusal:c.refusal??null},finish_reason:f,index:p,logprobs:h}}return T?{...m,index:p,finish_reason:f,logprobs:h,message:{...w,role:v,content:_,refusal:c.refusal??null,tool_calls:T.map((S,C)=>{const{function:N,type:R,id:I,...q}=S,{arguments:P,name:M,...U}=N||{};if(I==null)throw new F(`missing choices[${p}].tool_calls[${C}].id
${on(t)}`);if(R==null)throw new F(`missing choices[${p}].tool_calls[${C}].type
${on(t)}`);if(M==null)throw new F(`missing choices[${p}].tool_calls[${C}].function.name
${on(t)}`);if(P==null)throw new F(`missing choices[${p}].tool_calls[${C}].function.arguments
${on(t)}`);return{...q,id:I,type:R,function:{...U,name:M,arguments:P}}})}}:{...m,message:{...w,content:_,role:v,refusal:c.refusal??null},finish_reason:f,index:p,logprobs:h}}),created:i,model:r,object:"chat.completion",...a?{system_fingerprint:a}:{}};return oy(d,e)}function on(t){return JSON.stringify(t)}class yt extends Ht{static fromReadableStream(e){const n=new yt(null);return n._run(()=>n._fromReadableStream(e)),n}static runFunctions(e,n,s){const i=new yt(null),r={...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"runFunctions"}};return i._run(()=>i._runFunctions(e,n,r)),i}static runTools(e,n,s){const i=new yt(n),r={...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,n,r)),i}}let Dl=class extends L{parse(e,n){return cy(e.tools),this._client.chat.completions.create(e,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(s=>ri(s,e))}runFunctions(e,n){return e.stream?yt.runFunctions(this._client,e,n):Ot.runFunctions(this._client,e,n)}runTools(e,n){return e.stream?yt.runTools(this._client,e,n):Ot.runTools(this._client,e,n)}stream(e,n){return Ht.createChatCompletion(this._client,e,n)}};class qs extends L{constructor(){super(...arguments),this.completions=new Dl(this._client)}}(function(t){t.Completions=Dl})(qs||(qs={}));class Ul extends L{create(e,n){return this._client.post("/realtime/sessions",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Fl extends L{create(e,n){return this._client.post("/realtime/transcription_sessions",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Jn extends L{constructor(){super(...arguments),this.sessions=new Ul(this._client),this.transcriptionSessions=new Fl(this._client)}}Jn.Sessions=Ul;Jn.TranscriptionSessions=Fl;class oi extends L{create(e,n,s){return this._client.post(`/threads/${e}/messages`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}retrieve(e,n,s){return this._client.get(`/threads/${e}/messages/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}update(e,n,s,i){return this._client.post(`/threads/${e}/messages/${n}`,{body:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,n={},s){return X(n)?this.list(e,{},n):this._client.getAPIList(`/threads/${e}/messages`,ai,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}del(e,n,s){return this._client.delete(`/threads/${e}/messages/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class ai extends ne{}oi.MessagesPage=ai;class li extends L{retrieve(e,n,s,i={},r){return X(i)?this.retrieve(e,n,s,{},i):this._client.get(`/threads/${e}/runs/${n}/steps/${s}`,{query:i,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,n,s={},i){return X(s)?this.list(e,n,{},s):this._client.getAPIList(`/threads/${e}/runs/${n}/steps`,ui,{query:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}}class ui extends ne{}li.RunStepsPage=ui;let Kt=class extends L{constructor(){super(...arguments),this.steps=new li(this._client)}create(e,n,s){const{include:i,...r}=n;return this._client.post(`/threads/${e}/runs`,{query:{include:i},body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:n.stream??!1})}retrieve(e,n,s){return this._client.get(`/threads/${e}/runs/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}update(e,n,s,i){return this._client.post(`/threads/${e}/runs/${n}`,{body:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,n={},s){return X(n)?this.list(e,{},n):this._client.getAPIList(`/threads/${e}/runs`,ci,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}cancel(e,n,s){return this._client.post(`/threads/${e}/runs/${n}/cancel`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async createAndPoll(e,n,s){const i=await this.create(e,n,s);return await this.poll(e,i.id,s)}createAndStream(e,n,s){return Se.createAssistantStream(e,this._client.beta.threads.runs,n,s)}async poll(e,n,s){const i={...s==null?void 0:s.headers,"X-Stainless-Poll-Helper":"true"};for(s!=null&&s.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){const{data:r,response:a}=await this.retrieve(e,n,{...s,headers:{...s==null?void 0:s.headers,...i}}).withResponse();switch(r.status){case"queued":case"in_progress":case"cancelling":let u=5e3;if(s!=null&&s.pollIntervalMs)u=s.pollIntervalMs;else{const d=a.headers.get("openai-poll-after-ms");if(d){const c=parseInt(d);isNaN(c)||(u=c)}}await Jt(u);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return r}}}stream(e,n,s){return Se.createAssistantStream(e,this._client.beta.threads.runs,n,s)}submitToolOutputs(e,n,s,i){return this._client.post(`/threads/${e}/runs/${n}/submit_tool_outputs`,{body:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers},stream:s.stream??!1})}async submitToolOutputsAndPoll(e,n,s,i){const r=await this.submitToolOutputs(e,n,s,i);return await this.poll(e,r.id,i)}submitToolOutputsStream(e,n,s,i){return Se.createToolAssistantStream(e,n,this._client.beta.threads.runs,s,i)}};class ci extends ne{}Kt.RunsPage=ci;Kt.Steps=li;Kt.RunStepsPage=ui;class At extends L{constructor(){super(...arguments),this.runs=new Kt(this._client),this.messages=new oi(this._client)}create(e={},n){return X(e)?this.create({},e):this._client.post("/threads",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,n){return this._client.get(`/threads/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,n,s){return this._client.post(`/threads/${e}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}del(e,n){return this._client.delete(`/threads/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}createAndRun(e,n){return this._client.post("/threads/runs",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:e.stream??!1})}async createAndRunPoll(e,n){const s=await this.createAndRun(e,n);return await this.runs.poll(s.thread_id,s.id,n)}createAndRunStream(e,n){return Se.createThreadAssistantStream(e,this._client.beta.threads,n)}}At.Runs=Kt;At.RunsPage=ci;At.Messages=oi;At.MessagesPage=ai;class Rt extends L{constructor(){super(...arguments),this.realtime=new Jn(this._client),this.chat=new qs(this._client),this.assistants=new ni(this._client),this.threads=new At(this._client)}}Rt.Realtime=Jn;Rt.Assistants=ni;Rt.AssistantsPage=si;Rt.Threads=At;class Ll extends L{create(e,n){return this._client.post("/completions",{body:e,...n,stream:e.stream??!1})}}class $l extends L{retrieve(e,n,s){return this._client.get(`/containers/${e}/files/${n}/content`,{...s,headers:{Accept:"application/binary",...s==null?void 0:s.headers},__binaryResponse:!0})}}let Wn=class extends L{constructor(){super(...arguments),this.content=new $l(this._client)}create(e,n,s){return this._client.post(`/containers/${e}/files`,tt({body:n,...s}))}retrieve(e,n,s){return this._client.get(`/containers/${e}/files/${n}`,s)}list(e,n={},s){return X(n)?this.list(e,{},n):this._client.getAPIList(`/containers/${e}/files`,di,{query:n,...s})}del(e,n,s){return this._client.delete(`/containers/${e}/files/${n}`,{...s,headers:{Accept:"*/*",...s==null?void 0:s.headers}})}};class di extends ne{}Wn.FileListResponsesPage=di;Wn.Content=$l;class zt extends L{constructor(){super(...arguments),this.files=new Wn(this._client)}create(e,n){return this._client.post("/containers",{body:e,...n})}retrieve(e,n){return this._client.get(`/containers/${e}`,n)}list(e={},n){return X(e)?this.list({},e):this._client.getAPIList("/containers",fi,{query:e,...n})}del(e,n){return this._client.delete(`/containers/${e}`,{...n,headers:{Accept:"*/*",...n==null?void 0:n.headers}})}}class fi extends ne{}zt.ContainerListResponsesPage=fi;zt.Files=Wn;zt.FileListResponsesPage=di;class Vl extends L{create(e,n){const s=!!e.encoding_format;let i=s?e.encoding_format:"base64";s&&Oe("Request","User defined encoding_format:",e.encoding_format);const r=this._client.post("/embeddings",{body:{...e,encoding_format:i},...n});return s?r:(Oe("response","Decoding base64 embeddings to float32 array"),r._thenUnwrap(a=>(a&&a.data&&a.data.forEach(u=>{const d=u.embedding;u.embedding=iy(d)}),a)))}}class pi extends L{retrieve(e,n,s,i){return this._client.get(`/evals/${e}/runs/${n}/output_items/${s}`,i)}list(e,n,s={},i){return X(s)?this.list(e,n,{},s):this._client.getAPIList(`/evals/${e}/runs/${n}/output_items`,hi,{query:s,...i})}}class hi extends ne{}pi.OutputItemListResponsesPage=hi;class Zt extends L{constructor(){super(...arguments),this.outputItems=new pi(this._client)}create(e,n,s){return this._client.post(`/evals/${e}/runs`,{body:n,...s})}retrieve(e,n,s){return this._client.get(`/evals/${e}/runs/${n}`,s)}list(e,n={},s){return X(n)?this.list(e,{},n):this._client.getAPIList(`/evals/${e}/runs`,mi,{query:n,...s})}del(e,n,s){return this._client.delete(`/evals/${e}/runs/${n}`,s)}cancel(e,n,s){return this._client.post(`/evals/${e}/runs/${n}`,s)}}class mi extends ne{}Zt.RunListResponsesPage=mi;Zt.OutputItems=pi;Zt.OutputItemListResponsesPage=hi;class Xt extends L{constructor(){super(...arguments),this.runs=new Zt(this._client)}create(e,n){return this._client.post("/evals",{body:e,...n})}retrieve(e,n){return this._client.get(`/evals/${e}`,n)}update(e,n,s){return this._client.post(`/evals/${e}`,{body:n,...s})}list(e={},n){return X(e)?this.list({},e):this._client.getAPIList("/evals",gi,{query:e,...n})}del(e,n){return this._client.delete(`/evals/${e}`,n)}}class gi extends ne{}Xt.EvalListResponsesPage=gi;Xt.Runs=Zt;Xt.RunListResponsesPage=mi;let yi=class extends L{create(e,n){return this._client.post("/files",tt({body:e,...n}))}retrieve(e,n){return this._client.get(`/files/${e}`,n)}list(e={},n){return X(e)?this.list({},e):this._client.getAPIList("/files",_i,{query:e,...n})}del(e,n){return this._client.delete(`/files/${e}`,n)}content(e,n){return this._client.get(`/files/${e}/content`,{...n,headers:{Accept:"application/binary",...n==null?void 0:n.headers},__binaryResponse:!0})}retrieveContent(e,n){return this._client.get(`/files/${e}/content`,n)}async waitForProcessing(e,{pollInterval:n=5e3,maxWait:s=1800*1e3}={}){const i=new Set(["processed","error","deleted"]),r=Date.now();let a=await this.retrieve(e);for(;!a.status||!i.has(a.status);)if(await Jt(n),a=await this.retrieve(e),Date.now()-r>s)throw new Qs({message:`Giving up on waiting for file ${e} to finish processing after ${s} milliseconds.`});return a}};class _i extends ne{}yi.FileObjectsPage=_i;class Gl extends L{}let ql=class extends L{run(e,n){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...n})}validate(e,n){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...n})}};class Ti extends L{constructor(){super(...arguments),this.graders=new ql(this._client)}}Ti.Graders=ql;class vi extends L{create(e,n,s){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,Si,{body:n,method:"post",...s})}retrieve(e,n={},s){return X(n)?this.retrieve(e,{},n):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:n,...s})}del(e,n,s){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions/${n}`,s)}}class Si extends qn{}vi.PermissionCreateResponsesPage=Si;let Yn=class extends L{constructor(){super(...arguments),this.permissions=new vi(this._client)}};Yn.Permissions=vi;Yn.PermissionCreateResponsesPage=Si;class Ci extends L{list(e,n={},s){return X(n)?this.list(e,{},n):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Ei,{query:n,...s})}}class Ei extends ne{}Ci.FineTuningJobCheckpointsPage=Ei;class Pt extends L{constructor(){super(...arguments),this.checkpoints=new Ci(this._client)}create(e,n){return this._client.post("/fine_tuning/jobs",{body:e,...n})}retrieve(e,n){return this._client.get(`/fine_tuning/jobs/${e}`,n)}list(e={},n){return X(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",wi,{query:e,...n})}cancel(e,n){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,n)}listEvents(e,n={},s){return X(n)?this.listEvents(e,{},n):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Ii,{query:n,...s})}pause(e,n){return this._client.post(`/fine_tuning/jobs/${e}/pause`,n)}resume(e,n){return this._client.post(`/fine_tuning/jobs/${e}/resume`,n)}}class wi extends ne{}class Ii extends ne{}Pt.FineTuningJobsPage=wi;Pt.FineTuningJobEventsPage=Ii;Pt.Checkpoints=Ci;Pt.FineTuningJobCheckpointsPage=Ei;class ze extends L{constructor(){super(...arguments),this.methods=new Gl(this._client),this.jobs=new Pt(this._client),this.checkpoints=new Yn(this._client),this.alpha=new Ti(this._client)}}ze.Methods=Gl;ze.Jobs=Pt;ze.FineTuningJobsPage=wi;ze.FineTuningJobEventsPage=Ii;ze.Checkpoints=Yn;ze.Alpha=Ti;class Bl extends L{}class Ai extends L{constructor(){super(...arguments),this.graderModels=new Bl(this._client)}}Ai.GraderModels=Bl;class Ol extends L{createVariation(e,n){return this._client.post("/images/variations",tt({body:e,...n}))}edit(e,n){return this._client.post("/images/edits",tt({body:e,...n}))}generate(e,n){return this._client.post("/images/generations",{body:e,...n})}}class Ri extends L{retrieve(e,n){return this._client.get(`/models/${e}`,n)}list(e){return this._client.getAPIList("/models",Pi,e)}del(e,n){return this._client.delete(`/models/${e}`,n)}}class Pi extends qn{}Ri.ModelsPage=Pi;class Hl extends L{create(e,n){return this._client.post("/moderations",{body:e,...n})}}function yy(t,e){return!e||!Ty(e)?{...t,output_parsed:null,output:t.output.map(n=>n.type==="function_call"?{...n,parsed_arguments:null}:n.type==="message"?{...n,content:n.content.map(s=>({...s,parsed:null}))}:n)}:Jl(t,e)}function Jl(t,e){const n=t.output.map(i=>{if(i.type==="function_call")return{...i,parsed_arguments:Cy(e,i)};if(i.type==="message"){const r=i.content.map(a=>a.type==="output_text"?{...a,parsed:_y(e,a.text)}:a);return{...i,content:r}}return i}),s=Object.assign({},t,{output:n});return Object.getOwnPropertyDescriptor(t,"output_text")||Wl(s),Object.defineProperty(s,"output_parsed",{enumerable:!0,get(){for(const i of s.output)if(i.type==="message"){for(const r of i.content)if(r.type==="output_text"&&r.parsed!==null)return r.parsed}return null}}),s}function _y(t,e){var n,s,i,r;return((s=(n=t.text)==null?void 0:n.format)==null?void 0:s.type)!=="json_schema"?null:"$parseRaw"in((i=t.text)==null?void 0:i.format)?((r=t.text)==null?void 0:r.format).$parseRaw(e):JSON.parse(e)}function Ty(t){var e;return!!ii((e=t.text)==null?void 0:e.format)}function vy(t){return(t==null?void 0:t.$brand)==="auto-parseable-tool"}function Sy(t,e){return t.find(n=>n.type==="function"&&n.name===e)}function Cy(t,e){const n=Sy(t.tools??[],e.name);return{...e,...e,parsed_arguments:vy(n)?n.$parseRaw(e.arguments):n!=null&&n.strict?JSON.parse(e.arguments):null}}function Wl(t){const e=[];for(const n of t.output)if(n.type==="message")for(const s of n.content)s.type==="output_text"&&e.push(s.text);t.output_text=e.join("")}class Yl extends L{list(e,n={},s){return X(n)?this.list(e,{},n):this._client.getAPIList(`/responses/${e}/input_items`,wy,{query:n,...s})}}var rt=function(t,e,n,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(t,n):i?i.value=n:e.set(t,n),n},$e=function(t,e,n,s){if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)},ot,an,Ve,ln,Bo,Oo,Ho,Jo;class xi extends ti{constructor(e){super(),ot.add(this),an.set(this,void 0),Ve.set(this,void 0),ln.set(this,void 0),rt(this,an,e,"f")}static createResponse(e,n,s){const i=new xi(n);return i._run(()=>i._createOrRetrieveResponse(e,n,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createOrRetrieveResponse(e,n,s){var u;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),$e(this,ot,"m",Bo).call(this);let r,a=null;"response_id"in n?(r=await e.responses.retrieve(n.response_id,{stream:!0},{...s,signal:this.controller.signal,stream:!0}),a=n.starting_after??null):r=await e.responses.create({...n,stream:!0},{...s,signal:this.controller.signal}),this._connected();for await(const d of r)$e(this,ot,"m",Oo).call(this,d,a);if((u=r.controller.signal)!=null&&u.aborted)throw new me;return $e(this,ot,"m",Ho).call(this)}[(an=new WeakMap,Ve=new WeakMap,ln=new WeakMap,ot=new WeakSet,Bo=function(){this.ended||rt(this,Ve,void 0,"f")},Oo=function(n,s){if(this.ended)return;const i=(a,u)=>{(s==null||u.sequence_number>s)&&this._emit(a,u)},r=$e(this,ot,"m",Jo).call(this,n);switch(i("event",n),n.type){case"response.output_text.delta":{const a=r.output[n.output_index];if(!a)throw new F(`missing output at index ${n.output_index}`);if(a.type==="message"){const u=a.content[n.content_index];if(!u)throw new F(`missing content at index ${n.content_index}`);if(u.type!=="output_text")throw new F(`expected content to be 'output_text', got ${u.type}`);i("response.output_text.delta",{...n,snapshot:u.text})}break}case"response.function_call_arguments.delta":{const a=r.output[n.output_index];if(!a)throw new F(`missing output at index ${n.output_index}`);a.type==="function_call"&&i("response.function_call_arguments.delta",{...n,snapshot:a.arguments});break}default:i(n.type,n);break}},Ho=function(){if(this.ended)throw new F("stream has ended, this shouldn't happen");const n=$e(this,Ve,"f");if(!n)throw new F("request ended without sending any events");rt(this,Ve,void 0,"f");const s=Ey(n,$e(this,an,"f"));return rt(this,ln,s,"f"),s},Jo=function(n){let s=$e(this,Ve,"f");if(!s){if(n.type!=="response.created")throw new F(`When snapshot hasn't been set yet, expected 'response.created' event, got ${n.type}`);return s=rt(this,Ve,n.response,"f"),s}switch(n.type){case"response.output_item.added":{s.output.push(n.item);break}case"response.content_part.added":{const i=s.output[n.output_index];if(!i)throw new F(`missing output at index ${n.output_index}`);i.type==="message"&&i.content.push(n.part);break}case"response.output_text.delta":{const i=s.output[n.output_index];if(!i)throw new F(`missing output at index ${n.output_index}`);if(i.type==="message"){const r=i.content[n.content_index];if(!r)throw new F(`missing content at index ${n.content_index}`);if(r.type!=="output_text")throw new F(`expected content to be 'output_text', got ${r.type}`);r.text+=n.delta}break}case"response.function_call_arguments.delta":{const i=s.output[n.output_index];if(!i)throw new F(`missing output at index ${n.output_index}`);i.type==="function_call"&&(i.arguments+=n.delta);break}case"response.completed":{rt(this,Ve,n.response,"f");break}}return s},Symbol.asyncIterator)](){const e=[],n=[];let s=!1;return this.on("event",i=>{const r=n.shift();r?r.resolve(i):e.push(i)}),this.on("end",()=>{s=!0;for(const i of n)i.resolve(void 0);n.length=0}),this.on("abort",i=>{s=!0;for(const r of n)r.reject(i);n.length=0}),this.on("error",i=>{s=!0;for(const r of n)r.reject(i);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((r,a)=>n.push({resolve:r,reject:a})).then(r=>r?{value:r,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=$e(this,ln,"f");if(!e)throw new F("stream ended without producing a ChatCompletion");return e}}function Ey(t,e){return yy(t,e)}class Ni extends L{constructor(){super(...arguments),this.inputItems=new Yl(this._client)}create(e,n){return this._client.post("/responses",{body:e,...n,stream:e.stream??!1})._thenUnwrap(s=>("object"in s&&s.object==="response"&&Wl(s),s))}retrieve(e,n={},s){return this._client.get(`/responses/${e}`,{query:n,...s,stream:(n==null?void 0:n.stream)??!1})}del(e,n){return this._client.delete(`/responses/${e}`,{...n,headers:{Accept:"*/*",...n==null?void 0:n.headers}})}parse(e,n){return this._client.responses.create(e,n)._thenUnwrap(s=>Jl(s,e))}stream(e,n){return xi.createResponse(this._client,e,n)}cancel(e,n){return this._client.post(`/responses/${e}/cancel`,{...n,headers:{Accept:"*/*",...n==null?void 0:n.headers}})}}class wy extends ne{}Ni.InputItems=Yl;class Kl extends L{create(e,n,s){return this._client.post(`/uploads/${e}/parts`,tt({body:n,...s}))}}class Mi extends L{constructor(){super(...arguments),this.parts=new Kl(this._client)}create(e,n){return this._client.post("/uploads",{body:e,...n})}cancel(e,n){return this._client.post(`/uploads/${e}/cancel`,n)}complete(e,n,s){return this._client.post(`/uploads/${e}/complete`,{body:n,...s})}}Mi.Parts=Kl;const Iy=async t=>{const e=await Promise.allSettled(t),n=e.filter(i=>i.status==="rejected");if(n.length){for(const i of n)console.error(i.reason);throw new Error(`${n.length} promise(s) failed - see the above errors`)}const s=[];for(const i of e)i.status==="fulfilled"&&s.push(i.value);return s};class Kn extends L{create(e,n,s){return this._client.post(`/vector_stores/${e}/files`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}retrieve(e,n,s){return this._client.get(`/vector_stores/${e}/files/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}update(e,n,s,i){return this._client.post(`/vector_stores/${e}/files/${n}`,{body:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,n={},s){return X(n)?this.list(e,{},n):this._client.getAPIList(`/vector_stores/${e}/files`,zn,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}del(e,n,s){return this._client.delete(`/vector_stores/${e}/files/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async createAndPoll(e,n,s){const i=await this.create(e,n,s);return await this.poll(e,i.id,s)}async poll(e,n,s){const i={...s==null?void 0:s.headers,"X-Stainless-Poll-Helper":"true"};for(s!=null&&s.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){const r=await this.retrieve(e,n,{...s,headers:i}).withResponse(),a=r.data;switch(a.status){case"in_progress":let u=5e3;if(s!=null&&s.pollIntervalMs)u=s.pollIntervalMs;else{const d=r.response.headers.get("openai-poll-after-ms");if(d){const c=parseInt(d);isNaN(c)||(u=c)}}await Jt(u);break;case"failed":case"completed":return a}}}async upload(e,n,s){const i=await this._client.files.create({file:n,purpose:"assistants"},s);return this.create(e,{file_id:i.id},s)}async uploadAndPoll(e,n,s){const i=await this.upload(e,n,s);return await this.poll(e,i.id,s)}content(e,n,s){return this._client.getAPIList(`/vector_stores/${e}/files/${n}/content`,ki,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class zn extends ne{}class ki extends qn{}Kn.VectorStoreFilesPage=zn;Kn.FileContentResponsesPage=ki;class zl extends L{create(e,n,s){return this._client.post(`/vector_stores/${e}/file_batches`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}retrieve(e,n,s){return this._client.get(`/vector_stores/${e}/file_batches/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}cancel(e,n,s){return this._client.post(`/vector_stores/${e}/file_batches/${n}/cancel`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async createAndPoll(e,n,s){const i=await this.create(e,n);return await this.poll(e,i.id,s)}listFiles(e,n,s={},i){return X(s)?this.listFiles(e,n,{},s):this._client.getAPIList(`/vector_stores/${e}/file_batches/${n}/files`,zn,{query:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}async poll(e,n,s){const i={...s==null?void 0:s.headers,"X-Stainless-Poll-Helper":"true"};for(s!=null&&s.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){const{data:r,response:a}=await this.retrieve(e,n,{...s,headers:i}).withResponse();switch(r.status){case"in_progress":let u=5e3;if(s!=null&&s.pollIntervalMs)u=s.pollIntervalMs;else{const d=a.headers.get("openai-poll-after-ms");if(d){const c=parseInt(d);isNaN(c)||(u=c)}}await Jt(u);break;case"failed":case"cancelled":case"completed":return r}}}async uploadAndPoll(e,{files:n,fileIds:s=[]},i){if(n==null||n.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const r=(i==null?void 0:i.maxConcurrency)??5,a=Math.min(r,n.length),u=this._client,d=n.values(),c=[...s];async function f(h){for(let m of h){const _=await u.files.create({file:m,purpose:"assistants"},i);c.push(_.id)}}const p=Array(a).fill(d).map(f);return await Iy(p),await this.createAndPoll(e,{file_ids:c})}}class Ze extends L{constructor(){super(...arguments),this.files=new Kn(this._client),this.fileBatches=new zl(this._client)}create(e,n){return this._client.post("/vector_stores",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,n){return this._client.get(`/vector_stores/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,n,s){return this._client.post(`/vector_stores/${e}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e={},n){return X(e)?this.list({},e):this._client.getAPIList("/vector_stores",bi,{query:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,n){return this._client.delete(`/vector_stores/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}search(e,n,s){return this._client.getAPIList(`/vector_stores/${e}/search`,Di,{body:n,method:"post",...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class bi extends ne{}class Di extends qn{}Ze.VectorStoresPage=bi;Ze.VectorStoreSearchResponsesPage=Di;Ze.Files=Kn;Ze.VectorStoreFilesPage=zn;Ze.FileContentResponsesPage=ki;Ze.FileBatches=zl;var Zl;class G extends Wg{constructor({baseURL:e=tn("OPENAI_BASE_URL"),apiKey:n=tn("OPENAI_API_KEY"),organization:s=tn("OPENAI_ORG_ID")??null,project:i=tn("OPENAI_PROJECT_ID")??null,...r}={}){if(n===void 0)throw new F("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const a={apiKey:n,organization:s,project:i,...r,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&ny())throw new F(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new Ll(this),this.chat=new Hn(this),this.embeddings=new Vl(this),this.files=new yi(this),this.images=new Ol(this),this.audio=new Wt(this),this.moderations=new Hl(this),this.models=new Ri(this),this.fineTuning=new ze(this),this.graders=new Ai(this),this.vectorStores=new Ze(this),this.beta=new Rt(this),this.batches=new js(this),this.uploads=new Mi(this),this.responses=new Ni(this),this.evals=new Xt(this),this.containers=new zt(this),this._options=a,this.apiKey=n,this.organization=s,this.project=i}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return Pg(e,{arrayFormat:"brackets"})}}Zl=G;G.OpenAI=Zl;G.DEFAULT_TIMEOUT=6e5;G.OpenAIError=F;G.APIError=re;G.APIConnectionError=Ln;G.APIConnectionTimeoutError=Qs;G.APIUserAbortError=me;G.NotFoundError=Ka;G.ConflictError=za;G.RateLimitError=Xa;G.BadRequestError=Ja;G.AuthenticationError=Wa;G.InternalServerError=Qa;G.PermissionDeniedError=Ya;G.UnprocessableEntityError=Za;G.toFile=il;G.fileFromPath=Ba;G.Completions=Ll;G.Chat=Hn;G.ChatCompletionsPage=On;G.Embeddings=Vl;G.Files=yi;G.FileObjectsPage=_i;G.Images=Ol;G.Audio=Wt;G.Moderations=Hl;G.Models=Ri;G.ModelsPage=Pi;G.FineTuning=ze;G.Graders=Ai;G.VectorStores=Ze;G.VectorStoresPage=bi;G.VectorStoreSearchResponsesPage=Di;G.Beta=Rt;G.Batches=js;G.BatchesPage=ei;G.Uploads=Mi;G.Responses=Ni;G.Evals=Xt;G.EvalListResponsesPage=gi;G.Containers=zt;G.ContainerListResponsesPage=fi;const Ay=t=>typeof t=="object"&&t!==null&&"aborted"in t,Xl=t=>t?Ay(t)?{signal:t}:t:{},Ry=async(t,e=2,n)=>{let s;for(let i=0;i<e;i++){if(n!=null&&n.aborted)throw new DOMException("Aborted","AbortError");try{return await t()}catch(r){if(s=r,n!=null&&n.aborted||i===e-1)throw s;console.warn(`API call failed, retrying... (${i+1}/${e})`,r),await new Promise(a=>setTimeout(a,500))}}throw s},Py=new Set(["user","assistant","system","developer"]),xy=t=>Py.has(t)?t:"user",Ny=t=>{if(typeof t=="string")return t;if(Array.isArray(t))return t.map(e=>typeof e=="string"?e:"text"in e&&typeof e.text=="string"?e.text:JSON.stringify(e)).join(`
`);if(t&&typeof t=="object"&&"text"in t){const e=t.text;if(typeof e=="string")return e}return""},My=t=>t.map(e=>({role:xy(e.role),content:Ny(e.content),type:"message"})),ky=t=>{},by=t=>{var e,n,s;return(t==null?void 0:t.status)??((e=t==null?void 0:t.response)==null?void 0:e.status)??(t==null?void 0:t.code)??((n=t==null?void 0:t.error)==null?void 0:n.status)??((s=t==null?void 0:t.cause)==null?void 0:s.status)},Dy=(t,e)=>new Promise((n,s)=>{if(e!=null&&e.aborted){s(new DOMException("Aborted","AbortError"));return}const i=setTimeout(n,t);if(e){const r=()=>{clearTimeout(i),s(new DOMException("Aborted","AbortError"))};e.addEventListener("abort",r,{once:!0})}}),Uy=async(t,e,n,s)=>{var m;if(!t.openAIApiKey)throw new Error("OpenAI API key is not set.");const i=new G({apiKey:t.openAIApiKey,dangerouslyAllowBrowser:!0}),r=Xl(s),a=ky(),u={model:t.model,input:My(e)};a&&(u.text={format:a});const d=2,c=3e4,f=Date.now();let p=0,h;for(;p<d;){if((m=r.signal)!=null&&m.aborted)throw new DOMException("Aborted","AbortError");try{const _=await i.responses.create(u,r.signal?{signal:r.signal}:void 0),g=_==null?void 0:_.usage;g&&r.onUsage&&r.onUsage({provider:"openai",model:t.model,promptTokens:g.prompt_tokens??g.input_tokens??g.input_token_count,completionTokens:g.completion_tokens??g.output_tokens??g.output_token_count,totalTokens:g.total_tokens??g.total_token_count,operation:r.operation});const T=(_.output_text??"").trim();if(!T)throw new Error("OpenAI returned an empty response.");return T}catch(_){h=_;const g=by(_),T=g===429||typeof g=="number"&&g>=500,w=Date.now()-f;if(!T||p===d-1||w>=c)throw _;const v=Math.min(2e3,500*Math.pow(2,p));await Dy(v,r.signal),p+=1}}throw h instanceof Error?h:new Error("OpenAI request failed.")},Fy=async(t,e,n,s)=>{if(!t.geminiApiKey)throw new Error("Gemini API key is not set.");const i=new _g({apiKey:t.geminiApiKey}),r=Xl(s),u=`${e}`.trim(),d=await Ry(()=>i.models.generateContent({model:t.model,contents:u},r.signal?{signal:r.signal}:void 0),2,r.signal),c=d.usageMetadata;return c&&r.onUsage&&r.onUsage({provider:"gemini",model:t.model,promptTokens:c.promptTokenCount??void 0,completionTokens:c.candidatesTokenCount??void 0,totalTokens:c.totalTokenCount??void 0,operation:r.operation}),d.text.trim()},Zn=t=>{const e={...t};if(Array.isArray(e.enum))return e.enum.includes(null)||(e.enum=[...e.enum,null]),e;const n=e.type;return Array.isArray(n)?n.includes("null")||(e.type=[...n,"null"]):n?e.type=[n,"null"]:e.type=["null"],e},Qt=(t,e)=>{const n={...t};return e.forEach(s=>{if(!n[s])throw new Error(`Attempted to mark missing property "${s}" as nullable.`);n[s]=Zn(n[s])}),n},Ql={type:y.OBJECT,properties:{chartType:{type:y.STRING,enum:["bar","line","pie","doughnut","scatter","combo"],description:"Type of chart to generate."},title:{type:y.STRING,description:"A concise title for the analysis."},description:{type:y.STRING,minLength:8,description:"A brief explanation of what the analysis shows. Must be a full sentence with at least 8 characters."},aggregation:{type:y.STRING,enum:["sum","count","avg"],description:"The aggregation function to apply. Omit for scatter plots."},groupByColumn:{type:y.STRING,description:"The column to group data by (categorical). Omit for scatter plots."},valueColumn:{type:y.STRING,description:'The column for aggregation (numerical). Not needed for "count".'},xValueColumn:{type:y.STRING,description:"The column for the X-axis of a scatter plot (numerical). Required for scatter plots."},yValueColumn:{type:y.STRING,description:"The column for the Y-axis of a scatter plot (numerical). Required for scatter plots."},secondaryValueColumn:{type:y.STRING,description:"For combo charts, the secondary column for aggregation (numerical)."},secondaryAggregation:{type:y.STRING,enum:["sum","count","avg"],description:"For combo charts, the aggregation for the secondary value column."},defaultTopN:{type:y.INTEGER,description:"Optional. If the analysis has many categories, this suggests a default Top N view (e.g., 8)."},defaultHideOthers:{type:y.BOOLEAN,description:'Optional. If using defaultTopN, suggests whether to hide the "Others" category by default.'},orderBy:{type:y.ARRAY,description:"Optional ordering instructions applied before limiting rows.",items:{type:y.OBJECT,properties:{column:{type:y.STRING,description:"Column to sort by (group or metric alias)."},direction:{type:y.STRING,enum:["asc","desc"],description:"Sort direction (default desc)."}},required:["column","direction"],additionalProperties:!1}},limit:{type:y.INTEGER,description:"Optional limit applied after sorting (e.g., Top N rows)."},rowFilter:{type:y.OBJECT,description:"Optional row-level filter to limit rows before aggregation (e.g., single customer or region).",properties:{column:{type:y.STRING,description:"Column to filter on. Must be categorical."},values:{type:y.ARRAY,minItems:1,description:"Exact values to keep (case-sensitive, as they appear in the dataset).",items:{type:y.STRING}}},required:["column","values"],additionalProperties:!1}},required:["chartType","title","description","aggregation","groupByColumn","valueColumn","xValueColumn","yValueColumn","secondaryValueColumn","secondaryAggregation","defaultTopN","defaultHideOthers","orderBy","limit","rowFilter"],additionalProperties:!1},Ly={type:y.OBJECT,properties:{plans:{type:y.ARRAY,description:"Array of analysis plans to execute.",items:Ql}},required:["plans"],additionalProperties:!1},$y={type:y.OBJECT,properties:{name:{type:y.STRING,description:"The column name."},type:{type:y.STRING,enum:["numerical","categorical","date","time","currency","percentage"],description:"The data type of the column. Identify specific types like 'date', 'currency', etc., where possible."}},required:["name","type"],additionalProperties:!1},Vy={type:y.OBJECT,properties:{explanation:{type:y.STRING,description:"A brief, user-facing explanation of the transformations that will be applied to the data (e.g., 'Removed 3 summary rows and reshaped the data from a cross-tab format')."},jsFunctionBody:Zn({type:y.STRING,description:"The body of a JavaScript function that takes two arguments `data` (an array of objects) and `_util` (a helper object) and returns the transformed array of objects. This code will be executed to clean and reshape the data."}),outputColumns:{type:y.ARRAY,description:"A list of column profiles describing the structure of the data AFTER the transformation. If no transformation is performed, this should be the same as the input column profiles.",items:$y}},required:["explanation","jsFunctionBody","outputColumns"],additionalProperties:!1},Gy={type:y.OBJECT,properties:{explanation:{type:y.STRING,description:"A brief, user-facing explanation of the filter that was created from the natural language query."},jsFunctionBody:{type:y.STRING,description:"The body of a JavaScript function that takes 'data' and '_util' as arguments and returns a filtered array of objects. It should be a single line starting with 'return data.filter(...);'."}},required:["explanation","jsFunctionBody"],additionalProperties:!1},qy={type:y.OBJECT,properties:{insight:{type:y.STRING,description:"A concise, user-facing message describing the single most important finding."},cardId:{type:y.STRING,description:"The ID of the card where this insight was observed."}},required:["insight","cardId"],additionalProperties:!1},By=Ql,jl={chartType:{type:y.STRING,enum:["bar","line","pie","doughnut","scatter","combo"]},title:{type:y.STRING},description:{type:y.STRING},aggregation:{type:y.STRING,enum:["sum","count","avg"]},groupByColumn:{type:y.STRING},valueColumn:{type:y.STRING},xValueColumn:{type:y.STRING},yValueColumn:{type:y.STRING},secondaryValueColumn:{type:y.STRING},secondaryAggregation:{type:y.STRING,enum:["sum","count","avg"]},defaultTopN:{type:y.INTEGER},defaultHideOthers:{type:y.BOOLEAN},orderBy:{type:y.ARRAY,items:{type:y.OBJECT,properties:{column:{type:y.STRING},direction:{type:y.STRING,enum:["asc","desc"]}},required:["column","direction"],additionalProperties:!1}},limit:{type:y.INTEGER},rowFilter:{type:y.OBJECT,properties:{column:{type:y.STRING},values:{type:y.ARRAY,items:{type:y.STRING}}},additionalProperties:!1,required:["column","values"]}},Wo=Object.keys(jl),Oy={type:y.OBJECT,properties:{question:{type:y.STRING,description:"The clear, user-facing question to ask for clarification."},options:{type:y.ARRAY,items:{type:y.OBJECT,properties:{label:{type:y.STRING,description:"The user-friendly text for the option button."},value:{type:y.STRING,description:"The exact column name (case-sensitive) or literal value that should be assigned to the plan when this option is selected. Do not invent new names."}},required:["label","value"],additionalProperties:!1}},pendingPlan:{type:y.OBJECT,description:"The partial analysis plan that is waiting for the user's input. It should contain all known parameters.",properties:Qt(jl,Wo),required:Wo,additionalProperties:!1},targetProperty:{type:y.STRING,description:"The name of the property in the 'pendingPlan' that the user's selected value should be assigned to."},reasonHint:Zn({type:y.STRING,description:"Optional short explanation describing why the clarification is required."})},required:["question","options","pendingPlan","targetProperty"],additionalProperties:!1},Hy={type:y.OBJECT,description:"Declarative representation of a pending plan step.",properties:{id:{type:y.STRING,minLength:3,description:"Stable identifier (kebab-case recommended) used to reference this step in future actions."},label:{type:y.STRING,minLength:4,description:"Human-readable summary of the step."}},required:["id","label"],additionalProperties:!1},Jy={goal:{type:y.STRING,minLength:6},contextSummary:{type:y.STRING},progress:{type:y.STRING,minLength:6},nextSteps:{type:y.ARRAY,minItems:1,items:Hy},planId:{type:y.STRING},blockedBy:{type:y.STRING},observationIds:{type:y.ARRAY,items:{type:y.STRING}},confidence:{type:y.NUMBER,minimum:0,maximum:1},updatedAt:{type:y.STRING},currentStepId:{type:y.STRING},steps:{type:y.ARRAY,minItems:1,items:{type:y.OBJECT,properties:{id:{type:y.STRING},label:{type:y.STRING},intent:{type:y.STRING},status:{type:y.STRING,enum:["ready","in_progress","done","waiting_user"]}},required:["id","label","intent","status"],additionalProperties:!1}},stateTag:{type:y.STRING}},Wy={type:y.OBJECT,properties:Qt(Jy,["contextSummary","planId","blockedBy","confidence"]),required:["goal","contextSummary","progress","nextSteps","planId","blockedBy","observationIds","confidence","updatedAt","currentStepId","steps","stateTag"],additionalProperties:!1},Yy={type:y.OBJECT,properties:{awaitUser:{type:y.BOOLEAN},haltAfter:{type:y.BOOLEAN},resumePlanner:{type:y.BOOLEAN},promptId:{type:y.STRING}},required:["awaitUser","haltAfter","resumePlanner","promptId"],additionalProperties:!1},Ky={type:y.OBJECT,properties:{id:{type:y.STRING},label:{type:y.STRING}},required:["id","label"],additionalProperties:!1},zy={type:y.OBJECT,properties:{promptId:{type:y.STRING},question:{type:y.STRING},options:{type:y.ARRAY,minItems:1,items:Ky},allowFreeText:{type:y.BOOLEAN},placeholder:{type:y.STRING}},required:["promptId","question","options","allowFreeText","placeholder"],additionalProperties:!1},us={byId:{type:y.STRING},byTitle:{type:y.STRING},selector:{type:y.STRING}},Zy={type:y.OBJECT,properties:Qt(us,Object.keys(us)),required:Object.keys(us),additionalProperties:!1},cs={cardId:{type:y.STRING},cardTitle:{type:y.STRING},newType:{type:y.STRING,enum:["bar","line","pie","doughnut","scatter","combo"]},visible:{type:y.BOOLEAN},column:{type:y.STRING},values:{type:y.ARRAY,items:{type:y.STRING}},topN:{type:y.INTEGER},hide:{type:y.BOOLEAN},label:{type:y.STRING},format:{type:y.STRING,enum:["png","csv","html"]}},Xy={type:y.OBJECT,properties:Qt(cs,Object.keys(cs)),required:Object.keys(cs),additionalProperties:!1},Qy={type:y.OBJECT,properties:{toolName:{type:y.STRING,enum:["highlightCard","changeCardChartType","showCardData","filterCard","setTopN","toggleHideOthers","toggleLegendLabel","exportCard","removeCard"]},target:Zy,args:Xy},required:["toolName","target","args"],additionalProperties:!1},jy={type:y.OBJECT,properties:{explanation:{type:y.STRING},jsFunctionBody:{type:y.STRING,minLength:10}},required:["explanation","jsFunctionBody"],additionalProperties:!1},e_={type:y.OBJECT,properties:{query:{type:y.STRING}},required:["query"],additionalProperties:!1},t_=["plan_state_update","text_response","await_user","plan_creation","dom_action","execute_js_code","proceed_to_analysis","filter_spreadsheet","clarification_request"],n_=["intentContract","meta","planState","text","cardId","awaitUserPayload","plan","domAction","code","args","clarification"],eu=(t=t_)=>({type:y.OBJECT,properties:Qt({type:{type:y.STRING,enum:t},responseType:{type:y.STRING,enum:t},reason:{type:y.STRING,maxLength:280},stepId:{type:y.STRING},intentContract:ra,meta:Yy,planState:Wy,text:{type:y.STRING},cardId:{type:y.STRING},awaitUserPayload:zy,plan:By,domAction:Qy,code:jy,args:e_,clarification:Oy},n_),required:["type","responseType","reason","stepId","intentContract","meta","planState","text","cardId","awaitUserPayload","plan","domAction","code","args","clarification"],additionalProperties:!1}),s_=eu(),i_={type:y.ARRAY,minItems:1,maxItems:1,items:eu(["plan_state_update"])};y.OBJECT,y.STRING,Zn({type:y.OBJECT,description:"Tool arguments payload (free-form keys allowed).",patternProperties:{"^.*$":{type:["string","number","integer","boolean","array","object","null"]}},additionalProperties:!1}),y.BOOLEAN;const r_={type:y.OBJECT,properties:{actions:{type:y.ARRAY,description:"A sequence of actions for the assistant to perform.",minItems:1,items:s_}},required:["actions"],additionalProperties:!1},o_={type:y.OBJECT,properties:{actions:i_},required:["actions"],additionalProperties:!1},Yo=new Map([[y.STRING,"string"],[y.INTEGER,"integer"],[y.NUMBER,"number"],[y.BOOLEAN,"boolean"],[y.ARRAY,"array"],[y.OBJECT,"object"]]),a_=new Set,Ko=new Set(["properties.actions.items.properties.text","properties.actions.items.properties.cardId","properties.actions.items.properties.domAction.properties.args","properties.actions.items.properties.domAction.properties.args.properties.newType","properties.actions.items.properties.domAction.properties.args.properties.visible","properties.actions.items.properties.domAction.properties.args.properties.cardTitle","properties.actions.items.properties.domAction.properties.args.properties.column","properties.actions.items.properties.domAction.properties.args.properties.values","properties.actions.items.properties.domAction.properties.args.properties.topN","properties.actions.items.properties.domAction.properties.args.properties.hide","properties.actions.items.properties.domAction.properties.args.properties.label","properties.actions.items.properties.domAction.properties.args.properties.format","properties.actions.items.properties.domAction.properties.target.properties.byId","properties.actions.items.properties.domAction.properties.target.properties.byTitle","properties.actions.items.properties.domAction.properties.target.properties.selector","properties.actions.items.properties.planState.properties.contextSummary","properties.actions.items.properties.planState.properties.blockedBy","properties.actions.items.properties.planState.properties.confidence","properties.actions.items.properties.intentContract.properties.tool","properties.actions.items.properties.intentContract.properties.args.properties.datasetId","properties.actions.items.properties.intentContract.properties.args.properties.column","properties.actions.items.properties.intentContract.properties.args.properties.valueColumn","properties.actions.items.properties.intentContract.properties.args.properties.limit","properties.actions.items.properties.intentContract.properties.args.properties.topN","properties.actions.items.properties.intentContract.properties.args.properties.thresholdMultiplier","properties.actions.items.properties.intentContract.properties.args.properties.viewTitle","properties.actions.items.properties.intentContract.properties.args.properties.cardId","properties.actions.items.properties.intentContract.properties.message","properties.actions.items.properties.clarification.properties.pendingPlan.properties.chartType","properties.actions.items.properties.clarification.properties.pendingPlan.properties.title","properties.actions.items.properties.clarification.properties.pendingPlan.properties.description","properties.actions.items.properties.clarification.properties.pendingPlan.properties.aggregation","properties.actions.items.properties.clarification.properties.pendingPlan.properties.groupByColumn","properties.actions.items.properties.clarification.properties.pendingPlan.properties.valueColumn","properties.actions.items.properties.clarification.properties.pendingPlan.properties.xValueColumn","properties.actions.items.properties.clarification.properties.pendingPlan.properties.yValueColumn","properties.actions.items.properties.clarification.properties.pendingPlan.properties.secondaryValueColumn","properties.actions.items.properties.clarification.properties.pendingPlan.properties.secondaryAggregation","properties.actions.items.properties.clarification.properties.pendingPlan.properties.defaultTopN","properties.actions.items.properties.clarification.properties.pendingPlan.properties.defaultHideOthers","properties.actions.items.properties.clarification.properties.pendingPlan.properties.orderBy","properties.actions.items.properties.clarification.properties.pendingPlan.properties.orderBy.items.properties.direction","properties.actions.items.properties.clarification.properties.pendingPlan.properties.rowFilter","properties.actions.items.properties.clarification.properties.pendingPlan.properties.rowFilter.properties.column","properties.actions.items.properties.clarification.properties.pendingPlan.properties.rowFilter.properties.values","properties.actions.items.properties.clarification.properties.pendingPlan.properties.limit","properties.plans.items.properties.aggregation","properties.plans.items.properties.groupByColumn","properties.plans.items.properties.valueColumn","properties.plans.items.properties.xValueColumn","properties.plans.items.properties.yValueColumn","properties.plans.items.properties.secondaryValueColumn","properties.plans.items.properties.secondaryAggregation","properties.plans.items.properties.defaultTopN","properties.plans.items.properties.defaultHideOthers","properties.plans.items.properties.orderBy","properties.plans.items.properties.orderBy.items.properties.direction","properties.plans.items.properties.rowFilter","properties.plans.items.properties.rowFilter.properties.column","properties.plans.items.properties.rowFilter.properties.values","properties.plans.items.properties.limit"]),zo=t=>{if(!t)return t;let e=!1;return t.enum&&(e=!0,t.enum.includes(null)||(t.enum=[...t.enum,null])),t.type?Array.isArray(t.type)?t.type.includes("null")||(t.type=[...t.type,"null"]):t.type!=="null"&&(t.type=[t.type,"null"]):e||(t.type=["null"]),t},Zo=t=>t.replace(/\.oneOf\[\d+\]/g,"").replace(/\.anyOf\[\d+\]/g,""),he=(t,e="")=>{if(Array.isArray(t))return t.map(s=>he(s,`${e}[]`));if(t&&typeof t=="object"){const s={};for(const[r,a]of Object.entries(t)){if(r==="type"){Array.isArray(a)?s.type=a.map(u=>Yo.get(u)??u):s.type=Yo.get(a)??a;continue}if(r==="properties"&&a&&typeof a=="object"){s.properties={};for(const[u,d]of Object.entries(a)){const c=e?`${e}.properties.${u}`:`properties.${u}`;s.properties[u]=he(d,c)}continue}if(r==="items"){const u=e?`${e}.items`:"items";s.items=he(a,u);continue}if(r==="oneOf"&&Array.isArray(a)){s.oneOf=a.map((u,d)=>he(u,`${e}.oneOf[${d}]`));continue}if(r==="anyOf"&&Array.isArray(a)){s.anyOf=a.map((u,d)=>he(u,`${e}.anyOf[${d}]`));continue}s[r]=he(a,e?`${e}.${r}`:r)}const i=Zo(e);if(s.type==="object"&&a_.has(i)){const r=s.properties?Object.keys(s.properties):[];s.required=r}return Ko.has(i)?zo(s):s}const n=Zo(e);return Ko.has(n)?zo(t):t};he(Ly);he(Vy);he(Gy);he(qy);he(r_);he(o_);const l_=7e3,u_="[Context trimmed due to budget: ",Ui=(t,e=l_,n)=>{const s=(n==null?void 0:n.includeTrimNote)??!0,i=n!=null&&n.stageFilter?new Set(Array.isArray(n.stageFilter)?n.stageFilter:[n.stageFilter]):null,a=[...i?t.filter(p=>p.stage?i.has(p.stage):!1):t].sort((p,h)=>{const m=typeof p.priority=="number"?p.priority:5,_=typeof h.priority=="number"?h.priority:5;return m-_}),u=[],d=[];let c=0;a.forEach((p,h)=>{var w;const m=(w=p.content)==null?void 0:w.trim();if(!m)return;const _=m,g=_.length+(u.length>0?2:0);p.required||u.length===0||c+g<=e?(u.push(_),c+=g):d.push(p.label||`Section ${h+1}`)});let f=u.join(`

`);if(s&&d.length>0){const p=`${u_}${d.join(", ")}]`;f=`${f}

${p}`}return{prompt:f,trimmedSections:d}},tu=(t,e=5)=>{const n=t.length>0?t.slice(-e):[];return n.length===0?"No prior conversation.":n.map(s=>`${s.sender==="ai"?"Agent":"User"}: ${s.text}`).join(`
`)},c_=(t,e,n,s,i,r,a,u)=>{const d=tu(e,5),c='\nYou are beginning STEP 1 of a multi-stage workflow. Your sole objective in this turn is to emit a high-quality `plan_state_update` action that sets the shared goal tracker for the UI. Do **not** run tools, transformations, DOM actions, or conversational replies yet.\nRequirements for this response:\n- The first action must be `plan_state_update` with goal, contextSummary, progress, nextSteps (each having id + label), blockedBy (or null), observationIds (array, can be empty), confidence (0-1 or null), and updatedAt.\n- Every action you send must include `type`, `responseType`, and `stepId`. The runtime will append metadata such as timestamps and stateTag tokens.\n- Each action\'s `reason` must be no more than 280 characters and clearly state the immediate justification for that step (e.g., "Plan: drafting the chart creation steps").\n- The plan_state_update payload must include `planId`, `currentStepId`, and a comprehensive `steps` array where each entry has `intent` and `status` (`ready`|`in_progress`|`done`).\n- Emit exactly **one** action (the plan_state_update). **Do NOT** include `text_response`; the host UI will provide any greeting copy.\n- If the user\'s latest message is merely a greeting or check-in (e.g., "hi", "hello there", ""), still include a first nextSteps entry with id "acknowledge_user" and a label that confirms you will greet/clarify with them before moving to data work.\n- Keep nextSteps focused on the minimum set of concrete moves (e.g., build chart, run filter, gather clarification). Reference dataset columns exactly as they appear.\n- Return **raw JSON only** (no Markdown fences/backticks, no commentary) and only include the fields described abovedo not invent extra keys.\n- Never wrap the JSON in ``` ``` or prepend/append explanatory text; the response must begin with { and end with }.\n'.trim(),f=`
Recent conversation (last ${Math.min(e.length,5)} turn${Math.min(e.length,5)===1?"":"s"}):
${d}
`.trim(),p=`
The user's latest request is: "${n}"

Output your answer as a JSON object with an "actions" array. Remember: stay in planning mode only; do not issue executions until the goal tracker is established.
`.trim(),h=[{label:"Instructions",content:c,required:!0,priority:0,stage:"seed"},{label:"Recent conversation",content:f,priority:1,stage:"conversation"},{label:"Latest request",content:p,required:!0,priority:2,stage:"action"}],{prompt:m,trimmedSections:_}=Ui(h);return _.length>0&&typeof console<"u"&&console.info("[promptBudget] Plan primer trimmed sections:",_),m},nu=(t,e,n,s,i,r,a,u,d,c,f,p)=>{const h=tu(e,5),_=`${f.length>0?f.slice(-5).map(H=>`- [${H.source}/${H.status.toUpperCase()}] ${H.actionType}: ${H.summary}${H.details?` (${H.details})`:""}`).join(`
`):"No prior tool actions have been recorded yet. You are starting fresh. Always observe before acting."}
- [DATA_VIEW] Raw Data Explorer filter: ${p}`,g=u.length>0?u.slice(-5).map(H=>{const pe=H.outputs?JSON.stringify(H.outputs).slice(0,160):"No structured output reported.";return`- [${H.status.toUpperCase()}] ${H.responseType} (action ${H.actionId.slice(-6)}): ${pe}`}).join(`
`):"No runtime observations captured yet for this session.",T=d?`Goal: ${d.goal}
Context: ${d.contextSummary||""}
Progress: ${d.progress}
Next Steps:
${d.nextSteps.map((H,pe)=>`  ${pe+1}. [${H.id}] ${H.label}`).join(`
`)}
Blocked By: ${d.blockedBy||"Nothing reported."}
Confidence: ${typeof d.confidence=="number"?d.confidence.toFixed(2):"Not provided"}
Referenced Observations: ${d.observationIds&&d.observationIds.length>0?d.observationIds.join(", "):"None specified."}`:"No structured goal has been recorded yet. Your first action must be a plan_state_update that defines a clear goal, ties it to current data, and lists concrete next steps.",w=t.length>0?`Column inventory (${t.length} total, showing up to 10): ${t.slice(0,10).map(H=>`${H.name} (${H.type})`).join(", ")}`:"No columns detected.",v=s.length>0?`Existing cards (${s.length} total, showing up to 4):
${s.slice(0,4).map(H=>`- ${H.title}${H.chartType?` (${H.chartType})`:""}`).join(`
`)}`:"No analysis cards visible yet.",S=`Core analysis briefing:
${r||"Not generated yet."}`,C=c?`Data preparation log:
Explanation: ${c.explanation}
Code:
${c.jsFunctionBody}`:"No AI-driven data preparation was performed.",N=a.length>0?`Long-term memory (top ${Math.min(a.length,3)}):
${a.slice(0,3).join(`
---
`)}`:"No relevant long-term memories.",R=`
You are an expert data analyst and strategist operating with a Reason-Act (ReAct) framework. Every action needs a short reason first, then the action payload. Keep final conversational replies in ${i}.
`.trim(),I='\nPLAN TRACKER PROTOCOL (Follow exactly):\n- Every action JSON must include `type`, `responseType`, and `stepId`. The host app will supply timestamps/stateTags after validation.\n- `plan_state_update` entries must list `nextSteps` objects (id + label) and a `steps` array including `intent` + `status`.\n- Emit at most two actions per turn (plan_state_update + one atomic action). Reasons 280 chars referencing the plan step.\n- Use `await_user` when the user must choose; include numbered options and set `meta.awaitUser=true`.\n- For `dom_action`, always specify `domAction.target`. If the target is unknown, fall back to a text_response asking the user.\n- When blocked, set `plan_state_update.blockedBy` to the waiting label (e.g., "awaiting_clarification").\n- Structured tool intents must be placed in `intentContract` (object with `intent`, `tool`, `args`, `awaitUser`, `message`). Supported tools: csv.aggregate, csv.profile, csv.clean_invoice_month, csv.detect_outliers, ui.remove_card, idb.save_view. For ask_clarify set `tool=null` and `awaitUser=true`. Default aggregation "sum" and groupBy [] when unspecified.\n'.trim();`
DATA PREPARATION LOG:
${c?`Explanation: ${c.explanation}
Code:
${c.jsFunctionBody}`:"No AI-driven data preparation was performed."}
`.trim(),`
LONG-TERM MEMORY:
${a.length>0?a.join(`
---
`):"No specific long-term memories are relevant."}
`.trim();const q=`
AGENT PLAN STATE:
${T}
`.trim();s.length>0&&s.slice(0,6).map(H=>`  - ${H.title}${H.chartType?` (${H.chartType})`:""}`).join(`
`);const P=`
Agent runtime notes:
- Pipeline: Context Builder  Planner  Action Dispatcher. Keep plans concise for downstream executors.
`.trim(),M=`
Recent tool actions:
${_}
`.trim(),U=`
Runtime observations (latest up to 5):
${g}
`.trim(),O=`
Recent conversation:
${h||"No prior conversation."}
`.trim(),Q=`
Latest user message: "${n}"

Respond with a JSON object containing an "actions" array. Example (pseudocode):
{
  "actions": [
    { "type": "plan_state_update", ... },
    { "type": "text_response", ... }
  ]
}

Primary actions available: text_response, plan_creation, dom_action, execute_js_code, clarification_request, await_user, filter_spreadsheet, proceed_to_analysis. Always acknowledge the user via text_response when you finish a complex step.
- Output raw JSON only (no Markdown fences/backticks). Stick to the documented fields; do not add extra keys or prose outside the JSON object.
- The response must start with { and end with }no greetings or commentary outside the JSON.
`.trim();return[{label:"Seed instructions",content:R,required:!0,priority:0,stage:"seed"},{label:"Plan protocol",content:I,required:!0,priority:1,stage:"seed"},{label:"Conversation",content:O,priority:2,stage:"conversation"},{label:"Context: columns",content:w,priority:3,stage:"context"},{label:"Context: cards",content:v,priority:3,stage:"context"},{label:"Context: analysis briefing",content:S,priority:4,stage:"context"},{label:"Context: data prep",content:C,priority:4,stage:"context"},{label:"Context: long-term memory",content:N,priority:5,stage:"context"},{label:"Context: plan state",content:q,priority:5,stage:"context"},{label:"Context: runtime notes",content:P,priority:7,stage:"context"},{label:"Context: action traces",content:M,priority:7,stage:"context"},{label:"Context: observations",content:U,priority:7,stage:"context"},{label:"Action / user request",content:Q,required:!0,priority:8,stage:"action"}]},d_=(t,e,n,s,i,r,a,u,d,c,f,p)=>{const h=nu(t,e,n,s,i,r,a,u,d,c,f,p),{prompt:m,trimmedSections:_}=Ui(h);return _.length>0&&typeof console<"u"&&console.info("[promptBudget] Chat prompt trimmed sections:",_),m},f_=(t,e,n,s,i,r,a,u,d,c,f,p,h)=>{const m=nu(e,n,s,i,r,a,u,d,c,f,p,h);return Ui(m,void 0,{includeTrimNote:!1,stageFilter:t}).prompt};class su extends Error{constructor(e,n){super(e),this.name="JsonCoercionError",this.rawContent=n}}const p_=/```(?:json)?\s*([\s\S]*?)```/i,h_=t=>{try{const e=JSON.parse(t);if(e&&typeof e=="object"&&!Array.isArray(e))return e}catch{return null}return null},m_=t=>{let e=0,n=-1,s=!1,i=!1;for(let r=0;r<t.length;r++){const a=t[r];if(s){if(i){i=!1;continue}if(a==="\\"){i=!0;continue}a==='"'&&(s=!1);continue}if(a==='"'){s=!0;continue}if(a==="{")e===0&&(n=r),e+=1;else if(a==="}"&&e>0&&(e-=1,e===0&&n!==-1))return t.slice(n,r+1).trim()}return null},g_=t=>{if(t&&typeof t=="object"&&!Array.isArray(t))return t;const n=(typeof t=="string"?t:t!=null?String(t):"").trim(),s=[];n&&s.push(n);const i=n.match(p_);i!=null&&i[1]&&s.push(i[1].trim());const r=m_(n);r&&s.push(r);for(const a of s){const u=h_(a);if(u)return u}throw new su("Failed to parse JSON object.",n)};class iu{constructor(){this.seq=0,this.lastEpoch=0}mint(e=Date.now(),n){const s=e>this.lastEpoch?e:this.lastEpoch;return s!==this.lastEpoch&&(this.seq=0,this.lastEpoch=s),this.seq+=1,`${s.toString().padStart(13,"0")}-${this.seq}`}}class Xo extends Error{constructor(e,n){super(e),this.name="AiChatResponseParsingError",this.rawContent=n}}const y_=t=>{try{const e=g_(t);if(!e.actions||!Array.isArray(e.actions))throw new Xo("Invalid response structure: 'actions' array missing.",JSON.stringify(e));return e}catch(e){throw e instanceof su?new Xo(e.message,e.rawContent):e}},Qo={plan:{phase:"plan",title:"Plan Primer",summary:"During the PLAN phase you are only confirming the mission. Emit exactly two actions in this order: (1) plan_state_update capturing the refreshed plan tracker, (2) text_response that acknowledges the plan and next steps. Do not run tools or code yet.",expectations:["The plan_state_update includes planId, goal, contextSummary, progress, currentStepId, nextSteps, steps, blockedBy, observationIds, confidence, updatedAt, stateTag.","The text_response should reassure the user that their request is understood and restate what happens next.","No execute_js_code, dom_action, or proceed_to_analysis actions are allowed in this phase."]},talk:{phase:"talk",title:"Conversation & Clarification",summary:"During the TALK phase you keep the user in the loop or gather missing info. Start with a plan_state_update when the context changes, then follow with a conversational action such as text_response, clarification_request, or await_user.",expectations:["Never emit execute_js_code or dom_action in the TALK phase.","If you must wait for the user, use await_user with clear choices; otherwise answer with text_response.","Reuse the existing planId and progress when nothing has changed rather than inventing a new plan."]},act:{phase:"act",title:"Action & Tool Execution",summary:"During the ACT phase you must pair a plan_state_update with a single atomic tool call. Keep the planner in sync, then run exactly one action such as execute_js_code, proceed_to_analysis, filter_spreadsheet, or a dom_action that fulfills the current step.",expectations:["When emitting execute_js_code you must provide runnable JavaScript in code.jsFunctionBody that mutates the data array and returns it.","If you are removing or adjusting cards, prefer dom_action with the correct toolName and target metadata.","Keep the action list to two entries max (plan_state_update plus one tool call) so the runtime can stream progress safely."]}},__="talk",T_=t=>{const e=t?Qo[t]:Qo[__],n=e.expectations.map(s=>`- ${s}`).join(`
`);return`Phase directive  ${e.title}:
${e.summary}
${n}`},v_=t=>t.actions.some(e=>{var s;if(e.responseType!=="execute_js_code")return!1;const n=(s=e.code)==null?void 0:s.jsFunctionBody;return!n||n.trim().length===0}),ru=new iu,S_=`Example JSON response (plan_state_update + text acknowledgement):
\`\`\`json
{
  "actions": [
    {
      "type": "plan_state_update",
      "responseType": "plan_state_update",
      "stepId": "plan-init",
      "reason": "Restating the plan so the UI stays in sync.",
      "planState": {
        "planId": "plan-abc123",
        "goal": "Compare revenue vs. orders by channel.",
        "contextSummary": "User asked for the top-performing channels in 2024.",
        "progress": "Ready to build the comparison card.",
        "blockedBy": null,
        "observationIds": [],
        "confidence": 0.65,
        "updatedAt": "2024-05-18T09:00:00.000Z",
        "currentStepId": "plan-init",
        "nextSteps": [{ "id": "acknowledge_user", "label": "" }],
        "steps": [
          {
            "id": "acknowledge_user",
            "label": "",
            "intent": "conversation",
            "status": "in_progress"
          }
        ],
        "stateTag": "context_ready"
      }
    },
    {
      "type": "text_response",
      "responseType": "text_response",
      "stepId": "plan-init",
      "reason": "Let the user know I captured the plan.",
      "text": ""
    }
  ]
}
\`\`\``,C_=t=>typeof t!="number"||Number.isNaN(t)||!Number.isFinite(t)?.65:Math.min(1,Math.max(0,t)),E_=t=>{if(t.type!=="plan_state_update"||!t.planState)return;const e=t.planState;(typeof e.updatedAt!="string"||!e.updatedAt.trim())&&(e.updatedAt=new Date().toISOString()),(typeof e.stateTag!="string"||!e.stateTag.trim())&&(e.stateTag=ru.mint(Date.now(),"plan")),Array.isArray(e.observationIds)||(e.observationIds=[]),e.blockedBy=e.blockedBy??null,(typeof e.contextSummary!="string"||e.contextSummary.trim().length===0)&&(e.contextSummary=null),e.confidence=C_(e.confidence)},w_=async(t,e,n,s,i,r,a,u,d,c,f,p,h,m)=>{if(!(i.provider==="google"&&!!i.geminiApiKey||i.provider==="openai"&&!!i.openAIApiKey))return{actions:[{type:"text_response",responseType:"text_response",stepId:"ad_hoc_response",stateTag:ru.mint(Date.now(),"fallback"),text:"Cloud AI is disabled. API Key not provided.",reason:"API key is missing, so I must inform the user."}]};try{const g=(m==null?void 0:m.mode)??"full",T=g==="full"?m==null?void 0:m.promptStage:void 0,w=g==="plan_only"?"chat.plan_only":"chat.full",v=(m==null?void 0:m.phase)??(g==="plan_only"?"plan":void 0),S=T_(v),C=g==="plan_only"?c_(t,e,n,i.language,r,u,d,s):T?(Array.isArray(T)?T:[T]).map(q=>f_(q,t,e,n,s,i.language,r,u,d,c,f,p,h)).join(`

`):d_(t,e,n,s,i.language,r,u,d,c,f,p,h);if(m!=null&&m.onPromptProfile){const q=g==="full"&&T?Array.isArray(T)?T.join("+"):T:null,P=g==="plan_only"?"chat_plan_primer":`chat_full${q?`_stage_${q}`:""}`,M=C.length,U=Math.ceil(M/4);m.onPromptProfile({mode:g,charCount:M,estimatedTokens:U,promptLabel:P})}const N=`You are an expert data analyst and business strategist, required to operate using a Reason-Act (ReAct) framework. For every action you take, you must first explain your reasoning in the 'reason' field, and then define the action itself. Keep each reason under 280 characters (ideally two sentences or fewer) and tie it to the plan step you're executing. You also maintain an explicit goal tracker by emitting a 'plan_state_update' action at the start of each response (and whenever the mission changes) so the UI can display your progress. Every action JSON object must include \`type\`, \`responseType\`, and \`stepId\`. The runtime appends metadata like timestamps and stateTags automatically, so you may omit them. The plan_state_update payload must include \`planId\`, \`currentStepId\`, and a \`steps\` array (each entry with intent + status). Emit at most two actions per response: the plan_state_update plus a single atomic action. When the user's latest message is only a greeting or check-in, the first entry in \`nextSteps\` (and \`steps\`) must be an \`acknowledge_user\` conversation step before any data work. Your final conversational responses should be in ${i.language}.
${S_}
Your output MUST be a single JSON object with an "actions" key containing an array of action objects. Never wrap the JSON in markdown fences or add commentarythe response must start with '{' and end with '}'.`,R=i.provider==="openai"?2:1;let I="";for(let q=0;q<R;q++){let P;if(i.provider==="openai"){const Q=[{role:"system",content:`${N}
${S}${I}`},{role:"user",content:C}];P=await Uy(i,Q,!1,{signal:m==null?void 0:m.signal,operation:w,onUsage:H=>{var pe;return(pe=m==null?void 0:m.onUsage)==null?void 0:pe.call(m,{...H,operation:w})}})}else{const O=`${C}

${S}`;P=await Fy(i,O,void 0,{signal:m==null?void 0:m.signal,operation:w,onUsage:Q=>{var H;return(H=m==null?void 0:m.onUsage)==null?void 0:H.call(m,{...Q,operation:w})}})}const M=y_(P);if(!M.actions||!Array.isArray(M.actions))throw new Error("Invalid response structure from AI: 'actions' array not found.");if(M.actions.forEach(O=>E_(O)),i.provider==="openai"&&v_(M)&&q<R-1){I=`
IMPORTANT VALIDATION FAILURE: Your previous response included an action with responseType=execute_js_code but did not include a valid code.jsFunctionBody. You must respond with executable JavaScript that mutates the provided data and returns the updated array (including an explicit return statement). Provide only valid JSON matching the required action envelope.`;continue}return M}throw new Error("Failed to obtain a valid AI response after retries.")}catch(g){throw console.error("Error generating chat response:",g),new Error(`Failed to get a valid response from the AI. ${g instanceof Error?g.message:""}`)}},I_=t=>{switch(t){case"act":return"act";case"plan":case"observe":return"plan";default:return"talk"}};let A_=w_;const R_=new iu,ds=t=>({type:"text_response",responseType:"text_response",reason:"Notify user about the planner status.",stepId:"graph-plan",stateTag:`ts${Date.now().toString(36)}-plan`,timestamp:new Date().toISOString(),text:t}),P_=t=>({requestId:t.requestId??null,sampleTier:{value:t.activeSampleTier??null,label:t.sampleTierLabel,userConfirmedFullScan:t.sampleTierConfirmed??!1},userMessageChars:t.userMessage.length,promptCharCountHint:t.promptCharCountHint}),un=(t,e)=>{if(!e||!Array.isArray(t)||t.length===0)return t;const[n,...s]=t;return[{...n,meta:{...n.meta??{},telemetry:e}},...s]},ou=t=>R_.mint(Date.now(),t),x_=t=>{if(t.responseType!=="plan_state_update"||!t.planState)return t;const e=t.planState.stateTag;if(_n(e))return t;const n=ou("plan");return{...t,stateTag:n,planState:{...t.planState,stateTag:n}}},N_=t=>{if(!t||_n(t.stateTag))return t;const e=ou("atomic");return{...t,stateTag:e}},M_=t=>{if(!t.length)return t;const[e,n]=t,s=x_(e),i=N_(n);return i?[s,i]:[s]},k_=async({state:t,payload:e})=>{var r,a;const n={...t,phase:"plan",updatedAt:new Date().toISOString()};if(!e||!oa(e))return{state:n,actions:[],label:"plan"};const s=P_(e),i=Date.now();try{const u=await A_(e.columns,e.chatHistory,e.userMessage,e.cardContext,e.settings,e.aiCoreAnalysisSummary,e.currentView,e.longTermMemory,e.recentObservations,e.activePlanState,e.dataPreparationPlan,e.recentActionTraces,e.rawDataFilterSummary,{phase:I_(n.phase),onPromptProfile:h=>{s.promptProfile=h},onUsage:h=>{s.tokenUsage={provider:h.provider,model:h.model,promptTokens:h.promptTokens,completionTokens:h.completionTokens,totalTokens:h.totalTokens,operation:h.operation}}});s.latencyMs=Date.now()-i;const d=M_(Array.isArray(u.actions)?u.actions:[]),c=ta(n,d);if(!c.ok||!c.nextState){const h=((a=(r=c.violations)==null?void 0:r[0])==null?void 0:a.message)??"LLM response failed validation.",m=un([ds(h)],s);return{state:n,actions:m,label:"plan",telemetry:s}}const f=c.acceptedActions??d;if(!f||f.length===0){const h=un([ds("LLM ")],s);return{state:c.nextState,actions:h,label:"plan",telemetry:s}}const p=un(f,s);return{state:c.nextState,actions:p,label:"plan",telemetry:s}}catch(u){s.latencyMs=Date.now()-i;const d=un([ds(`LLM ${u instanceof Error?u.message:String(u)}`)],s);return{state:n,actions:d,label:"plan",telemetry:s}}},b_=({state:t})=>{const e=t.pendingPlan;if(!e||!e.plan)return{state:{...t,phase:"act"},actions:[],label:"act"};const n={type:"plan_creation",responseType:"plan_creation",stepId:e.id,stateTag:`ts${Date.now().toString(36)}-act`,timestamp:new Date().toISOString(),reason:`${e.summary}`,plan:e.plan},s=D_(e)??null,i=Math.min(t.loopBudget.maxActs,t.loopBudget.actsUsed+1),r={...t.loopBudget,actsUsed:i,exceeded:i>=t.loopBudget.maxActs},a=[n];return s&&a.push(s),{state:{...t,phase:"act",pendingPlan:e,pendingVerification:{id:e.id,description:e.summary,meta:null,summary:e.summary,payload:null,createdAt:new Date().toISOString()},loopBudget:r},actions:a,label:"act"}},D_=t=>{var d,c;if(t.intent!=="remove_rows"||!t.plan)return null;const e=t.plan,n=t.metadata??{},s=typeof n.column=="string"&&n.column.trim().length>0?n.column.trim():typeof((d=e.rowFilter)==null?void 0:d.column)=="string"?e.rowFilter.column:null,r=(Array.isArray(n.values)?n.values:((c=e.rowFilter)==null?void 0:c.values)??[]).map(f=>f!=null?String(f).trim():"").filter(f=>f.length>0);if(!s||r.length===0)return null;const a=` ${s}  ${r.join(", ")} `,u=`
const blocked = new Set(${JSON.stringify(r.map(f=>f.toLowerCase()))});
return data.filter(row => {
    const cell = row[${JSON.stringify(s)}];
    return !blocked.has(String(cell ?? '').toLowerCase());
});
    `.trim();return{type:"execute_js_code",responseType:"execute_js_code",stepId:`remove-${s.toLowerCase()}`,stateTag:`ts${Date.now().toString(36)}-transform`,timestamp:new Date().toISOString(),reason:`${s}  {${r.join(", ")}}`,code:{explanation:a,jsFunctionBody:u},meta:{toolCall:void 0,removalContext:{column:s,values:r}}}},U_=({state:t})=>{var d;const e=t.pendingVerification;if(!e)return{state:{...t,phase:"verify"},actions:[],label:"verify"};const n=e.meta,s=[];e.summary?s.push(e.summary):n&&(n.source&&s.push(`${n.source==="sample"?"":""}`),typeof n.rows=="number"&&s.push(`${n.rows}`),typeof n.processedRows=="number"&&typeof n.totalRows=="number"&&s.push(`${n.processedRows}/${n.totalRows}`),(d=n.warnings)!=null&&d.length&&s.push(` ${n.warnings.length} `),n.summary&&s.push(n.summary));const r=(()=>{const c=e.payload;if(!c||typeof c!="object")return null;switch(typeof c.kind=="string"?c.kind:null){case"profile_dataset":{const p=c.columns,h=c.rowCount,m=c.sampledRows;return`${p??"?"}   ${h??"?"}  ${m??"?"}`}case"normalize_invoice_month":{const p=c.column??"InvoiceMonth",h=c.normalizedCount,m=c.skippedCount;return` ${p} ${h??0} ${m??0}`}case"detect_outliers":{const p=c.column??"value",h=c.count,m=c.threshold;return` ${p} ${h??0}  ${m??"?"}`}case"execute_js_code":{const p=typeof c.column=="string"?c.column:null,h=c.removedRows,m=c.addedRows,_=c.modifiedRows,g=[h?` ${h}`:null,m?` ${m}`:null,_?` ${_}`:null].filter(Boolean),T=g.length?g.join(" / "):"";return p?` ${p}${T}`:`${T}`}case"aggregate_plan":{const p=c.planTitle??e.description,h=c.rows;return`${p} ${h??0} `}default:return null}})();r&&s.push(r);const a=t.loopBudget.exceeded||t.loopBudget.actsUsed>=t.loopBudget.maxActs,u={type:"text_response",responseType:"text_response",stepId:e.id,stateTag:`ts${Date.now().toString(36)}-verify`,timestamp:new Date().toISOString(),reason:"",text:n?`${e.description}
${s.join("  ")}${a?`
 `:""}`:`${e.description}${a?`
 `:""}`};return{state:{...t,phase:"verify",pendingVerification:null,loopBudget:{...t.loopBudget,exceeded:a},blockedBy:a?"loop_budget_exceeded":t.blockedBy},actions:[u],label:"verify"}},F_=({state:t})=>{const e={type:"text_response",responseType:"text_response",stepId:t.currentStepId??"adjust-next-step",stateTag:`ts${Date.now().toString(36)}-adjust`,timestamp:new Date().toISOString(),reason:"",text:""};return{state:t,actions:[e],label:"adjust"}},L_=[Xu,sc,k_,b_,U_,F_],$_=t=>{let e=t.state;const n=[];for(const s of L_){const i=s({state:e,payload:t.payload});if(e=i.state,i.actions.length>0&&n.push(...i.actions),i.halted)return{state:e,actions:n,halted:!0,label:i.label}}return{state:e,actions:n,halted:!1,label:"complete"}},Fi=self;let ge=yu();const jo=20,He=t=>{Fi.postMessage(t)},Je=()=>Date.now(),au=()=>{He({type:"graph/ready",version:lu,timestamp:Je()})},V_=t=>{switch(t.type){case"graph/init":au();return;case"graph/ping":He({type:"graph/pong",nonce:t.nonce,timestamp:Je()});return;case"graph/shutdown":He({type:"graph/log",level:"info",message:t.reason?`Graph runtime shutting down: ${t.reason}`:"Graph runtime shutting down by request.",timestamp:Je()}),Fi.close();return;case"graph/applyActions":G_(t.actions??[]);return;case"graph/runPipeline":q_(t.payload??{});return;case"graph/userReply":B_(t.optionId??null,t.freeText??null);return;case"graph/tool_result":O_(t.verification);return;default:He({type:"graph/log",level:"warn",message:`Unhandled client event ${t.type}`,timestamp:Je()})}},G_=t=>{var s,i,r,a;const e=Je(),n=ta(ge,t);n.ok&&n.nextState&&(ge=n.nextState),He({type:"graph/validation",ok:n.ok,timestamp:e,code:(i=(s=n.violations)==null?void 0:s[0])==null?void 0:i.code,reason:(a=(r=n.violations)==null?void 0:r[0])==null?void 0:a.message,state:n.nextState})},q_=t=>{const e=$_({state:ge,payload:t});ge=e.state,He({type:"graph/pipeline",node:e.label,actions:e.actions,state:ge,timestamp:Je()})},B_=(t,e)=>{var r;const n=ge.awaitPrompt,s=((r=ge.pendingPlan)==null?void 0:r.plan)??null;ge={...ge,awaitingUser:!1,blockedBy:null,awaitPrompt:null,awaitPromptId:null,pendingUserReply:{optionId:t??null,freeText:e??null,promptId:(n==null?void 0:n.promptId)??null,question:(n==null?void 0:n.question)??"User follow-up",options:(n==null?void 0:n.options)??[],at:new Date().toISOString(),plan:s},stateTag:"context_ready",updatedAt:new Date().toISOString()};const i=t||e?`User replied with ${t??""} ${e??""}`.trim():"User reply received.";He({type:"graph/log",level:"info",message:i,timestamp:Je()})},O_=t=>{var a;const e=`verify-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,6)}`,n=new Date().toISOString(),s={id:e,kind:typeof((a=t.payload)==null?void 0:a.kind)=="string"?t.payload.kind:"tool_result",payload:{description:t.description,summary:t.summary??null,meta:t.meta??null,...t.payload??{}},at:n},i=[...ge.observations,s],r=i.length>jo?i.slice(i.length-jo):i;ge={...ge,pendingVerification:{id:e,description:t.description,meta:t.meta?{...t.meta,summary:t.summary??void 0}:null,summary:t.summary??null,payload:t.payload??null,createdAt:n},observations:r}};Fi.addEventListener("message",t=>{const e=t.data;if(!e||typeof e!="object"||typeof e.type!="string"){He({type:"graph/log",level:"warn",message:"Ignored message without graph type.",timestamp:Je()});return}V_(e)});au();
