const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["agent_csv_promptRunner-C4Kucmg5.js","agent_csv_planBridge-DeGTPupn.js"])))=>i.map(i=>d[i]);
(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();function Wp(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Cf={exports:{}},Xi={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tv;function rE(){if(tv)return Xi;tv=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(s,i,o){var u=null;if(o!==void 0&&(u=""+o),i.key!==void 0&&(u=""+i.key),"key"in i){o={};for(var d in i)d!=="key"&&(o[d]=i[d])}else o=i;return i=o.ref,{$$typeof:t,type:s,key:u,ref:i!==void 0?i:null,props:o}}return Xi.Fragment=e,Xi.jsx=n,Xi.jsxs=n,Xi}var nv;function iE(){return nv||(nv=1,Cf.exports=rE()),Cf.exports}var w=iE(),Af={exports:{}},Ne={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sv;function oE(){if(sv)return Ne;sv=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),u=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),S=Symbol.for("react.activity"),_=Symbol.iterator;function T(H){return H===null||typeof H!="object"?null:(H=_&&H[_]||H["@@iterator"],typeof H=="function"?H:null)}var C={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},N=Object.assign,E={};function L(H,ee,W){this.props=H,this.context=ee,this.refs=E,this.updater=W||C}L.prototype.isReactComponent={},L.prototype.setState=function(H,ee){if(typeof H!="object"&&typeof H!="function"&&H!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,H,ee,"setState")},L.prototype.forceUpdate=function(H){this.updater.enqueueForceUpdate(this,H,"forceUpdate")};function B(){}B.prototype=L.prototype;function O(H,ee,W){this.props=H,this.context=ee,this.refs=E,this.updater=W||C}var x=O.prototype=new B;x.constructor=O,N(x,L.prototype),x.isPureReactComponent=!0;var I=Array.isArray;function D(){}var R={H:null,A:null,T:null,S:null},P=Object.prototype.hasOwnProperty;function A(H,ee,W){var le=W.ref;return{$$typeof:t,type:H,key:ee,ref:le!==void 0?le:null,props:W}}function k(H,ee){return A(H.type,ee,H.props)}function F(H){return typeof H=="object"&&H!==null&&H.$$typeof===t}function U(H){var ee={"=":"=0",":":"=2"};return"$"+H.replace(/[=:]/g,function(W){return ee[W]})}var z=/\/+/g;function oe(H,ee){return typeof H=="object"&&H!==null&&H.key!=null?U(""+H.key):ee.toString(36)}function se(H){switch(H.status){case"fulfilled":return H.value;case"rejected":throw H.reason;default:switch(typeof H.status=="string"?H.then(D,D):(H.status="pending",H.then(function(ee){H.status==="pending"&&(H.status="fulfilled",H.value=ee)},function(ee){H.status==="pending"&&(H.status="rejected",H.reason=ee)})),H.status){case"fulfilled":return H.value;case"rejected":throw H.reason}}throw H}function q(H,ee,W,le,ie){var ue=typeof H;(ue==="undefined"||ue==="boolean")&&(H=null);var me=!1;if(H===null)me=!0;else switch(ue){case"bigint":case"string":case"number":me=!0;break;case"object":switch(H.$$typeof){case t:case e:me=!0;break;case y:return me=H._init,q(me(H._payload),ee,W,le,ie)}}if(me)return ie=ie(H),me=le===""?"."+oe(H,0):le,I(ie)?(W="",me!=null&&(W=me.replace(z,"$&/")+"/"),q(ie,ee,W,"",function(ve){return ve})):ie!=null&&(F(ie)&&(ie=k(ie,W+(ie.key==null||H&&H.key===ie.key?"":(""+ie.key).replace(z,"$&/")+"/")+me)),ee.push(ie)),1;me=0;var Ee=le===""?".":le+":";if(I(H))for(var Ae=0;Ae<H.length;Ae++)le=H[Ae],ue=Ee+oe(le,Ae),me+=q(le,ee,W,ue,ie);else if(Ae=T(H),typeof Ae=="function")for(H=Ae.call(H),Ae=0;!(le=H.next()).done;)le=le.value,ue=Ee+oe(le,Ae++),me+=q(le,ee,W,ue,ie);else if(ue==="object"){if(typeof H.then=="function")return q(se(H),ee,W,le,ie);throw ee=String(H),Error("Objects are not valid as a React child (found: "+(ee==="[object Object]"?"object with keys {"+Object.keys(H).join(", ")+"}":ee)+"). If you meant to render a collection of children, use an array instead.")}return me}function j(H,ee,W){if(H==null)return H;var le=[],ie=0;return q(H,le,"","",function(ue){return ee.call(W,ue,ie++)}),le}function ae(H){if(H._status===-1){var ee=H._result;ee=ee(),ee.then(function(W){(H._status===0||H._status===-1)&&(H._status=1,H._result=W)},function(W){(H._status===0||H._status===-1)&&(H._status=2,H._result=W)}),H._status===-1&&(H._status=0,H._result=ee)}if(H._status===1)return H._result.default;throw H._result}var ge=typeof reportError=="function"?reportError:function(H){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var ee=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof H=="object"&&H!==null&&typeof H.message=="string"?String(H.message):String(H),error:H});if(!window.dispatchEvent(ee))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",H);return}console.error(H)},Ce={map:j,forEach:function(H,ee,W){j(H,function(){ee.apply(this,arguments)},W)},count:function(H){var ee=0;return j(H,function(){ee++}),ee},toArray:function(H){return j(H,function(ee){return ee})||[]},only:function(H){if(!F(H))throw Error("React.Children.only expected to receive a single React element child.");return H}};return Ne.Activity=S,Ne.Children=Ce,Ne.Component=L,Ne.Fragment=n,Ne.Profiler=i,Ne.PureComponent=O,Ne.StrictMode=s,Ne.Suspense=m,Ne.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=R,Ne.__COMPILER_RUNTIME={__proto__:null,c:function(H){return R.H.useMemoCache(H)}},Ne.cache=function(H){return function(){return H.apply(null,arguments)}},Ne.cacheSignal=function(){return null},Ne.cloneElement=function(H,ee,W){if(H==null)throw Error("The argument must be a React element, but you passed "+H+".");var le=N({},H.props),ie=H.key;if(ee!=null)for(ue in ee.key!==void 0&&(ie=""+ee.key),ee)!P.call(ee,ue)||ue==="key"||ue==="__self"||ue==="__source"||ue==="ref"&&ee.ref===void 0||(le[ue]=ee[ue]);var ue=arguments.length-2;if(ue===1)le.children=W;else if(1<ue){for(var me=Array(ue),Ee=0;Ee<ue;Ee++)me[Ee]=arguments[Ee+2];le.children=me}return A(H.type,ie,le)},Ne.createContext=function(H){return H={$$typeof:u,_currentValue:H,_currentValue2:H,_threadCount:0,Provider:null,Consumer:null},H.Provider=H,H.Consumer={$$typeof:o,_context:H},H},Ne.createElement=function(H,ee,W){var le,ie={},ue=null;if(ee!=null)for(le in ee.key!==void 0&&(ue=""+ee.key),ee)P.call(ee,le)&&le!=="key"&&le!=="__self"&&le!=="__source"&&(ie[le]=ee[le]);var me=arguments.length-2;if(me===1)ie.children=W;else if(1<me){for(var Ee=Array(me),Ae=0;Ae<me;Ae++)Ee[Ae]=arguments[Ae+2];ie.children=Ee}if(H&&H.defaultProps)for(le in me=H.defaultProps,me)ie[le]===void 0&&(ie[le]=me[le]);return A(H,ue,ie)},Ne.createRef=function(){return{current:null}},Ne.forwardRef=function(H){return{$$typeof:d,render:H}},Ne.isValidElement=F,Ne.lazy=function(H){return{$$typeof:y,_payload:{_status:-1,_result:H},_init:ae}},Ne.memo=function(H,ee){return{$$typeof:f,type:H,compare:ee===void 0?null:ee}},Ne.startTransition=function(H){var ee=R.T,W={};R.T=W;try{var le=H(),ie=R.S;ie!==null&&ie(W,le),typeof le=="object"&&le!==null&&typeof le.then=="function"&&le.then(D,ge)}catch(ue){ge(ue)}finally{ee!==null&&W.types!==null&&(ee.types=W.types),R.T=ee}},Ne.unstable_useCacheRefresh=function(){return R.H.useCacheRefresh()},Ne.use=function(H){return R.H.use(H)},Ne.useActionState=function(H,ee,W){return R.H.useActionState(H,ee,W)},Ne.useCallback=function(H,ee){return R.H.useCallback(H,ee)},Ne.useContext=function(H){return R.H.useContext(H)},Ne.useDebugValue=function(){},Ne.useDeferredValue=function(H,ee){return R.H.useDeferredValue(H,ee)},Ne.useEffect=function(H,ee){return R.H.useEffect(H,ee)},Ne.useEffectEvent=function(H){return R.H.useEffectEvent(H)},Ne.useId=function(){return R.H.useId()},Ne.useImperativeHandle=function(H,ee,W){return R.H.useImperativeHandle(H,ee,W)},Ne.useInsertionEffect=function(H,ee){return R.H.useInsertionEffect(H,ee)},Ne.useLayoutEffect=function(H,ee){return R.H.useLayoutEffect(H,ee)},Ne.useMemo=function(H,ee){return R.H.useMemo(H,ee)},Ne.useOptimistic=function(H,ee){return R.H.useOptimistic(H,ee)},Ne.useReducer=function(H,ee,W){return R.H.useReducer(H,ee,W)},Ne.useRef=function(H){return R.H.useRef(H)},Ne.useState=function(H){return R.H.useState(H)},Ne.useSyncExternalStore=function(H,ee,W){return R.H.useSyncExternalStore(H,ee,W)},Ne.useTransition=function(){return R.H.useTransition()},Ne.version="19.2.0",Ne}var av;function Eo(){return av||(av=1,Af.exports=oE()),Af.exports}var re=Eo();const ws=Wp(re);var Ef={exports:{}},Qi={},Nf={exports:{}},If={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rv;function lE(){return rv||(rv=1,(function(t){function e(q,j){var ae=q.length;q.push(j);e:for(;0<ae;){var ge=ae-1>>>1,Ce=q[ge];if(0<i(Ce,j))q[ge]=j,q[ae]=Ce,ae=ge;else break e}}function n(q){return q.length===0?null:q[0]}function s(q){if(q.length===0)return null;var j=q[0],ae=q.pop();if(ae!==j){q[0]=ae;e:for(var ge=0,Ce=q.length,H=Ce>>>1;ge<H;){var ee=2*(ge+1)-1,W=q[ee],le=ee+1,ie=q[le];if(0>i(W,ae))le<Ce&&0>i(ie,W)?(q[ge]=ie,q[le]=ae,ge=le):(q[ge]=W,q[ee]=ae,ge=ee);else if(le<Ce&&0>i(ie,ae))q[ge]=ie,q[le]=ae,ge=le;else break e}}return j}function i(q,j){var ae=q.sortIndex-j.sortIndex;return ae!==0?ae:q.id-j.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var u=Date,d=u.now();t.unstable_now=function(){return u.now()-d}}var m=[],f=[],y=1,S=null,_=3,T=!1,C=!1,N=!1,E=!1,L=typeof setTimeout=="function"?setTimeout:null,B=typeof clearTimeout=="function"?clearTimeout:null,O=typeof setImmediate<"u"?setImmediate:null;function x(q){for(var j=n(f);j!==null;){if(j.callback===null)s(f);else if(j.startTime<=q)s(f),j.sortIndex=j.expirationTime,e(m,j);else break;j=n(f)}}function I(q){if(N=!1,x(q),!C)if(n(m)!==null)C=!0,D||(D=!0,U());else{var j=n(f);j!==null&&se(I,j.startTime-q)}}var D=!1,R=-1,P=5,A=-1;function k(){return E?!0:!(t.unstable_now()-A<P)}function F(){if(E=!1,D){var q=t.unstable_now();A=q;var j=!0;try{e:{C=!1,N&&(N=!1,B(R),R=-1),T=!0;var ae=_;try{t:{for(x(q),S=n(m);S!==null&&!(S.expirationTime>q&&k());){var ge=S.callback;if(typeof ge=="function"){S.callback=null,_=S.priorityLevel;var Ce=ge(S.expirationTime<=q);if(q=t.unstable_now(),typeof Ce=="function"){S.callback=Ce,x(q),j=!0;break t}S===n(m)&&s(m),x(q)}else s(m);S=n(m)}if(S!==null)j=!0;else{var H=n(f);H!==null&&se(I,H.startTime-q),j=!1}}break e}finally{S=null,_=ae,T=!1}j=void 0}}finally{j?U():D=!1}}}var U;if(typeof O=="function")U=function(){O(F)};else if(typeof MessageChannel<"u"){var z=new MessageChannel,oe=z.port2;z.port1.onmessage=F,U=function(){oe.postMessage(null)}}else U=function(){L(F,0)};function se(q,j){R=L(function(){q(t.unstable_now())},j)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(q){q.callback=null},t.unstable_forceFrameRate=function(q){0>q||125<q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<q?Math.floor(1e3/q):5},t.unstable_getCurrentPriorityLevel=function(){return _},t.unstable_next=function(q){switch(_){case 1:case 2:case 3:var j=3;break;default:j=_}var ae=_;_=j;try{return q()}finally{_=ae}},t.unstable_requestPaint=function(){E=!0},t.unstable_runWithPriority=function(q,j){switch(q){case 1:case 2:case 3:case 4:case 5:break;default:q=3}var ae=_;_=q;try{return j()}finally{_=ae}},t.unstable_scheduleCallback=function(q,j,ae){var ge=t.unstable_now();switch(typeof ae=="object"&&ae!==null?(ae=ae.delay,ae=typeof ae=="number"&&0<ae?ge+ae:ge):ae=ge,q){case 1:var Ce=-1;break;case 2:Ce=250;break;case 5:Ce=1073741823;break;case 4:Ce=1e4;break;default:Ce=5e3}return Ce=ae+Ce,q={id:y++,callback:j,priorityLevel:q,startTime:ae,expirationTime:Ce,sortIndex:-1},ae>ge?(q.sortIndex=ae,e(f,q),n(m)===null&&q===n(f)&&(N?(B(R),R=-1):N=!0,se(I,ae-ge))):(q.sortIndex=Ce,e(m,q),C||T||(C=!0,D||(D=!0,U()))),q},t.unstable_shouldYield=k,t.unstable_wrapCallback=function(q){var j=_;return function(){var ae=_;_=j;try{return q.apply(this,arguments)}finally{_=ae}}}})(If)),If}var iv;function uE(){return iv||(iv=1,Nf.exports=lE()),Nf.exports}var Rf={exports:{}},Ot={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ov;function cE(){if(ov)return Ot;ov=1;var t=Eo();function e(m){var f="https://react.dev/errors/"+m;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)f+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+m+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var s={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},i=Symbol.for("react.portal");function o(m,f,y){var S=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:S==null?null:""+S,children:m,containerInfo:f,implementation:y}}var u=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(m,f){if(m==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return Ot.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,Ot.createPortal=function(m,f){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(e(299));return o(m,f,null,y)},Ot.flushSync=function(m){var f=u.T,y=s.p;try{if(u.T=null,s.p=2,m)return m()}finally{u.T=f,s.p=y,s.d.f()}},Ot.preconnect=function(m,f){typeof m=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,s.d.C(m,f))},Ot.prefetchDNS=function(m){typeof m=="string"&&s.d.D(m)},Ot.preinit=function(m,f){if(typeof m=="string"&&f&&typeof f.as=="string"){var y=f.as,S=d(y,f.crossOrigin),_=typeof f.integrity=="string"?f.integrity:void 0,T=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;y==="style"?s.d.S(m,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:S,integrity:_,fetchPriority:T}):y==="script"&&s.d.X(m,{crossOrigin:S,integrity:_,fetchPriority:T,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},Ot.preinitModule=function(m,f){if(typeof m=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var y=d(f.as,f.crossOrigin);s.d.M(m,{crossOrigin:y,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&s.d.M(m)},Ot.preload=function(m,f){if(typeof m=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var y=f.as,S=d(y,f.crossOrigin);s.d.L(m,y,{crossOrigin:S,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},Ot.preloadModule=function(m,f){if(typeof m=="string")if(f){var y=d(f.as,f.crossOrigin);s.d.m(m,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:y,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else s.d.m(m)},Ot.requestFormReset=function(m){s.d.r(m)},Ot.unstable_batchedUpdates=function(m,f){return m(f)},Ot.useFormState=function(m,f,y){return u.H.useFormState(m,f,y)},Ot.useFormStatus=function(){return u.H.useHostTransitionStatus()},Ot.version="19.2.0",Ot}var lv;function dE(){if(lv)return Rf.exports;lv=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Rf.exports=cE(),Rf.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uv;function fE(){if(uv)return Qi;uv=1;var t=uE(),e=Eo(),n=dE();function s(a){var r="https://react.dev/errors/"+a;if(1<arguments.length){r+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)r+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+a+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function o(a){var r=a,l=a;if(a.alternate)for(;r.return;)r=r.return;else{a=r;do r=a,(r.flags&4098)!==0&&(l=r.return),a=r.return;while(a)}return r.tag===3?l:null}function u(a){if(a.tag===13){var r=a.memoizedState;if(r===null&&(a=a.alternate,a!==null&&(r=a.memoizedState)),r!==null)return r.dehydrated}return null}function d(a){if(a.tag===31){var r=a.memoizedState;if(r===null&&(a=a.alternate,a!==null&&(r=a.memoizedState)),r!==null)return r.dehydrated}return null}function m(a){if(o(a)!==a)throw Error(s(188))}function f(a){var r=a.alternate;if(!r){if(r=o(a),r===null)throw Error(s(188));return r!==a?null:a}for(var l=a,c=r;;){var g=l.return;if(g===null)break;var v=g.alternate;if(v===null){if(c=g.return,c!==null){l=c;continue}break}if(g.child===v.child){for(v=g.child;v;){if(v===l)return m(g),a;if(v===c)return m(g),r;v=v.sibling}throw Error(s(188))}if(l.return!==c.return)l=g,c=v;else{for(var b=!1,M=g.child;M;){if(M===l){b=!0,l=g,c=v;break}if(M===c){b=!0,c=g,l=v;break}M=M.sibling}if(!b){for(M=v.child;M;){if(M===l){b=!0,l=v,c=g;break}if(M===c){b=!0,c=v,l=g;break}M=M.sibling}if(!b)throw Error(s(189))}}if(l.alternate!==c)throw Error(s(190))}if(l.tag!==3)throw Error(s(188));return l.stateNode.current===l?a:r}function y(a){var r=a.tag;if(r===5||r===26||r===27||r===6)return a;for(a=a.child;a!==null;){if(r=y(a),r!==null)return r;a=a.sibling}return null}var S=Object.assign,_=Symbol.for("react.element"),T=Symbol.for("react.transitional.element"),C=Symbol.for("react.portal"),N=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),L=Symbol.for("react.profiler"),B=Symbol.for("react.consumer"),O=Symbol.for("react.context"),x=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),D=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),P=Symbol.for("react.lazy"),A=Symbol.for("react.activity"),k=Symbol.for("react.memo_cache_sentinel"),F=Symbol.iterator;function U(a){return a===null||typeof a!="object"?null:(a=F&&a[F]||a["@@iterator"],typeof a=="function"?a:null)}var z=Symbol.for("react.client.reference");function oe(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===z?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case N:return"Fragment";case L:return"Profiler";case E:return"StrictMode";case I:return"Suspense";case D:return"SuspenseList";case A:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case C:return"Portal";case O:return a.displayName||"Context";case B:return(a._context.displayName||"Context")+".Consumer";case x:var r=a.render;return a=a.displayName,a||(a=r.displayName||r.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case R:return r=a.displayName||null,r!==null?r:oe(a.type)||"Memo";case P:r=a._payload,a=a._init;try{return oe(a(r))}catch{}}return null}var se=Array.isArray,q=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,j=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ae={pending:!1,data:null,method:null,action:null},ge=[],Ce=-1;function H(a){return{current:a}}function ee(a){0>Ce||(a.current=ge[Ce],ge[Ce]=null,Ce--)}function W(a,r){Ce++,ge[Ce]=a.current,a.current=r}var le=H(null),ie=H(null),ue=H(null),me=H(null);function Ee(a,r){switch(W(ue,r),W(ie,a),W(le,null),r.nodeType){case 9:case 11:a=(a=r.documentElement)&&(a=a.namespaceURI)?T0(a):0;break;default:if(a=r.tagName,r=r.namespaceURI)r=T0(r),a=C0(r,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}ee(le),W(le,a)}function Ae(){ee(le),ee(ie),ee(ue)}function ve(a){a.memoizedState!==null&&W(me,a);var r=le.current,l=C0(r,a.type);r!==l&&(W(ie,a),W(le,l))}function Et(a){ie.current===a&&(ee(le),ee(ie)),me.current===a&&(ee(me),ji._currentValue=ae)}var Re,On;function et(a){if(Re===void 0)try{throw Error()}catch(l){var r=l.stack.trim().match(/\n( *(at )?)/);Re=r&&r[1]||"",On=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Re+a+On}var Zt=!1;function Ft(a,r){if(!a||Zt)return"";Zt=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var c={DetermineComponentFrameRoot:function(){try{if(r){var ne=function(){throw Error()};if(Object.defineProperty(ne.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ne,[])}catch(Q){var K=Q}Reflect.construct(a,[],ne)}else{try{ne.call()}catch(Q){K=Q}a.call(ne.prototype)}}else{try{throw Error()}catch(Q){K=Q}(ne=a())&&typeof ne.catch=="function"&&ne.catch(function(){})}}catch(Q){if(Q&&K&&typeof Q.stack=="string")return[Q.stack,K.stack]}return[null,null]}};c.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var g=Object.getOwnPropertyDescriptor(c.DetermineComponentFrameRoot,"name");g&&g.configurable&&Object.defineProperty(c.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var v=c.DetermineComponentFrameRoot(),b=v[0],M=v[1];if(b&&M){var $=b.split(`
`),J=M.split(`
`);for(g=c=0;c<$.length&&!$[c].includes("DetermineComponentFrameRoot");)c++;for(;g<J.length&&!J[g].includes("DetermineComponentFrameRoot");)g++;if(c===$.length||g===J.length)for(c=$.length-1,g=J.length-1;1<=c&&0<=g&&$[c]!==J[g];)g--;for(;1<=c&&0<=g;c--,g--)if($[c]!==J[g]){if(c!==1||g!==1)do if(c--,g--,0>g||$[c]!==J[g]){var Z=`
`+$[c].replace(" at new "," at ");return a.displayName&&Z.includes("<anonymous>")&&(Z=Z.replace("<anonymous>",a.displayName)),Z}while(1<=c&&0<=g);break}}}finally{Zt=!1,Error.prepareStackTrace=l}return(l=a?a.displayName||a.name:"")?et(l):""}function Se(a,r){switch(a.tag){case 26:case 27:case 5:return et(a.type);case 16:return et("Lazy");case 13:return a.child!==r&&r!==null?et("Suspense Fallback"):et("Suspense");case 19:return et("SuspenseList");case 0:case 15:return Ft(a.type,!1);case 11:return Ft(a.type.render,!1);case 1:return Ft(a.type,!0);case 31:return et("Activity");default:return""}}function je(a){try{var r="",l=null;do r+=Se(a,l),l=a,a=a.return;while(a);return r}catch(c){return`
Error generating stack: `+c.message+`
`+c.stack}}var en=Object.prototype.hasOwnProperty,tn=t.unstable_scheduleCallback,mt=t.unstable_cancelCallback,$t=t.unstable_shouldYield,ca=t.unstable_requestPaint,Fe=t.unstable_now,da=t.unstable_getCurrentPriorityLevel,Ga=t.unstable_ImmediatePriority,Oo=t.unstable_UserBlockingPriority,Va=t.unstable_NormalPriority,cc=t.unstable_LowPriority,ai=t.unstable_IdlePriority,dc=t.log,fc=t.unstable_setDisableYieldValue,fa=null,Ut=null;function ce(a){if(typeof dc=="function"&&fc(a),Ut&&typeof Ut.setStrictMode=="function")try{Ut.setStrictMode(fa,a)}catch{}}var we=Math.clz32?Math.clz32:za,Gt=Math.log,Kn=Math.LN2;function za(a){return a>>>=0,a===0?32:31-(Gt(a)/Kn|0)|0}var he=256,Xn=262144,Be=4194304;function Nt(a){var r=a&42;if(r!==0)return r;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return a&261888;case 262144:case 524288:case 1048576:case 2097152:return a&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function Qn(a,r,l){var c=a.pendingLanes;if(c===0)return 0;var g=0,v=a.suspendedLanes,b=a.pingedLanes;a=a.warmLanes;var M=c&134217727;return M!==0?(c=M&~v,c!==0?g=Nt(c):(b&=M,b!==0?g=Nt(b):l||(l=M&~a,l!==0&&(g=Nt(l))))):(M=c&~v,M!==0?g=Nt(M):b!==0?g=Nt(b):l||(l=c&~a,l!==0&&(g=Nt(l)))),g===0?0:r!==0&&r!==g&&(r&v)===0&&(v=g&-g,l=r&-r,v>=l||v===32&&(l&4194048)!==0)?r:g}function Ns(a,r){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&r)===0}function ri(a,r){switch(a){case 1:case 2:case 4:case 8:case 64:return r+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function qo(){var a=Be;return Be<<=1,(Be&62914560)===0&&(Be=4194304),a}function ii(a){for(var r=[],l=0;31>l;l++)r.push(a);return r}function Is(a,r){a.pendingLanes|=r,r!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function pc(a,r,l,c,g,v){var b=a.pendingLanes;a.pendingLanes=l,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=l,a.entangledLanes&=l,a.errorRecoveryDisabledLanes&=l,a.shellSuspendCounter=0;var M=a.entanglements,$=a.expirationTimes,J=a.hiddenUpdates;for(l=b&~l;0<l;){var Z=31-we(l),ne=1<<Z;M[Z]=0,$[Z]=-1;var K=J[Z];if(K!==null)for(J[Z]=null,Z=0;Z<K.length;Z++){var Q=K[Z];Q!==null&&(Q.lane&=-536870913)}l&=~ne}c!==0&&Bo(a,c,0),v!==0&&g===0&&a.tag!==0&&(a.suspendedLanes|=v&~(b&~r))}function Bo(a,r,l){a.pendingLanes|=r,a.suspendedLanes&=~r;var c=31-we(r);a.entangledLanes|=r,a.entanglements[c]=a.entanglements[c]|1073741824|l&261930}function Fo(a,r){var l=a.entangledLanes|=r;for(a=a.entanglements;l;){var c=31-we(l),g=1<<c;g&r|a[c]&r&&(a[c]|=r),l&=~g}}function $o(a,r){var l=r&-r;return l=(l&42)!==0?1:bt(l),(l&(a.suspendedLanes|r))!==0?0:l}function bt(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function mc(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function uh(){var a=j.p;return a!==0?a:(a=window.event,a===void 0?32:J0(a.type))}function ch(a,r){var l=j.p;try{return j.p=a,r()}finally{j.p=l}}var Rs=Math.random().toString(36).slice(2),It="__reactFiber$"+Rs,Vt="__reactProps$"+Rs,ja="__reactContainer$"+Rs,hc="__reactEvents$"+Rs,JT="__reactListeners$"+Rs,KT="__reactHandles$"+Rs,dh="__reactResources$"+Rs,oi="__reactMarker$"+Rs;function gc(a){delete a[It],delete a[Vt],delete a[hc],delete a[JT],delete a[KT]}function Ya(a){var r=a[It];if(r)return r;for(var l=a.parentNode;l;){if(r=l[ja]||l[It]){if(l=r.alternate,r.child!==null||l!==null&&l.child!==null)for(a=P0(a);a!==null;){if(l=a[It])return l;a=P0(a)}return r}a=l,l=a.parentNode}return null}function Ja(a){if(a=a[It]||a[ja]){var r=a.tag;if(r===5||r===6||r===13||r===31||r===26||r===27||r===3)return a}return null}function li(a){var r=a.tag;if(r===5||r===26||r===27||r===6)return a.stateNode;throw Error(s(33))}function Ka(a){var r=a[dh];return r||(r=a[dh]={hoistableStyles:new Map,hoistableScripts:new Map}),r}function Tt(a){a[oi]=!0}var fh=new Set,ph={};function pa(a,r){Xa(a,r),Xa(a+"Capture",r)}function Xa(a,r){for(ph[a]=r,a=0;a<r.length;a++)fh.add(r[a])}var XT=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),mh={},hh={};function QT(a){return en.call(hh,a)?!0:en.call(mh,a)?!1:XT.test(a)?hh[a]=!0:(mh[a]=!0,!1)}function Ho(a,r,l){if(QT(r))if(l===null)a.removeAttribute(r);else{switch(typeof l){case"undefined":case"function":case"symbol":a.removeAttribute(r);return;case"boolean":var c=r.toLowerCase().slice(0,5);if(c!=="data-"&&c!=="aria-"){a.removeAttribute(r);return}}a.setAttribute(r,""+l)}}function Go(a,r,l){if(l===null)a.removeAttribute(r);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(r);return}a.setAttribute(r,""+l)}}function Wn(a,r,l,c){if(c===null)a.removeAttribute(l);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(l);return}a.setAttributeNS(r,l,""+c)}}function hn(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function gh(a){var r=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function WT(a,r,l){var c=Object.getOwnPropertyDescriptor(a.constructor.prototype,r);if(!a.hasOwnProperty(r)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var g=c.get,v=c.set;return Object.defineProperty(a,r,{configurable:!0,get:function(){return g.call(this)},set:function(b){l=""+b,v.call(this,b)}}),Object.defineProperty(a,r,{enumerable:c.enumerable}),{getValue:function(){return l},setValue:function(b){l=""+b},stopTracking:function(){a._valueTracker=null,delete a[r]}}}}function yc(a){if(!a._valueTracker){var r=gh(a)?"checked":"value";a._valueTracker=WT(a,r,""+a[r])}}function yh(a){if(!a)return!1;var r=a._valueTracker;if(!r)return!0;var l=r.getValue(),c="";return a&&(c=gh(a)?a.checked?"true":"false":a.value),a=c,a!==l?(r.setValue(a),!0):!1}function Vo(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var ZT=/[\n"\\]/g;function gn(a){return a.replace(ZT,function(r){return"\\"+r.charCodeAt(0).toString(16)+" "})}function vc(a,r,l,c,g,v,b,M){a.name="",b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"?a.type=b:a.removeAttribute("type"),r!=null?b==="number"?(r===0&&a.value===""||a.value!=r)&&(a.value=""+hn(r)):a.value!==""+hn(r)&&(a.value=""+hn(r)):b!=="submit"&&b!=="reset"||a.removeAttribute("value"),r!=null?Sc(a,b,hn(r)):l!=null?Sc(a,b,hn(l)):c!=null&&a.removeAttribute("value"),g==null&&v!=null&&(a.defaultChecked=!!v),g!=null&&(a.checked=g&&typeof g!="function"&&typeof g!="symbol"),M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"?a.name=""+hn(M):a.removeAttribute("name")}function vh(a,r,l,c,g,v,b,M){if(v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"&&(a.type=v),r!=null||l!=null){if(!(v!=="submit"&&v!=="reset"||r!=null)){yc(a);return}l=l!=null?""+hn(l):"",r=r!=null?""+hn(r):l,M||r===a.value||(a.value=r),a.defaultValue=r}c=c??g,c=typeof c!="function"&&typeof c!="symbol"&&!!c,a.checked=M?a.checked:!!c,a.defaultChecked=!!c,b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(a.name=b),yc(a)}function Sc(a,r,l){r==="number"&&Vo(a.ownerDocument)===a||a.defaultValue===""+l||(a.defaultValue=""+l)}function Qa(a,r,l,c){if(a=a.options,r){r={};for(var g=0;g<l.length;g++)r["$"+l[g]]=!0;for(l=0;l<a.length;l++)g=r.hasOwnProperty("$"+a[l].value),a[l].selected!==g&&(a[l].selected=g),g&&c&&(a[l].defaultSelected=!0)}else{for(l=""+hn(l),r=null,g=0;g<a.length;g++){if(a[g].value===l){a[g].selected=!0,c&&(a[g].defaultSelected=!0);return}r!==null||a[g].disabled||(r=a[g])}r!==null&&(r.selected=!0)}}function Sh(a,r,l){if(r!=null&&(r=""+hn(r),r!==a.value&&(a.value=r),l==null)){a.defaultValue!==r&&(a.defaultValue=r);return}a.defaultValue=l!=null?""+hn(l):""}function wh(a,r,l,c){if(r==null){if(c!=null){if(l!=null)throw Error(s(92));if(se(c)){if(1<c.length)throw Error(s(93));c=c[0]}l=c}l==null&&(l=""),r=l}l=hn(r),a.defaultValue=l,c=a.textContent,c===l&&c!==""&&c!==null&&(a.value=c),yc(a)}function Wa(a,r){if(r){var l=a.firstChild;if(l&&l===a.lastChild&&l.nodeType===3){l.nodeValue=r;return}}a.textContent=r}var eC=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function _h(a,r,l){var c=r.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?c?a.setProperty(r,""):r==="float"?a.cssFloat="":a[r]="":c?a.setProperty(r,l):typeof l!="number"||l===0||eC.has(r)?r==="float"?a.cssFloat=l:a[r]=(""+l).trim():a[r]=l+"px"}function xh(a,r,l){if(r!=null&&typeof r!="object")throw Error(s(62));if(a=a.style,l!=null){for(var c in l)!l.hasOwnProperty(c)||r!=null&&r.hasOwnProperty(c)||(c.indexOf("--")===0?a.setProperty(c,""):c==="float"?a.cssFloat="":a[c]="");for(var g in r)c=r[g],r.hasOwnProperty(g)&&l[g]!==c&&_h(a,g,c)}else for(var v in r)r.hasOwnProperty(v)&&_h(a,v,r[v])}function wc(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var tC=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),nC=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function zo(a){return nC.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}function Zn(){}var _c=null;function xc(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Za=null,er=null;function bh(a){var r=Ja(a);if(r&&(a=r.stateNode)){var l=a[Vt]||null;e:switch(a=r.stateNode,r.type){case"input":if(vc(a,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),r=l.name,l.type==="radio"&&r!=null){for(l=a;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+gn(""+r)+'"][type="radio"]'),r=0;r<l.length;r++){var c=l[r];if(c!==a&&c.form===a.form){var g=c[Vt]||null;if(!g)throw Error(s(90));vc(c,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name)}}for(r=0;r<l.length;r++)c=l[r],c.form===a.form&&yh(c)}break e;case"textarea":Sh(a,l.value,l.defaultValue);break e;case"select":r=l.value,r!=null&&Qa(a,!!l.multiple,r,!1)}}}var bc=!1;function Th(a,r,l){if(bc)return a(r,l);bc=!0;try{var c=a(r);return c}finally{if(bc=!1,(Za!==null||er!==null)&&(Pl(),Za&&(r=Za,a=er,er=Za=null,bh(r),a)))for(r=0;r<a.length;r++)bh(a[r])}}function ui(a,r){var l=a.stateNode;if(l===null)return null;var c=l[Vt]||null;if(c===null)return null;l=c[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(a=a.type,c=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!c;break e;default:a=!1}if(a)return null;if(l&&typeof l!="function")throw Error(s(231,r,typeof l));return l}var es=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Tc=!1;if(es)try{var ci={};Object.defineProperty(ci,"passive",{get:function(){Tc=!0}}),window.addEventListener("test",ci,ci),window.removeEventListener("test",ci,ci)}catch{Tc=!1}var Ms=null,Cc=null,jo=null;function Ch(){if(jo)return jo;var a,r=Cc,l=r.length,c,g="value"in Ms?Ms.value:Ms.textContent,v=g.length;for(a=0;a<l&&r[a]===g[a];a++);var b=l-a;for(c=1;c<=b&&r[l-c]===g[v-c];c++);return jo=g.slice(a,1<c?1-c:void 0)}function Yo(a){var r=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&r===13&&(a=13)):a=r,a===10&&(a=13),32<=a||a===13?a:0}function Jo(){return!0}function Ah(){return!1}function zt(a){function r(l,c,g,v,b){this._reactName=l,this._targetInst=g,this.type=c,this.nativeEvent=v,this.target=b,this.currentTarget=null;for(var M in a)a.hasOwnProperty(M)&&(l=a[M],this[M]=l?l(v):v[M]);return this.isDefaultPrevented=(v.defaultPrevented!=null?v.defaultPrevented:v.returnValue===!1)?Jo:Ah,this.isPropagationStopped=Ah,this}return S(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=Jo)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=Jo)},persist:function(){},isPersistent:Jo}),r}var ma={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ko=zt(ma),di=S({},ma,{view:0,detail:0}),sC=zt(di),Ac,Ec,fi,Xo=S({},di,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ic,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==fi&&(fi&&a.type==="mousemove"?(Ac=a.screenX-fi.screenX,Ec=a.screenY-fi.screenY):Ec=Ac=0,fi=a),Ac)},movementY:function(a){return"movementY"in a?a.movementY:Ec}}),Eh=zt(Xo),aC=S({},Xo,{dataTransfer:0}),rC=zt(aC),iC=S({},di,{relatedTarget:0}),Nc=zt(iC),oC=S({},ma,{animationName:0,elapsedTime:0,pseudoElement:0}),lC=zt(oC),uC=S({},ma,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),cC=zt(uC),dC=S({},ma,{data:0}),Nh=zt(dC),fC={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},pC={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},mC={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function hC(a){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(a):(a=mC[a])?!!r[a]:!1}function Ic(){return hC}var gC=S({},di,{key:function(a){if(a.key){var r=fC[a.key]||a.key;if(r!=="Unidentified")return r}return a.type==="keypress"?(a=Yo(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?pC[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ic,charCode:function(a){return a.type==="keypress"?Yo(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Yo(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),yC=zt(gC),vC=S({},Xo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ih=zt(vC),SC=S({},di,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ic}),wC=zt(SC),_C=S({},ma,{propertyName:0,elapsedTime:0,pseudoElement:0}),xC=zt(_C),bC=S({},Xo,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),TC=zt(bC),CC=S({},ma,{newState:0,oldState:0}),AC=zt(CC),EC=[9,13,27,32],Rc=es&&"CompositionEvent"in window,pi=null;es&&"documentMode"in document&&(pi=document.documentMode);var NC=es&&"TextEvent"in window&&!pi,Rh=es&&(!Rc||pi&&8<pi&&11>=pi),Mh=" ",Ph=!1;function Dh(a,r){switch(a){case"keyup":return EC.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Lh(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var tr=!1;function IC(a,r){switch(a){case"compositionend":return Lh(r);case"keypress":return r.which!==32?null:(Ph=!0,Mh);case"textInput":return a=r.data,a===Mh&&Ph?null:a;default:return null}}function RC(a,r){if(tr)return a==="compositionend"||!Rc&&Dh(a,r)?(a=Ch(),jo=Cc=Ms=null,tr=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return Rh&&r.locale!=="ko"?null:r.data;default:return null}}var MC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function kh(a){var r=a&&a.nodeName&&a.nodeName.toLowerCase();return r==="input"?!!MC[a.type]:r==="textarea"}function Uh(a,r,l,c){Za?er?er.push(c):er=[c]:Za=c,r=Bl(r,"onChange"),0<r.length&&(l=new Ko("onChange","change",null,l,c),a.push({event:l,listeners:r}))}var mi=null,hi=null;function PC(a){v0(a,0)}function Qo(a){var r=li(a);if(yh(r))return a}function Oh(a,r){if(a==="change")return r}var qh=!1;if(es){var Mc;if(es){var Pc="oninput"in document;if(!Pc){var Bh=document.createElement("div");Bh.setAttribute("oninput","return;"),Pc=typeof Bh.oninput=="function"}Mc=Pc}else Mc=!1;qh=Mc&&(!document.documentMode||9<document.documentMode)}function Fh(){mi&&(mi.detachEvent("onpropertychange",$h),hi=mi=null)}function $h(a){if(a.propertyName==="value"&&Qo(hi)){var r=[];Uh(r,hi,a,xc(a)),Th(PC,r)}}function DC(a,r,l){a==="focusin"?(Fh(),mi=r,hi=l,mi.attachEvent("onpropertychange",$h)):a==="focusout"&&Fh()}function LC(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Qo(hi)}function kC(a,r){if(a==="click")return Qo(r)}function UC(a,r){if(a==="input"||a==="change")return Qo(r)}function OC(a,r){return a===r&&(a!==0||1/a===1/r)||a!==a&&r!==r}var nn=typeof Object.is=="function"?Object.is:OC;function gi(a,r){if(nn(a,r))return!0;if(typeof a!="object"||a===null||typeof r!="object"||r===null)return!1;var l=Object.keys(a),c=Object.keys(r);if(l.length!==c.length)return!1;for(c=0;c<l.length;c++){var g=l[c];if(!en.call(r,g)||!nn(a[g],r[g]))return!1}return!0}function Hh(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function Gh(a,r){var l=Hh(a);a=0;for(var c;l;){if(l.nodeType===3){if(c=a+l.textContent.length,a<=r&&c>=r)return{node:l,offset:r-a};a=c}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=Hh(l)}}function Vh(a,r){return a&&r?a===r?!0:a&&a.nodeType===3?!1:r&&r.nodeType===3?Vh(a,r.parentNode):"contains"in a?a.contains(r):a.compareDocumentPosition?!!(a.compareDocumentPosition(r)&16):!1:!1}function zh(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var r=Vo(a.document);r instanceof a.HTMLIFrameElement;){try{var l=typeof r.contentWindow.location.href=="string"}catch{l=!1}if(l)a=r.contentWindow;else break;r=Vo(a.document)}return r}function Dc(a){var r=a&&a.nodeName&&a.nodeName.toLowerCase();return r&&(r==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||r==="textarea"||a.contentEditable==="true")}var qC=es&&"documentMode"in document&&11>=document.documentMode,nr=null,Lc=null,yi=null,kc=!1;function jh(a,r,l){var c=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;kc||nr==null||nr!==Vo(c)||(c=nr,"selectionStart"in c&&Dc(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),yi&&gi(yi,c)||(yi=c,c=Bl(Lc,"onSelect"),0<c.length&&(r=new Ko("onSelect","select",null,r,l),a.push({event:r,listeners:c}),r.target=nr)))}function ha(a,r){var l={};return l[a.toLowerCase()]=r.toLowerCase(),l["Webkit"+a]="webkit"+r,l["Moz"+a]="moz"+r,l}var sr={animationend:ha("Animation","AnimationEnd"),animationiteration:ha("Animation","AnimationIteration"),animationstart:ha("Animation","AnimationStart"),transitionrun:ha("Transition","TransitionRun"),transitionstart:ha("Transition","TransitionStart"),transitioncancel:ha("Transition","TransitionCancel"),transitionend:ha("Transition","TransitionEnd")},Uc={},Yh={};es&&(Yh=document.createElement("div").style,"AnimationEvent"in window||(delete sr.animationend.animation,delete sr.animationiteration.animation,delete sr.animationstart.animation),"TransitionEvent"in window||delete sr.transitionend.transition);function ga(a){if(Uc[a])return Uc[a];if(!sr[a])return a;var r=sr[a],l;for(l in r)if(r.hasOwnProperty(l)&&l in Yh)return Uc[a]=r[l];return a}var Jh=ga("animationend"),Kh=ga("animationiteration"),Xh=ga("animationstart"),BC=ga("transitionrun"),FC=ga("transitionstart"),$C=ga("transitioncancel"),Qh=ga("transitionend"),Wh=new Map,Oc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Oc.push("scrollEnd");function In(a,r){Wh.set(a,r),pa(r,[a])}var Wo=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var r=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(r))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)},yn=[],ar=0,qc=0;function Zo(){for(var a=ar,r=qc=ar=0;r<a;){var l=yn[r];yn[r++]=null;var c=yn[r];yn[r++]=null;var g=yn[r];yn[r++]=null;var v=yn[r];if(yn[r++]=null,c!==null&&g!==null){var b=c.pending;b===null?g.next=g:(g.next=b.next,b.next=g),c.pending=g}v!==0&&Zh(l,g,v)}}function el(a,r,l,c){yn[ar++]=a,yn[ar++]=r,yn[ar++]=l,yn[ar++]=c,qc|=c,a.lanes|=c,a=a.alternate,a!==null&&(a.lanes|=c)}function Bc(a,r,l,c){return el(a,r,l,c),tl(a)}function ya(a,r){return el(a,null,null,r),tl(a)}function Zh(a,r,l){a.lanes|=l;var c=a.alternate;c!==null&&(c.lanes|=l);for(var g=!1,v=a.return;v!==null;)v.childLanes|=l,c=v.alternate,c!==null&&(c.childLanes|=l),v.tag===22&&(a=v.stateNode,a===null||a._visibility&1||(g=!0)),a=v,v=v.return;return a.tag===3?(v=a.stateNode,g&&r!==null&&(g=31-we(l),a=v.hiddenUpdates,c=a[g],c===null?a[g]=[r]:c.push(r),r.lane=l|536870912),v):null}function tl(a){if(50<Bi)throw Bi=0,Jd=null,Error(s(185));for(var r=a.return;r!==null;)a=r,r=a.return;return a.tag===3?a.stateNode:null}var rr={};function HC(a,r,l,c){this.tag=a,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function sn(a,r,l,c){return new HC(a,r,l,c)}function Fc(a){return a=a.prototype,!(!a||!a.isReactComponent)}function ts(a,r){var l=a.alternate;return l===null?(l=sn(a.tag,r,a.key,a.mode),l.elementType=a.elementType,l.type=a.type,l.stateNode=a.stateNode,l.alternate=a,a.alternate=l):(l.pendingProps=r,l.type=a.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=a.flags&65011712,l.childLanes=a.childLanes,l.lanes=a.lanes,l.child=a.child,l.memoizedProps=a.memoizedProps,l.memoizedState=a.memoizedState,l.updateQueue=a.updateQueue,r=a.dependencies,l.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},l.sibling=a.sibling,l.index=a.index,l.ref=a.ref,l.refCleanup=a.refCleanup,l}function eg(a,r){a.flags&=65011714;var l=a.alternate;return l===null?(a.childLanes=0,a.lanes=r,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=l.childLanes,a.lanes=l.lanes,a.child=l.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=l.memoizedProps,a.memoizedState=l.memoizedState,a.updateQueue=l.updateQueue,a.type=l.type,r=l.dependencies,a.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),a}function nl(a,r,l,c,g,v){var b=0;if(c=a,typeof a=="function")Fc(a)&&(b=1);else if(typeof a=="string")b=YA(a,l,le.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case A:return a=sn(31,l,r,g),a.elementType=A,a.lanes=v,a;case N:return va(l.children,g,v,r);case E:b=8,g|=24;break;case L:return a=sn(12,l,r,g|2),a.elementType=L,a.lanes=v,a;case I:return a=sn(13,l,r,g),a.elementType=I,a.lanes=v,a;case D:return a=sn(19,l,r,g),a.elementType=D,a.lanes=v,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case O:b=10;break e;case B:b=9;break e;case x:b=11;break e;case R:b=14;break e;case P:b=16,c=null;break e}b=29,l=Error(s(130,a===null?"null":typeof a,"")),c=null}return r=sn(b,l,r,g),r.elementType=a,r.type=c,r.lanes=v,r}function va(a,r,l,c){return a=sn(7,a,c,r),a.lanes=l,a}function $c(a,r,l){return a=sn(6,a,null,r),a.lanes=l,a}function tg(a){var r=sn(18,null,null,0);return r.stateNode=a,r}function Hc(a,r,l){return r=sn(4,a.children!==null?a.children:[],a.key,r),r.lanes=l,r.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},r}var ng=new WeakMap;function vn(a,r){if(typeof a=="object"&&a!==null){var l=ng.get(a);return l!==void 0?l:(r={value:a,source:r,stack:je(r)},ng.set(a,r),r)}return{value:a,source:r,stack:je(r)}}var ir=[],or=0,sl=null,vi=0,Sn=[],wn=0,Ps=null,qn=1,Bn="";function ns(a,r){ir[or++]=vi,ir[or++]=sl,sl=a,vi=r}function sg(a,r,l){Sn[wn++]=qn,Sn[wn++]=Bn,Sn[wn++]=Ps,Ps=a;var c=qn;a=Bn;var g=32-we(c)-1;c&=~(1<<g),l+=1;var v=32-we(r)+g;if(30<v){var b=g-g%5;v=(c&(1<<b)-1).toString(32),c>>=b,g-=b,qn=1<<32-we(r)+g|l<<g|c,Bn=v+a}else qn=1<<v|l<<g|c,Bn=a}function Gc(a){a.return!==null&&(ns(a,1),sg(a,1,0))}function Vc(a){for(;a===sl;)sl=ir[--or],ir[or]=null,vi=ir[--or],ir[or]=null;for(;a===Ps;)Ps=Sn[--wn],Sn[wn]=null,Bn=Sn[--wn],Sn[wn]=null,qn=Sn[--wn],Sn[wn]=null}function ag(a,r){Sn[wn++]=qn,Sn[wn++]=Bn,Sn[wn++]=Ps,qn=r.id,Bn=r.overflow,Ps=a}var Rt=null,nt=null,qe=!1,Ds=null,_n=!1,zc=Error(s(519));function Ls(a){var r=Error(s(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Si(vn(r,a)),zc}function rg(a){var r=a.stateNode,l=a.type,c=a.memoizedProps;switch(r[It]=a,r[Vt]=c,l){case"dialog":ke("cancel",r),ke("close",r);break;case"iframe":case"object":case"embed":ke("load",r);break;case"video":case"audio":for(l=0;l<$i.length;l++)ke($i[l],r);break;case"source":ke("error",r);break;case"img":case"image":case"link":ke("error",r),ke("load",r);break;case"details":ke("toggle",r);break;case"input":ke("invalid",r),vh(r,c.value,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name,!0);break;case"select":ke("invalid",r);break;case"textarea":ke("invalid",r),wh(r,c.value,c.defaultValue,c.children)}l=c.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||r.textContent===""+l||c.suppressHydrationWarning===!0||x0(r.textContent,l)?(c.popover!=null&&(ke("beforetoggle",r),ke("toggle",r)),c.onScroll!=null&&ke("scroll",r),c.onScrollEnd!=null&&ke("scrollend",r),c.onClick!=null&&(r.onclick=Zn),r=!0):r=!1,r||Ls(a,!0)}function ig(a){for(Rt=a.return;Rt;)switch(Rt.tag){case 5:case 31:case 13:_n=!1;return;case 27:case 3:_n=!0;return;default:Rt=Rt.return}}function lr(a){if(a!==Rt)return!1;if(!qe)return ig(a),qe=!0,!1;var r=a.tag,l;if((l=r!==3&&r!==27)&&((l=r===5)&&(l=a.type,l=!(l!=="form"&&l!=="button")||cf(a.type,a.memoizedProps)),l=!l),l&&nt&&Ls(a),ig(a),r===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(317));nt=M0(a)}else if(r===31){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(317));nt=M0(a)}else r===27?(r=nt,Js(a.type)?(a=hf,hf=null,nt=a):nt=r):nt=Rt?bn(a.stateNode.nextSibling):null;return!0}function Sa(){nt=Rt=null,qe=!1}function jc(){var a=Ds;return a!==null&&(Kt===null?Kt=a:Kt.push.apply(Kt,a),Ds=null),a}function Si(a){Ds===null?Ds=[a]:Ds.push(a)}var Yc=H(null),wa=null,ss=null;function ks(a,r,l){W(Yc,r._currentValue),r._currentValue=l}function as(a){a._currentValue=Yc.current,ee(Yc)}function Jc(a,r,l){for(;a!==null;){var c=a.alternate;if((a.childLanes&r)!==r?(a.childLanes|=r,c!==null&&(c.childLanes|=r)):c!==null&&(c.childLanes&r)!==r&&(c.childLanes|=r),a===l)break;a=a.return}}function Kc(a,r,l,c){var g=a.child;for(g!==null&&(g.return=a);g!==null;){var v=g.dependencies;if(v!==null){var b=g.child;v=v.firstContext;e:for(;v!==null;){var M=v;v=g;for(var $=0;$<r.length;$++)if(M.context===r[$]){v.lanes|=l,M=v.alternate,M!==null&&(M.lanes|=l),Jc(v.return,l,a),c||(b=null);break e}v=M.next}}else if(g.tag===18){if(b=g.return,b===null)throw Error(s(341));b.lanes|=l,v=b.alternate,v!==null&&(v.lanes|=l),Jc(b,l,a),b=null}else b=g.child;if(b!==null)b.return=g;else for(b=g;b!==null;){if(b===a){b=null;break}if(g=b.sibling,g!==null){g.return=b.return,b=g;break}b=b.return}g=b}}function ur(a,r,l,c){a=null;for(var g=r,v=!1;g!==null;){if(!v){if((g.flags&524288)!==0)v=!0;else if((g.flags&262144)!==0)break}if(g.tag===10){var b=g.alternate;if(b===null)throw Error(s(387));if(b=b.memoizedProps,b!==null){var M=g.type;nn(g.pendingProps.value,b.value)||(a!==null?a.push(M):a=[M])}}else if(g===me.current){if(b=g.alternate,b===null)throw Error(s(387));b.memoizedState.memoizedState!==g.memoizedState.memoizedState&&(a!==null?a.push(ji):a=[ji])}g=g.return}a!==null&&Kc(r,a,l,c),r.flags|=262144}function al(a){for(a=a.firstContext;a!==null;){if(!nn(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function _a(a){wa=a,ss=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function Mt(a){return og(wa,a)}function rl(a,r){return wa===null&&_a(a),og(a,r)}function og(a,r){var l=r._currentValue;if(r={context:r,memoizedValue:l,next:null},ss===null){if(a===null)throw Error(s(308));ss=r,a.dependencies={lanes:0,firstContext:r},a.flags|=524288}else ss=ss.next=r;return l}var GC=typeof AbortController<"u"?AbortController:function(){var a=[],r=this.signal={aborted:!1,addEventListener:function(l,c){a.push(c)}};this.abort=function(){r.aborted=!0,a.forEach(function(l){return l()})}},VC=t.unstable_scheduleCallback,zC=t.unstable_NormalPriority,ht={$$typeof:O,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Xc(){return{controller:new GC,data:new Map,refCount:0}}function wi(a){a.refCount--,a.refCount===0&&VC(zC,function(){a.controller.abort()})}var _i=null,Qc=0,cr=0,dr=null;function jC(a,r){if(_i===null){var l=_i=[];Qc=0,cr=ef(),dr={status:"pending",value:void 0,then:function(c){l.push(c)}}}return Qc++,r.then(lg,lg),r}function lg(){if(--Qc===0&&_i!==null){dr!==null&&(dr.status="fulfilled");var a=_i;_i=null,cr=0,dr=null;for(var r=0;r<a.length;r++)(0,a[r])()}}function YC(a,r){var l=[],c={status:"pending",value:null,reason:null,then:function(g){l.push(g)}};return a.then(function(){c.status="fulfilled",c.value=r;for(var g=0;g<l.length;g++)(0,l[g])(r)},function(g){for(c.status="rejected",c.reason=g,g=0;g<l.length;g++)(0,l[g])(void 0)}),c}var ug=q.S;q.S=function(a,r){jy=Fe(),typeof r=="object"&&r!==null&&typeof r.then=="function"&&jC(a,r),ug!==null&&ug(a,r)};var xa=H(null);function Wc(){var a=xa.current;return a!==null?a:tt.pooledCache}function il(a,r){r===null?W(xa,xa.current):W(xa,r.pool)}function cg(){var a=Wc();return a===null?null:{parent:ht._currentValue,pool:a}}var fr=Error(s(460)),Zc=Error(s(474)),ol=Error(s(542)),ll={then:function(){}};function dg(a){return a=a.status,a==="fulfilled"||a==="rejected"}function fg(a,r,l){switch(l=a[l],l===void 0?a.push(r):l!==r&&(r.then(Zn,Zn),r=l),r.status){case"fulfilled":return r.value;case"rejected":throw a=r.reason,mg(a),a;default:if(typeof r.status=="string")r.then(Zn,Zn);else{if(a=tt,a!==null&&100<a.shellSuspendCounter)throw Error(s(482));a=r,a.status="pending",a.then(function(c){if(r.status==="pending"){var g=r;g.status="fulfilled",g.value=c}},function(c){if(r.status==="pending"){var g=r;g.status="rejected",g.reason=c}})}switch(r.status){case"fulfilled":return r.value;case"rejected":throw a=r.reason,mg(a),a}throw Ta=r,fr}}function ba(a){try{var r=a._init;return r(a._payload)}catch(l){throw l!==null&&typeof l=="object"&&typeof l.then=="function"?(Ta=l,fr):l}}var Ta=null;function pg(){if(Ta===null)throw Error(s(459));var a=Ta;return Ta=null,a}function mg(a){if(a===fr||a===ol)throw Error(s(483))}var pr=null,xi=0;function ul(a){var r=xi;return xi+=1,pr===null&&(pr=[]),fg(pr,a,r)}function bi(a,r){r=r.props.ref,a.ref=r!==void 0?r:null}function cl(a,r){throw r.$$typeof===_?Error(s(525)):(a=Object.prototype.toString.call(r),Error(s(31,a==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":a)))}function hg(a){function r(V,G){if(a){var Y=V.deletions;Y===null?(V.deletions=[G],V.flags|=16):Y.push(G)}}function l(V,G){if(!a)return null;for(;G!==null;)r(V,G),G=G.sibling;return null}function c(V){for(var G=new Map;V!==null;)V.key!==null?G.set(V.key,V):G.set(V.index,V),V=V.sibling;return G}function g(V,G){return V=ts(V,G),V.index=0,V.sibling=null,V}function v(V,G,Y){return V.index=Y,a?(Y=V.alternate,Y!==null?(Y=Y.index,Y<G?(V.flags|=67108866,G):Y):(V.flags|=67108866,G)):(V.flags|=1048576,G)}function b(V){return a&&V.alternate===null&&(V.flags|=67108866),V}function M(V,G,Y,te){return G===null||G.tag!==6?(G=$c(Y,V.mode,te),G.return=V,G):(G=g(G,Y),G.return=V,G)}function $(V,G,Y,te){var _e=Y.type;return _e===N?Z(V,G,Y.props.children,te,Y.key):G!==null&&(G.elementType===_e||typeof _e=="object"&&_e!==null&&_e.$$typeof===P&&ba(_e)===G.type)?(G=g(G,Y.props),bi(G,Y),G.return=V,G):(G=nl(Y.type,Y.key,Y.props,null,V.mode,te),bi(G,Y),G.return=V,G)}function J(V,G,Y,te){return G===null||G.tag!==4||G.stateNode.containerInfo!==Y.containerInfo||G.stateNode.implementation!==Y.implementation?(G=Hc(Y,V.mode,te),G.return=V,G):(G=g(G,Y.children||[]),G.return=V,G)}function Z(V,G,Y,te,_e){return G===null||G.tag!==7?(G=va(Y,V.mode,te,_e),G.return=V,G):(G=g(G,Y),G.return=V,G)}function ne(V,G,Y){if(typeof G=="string"&&G!==""||typeof G=="number"||typeof G=="bigint")return G=$c(""+G,V.mode,Y),G.return=V,G;if(typeof G=="object"&&G!==null){switch(G.$$typeof){case T:return Y=nl(G.type,G.key,G.props,null,V.mode,Y),bi(Y,G),Y.return=V,Y;case C:return G=Hc(G,V.mode,Y),G.return=V,G;case P:return G=ba(G),ne(V,G,Y)}if(se(G)||U(G))return G=va(G,V.mode,Y,null),G.return=V,G;if(typeof G.then=="function")return ne(V,ul(G),Y);if(G.$$typeof===O)return ne(V,rl(V,G),Y);cl(V,G)}return null}function K(V,G,Y,te){var _e=G!==null?G.key:null;if(typeof Y=="string"&&Y!==""||typeof Y=="number"||typeof Y=="bigint")return _e!==null?null:M(V,G,""+Y,te);if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case T:return Y.key===_e?$(V,G,Y,te):null;case C:return Y.key===_e?J(V,G,Y,te):null;case P:return Y=ba(Y),K(V,G,Y,te)}if(se(Y)||U(Y))return _e!==null?null:Z(V,G,Y,te,null);if(typeof Y.then=="function")return K(V,G,ul(Y),te);if(Y.$$typeof===O)return K(V,G,rl(V,Y),te);cl(V,Y)}return null}function Q(V,G,Y,te,_e){if(typeof te=="string"&&te!==""||typeof te=="number"||typeof te=="bigint")return V=V.get(Y)||null,M(G,V,""+te,_e);if(typeof te=="object"&&te!==null){switch(te.$$typeof){case T:return V=V.get(te.key===null?Y:te.key)||null,$(G,V,te,_e);case C:return V=V.get(te.key===null?Y:te.key)||null,J(G,V,te,_e);case P:return te=ba(te),Q(V,G,Y,te,_e)}if(se(te)||U(te))return V=V.get(Y)||null,Z(G,V,te,_e,null);if(typeof te.then=="function")return Q(V,G,Y,ul(te),_e);if(te.$$typeof===O)return Q(V,G,Y,rl(G,te),_e);cl(G,te)}return null}function fe(V,G,Y,te){for(var _e=null,$e=null,pe=G,Pe=G=0,Oe=null;pe!==null&&Pe<Y.length;Pe++){pe.index>Pe?(Oe=pe,pe=null):Oe=pe.sibling;var He=K(V,pe,Y[Pe],te);if(He===null){pe===null&&(pe=Oe);break}a&&pe&&He.alternate===null&&r(V,pe),G=v(He,G,Pe),$e===null?_e=He:$e.sibling=He,$e=He,pe=Oe}if(Pe===Y.length)return l(V,pe),qe&&ns(V,Pe),_e;if(pe===null){for(;Pe<Y.length;Pe++)pe=ne(V,Y[Pe],te),pe!==null&&(G=v(pe,G,Pe),$e===null?_e=pe:$e.sibling=pe,$e=pe);return qe&&ns(V,Pe),_e}for(pe=c(pe);Pe<Y.length;Pe++)Oe=Q(pe,V,Pe,Y[Pe],te),Oe!==null&&(a&&Oe.alternate!==null&&pe.delete(Oe.key===null?Pe:Oe.key),G=v(Oe,G,Pe),$e===null?_e=Oe:$e.sibling=Oe,$e=Oe);return a&&pe.forEach(function(Zs){return r(V,Zs)}),qe&&ns(V,Pe),_e}function xe(V,G,Y,te){if(Y==null)throw Error(s(151));for(var _e=null,$e=null,pe=G,Pe=G=0,Oe=null,He=Y.next();pe!==null&&!He.done;Pe++,He=Y.next()){pe.index>Pe?(Oe=pe,pe=null):Oe=pe.sibling;var Zs=K(V,pe,He.value,te);if(Zs===null){pe===null&&(pe=Oe);break}a&&pe&&Zs.alternate===null&&r(V,pe),G=v(Zs,G,Pe),$e===null?_e=Zs:$e.sibling=Zs,$e=Zs,pe=Oe}if(He.done)return l(V,pe),qe&&ns(V,Pe),_e;if(pe===null){for(;!He.done;Pe++,He=Y.next())He=ne(V,He.value,te),He!==null&&(G=v(He,G,Pe),$e===null?_e=He:$e.sibling=He,$e=He);return qe&&ns(V,Pe),_e}for(pe=c(pe);!He.done;Pe++,He=Y.next())He=Q(pe,V,Pe,He.value,te),He!==null&&(a&&He.alternate!==null&&pe.delete(He.key===null?Pe:He.key),G=v(He,G,Pe),$e===null?_e=He:$e.sibling=He,$e=He);return a&&pe.forEach(function(aE){return r(V,aE)}),qe&&ns(V,Pe),_e}function We(V,G,Y,te){if(typeof Y=="object"&&Y!==null&&Y.type===N&&Y.key===null&&(Y=Y.props.children),typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case T:e:{for(var _e=Y.key;G!==null;){if(G.key===_e){if(_e=Y.type,_e===N){if(G.tag===7){l(V,G.sibling),te=g(G,Y.props.children),te.return=V,V=te;break e}}else if(G.elementType===_e||typeof _e=="object"&&_e!==null&&_e.$$typeof===P&&ba(_e)===G.type){l(V,G.sibling),te=g(G,Y.props),bi(te,Y),te.return=V,V=te;break e}l(V,G);break}else r(V,G);G=G.sibling}Y.type===N?(te=va(Y.props.children,V.mode,te,Y.key),te.return=V,V=te):(te=nl(Y.type,Y.key,Y.props,null,V.mode,te),bi(te,Y),te.return=V,V=te)}return b(V);case C:e:{for(_e=Y.key;G!==null;){if(G.key===_e)if(G.tag===4&&G.stateNode.containerInfo===Y.containerInfo&&G.stateNode.implementation===Y.implementation){l(V,G.sibling),te=g(G,Y.children||[]),te.return=V,V=te;break e}else{l(V,G);break}else r(V,G);G=G.sibling}te=Hc(Y,V.mode,te),te.return=V,V=te}return b(V);case P:return Y=ba(Y),We(V,G,Y,te)}if(se(Y))return fe(V,G,Y,te);if(U(Y)){if(_e=U(Y),typeof _e!="function")throw Error(s(150));return Y=_e.call(Y),xe(V,G,Y,te)}if(typeof Y.then=="function")return We(V,G,ul(Y),te);if(Y.$$typeof===O)return We(V,G,rl(V,Y),te);cl(V,Y)}return typeof Y=="string"&&Y!==""||typeof Y=="number"||typeof Y=="bigint"?(Y=""+Y,G!==null&&G.tag===6?(l(V,G.sibling),te=g(G,Y),te.return=V,V=te):(l(V,G),te=$c(Y,V.mode,te),te.return=V,V=te),b(V)):l(V,G)}return function(V,G,Y,te){try{xi=0;var _e=We(V,G,Y,te);return pr=null,_e}catch(pe){if(pe===fr||pe===ol)throw pe;var $e=sn(29,pe,null,V.mode);return $e.lanes=te,$e.return=V,$e}finally{}}}var Ca=hg(!0),gg=hg(!1),Us=!1;function ed(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function td(a,r){a=a.updateQueue,r.updateQueue===a&&(r.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function Os(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function qs(a,r,l){var c=a.updateQueue;if(c===null)return null;if(c=c.shared,(Ve&2)!==0){var g=c.pending;return g===null?r.next=r:(r.next=g.next,g.next=r),c.pending=r,r=tl(a),Zh(a,null,l),r}return el(a,c,r,l),tl(a)}function Ti(a,r,l){if(r=r.updateQueue,r!==null&&(r=r.shared,(l&4194048)!==0)){var c=r.lanes;c&=a.pendingLanes,l|=c,r.lanes=l,Fo(a,l)}}function nd(a,r){var l=a.updateQueue,c=a.alternate;if(c!==null&&(c=c.updateQueue,l===c)){var g=null,v=null;if(l=l.firstBaseUpdate,l!==null){do{var b={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};v===null?g=v=b:v=v.next=b,l=l.next}while(l!==null);v===null?g=v=r:v=v.next=r}else g=v=r;l={baseState:c.baseState,firstBaseUpdate:g,lastBaseUpdate:v,shared:c.shared,callbacks:c.callbacks},a.updateQueue=l;return}a=l.lastBaseUpdate,a===null?l.firstBaseUpdate=r:a.next=r,l.lastBaseUpdate=r}var sd=!1;function Ci(){if(sd){var a=dr;if(a!==null)throw a}}function Ai(a,r,l,c){sd=!1;var g=a.updateQueue;Us=!1;var v=g.firstBaseUpdate,b=g.lastBaseUpdate,M=g.shared.pending;if(M!==null){g.shared.pending=null;var $=M,J=$.next;$.next=null,b===null?v=J:b.next=J,b=$;var Z=a.alternate;Z!==null&&(Z=Z.updateQueue,M=Z.lastBaseUpdate,M!==b&&(M===null?Z.firstBaseUpdate=J:M.next=J,Z.lastBaseUpdate=$))}if(v!==null){var ne=g.baseState;b=0,Z=J=$=null,M=v;do{var K=M.lane&-536870913,Q=K!==M.lane;if(Q?(Ue&K)===K:(c&K)===K){K!==0&&K===cr&&(sd=!0),Z!==null&&(Z=Z.next={lane:0,tag:M.tag,payload:M.payload,callback:null,next:null});e:{var fe=a,xe=M;K=r;var We=l;switch(xe.tag){case 1:if(fe=xe.payload,typeof fe=="function"){ne=fe.call(We,ne,K);break e}ne=fe;break e;case 3:fe.flags=fe.flags&-65537|128;case 0:if(fe=xe.payload,K=typeof fe=="function"?fe.call(We,ne,K):fe,K==null)break e;ne=S({},ne,K);break e;case 2:Us=!0}}K=M.callback,K!==null&&(a.flags|=64,Q&&(a.flags|=8192),Q=g.callbacks,Q===null?g.callbacks=[K]:Q.push(K))}else Q={lane:K,tag:M.tag,payload:M.payload,callback:M.callback,next:null},Z===null?(J=Z=Q,$=ne):Z=Z.next=Q,b|=K;if(M=M.next,M===null){if(M=g.shared.pending,M===null)break;Q=M,M=Q.next,Q.next=null,g.lastBaseUpdate=Q,g.shared.pending=null}}while(!0);Z===null&&($=ne),g.baseState=$,g.firstBaseUpdate=J,g.lastBaseUpdate=Z,v===null&&(g.shared.lanes=0),Gs|=b,a.lanes=b,a.memoizedState=ne}}function yg(a,r){if(typeof a!="function")throw Error(s(191,a));a.call(r)}function vg(a,r){var l=a.callbacks;if(l!==null)for(a.callbacks=null,a=0;a<l.length;a++)yg(l[a],r)}var mr=H(null),dl=H(0);function Sg(a,r){a=ps,W(dl,a),W(mr,r),ps=a|r.baseLanes}function ad(){W(dl,ps),W(mr,mr.current)}function rd(){ps=dl.current,ee(mr),ee(dl)}var an=H(null),xn=null;function Bs(a){var r=a.alternate;W(ct,ct.current&1),W(an,a),xn===null&&(r===null||mr.current!==null||r.memoizedState!==null)&&(xn=a)}function id(a){W(ct,ct.current),W(an,a),xn===null&&(xn=a)}function wg(a){a.tag===22?(W(ct,ct.current),W(an,a),xn===null&&(xn=a)):Fs()}function Fs(){W(ct,ct.current),W(an,an.current)}function rn(a){ee(an),xn===a&&(xn=null),ee(ct)}var ct=H(0);function fl(a){for(var r=a;r!==null;){if(r.tag===13){var l=r.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||pf(l)||mf(l)))return r}else if(r.tag===19&&(r.memoizedProps.revealOrder==="forwards"||r.memoizedProps.revealOrder==="backwards"||r.memoizedProps.revealOrder==="unstable_legacy-backwards"||r.memoizedProps.revealOrder==="together")){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===a)break;for(;r.sibling===null;){if(r.return===null||r.return===a)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var rs=0,Me=null,Xe=null,gt=null,pl=!1,hr=!1,Aa=!1,ml=0,Ei=0,gr=null,JC=0;function lt(){throw Error(s(321))}function od(a,r){if(r===null)return!1;for(var l=0;l<r.length&&l<a.length;l++)if(!nn(a[l],r[l]))return!1;return!0}function ld(a,r,l,c,g,v){return rs=v,Me=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,q.H=a===null||a.memoizedState===null?sy:bd,Aa=!1,v=l(c,g),Aa=!1,hr&&(v=xg(r,l,c,g)),_g(a),v}function _g(a){q.H=Ri;var r=Xe!==null&&Xe.next!==null;if(rs=0,gt=Xe=Me=null,pl=!1,Ei=0,gr=null,r)throw Error(s(300));a===null||yt||(a=a.dependencies,a!==null&&al(a)&&(yt=!0))}function xg(a,r,l,c){Me=a;var g=0;do{if(hr&&(gr=null),Ei=0,hr=!1,25<=g)throw Error(s(301));if(g+=1,gt=Xe=null,a.updateQueue!=null){var v=a.updateQueue;v.lastEffect=null,v.events=null,v.stores=null,v.memoCache!=null&&(v.memoCache.index=0)}q.H=ay,v=r(l,c)}while(hr);return v}function KC(){var a=q.H,r=a.useState()[0];return r=typeof r.then=="function"?Ni(r):r,a=a.useState()[0],(Xe!==null?Xe.memoizedState:null)!==a&&(Me.flags|=1024),r}function ud(){var a=ml!==0;return ml=0,a}function cd(a,r,l){r.updateQueue=a.updateQueue,r.flags&=-2053,a.lanes&=~l}function dd(a){if(pl){for(a=a.memoizedState;a!==null;){var r=a.queue;r!==null&&(r.pending=null),a=a.next}pl=!1}rs=0,gt=Xe=Me=null,hr=!1,Ei=ml=0,gr=null}function Ht(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return gt===null?Me.memoizedState=gt=a:gt=gt.next=a,gt}function dt(){if(Xe===null){var a=Me.alternate;a=a!==null?a.memoizedState:null}else a=Xe.next;var r=gt===null?Me.memoizedState:gt.next;if(r!==null)gt=r,Xe=a;else{if(a===null)throw Me.alternate===null?Error(s(467)):Error(s(310));Xe=a,a={memoizedState:Xe.memoizedState,baseState:Xe.baseState,baseQueue:Xe.baseQueue,queue:Xe.queue,next:null},gt===null?Me.memoizedState=gt=a:gt=gt.next=a}return gt}function hl(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ni(a){var r=Ei;return Ei+=1,gr===null&&(gr=[]),a=fg(gr,a,r),r=Me,(gt===null?r.memoizedState:gt.next)===null&&(r=r.alternate,q.H=r===null||r.memoizedState===null?sy:bd),a}function gl(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return Ni(a);if(a.$$typeof===O)return Mt(a)}throw Error(s(438,String(a)))}function fd(a){var r=null,l=Me.updateQueue;if(l!==null&&(r=l.memoCache),r==null){var c=Me.alternate;c!==null&&(c=c.updateQueue,c!==null&&(c=c.memoCache,c!=null&&(r={data:c.data.map(function(g){return g.slice()}),index:0})))}if(r==null&&(r={data:[],index:0}),l===null&&(l=hl(),Me.updateQueue=l),l.memoCache=r,l=r.data[r.index],l===void 0)for(l=r.data[r.index]=Array(a),c=0;c<a;c++)l[c]=k;return r.index++,l}function is(a,r){return typeof r=="function"?r(a):r}function yl(a){var r=dt();return pd(r,Xe,a)}function pd(a,r,l){var c=a.queue;if(c===null)throw Error(s(311));c.lastRenderedReducer=l;var g=a.baseQueue,v=c.pending;if(v!==null){if(g!==null){var b=g.next;g.next=v.next,v.next=b}r.baseQueue=g=v,c.pending=null}if(v=a.baseState,g===null)a.memoizedState=v;else{r=g.next;var M=b=null,$=null,J=r,Z=!1;do{var ne=J.lane&-536870913;if(ne!==J.lane?(Ue&ne)===ne:(rs&ne)===ne){var K=J.revertLane;if(K===0)$!==null&&($=$.next={lane:0,revertLane:0,gesture:null,action:J.action,hasEagerState:J.hasEagerState,eagerState:J.eagerState,next:null}),ne===cr&&(Z=!0);else if((rs&K)===K){J=J.next,K===cr&&(Z=!0);continue}else ne={lane:0,revertLane:J.revertLane,gesture:null,action:J.action,hasEagerState:J.hasEagerState,eagerState:J.eagerState,next:null},$===null?(M=$=ne,b=v):$=$.next=ne,Me.lanes|=K,Gs|=K;ne=J.action,Aa&&l(v,ne),v=J.hasEagerState?J.eagerState:l(v,ne)}else K={lane:ne,revertLane:J.revertLane,gesture:J.gesture,action:J.action,hasEagerState:J.hasEagerState,eagerState:J.eagerState,next:null},$===null?(M=$=K,b=v):$=$.next=K,Me.lanes|=ne,Gs|=ne;J=J.next}while(J!==null&&J!==r);if($===null?b=v:$.next=M,!nn(v,a.memoizedState)&&(yt=!0,Z&&(l=dr,l!==null)))throw l;a.memoizedState=v,a.baseState=b,a.baseQueue=$,c.lastRenderedState=v}return g===null&&(c.lanes=0),[a.memoizedState,c.dispatch]}function md(a){var r=dt(),l=r.queue;if(l===null)throw Error(s(311));l.lastRenderedReducer=a;var c=l.dispatch,g=l.pending,v=r.memoizedState;if(g!==null){l.pending=null;var b=g=g.next;do v=a(v,b.action),b=b.next;while(b!==g);nn(v,r.memoizedState)||(yt=!0),r.memoizedState=v,r.baseQueue===null&&(r.baseState=v),l.lastRenderedState=v}return[v,c]}function bg(a,r,l){var c=Me,g=dt(),v=qe;if(v){if(l===void 0)throw Error(s(407));l=l()}else l=r();var b=!nn((Xe||g).memoizedState,l);if(b&&(g.memoizedState=l,yt=!0),g=g.queue,yd(Ag.bind(null,c,g,a),[a]),g.getSnapshot!==r||b||gt!==null&&gt.memoizedState.tag&1){if(c.flags|=2048,yr(9,{destroy:void 0},Cg.bind(null,c,g,l,r),null),tt===null)throw Error(s(349));v||(rs&127)!==0||Tg(c,r,l)}return l}function Tg(a,r,l){a.flags|=16384,a={getSnapshot:r,value:l},r=Me.updateQueue,r===null?(r=hl(),Me.updateQueue=r,r.stores=[a]):(l=r.stores,l===null?r.stores=[a]:l.push(a))}function Cg(a,r,l,c){r.value=l,r.getSnapshot=c,Eg(r)&&Ng(a)}function Ag(a,r,l){return l(function(){Eg(r)&&Ng(a)})}function Eg(a){var r=a.getSnapshot;a=a.value;try{var l=r();return!nn(a,l)}catch{return!0}}function Ng(a){var r=ya(a,2);r!==null&&Xt(r,a,2)}function hd(a){var r=Ht();if(typeof a=="function"){var l=a;if(a=l(),Aa){ce(!0);try{l()}finally{ce(!1)}}}return r.memoizedState=r.baseState=a,r.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:is,lastRenderedState:a},r}function Ig(a,r,l,c){return a.baseState=l,pd(a,Xe,typeof c=="function"?c:is)}function XC(a,r,l,c,g){if(wl(a))throw Error(s(485));if(a=r.action,a!==null){var v={payload:g,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(b){v.listeners.push(b)}};q.T!==null?l(!0):v.isTransition=!1,c(v),l=r.pending,l===null?(v.next=r.pending=v,Rg(r,v)):(v.next=l.next,r.pending=l.next=v)}}function Rg(a,r){var l=r.action,c=r.payload,g=a.state;if(r.isTransition){var v=q.T,b={};q.T=b;try{var M=l(g,c),$=q.S;$!==null&&$(b,M),Mg(a,r,M)}catch(J){gd(a,r,J)}finally{v!==null&&b.types!==null&&(v.types=b.types),q.T=v}}else try{v=l(g,c),Mg(a,r,v)}catch(J){gd(a,r,J)}}function Mg(a,r,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(c){Pg(a,r,c)},function(c){return gd(a,r,c)}):Pg(a,r,l)}function Pg(a,r,l){r.status="fulfilled",r.value=l,Dg(r),a.state=l,r=a.pending,r!==null&&(l=r.next,l===r?a.pending=null:(l=l.next,r.next=l,Rg(a,l)))}function gd(a,r,l){var c=a.pending;if(a.pending=null,c!==null){c=c.next;do r.status="rejected",r.reason=l,Dg(r),r=r.next;while(r!==c)}a.action=null}function Dg(a){a=a.listeners;for(var r=0;r<a.length;r++)(0,a[r])()}function Lg(a,r){return r}function kg(a,r){if(qe){var l=tt.formState;if(l!==null){e:{var c=Me;if(qe){if(nt){t:{for(var g=nt,v=_n;g.nodeType!==8;){if(!v){g=null;break t}if(g=bn(g.nextSibling),g===null){g=null;break t}}v=g.data,g=v==="F!"||v==="F"?g:null}if(g){nt=bn(g.nextSibling),c=g.data==="F!";break e}}Ls(c)}c=!1}c&&(r=l[0])}}return l=Ht(),l.memoizedState=l.baseState=r,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Lg,lastRenderedState:r},l.queue=c,l=ey.bind(null,Me,c),c.dispatch=l,c=hd(!1),v=xd.bind(null,Me,!1,c.queue),c=Ht(),g={state:r,dispatch:null,action:a,pending:null},c.queue=g,l=XC.bind(null,Me,g,v,l),g.dispatch=l,c.memoizedState=a,[r,l,!1]}function Ug(a){var r=dt();return Og(r,Xe,a)}function Og(a,r,l){if(r=pd(a,r,Lg)[0],a=yl(is)[0],typeof r=="object"&&r!==null&&typeof r.then=="function")try{var c=Ni(r)}catch(b){throw b===fr?ol:b}else c=r;r=dt();var g=r.queue,v=g.dispatch;return l!==r.memoizedState&&(Me.flags|=2048,yr(9,{destroy:void 0},QC.bind(null,g,l),null)),[c,v,a]}function QC(a,r){a.action=r}function qg(a){var r=dt(),l=Xe;if(l!==null)return Og(r,l,a);dt(),r=r.memoizedState,l=dt();var c=l.queue.dispatch;return l.memoizedState=a,[r,c,!1]}function yr(a,r,l,c){return a={tag:a,create:l,deps:c,inst:r,next:null},r=Me.updateQueue,r===null&&(r=hl(),Me.updateQueue=r),l=r.lastEffect,l===null?r.lastEffect=a.next=a:(c=l.next,l.next=a,a.next=c,r.lastEffect=a),a}function Bg(){return dt().memoizedState}function vl(a,r,l,c){var g=Ht();Me.flags|=a,g.memoizedState=yr(1|r,{destroy:void 0},l,c===void 0?null:c)}function Sl(a,r,l,c){var g=dt();c=c===void 0?null:c;var v=g.memoizedState.inst;Xe!==null&&c!==null&&od(c,Xe.memoizedState.deps)?g.memoizedState=yr(r,v,l,c):(Me.flags|=a,g.memoizedState=yr(1|r,v,l,c))}function Fg(a,r){vl(8390656,8,a,r)}function yd(a,r){Sl(2048,8,a,r)}function WC(a){Me.flags|=4;var r=Me.updateQueue;if(r===null)r=hl(),Me.updateQueue=r,r.events=[a];else{var l=r.events;l===null?r.events=[a]:l.push(a)}}function $g(a){var r=dt().memoizedState;return WC({ref:r,nextImpl:a}),function(){if((Ve&2)!==0)throw Error(s(440));return r.impl.apply(void 0,arguments)}}function Hg(a,r){return Sl(4,2,a,r)}function Gg(a,r){return Sl(4,4,a,r)}function Vg(a,r){if(typeof r=="function"){a=a();var l=r(a);return function(){typeof l=="function"?l():r(null)}}if(r!=null)return a=a(),r.current=a,function(){r.current=null}}function zg(a,r,l){l=l!=null?l.concat([a]):null,Sl(4,4,Vg.bind(null,r,a),l)}function vd(){}function jg(a,r){var l=dt();r=r===void 0?null:r;var c=l.memoizedState;return r!==null&&od(r,c[1])?c[0]:(l.memoizedState=[a,r],a)}function Yg(a,r){var l=dt();r=r===void 0?null:r;var c=l.memoizedState;if(r!==null&&od(r,c[1]))return c[0];if(c=a(),Aa){ce(!0);try{a()}finally{ce(!1)}}return l.memoizedState=[c,r],c}function Sd(a,r,l){return l===void 0||(rs&1073741824)!==0&&(Ue&261930)===0?a.memoizedState=r:(a.memoizedState=l,a=Jy(),Me.lanes|=a,Gs|=a,l)}function Jg(a,r,l,c){return nn(l,r)?l:mr.current!==null?(a=Sd(a,l,c),nn(a,r)||(yt=!0),a):(rs&42)===0||(rs&1073741824)!==0&&(Ue&261930)===0?(yt=!0,a.memoizedState=l):(a=Jy(),Me.lanes|=a,Gs|=a,r)}function Kg(a,r,l,c,g){var v=j.p;j.p=v!==0&&8>v?v:8;var b=q.T,M={};q.T=M,xd(a,!1,r,l);try{var $=g(),J=q.S;if(J!==null&&J(M,$),$!==null&&typeof $=="object"&&typeof $.then=="function"){var Z=YC($,c);Ii(a,r,Z,un(a))}else Ii(a,r,c,un(a))}catch(ne){Ii(a,r,{then:function(){},status:"rejected",reason:ne},un())}finally{j.p=v,b!==null&&M.types!==null&&(b.types=M.types),q.T=b}}function ZC(){}function wd(a,r,l,c){if(a.tag!==5)throw Error(s(476));var g=Xg(a).queue;Kg(a,g,r,ae,l===null?ZC:function(){return Qg(a),l(c)})}function Xg(a){var r=a.memoizedState;if(r!==null)return r;r={memoizedState:ae,baseState:ae,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:is,lastRenderedState:ae},next:null};var l={};return r.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:is,lastRenderedState:l},next:null},a.memoizedState=r,a=a.alternate,a!==null&&(a.memoizedState=r),r}function Qg(a){var r=Xg(a);r.next===null&&(r=a.alternate.memoizedState),Ii(a,r.next.queue,{},un())}function _d(){return Mt(ji)}function Wg(){return dt().memoizedState}function Zg(){return dt().memoizedState}function eA(a){for(var r=a.return;r!==null;){switch(r.tag){case 24:case 3:var l=un();a=Os(l);var c=qs(r,a,l);c!==null&&(Xt(c,r,l),Ti(c,r,l)),r={cache:Xc()},a.payload=r;return}r=r.return}}function tA(a,r,l){var c=un();l={lane:c,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null},wl(a)?ty(r,l):(l=Bc(a,r,l,c),l!==null&&(Xt(l,a,c),ny(l,r,c)))}function ey(a,r,l){var c=un();Ii(a,r,l,c)}function Ii(a,r,l,c){var g={lane:c,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null};if(wl(a))ty(r,g);else{var v=a.alternate;if(a.lanes===0&&(v===null||v.lanes===0)&&(v=r.lastRenderedReducer,v!==null))try{var b=r.lastRenderedState,M=v(b,l);if(g.hasEagerState=!0,g.eagerState=M,nn(M,b))return el(a,r,g,0),tt===null&&Zo(),!1}catch{}finally{}if(l=Bc(a,r,g,c),l!==null)return Xt(l,a,c),ny(l,r,c),!0}return!1}function xd(a,r,l,c){if(c={lane:2,revertLane:ef(),gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},wl(a)){if(r)throw Error(s(479))}else r=Bc(a,l,c,2),r!==null&&Xt(r,a,2)}function wl(a){var r=a.alternate;return a===Me||r!==null&&r===Me}function ty(a,r){hr=pl=!0;var l=a.pending;l===null?r.next=r:(r.next=l.next,l.next=r),a.pending=r}function ny(a,r,l){if((l&4194048)!==0){var c=r.lanes;c&=a.pendingLanes,l|=c,r.lanes=l,Fo(a,l)}}var Ri={readContext:Mt,use:gl,useCallback:lt,useContext:lt,useEffect:lt,useImperativeHandle:lt,useLayoutEffect:lt,useInsertionEffect:lt,useMemo:lt,useReducer:lt,useRef:lt,useState:lt,useDebugValue:lt,useDeferredValue:lt,useTransition:lt,useSyncExternalStore:lt,useId:lt,useHostTransitionStatus:lt,useFormState:lt,useActionState:lt,useOptimistic:lt,useMemoCache:lt,useCacheRefresh:lt};Ri.useEffectEvent=lt;var sy={readContext:Mt,use:gl,useCallback:function(a,r){return Ht().memoizedState=[a,r===void 0?null:r],a},useContext:Mt,useEffect:Fg,useImperativeHandle:function(a,r,l){l=l!=null?l.concat([a]):null,vl(4194308,4,Vg.bind(null,r,a),l)},useLayoutEffect:function(a,r){return vl(4194308,4,a,r)},useInsertionEffect:function(a,r){vl(4,2,a,r)},useMemo:function(a,r){var l=Ht();r=r===void 0?null:r;var c=a();if(Aa){ce(!0);try{a()}finally{ce(!1)}}return l.memoizedState=[c,r],c},useReducer:function(a,r,l){var c=Ht();if(l!==void 0){var g=l(r);if(Aa){ce(!0);try{l(r)}finally{ce(!1)}}}else g=r;return c.memoizedState=c.baseState=g,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:g},c.queue=a,a=a.dispatch=tA.bind(null,Me,a),[c.memoizedState,a]},useRef:function(a){var r=Ht();return a={current:a},r.memoizedState=a},useState:function(a){a=hd(a);var r=a.queue,l=ey.bind(null,Me,r);return r.dispatch=l,[a.memoizedState,l]},useDebugValue:vd,useDeferredValue:function(a,r){var l=Ht();return Sd(l,a,r)},useTransition:function(){var a=hd(!1);return a=Kg.bind(null,Me,a.queue,!0,!1),Ht().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,r,l){var c=Me,g=Ht();if(qe){if(l===void 0)throw Error(s(407));l=l()}else{if(l=r(),tt===null)throw Error(s(349));(Ue&127)!==0||Tg(c,r,l)}g.memoizedState=l;var v={value:l,getSnapshot:r};return g.queue=v,Fg(Ag.bind(null,c,v,a),[a]),c.flags|=2048,yr(9,{destroy:void 0},Cg.bind(null,c,v,l,r),null),l},useId:function(){var a=Ht(),r=tt.identifierPrefix;if(qe){var l=Bn,c=qn;l=(c&~(1<<32-we(c)-1)).toString(32)+l,r="_"+r+"R_"+l,l=ml++,0<l&&(r+="H"+l.toString(32)),r+="_"}else l=JC++,r="_"+r+"r_"+l.toString(32)+"_";return a.memoizedState=r},useHostTransitionStatus:_d,useFormState:kg,useActionState:kg,useOptimistic:function(a){var r=Ht();r.memoizedState=r.baseState=a;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return r.queue=l,r=xd.bind(null,Me,!0,l),l.dispatch=r,[a,r]},useMemoCache:fd,useCacheRefresh:function(){return Ht().memoizedState=eA.bind(null,Me)},useEffectEvent:function(a){var r=Ht(),l={impl:a};return r.memoizedState=l,function(){if((Ve&2)!==0)throw Error(s(440));return l.impl.apply(void 0,arguments)}}},bd={readContext:Mt,use:gl,useCallback:jg,useContext:Mt,useEffect:yd,useImperativeHandle:zg,useInsertionEffect:Hg,useLayoutEffect:Gg,useMemo:Yg,useReducer:yl,useRef:Bg,useState:function(){return yl(is)},useDebugValue:vd,useDeferredValue:function(a,r){var l=dt();return Jg(l,Xe.memoizedState,a,r)},useTransition:function(){var a=yl(is)[0],r=dt().memoizedState;return[typeof a=="boolean"?a:Ni(a),r]},useSyncExternalStore:bg,useId:Wg,useHostTransitionStatus:_d,useFormState:Ug,useActionState:Ug,useOptimistic:function(a,r){var l=dt();return Ig(l,Xe,a,r)},useMemoCache:fd,useCacheRefresh:Zg};bd.useEffectEvent=$g;var ay={readContext:Mt,use:gl,useCallback:jg,useContext:Mt,useEffect:yd,useImperativeHandle:zg,useInsertionEffect:Hg,useLayoutEffect:Gg,useMemo:Yg,useReducer:md,useRef:Bg,useState:function(){return md(is)},useDebugValue:vd,useDeferredValue:function(a,r){var l=dt();return Xe===null?Sd(l,a,r):Jg(l,Xe.memoizedState,a,r)},useTransition:function(){var a=md(is)[0],r=dt().memoizedState;return[typeof a=="boolean"?a:Ni(a),r]},useSyncExternalStore:bg,useId:Wg,useHostTransitionStatus:_d,useFormState:qg,useActionState:qg,useOptimistic:function(a,r){var l=dt();return Xe!==null?Ig(l,Xe,a,r):(l.baseState=a,[a,l.queue.dispatch])},useMemoCache:fd,useCacheRefresh:Zg};ay.useEffectEvent=$g;function Td(a,r,l,c){r=a.memoizedState,l=l(c,r),l=l==null?r:S({},r,l),a.memoizedState=l,a.lanes===0&&(a.updateQueue.baseState=l)}var Cd={enqueueSetState:function(a,r,l){a=a._reactInternals;var c=un(),g=Os(c);g.payload=r,l!=null&&(g.callback=l),r=qs(a,g,c),r!==null&&(Xt(r,a,c),Ti(r,a,c))},enqueueReplaceState:function(a,r,l){a=a._reactInternals;var c=un(),g=Os(c);g.tag=1,g.payload=r,l!=null&&(g.callback=l),r=qs(a,g,c),r!==null&&(Xt(r,a,c),Ti(r,a,c))},enqueueForceUpdate:function(a,r){a=a._reactInternals;var l=un(),c=Os(l);c.tag=2,r!=null&&(c.callback=r),r=qs(a,c,l),r!==null&&(Xt(r,a,l),Ti(r,a,l))}};function ry(a,r,l,c,g,v,b){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(c,v,b):r.prototype&&r.prototype.isPureReactComponent?!gi(l,c)||!gi(g,v):!0}function iy(a,r,l,c){a=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(l,c),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(l,c),r.state!==a&&Cd.enqueueReplaceState(r,r.state,null)}function Ea(a,r){var l=r;if("ref"in r){l={};for(var c in r)c!=="ref"&&(l[c]=r[c])}if(a=a.defaultProps){l===r&&(l=S({},l));for(var g in a)l[g]===void 0&&(l[g]=a[g])}return l}function oy(a){Wo(a)}function ly(a){console.error(a)}function uy(a){Wo(a)}function _l(a,r){try{var l=a.onUncaughtError;l(r.value,{componentStack:r.stack})}catch(c){setTimeout(function(){throw c})}}function cy(a,r,l){try{var c=a.onCaughtError;c(l.value,{componentStack:l.stack,errorBoundary:r.tag===1?r.stateNode:null})}catch(g){setTimeout(function(){throw g})}}function Ad(a,r,l){return l=Os(l),l.tag=3,l.payload={element:null},l.callback=function(){_l(a,r)},l}function dy(a){return a=Os(a),a.tag=3,a}function fy(a,r,l,c){var g=l.type.getDerivedStateFromError;if(typeof g=="function"){var v=c.value;a.payload=function(){return g(v)},a.callback=function(){cy(r,l,c)}}var b=l.stateNode;b!==null&&typeof b.componentDidCatch=="function"&&(a.callback=function(){cy(r,l,c),typeof g!="function"&&(Vs===null?Vs=new Set([this]):Vs.add(this));var M=c.stack;this.componentDidCatch(c.value,{componentStack:M!==null?M:""})})}function nA(a,r,l,c,g){if(l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){if(r=l.alternate,r!==null&&ur(r,l,g,!0),l=an.current,l!==null){switch(l.tag){case 31:case 13:return xn===null?Dl():l.alternate===null&&ut===0&&(ut=3),l.flags&=-257,l.flags|=65536,l.lanes=g,c===ll?l.flags|=16384:(r=l.updateQueue,r===null?l.updateQueue=new Set([c]):r.add(c),Qd(a,c,g)),!1;case 22:return l.flags|=65536,c===ll?l.flags|=16384:(r=l.updateQueue,r===null?(r={transitions:null,markerInstances:null,retryQueue:new Set([c])},l.updateQueue=r):(l=r.retryQueue,l===null?r.retryQueue=new Set([c]):l.add(c)),Qd(a,c,g)),!1}throw Error(s(435,l.tag))}return Qd(a,c,g),Dl(),!1}if(qe)return r=an.current,r!==null?((r.flags&65536)===0&&(r.flags|=256),r.flags|=65536,r.lanes=g,c!==zc&&(a=Error(s(422),{cause:c}),Si(vn(a,l)))):(c!==zc&&(r=Error(s(423),{cause:c}),Si(vn(r,l))),a=a.current.alternate,a.flags|=65536,g&=-g,a.lanes|=g,c=vn(c,l),g=Ad(a.stateNode,c,g),nd(a,g),ut!==4&&(ut=2)),!1;var v=Error(s(520),{cause:c});if(v=vn(v,l),qi===null?qi=[v]:qi.push(v),ut!==4&&(ut=2),r===null)return!0;c=vn(c,l),l=r;do{switch(l.tag){case 3:return l.flags|=65536,a=g&-g,l.lanes|=a,a=Ad(l.stateNode,c,a),nd(l,a),!1;case 1:if(r=l.type,v=l.stateNode,(l.flags&128)===0&&(typeof r.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(Vs===null||!Vs.has(v))))return l.flags|=65536,g&=-g,l.lanes|=g,g=dy(g),fy(g,a,l,c),nd(l,g),!1}l=l.return}while(l!==null);return!1}var Ed=Error(s(461)),yt=!1;function Pt(a,r,l,c){r.child=a===null?gg(r,null,l,c):Ca(r,a.child,l,c)}function py(a,r,l,c,g){l=l.render;var v=r.ref;if("ref"in c){var b={};for(var M in c)M!=="ref"&&(b[M]=c[M])}else b=c;return _a(r),c=ld(a,r,l,b,v,g),M=ud(),a!==null&&!yt?(cd(a,r,g),os(a,r,g)):(qe&&M&&Gc(r),r.flags|=1,Pt(a,r,c,g),r.child)}function my(a,r,l,c,g){if(a===null){var v=l.type;return typeof v=="function"&&!Fc(v)&&v.defaultProps===void 0&&l.compare===null?(r.tag=15,r.type=v,hy(a,r,v,c,g)):(a=nl(l.type,null,c,r,r.mode,g),a.ref=r.ref,a.return=r,r.child=a)}if(v=a.child,!kd(a,g)){var b=v.memoizedProps;if(l=l.compare,l=l!==null?l:gi,l(b,c)&&a.ref===r.ref)return os(a,r,g)}return r.flags|=1,a=ts(v,c),a.ref=r.ref,a.return=r,r.child=a}function hy(a,r,l,c,g){if(a!==null){var v=a.memoizedProps;if(gi(v,c)&&a.ref===r.ref)if(yt=!1,r.pendingProps=c=v,kd(a,g))(a.flags&131072)!==0&&(yt=!0);else return r.lanes=a.lanes,os(a,r,g)}return Nd(a,r,l,c,g)}function gy(a,r,l,c){var g=c.children,v=a!==null?a.memoizedState:null;if(a===null&&r.stateNode===null&&(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),c.mode==="hidden"){if((r.flags&128)!==0){if(v=v!==null?v.baseLanes|l:l,a!==null){for(c=r.child=a.child,g=0;c!==null;)g=g|c.lanes|c.childLanes,c=c.sibling;c=g&~v}else c=0,r.child=null;return yy(a,r,v,l,c)}if((l&536870912)!==0)r.memoizedState={baseLanes:0,cachePool:null},a!==null&&il(r,v!==null?v.cachePool:null),v!==null?Sg(r,v):ad(),wg(r);else return c=r.lanes=536870912,yy(a,r,v!==null?v.baseLanes|l:l,l,c)}else v!==null?(il(r,v.cachePool),Sg(r,v),Fs(),r.memoizedState=null):(a!==null&&il(r,null),ad(),Fs());return Pt(a,r,g,l),r.child}function Mi(a,r){return a!==null&&a.tag===22||r.stateNode!==null||(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),r.sibling}function yy(a,r,l,c,g){var v=Wc();return v=v===null?null:{parent:ht._currentValue,pool:v},r.memoizedState={baseLanes:l,cachePool:v},a!==null&&il(r,null),ad(),wg(r),a!==null&&ur(a,r,c,!0),r.childLanes=g,null}function xl(a,r){return r=Tl({mode:r.mode,children:r.children},a.mode),r.ref=a.ref,a.child=r,r.return=a,r}function vy(a,r,l){return Ca(r,a.child,null,l),a=xl(r,r.pendingProps),a.flags|=2,rn(r),r.memoizedState=null,a}function sA(a,r,l){var c=r.pendingProps,g=(r.flags&128)!==0;if(r.flags&=-129,a===null){if(qe){if(c.mode==="hidden")return a=xl(r,c),r.lanes=536870912,Mi(null,a);if(id(r),(a=nt)?(a=R0(a,_n),a=a!==null&&a.data==="&"?a:null,a!==null&&(r.memoizedState={dehydrated:a,treeContext:Ps!==null?{id:qn,overflow:Bn}:null,retryLane:536870912,hydrationErrors:null},l=tg(a),l.return=r,r.child=l,Rt=r,nt=null)):a=null,a===null)throw Ls(r);return r.lanes=536870912,null}return xl(r,c)}var v=a.memoizedState;if(v!==null){var b=v.dehydrated;if(id(r),g)if(r.flags&256)r.flags&=-257,r=vy(a,r,l);else if(r.memoizedState!==null)r.child=a.child,r.flags|=128,r=null;else throw Error(s(558));else if(yt||ur(a,r,l,!1),g=(l&a.childLanes)!==0,yt||g){if(c=tt,c!==null&&(b=$o(c,l),b!==0&&b!==v.retryLane))throw v.retryLane=b,ya(a,b),Xt(c,a,b),Ed;Dl(),r=vy(a,r,l)}else a=v.treeContext,nt=bn(b.nextSibling),Rt=r,qe=!0,Ds=null,_n=!1,a!==null&&ag(r,a),r=xl(r,c),r.flags|=4096;return r}return a=ts(a.child,{mode:c.mode,children:c.children}),a.ref=r.ref,r.child=a,a.return=r,a}function bl(a,r){var l=r.ref;if(l===null)a!==null&&a.ref!==null&&(r.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(s(284));(a===null||a.ref!==l)&&(r.flags|=4194816)}}function Nd(a,r,l,c,g){return _a(r),l=ld(a,r,l,c,void 0,g),c=ud(),a!==null&&!yt?(cd(a,r,g),os(a,r,g)):(qe&&c&&Gc(r),r.flags|=1,Pt(a,r,l,g),r.child)}function Sy(a,r,l,c,g,v){return _a(r),r.updateQueue=null,l=xg(r,c,l,g),_g(a),c=ud(),a!==null&&!yt?(cd(a,r,v),os(a,r,v)):(qe&&c&&Gc(r),r.flags|=1,Pt(a,r,l,v),r.child)}function wy(a,r,l,c,g){if(_a(r),r.stateNode===null){var v=rr,b=l.contextType;typeof b=="object"&&b!==null&&(v=Mt(b)),v=new l(c,v),r.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,v.updater=Cd,r.stateNode=v,v._reactInternals=r,v=r.stateNode,v.props=c,v.state=r.memoizedState,v.refs={},ed(r),b=l.contextType,v.context=typeof b=="object"&&b!==null?Mt(b):rr,v.state=r.memoizedState,b=l.getDerivedStateFromProps,typeof b=="function"&&(Td(r,l,b,c),v.state=r.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof v.getSnapshotBeforeUpdate=="function"||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(b=v.state,typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount(),b!==v.state&&Cd.enqueueReplaceState(v,v.state,null),Ai(r,c,v,g),Ci(),v.state=r.memoizedState),typeof v.componentDidMount=="function"&&(r.flags|=4194308),c=!0}else if(a===null){v=r.stateNode;var M=r.memoizedProps,$=Ea(l,M);v.props=$;var J=v.context,Z=l.contextType;b=rr,typeof Z=="object"&&Z!==null&&(b=Mt(Z));var ne=l.getDerivedStateFromProps;Z=typeof ne=="function"||typeof v.getSnapshotBeforeUpdate=="function",M=r.pendingProps!==M,Z||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(M||J!==b)&&iy(r,v,c,b),Us=!1;var K=r.memoizedState;v.state=K,Ai(r,c,v,g),Ci(),J=r.memoizedState,M||K!==J||Us?(typeof ne=="function"&&(Td(r,l,ne,c),J=r.memoizedState),($=Us||ry(r,l,$,c,K,J,b))?(Z||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount()),typeof v.componentDidMount=="function"&&(r.flags|=4194308)):(typeof v.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=c,r.memoizedState=J),v.props=c,v.state=J,v.context=b,c=$):(typeof v.componentDidMount=="function"&&(r.flags|=4194308),c=!1)}else{v=r.stateNode,td(a,r),b=r.memoizedProps,Z=Ea(l,b),v.props=Z,ne=r.pendingProps,K=v.context,J=l.contextType,$=rr,typeof J=="object"&&J!==null&&($=Mt(J)),M=l.getDerivedStateFromProps,(J=typeof M=="function"||typeof v.getSnapshotBeforeUpdate=="function")||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(b!==ne||K!==$)&&iy(r,v,c,$),Us=!1,K=r.memoizedState,v.state=K,Ai(r,c,v,g),Ci();var Q=r.memoizedState;b!==ne||K!==Q||Us||a!==null&&a.dependencies!==null&&al(a.dependencies)?(typeof M=="function"&&(Td(r,l,M,c),Q=r.memoizedState),(Z=Us||ry(r,l,Z,c,K,Q,$)||a!==null&&a.dependencies!==null&&al(a.dependencies))?(J||typeof v.UNSAFE_componentWillUpdate!="function"&&typeof v.componentWillUpdate!="function"||(typeof v.componentWillUpdate=="function"&&v.componentWillUpdate(c,Q,$),typeof v.UNSAFE_componentWillUpdate=="function"&&v.UNSAFE_componentWillUpdate(c,Q,$)),typeof v.componentDidUpdate=="function"&&(r.flags|=4),typeof v.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof v.componentDidUpdate!="function"||b===a.memoizedProps&&K===a.memoizedState||(r.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||b===a.memoizedProps&&K===a.memoizedState||(r.flags|=1024),r.memoizedProps=c,r.memoizedState=Q),v.props=c,v.state=Q,v.context=$,c=Z):(typeof v.componentDidUpdate!="function"||b===a.memoizedProps&&K===a.memoizedState||(r.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||b===a.memoizedProps&&K===a.memoizedState||(r.flags|=1024),c=!1)}return v=c,bl(a,r),c=(r.flags&128)!==0,v||c?(v=r.stateNode,l=c&&typeof l.getDerivedStateFromError!="function"?null:v.render(),r.flags|=1,a!==null&&c?(r.child=Ca(r,a.child,null,g),r.child=Ca(r,null,l,g)):Pt(a,r,l,g),r.memoizedState=v.state,a=r.child):a=os(a,r,g),a}function _y(a,r,l,c){return Sa(),r.flags|=256,Pt(a,r,l,c),r.child}var Id={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Rd(a){return{baseLanes:a,cachePool:cg()}}function Md(a,r,l){return a=a!==null?a.childLanes&~l:0,r&&(a|=ln),a}function xy(a,r,l){var c=r.pendingProps,g=!1,v=(r.flags&128)!==0,b;if((b=v)||(b=a!==null&&a.memoizedState===null?!1:(ct.current&2)!==0),b&&(g=!0,r.flags&=-129),b=(r.flags&32)!==0,r.flags&=-33,a===null){if(qe){if(g?Bs(r):Fs(),(a=nt)?(a=R0(a,_n),a=a!==null&&a.data!=="&"?a:null,a!==null&&(r.memoizedState={dehydrated:a,treeContext:Ps!==null?{id:qn,overflow:Bn}:null,retryLane:536870912,hydrationErrors:null},l=tg(a),l.return=r,r.child=l,Rt=r,nt=null)):a=null,a===null)throw Ls(r);return mf(a)?r.lanes=32:r.lanes=536870912,null}var M=c.children;return c=c.fallback,g?(Fs(),g=r.mode,M=Tl({mode:"hidden",children:M},g),c=va(c,g,l,null),M.return=r,c.return=r,M.sibling=c,r.child=M,c=r.child,c.memoizedState=Rd(l),c.childLanes=Md(a,b,l),r.memoizedState=Id,Mi(null,c)):(Bs(r),Pd(r,M))}var $=a.memoizedState;if($!==null&&(M=$.dehydrated,M!==null)){if(v)r.flags&256?(Bs(r),r.flags&=-257,r=Dd(a,r,l)):r.memoizedState!==null?(Fs(),r.child=a.child,r.flags|=128,r=null):(Fs(),M=c.fallback,g=r.mode,c=Tl({mode:"visible",children:c.children},g),M=va(M,g,l,null),M.flags|=2,c.return=r,M.return=r,c.sibling=M,r.child=c,Ca(r,a.child,null,l),c=r.child,c.memoizedState=Rd(l),c.childLanes=Md(a,b,l),r.memoizedState=Id,r=Mi(null,c));else if(Bs(r),mf(M)){if(b=M.nextSibling&&M.nextSibling.dataset,b)var J=b.dgst;b=J,c=Error(s(419)),c.stack="",c.digest=b,Si({value:c,source:null,stack:null}),r=Dd(a,r,l)}else if(yt||ur(a,r,l,!1),b=(l&a.childLanes)!==0,yt||b){if(b=tt,b!==null&&(c=$o(b,l),c!==0&&c!==$.retryLane))throw $.retryLane=c,ya(a,c),Xt(b,a,c),Ed;pf(M)||Dl(),r=Dd(a,r,l)}else pf(M)?(r.flags|=192,r.child=a.child,r=null):(a=$.treeContext,nt=bn(M.nextSibling),Rt=r,qe=!0,Ds=null,_n=!1,a!==null&&ag(r,a),r=Pd(r,c.children),r.flags|=4096);return r}return g?(Fs(),M=c.fallback,g=r.mode,$=a.child,J=$.sibling,c=ts($,{mode:"hidden",children:c.children}),c.subtreeFlags=$.subtreeFlags&65011712,J!==null?M=ts(J,M):(M=va(M,g,l,null),M.flags|=2),M.return=r,c.return=r,c.sibling=M,r.child=c,Mi(null,c),c=r.child,M=a.child.memoizedState,M===null?M=Rd(l):(g=M.cachePool,g!==null?($=ht._currentValue,g=g.parent!==$?{parent:$,pool:$}:g):g=cg(),M={baseLanes:M.baseLanes|l,cachePool:g}),c.memoizedState=M,c.childLanes=Md(a,b,l),r.memoizedState=Id,Mi(a.child,c)):(Bs(r),l=a.child,a=l.sibling,l=ts(l,{mode:"visible",children:c.children}),l.return=r,l.sibling=null,a!==null&&(b=r.deletions,b===null?(r.deletions=[a],r.flags|=16):b.push(a)),r.child=l,r.memoizedState=null,l)}function Pd(a,r){return r=Tl({mode:"visible",children:r},a.mode),r.return=a,a.child=r}function Tl(a,r){return a=sn(22,a,null,r),a.lanes=0,a}function Dd(a,r,l){return Ca(r,a.child,null,l),a=Pd(r,r.pendingProps.children),a.flags|=2,r.memoizedState=null,a}function by(a,r,l){a.lanes|=r;var c=a.alternate;c!==null&&(c.lanes|=r),Jc(a.return,r,l)}function Ld(a,r,l,c,g,v){var b=a.memoizedState;b===null?a.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:c,tail:l,tailMode:g,treeForkCount:v}:(b.isBackwards=r,b.rendering=null,b.renderingStartTime=0,b.last=c,b.tail=l,b.tailMode=g,b.treeForkCount=v)}function Ty(a,r,l){var c=r.pendingProps,g=c.revealOrder,v=c.tail;c=c.children;var b=ct.current,M=(b&2)!==0;if(M?(b=b&1|2,r.flags|=128):b&=1,W(ct,b),Pt(a,r,c,l),c=qe?vi:0,!M&&a!==null&&(a.flags&128)!==0)e:for(a=r.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&by(a,l,r);else if(a.tag===19)by(a,l,r);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break e;for(;a.sibling===null;){if(a.return===null||a.return===r)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}switch(g){case"forwards":for(l=r.child,g=null;l!==null;)a=l.alternate,a!==null&&fl(a)===null&&(g=l),l=l.sibling;l=g,l===null?(g=r.child,r.child=null):(g=l.sibling,l.sibling=null),Ld(r,!1,g,l,v,c);break;case"backwards":case"unstable_legacy-backwards":for(l=null,g=r.child,r.child=null;g!==null;){if(a=g.alternate,a!==null&&fl(a)===null){r.child=g;break}a=g.sibling,g.sibling=l,l=g,g=a}Ld(r,!0,l,null,v,c);break;case"together":Ld(r,!1,null,null,void 0,c);break;default:r.memoizedState=null}return r.child}function os(a,r,l){if(a!==null&&(r.dependencies=a.dependencies),Gs|=r.lanes,(l&r.childLanes)===0)if(a!==null){if(ur(a,r,l,!1),(l&r.childLanes)===0)return null}else return null;if(a!==null&&r.child!==a.child)throw Error(s(153));if(r.child!==null){for(a=r.child,l=ts(a,a.pendingProps),r.child=l,l.return=r;a.sibling!==null;)a=a.sibling,l=l.sibling=ts(a,a.pendingProps),l.return=r;l.sibling=null}return r.child}function kd(a,r){return(a.lanes&r)!==0?!0:(a=a.dependencies,!!(a!==null&&al(a)))}function aA(a,r,l){switch(r.tag){case 3:Ee(r,r.stateNode.containerInfo),ks(r,ht,a.memoizedState.cache),Sa();break;case 27:case 5:ve(r);break;case 4:Ee(r,r.stateNode.containerInfo);break;case 10:ks(r,r.type,r.memoizedProps.value);break;case 31:if(r.memoizedState!==null)return r.flags|=128,id(r),null;break;case 13:var c=r.memoizedState;if(c!==null)return c.dehydrated!==null?(Bs(r),r.flags|=128,null):(l&r.child.childLanes)!==0?xy(a,r,l):(Bs(r),a=os(a,r,l),a!==null?a.sibling:null);Bs(r);break;case 19:var g=(a.flags&128)!==0;if(c=(l&r.childLanes)!==0,c||(ur(a,r,l,!1),c=(l&r.childLanes)!==0),g){if(c)return Ty(a,r,l);r.flags|=128}if(g=r.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),W(ct,ct.current),c)break;return null;case 22:return r.lanes=0,gy(a,r,l,r.pendingProps);case 24:ks(r,ht,a.memoizedState.cache)}return os(a,r,l)}function Cy(a,r,l){if(a!==null)if(a.memoizedProps!==r.pendingProps)yt=!0;else{if(!kd(a,l)&&(r.flags&128)===0)return yt=!1,aA(a,r,l);yt=(a.flags&131072)!==0}else yt=!1,qe&&(r.flags&1048576)!==0&&sg(r,vi,r.index);switch(r.lanes=0,r.tag){case 16:e:{var c=r.pendingProps;if(a=ba(r.elementType),r.type=a,typeof a=="function")Fc(a)?(c=Ea(a,c),r.tag=1,r=wy(null,r,a,c,l)):(r.tag=0,r=Nd(null,r,a,c,l));else{if(a!=null){var g=a.$$typeof;if(g===x){r.tag=11,r=py(null,r,a,c,l);break e}else if(g===R){r.tag=14,r=my(null,r,a,c,l);break e}}throw r=oe(a)||a,Error(s(306,r,""))}}return r;case 0:return Nd(a,r,r.type,r.pendingProps,l);case 1:return c=r.type,g=Ea(c,r.pendingProps),wy(a,r,c,g,l);case 3:e:{if(Ee(r,r.stateNode.containerInfo),a===null)throw Error(s(387));c=r.pendingProps;var v=r.memoizedState;g=v.element,td(a,r),Ai(r,c,null,l);var b=r.memoizedState;if(c=b.cache,ks(r,ht,c),c!==v.cache&&Kc(r,[ht],l,!0),Ci(),c=b.element,v.isDehydrated)if(v={element:c,isDehydrated:!1,cache:b.cache},r.updateQueue.baseState=v,r.memoizedState=v,r.flags&256){r=_y(a,r,c,l);break e}else if(c!==g){g=vn(Error(s(424)),r),Si(g),r=_y(a,r,c,l);break e}else{switch(a=r.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(nt=bn(a.firstChild),Rt=r,qe=!0,Ds=null,_n=!0,l=gg(r,null,c,l),r.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling}else{if(Sa(),c===g){r=os(a,r,l);break e}Pt(a,r,c,l)}r=r.child}return r;case 26:return bl(a,r),a===null?(l=U0(r.type,null,r.pendingProps,null))?r.memoizedState=l:qe||(l=r.type,a=r.pendingProps,c=Fl(ue.current).createElement(l),c[It]=r,c[Vt]=a,Dt(c,l,a),Tt(c),r.stateNode=c):r.memoizedState=U0(r.type,a.memoizedProps,r.pendingProps,a.memoizedState),null;case 27:return ve(r),a===null&&qe&&(c=r.stateNode=D0(r.type,r.pendingProps,ue.current),Rt=r,_n=!0,g=nt,Js(r.type)?(hf=g,nt=bn(c.firstChild)):nt=g),Pt(a,r,r.pendingProps.children,l),bl(a,r),a===null&&(r.flags|=4194304),r.child;case 5:return a===null&&qe&&((g=c=nt)&&(c=LA(c,r.type,r.pendingProps,_n),c!==null?(r.stateNode=c,Rt=r,nt=bn(c.firstChild),_n=!1,g=!0):g=!1),g||Ls(r)),ve(r),g=r.type,v=r.pendingProps,b=a!==null?a.memoizedProps:null,c=v.children,cf(g,v)?c=null:b!==null&&cf(g,b)&&(r.flags|=32),r.memoizedState!==null&&(g=ld(a,r,KC,null,null,l),ji._currentValue=g),bl(a,r),Pt(a,r,c,l),r.child;case 6:return a===null&&qe&&((a=l=nt)&&(l=kA(l,r.pendingProps,_n),l!==null?(r.stateNode=l,Rt=r,nt=null,a=!0):a=!1),a||Ls(r)),null;case 13:return xy(a,r,l);case 4:return Ee(r,r.stateNode.containerInfo),c=r.pendingProps,a===null?r.child=Ca(r,null,c,l):Pt(a,r,c,l),r.child;case 11:return py(a,r,r.type,r.pendingProps,l);case 7:return Pt(a,r,r.pendingProps,l),r.child;case 8:return Pt(a,r,r.pendingProps.children,l),r.child;case 12:return Pt(a,r,r.pendingProps.children,l),r.child;case 10:return c=r.pendingProps,ks(r,r.type,c.value),Pt(a,r,c.children,l),r.child;case 9:return g=r.type._context,c=r.pendingProps.children,_a(r),g=Mt(g),c=c(g),r.flags|=1,Pt(a,r,c,l),r.child;case 14:return my(a,r,r.type,r.pendingProps,l);case 15:return hy(a,r,r.type,r.pendingProps,l);case 19:return Ty(a,r,l);case 31:return sA(a,r,l);case 22:return gy(a,r,l,r.pendingProps);case 24:return _a(r),c=Mt(ht),a===null?(g=Wc(),g===null&&(g=tt,v=Xc(),g.pooledCache=v,v.refCount++,v!==null&&(g.pooledCacheLanes|=l),g=v),r.memoizedState={parent:c,cache:g},ed(r),ks(r,ht,g)):((a.lanes&l)!==0&&(td(a,r),Ai(r,null,null,l),Ci()),g=a.memoizedState,v=r.memoizedState,g.parent!==c?(g={parent:c,cache:c},r.memoizedState=g,r.lanes===0&&(r.memoizedState=r.updateQueue.baseState=g),ks(r,ht,c)):(c=v.cache,ks(r,ht,c),c!==g.cache&&Kc(r,[ht],l,!0))),Pt(a,r,r.pendingProps.children,l),r.child;case 29:throw r.pendingProps}throw Error(s(156,r.tag))}function ls(a){a.flags|=4}function Ud(a,r,l,c,g){if((r=(a.mode&32)!==0)&&(r=!1),r){if(a.flags|=16777216,(g&335544128)===g)if(a.stateNode.complete)a.flags|=8192;else if(Wy())a.flags|=8192;else throw Ta=ll,Zc}else a.flags&=-16777217}function Ay(a,r){if(r.type!=="stylesheet"||(r.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!$0(r))if(Wy())a.flags|=8192;else throw Ta=ll,Zc}function Cl(a,r){r!==null&&(a.flags|=4),a.flags&16384&&(r=a.tag!==22?qo():536870912,a.lanes|=r,_r|=r)}function Pi(a,r){if(!qe)switch(a.tailMode){case"hidden":r=a.tail;for(var l=null;r!==null;)r.alternate!==null&&(l=r),r=r.sibling;l===null?a.tail=null:l.sibling=null;break;case"collapsed":l=a.tail;for(var c=null;l!==null;)l.alternate!==null&&(c=l),l=l.sibling;c===null?r||a.tail===null?a.tail=null:a.tail.sibling=null:c.sibling=null}}function st(a){var r=a.alternate!==null&&a.alternate.child===a.child,l=0,c=0;if(r)for(var g=a.child;g!==null;)l|=g.lanes|g.childLanes,c|=g.subtreeFlags&65011712,c|=g.flags&65011712,g.return=a,g=g.sibling;else for(g=a.child;g!==null;)l|=g.lanes|g.childLanes,c|=g.subtreeFlags,c|=g.flags,g.return=a,g=g.sibling;return a.subtreeFlags|=c,a.childLanes=l,r}function rA(a,r,l){var c=r.pendingProps;switch(Vc(r),r.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return st(r),null;case 1:return st(r),null;case 3:return l=r.stateNode,c=null,a!==null&&(c=a.memoizedState.cache),r.memoizedState.cache!==c&&(r.flags|=2048),as(ht),Ae(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(a===null||a.child===null)&&(lr(r)?ls(r):a===null||a.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,jc())),st(r),null;case 26:var g=r.type,v=r.memoizedState;return a===null?(ls(r),v!==null?(st(r),Ay(r,v)):(st(r),Ud(r,g,null,c,l))):v?v!==a.memoizedState?(ls(r),st(r),Ay(r,v)):(st(r),r.flags&=-16777217):(a=a.memoizedProps,a!==c&&ls(r),st(r),Ud(r,g,a,c,l)),null;case 27:if(Et(r),l=ue.current,g=r.type,a!==null&&r.stateNode!=null)a.memoizedProps!==c&&ls(r);else{if(!c){if(r.stateNode===null)throw Error(s(166));return st(r),null}a=le.current,lr(r)?rg(r):(a=D0(g,c,l),r.stateNode=a,ls(r))}return st(r),null;case 5:if(Et(r),g=r.type,a!==null&&r.stateNode!=null)a.memoizedProps!==c&&ls(r);else{if(!c){if(r.stateNode===null)throw Error(s(166));return st(r),null}if(v=le.current,lr(r))rg(r);else{var b=Fl(ue.current);switch(v){case 1:v=b.createElementNS("http://www.w3.org/2000/svg",g);break;case 2:v=b.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;default:switch(g){case"svg":v=b.createElementNS("http://www.w3.org/2000/svg",g);break;case"math":v=b.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;case"script":v=b.createElement("div"),v.innerHTML="<script><\/script>",v=v.removeChild(v.firstChild);break;case"select":v=typeof c.is=="string"?b.createElement("select",{is:c.is}):b.createElement("select"),c.multiple?v.multiple=!0:c.size&&(v.size=c.size);break;default:v=typeof c.is=="string"?b.createElement(g,{is:c.is}):b.createElement(g)}}v[It]=r,v[Vt]=c;e:for(b=r.child;b!==null;){if(b.tag===5||b.tag===6)v.appendChild(b.stateNode);else if(b.tag!==4&&b.tag!==27&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===r)break e;for(;b.sibling===null;){if(b.return===null||b.return===r)break e;b=b.return}b.sibling.return=b.return,b=b.sibling}r.stateNode=v;e:switch(Dt(v,g,c),g){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}c&&ls(r)}}return st(r),Ud(r,r.type,a===null?null:a.memoizedProps,r.pendingProps,l),null;case 6:if(a&&r.stateNode!=null)a.memoizedProps!==c&&ls(r);else{if(typeof c!="string"&&r.stateNode===null)throw Error(s(166));if(a=ue.current,lr(r)){if(a=r.stateNode,l=r.memoizedProps,c=null,g=Rt,g!==null)switch(g.tag){case 27:case 5:c=g.memoizedProps}a[It]=r,a=!!(a.nodeValue===l||c!==null&&c.suppressHydrationWarning===!0||x0(a.nodeValue,l)),a||Ls(r,!0)}else a=Fl(a).createTextNode(c),a[It]=r,r.stateNode=a}return st(r),null;case 31:if(l=r.memoizedState,a===null||a.memoizedState!==null){if(c=lr(r),l!==null){if(a===null){if(!c)throw Error(s(318));if(a=r.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(557));a[It]=r}else Sa(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;st(r),a=!1}else l=jc(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=l),a=!0;if(!a)return r.flags&256?(rn(r),r):(rn(r),null);if((r.flags&128)!==0)throw Error(s(558))}return st(r),null;case 13:if(c=r.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(g=lr(r),c!==null&&c.dehydrated!==null){if(a===null){if(!g)throw Error(s(318));if(g=r.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(s(317));g[It]=r}else Sa(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;st(r),g=!1}else g=jc(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=g),g=!0;if(!g)return r.flags&256?(rn(r),r):(rn(r),null)}return rn(r),(r.flags&128)!==0?(r.lanes=l,r):(l=c!==null,a=a!==null&&a.memoizedState!==null,l&&(c=r.child,g=null,c.alternate!==null&&c.alternate.memoizedState!==null&&c.alternate.memoizedState.cachePool!==null&&(g=c.alternate.memoizedState.cachePool.pool),v=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(v=c.memoizedState.cachePool.pool),v!==g&&(c.flags|=2048)),l!==a&&l&&(r.child.flags|=8192),Cl(r,r.updateQueue),st(r),null);case 4:return Ae(),a===null&&af(r.stateNode.containerInfo),st(r),null;case 10:return as(r.type),st(r),null;case 19:if(ee(ct),c=r.memoizedState,c===null)return st(r),null;if(g=(r.flags&128)!==0,v=c.rendering,v===null)if(g)Pi(c,!1);else{if(ut!==0||a!==null&&(a.flags&128)!==0)for(a=r.child;a!==null;){if(v=fl(a),v!==null){for(r.flags|=128,Pi(c,!1),a=v.updateQueue,r.updateQueue=a,Cl(r,a),r.subtreeFlags=0,a=l,l=r.child;l!==null;)eg(l,a),l=l.sibling;return W(ct,ct.current&1|2),qe&&ns(r,c.treeForkCount),r.child}a=a.sibling}c.tail!==null&&Fe()>Rl&&(r.flags|=128,g=!0,Pi(c,!1),r.lanes=4194304)}else{if(!g)if(a=fl(v),a!==null){if(r.flags|=128,g=!0,a=a.updateQueue,r.updateQueue=a,Cl(r,a),Pi(c,!0),c.tail===null&&c.tailMode==="hidden"&&!v.alternate&&!qe)return st(r),null}else 2*Fe()-c.renderingStartTime>Rl&&l!==536870912&&(r.flags|=128,g=!0,Pi(c,!1),r.lanes=4194304);c.isBackwards?(v.sibling=r.child,r.child=v):(a=c.last,a!==null?a.sibling=v:r.child=v,c.last=v)}return c.tail!==null?(a=c.tail,c.rendering=a,c.tail=a.sibling,c.renderingStartTime=Fe(),a.sibling=null,l=ct.current,W(ct,g?l&1|2:l&1),qe&&ns(r,c.treeForkCount),a):(st(r),null);case 22:case 23:return rn(r),rd(),c=r.memoizedState!==null,a!==null?a.memoizedState!==null!==c&&(r.flags|=8192):c&&(r.flags|=8192),c?(l&536870912)!==0&&(r.flags&128)===0&&(st(r),r.subtreeFlags&6&&(r.flags|=8192)):st(r),l=r.updateQueue,l!==null&&Cl(r,l.retryQueue),l=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(l=a.memoizedState.cachePool.pool),c=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),c!==l&&(r.flags|=2048),a!==null&&ee(xa),null;case 24:return l=null,a!==null&&(l=a.memoizedState.cache),r.memoizedState.cache!==l&&(r.flags|=2048),as(ht),st(r),null;case 25:return null;case 30:return null}throw Error(s(156,r.tag))}function iA(a,r){switch(Vc(r),r.tag){case 1:return a=r.flags,a&65536?(r.flags=a&-65537|128,r):null;case 3:return as(ht),Ae(),a=r.flags,(a&65536)!==0&&(a&128)===0?(r.flags=a&-65537|128,r):null;case 26:case 27:case 5:return Et(r),null;case 31:if(r.memoizedState!==null){if(rn(r),r.alternate===null)throw Error(s(340));Sa()}return a=r.flags,a&65536?(r.flags=a&-65537|128,r):null;case 13:if(rn(r),a=r.memoizedState,a!==null&&a.dehydrated!==null){if(r.alternate===null)throw Error(s(340));Sa()}return a=r.flags,a&65536?(r.flags=a&-65537|128,r):null;case 19:return ee(ct),null;case 4:return Ae(),null;case 10:return as(r.type),null;case 22:case 23:return rn(r),rd(),a!==null&&ee(xa),a=r.flags,a&65536?(r.flags=a&-65537|128,r):null;case 24:return as(ht),null;case 25:return null;default:return null}}function Ey(a,r){switch(Vc(r),r.tag){case 3:as(ht),Ae();break;case 26:case 27:case 5:Et(r);break;case 4:Ae();break;case 31:r.memoizedState!==null&&rn(r);break;case 13:rn(r);break;case 19:ee(ct);break;case 10:as(r.type);break;case 22:case 23:rn(r),rd(),a!==null&&ee(xa);break;case 24:as(ht)}}function Di(a,r){try{var l=r.updateQueue,c=l!==null?l.lastEffect:null;if(c!==null){var g=c.next;l=g;do{if((l.tag&a)===a){c=void 0;var v=l.create,b=l.inst;c=v(),b.destroy=c}l=l.next}while(l!==g)}}catch(M){Je(r,r.return,M)}}function $s(a,r,l){try{var c=r.updateQueue,g=c!==null?c.lastEffect:null;if(g!==null){var v=g.next;c=v;do{if((c.tag&a)===a){var b=c.inst,M=b.destroy;if(M!==void 0){b.destroy=void 0,g=r;var $=l,J=M;try{J()}catch(Z){Je(g,$,Z)}}}c=c.next}while(c!==v)}}catch(Z){Je(r,r.return,Z)}}function Ny(a){var r=a.updateQueue;if(r!==null){var l=a.stateNode;try{vg(r,l)}catch(c){Je(a,a.return,c)}}}function Iy(a,r,l){l.props=Ea(a.type,a.memoizedProps),l.state=a.memoizedState;try{l.componentWillUnmount()}catch(c){Je(a,r,c)}}function Li(a,r){try{var l=a.ref;if(l!==null){switch(a.tag){case 26:case 27:case 5:var c=a.stateNode;break;case 30:c=a.stateNode;break;default:c=a.stateNode}typeof l=="function"?a.refCleanup=l(c):l.current=c}}catch(g){Je(a,r,g)}}function Fn(a,r){var l=a.ref,c=a.refCleanup;if(l!==null)if(typeof c=="function")try{c()}catch(g){Je(a,r,g)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(g){Je(a,r,g)}else l.current=null}function Ry(a){var r=a.type,l=a.memoizedProps,c=a.stateNode;try{e:switch(r){case"button":case"input":case"select":case"textarea":l.autoFocus&&c.focus();break e;case"img":l.src?c.src=l.src:l.srcSet&&(c.srcset=l.srcSet)}}catch(g){Je(a,a.return,g)}}function Od(a,r,l){try{var c=a.stateNode;NA(c,a.type,l,r),c[Vt]=r}catch(g){Je(a,a.return,g)}}function My(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&Js(a.type)||a.tag===4}function qd(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||My(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&Js(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function Bd(a,r,l){var c=a.tag;if(c===5||c===6)a=a.stateNode,r?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(a,r):(r=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,r.appendChild(a),l=l._reactRootContainer,l!=null||r.onclick!==null||(r.onclick=Zn));else if(c!==4&&(c===27&&Js(a.type)&&(l=a.stateNode,r=null),a=a.child,a!==null))for(Bd(a,r,l),a=a.sibling;a!==null;)Bd(a,r,l),a=a.sibling}function Al(a,r,l){var c=a.tag;if(c===5||c===6)a=a.stateNode,r?l.insertBefore(a,r):l.appendChild(a);else if(c!==4&&(c===27&&Js(a.type)&&(l=a.stateNode),a=a.child,a!==null))for(Al(a,r,l),a=a.sibling;a!==null;)Al(a,r,l),a=a.sibling}function Py(a){var r=a.stateNode,l=a.memoizedProps;try{for(var c=a.type,g=r.attributes;g.length;)r.removeAttributeNode(g[0]);Dt(r,c,l),r[It]=a,r[Vt]=l}catch(v){Je(a,a.return,v)}}var us=!1,vt=!1,Fd=!1,Dy=typeof WeakSet=="function"?WeakSet:Set,Ct=null;function oA(a,r){if(a=a.containerInfo,lf=Yl,a=zh(a),Dc(a)){if("selectionStart"in a)var l={start:a.selectionStart,end:a.selectionEnd};else e:{l=(l=a.ownerDocument)&&l.defaultView||window;var c=l.getSelection&&l.getSelection();if(c&&c.rangeCount!==0){l=c.anchorNode;var g=c.anchorOffset,v=c.focusNode;c=c.focusOffset;try{l.nodeType,v.nodeType}catch{l=null;break e}var b=0,M=-1,$=-1,J=0,Z=0,ne=a,K=null;t:for(;;){for(var Q;ne!==l||g!==0&&ne.nodeType!==3||(M=b+g),ne!==v||c!==0&&ne.nodeType!==3||($=b+c),ne.nodeType===3&&(b+=ne.nodeValue.length),(Q=ne.firstChild)!==null;)K=ne,ne=Q;for(;;){if(ne===a)break t;if(K===l&&++J===g&&(M=b),K===v&&++Z===c&&($=b),(Q=ne.nextSibling)!==null)break;ne=K,K=ne.parentNode}ne=Q}l=M===-1||$===-1?null:{start:M,end:$}}else l=null}l=l||{start:0,end:0}}else l=null;for(uf={focusedElem:a,selectionRange:l},Yl=!1,Ct=r;Ct!==null;)if(r=Ct,a=r.child,(r.subtreeFlags&1028)!==0&&a!==null)a.return=r,Ct=a;else for(;Ct!==null;){switch(r=Ct,v=r.alternate,a=r.flags,r.tag){case 0:if((a&4)!==0&&(a=r.updateQueue,a=a!==null?a.events:null,a!==null))for(l=0;l<a.length;l++)g=a[l],g.ref.impl=g.nextImpl;break;case 11:case 15:break;case 1:if((a&1024)!==0&&v!==null){a=void 0,l=r,g=v.memoizedProps,v=v.memoizedState,c=l.stateNode;try{var fe=Ea(l.type,g);a=c.getSnapshotBeforeUpdate(fe,v),c.__reactInternalSnapshotBeforeUpdate=a}catch(xe){Je(l,l.return,xe)}}break;case 3:if((a&1024)!==0){if(a=r.stateNode.containerInfo,l=a.nodeType,l===9)ff(a);else if(l===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":ff(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(s(163))}if(a=r.sibling,a!==null){a.return=r.return,Ct=a;break}Ct=r.return}}function Ly(a,r,l){var c=l.flags;switch(l.tag){case 0:case 11:case 15:ds(a,l),c&4&&Di(5,l);break;case 1:if(ds(a,l),c&4)if(a=l.stateNode,r===null)try{a.componentDidMount()}catch(b){Je(l,l.return,b)}else{var g=Ea(l.type,r.memoizedProps);r=r.memoizedState;try{a.componentDidUpdate(g,r,a.__reactInternalSnapshotBeforeUpdate)}catch(b){Je(l,l.return,b)}}c&64&&Ny(l),c&512&&Li(l,l.return);break;case 3:if(ds(a,l),c&64&&(a=l.updateQueue,a!==null)){if(r=null,l.child!==null)switch(l.child.tag){case 27:case 5:r=l.child.stateNode;break;case 1:r=l.child.stateNode}try{vg(a,r)}catch(b){Je(l,l.return,b)}}break;case 27:r===null&&c&4&&Py(l);case 26:case 5:ds(a,l),r===null&&c&4&&Ry(l),c&512&&Li(l,l.return);break;case 12:ds(a,l);break;case 31:ds(a,l),c&4&&Oy(a,l);break;case 13:ds(a,l),c&4&&qy(a,l),c&64&&(a=l.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(l=gA.bind(null,l),UA(a,l))));break;case 22:if(c=l.memoizedState!==null||us,!c){r=r!==null&&r.memoizedState!==null||vt,g=us;var v=vt;us=c,(vt=r)&&!v?fs(a,l,(l.subtreeFlags&8772)!==0):ds(a,l),us=g,vt=v}break;case 30:break;default:ds(a,l)}}function ky(a){var r=a.alternate;r!==null&&(a.alternate=null,ky(r)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(r=a.stateNode,r!==null&&gc(r)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var rt=null,jt=!1;function cs(a,r,l){for(l=l.child;l!==null;)Uy(a,r,l),l=l.sibling}function Uy(a,r,l){if(Ut&&typeof Ut.onCommitFiberUnmount=="function")try{Ut.onCommitFiberUnmount(fa,l)}catch{}switch(l.tag){case 26:vt||Fn(l,r),cs(a,r,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:vt||Fn(l,r);var c=rt,g=jt;Js(l.type)&&(rt=l.stateNode,jt=!1),cs(a,r,l),Gi(l.stateNode),rt=c,jt=g;break;case 5:vt||Fn(l,r);case 6:if(c=rt,g=jt,rt=null,cs(a,r,l),rt=c,jt=g,rt!==null)if(jt)try{(rt.nodeType===9?rt.body:rt.nodeName==="HTML"?rt.ownerDocument.body:rt).removeChild(l.stateNode)}catch(v){Je(l,r,v)}else try{rt.removeChild(l.stateNode)}catch(v){Je(l,r,v)}break;case 18:rt!==null&&(jt?(a=rt,N0(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,l.stateNode),Ir(a)):N0(rt,l.stateNode));break;case 4:c=rt,g=jt,rt=l.stateNode.containerInfo,jt=!0,cs(a,r,l),rt=c,jt=g;break;case 0:case 11:case 14:case 15:$s(2,l,r),vt||$s(4,l,r),cs(a,r,l);break;case 1:vt||(Fn(l,r),c=l.stateNode,typeof c.componentWillUnmount=="function"&&Iy(l,r,c)),cs(a,r,l);break;case 21:cs(a,r,l);break;case 22:vt=(c=vt)||l.memoizedState!==null,cs(a,r,l),vt=c;break;default:cs(a,r,l)}}function Oy(a,r){if(r.memoizedState===null&&(a=r.alternate,a!==null&&(a=a.memoizedState,a!==null))){a=a.dehydrated;try{Ir(a)}catch(l){Je(r,r.return,l)}}}function qy(a,r){if(r.memoizedState===null&&(a=r.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{Ir(a)}catch(l){Je(r,r.return,l)}}function lA(a){switch(a.tag){case 31:case 13:case 19:var r=a.stateNode;return r===null&&(r=a.stateNode=new Dy),r;case 22:return a=a.stateNode,r=a._retryCache,r===null&&(r=a._retryCache=new Dy),r;default:throw Error(s(435,a.tag))}}function El(a,r){var l=lA(a);r.forEach(function(c){if(!l.has(c)){l.add(c);var g=yA.bind(null,a,c);c.then(g,g)}})}function Yt(a,r){var l=r.deletions;if(l!==null)for(var c=0;c<l.length;c++){var g=l[c],v=a,b=r,M=b;e:for(;M!==null;){switch(M.tag){case 27:if(Js(M.type)){rt=M.stateNode,jt=!1;break e}break;case 5:rt=M.stateNode,jt=!1;break e;case 3:case 4:rt=M.stateNode.containerInfo,jt=!0;break e}M=M.return}if(rt===null)throw Error(s(160));Uy(v,b,g),rt=null,jt=!1,v=g.alternate,v!==null&&(v.return=null),g.return=null}if(r.subtreeFlags&13886)for(r=r.child;r!==null;)By(r,a),r=r.sibling}var Rn=null;function By(a,r){var l=a.alternate,c=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:Yt(r,a),Jt(a),c&4&&($s(3,a,a.return),Di(3,a),$s(5,a,a.return));break;case 1:Yt(r,a),Jt(a),c&512&&(vt||l===null||Fn(l,l.return)),c&64&&us&&(a=a.updateQueue,a!==null&&(c=a.callbacks,c!==null&&(l=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=l===null?c:l.concat(c))));break;case 26:var g=Rn;if(Yt(r,a),Jt(a),c&512&&(vt||l===null||Fn(l,l.return)),c&4){var v=l!==null?l.memoizedState:null;if(c=a.memoizedState,l===null)if(c===null)if(a.stateNode===null){e:{c=a.type,l=a.memoizedProps,g=g.ownerDocument||g;t:switch(c){case"title":v=g.getElementsByTagName("title")[0],(!v||v[oi]||v[It]||v.namespaceURI==="http://www.w3.org/2000/svg"||v.hasAttribute("itemprop"))&&(v=g.createElement(c),g.head.insertBefore(v,g.querySelector("head > title"))),Dt(v,c,l),v[It]=a,Tt(v),c=v;break e;case"link":var b=B0("link","href",g).get(c+(l.href||""));if(b){for(var M=0;M<b.length;M++)if(v=b[M],v.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&v.getAttribute("rel")===(l.rel==null?null:l.rel)&&v.getAttribute("title")===(l.title==null?null:l.title)&&v.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){b.splice(M,1);break t}}v=g.createElement(c),Dt(v,c,l),g.head.appendChild(v);break;case"meta":if(b=B0("meta","content",g).get(c+(l.content||""))){for(M=0;M<b.length;M++)if(v=b[M],v.getAttribute("content")===(l.content==null?null:""+l.content)&&v.getAttribute("name")===(l.name==null?null:l.name)&&v.getAttribute("property")===(l.property==null?null:l.property)&&v.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&v.getAttribute("charset")===(l.charSet==null?null:l.charSet)){b.splice(M,1);break t}}v=g.createElement(c),Dt(v,c,l),g.head.appendChild(v);break;default:throw Error(s(468,c))}v[It]=a,Tt(v),c=v}a.stateNode=c}else F0(g,a.type,a.stateNode);else a.stateNode=q0(g,c,a.memoizedProps);else v!==c?(v===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):v.count--,c===null?F0(g,a.type,a.stateNode):q0(g,c,a.memoizedProps)):c===null&&a.stateNode!==null&&Od(a,a.memoizedProps,l.memoizedProps)}break;case 27:Yt(r,a),Jt(a),c&512&&(vt||l===null||Fn(l,l.return)),l!==null&&c&4&&Od(a,a.memoizedProps,l.memoizedProps);break;case 5:if(Yt(r,a),Jt(a),c&512&&(vt||l===null||Fn(l,l.return)),a.flags&32){g=a.stateNode;try{Wa(g,"")}catch(fe){Je(a,a.return,fe)}}c&4&&a.stateNode!=null&&(g=a.memoizedProps,Od(a,g,l!==null?l.memoizedProps:g)),c&1024&&(Fd=!0);break;case 6:if(Yt(r,a),Jt(a),c&4){if(a.stateNode===null)throw Error(s(162));c=a.memoizedProps,l=a.stateNode;try{l.nodeValue=c}catch(fe){Je(a,a.return,fe)}}break;case 3:if(Gl=null,g=Rn,Rn=$l(r.containerInfo),Yt(r,a),Rn=g,Jt(a),c&4&&l!==null&&l.memoizedState.isDehydrated)try{Ir(r.containerInfo)}catch(fe){Je(a,a.return,fe)}Fd&&(Fd=!1,Fy(a));break;case 4:c=Rn,Rn=$l(a.stateNode.containerInfo),Yt(r,a),Jt(a),Rn=c;break;case 12:Yt(r,a),Jt(a);break;case 31:Yt(r,a),Jt(a),c&4&&(c=a.updateQueue,c!==null&&(a.updateQueue=null,El(a,c)));break;case 13:Yt(r,a),Jt(a),a.child.flags&8192&&a.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(Il=Fe()),c&4&&(c=a.updateQueue,c!==null&&(a.updateQueue=null,El(a,c)));break;case 22:g=a.memoizedState!==null;var $=l!==null&&l.memoizedState!==null,J=us,Z=vt;if(us=J||g,vt=Z||$,Yt(r,a),vt=Z,us=J,Jt(a),c&8192)e:for(r=a.stateNode,r._visibility=g?r._visibility&-2:r._visibility|1,g&&(l===null||$||us||vt||Na(a)),l=null,r=a;;){if(r.tag===5||r.tag===26){if(l===null){$=l=r;try{if(v=$.stateNode,g)b=v.style,typeof b.setProperty=="function"?b.setProperty("display","none","important"):b.display="none";else{M=$.stateNode;var ne=$.memoizedProps.style,K=ne!=null&&ne.hasOwnProperty("display")?ne.display:null;M.style.display=K==null||typeof K=="boolean"?"":(""+K).trim()}}catch(fe){Je($,$.return,fe)}}}else if(r.tag===6){if(l===null){$=r;try{$.stateNode.nodeValue=g?"":$.memoizedProps}catch(fe){Je($,$.return,fe)}}}else if(r.tag===18){if(l===null){$=r;try{var Q=$.stateNode;g?I0(Q,!0):I0($.stateNode,!1)}catch(fe){Je($,$.return,fe)}}}else if((r.tag!==22&&r.tag!==23||r.memoizedState===null||r===a)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===a)break e;for(;r.sibling===null;){if(r.return===null||r.return===a)break e;l===r&&(l=null),r=r.return}l===r&&(l=null),r.sibling.return=r.return,r=r.sibling}c&4&&(c=a.updateQueue,c!==null&&(l=c.retryQueue,l!==null&&(c.retryQueue=null,El(a,l))));break;case 19:Yt(r,a),Jt(a),c&4&&(c=a.updateQueue,c!==null&&(a.updateQueue=null,El(a,c)));break;case 30:break;case 21:break;default:Yt(r,a),Jt(a)}}function Jt(a){var r=a.flags;if(r&2){try{for(var l,c=a.return;c!==null;){if(My(c)){l=c;break}c=c.return}if(l==null)throw Error(s(160));switch(l.tag){case 27:var g=l.stateNode,v=qd(a);Al(a,v,g);break;case 5:var b=l.stateNode;l.flags&32&&(Wa(b,""),l.flags&=-33);var M=qd(a);Al(a,M,b);break;case 3:case 4:var $=l.stateNode.containerInfo,J=qd(a);Bd(a,J,$);break;default:throw Error(s(161))}}catch(Z){Je(a,a.return,Z)}a.flags&=-3}r&4096&&(a.flags&=-4097)}function Fy(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var r=a;Fy(r),r.tag===5&&r.flags&1024&&r.stateNode.reset(),a=a.sibling}}function ds(a,r){if(r.subtreeFlags&8772)for(r=r.child;r!==null;)Ly(a,r.alternate,r),r=r.sibling}function Na(a){for(a=a.child;a!==null;){var r=a;switch(r.tag){case 0:case 11:case 14:case 15:$s(4,r,r.return),Na(r);break;case 1:Fn(r,r.return);var l=r.stateNode;typeof l.componentWillUnmount=="function"&&Iy(r,r.return,l),Na(r);break;case 27:Gi(r.stateNode);case 26:case 5:Fn(r,r.return),Na(r);break;case 22:r.memoizedState===null&&Na(r);break;case 30:Na(r);break;default:Na(r)}a=a.sibling}}function fs(a,r,l){for(l=l&&(r.subtreeFlags&8772)!==0,r=r.child;r!==null;){var c=r.alternate,g=a,v=r,b=v.flags;switch(v.tag){case 0:case 11:case 15:fs(g,v,l),Di(4,v);break;case 1:if(fs(g,v,l),c=v,g=c.stateNode,typeof g.componentDidMount=="function")try{g.componentDidMount()}catch(J){Je(c,c.return,J)}if(c=v,g=c.updateQueue,g!==null){var M=c.stateNode;try{var $=g.shared.hiddenCallbacks;if($!==null)for(g.shared.hiddenCallbacks=null,g=0;g<$.length;g++)yg($[g],M)}catch(J){Je(c,c.return,J)}}l&&b&64&&Ny(v),Li(v,v.return);break;case 27:Py(v);case 26:case 5:fs(g,v,l),l&&c===null&&b&4&&Ry(v),Li(v,v.return);break;case 12:fs(g,v,l);break;case 31:fs(g,v,l),l&&b&4&&Oy(g,v);break;case 13:fs(g,v,l),l&&b&4&&qy(g,v);break;case 22:v.memoizedState===null&&fs(g,v,l),Li(v,v.return);break;case 30:break;default:fs(g,v,l)}r=r.sibling}}function $d(a,r){var l=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(l=a.memoizedState.cachePool.pool),a=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(a=r.memoizedState.cachePool.pool),a!==l&&(a!=null&&a.refCount++,l!=null&&wi(l))}function Hd(a,r){a=null,r.alternate!==null&&(a=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==a&&(r.refCount++,a!=null&&wi(a))}function Mn(a,r,l,c){if(r.subtreeFlags&10256)for(r=r.child;r!==null;)$y(a,r,l,c),r=r.sibling}function $y(a,r,l,c){var g=r.flags;switch(r.tag){case 0:case 11:case 15:Mn(a,r,l,c),g&2048&&Di(9,r);break;case 1:Mn(a,r,l,c);break;case 3:Mn(a,r,l,c),g&2048&&(a=null,r.alternate!==null&&(a=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==a&&(r.refCount++,a!=null&&wi(a)));break;case 12:if(g&2048){Mn(a,r,l,c),a=r.stateNode;try{var v=r.memoizedProps,b=v.id,M=v.onPostCommit;typeof M=="function"&&M(b,r.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch($){Je(r,r.return,$)}}else Mn(a,r,l,c);break;case 31:Mn(a,r,l,c);break;case 13:Mn(a,r,l,c);break;case 23:break;case 22:v=r.stateNode,b=r.alternate,r.memoizedState!==null?v._visibility&2?Mn(a,r,l,c):ki(a,r):v._visibility&2?Mn(a,r,l,c):(v._visibility|=2,vr(a,r,l,c,(r.subtreeFlags&10256)!==0||!1)),g&2048&&$d(b,r);break;case 24:Mn(a,r,l,c),g&2048&&Hd(r.alternate,r);break;default:Mn(a,r,l,c)}}function vr(a,r,l,c,g){for(g=g&&((r.subtreeFlags&10256)!==0||!1),r=r.child;r!==null;){var v=a,b=r,M=l,$=c,J=b.flags;switch(b.tag){case 0:case 11:case 15:vr(v,b,M,$,g),Di(8,b);break;case 23:break;case 22:var Z=b.stateNode;b.memoizedState!==null?Z._visibility&2?vr(v,b,M,$,g):ki(v,b):(Z._visibility|=2,vr(v,b,M,$,g)),g&&J&2048&&$d(b.alternate,b);break;case 24:vr(v,b,M,$,g),g&&J&2048&&Hd(b.alternate,b);break;default:vr(v,b,M,$,g)}r=r.sibling}}function ki(a,r){if(r.subtreeFlags&10256)for(r=r.child;r!==null;){var l=a,c=r,g=c.flags;switch(c.tag){case 22:ki(l,c),g&2048&&$d(c.alternate,c);break;case 24:ki(l,c),g&2048&&Hd(c.alternate,c);break;default:ki(l,c)}r=r.sibling}}var Ui=8192;function Sr(a,r,l){if(a.subtreeFlags&Ui)for(a=a.child;a!==null;)Hy(a,r,l),a=a.sibling}function Hy(a,r,l){switch(a.tag){case 26:Sr(a,r,l),a.flags&Ui&&a.memoizedState!==null&&JA(l,Rn,a.memoizedState,a.memoizedProps);break;case 5:Sr(a,r,l);break;case 3:case 4:var c=Rn;Rn=$l(a.stateNode.containerInfo),Sr(a,r,l),Rn=c;break;case 22:a.memoizedState===null&&(c=a.alternate,c!==null&&c.memoizedState!==null?(c=Ui,Ui=16777216,Sr(a,r,l),Ui=c):Sr(a,r,l));break;default:Sr(a,r,l)}}function Gy(a){var r=a.alternate;if(r!==null&&(a=r.child,a!==null)){r.child=null;do r=a.sibling,a.sibling=null,a=r;while(a!==null)}}function Oi(a){var r=a.deletions;if((a.flags&16)!==0){if(r!==null)for(var l=0;l<r.length;l++){var c=r[l];Ct=c,zy(c,a)}Gy(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)Vy(a),a=a.sibling}function Vy(a){switch(a.tag){case 0:case 11:case 15:Oi(a),a.flags&2048&&$s(9,a,a.return);break;case 3:Oi(a);break;case 12:Oi(a);break;case 22:var r=a.stateNode;a.memoizedState!==null&&r._visibility&2&&(a.return===null||a.return.tag!==13)?(r._visibility&=-3,Nl(a)):Oi(a);break;default:Oi(a)}}function Nl(a){var r=a.deletions;if((a.flags&16)!==0){if(r!==null)for(var l=0;l<r.length;l++){var c=r[l];Ct=c,zy(c,a)}Gy(a)}for(a=a.child;a!==null;){switch(r=a,r.tag){case 0:case 11:case 15:$s(8,r,r.return),Nl(r);break;case 22:l=r.stateNode,l._visibility&2&&(l._visibility&=-3,Nl(r));break;default:Nl(r)}a=a.sibling}}function zy(a,r){for(;Ct!==null;){var l=Ct;switch(l.tag){case 0:case 11:case 15:$s(8,l,r);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var c=l.memoizedState.cachePool.pool;c!=null&&c.refCount++}break;case 24:wi(l.memoizedState.cache)}if(c=l.child,c!==null)c.return=l,Ct=c;else e:for(l=a;Ct!==null;){c=Ct;var g=c.sibling,v=c.return;if(ky(c),c===l){Ct=null;break e}if(g!==null){g.return=v,Ct=g;break e}Ct=v}}}var uA={getCacheForType:function(a){var r=Mt(ht),l=r.data.get(a);return l===void 0&&(l=a(),r.data.set(a,l)),l},cacheSignal:function(){return Mt(ht).controller.signal}},cA=typeof WeakMap=="function"?WeakMap:Map,Ve=0,tt=null,Le=null,Ue=0,Ye=0,on=null,Hs=!1,wr=!1,Gd=!1,ps=0,ut=0,Gs=0,Ia=0,Vd=0,ln=0,_r=0,qi=null,Kt=null,zd=!1,Il=0,jy=0,Rl=1/0,Ml=null,Vs=null,St=0,zs=null,xr=null,ms=0,jd=0,Yd=null,Yy=null,Bi=0,Jd=null;function un(){return(Ve&2)!==0&&Ue!==0?Ue&-Ue:q.T!==null?ef():uh()}function Jy(){if(ln===0)if((Ue&536870912)===0||qe){var a=Xn;Xn<<=1,(Xn&3932160)===0&&(Xn=262144),ln=a}else ln=536870912;return a=an.current,a!==null&&(a.flags|=32),ln}function Xt(a,r,l){(a===tt&&(Ye===2||Ye===9)||a.cancelPendingCommit!==null)&&(br(a,0),js(a,Ue,ln,!1)),Is(a,l),((Ve&2)===0||a!==tt)&&(a===tt&&((Ve&2)===0&&(Ia|=l),ut===4&&js(a,Ue,ln,!1)),$n(a))}function Ky(a,r,l){if((Ve&6)!==0)throw Error(s(327));var c=!l&&(r&127)===0&&(r&a.expiredLanes)===0||Ns(a,r),g=c?pA(a,r):Xd(a,r,!0),v=c;do{if(g===0){wr&&!c&&js(a,r,0,!1);break}else{if(l=a.current.alternate,v&&!dA(l)){g=Xd(a,r,!1),v=!1;continue}if(g===2){if(v=r,a.errorRecoveryDisabledLanes&v)var b=0;else b=a.pendingLanes&-536870913,b=b!==0?b:b&536870912?536870912:0;if(b!==0){r=b;e:{var M=a;g=qi;var $=M.current.memoizedState.isDehydrated;if($&&(br(M,b).flags|=256),b=Xd(M,b,!1),b!==2){if(Gd&&!$){M.errorRecoveryDisabledLanes|=v,Ia|=v,g=4;break e}v=Kt,Kt=g,v!==null&&(Kt===null?Kt=v:Kt.push.apply(Kt,v))}g=b}if(v=!1,g!==2)continue}}if(g===1){br(a,0),js(a,r,0,!0);break}e:{switch(c=a,v=g,v){case 0:case 1:throw Error(s(345));case 4:if((r&4194048)!==r)break;case 6:js(c,r,ln,!Hs);break e;case 2:Kt=null;break;case 3:case 5:break;default:throw Error(s(329))}if((r&62914560)===r&&(g=Il+300-Fe(),10<g)){if(js(c,r,ln,!Hs),Qn(c,0,!0)!==0)break e;ms=r,c.timeoutHandle=A0(Xy.bind(null,c,l,Kt,Ml,zd,r,ln,Ia,_r,Hs,v,"Throttled",-0,0),g);break e}Xy(c,l,Kt,Ml,zd,r,ln,Ia,_r,Hs,v,null,-0,0)}}break}while(!0);$n(a)}function Xy(a,r,l,c,g,v,b,M,$,J,Z,ne,K,Q){if(a.timeoutHandle=-1,ne=r.subtreeFlags,ne&8192||(ne&16785408)===16785408){ne={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Zn},Hy(r,v,ne);var fe=(v&62914560)===v?Il-Fe():(v&4194048)===v?jy-Fe():0;if(fe=KA(ne,fe),fe!==null){ms=v,a.cancelPendingCommit=fe(a0.bind(null,a,r,v,l,c,g,b,M,$,Z,ne,null,K,Q)),js(a,v,b,!J);return}}a0(a,r,v,l,c,g,b,M,$)}function dA(a){for(var r=a;;){var l=r.tag;if((l===0||l===11||l===15)&&r.flags&16384&&(l=r.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var c=0;c<l.length;c++){var g=l[c],v=g.getSnapshot;g=g.value;try{if(!nn(v(),g))return!1}catch{return!1}}if(l=r.child,r.subtreeFlags&16384&&l!==null)l.return=r,r=l;else{if(r===a)break;for(;r.sibling===null;){if(r.return===null||r.return===a)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function js(a,r,l,c){r&=~Vd,r&=~Ia,a.suspendedLanes|=r,a.pingedLanes&=~r,c&&(a.warmLanes|=r),c=a.expirationTimes;for(var g=r;0<g;){var v=31-we(g),b=1<<v;c[v]=-1,g&=~b}l!==0&&Bo(a,l,r)}function Pl(){return(Ve&6)===0?(Fi(0),!1):!0}function Kd(){if(Le!==null){if(Ye===0)var a=Le.return;else a=Le,ss=wa=null,dd(a),pr=null,xi=0,a=Le;for(;a!==null;)Ey(a.alternate,a),a=a.return;Le=null}}function br(a,r){var l=a.timeoutHandle;l!==-1&&(a.timeoutHandle=-1,MA(l)),l=a.cancelPendingCommit,l!==null&&(a.cancelPendingCommit=null,l()),ms=0,Kd(),tt=a,Le=l=ts(a.current,null),Ue=r,Ye=0,on=null,Hs=!1,wr=Ns(a,r),Gd=!1,_r=ln=Vd=Ia=Gs=ut=0,Kt=qi=null,zd=!1,(r&8)!==0&&(r|=r&32);var c=a.entangledLanes;if(c!==0)for(a=a.entanglements,c&=r;0<c;){var g=31-we(c),v=1<<g;r|=a[g],c&=~v}return ps=r,Zo(),l}function Qy(a,r){Me=null,q.H=Ri,r===fr||r===ol?(r=pg(),Ye=3):r===Zc?(r=pg(),Ye=4):Ye=r===Ed?8:r!==null&&typeof r=="object"&&typeof r.then=="function"?6:1,on=r,Le===null&&(ut=1,_l(a,vn(r,a.current)))}function Wy(){var a=an.current;return a===null?!0:(Ue&4194048)===Ue?xn===null:(Ue&62914560)===Ue||(Ue&536870912)!==0?a===xn:!1}function Zy(){var a=q.H;return q.H=Ri,a===null?Ri:a}function e0(){var a=q.A;return q.A=uA,a}function Dl(){ut=4,Hs||(Ue&4194048)!==Ue&&an.current!==null||(wr=!0),(Gs&134217727)===0&&(Ia&134217727)===0||tt===null||js(tt,Ue,ln,!1)}function Xd(a,r,l){var c=Ve;Ve|=2;var g=Zy(),v=e0();(tt!==a||Ue!==r)&&(Ml=null,br(a,r)),r=!1;var b=ut;e:do try{if(Ye!==0&&Le!==null){var M=Le,$=on;switch(Ye){case 8:Kd(),b=6;break e;case 3:case 2:case 9:case 6:an.current===null&&(r=!0);var J=Ye;if(Ye=0,on=null,Tr(a,M,$,J),l&&wr){b=0;break e}break;default:J=Ye,Ye=0,on=null,Tr(a,M,$,J)}}fA(),b=ut;break}catch(Z){Qy(a,Z)}while(!0);return r&&a.shellSuspendCounter++,ss=wa=null,Ve=c,q.H=g,q.A=v,Le===null&&(tt=null,Ue=0,Zo()),b}function fA(){for(;Le!==null;)t0(Le)}function pA(a,r){var l=Ve;Ve|=2;var c=Zy(),g=e0();tt!==a||Ue!==r?(Ml=null,Rl=Fe()+500,br(a,r)):wr=Ns(a,r);e:do try{if(Ye!==0&&Le!==null){r=Le;var v=on;t:switch(Ye){case 1:Ye=0,on=null,Tr(a,r,v,1);break;case 2:case 9:if(dg(v)){Ye=0,on=null,n0(r);break}r=function(){Ye!==2&&Ye!==9||tt!==a||(Ye=7),$n(a)},v.then(r,r);break e;case 3:Ye=7;break e;case 4:Ye=5;break e;case 7:dg(v)?(Ye=0,on=null,n0(r)):(Ye=0,on=null,Tr(a,r,v,7));break;case 5:var b=null;switch(Le.tag){case 26:b=Le.memoizedState;case 5:case 27:var M=Le;if(b?$0(b):M.stateNode.complete){Ye=0,on=null;var $=M.sibling;if($!==null)Le=$;else{var J=M.return;J!==null?(Le=J,Ll(J)):Le=null}break t}}Ye=0,on=null,Tr(a,r,v,5);break;case 6:Ye=0,on=null,Tr(a,r,v,6);break;case 8:Kd(),ut=6;break e;default:throw Error(s(462))}}mA();break}catch(Z){Qy(a,Z)}while(!0);return ss=wa=null,q.H=c,q.A=g,Ve=l,Le!==null?0:(tt=null,Ue=0,Zo(),ut)}function mA(){for(;Le!==null&&!$t();)t0(Le)}function t0(a){var r=Cy(a.alternate,a,ps);a.memoizedProps=a.pendingProps,r===null?Ll(a):Le=r}function n0(a){var r=a,l=r.alternate;switch(r.tag){case 15:case 0:r=Sy(l,r,r.pendingProps,r.type,void 0,Ue);break;case 11:r=Sy(l,r,r.pendingProps,r.type.render,r.ref,Ue);break;case 5:dd(r);default:Ey(l,r),r=Le=eg(r,ps),r=Cy(l,r,ps)}a.memoizedProps=a.pendingProps,r===null?Ll(a):Le=r}function Tr(a,r,l,c){ss=wa=null,dd(r),pr=null,xi=0;var g=r.return;try{if(nA(a,g,r,l,Ue)){ut=1,_l(a,vn(l,a.current)),Le=null;return}}catch(v){if(g!==null)throw Le=g,v;ut=1,_l(a,vn(l,a.current)),Le=null;return}r.flags&32768?(qe||c===1?a=!0:wr||(Ue&536870912)!==0?a=!1:(Hs=a=!0,(c===2||c===9||c===3||c===6)&&(c=an.current,c!==null&&c.tag===13&&(c.flags|=16384))),s0(r,a)):Ll(r)}function Ll(a){var r=a;do{if((r.flags&32768)!==0){s0(r,Hs);return}a=r.return;var l=rA(r.alternate,r,ps);if(l!==null){Le=l;return}if(r=r.sibling,r!==null){Le=r;return}Le=r=a}while(r!==null);ut===0&&(ut=5)}function s0(a,r){do{var l=iA(a.alternate,a);if(l!==null){l.flags&=32767,Le=l;return}if(l=a.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!r&&(a=a.sibling,a!==null)){Le=a;return}Le=a=l}while(a!==null);ut=6,Le=null}function a0(a,r,l,c,g,v,b,M,$){a.cancelPendingCommit=null;do kl();while(St!==0);if((Ve&6)!==0)throw Error(s(327));if(r!==null){if(r===a.current)throw Error(s(177));if(v=r.lanes|r.childLanes,v|=qc,pc(a,l,v,b,M,$),a===tt&&(Le=tt=null,Ue=0),xr=r,zs=a,ms=l,jd=v,Yd=g,Yy=c,(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,vA(Va,function(){return u0(),null})):(a.callbackNode=null,a.callbackPriority=0),c=(r.flags&13878)!==0,(r.subtreeFlags&13878)!==0||c){c=q.T,q.T=null,g=j.p,j.p=2,b=Ve,Ve|=4;try{oA(a,r,l)}finally{Ve=b,j.p=g,q.T=c}}St=1,r0(),i0(),o0()}}function r0(){if(St===1){St=0;var a=zs,r=xr,l=(r.flags&13878)!==0;if((r.subtreeFlags&13878)!==0||l){l=q.T,q.T=null;var c=j.p;j.p=2;var g=Ve;Ve|=4;try{By(r,a);var v=uf,b=zh(a.containerInfo),M=v.focusedElem,$=v.selectionRange;if(b!==M&&M&&M.ownerDocument&&Vh(M.ownerDocument.documentElement,M)){if($!==null&&Dc(M)){var J=$.start,Z=$.end;if(Z===void 0&&(Z=J),"selectionStart"in M)M.selectionStart=J,M.selectionEnd=Math.min(Z,M.value.length);else{var ne=M.ownerDocument||document,K=ne&&ne.defaultView||window;if(K.getSelection){var Q=K.getSelection(),fe=M.textContent.length,xe=Math.min($.start,fe),We=$.end===void 0?xe:Math.min($.end,fe);!Q.extend&&xe>We&&(b=We,We=xe,xe=b);var V=Gh(M,xe),G=Gh(M,We);if(V&&G&&(Q.rangeCount!==1||Q.anchorNode!==V.node||Q.anchorOffset!==V.offset||Q.focusNode!==G.node||Q.focusOffset!==G.offset)){var Y=ne.createRange();Y.setStart(V.node,V.offset),Q.removeAllRanges(),xe>We?(Q.addRange(Y),Q.extend(G.node,G.offset)):(Y.setEnd(G.node,G.offset),Q.addRange(Y))}}}}for(ne=[],Q=M;Q=Q.parentNode;)Q.nodeType===1&&ne.push({element:Q,left:Q.scrollLeft,top:Q.scrollTop});for(typeof M.focus=="function"&&M.focus(),M=0;M<ne.length;M++){var te=ne[M];te.element.scrollLeft=te.left,te.element.scrollTop=te.top}}Yl=!!lf,uf=lf=null}finally{Ve=g,j.p=c,q.T=l}}a.current=r,St=2}}function i0(){if(St===2){St=0;var a=zs,r=xr,l=(r.flags&8772)!==0;if((r.subtreeFlags&8772)!==0||l){l=q.T,q.T=null;var c=j.p;j.p=2;var g=Ve;Ve|=4;try{Ly(a,r.alternate,r)}finally{Ve=g,j.p=c,q.T=l}}St=3}}function o0(){if(St===4||St===3){St=0,ca();var a=zs,r=xr,l=ms,c=Yy;(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?St=5:(St=0,xr=zs=null,l0(a,a.pendingLanes));var g=a.pendingLanes;if(g===0&&(Vs=null),mc(l),r=r.stateNode,Ut&&typeof Ut.onCommitFiberRoot=="function")try{Ut.onCommitFiberRoot(fa,r,void 0,(r.current.flags&128)===128)}catch{}if(c!==null){r=q.T,g=j.p,j.p=2,q.T=null;try{for(var v=a.onRecoverableError,b=0;b<c.length;b++){var M=c[b];v(M.value,{componentStack:M.stack})}}finally{q.T=r,j.p=g}}(ms&3)!==0&&kl(),$n(a),g=a.pendingLanes,(l&261930)!==0&&(g&42)!==0?a===Jd?Bi++:(Bi=0,Jd=a):Bi=0,Fi(0)}}function l0(a,r){(a.pooledCacheLanes&=r)===0&&(r=a.pooledCache,r!=null&&(a.pooledCache=null,wi(r)))}function kl(){return r0(),i0(),o0(),u0()}function u0(){if(St!==5)return!1;var a=zs,r=jd;jd=0;var l=mc(ms),c=q.T,g=j.p;try{j.p=32>l?32:l,q.T=null,l=Yd,Yd=null;var v=zs,b=ms;if(St=0,xr=zs=null,ms=0,(Ve&6)!==0)throw Error(s(331));var M=Ve;if(Ve|=4,Vy(v.current),$y(v,v.current,b,l),Ve=M,Fi(0,!1),Ut&&typeof Ut.onPostCommitFiberRoot=="function")try{Ut.onPostCommitFiberRoot(fa,v)}catch{}return!0}finally{j.p=g,q.T=c,l0(a,r)}}function c0(a,r,l){r=vn(l,r),r=Ad(a.stateNode,r,2),a=qs(a,r,2),a!==null&&(Is(a,2),$n(a))}function Je(a,r,l){if(a.tag===3)c0(a,a,l);else for(;r!==null;){if(r.tag===3){c0(r,a,l);break}else if(r.tag===1){var c=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(Vs===null||!Vs.has(c))){a=vn(l,a),l=dy(2),c=qs(r,l,2),c!==null&&(fy(l,c,r,a),Is(c,2),$n(c));break}}r=r.return}}function Qd(a,r,l){var c=a.pingCache;if(c===null){c=a.pingCache=new cA;var g=new Set;c.set(r,g)}else g=c.get(r),g===void 0&&(g=new Set,c.set(r,g));g.has(l)||(Gd=!0,g.add(l),a=hA.bind(null,a,r,l),r.then(a,a))}function hA(a,r,l){var c=a.pingCache;c!==null&&c.delete(r),a.pingedLanes|=a.suspendedLanes&l,a.warmLanes&=~l,tt===a&&(Ue&l)===l&&(ut===4||ut===3&&(Ue&62914560)===Ue&&300>Fe()-Il?(Ve&2)===0&&br(a,0):Vd|=l,_r===Ue&&(_r=0)),$n(a)}function d0(a,r){r===0&&(r=qo()),a=ya(a,r),a!==null&&(Is(a,r),$n(a))}function gA(a){var r=a.memoizedState,l=0;r!==null&&(l=r.retryLane),d0(a,l)}function yA(a,r){var l=0;switch(a.tag){case 31:case 13:var c=a.stateNode,g=a.memoizedState;g!==null&&(l=g.retryLane);break;case 19:c=a.stateNode;break;case 22:c=a.stateNode._retryCache;break;default:throw Error(s(314))}c!==null&&c.delete(r),d0(a,l)}function vA(a,r){return tn(a,r)}var Ul=null,Cr=null,Wd=!1,Ol=!1,Zd=!1,Ys=0;function $n(a){a!==Cr&&a.next===null&&(Cr===null?Ul=Cr=a:Cr=Cr.next=a),Ol=!0,Wd||(Wd=!0,wA())}function Fi(a,r){if(!Zd&&Ol){Zd=!0;do for(var l=!1,c=Ul;c!==null;){if(a!==0){var g=c.pendingLanes;if(g===0)var v=0;else{var b=c.suspendedLanes,M=c.pingedLanes;v=(1<<31-we(42|a)+1)-1,v&=g&~(b&~M),v=v&201326741?v&201326741|1:v?v|2:0}v!==0&&(l=!0,h0(c,v))}else v=Ue,v=Qn(c,c===tt?v:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),(v&3)===0||Ns(c,v)||(l=!0,h0(c,v));c=c.next}while(l);Zd=!1}}function SA(){f0()}function f0(){Ol=Wd=!1;var a=0;Ys!==0&&RA()&&(a=Ys);for(var r=Fe(),l=null,c=Ul;c!==null;){var g=c.next,v=p0(c,r);v===0?(c.next=null,l===null?Ul=g:l.next=g,g===null&&(Cr=l)):(l=c,(a!==0||(v&3)!==0)&&(Ol=!0)),c=g}St!==0&&St!==5||Fi(a),Ys!==0&&(Ys=0)}function p0(a,r){for(var l=a.suspendedLanes,c=a.pingedLanes,g=a.expirationTimes,v=a.pendingLanes&-62914561;0<v;){var b=31-we(v),M=1<<b,$=g[b];$===-1?((M&l)===0||(M&c)!==0)&&(g[b]=ri(M,r)):$<=r&&(a.expiredLanes|=M),v&=~M}if(r=tt,l=Ue,l=Qn(a,a===r?l:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),c=a.callbackNode,l===0||a===r&&(Ye===2||Ye===9)||a.cancelPendingCommit!==null)return c!==null&&c!==null&&mt(c),a.callbackNode=null,a.callbackPriority=0;if((l&3)===0||Ns(a,l)){if(r=l&-l,r===a.callbackPriority)return r;switch(c!==null&&mt(c),mc(l)){case 2:case 8:l=Oo;break;case 32:l=Va;break;case 268435456:l=ai;break;default:l=Va}return c=m0.bind(null,a),l=tn(l,c),a.callbackPriority=r,a.callbackNode=l,r}return c!==null&&c!==null&&mt(c),a.callbackPriority=2,a.callbackNode=null,2}function m0(a,r){if(St!==0&&St!==5)return a.callbackNode=null,a.callbackPriority=0,null;var l=a.callbackNode;if(kl()&&a.callbackNode!==l)return null;var c=Ue;return c=Qn(a,a===tt?c:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),c===0?null:(Ky(a,c,r),p0(a,Fe()),a.callbackNode!=null&&a.callbackNode===l?m0.bind(null,a):null)}function h0(a,r){if(kl())return null;Ky(a,r,!0)}function wA(){PA(function(){(Ve&6)!==0?tn(Ga,SA):f0()})}function ef(){if(Ys===0){var a=cr;a===0&&(a=he,he<<=1,(he&261888)===0&&(he=256)),Ys=a}return Ys}function g0(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:zo(""+a)}function y0(a,r){var l=r.ownerDocument.createElement("input");return l.name=r.name,l.value=r.value,a.id&&l.setAttribute("form",a.id),r.parentNode.insertBefore(l,r),a=new FormData(a),l.parentNode.removeChild(l),a}function _A(a,r,l,c,g){if(r==="submit"&&l&&l.stateNode===g){var v=g0((g[Vt]||null).action),b=c.submitter;b&&(r=(r=b[Vt]||null)?g0(r.formAction):b.getAttribute("formAction"),r!==null&&(v=r,b=null));var M=new Ko("action","action",null,c,g);a.push({event:M,listeners:[{instance:null,listener:function(){if(c.defaultPrevented){if(Ys!==0){var $=b?y0(g,b):new FormData(g);wd(l,{pending:!0,data:$,method:g.method,action:v},null,$)}}else typeof v=="function"&&(M.preventDefault(),$=b?y0(g,b):new FormData(g),wd(l,{pending:!0,data:$,method:g.method,action:v},v,$))},currentTarget:g}]})}}for(var tf=0;tf<Oc.length;tf++){var nf=Oc[tf],xA=nf.toLowerCase(),bA=nf[0].toUpperCase()+nf.slice(1);In(xA,"on"+bA)}In(Jh,"onAnimationEnd"),In(Kh,"onAnimationIteration"),In(Xh,"onAnimationStart"),In("dblclick","onDoubleClick"),In("focusin","onFocus"),In("focusout","onBlur"),In(BC,"onTransitionRun"),In(FC,"onTransitionStart"),In($C,"onTransitionCancel"),In(Qh,"onTransitionEnd"),Xa("onMouseEnter",["mouseout","mouseover"]),Xa("onMouseLeave",["mouseout","mouseover"]),Xa("onPointerEnter",["pointerout","pointerover"]),Xa("onPointerLeave",["pointerout","pointerover"]),pa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),pa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),pa("onBeforeInput",["compositionend","keypress","textInput","paste"]),pa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),pa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),pa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var $i="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),TA=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat($i));function v0(a,r){r=(r&4)!==0;for(var l=0;l<a.length;l++){var c=a[l],g=c.event;c=c.listeners;e:{var v=void 0;if(r)for(var b=c.length-1;0<=b;b--){var M=c[b],$=M.instance,J=M.currentTarget;if(M=M.listener,$!==v&&g.isPropagationStopped())break e;v=M,g.currentTarget=J;try{v(g)}catch(Z){Wo(Z)}g.currentTarget=null,v=$}else for(b=0;b<c.length;b++){if(M=c[b],$=M.instance,J=M.currentTarget,M=M.listener,$!==v&&g.isPropagationStopped())break e;v=M,g.currentTarget=J;try{v(g)}catch(Z){Wo(Z)}g.currentTarget=null,v=$}}}}function ke(a,r){var l=r[hc];l===void 0&&(l=r[hc]=new Set);var c=a+"__bubble";l.has(c)||(S0(r,a,2,!1),l.add(c))}function sf(a,r,l){var c=0;r&&(c|=4),S0(l,a,c,r)}var ql="_reactListening"+Math.random().toString(36).slice(2);function af(a){if(!a[ql]){a[ql]=!0,fh.forEach(function(l){l!=="selectionchange"&&(TA.has(l)||sf(l,!1,a),sf(l,!0,a))});var r=a.nodeType===9?a:a.ownerDocument;r===null||r[ql]||(r[ql]=!0,sf("selectionchange",!1,r))}}function S0(a,r,l,c){switch(J0(r)){case 2:var g=WA;break;case 8:g=ZA;break;default:g=wf}l=g.bind(null,r,l,a),g=void 0,!Tc||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(g=!0),c?g!==void 0?a.addEventListener(r,l,{capture:!0,passive:g}):a.addEventListener(r,l,!0):g!==void 0?a.addEventListener(r,l,{passive:g}):a.addEventListener(r,l,!1)}function rf(a,r,l,c,g){var v=c;if((r&1)===0&&(r&2)===0&&c!==null)e:for(;;){if(c===null)return;var b=c.tag;if(b===3||b===4){var M=c.stateNode.containerInfo;if(M===g)break;if(b===4)for(b=c.return;b!==null;){var $=b.tag;if(($===3||$===4)&&b.stateNode.containerInfo===g)return;b=b.return}for(;M!==null;){if(b=Ya(M),b===null)return;if($=b.tag,$===5||$===6||$===26||$===27){c=v=b;continue e}M=M.parentNode}}c=c.return}Th(function(){var J=v,Z=xc(l),ne=[];e:{var K=Wh.get(a);if(K!==void 0){var Q=Ko,fe=a;switch(a){case"keypress":if(Yo(l)===0)break e;case"keydown":case"keyup":Q=yC;break;case"focusin":fe="focus",Q=Nc;break;case"focusout":fe="blur",Q=Nc;break;case"beforeblur":case"afterblur":Q=Nc;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Q=Eh;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Q=rC;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Q=wC;break;case Jh:case Kh:case Xh:Q=lC;break;case Qh:Q=xC;break;case"scroll":case"scrollend":Q=sC;break;case"wheel":Q=TC;break;case"copy":case"cut":case"paste":Q=cC;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Q=Ih;break;case"toggle":case"beforetoggle":Q=AC}var xe=(r&4)!==0,We=!xe&&(a==="scroll"||a==="scrollend"),V=xe?K!==null?K+"Capture":null:K;xe=[];for(var G=J,Y;G!==null;){var te=G;if(Y=te.stateNode,te=te.tag,te!==5&&te!==26&&te!==27||Y===null||V===null||(te=ui(G,V),te!=null&&xe.push(Hi(G,te,Y))),We)break;G=G.return}0<xe.length&&(K=new Q(K,fe,null,l,Z),ne.push({event:K,listeners:xe}))}}if((r&7)===0){e:{if(K=a==="mouseover"||a==="pointerover",Q=a==="mouseout"||a==="pointerout",K&&l!==_c&&(fe=l.relatedTarget||l.fromElement)&&(Ya(fe)||fe[ja]))break e;if((Q||K)&&(K=Z.window===Z?Z:(K=Z.ownerDocument)?K.defaultView||K.parentWindow:window,Q?(fe=l.relatedTarget||l.toElement,Q=J,fe=fe?Ya(fe):null,fe!==null&&(We=o(fe),xe=fe.tag,fe!==We||xe!==5&&xe!==27&&xe!==6)&&(fe=null)):(Q=null,fe=J),Q!==fe)){if(xe=Eh,te="onMouseLeave",V="onMouseEnter",G="mouse",(a==="pointerout"||a==="pointerover")&&(xe=Ih,te="onPointerLeave",V="onPointerEnter",G="pointer"),We=Q==null?K:li(Q),Y=fe==null?K:li(fe),K=new xe(te,G+"leave",Q,l,Z),K.target=We,K.relatedTarget=Y,te=null,Ya(Z)===J&&(xe=new xe(V,G+"enter",fe,l,Z),xe.target=Y,xe.relatedTarget=We,te=xe),We=te,Q&&fe)t:{for(xe=CA,V=Q,G=fe,Y=0,te=V;te;te=xe(te))Y++;te=0;for(var _e=G;_e;_e=xe(_e))te++;for(;0<Y-te;)V=xe(V),Y--;for(;0<te-Y;)G=xe(G),te--;for(;Y--;){if(V===G||G!==null&&V===G.alternate){xe=V;break t}V=xe(V),G=xe(G)}xe=null}else xe=null;Q!==null&&w0(ne,K,Q,xe,!1),fe!==null&&We!==null&&w0(ne,We,fe,xe,!0)}}e:{if(K=J?li(J):window,Q=K.nodeName&&K.nodeName.toLowerCase(),Q==="select"||Q==="input"&&K.type==="file")var $e=Oh;else if(kh(K))if(qh)$e=UC;else{$e=LC;var pe=DC}else Q=K.nodeName,!Q||Q.toLowerCase()!=="input"||K.type!=="checkbox"&&K.type!=="radio"?J&&wc(J.elementType)&&($e=Oh):$e=kC;if($e&&($e=$e(a,J))){Uh(ne,$e,l,Z);break e}pe&&pe(a,K,J),a==="focusout"&&J&&K.type==="number"&&J.memoizedProps.value!=null&&Sc(K,"number",K.value)}switch(pe=J?li(J):window,a){case"focusin":(kh(pe)||pe.contentEditable==="true")&&(nr=pe,Lc=J,yi=null);break;case"focusout":yi=Lc=nr=null;break;case"mousedown":kc=!0;break;case"contextmenu":case"mouseup":case"dragend":kc=!1,jh(ne,l,Z);break;case"selectionchange":if(qC)break;case"keydown":case"keyup":jh(ne,l,Z)}var Pe;if(Rc)e:{switch(a){case"compositionstart":var Oe="onCompositionStart";break e;case"compositionend":Oe="onCompositionEnd";break e;case"compositionupdate":Oe="onCompositionUpdate";break e}Oe=void 0}else tr?Dh(a,l)&&(Oe="onCompositionEnd"):a==="keydown"&&l.keyCode===229&&(Oe="onCompositionStart");Oe&&(Rh&&l.locale!=="ko"&&(tr||Oe!=="onCompositionStart"?Oe==="onCompositionEnd"&&tr&&(Pe=Ch()):(Ms=Z,Cc="value"in Ms?Ms.value:Ms.textContent,tr=!0)),pe=Bl(J,Oe),0<pe.length&&(Oe=new Nh(Oe,a,null,l,Z),ne.push({event:Oe,listeners:pe}),Pe?Oe.data=Pe:(Pe=Lh(l),Pe!==null&&(Oe.data=Pe)))),(Pe=NC?IC(a,l):RC(a,l))&&(Oe=Bl(J,"onBeforeInput"),0<Oe.length&&(pe=new Nh("onBeforeInput","beforeinput",null,l,Z),ne.push({event:pe,listeners:Oe}),pe.data=Pe)),_A(ne,a,J,l,Z)}v0(ne,r)})}function Hi(a,r,l){return{instance:a,listener:r,currentTarget:l}}function Bl(a,r){for(var l=r+"Capture",c=[];a!==null;){var g=a,v=g.stateNode;if(g=g.tag,g!==5&&g!==26&&g!==27||v===null||(g=ui(a,l),g!=null&&c.unshift(Hi(a,g,v)),g=ui(a,r),g!=null&&c.push(Hi(a,g,v))),a.tag===3)return c;a=a.return}return[]}function CA(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function w0(a,r,l,c,g){for(var v=r._reactName,b=[];l!==null&&l!==c;){var M=l,$=M.alternate,J=M.stateNode;if(M=M.tag,$!==null&&$===c)break;M!==5&&M!==26&&M!==27||J===null||($=J,g?(J=ui(l,v),J!=null&&b.unshift(Hi(l,J,$))):g||(J=ui(l,v),J!=null&&b.push(Hi(l,J,$)))),l=l.return}b.length!==0&&a.push({event:r,listeners:b})}var AA=/\r\n?/g,EA=/\u0000|\uFFFD/g;function _0(a){return(typeof a=="string"?a:""+a).replace(AA,`
`).replace(EA,"")}function x0(a,r){return r=_0(r),_0(a)===r}function Qe(a,r,l,c,g,v){switch(l){case"children":typeof c=="string"?r==="body"||r==="textarea"&&c===""||Wa(a,c):(typeof c=="number"||typeof c=="bigint")&&r!=="body"&&Wa(a,""+c);break;case"className":Go(a,"class",c);break;case"tabIndex":Go(a,"tabindex",c);break;case"dir":case"role":case"viewBox":case"width":case"height":Go(a,l,c);break;case"style":xh(a,c,v);break;case"data":if(r!=="object"){Go(a,"data",c);break}case"src":case"href":if(c===""&&(r!=="a"||l!=="href")){a.removeAttribute(l);break}if(c==null||typeof c=="function"||typeof c=="symbol"||typeof c=="boolean"){a.removeAttribute(l);break}c=zo(""+c),a.setAttribute(l,c);break;case"action":case"formAction":if(typeof c=="function"){a.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof v=="function"&&(l==="formAction"?(r!=="input"&&Qe(a,r,"name",g.name,g,null),Qe(a,r,"formEncType",g.formEncType,g,null),Qe(a,r,"formMethod",g.formMethod,g,null),Qe(a,r,"formTarget",g.formTarget,g,null)):(Qe(a,r,"encType",g.encType,g,null),Qe(a,r,"method",g.method,g,null),Qe(a,r,"target",g.target,g,null)));if(c==null||typeof c=="symbol"||typeof c=="boolean"){a.removeAttribute(l);break}c=zo(""+c),a.setAttribute(l,c);break;case"onClick":c!=null&&(a.onclick=Zn);break;case"onScroll":c!=null&&ke("scroll",a);break;case"onScrollEnd":c!=null&&ke("scrollend",a);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(s(61));if(l=c.__html,l!=null){if(g.children!=null)throw Error(s(60));a.innerHTML=l}}break;case"multiple":a.multiple=c&&typeof c!="function"&&typeof c!="symbol";break;case"muted":a.muted=c&&typeof c!="function"&&typeof c!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(c==null||typeof c=="function"||typeof c=="boolean"||typeof c=="symbol"){a.removeAttribute("xlink:href");break}l=zo(""+c),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":c!=null&&typeof c!="function"&&typeof c!="symbol"?a.setAttribute(l,""+c):a.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":c&&typeof c!="function"&&typeof c!="symbol"?a.setAttribute(l,""):a.removeAttribute(l);break;case"capture":case"download":c===!0?a.setAttribute(l,""):c!==!1&&c!=null&&typeof c!="function"&&typeof c!="symbol"?a.setAttribute(l,c):a.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":c!=null&&typeof c!="function"&&typeof c!="symbol"&&!isNaN(c)&&1<=c?a.setAttribute(l,c):a.removeAttribute(l);break;case"rowSpan":case"start":c==null||typeof c=="function"||typeof c=="symbol"||isNaN(c)?a.removeAttribute(l):a.setAttribute(l,c);break;case"popover":ke("beforetoggle",a),ke("toggle",a),Ho(a,"popover",c);break;case"xlinkActuate":Wn(a,"http://www.w3.org/1999/xlink","xlink:actuate",c);break;case"xlinkArcrole":Wn(a,"http://www.w3.org/1999/xlink","xlink:arcrole",c);break;case"xlinkRole":Wn(a,"http://www.w3.org/1999/xlink","xlink:role",c);break;case"xlinkShow":Wn(a,"http://www.w3.org/1999/xlink","xlink:show",c);break;case"xlinkTitle":Wn(a,"http://www.w3.org/1999/xlink","xlink:title",c);break;case"xlinkType":Wn(a,"http://www.w3.org/1999/xlink","xlink:type",c);break;case"xmlBase":Wn(a,"http://www.w3.org/XML/1998/namespace","xml:base",c);break;case"xmlLang":Wn(a,"http://www.w3.org/XML/1998/namespace","xml:lang",c);break;case"xmlSpace":Wn(a,"http://www.w3.org/XML/1998/namespace","xml:space",c);break;case"is":Ho(a,"is",c);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=tC.get(l)||l,Ho(a,l,c))}}function of(a,r,l,c,g,v){switch(l){case"style":xh(a,c,v);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(s(61));if(l=c.__html,l!=null){if(g.children!=null)throw Error(s(60));a.innerHTML=l}}break;case"children":typeof c=="string"?Wa(a,c):(typeof c=="number"||typeof c=="bigint")&&Wa(a,""+c);break;case"onScroll":c!=null&&ke("scroll",a);break;case"onScrollEnd":c!=null&&ke("scrollend",a);break;case"onClick":c!=null&&(a.onclick=Zn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!ph.hasOwnProperty(l))e:{if(l[0]==="o"&&l[1]==="n"&&(g=l.endsWith("Capture"),r=l.slice(2,g?l.length-7:void 0),v=a[Vt]||null,v=v!=null?v[l]:null,typeof v=="function"&&a.removeEventListener(r,v,g),typeof c=="function")){typeof v!="function"&&v!==null&&(l in a?a[l]=null:a.hasAttribute(l)&&a.removeAttribute(l)),a.addEventListener(r,c,g);break e}l in a?a[l]=c:c===!0?a.setAttribute(l,""):Ho(a,l,c)}}}function Dt(a,r,l){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ke("error",a),ke("load",a);var c=!1,g=!1,v;for(v in l)if(l.hasOwnProperty(v)){var b=l[v];if(b!=null)switch(v){case"src":c=!0;break;case"srcSet":g=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,r));default:Qe(a,r,v,b,l,null)}}g&&Qe(a,r,"srcSet",l.srcSet,l,null),c&&Qe(a,r,"src",l.src,l,null);return;case"input":ke("invalid",a);var M=v=b=g=null,$=null,J=null;for(c in l)if(l.hasOwnProperty(c)){var Z=l[c];if(Z!=null)switch(c){case"name":g=Z;break;case"type":b=Z;break;case"checked":$=Z;break;case"defaultChecked":J=Z;break;case"value":v=Z;break;case"defaultValue":M=Z;break;case"children":case"dangerouslySetInnerHTML":if(Z!=null)throw Error(s(137,r));break;default:Qe(a,r,c,Z,l,null)}}vh(a,v,M,$,J,b,g,!1);return;case"select":ke("invalid",a),c=b=v=null;for(g in l)if(l.hasOwnProperty(g)&&(M=l[g],M!=null))switch(g){case"value":v=M;break;case"defaultValue":b=M;break;case"multiple":c=M;default:Qe(a,r,g,M,l,null)}r=v,l=b,a.multiple=!!c,r!=null?Qa(a,!!c,r,!1):l!=null&&Qa(a,!!c,l,!0);return;case"textarea":ke("invalid",a),v=g=c=null;for(b in l)if(l.hasOwnProperty(b)&&(M=l[b],M!=null))switch(b){case"value":c=M;break;case"defaultValue":g=M;break;case"children":v=M;break;case"dangerouslySetInnerHTML":if(M!=null)throw Error(s(91));break;default:Qe(a,r,b,M,l,null)}wh(a,c,g,v);return;case"option":for($ in l)if(l.hasOwnProperty($)&&(c=l[$],c!=null))switch($){case"selected":a.selected=c&&typeof c!="function"&&typeof c!="symbol";break;default:Qe(a,r,$,c,l,null)}return;case"dialog":ke("beforetoggle",a),ke("toggle",a),ke("cancel",a),ke("close",a);break;case"iframe":case"object":ke("load",a);break;case"video":case"audio":for(c=0;c<$i.length;c++)ke($i[c],a);break;case"image":ke("error",a),ke("load",a);break;case"details":ke("toggle",a);break;case"embed":case"source":case"link":ke("error",a),ke("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(J in l)if(l.hasOwnProperty(J)&&(c=l[J],c!=null))switch(J){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,r));default:Qe(a,r,J,c,l,null)}return;default:if(wc(r)){for(Z in l)l.hasOwnProperty(Z)&&(c=l[Z],c!==void 0&&of(a,r,Z,c,l,void 0));return}}for(M in l)l.hasOwnProperty(M)&&(c=l[M],c!=null&&Qe(a,r,M,c,l,null))}function NA(a,r,l,c){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var g=null,v=null,b=null,M=null,$=null,J=null,Z=null;for(Q in l){var ne=l[Q];if(l.hasOwnProperty(Q)&&ne!=null)switch(Q){case"checked":break;case"value":break;case"defaultValue":$=ne;default:c.hasOwnProperty(Q)||Qe(a,r,Q,null,c,ne)}}for(var K in c){var Q=c[K];if(ne=l[K],c.hasOwnProperty(K)&&(Q!=null||ne!=null))switch(K){case"type":v=Q;break;case"name":g=Q;break;case"checked":J=Q;break;case"defaultChecked":Z=Q;break;case"value":b=Q;break;case"defaultValue":M=Q;break;case"children":case"dangerouslySetInnerHTML":if(Q!=null)throw Error(s(137,r));break;default:Q!==ne&&Qe(a,r,K,Q,c,ne)}}vc(a,b,M,$,J,Z,v,g);return;case"select":Q=b=M=K=null;for(v in l)if($=l[v],l.hasOwnProperty(v)&&$!=null)switch(v){case"value":break;case"multiple":Q=$;default:c.hasOwnProperty(v)||Qe(a,r,v,null,c,$)}for(g in c)if(v=c[g],$=l[g],c.hasOwnProperty(g)&&(v!=null||$!=null))switch(g){case"value":K=v;break;case"defaultValue":M=v;break;case"multiple":b=v;default:v!==$&&Qe(a,r,g,v,c,$)}r=M,l=b,c=Q,K!=null?Qa(a,!!l,K,!1):!!c!=!!l&&(r!=null?Qa(a,!!l,r,!0):Qa(a,!!l,l?[]:"",!1));return;case"textarea":Q=K=null;for(M in l)if(g=l[M],l.hasOwnProperty(M)&&g!=null&&!c.hasOwnProperty(M))switch(M){case"value":break;case"children":break;default:Qe(a,r,M,null,c,g)}for(b in c)if(g=c[b],v=l[b],c.hasOwnProperty(b)&&(g!=null||v!=null))switch(b){case"value":K=g;break;case"defaultValue":Q=g;break;case"children":break;case"dangerouslySetInnerHTML":if(g!=null)throw Error(s(91));break;default:g!==v&&Qe(a,r,b,g,c,v)}Sh(a,K,Q);return;case"option":for(var fe in l)if(K=l[fe],l.hasOwnProperty(fe)&&K!=null&&!c.hasOwnProperty(fe))switch(fe){case"selected":a.selected=!1;break;default:Qe(a,r,fe,null,c,K)}for($ in c)if(K=c[$],Q=l[$],c.hasOwnProperty($)&&K!==Q&&(K!=null||Q!=null))switch($){case"selected":a.selected=K&&typeof K!="function"&&typeof K!="symbol";break;default:Qe(a,r,$,K,c,Q)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var xe in l)K=l[xe],l.hasOwnProperty(xe)&&K!=null&&!c.hasOwnProperty(xe)&&Qe(a,r,xe,null,c,K);for(J in c)if(K=c[J],Q=l[J],c.hasOwnProperty(J)&&K!==Q&&(K!=null||Q!=null))switch(J){case"children":case"dangerouslySetInnerHTML":if(K!=null)throw Error(s(137,r));break;default:Qe(a,r,J,K,c,Q)}return;default:if(wc(r)){for(var We in l)K=l[We],l.hasOwnProperty(We)&&K!==void 0&&!c.hasOwnProperty(We)&&of(a,r,We,void 0,c,K);for(Z in c)K=c[Z],Q=l[Z],!c.hasOwnProperty(Z)||K===Q||K===void 0&&Q===void 0||of(a,r,Z,K,c,Q);return}}for(var V in l)K=l[V],l.hasOwnProperty(V)&&K!=null&&!c.hasOwnProperty(V)&&Qe(a,r,V,null,c,K);for(ne in c)K=c[ne],Q=l[ne],!c.hasOwnProperty(ne)||K===Q||K==null&&Q==null||Qe(a,r,ne,K,c,Q)}function b0(a){switch(a){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function IA(){if(typeof performance.getEntriesByType=="function"){for(var a=0,r=0,l=performance.getEntriesByType("resource"),c=0;c<l.length;c++){var g=l[c],v=g.transferSize,b=g.initiatorType,M=g.duration;if(v&&M&&b0(b)){for(b=0,M=g.responseEnd,c+=1;c<l.length;c++){var $=l[c],J=$.startTime;if(J>M)break;var Z=$.transferSize,ne=$.initiatorType;Z&&b0(ne)&&($=$.responseEnd,b+=Z*($<M?1:(M-J)/($-J)))}if(--c,r+=8*(v+b)/(g.duration/1e3),a++,10<a)break}}if(0<a)return r/a/1e6}return navigator.connection&&(a=navigator.connection.downlink,typeof a=="number")?a:5}var lf=null,uf=null;function Fl(a){return a.nodeType===9?a:a.ownerDocument}function T0(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function C0(a,r){if(a===0)switch(r){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&r==="foreignObject"?0:a}function cf(a,r){return a==="textarea"||a==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.children=="bigint"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var df=null;function RA(){var a=window.event;return a&&a.type==="popstate"?a===df?!1:(df=a,!0):(df=null,!1)}var A0=typeof setTimeout=="function"?setTimeout:void 0,MA=typeof clearTimeout=="function"?clearTimeout:void 0,E0=typeof Promise=="function"?Promise:void 0,PA=typeof queueMicrotask=="function"?queueMicrotask:typeof E0<"u"?function(a){return E0.resolve(null).then(a).catch(DA)}:A0;function DA(a){setTimeout(function(){throw a})}function Js(a){return a==="head"}function N0(a,r){var l=r,c=0;do{var g=l.nextSibling;if(a.removeChild(l),g&&g.nodeType===8)if(l=g.data,l==="/$"||l==="/&"){if(c===0){a.removeChild(g),Ir(r);return}c--}else if(l==="$"||l==="$?"||l==="$~"||l==="$!"||l==="&")c++;else if(l==="html")Gi(a.ownerDocument.documentElement);else if(l==="head"){l=a.ownerDocument.head,Gi(l);for(var v=l.firstChild;v;){var b=v.nextSibling,M=v.nodeName;v[oi]||M==="SCRIPT"||M==="STYLE"||M==="LINK"&&v.rel.toLowerCase()==="stylesheet"||l.removeChild(v),v=b}}else l==="body"&&Gi(a.ownerDocument.body);l=g}while(l);Ir(r)}function I0(a,r){var l=a;a=0;do{var c=l.nextSibling;if(l.nodeType===1?r?(l._stashedDisplay=l.style.display,l.style.display="none"):(l.style.display=l._stashedDisplay||"",l.getAttribute("style")===""&&l.removeAttribute("style")):l.nodeType===3&&(r?(l._stashedText=l.nodeValue,l.nodeValue=""):l.nodeValue=l._stashedText||""),c&&c.nodeType===8)if(l=c.data,l==="/$"){if(a===0)break;a--}else l!=="$"&&l!=="$?"&&l!=="$~"&&l!=="$!"||a++;l=c}while(l)}function ff(a){var r=a.firstChild;for(r&&r.nodeType===10&&(r=r.nextSibling);r;){var l=r;switch(r=r.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":ff(l),gc(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}a.removeChild(l)}}function LA(a,r,l,c){for(;a.nodeType===1;){var g=l;if(a.nodeName.toLowerCase()!==r.toLowerCase()){if(!c&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(c){if(!a[oi])switch(r){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(v=a.getAttribute("rel"),v==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(v!==g.rel||a.getAttribute("href")!==(g.href==null||g.href===""?null:g.href)||a.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin)||a.getAttribute("title")!==(g.title==null?null:g.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(v=a.getAttribute("src"),(v!==(g.src==null?null:g.src)||a.getAttribute("type")!==(g.type==null?null:g.type)||a.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin))&&v&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(r==="input"&&a.type==="hidden"){var v=g.name==null?null:""+g.name;if(g.type==="hidden"&&a.getAttribute("name")===v)return a}else return a;if(a=bn(a.nextSibling),a===null)break}return null}function kA(a,r,l){if(r==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!l||(a=bn(a.nextSibling),a===null))return null;return a}function R0(a,r){for(;a.nodeType!==8;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!r||(a=bn(a.nextSibling),a===null))return null;return a}function pf(a){return a.data==="$?"||a.data==="$~"}function mf(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState!=="loading"}function UA(a,r){var l=a.ownerDocument;if(a.data==="$~")a._reactRetry=r;else if(a.data!=="$?"||l.readyState!=="loading")r();else{var c=function(){r(),l.removeEventListener("DOMContentLoaded",c)};l.addEventListener("DOMContentLoaded",c),a._reactRetry=c}}function bn(a){for(;a!=null;a=a.nextSibling){var r=a.nodeType;if(r===1||r===3)break;if(r===8){if(r=a.data,r==="$"||r==="$!"||r==="$?"||r==="$~"||r==="&"||r==="F!"||r==="F")break;if(r==="/$"||r==="/&")return null}}return a}var hf=null;function M0(a){a=a.nextSibling;for(var r=0;a;){if(a.nodeType===8){var l=a.data;if(l==="/$"||l==="/&"){if(r===0)return bn(a.nextSibling);r--}else l!=="$"&&l!=="$!"&&l!=="$?"&&l!=="$~"&&l!=="&"||r++}a=a.nextSibling}return null}function P0(a){a=a.previousSibling;for(var r=0;a;){if(a.nodeType===8){var l=a.data;if(l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"){if(r===0)return a;r--}else l!=="/$"&&l!=="/&"||r++}a=a.previousSibling}return null}function D0(a,r,l){switch(r=Fl(l),a){case"html":if(a=r.documentElement,!a)throw Error(s(452));return a;case"head":if(a=r.head,!a)throw Error(s(453));return a;case"body":if(a=r.body,!a)throw Error(s(454));return a;default:throw Error(s(451))}}function Gi(a){for(var r=a.attributes;r.length;)a.removeAttributeNode(r[0]);gc(a)}var Tn=new Map,L0=new Set;function $l(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var hs=j.d;j.d={f:OA,r:qA,D:BA,C:FA,L:$A,m:HA,X:VA,S:GA,M:zA};function OA(){var a=hs.f(),r=Pl();return a||r}function qA(a){var r=Ja(a);r!==null&&r.tag===5&&r.type==="form"?Qg(r):hs.r(a)}var Ar=typeof document>"u"?null:document;function k0(a,r,l){var c=Ar;if(c&&typeof r=="string"&&r){var g=gn(r);g='link[rel="'+a+'"][href="'+g+'"]',typeof l=="string"&&(g+='[crossorigin="'+l+'"]'),L0.has(g)||(L0.add(g),a={rel:a,crossOrigin:l,href:r},c.querySelector(g)===null&&(r=c.createElement("link"),Dt(r,"link",a),Tt(r),c.head.appendChild(r)))}}function BA(a){hs.D(a),k0("dns-prefetch",a,null)}function FA(a,r){hs.C(a,r),k0("preconnect",a,r)}function $A(a,r,l){hs.L(a,r,l);var c=Ar;if(c&&a&&r){var g='link[rel="preload"][as="'+gn(r)+'"]';r==="image"&&l&&l.imageSrcSet?(g+='[imagesrcset="'+gn(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(g+='[imagesizes="'+gn(l.imageSizes)+'"]')):g+='[href="'+gn(a)+'"]';var v=g;switch(r){case"style":v=Er(a);break;case"script":v=Nr(a)}Tn.has(v)||(a=S({rel:"preload",href:r==="image"&&l&&l.imageSrcSet?void 0:a,as:r},l),Tn.set(v,a),c.querySelector(g)!==null||r==="style"&&c.querySelector(Vi(v))||r==="script"&&c.querySelector(zi(v))||(r=c.createElement("link"),Dt(r,"link",a),Tt(r),c.head.appendChild(r)))}}function HA(a,r){hs.m(a,r);var l=Ar;if(l&&a){var c=r&&typeof r.as=="string"?r.as:"script",g='link[rel="modulepreload"][as="'+gn(c)+'"][href="'+gn(a)+'"]',v=g;switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":v=Nr(a)}if(!Tn.has(v)&&(a=S({rel:"modulepreload",href:a},r),Tn.set(v,a),l.querySelector(g)===null)){switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(zi(v)))return}c=l.createElement("link"),Dt(c,"link",a),Tt(c),l.head.appendChild(c)}}}function GA(a,r,l){hs.S(a,r,l);var c=Ar;if(c&&a){var g=Ka(c).hoistableStyles,v=Er(a);r=r||"default";var b=g.get(v);if(!b){var M={loading:0,preload:null};if(b=c.querySelector(Vi(v)))M.loading=5;else{a=S({rel:"stylesheet",href:a,"data-precedence":r},l),(l=Tn.get(v))&&gf(a,l);var $=b=c.createElement("link");Tt($),Dt($,"link",a),$._p=new Promise(function(J,Z){$.onload=J,$.onerror=Z}),$.addEventListener("load",function(){M.loading|=1}),$.addEventListener("error",function(){M.loading|=2}),M.loading|=4,Hl(b,r,c)}b={type:"stylesheet",instance:b,count:1,state:M},g.set(v,b)}}}function VA(a,r){hs.X(a,r);var l=Ar;if(l&&a){var c=Ka(l).hoistableScripts,g=Nr(a),v=c.get(g);v||(v=l.querySelector(zi(g)),v||(a=S({src:a,async:!0},r),(r=Tn.get(g))&&yf(a,r),v=l.createElement("script"),Tt(v),Dt(v,"link",a),l.head.appendChild(v)),v={type:"script",instance:v,count:1,state:null},c.set(g,v))}}function zA(a,r){hs.M(a,r);var l=Ar;if(l&&a){var c=Ka(l).hoistableScripts,g=Nr(a),v=c.get(g);v||(v=l.querySelector(zi(g)),v||(a=S({src:a,async:!0,type:"module"},r),(r=Tn.get(g))&&yf(a,r),v=l.createElement("script"),Tt(v),Dt(v,"link",a),l.head.appendChild(v)),v={type:"script",instance:v,count:1,state:null},c.set(g,v))}}function U0(a,r,l,c){var g=(g=ue.current)?$l(g):null;if(!g)throw Error(s(446));switch(a){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(r=Er(l.href),l=Ka(g).hoistableStyles,c=l.get(r),c||(c={type:"style",instance:null,count:0,state:null},l.set(r,c)),c):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){a=Er(l.href);var v=Ka(g).hoistableStyles,b=v.get(a);if(b||(g=g.ownerDocument||g,b={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},v.set(a,b),(v=g.querySelector(Vi(a)))&&!v._p&&(b.instance=v,b.state.loading=5),Tn.has(a)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},Tn.set(a,l),v||jA(g,a,l,b.state))),r&&c===null)throw Error(s(528,""));return b}if(r&&c!==null)throw Error(s(529,""));return null;case"script":return r=l.async,l=l.src,typeof l=="string"&&r&&typeof r!="function"&&typeof r!="symbol"?(r=Nr(l),l=Ka(g).hoistableScripts,c=l.get(r),c||(c={type:"script",instance:null,count:0,state:null},l.set(r,c)),c):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,a))}}function Er(a){return'href="'+gn(a)+'"'}function Vi(a){return'link[rel="stylesheet"]['+a+"]"}function O0(a){return S({},a,{"data-precedence":a.precedence,precedence:null})}function jA(a,r,l,c){a.querySelector('link[rel="preload"][as="style"]['+r+"]")?c.loading=1:(r=a.createElement("link"),c.preload=r,r.addEventListener("load",function(){return c.loading|=1}),r.addEventListener("error",function(){return c.loading|=2}),Dt(r,"link",l),Tt(r),a.head.appendChild(r))}function Nr(a){return'[src="'+gn(a)+'"]'}function zi(a){return"script[async]"+a}function q0(a,r,l){if(r.count++,r.instance===null)switch(r.type){case"style":var c=a.querySelector('style[data-href~="'+gn(l.href)+'"]');if(c)return r.instance=c,Tt(c),c;var g=S({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return c=(a.ownerDocument||a).createElement("style"),Tt(c),Dt(c,"style",g),Hl(c,l.precedence,a),r.instance=c;case"stylesheet":g=Er(l.href);var v=a.querySelector(Vi(g));if(v)return r.state.loading|=4,r.instance=v,Tt(v),v;c=O0(l),(g=Tn.get(g))&&gf(c,g),v=(a.ownerDocument||a).createElement("link"),Tt(v);var b=v;return b._p=new Promise(function(M,$){b.onload=M,b.onerror=$}),Dt(v,"link",c),r.state.loading|=4,Hl(v,l.precedence,a),r.instance=v;case"script":return v=Nr(l.src),(g=a.querySelector(zi(v)))?(r.instance=g,Tt(g),g):(c=l,(g=Tn.get(v))&&(c=S({},l),yf(c,g)),a=a.ownerDocument||a,g=a.createElement("script"),Tt(g),Dt(g,"link",c),a.head.appendChild(g),r.instance=g);case"void":return null;default:throw Error(s(443,r.type))}else r.type==="stylesheet"&&(r.state.loading&4)===0&&(c=r.instance,r.state.loading|=4,Hl(c,l.precedence,a));return r.instance}function Hl(a,r,l){for(var c=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),g=c.length?c[c.length-1]:null,v=g,b=0;b<c.length;b++){var M=c[b];if(M.dataset.precedence===r)v=M;else if(v!==g)break}v?v.parentNode.insertBefore(a,v.nextSibling):(r=l.nodeType===9?l.head:l,r.insertBefore(a,r.firstChild))}function gf(a,r){a.crossOrigin==null&&(a.crossOrigin=r.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=r.referrerPolicy),a.title==null&&(a.title=r.title)}function yf(a,r){a.crossOrigin==null&&(a.crossOrigin=r.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=r.referrerPolicy),a.integrity==null&&(a.integrity=r.integrity)}var Gl=null;function B0(a,r,l){if(Gl===null){var c=new Map,g=Gl=new Map;g.set(l,c)}else g=Gl,c=g.get(l),c||(c=new Map,g.set(l,c));if(c.has(a))return c;for(c.set(a,null),l=l.getElementsByTagName(a),g=0;g<l.length;g++){var v=l[g];if(!(v[oi]||v[It]||a==="link"&&v.getAttribute("rel")==="stylesheet")&&v.namespaceURI!=="http://www.w3.org/2000/svg"){var b=v.getAttribute(r)||"";b=a+b;var M=c.get(b);M?M.push(v):c.set(b,[v])}}return c}function F0(a,r,l){a=a.ownerDocument||a,a.head.insertBefore(l,r==="title"?a.querySelector("head > title"):null)}function YA(a,r,l){if(l===1||r.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof r.precedence!="string"||typeof r.href!="string"||r.href==="")break;return!0;case"link":if(typeof r.rel!="string"||typeof r.href!="string"||r.href===""||r.onLoad||r.onError)break;switch(r.rel){case"stylesheet":return a=r.disabled,typeof r.precedence=="string"&&a==null;default:return!0}case"script":if(r.async&&typeof r.async!="function"&&typeof r.async!="symbol"&&!r.onLoad&&!r.onError&&r.src&&typeof r.src=="string")return!0}return!1}function $0(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}function JA(a,r,l,c){if(l.type==="stylesheet"&&(typeof c.media!="string"||matchMedia(c.media).matches!==!1)&&(l.state.loading&4)===0){if(l.instance===null){var g=Er(c.href),v=r.querySelector(Vi(g));if(v){r=v._p,r!==null&&typeof r=="object"&&typeof r.then=="function"&&(a.count++,a=Vl.bind(a),r.then(a,a)),l.state.loading|=4,l.instance=v,Tt(v);return}v=r.ownerDocument||r,c=O0(c),(g=Tn.get(g))&&gf(c,g),v=v.createElement("link"),Tt(v);var b=v;b._p=new Promise(function(M,$){b.onload=M,b.onerror=$}),Dt(v,"link",c),l.instance=v}a.stylesheets===null&&(a.stylesheets=new Map),a.stylesheets.set(l,r),(r=l.state.preload)&&(l.state.loading&3)===0&&(a.count++,l=Vl.bind(a),r.addEventListener("load",l),r.addEventListener("error",l))}}var vf=0;function KA(a,r){return a.stylesheets&&a.count===0&&jl(a,a.stylesheets),0<a.count||0<a.imgCount?function(l){var c=setTimeout(function(){if(a.stylesheets&&jl(a,a.stylesheets),a.unsuspend){var v=a.unsuspend;a.unsuspend=null,v()}},6e4+r);0<a.imgBytes&&vf===0&&(vf=62500*IA());var g=setTimeout(function(){if(a.waitingForImages=!1,a.count===0&&(a.stylesheets&&jl(a,a.stylesheets),a.unsuspend)){var v=a.unsuspend;a.unsuspend=null,v()}},(a.imgBytes>vf?50:800)+r);return a.unsuspend=l,function(){a.unsuspend=null,clearTimeout(c),clearTimeout(g)}}:null}function Vl(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)jl(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var zl=null;function jl(a,r){a.stylesheets=null,a.unsuspend!==null&&(a.count++,zl=new Map,r.forEach(XA,a),zl=null,Vl.call(a))}function XA(a,r){if(!(r.state.loading&4)){var l=zl.get(a);if(l)var c=l.get(null);else{l=new Map,zl.set(a,l);for(var g=a.querySelectorAll("link[data-precedence],style[data-precedence]"),v=0;v<g.length;v++){var b=g[v];(b.nodeName==="LINK"||b.getAttribute("media")!=="not all")&&(l.set(b.dataset.precedence,b),c=b)}c&&l.set(null,c)}g=r.instance,b=g.getAttribute("data-precedence"),v=l.get(b)||c,v===c&&l.set(null,g),l.set(b,g),this.count++,c=Vl.bind(this),g.addEventListener("load",c),g.addEventListener("error",c),v?v.parentNode.insertBefore(g,v.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(g,a.firstChild)),r.state.loading|=4}}var ji={$$typeof:O,Provider:null,Consumer:null,_currentValue:ae,_currentValue2:ae,_threadCount:0};function QA(a,r,l,c,g,v,b,M,$){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ii(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ii(0),this.hiddenUpdates=ii(null),this.identifierPrefix=c,this.onUncaughtError=g,this.onCaughtError=v,this.onRecoverableError=b,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=$,this.incompleteTransitions=new Map}function H0(a,r,l,c,g,v,b,M,$,J,Z,ne){return a=new QA(a,r,l,b,$,J,Z,ne,M),r=1,v===!0&&(r|=24),v=sn(3,null,null,r),a.current=v,v.stateNode=a,r=Xc(),r.refCount++,a.pooledCache=r,r.refCount++,v.memoizedState={element:c,isDehydrated:l,cache:r},ed(v),a}function G0(a){return a?(a=rr,a):rr}function V0(a,r,l,c,g,v){g=G0(g),c.context===null?c.context=g:c.pendingContext=g,c=Os(r),c.payload={element:l},v=v===void 0?null:v,v!==null&&(c.callback=v),l=qs(a,c,r),l!==null&&(Xt(l,a,r),Ti(l,a,r))}function z0(a,r){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var l=a.retryLane;a.retryLane=l!==0&&l<r?l:r}}function Sf(a,r){z0(a,r),(a=a.alternate)&&z0(a,r)}function j0(a){if(a.tag===13||a.tag===31){var r=ya(a,67108864);r!==null&&Xt(r,a,67108864),Sf(a,67108864)}}function Y0(a){if(a.tag===13||a.tag===31){var r=un();r=bt(r);var l=ya(a,r);l!==null&&Xt(l,a,r),Sf(a,r)}}var Yl=!0;function WA(a,r,l,c){var g=q.T;q.T=null;var v=j.p;try{j.p=2,wf(a,r,l,c)}finally{j.p=v,q.T=g}}function ZA(a,r,l,c){var g=q.T;q.T=null;var v=j.p;try{j.p=8,wf(a,r,l,c)}finally{j.p=v,q.T=g}}function wf(a,r,l,c){if(Yl){var g=_f(c);if(g===null)rf(a,r,c,Jl,l),K0(a,c);else if(tE(g,a,r,l,c))c.stopPropagation();else if(K0(a,c),r&4&&-1<eE.indexOf(a)){for(;g!==null;){var v=Ja(g);if(v!==null)switch(v.tag){case 3:if(v=v.stateNode,v.current.memoizedState.isDehydrated){var b=Nt(v.pendingLanes);if(b!==0){var M=v;for(M.pendingLanes|=2,M.entangledLanes|=2;b;){var $=1<<31-we(b);M.entanglements[1]|=$,b&=~$}$n(v),(Ve&6)===0&&(Rl=Fe()+500,Fi(0))}}break;case 31:case 13:M=ya(v,2),M!==null&&Xt(M,v,2),Pl(),Sf(v,2)}if(v=_f(c),v===null&&rf(a,r,c,Jl,l),v===g)break;g=v}g!==null&&c.stopPropagation()}else rf(a,r,c,null,l)}}function _f(a){return a=xc(a),xf(a)}var Jl=null;function xf(a){if(Jl=null,a=Ya(a),a!==null){var r=o(a);if(r===null)a=null;else{var l=r.tag;if(l===13){if(a=u(r),a!==null)return a;a=null}else if(l===31){if(a=d(r),a!==null)return a;a=null}else if(l===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;a=null}else r!==a&&(a=null)}}return Jl=a,null}function J0(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(da()){case Ga:return 2;case Oo:return 8;case Va:case cc:return 32;case ai:return 268435456;default:return 32}default:return 32}}var bf=!1,Ks=null,Xs=null,Qs=null,Yi=new Map,Ji=new Map,Ws=[],eE="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function K0(a,r){switch(a){case"focusin":case"focusout":Ks=null;break;case"dragenter":case"dragleave":Xs=null;break;case"mouseover":case"mouseout":Qs=null;break;case"pointerover":case"pointerout":Yi.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ji.delete(r.pointerId)}}function Ki(a,r,l,c,g,v){return a===null||a.nativeEvent!==v?(a={blockedOn:r,domEventName:l,eventSystemFlags:c,nativeEvent:v,targetContainers:[g]},r!==null&&(r=Ja(r),r!==null&&j0(r)),a):(a.eventSystemFlags|=c,r=a.targetContainers,g!==null&&r.indexOf(g)===-1&&r.push(g),a)}function tE(a,r,l,c,g){switch(r){case"focusin":return Ks=Ki(Ks,a,r,l,c,g),!0;case"dragenter":return Xs=Ki(Xs,a,r,l,c,g),!0;case"mouseover":return Qs=Ki(Qs,a,r,l,c,g),!0;case"pointerover":var v=g.pointerId;return Yi.set(v,Ki(Yi.get(v)||null,a,r,l,c,g)),!0;case"gotpointercapture":return v=g.pointerId,Ji.set(v,Ki(Ji.get(v)||null,a,r,l,c,g)),!0}return!1}function X0(a){var r=Ya(a.target);if(r!==null){var l=o(r);if(l!==null){if(r=l.tag,r===13){if(r=u(l),r!==null){a.blockedOn=r,ch(a.priority,function(){Y0(l)});return}}else if(r===31){if(r=d(l),r!==null){a.blockedOn=r,ch(a.priority,function(){Y0(l)});return}}else if(r===3&&l.stateNode.current.memoizedState.isDehydrated){a.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Kl(a){if(a.blockedOn!==null)return!1;for(var r=a.targetContainers;0<r.length;){var l=_f(a.nativeEvent);if(l===null){l=a.nativeEvent;var c=new l.constructor(l.type,l);_c=c,l.target.dispatchEvent(c),_c=null}else return r=Ja(l),r!==null&&j0(r),a.blockedOn=l,!1;r.shift()}return!0}function Q0(a,r,l){Kl(a)&&l.delete(r)}function nE(){bf=!1,Ks!==null&&Kl(Ks)&&(Ks=null),Xs!==null&&Kl(Xs)&&(Xs=null),Qs!==null&&Kl(Qs)&&(Qs=null),Yi.forEach(Q0),Ji.forEach(Q0)}function Xl(a,r){a.blockedOn===r&&(a.blockedOn=null,bf||(bf=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,nE)))}var Ql=null;function W0(a){Ql!==a&&(Ql=a,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Ql===a&&(Ql=null);for(var r=0;r<a.length;r+=3){var l=a[r],c=a[r+1],g=a[r+2];if(typeof c!="function"){if(xf(c||l)===null)continue;break}var v=Ja(l);v!==null&&(a.splice(r,3),r-=3,wd(v,{pending:!0,data:g,method:l.method,action:c},c,g))}}))}function Ir(a){function r($){return Xl($,a)}Ks!==null&&Xl(Ks,a),Xs!==null&&Xl(Xs,a),Qs!==null&&Xl(Qs,a),Yi.forEach(r),Ji.forEach(r);for(var l=0;l<Ws.length;l++){var c=Ws[l];c.blockedOn===a&&(c.blockedOn=null)}for(;0<Ws.length&&(l=Ws[0],l.blockedOn===null);)X0(l),l.blockedOn===null&&Ws.shift();if(l=(a.ownerDocument||a).$$reactFormReplay,l!=null)for(c=0;c<l.length;c+=3){var g=l[c],v=l[c+1],b=g[Vt]||null;if(typeof v=="function")b||W0(l);else if(b){var M=null;if(v&&v.hasAttribute("formAction")){if(g=v,b=v[Vt]||null)M=b.formAction;else if(xf(g)!==null)continue}else M=b.action;typeof M=="function"?l[c+1]=M:(l.splice(c,3),c-=3),W0(l)}}}function Z0(){function a(v){v.canIntercept&&v.info==="react-transition"&&v.intercept({handler:function(){return new Promise(function(b){return g=b})},focusReset:"manual",scroll:"manual"})}function r(){g!==null&&(g(),g=null),c||setTimeout(l,20)}function l(){if(!c&&!navigation.transition){var v=navigation.currentEntry;v&&v.url!=null&&navigation.navigate(v.url,{state:v.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var c=!1,g=null;return navigation.addEventListener("navigate",a),navigation.addEventListener("navigatesuccess",r),navigation.addEventListener("navigateerror",r),setTimeout(l,100),function(){c=!0,navigation.removeEventListener("navigate",a),navigation.removeEventListener("navigatesuccess",r),navigation.removeEventListener("navigateerror",r),g!==null&&(g(),g=null)}}}function Tf(a){this._internalRoot=a}Wl.prototype.render=Tf.prototype.render=function(a){var r=this._internalRoot;if(r===null)throw Error(s(409));var l=r.current,c=un();V0(l,c,a,r,null,null)},Wl.prototype.unmount=Tf.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var r=a.containerInfo;V0(a.current,2,null,a,null,null),Pl(),r[ja]=null}};function Wl(a){this._internalRoot=a}Wl.prototype.unstable_scheduleHydration=function(a){if(a){var r=uh();a={blockedOn:null,target:a,priority:r};for(var l=0;l<Ws.length&&r!==0&&r<Ws[l].priority;l++);Ws.splice(l,0,a),l===0&&X0(a)}};var ev=e.version;if(ev!=="19.2.0")throw Error(s(527,ev,"19.2.0"));j.findDOMNode=function(a){var r=a._reactInternals;if(r===void 0)throw typeof a.render=="function"?Error(s(188)):(a=Object.keys(a).join(","),Error(s(268,a)));return a=f(r),a=a!==null?y(a):null,a=a===null?null:a.stateNode,a};var sE={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:q,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Zl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Zl.isDisabled&&Zl.supportsFiber)try{fa=Zl.inject(sE),Ut=Zl}catch{}}return Qi.createRoot=function(a,r){if(!i(a))throw Error(s(299));var l=!1,c="",g=oy,v=ly,b=uy;return r!=null&&(r.unstable_strictMode===!0&&(l=!0),r.identifierPrefix!==void 0&&(c=r.identifierPrefix),r.onUncaughtError!==void 0&&(g=r.onUncaughtError),r.onCaughtError!==void 0&&(v=r.onCaughtError),r.onRecoverableError!==void 0&&(b=r.onRecoverableError)),r=H0(a,1,!1,null,null,l,c,null,g,v,b,Z0),a[ja]=r.current,af(a),new Tf(r)},Qi.hydrateRoot=function(a,r,l){if(!i(a))throw Error(s(299));var c=!1,g="",v=oy,b=ly,M=uy,$=null;return l!=null&&(l.unstable_strictMode===!0&&(c=!0),l.identifierPrefix!==void 0&&(g=l.identifierPrefix),l.onUncaughtError!==void 0&&(v=l.onUncaughtError),l.onCaughtError!==void 0&&(b=l.onCaughtError),l.onRecoverableError!==void 0&&(M=l.onRecoverableError),l.formState!==void 0&&($=l.formState)),r=H0(a,1,!0,r,l??null,c,g,$,v,b,M,Z0),r.context=G0(null),l=r.current,c=un(),c=bt(c),g=Os(c),g.callback=null,qs(l,g,c),l=c,r.current.lanes=l,Is(r,l),$n(r),a[ja]=r.current,af(a),new Wl(r)},Qi.version="19.2.0",Qi}var cv;function pE(){if(cv)return Ef.exports;cv=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Ef.exports=fE(),Ef.exports}var mE=pE();const hE=Wp(mE);function gE(t,e){if(t==null)return{};var n=yE(t,e),s,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)s=o[i],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(n[s]=t[s])}return n}function yE(t,e){if(t==null)return{};var n={},s=Object.keys(t),i,o;for(o=0;o<s.length;o++)i=s[o],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}function Cu(){return Cu=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},Cu.apply(this,arguments)}function dv(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,s)}return n}function Wi(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?dv(Object(n),!0).forEach(function(s){vE(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):dv(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}function vE(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const SE={breakpointCols:void 0,className:void 0,columnClassName:void 0,children:void 0,columnAttrs:void 0,column:void 0},Mf=2;class E_ extends ws.Component{constructor(e){super(e),this.reCalculateColumnCount=this.reCalculateColumnCount.bind(this),this.reCalculateColumnCountDebounce=this.reCalculateColumnCountDebounce.bind(this);let n;this.props.breakpointCols&&this.props.breakpointCols.default?n=this.props.breakpointCols.default:n=parseInt(this.props.breakpointCols)||Mf,this.state={columnCount:n}}componentDidMount(){this.reCalculateColumnCount(),window&&window.addEventListener("resize",this.reCalculateColumnCountDebounce)}componentDidUpdate(){this.reCalculateColumnCount()}componentWillUnmount(){window&&window.removeEventListener("resize",this.reCalculateColumnCountDebounce)}reCalculateColumnCountDebounce(){if(!window||!window.requestAnimationFrame){this.reCalculateColumnCount();return}window.cancelAnimationFrame&&window.cancelAnimationFrame(this._lastRecalculateAnimationFrame),this._lastRecalculateAnimationFrame=window.requestAnimationFrame(()=>{this.reCalculateColumnCount()})}reCalculateColumnCount(){const e=window&&window.innerWidth||1/0;let n=this.props.breakpointCols;typeof n!="object"&&(n={default:parseInt(n)||Mf});let s=1/0,i=n.default||Mf;for(let o in n){const u=parseInt(o);u>0&&e<=u&&u<s&&(s=u,i=n[o])}i=Math.max(1,parseInt(i)||1),this.state.columnCount!==i&&this.setState({columnCount:i})}itemsInColumns(){const e=this.state.columnCount,n=new Array(e),s=ws.Children.toArray(this.props.children);for(let i=0;i<s.length;i++){const o=i%e;n[o]||(n[o]=[]),n[o].push(s[i])}return n}renderColumns(){const{column:e,columnAttrs:n={},columnClassName:s}=this.props,i=this.itemsInColumns(),o=`${100/i.length}%`;let u=s;u&&typeof u!="string"&&(this.logDeprecated('The property "columnClassName" requires a string'),typeof u>"u"&&(u="my-masonry-grid_column"));const d=Wi(Wi(Wi({},e),n),{},{style:Wi(Wi({},n.style),{},{width:o}),className:u});return i.map((m,f)=>ws.createElement("div",Cu({},d,{key:f}),m))}logDeprecated(e){console.error("[Masonry]",e)}render(){const e=this.props,{children:n,breakpointCols:s,columnClassName:i,columnAttrs:o,column:u,className:d}=e,m=gE(e,["children","breakpointCols","columnClassName","columnAttrs","column","className"]);let f=d;return typeof d!="string"&&(this.logDeprecated('The property "className" requires a string'),typeof d>"u"&&(f="my-masonry-grid")),ws.createElement("div",Cu({},m,{className:f}),this.renderColumns())}}E_.defaultProps=SE;const Or=["#4e79a7","#f28e2c","#e15759","#76b7b2","#59a14f","#edc949","#af7aa1","#ff9da7","#9c755f","#bab0ab"],Rr=Or.map(t=>`${t}B3`),eu=Or.map(t=>`${t}80`),wE="#3b82f6",_E="#2563eb",fv="rgba(107, 114, 128, 0.2)",tu="rgba(107, 114, 128, 0.5)";let pv=!1;const xE=re.forwardRef(({chartType:t,data:e,plan:n,selectedIndices:s,onElementClick:i,onZoomChange:o,disableAnimation:u},d)=>{const m=re.useRef(null),f=re.useRef(null);return typeof Chart<"u"&&typeof ChartZoom<"u"&&!pv&&(Chart.register(ChartZoom),pv=!0),re.useImperativeHandle(d,()=>({resetZoom:()=>{var y;(y=f.current)==null||y.resetZoom()}})),re.useEffect(()=>{if(!m.current||!n)return;f.current&&f.current.destroy();const y=m.current.getContext("2d");if(!y)return;const{groupByColumn:S,valueColumn:_,xValueColumn:T,yValueColumn:C}=n,N=_||"count",E=s.length>0,L=P=>E?e.map((A,k)=>s.includes(k)?wE:fv):P,B=P=>E?e.map((A,k)=>s.includes(k)?_E:tu):P,O=P=>{if(!P||!P.scales||!P.scales.x)return!1;const A=P.getInitialScaleBounds().x,k={min:P.scales.x.min,max:P.scales.x.max};return A.min!==k.min||A.max!==k.max},x={maintainAspectRatio:!1,responsive:!0,animation:u?{duration:0}:void 0,onClick:(P,A)=>{A.length>0&&i(A[0].index,P)},plugins:{legend:{display:!1},tooltip:{backgroundColor:"#ffffff",titleColor:"#1e293b",bodyColor:"#475569",borderColor:"#e2e8f0",borderWidth:1,titleFont:{weight:"bold"},bodyFont:{size:13},padding:10}},scales:{x:{ticks:{color:"#64748b",callback:function(P){const A=this.getLabelForValue(Number(P));return typeof A=="string"&&A.length>30?A.substring(0,27)+"...":A}},grid:{color:"#e2e8f0"}},y:{ticks:{color:"#64748b"},grid:{color:"#e2e8f0"}}}},I={pan:{enabled:!0,mode:"xy",onPanComplete:({chart:P})=>o(O(P))},zoom:{wheel:{enabled:!1},pinch:{enabled:!0},mode:"xy",onZoomComplete:({chart:P})=>o(O(P))}},D=S?e.map(P=>P[S]):[],R=e.map(P=>P[N]);switch(t){case"bar":f.current=new Chart(y,{type:"bar",data:{labels:D,datasets:[{label:N,data:R,backgroundColor:L(eu),borderColor:B(Rr),borderWidth:1}]},options:{...x}});break;case"line":f.current=new Chart(y,{type:"line",data:{labels:D,datasets:[{label:N,data:R,fill:!1,borderColor:E?tu:Or[0],pointBackgroundColor:L([Or[0]]),pointBorderColor:B([Rr[0]]),pointRadius:E?5:3,pointHoverRadius:7,tension:.1}]},options:{...x,plugins:{...x.plugins,zoom:I}}});break;case"pie":case"doughnut":f.current=new Chart(y,{type:t,data:{labels:D,datasets:[{label:N,data:R,backgroundColor:L(eu),borderColor:B(Rr),borderWidth:1,offset:E?e.map((U,z)=>s.includes(z)?20:0):0}]},options:{...x,scales:{x:{display:!1},y:{display:!1}}}});break;case"scatter":if(!T||!C)break;const P=e.map(U=>({x:U[T],y:U[C]}));f.current=new Chart(y,{type:"scatter",data:{datasets:[{label:`${C} vs ${T}`,data:P,backgroundColor:L(eu),borderColor:B(Rr),borderWidth:1.5,pointRadius:E?e.map((U,z)=>s.includes(z)?7:4):5,pointHoverRadius:E?e.map((U,z)=>s.includes(z)?9:6):7}]},options:{...x,scales:{x:{...x.scales.x,title:{display:!0,text:T,color:"#64748b"}},y:{...x.scales.y,title:{display:!0,text:C,color:"#64748b"}}},plugins:{...x.plugins,zoom:I}}});break;case"combo":if(!S||!N||!n.secondaryValueColumn)break;const A=n.secondaryValueColumn,k=e.map(U=>U[N]),F=e.map(U=>U[A]);f.current=new Chart(y,{type:"bar",data:{labels:D,datasets:[{type:"bar",label:N,data:k,backgroundColor:L(eu),borderColor:B(Rr),borderWidth:1,yAxisID:"y"},{type:"line",label:A,data:F,fill:!1,borderColor:E?tu:Or[1],pointBackgroundColor:E?fv:Or[1],pointBorderColor:E?tu:Rr[1],pointRadius:E?5:3,pointHoverRadius:7,tension:.1,yAxisID:"y1"}]},options:{...x,scales:{...x.scales,y:{type:"linear",display:!0,position:"left",ticks:{color:"#64748b"},grid:{color:"#e2e8f0"},title:{display:!0,text:N,color:"#64748b"}},y1:{type:"linear",display:!0,position:"right",ticks:{color:"#64748b"},grid:{drawOnChartArea:!1},title:{display:!0,text:A,color:"#64748b"}}}}});break}return()=>{f.current&&f.current.destroy()}},[t,e,n,s,i,o,u]),w.jsx("canvas",{ref:m})}),Au=(t,e=0,n)=>{if(t==null)return"";if(typeof t=="number")return mv(t,n);if(typeof t=="string"){if(n&&(n==="currency"||n==="percentage"||n==="number")){const s=Number(t);if(!Number.isNaN(s))return mv(s,n)}return t}if(typeof t=="boolean")return t?"true":"false";if(Array.isArray(t))return e>=1?`[${t.length} items]`:t.map(s=>Au(s,e+1,n)).join(", ");if(typeof t=="object"){const s=Object.entries(t);return s.length===0?"{}":e>=1?`{${s.length} keys}`:s.map(([i,o])=>`${i}: ${Au(o,e+1,n)}`).join("; ")}return String(t)},mv=(t,e)=>{const n=e==null?void 0:e.toLowerCase();return n==="currency"?t.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):n==="percentage"?`${t.toFixed(2)}%`:t.toLocaleString(void 0,{maximumFractionDigits:2})};class N_ extends Error{constructor(e,n="unknown"){super(e),this.name="PlanExecutionError",this.code=n}}const bE=t=>typeof t=="string"&&t.startsWith("=")?`'${t}`:t,mn=t=>{if(t==null)return null;let e=String(t).trim();if(e==="")return null;let n=!1;e.startsWith("(")&&e.endsWith(")")&&(e=e.substring(1,e.length-1),n=!0),e=e.replace(/[$\s%]/g,"");const s=e.lastIndexOf(","),i=e.lastIndexOf(".");s>i?e=e.replace(/\./g,"").replace(",","."):e=e.replace(/,/g,"");const o=parseFloat(e);return isNaN(o)?null:n?-o:o},TE=t=>typeof t!="string"||!t?!1:!isNaN(new Date(t).getTime())&&/[0-9]{1,4}[-/][0-9]{1,2}[-/][0-9]{1,4}/.test(t),I_=/^Q([1-4])(?:\s*\/?\s*('?\d{2,4}))?$/i,R_={january:1,jan:1,february:2,feb:2,march:3,mar:3,april:4,apr:4,may:5,june:6,jun:6,july:7,jul:7,august:8,aug:8,september:9,sep:9,october:10,oct:10,november:11,nov:11,december:12,dec:12},M_={monday:1,mon:1,tuesday:2,tue:2,wednesday:3,wed:3,thursday:4,thu:4,friday:5,fri:5,saturday:6,sat:6,sunday:7,sun:7},hv=(t,e)=>{const n=String(t).toLowerCase().trim();switch(e){case"quarter":const s=n.match(I_);if(s){const i=parseInt(s[1],10);let o=0;if(s[2]){const u=s[2].replace("'","");o=parseInt(u,10),u.length===2&&(o+=o>50?1900:2e3)}return o*10+i}return 1/0;case"month":return R_[n]||1/0;case"day":return M_[n]||1/0}return 1/0},gv=(t,e)=>{if(t.length<2)return t;const n=t.slice(0,10).map(m=>String(m[e]).toLowerCase().trim());let s=null;const i=n.filter(m=>I_.test(m)).length,o=n.filter(m=>R_[m]!==void 0).length,u=n.filter(m=>M_[m]!==void 0).length,d=n.filter(TE).length;if(i/n.length>=.5)s="quarter";else if(o/n.length>=.5)s="month";else if(u/n.length>=.5)s="day";else if(d/n.length>=.5)return[...t].sort((m,f)=>new Date(String(m[e])).getTime()-new Date(String(f[e])).getTime());return s?[...t].sort((m,f)=>{const y=hv(String(m[e]),s),S=hv(String(f[e]),s);return y-S}):null},P_=(t,e,n,s)=>{if(t.length<=s)return t;const i=[...t].sort((d,m)=>(Number(m[n])||0)-(Number(d[n])||0)),o=i.slice(0,s),u=i.slice(s);if(u.length>0){const d=u.reduce((f,y)=>f+(Number(y[n])||0),0),m={[e]:"Others",[n]:d};return[...o,m]}return o},CE=t=>new Promise((e,n)=>{Papa.parse(t,{header:!1,skipEmptyLines:!0,worker:!0,complete:s=>{if(s.data.length===0){e({fileName:t.name,data:[]});return}const i=s.data.reduce((d,m)=>Math.max(d,m.length),0),o=Array.from({length:i},(d,m)=>`column_${m+1}`),u=s.data.map(d=>{const m={};return o.forEach((f,y)=>{const S=d[y]!==void 0?d[y]:"";m[f]=bE(String(S))}),m});e({fileName:t.name,data:u})},error:s=>{n(s)}})}),yo=t=>{if(!t||t.length===0)return[];const e=Object.keys(t[0]),n=[];for(const s of e){let i=!0;const o=t.map(f=>f[s]);let u=0;const d=t.length,m=o.filter(f=>f!==null&&String(f).trim()!=="").length;for(const f of o){const y=mn(f);if(f!==null&&String(f).trim()!==""){if(y===null){i=!1;break}u++}}if(i&&u>0){const f=o.map(mn).filter(S=>S!==null),y=d>0?f.length/d:0;n.push({name:s,type:"numerical",valueRange:[Math.min(...f),Math.max(...f)],missingPercentage:(1-y)*100,sampleSize:d,nonNullCount:m,numericSampleCount:f.length,numericSampleRatio:y})}else{const f=new Set(o.map(String));n.push({name:s,type:"categorical",uniqueValues:f.size,missingPercentage:d===0?0:o.filter(y=>y===null||String(y).trim()==="").length/d*100,sampleSize:d,nonNullCount:m})}}return n},D_=t=>t?String(t).replace(/,(?=-?\d)/g,"|").split("|"):[],Ra=t=>t==null||t===""?"__NULL__":String(t),yv=(t,e)=>{const n=t.map(i=>typeof i=="number"?i:mn(i)).filter(i=>typeof i=="number");if(n.length===0)return 0;const s=n.reduce((i,o)=>i+o,0);switch(e){case"avg":return s/n.length;case"count":return n.length;default:return s}},L_=()=>({parseNumber:mn,splitNumericString:D_,groupBy:(t=[],e)=>{const n=typeof e=="function"?e:i=>i[e],s={};return t.forEach(i=>{const o=Ra(n(i));s[o]||(s[o]=[]),s[o].push(i)}),Object.entries(s).map(([i,o])=>({key:i==="__NULL__"?null:i,rows:o,count:o.length}))},pivot:(t=[],e,n,s,i="sum")=>{const o=new Set,u=new Map;t.forEach(f=>{const y=Ra(f[e]),S=Ra(f[n]);o.add(S);const _=u.get(y)??{[e]:f[e]},T=_[S]??[];T.push(f[s]),_[S]=T,u.set(y,_)});const d=typeof i=="function"?i:f=>yv(f,i),m=Array.from(o);return Array.from(u.values()).map(f=>{const y={...f};return m.forEach(S=>{const _=Array.isArray(y[S])?y[S]:[];y[S]=d(_)}),y})},join:(t=[],e=[],n)=>{if(!(n!=null&&n.leftKey))throw new Error("join requires a leftKey.");const s=n.how||"inner",i=n.rightKey??n.leftKey,o=new Map;e.forEach(f=>{const y=Ra(f[i]),S=o.get(y)??[];S.push(f),o.set(y,S)});const u=(f,y)=>f&&y?{...y,...f}:f?{...f}:y?{...y}:{},d=[],m=new Set;return t.forEach(f=>{const y=Ra(f[n.leftKey]),S=o.get(y);S&&S.length>0?S.forEach(_=>{m.add(_),d.push(u(f,_))}):(s==="left"||s==="full")&&d.push(u(f,null))}),(s==="right"||s==="full")&&e.forEach(f=>{if(!m.has(f)){if(s==="right")d.push(u(null,f));else if(s==="full"){const y=Ra(f[i]);t.filter(_=>Ra(_[n.leftKey])===y).length===0&&d.push(u(null,f))}}}),d},rollingWindow:(t=[],e,n={column:"value",op:"avg"})=>{if(!Array.isArray(t)||e<=0)return[];const s=typeof n=="function"?n:i=>{const o=i.map(u=>u[n.column]);return yv(o,n.op??"avg")};return t.map((i,o)=>{const u=Math.max(0,o-e+1),d=t.slice(u,o+1);return{index:o,start:u,end:o,value:s(d,o)}})}}),vv=t=>t==null?"":typeof t=="number"?t.toString():String(t),AE=(t,e)=>{const n=Object.keys(t),s=Object.keys(e);if(n.length!==s.length)return!1;for(const i of n)if(!Object.prototype.hasOwnProperty.call(e,i)||vv(t[i])!==vv(e[i]))return!1;return!0},EE=t=>{const e=t.trim(),n=o=>`const __transform = ${o}; return __transform(data, _util);`,s=/^(?:async\s+)?function\s*(?:[\w$]+)?\s*\(/i,i=/^(?:async\s*)?\(?[\w\s,$]*\)?\s*=>/;return s.test(e)||i.test(e)?n(e):t},k_=(t,e)=>{try{const n=L_(),s=EE(e),o=new Function("data","_util",s)(t,n);if(!Array.isArray(o))throw console.error("AI-generated transform function returned a non-array value. This is likely due to a missing 'return' statement in the generated code.",{returnedValue:o,generatedCode:e}),new Error("AI-generated transform function did not return an array.");if(o.length>0&&typeof o[0]!="object")throw new Error("AI-generated transform function did not return an array of objects.");const u=o,d=t.length,m=u.length,f=d>m?d-m:0,y=m>d?m-d:0,S=Math.min(d,m);let _=0;for(let C=0;C<S;C++)AE(t[C],u[C])||_++;if(!(f>0||y>0||_>0))throw new Error("AI-generated data transformation produced no observable changes. Please refine the instruction or regenerate the code.");return{data:u,meta:{rowsBefore:d,rowsAfter:m,addedRows:y,removedRows:f,modifiedRows:_}}}catch(n){throw console.error("Error executing AI-generated JavaScript:",n),new Error(`AI-generated data transformation failed: ${n instanceof Error?n.message:String(n)}`)}},U_=(t,e)=>{try{const n=L_(),i=new Function("data","_util",e)(t,n);if(!Array.isArray(i))throw new Error("AI-generated filter function did not return an array.");return i}catch(n){throw console.error("Error executing AI-generated JavaScript filter:",n),new Error(`AI-generated data filter failed: ${n instanceof Error?n.message:String(n)}`)}},Sv=t=>{if(t==null)return null;const e=String(t).trim();return e===""?null:e},NE=(t,e)=>{if(!(e!=null&&e.column)||!Array.isArray(e.values)||e.values.length===0)return t;const n=new Set(e.values.map(Sv).filter(s=>s!==null));return n.size===0?t:t.filter(s=>{const i=Sv(s[e.column]);return i!==null&&n.has(i)})},Pf=(t,e)=>{if(t.length===0)return 0;switch(e){case"sum":return t.reduce((s,i)=>s+i,0);case"count":return t.length;case"avg":return t.reduce((s,i)=>s+i,0)/t.length;default:throw new Error(`Unsupported aggregation type: ${e}`)}},O_=(t,e)=>{const n=NE(t.data,e.rowFilter);if(e.rowFilter&&e.rowFilter.column&&Array.isArray(e.rowFilter.values)&&e.rowFilter.values.length>0&&n.length===0){const f=e.rowFilter.values.map(y=>`"${String(y)}"`).join(", ");throw new N_(`No rows matched the filter ${e.rowFilter.column}  ${f}. Remove or adjust the filter and try again.`,"no_rows")}if(e.chartType==="scatter"){const{xValueColumn:f,yValueColumn:y}=e;if(!f||!y)throw new Error("Scatter plot plan is missing xValueColumn or yValueColumn.");return n.map(S=>({[f]:mn(S[f]),[y]:mn(S[y])})).filter(S=>S[f]!==null&&S[y]!==null)}if(e.chartType==="combo"){const{groupByColumn:f,valueColumn:y,aggregation:S,secondaryValueColumn:_,secondaryAggregation:T}=e;if(!f||!y||!S||!_||!T)throw new Error("Combo chart plan is missing required aggregation fields.");const C={};n.forEach(L=>{const B=String(L[f]);if(B==="undefined"||B==="null")return;C[B]||(C[B]={primaryValues:[],secondaryValues:[]});const O=mn(L[y]);O!==null&&C[B].primaryValues.push(O);const x=mn(L[_]);x!==null&&C[B].secondaryValues.push(x)});const N=Object.keys(C).filter(L=>C[L].primaryValues.length>0||C[L].secondaryValues.length>0).map(L=>{const B=Pf(C[L].primaryValues,S),O=Pf(C[L].secondaryValues,T);return{[f]:L,[y]:B,[_]:O}});return gv(N,f)||N.sort((L,B)=>(Number(B[y])||0)-(Number(L[y])||0))}const{groupByColumn:s,valueColumn:i,aggregation:o}=e;if(!s||!o)throw new Error("Analysis plan is missing groupByColumn or aggregation type for non-scatter chart.");const u={};n.forEach(f=>{const y=String(f[s]);if(!(y==="undefined"||y==="null"))if(u[y]||(u[y]=[]),i){const S=mn(f[i]);S!==null&&u[y].push(S)}else o==="count"&&u[y].push(1)});const d=Object.keys(u).filter(f=>u[f].length>0).map(f=>{const y=Pf(u[f],o),S=i||"count";return{[s]:f,[S]:y}}),m=gv(d,s);if(m)return m;{const f=i||"count";return d.sort((y,S)=>(Number(S[f])||0)-(Number(y[f])||0))}},IE=new Set(["number","currency","percentage"]),Eu=({data:t,schema:e})=>{if(!t||t.length===0)return w.jsx("p",{className:"text-slate-500",children:"No data to display."});const n=(e==null?void 0:e.map(u=>u.name))??Object.keys(t[0]),s=re.useMemo(()=>{if(!e)return new Map;const u=new Map;return e.forEach(d=>u.set(d.name,d.type)),u},[e]),i=re.useMemo(()=>{for(const u of n){const d=(s.get(u)??"").toLowerCase();if(IE.has(d))return u}return null},[n,s]),o=re.useMemo(()=>i?[...t].sort((u,d)=>{const m=mn(u[i]),f=mn(d[i]);return m===f?0:m==null?1:f==null?-1:f-m}):t,[t,i]);return w.jsx("div",{className:"w-full text-sm",children:w.jsxs("table",{className:"w-full text-left",children:[w.jsx("thead",{className:"bg-slate-100 text-slate-600",children:w.jsx("tr",{children:n.map(u=>w.jsx("th",{className:"p-2 font-semibold",children:u},u))})}),w.jsx("tbody",{className:"bg-white",children:o.map((u,d)=>w.jsx("tr",{className:"border-b border-slate-200 last:border-b-0",children:n.map(m=>w.jsx("td",{className:"p-2 text-slate-700",children:Au(u[m],0,s.get(m))},`${d}-${m}`))},d))})]})})},q_=async(t,e)=>{try{const n=await htmlToImage.toPng(t,{backgroundColor:"#ffffff",pixelRatio:2}),s=document.createElement("a");s.download=`${e.replace(/ /g,"_")}.png`,s.href=n,s.click()}catch(n){console.error("Error exporting to PNG:",n)}},B_=(t,e)=>{try{const n=Papa.unparse(t),s=new Blob([n],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");i.href=URL.createObjectURL(s),i.setAttribute("download",`${e.replace(/ /g,"_")}.csv`),i.click()}catch(n){console.error("Error exporting to CSV:",n)}},F_=async(t,e,n,s)=>{try{const i=t.querySelector("canvas");if(!i)throw new Error("Chart canvas not found for export.");const o=i.toDataURL("image/png"),u=`
      <table border="1" style="border-collapse: collapse; width: 100%; font-family: sans-serif; color: #333;">
        <thead>
          <tr style="background-color: #f2f2f2;">
            ${Object.keys(n[0]||{}).map(S=>`<th style="padding: 8px;">${S}</th>`).join("")}
          </tr>
        </thead>
        <tbody>
          ${n.map(S=>`
            <tr>
              ${Object.values(S).map(_=>`<td style="padding: 8px;">${_}</td>`).join("")}
            </tr>
          `).join("")}
        </tbody>
      </table>
    `,d=s.replace(/\n/g,"<br>").replace("---","<hr>"),m=`
      <!DOCTYPE html>
      <html lang="en">
        <head>
          <meta charset="UTF-8">
          <title>${e}</title>
          <style> body { font-family: sans-serif; line-height: 1.6; padding: 20px; } h1, h2 { color: #111827; } .card { border: 1px solid #ddd; padding: 20px; border-radius: 8px; margin-bottom: 20px; } </style>
        </head>
        <body>
          <h1>Analysis Report: ${e}</h1>
          <div class="card">
            <h2>Chart</h2>
            <img src="${o}" alt="Chart for ${e}" style="max-width: 100%; border: 1px solid #ddd; border-radius: 4px;">
          </div>
          <div class="card">
            <h2>AI Summary</h2>
            <p>${d}</p>
          </div>
          <div class="card">
            <h2>Data</h2>
            ${u}
          </div>
          <p style="font-size: 0.8em; color: #888;">Generated by CSV Data Analysis Agent on ${new Date().toLocaleString()}</p>
        </body>
      </html>
    `,f=new Blob([m],{type:"text/html;charset=utf-8;"}),y=document.createElement("a");y.href=URL.createObjectURL(f),y.setAttribute("download",`Report_${e.replace(/ /g,"_")}.html`),y.click()}catch(i){console.error("Error exporting to HTML:",i)}},RE=t=>{try{const e=new Blob([JSON.stringify(t,null,2)],{type:"application/json;charset=utf-8;"}),n=document.createElement("a");n.href=URL.createObjectURL(e),n.setAttribute("download",`${t.plan.title.replace(/ /g,"_")}.json`),n.click()}catch(e){console.error("Error exporting JSON:",e)}},ME=({type:t})=>{switch(t){case"bar":return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:w.jsx("path",{d:"M2 10a1 1 0 011-1h1a1 1 0 011 1v4a1 1 0 01-1 1H3a1 1 0 01-1-1v-4zM8 8a1 1 0 011-1h1a1 1 0 011 1v6a1 1 0 01-1 1H9a1 1 0 01-1-1V8zM14 4a1 1 0 011-1h1a1 1 0 011 1v10a1 1 0 01-1 1h-1a1 1 0 01-1-1V4z"})});case"line":return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:w.jsx("path",{fillRule:"evenodd",d:"M3 3a1 1 0 000 2v8a1 1 0 001 1h12a1 1 0 100-2H5V3a1 1 0 00-2 0zm12.293 4.293a1 1 0 011.414 0l2 2a1 1 0 01-1.414 1.414L15 8.414l-2.293 2.293a1 1 0 01-1.414 0l-2-2a1 1 0 111.414-1.414L12 7.586l1.293-1.293z",clipRule:"evenodd"})});case"pie":return w.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:[w.jsx("path",{d:"M2 10a8 8 0 018-8v8h8a8 8 0 11-16 0z"}),w.jsx("path",{d:"M12 2.252A8.014 8.014 0 0117.748 8H12V2.252z"})]});case"doughnut":return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:w.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM7 10a3 3 0 116 0 3 3 0 01-6 0z",clipRule:"evenodd"})});case"scatter":return w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:w.jsx("path",{d:"M5 3a2 2 0 100 4 2 2 0 000-4zM5 13a2 2 0 100 4 2 2 0 000-4zM15 3a2 2 0 100 4 2 2 0 000-4zM15 13a2 2 0 100 4 2 2 0 000-4zM8 8a2 2 0 100 4 2 2 0 000-4zM12 8a2 2 0 100 4 2 2 0 000-4z"})});case"combo":return w.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:[w.jsx("path",{opacity:"0.6",d:"M2 10a1 1 0 011-1h1a1 1 0 011 1v4a1 1 0 01-1 1H3a1 1 0 01-1-1v-4zM8 8a1 1 0 011-1h1a1 1 0 011 1v6a1 1 0 01-1 1H9a1 1 0 01-1-1V8zM14 4a1 1 0 011-1h1a1 1 0 011 1v10a1 1 0 01-1 1h-1a1 1 0 01-1-1V4z"}),w.jsx("path",{fillRule:"evenodd",d:"M3.293 11.293a1 1 0 011.414 0L8 14.586l2.293-2.293a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 15.414l-2.293 2.293a1 1 0 01-1.414 0L3.293 12.707a1 1 0 010-1.414z",clipRule:"evenodd"})]});default:return null}},PE=["bar","line","pie","doughnut","scatter","combo"],DE=({currentType:t,onChange:e})=>w.jsx("div",{className:"flex items-center space-x-1 bg-slate-200 p-1 rounded-md",children:PE.map(n=>w.jsx("button",{onClick:()=>e(n),title:`Switch to ${n} chart`,className:`p-1 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed ${t===n?"bg-blue-600 text-white":"text-slate-500 hover:bg-slate-300 hover:text-slate-700"}`,children:w.jsx(ME,{type:n})},n))}),wv=["#4e79a7","#f28e2c","#e15759","#76b7b2","#59a14f","#edc949","#af7aa1","#ff9da7","#9c755f","#bab0ab"],LE=({data:t,total:e,groupByKey:n,valueKey:s,hiddenLabels:i,onLabelClick:o})=>{const u=d=>typeof d=="number"?d.toLocaleString(void 0,{maximumFractionDigits:2}):d;return w.jsx("div",{className:"text-sm space-y-1 max-h-48 overflow-y-auto pr-2",children:t.map((d,m)=>{const f=String(d[n]),y=Number(d[s])||0,S=e>0?(y/e*100).toFixed(1):"0.0",_=i.includes(f),T=wv[m%wv.length];return w.jsxs("button",{onClick:()=>o(f),className:`w-full flex items-center justify-between p-1.5 rounded-md transition-all duration-200 ${_?"opacity-50":"hover:bg-slate-100"}`,title:`Click to ${_?"show":"hide"} "${f}"`,children:[w.jsxs("div",{className:"flex items-center truncate mr-2",children:[w.jsx("span",{className:"w-3 h-3 rounded-sm mr-2 flex-shrink-0",style:{backgroundColor:_?"#9ca3af":T}}),w.jsx("span",{className:`truncate text-xs ${_?"line-through text-slate-400":"text-slate-700"}`,children:f})]}),w.jsxs("div",{className:"flex items-baseline ml-2 flex-shrink-0",children:[w.jsx("span",{className:`font-semibold text-xs ${_?"text-slate-400":"text-slate-800"}`,children:u(y)}),w.jsxs("span",{className:"text-xs text-slate-500 ml-1.5 w-12 text-right",children:["(",S,"%)"]})]})]},f)})})},kE="modulepreload",UE=function(t){return"/"+t},_v={},$u=function(e,n,s){let i=Promise.resolve();if(n&&n.length>0){let u=function(f){return Promise.all(f.map(y=>Promise.resolve(y).then(S=>({status:"fulfilled",value:S}),S=>({status:"rejected",reason:S}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),m=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));i=u(n.map(f=>{if(f=UE(f),f in _v)return;_v[f]=!0;const y=f.endsWith(".css"),S=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${f}"]${S}`))return;const _=document.createElement("link");if(_.rel=y?"stylesheet":kE,y||(_.as="script"),_.crossOrigin="",_.href=f,m&&_.setAttribute("nonce",m),document.head.appendChild(_),y)return new Promise((T,C)=>{_.addEventListener("load",T),_.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${f}`)))})}))}function o(u){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=u,window.dispatchEvent(d),!d.defaultPrevented)throw u}return i.then(u=>{for(const d of u||[])d.status==="rejected"&&o(d.reason);return e().catch(o)})},OE={},xv=t=>{let e;const n=new Set,s=(y,S)=>{const _=typeof y=="function"?y(e):y;if(!Object.is(_,e)){const T=e;e=S??(typeof _!="object"||_===null)?_:Object.assign({},e,_),n.forEach(C=>C(e,T))}},i=()=>e,m={setState:s,getState:i,getInitialState:()=>f,subscribe:y=>(n.add(y),()=>n.delete(y)),destroy:()=>{(OE?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},f=e=t(s,i,m);return m},qE=t=>t?xv(t):xv;var Df={exports:{}},Lf={},kf={exports:{}},Uf={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bv;function BE(){if(bv)return Uf;bv=1;var t=Eo();function e(S,_){return S===_&&(S!==0||1/S===1/_)||S!==S&&_!==_}var n=typeof Object.is=="function"?Object.is:e,s=t.useState,i=t.useEffect,o=t.useLayoutEffect,u=t.useDebugValue;function d(S,_){var T=_(),C=s({inst:{value:T,getSnapshot:_}}),N=C[0].inst,E=C[1];return o(function(){N.value=T,N.getSnapshot=_,m(N)&&E({inst:N})},[S,T,_]),i(function(){return m(N)&&E({inst:N}),S(function(){m(N)&&E({inst:N})})},[S]),u(T),T}function m(S){var _=S.getSnapshot;S=S.value;try{var T=_();return!n(S,T)}catch{return!0}}function f(S,_){return _()}var y=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?f:d;return Uf.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:y,Uf}var Tv;function FE(){return Tv||(Tv=1,kf.exports=BE()),kf.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Cv;function $E(){if(Cv)return Lf;Cv=1;var t=Eo(),e=FE();function n(f,y){return f===y&&(f!==0||1/f===1/y)||f!==f&&y!==y}var s=typeof Object.is=="function"?Object.is:n,i=e.useSyncExternalStore,o=t.useRef,u=t.useEffect,d=t.useMemo,m=t.useDebugValue;return Lf.useSyncExternalStoreWithSelector=function(f,y,S,_,T){var C=o(null);if(C.current===null){var N={hasValue:!1,value:null};C.current=N}else N=C.current;C=d(function(){function L(D){if(!B){if(B=!0,O=D,D=_(D),T!==void 0&&N.hasValue){var R=N.value;if(T(R,D))return x=R}return x=D}if(R=x,s(O,D))return R;var P=_(D);return T!==void 0&&T(R,P)?(O=D,R):(O=D,x=P)}var B=!1,O,x,I=S===void 0?null:S;return[function(){return L(y())},I===null?void 0:function(){return L(I())}]},[y,S,_,T]);var E=i(f,C[0],C[1]);return u(function(){N.hasValue=!0,N.value=E},[E]),m(E),E},Lf}var Av;function HE(){return Av||(Av=1,Df.exports=$E()),Df.exports}var GE=HE();const VE=Wp(GE),$_={},{useDebugValue:zE}=ws,{useSyncExternalStoreWithSelector:jE}=VE;let Ev=!1;const YE=t=>t;function JE(t,e=YE,n){($_?"production":void 0)!=="production"&&n&&!Ev&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Ev=!0);const s=jE(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,n);return zE(s),s}const Nv=t=>{($_?"production":void 0)!=="production"&&typeof t!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof t=="function"?qE(t):t,n=(s,i)=>JE(e,s,i);return Object.assign(n,e),n},KE=t=>t?Nv(t):Nv;/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let XE,QE;function WE(){return{geminiUrl:XE,vertexUrl:QE}}function ZE(t,e,n,s){var i,o;if(!(t!=null&&t.baseUrl)){const u=WE();return e?(i=u.vertexUrl)!==null&&i!==void 0?i:n:(o=u.geminiUrl)!==null&&o!==void 0?o:s}return t.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class As{}function de(t,e){const n=/\{([^}]+)\}/g;return t.replace(n,(s,i)=>{if(Object.prototype.hasOwnProperty.call(e,i)){const o=e[i];return o!=null?String(o):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function h(t,e,n){for(let o=0;o<e.length-1;o++){const u=e[o];if(u.endsWith("[]")){const d=u.slice(0,-2);if(!(d in t))if(Array.isArray(n))t[d]=Array.from({length:n.length},()=>({}));else throw new Error(`Value must be a list given an array path ${u}`);if(Array.isArray(t[d])){const m=t[d];if(Array.isArray(n))for(let f=0;f<m.length;f++){const y=m[f];h(y,e.slice(o+1),n[f])}else for(const f of m)h(f,e.slice(o+1),n)}return}else if(u.endsWith("[0]")){const d=u.slice(0,-3);d in t||(t[d]=[{}]);const m=t[d];h(m[0],e.slice(o+1),n);return}(!t[u]||typeof t[u]!="object")&&(t[u]={}),t=t[u]}const s=e[e.length-1],i=t[s];if(i!==void 0){if(!n||typeof n=="object"&&Object.keys(n).length===0||n===i)return;if(typeof i=="object"&&typeof n=="object"&&i!==null&&n!==null)Object.assign(i,n);else throw new Error(`Cannot set value for an existing key. Key: ${s}`)}else s==="_self"&&typeof n=="object"&&n!==null&&!Array.isArray(n)?Object.assign(t,n):t[s]=n}function p(t,e,n=void 0){try{if(e.length===1&&e[0]==="_self")return t;for(let s=0;s<e.length;s++){if(typeof t!="object"||t===null)return n;const i=e[s];if(i.endsWith("[]")){const o=i.slice(0,-2);if(o in t){const u=t[o];return Array.isArray(u)?u.map(d=>p(d,e.slice(s+1),n)):n}else return n}else t=t[i]}return t}catch(s){if(s instanceof TypeError)return n;throw s}}function eN(t,e){for(const[n,s]of Object.entries(e)){const i=n.split("."),o=s.split("."),u=new Set;let d=-1;for(let m=0;m<i.length;m++)if(i[m]==="*"){d=m;break}if(d!==-1&&o.length>d)for(let m=d;m<o.length;m++){const f=o[m];f!=="*"&&!f.endsWith("[]")&&!f.endsWith("[0]")&&u.add(f)}dp(t,i,o,0,u)}}function dp(t,e,n,s,i){if(s>=e.length||typeof t!="object"||t===null)return;const o=e[s];if(o.endsWith("[]")){const u=o.slice(0,-2),d=t;if(u in d&&Array.isArray(d[u]))for(const m of d[u])dp(m,e,n,s+1,i)}else if(o==="*"){if(typeof t=="object"&&t!==null&&!Array.isArray(t)){const u=t,d=Object.keys(u).filter(f=>!f.startsWith("_")&&!i.has(f)),m={};for(const f of d)m[f]=u[f];for(const[f,y]of Object.entries(m)){const S=[];for(const _ of n.slice(s))_==="*"?S.push(f):S.push(_);h(u,S,y)}for(const f of d)delete u[f]}}else{const u=t;o in u&&dp(u[o],e,n,s+1,i)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Zp(t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function tN(t){const e={},n=p(t,["operationName"]);n!=null&&h(e,["operationName"],n);const s=p(t,["resourceName"]);return s!=null&&h(e,["_url","resourceName"],s),e}function nN(t){const e={},n=p(t,["name"]);n!=null&&h(e,["name"],n);const s=p(t,["metadata"]);s!=null&&h(e,["metadata"],s);const i=p(t,["done"]);i!=null&&h(e,["done"],i);const o=p(t,["error"]);o!=null&&h(e,["error"],o);const u=p(t,["response","generateVideoResponse"]);return u!=null&&h(e,["response"],aN(u)),e}function sN(t){const e={},n=p(t,["name"]);n!=null&&h(e,["name"],n);const s=p(t,["metadata"]);s!=null&&h(e,["metadata"],s);const i=p(t,["done"]);i!=null&&h(e,["done"],i);const o=p(t,["error"]);o!=null&&h(e,["error"],o);const u=p(t,["response"]);return u!=null&&h(e,["response"],rN(u)),e}function aN(t){const e={},n=p(t,["generatedSamples"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(u=>iN(u))),h(e,["generatedVideos"],o)}const s=p(t,["raiMediaFilteredCount"]);s!=null&&h(e,["raiMediaFilteredCount"],s);const i=p(t,["raiMediaFilteredReasons"]);return i!=null&&h(e,["raiMediaFilteredReasons"],i),e}function rN(t){const e={},n=p(t,["videos"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(u=>oN(u))),h(e,["generatedVideos"],o)}const s=p(t,["raiMediaFilteredCount"]);s!=null&&h(e,["raiMediaFilteredCount"],s);const i=p(t,["raiMediaFilteredReasons"]);return i!=null&&h(e,["raiMediaFilteredReasons"],i),e}function iN(t){const e={},n=p(t,["video"]);return n!=null&&h(e,["video"],pN(n)),e}function oN(t){const e={},n=p(t,["_self"]);return n!=null&&h(e,["video"],mN(n)),e}function lN(t){const e={},n=p(t,["operationName"]);return n!=null&&h(e,["_url","operationName"],n),e}function uN(t){const e={},n=p(t,["operationName"]);return n!=null&&h(e,["_url","operationName"],n),e}function cN(t){const e={},n=p(t,["name"]);n!=null&&h(e,["name"],n);const s=p(t,["metadata"]);s!=null&&h(e,["metadata"],s);const i=p(t,["done"]);i!=null&&h(e,["done"],i);const o=p(t,["error"]);o!=null&&h(e,["error"],o);const u=p(t,["response"]);return u!=null&&h(e,["response"],dN(u)),e}function dN(t){const e={},n=p(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=p(t,["parent"]);s!=null&&h(e,["parent"],s);const i=p(t,["documentName"]);return i!=null&&h(e,["documentName"],i),e}function H_(t){const e={},n=p(t,["name"]);n!=null&&h(e,["name"],n);const s=p(t,["metadata"]);s!=null&&h(e,["metadata"],s);const i=p(t,["done"]);i!=null&&h(e,["done"],i);const o=p(t,["error"]);o!=null&&h(e,["error"],o);const u=p(t,["response"]);return u!=null&&h(e,["response"],fN(u)),e}function fN(t){const e={},n=p(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=p(t,["parent"]);s!=null&&h(e,["parent"],s);const i=p(t,["documentName"]);return i!=null&&h(e,["documentName"],i),e}function pN(t){const e={},n=p(t,["uri"]);n!=null&&h(e,["uri"],n);const s=p(t,["encodedVideo"]);s!=null&&h(e,["videoBytes"],Zp(s));const i=p(t,["encoding"]);return i!=null&&h(e,["mimeType"],i),e}function mN(t){const e={},n=p(t,["gcsUri"]);n!=null&&h(e,["uri"],n);const s=p(t,["bytesBase64Encoded"]);s!=null&&h(e,["videoBytes"],Zp(s));const i=p(t,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Iv;(function(t){t.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",t.OUTCOME_OK="OUTCOME_OK",t.OUTCOME_FAILED="OUTCOME_FAILED",t.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(Iv||(Iv={}));var Rv;(function(t){t.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",t.PYTHON="PYTHON"})(Rv||(Rv={}));var Mv;(function(t){t.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",t.SILENT="SILENT",t.WHEN_IDLE="WHEN_IDLE",t.INTERRUPT="INTERRUPT"})(Mv||(Mv={}));var X;(function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.STRING="STRING",t.NUMBER="NUMBER",t.INTEGER="INTEGER",t.BOOLEAN="BOOLEAN",t.ARRAY="ARRAY",t.OBJECT="OBJECT",t.NULL="NULL"})(X||(X={}));var Pv;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(Pv||(Pv={}));var Dv;(function(t){t.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",t.SIMPLE_SEARCH="SIMPLE_SEARCH",t.ELASTIC_SEARCH="ELASTIC_SEARCH"})(Dv||(Dv={}));var Lv;(function(t){t.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",t.NO_AUTH="NO_AUTH",t.API_KEY_AUTH="API_KEY_AUTH",t.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",t.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",t.OAUTH="OAUTH",t.OIDC_AUTH="OIDC_AUTH"})(Lv||(Lv={}));var kv;(function(t){t.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",t.HTTP_IN_QUERY="HTTP_IN_QUERY",t.HTTP_IN_HEADER="HTTP_IN_HEADER",t.HTTP_IN_PATH="HTTP_IN_PATH",t.HTTP_IN_BODY="HTTP_IN_BODY",t.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(kv||(kv={}));var Uv;(function(t){t.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",t.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",t.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",t.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(Uv||(Uv={}));var Ov;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",t.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",t.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",t.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",t.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(Ov||(Ov={}));var qv;(function(t){t.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",t.SEVERITY="SEVERITY",t.PROBABILITY="PROBABILITY"})(qv||(qv={}));var Bv;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE",t.OFF="OFF"})(Bv||(Bv={}));var Fv;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.IMAGE_SAFETY="IMAGE_SAFETY",t.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",t.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",t.NO_IMAGE="NO_IMAGE"})(Fv||(Fv={}));var $v;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})($v||($v={}));var Hv;(function(t){t.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",t.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",t.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",t.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",t.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(Hv||(Hv={}));var Gv;(function(t){t.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",t.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",t.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",t.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",t.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(Gv||(Gv={}));var Vv;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.IMAGE_SAFETY="IMAGE_SAFETY",t.MODEL_ARMOR="MODEL_ARMOR",t.JAILBREAK="JAILBREAK"})(Vv||(Vv={}));var zv;(function(t){t.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",t.ON_DEMAND="ON_DEMAND",t.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(zv||(zv={}));var Nu;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.AUDIO="AUDIO"})(Nu||(Nu={}));var jv;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(jv||(jv={}));var Yv;(function(t){t.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",t.TUNING_MODE_FULL="TUNING_MODE_FULL",t.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(Yv||(Yv={}));var Jv;(function(t){t.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",t.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",t.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",t.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",t.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",t.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",t.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(Jv||(Jv={}));var fp;(function(t){t.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",t.JOB_STATE_QUEUED="JOB_STATE_QUEUED",t.JOB_STATE_PENDING="JOB_STATE_PENDING",t.JOB_STATE_RUNNING="JOB_STATE_RUNNING",t.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",t.JOB_STATE_FAILED="JOB_STATE_FAILED",t.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",t.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",t.JOB_STATE_PAUSED="JOB_STATE_PAUSED",t.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",t.JOB_STATE_UPDATING="JOB_STATE_UPDATING",t.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(fp||(fp={}));var Kv;(function(t){t.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",t.TUNING_TASK_I2V="TUNING_TASK_I2V",t.TUNING_TASK_T2V="TUNING_TASK_T2V",t.TUNING_TASK_R2V="TUNING_TASK_R2V"})(Kv||(Kv={}));var Xv;(function(t){t.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",t.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",t.BALANCED="BALANCED",t.PRIORITIZE_COST="PRIORITIZE_COST"})(Xv||(Xv={}));var Qv;(function(t){t.UNSPECIFIED="UNSPECIFIED",t.BLOCKING="BLOCKING",t.NON_BLOCKING="NON_BLOCKING"})(Qv||(Qv={}));var Wv;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(Wv||(Wv={}));var Zv;(function(t){t.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",t.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(Zv||(Zv={}));var eS;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE",t.VALIDATED="VALIDATED"})(eS||(eS={}));var tS;(function(t){t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(tS||(tS={}));var nS;(function(t){t.DONT_ALLOW="DONT_ALLOW",t.ALLOW_ADULT="ALLOW_ADULT",t.ALLOW_ALL="ALLOW_ALL"})(nS||(nS={}));var sS;(function(t){t.auto="auto",t.en="en",t.ja="ja",t.ko="ko",t.hi="hi",t.zh="zh",t.pt="pt",t.es="es"})(sS||(sS={}));var aS;(function(t){t.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",t.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",t.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",t.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",t.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(aS||(aS={}));var rS;(function(t){t.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",t.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",t.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",t.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(rS||(rS={}));var iS;(function(t){t.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",t.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",t.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",t.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(iS||(iS={}));var oS;(function(t){t.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",t.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",t.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",t.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",t.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",t.EDIT_MODE_STYLE="EDIT_MODE_STYLE",t.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",t.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(oS||(oS={}));var lS;(function(t){t.FOREGROUND="FOREGROUND",t.BACKGROUND="BACKGROUND",t.PROMPT="PROMPT",t.SEMANTIC="SEMANTIC",t.INTERACTIVE="INTERACTIVE"})(lS||(lS={}));var uS;(function(t){t.ASSET="ASSET",t.STYLE="STYLE"})(uS||(uS={}));var cS;(function(t){t.INSERT="INSERT",t.REMOVE="REMOVE",t.REMOVE_STATIC="REMOVE_STATIC",t.OUTPAINT="OUTPAINT"})(cS||(cS={}));var dS;(function(t){t.OPTIMIZED="OPTIMIZED",t.LOSSLESS="LOSSLESS"})(dS||(dS={}));var fS;(function(t){t.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",t.PREFERENCE_TUNING="PREFERENCE_TUNING"})(fS||(fS={}));var pS;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.STATE_PENDING="STATE_PENDING",t.STATE_ACTIVE="STATE_ACTIVE",t.STATE_FAILED="STATE_FAILED"})(pS||(pS={}));var mS;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.PROCESSING="PROCESSING",t.ACTIVE="ACTIVE",t.FAILED="FAILED"})(mS||(mS={}));var hS;(function(t){t.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",t.UPLOADED="UPLOADED",t.GENERATED="GENERATED"})(hS||(hS={}));var gS;(function(t){t.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.RESPONSE_REJECTED="RESPONSE_REJECTED",t.NEED_MORE_INPUT="NEED_MORE_INPUT"})(gS||(gS={}));var yS;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.VIDEO="VIDEO",t.AUDIO="AUDIO",t.DOCUMENT="DOCUMENT"})(yS||(yS={}));var vS;(function(t){t.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",t.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",t.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(vS||(vS={}));var SS;(function(t){t.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",t.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",t.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(SS||(SS={}));var wS;(function(t){t.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",t.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",t.NO_INTERRUPTION="NO_INTERRUPTION"})(wS||(wS={}));var _S;(function(t){t.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",t.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",t.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(_S||(_S={}));var xS;(function(t){t.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",t.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",t.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",t.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",t.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",t.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",t.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",t.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",t.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",t.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",t.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",t.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",t.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(xS||(xS={}));var bS;(function(t){t.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",t.QUALITY="QUALITY",t.DIVERSITY="DIVERSITY",t.VOCALIZATION="VOCALIZATION"})(bS||(bS={}));var qr;(function(t){t.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",t.PLAY="PLAY",t.PAUSE="PAUSE",t.STOP="STOP",t.RESET_CONTEXT="RESET_CONTEXT"})(qr||(qr={}));class pp{constructor(e){const n={};for(const s of e.headers.entries())n[s[0]]=s[1];this.headers=n,this.responseInternal=e}json(){return this.responseInternal.json()}}class Zi{get text(){var e,n,s,i,o,u,d,m;if(((i=(s=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let f="",y=!1;const S=[];for(const _ of(m=(d=(u=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||u===void 0?void 0:u.content)===null||d===void 0?void 0:d.parts)!==null&&m!==void 0?m:[]){for(const[T,C]of Object.entries(_))T!=="text"&&T!=="thought"&&(C!==null||C!==void 0)&&S.push(T);if(typeof _.text=="string"){if(typeof _.thought=="boolean"&&_.thought)continue;y=!0,f+=_.text}}return S.length>0&&console.warn(`there are non-text parts ${S} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),y?f:void 0}get data(){var e,n,s,i,o,u,d,m;if(((i=(s=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let f="";const y=[];for(const S of(m=(d=(u=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||u===void 0?void 0:u.content)===null||d===void 0?void 0:d.parts)!==null&&m!==void 0?m:[]){for(const[_,T]of Object.entries(S))_!=="inlineData"&&(T!==null||T!==void 0)&&y.push(_);S.inlineData&&typeof S.inlineData.data=="string"&&(f+=atob(S.inlineData.data))}return y.length>0&&console.warn(`there are non-data parts ${y} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),f.length>0?btoa(f):void 0}get functionCalls(){var e,n,s,i,o,u,d,m;if(((i=(s=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const f=(m=(d=(u=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||u===void 0?void 0:u.content)===null||d===void 0?void 0:d.parts)===null||m===void 0?void 0:m.filter(y=>y.functionCall).map(y=>y.functionCall).filter(y=>y!==void 0);if((f==null?void 0:f.length)!==0)return f}get executableCode(){var e,n,s,i,o,u,d,m,f;if(((i=(s=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const y=(m=(d=(u=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||u===void 0?void 0:u.content)===null||d===void 0?void 0:d.parts)===null||m===void 0?void 0:m.filter(S=>S.executableCode).map(S=>S.executableCode).filter(S=>S!==void 0);if((y==null?void 0:y.length)!==0)return(f=y==null?void 0:y[0])===null||f===void 0?void 0:f.code}get codeExecutionResult(){var e,n,s,i,o,u,d,m,f;if(((i=(s=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const y=(m=(d=(u=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||u===void 0?void 0:u.content)===null||d===void 0?void 0:d.parts)===null||m===void 0?void 0:m.filter(S=>S.codeExecutionResult).map(S=>S.codeExecutionResult).filter(S=>S!==void 0);if((y==null?void 0:y.length)!==0)return(f=y==null?void 0:y[0])===null||f===void 0?void 0:f.output}}class TS{}class CS{}class hN{}class gN{}class yN{}class vN{}class AS{}class ES{}class NS{}class SN{}class Iu{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const s=new Iu;let i;const o=e;return n?i=sN(o):i=nN(o),Object.assign(s,i),s}}class IS{}class RS{}class MS{}class wN{}class _N{}class xN{}class em{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const s=new em,o=cN(e);return Object.assign(s,o),s}}class bN{}class TN{}class CN{}class PS{}class AN{get text(){var e,n,s;let i="",o=!1;const u=[];for(const d of(s=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&s!==void 0?s:[]){for(const[m,f]of Object.entries(d))m!=="text"&&m!=="thought"&&f!==null&&u.push(m);if(typeof d.text=="string"){if(typeof d.thought=="boolean"&&d.thought)continue;o=!0,i+=d.text}}return u.length>0&&console.warn(`there are non-text parts ${u} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),o?i:void 0}get data(){var e,n,s;let i="";const o=[];for(const u of(s=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&s!==void 0?s:[]){for(const[d,m]of Object.entries(u))d!=="inlineData"&&m!==null&&o.push(d);u.inlineData&&typeof u.inlineData.data=="string"&&(i+=atob(u.inlineData.data))}return o.length>0&&console.warn(`there are non-data parts ${o} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}}class EN{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class tm{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const s=new tm,o=H_(e);return Object.assign(s,o),s}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ge(t,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(t.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const n=e.split("/",2);return`publishers/${n[0]}/models/${n[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function G_(t,e){const n=Ge(t,e);return n?n.startsWith("publishers/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}`:n.startsWith("models/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/publishers/google/${n}`:n:""}function V_(t){return Array.isArray(t)?t.map(e=>Ru(e)):[Ru(t)]}function Ru(t){if(typeof t=="object"&&t!==null)return t;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof t}`)}function z_(t){const e=Ru(t);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function j_(t){const e=Ru(t);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function DS(t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function Y_(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>DS(e)):[DS(t)]}function mp(t){return t!=null&&typeof t=="object"&&"parts"in t&&Array.isArray(t.parts)}function LS(t){return t!=null&&typeof t=="object"&&"functionCall"in t}function kS(t){return t!=null&&typeof t=="object"&&"functionResponse"in t}function Bt(t){if(t==null)throw new Error("ContentUnion is required");return mp(t)?t:{role:"user",parts:Y_(t)}}function nm(t,e){if(!e)return[];if(t.isVertexAI()&&Array.isArray(e))return e.flatMap(n=>{const s=Bt(n);return s.parts&&s.parts.length>0&&s.parts[0].text!==void 0?[s.parts[0].text]:[]});if(t.isVertexAI()){const n=Bt(e);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]}return Array.isArray(e)?e.map(n=>Bt(n)):[Bt(e)]}function An(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t)){if(LS(t)||kS(t))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[Bt(t)]}const e=[],n=[],s=mp(t[0]);for(const i of t){const o=mp(i);if(o!=s)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(o)e.push(i);else{if(LS(i)||kS(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(i)}}return s||e.push({role:"user",parts:Y_(n)}),e}function NN(t,e){t.includes("null")&&(e.nullable=!0);const n=t.filter(s=>s!=="null");if(n.length===1)e.type=Object.values(X).includes(n[0].toUpperCase())?n[0].toUpperCase():X.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const s of n)e.anyOf.push({type:Object.values(X).includes(s.toUpperCase())?s.toUpperCase():X.TYPE_UNSPECIFIED})}}function Gr(t){const e={},n=["items"],s=["anyOf"],i=["properties"];if(t.type&&t.anyOf)throw new Error("type and anyOf cannot be both populated.");const o=t.anyOf;o!=null&&o.length==2&&(o[0].type==="null"?(e.nullable=!0,t=o[1]):o[1].type==="null"&&(e.nullable=!0,t=o[0])),t.type instanceof Array&&NN(t.type,e);for(const[u,d]of Object.entries(t))if(d!=null)if(u=="type"){if(d==="null")throw new Error("type: null can not be the only possible type for the field.");if(d instanceof Array)continue;e.type=Object.values(X).includes(d.toUpperCase())?d.toUpperCase():X.TYPE_UNSPECIFIED}else if(n.includes(u))e[u]=Gr(d);else if(s.includes(u)){const m=[];for(const f of d){if(f.type=="null"){e.nullable=!0;continue}m.push(Gr(f))}e[u]=m}else if(i.includes(u)){const m={};for(const[f,y]of Object.entries(d))m[f]=Gr(y);e[u]=m}else{if(u==="additionalProperties")continue;e[u]=d}return e}function sm(t){return Gr(t)}function am(t){if(typeof t=="object")return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function rm(t){if("multiSpeakerVoiceConfig"in t)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return t}function Wr(t){if(t.functionDeclarations)for(const e of t.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=Gr(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=Gr(e.response));return t}function Zr(t){if(t==null)throw new Error("tools is required");if(!Array.isArray(t))throw new Error("tools is required and must be an array of Tools");const e=[];for(const n of t)e.push(n);return e}function IN(t,e,n,s=1){const i=!e.startsWith(`${n}/`)&&e.split("/").length===s;return t.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${t.getProject()}/${e}`:e.startsWith(`${n}/`)?`projects/${t.getProject()}/locations/${t.getLocation()}/${e}`:i?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}/${e}`:e:i?`${n}/${e}`:e}function Es(t,e){if(typeof e!="string")throw new Error("name must be a string");return IN(t,e,"cachedContents")}function J_(t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function oa(t){return Zp(t)}function RN(t){return t!=null&&typeof t=="object"&&"name"in t}function MN(t){return t!=null&&typeof t=="object"&&"video"in t}function PN(t){return t!=null&&typeof t=="object"&&"uri"in t}function K_(t){var e;let n;if(RN(t)&&(n=t.name),!(PN(t)&&(n=t.uri,n===void 0))&&!(MN(t)&&(n=(e=t.video)===null||e===void 0?void 0:e.uri,n===void 0))){if(typeof t=="string"&&(n=t),n===void 0)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){const i=n.split("files/")[1].match(/[a-z0-9]+/);if(i===null)throw new Error(`Could not extract file name from URI ${n}`);n=i[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function X_(t,e){let n;return t.isVertexAI()?n=e?"publishers/google/models":"models":n=e?"models":"tunedModels",n}function Q_(t){for(const e of["models","tunedModels","publisherModels"])if(DN(t,e))return t[e];return[]}function DN(t,e){return t!==null&&typeof t=="object"&&e in t}function LN(t,e={}){const n=t,s={name:n.name,description:n.description,parametersJsonSchema:n.inputSchema};return n.outputSchema&&(s.responseJsonSchema=n.outputSchema),e.behavior&&(s.behavior=e.behavior),{functionDeclarations:[s]}}function kN(t,e={}){const n=[],s=new Set;for(const i of t){const o=i.name;if(s.has(o))throw new Error(`Duplicate function name ${o} found in MCP tools. Please ensure function names are unique.`);s.add(o);const u=LN(i,e);u.functionDeclarations&&n.push(...u.functionDeclarations)}return{functionDeclarations:n}}function W_(t,e){let n;if(typeof e=="string")if(t.isVertexAI())if(e.startsWith("gs://"))n={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))n={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))n={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(t.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:e}}else n=e;const s=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,i=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(t.isVertexAI()){if(i>0||s!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(s>0||i!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function UN(t){if(typeof t!="string")return t;const e=t;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function Z_(t){if(typeof t!="object"||t===null)return{};const e=t,n=e.inlinedResponses;if(typeof n!="object"||n===null)return t;const i=n.inlinedResponses;if(!Array.isArray(i)||i.length===0)return t;let o=!1;for(const u of i){if(typeof u!="object"||u===null)continue;const m=u.response;if(typeof m!="object"||m===null)continue;if(m.embedding!==void 0){o=!0;break}}return o&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),t}function ei(t,e){const n=e;if(!t.isVertexAI()){if(/batches\/[^/]+$/.test(n))return n.split("/").pop();throw new Error(`Invalid batch job name: ${n}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(n))return n.split("/").pop();if(/^\d+$/.test(n))return n;throw new Error(`Invalid batch job name: ${n}.`)}function ex(t){const e=t;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ON(t){const e={},n=p(t,["responsesFile"]);n!=null&&h(e,["fileName"],n);const s=p(t,["inlinedResponses","inlinedResponses"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(u=>mI(u))),h(e,["inlinedResponses"],o)}const i=p(t,["inlinedEmbedContentResponses","inlinedResponses"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(u=>u)),h(e,["inlinedEmbedContentResponses"],o)}return e}function qN(t){const e={},n=p(t,["predictionsFormat"]);n!=null&&h(e,["format"],n);const s=p(t,["gcsDestination","outputUriPrefix"]);s!=null&&h(e,["gcsUri"],s);const i=p(t,["bigqueryDestination","outputUri"]);return i!=null&&h(e,["bigqueryUri"],i),e}function BN(t){const e={},n=p(t,["format"]);n!=null&&h(e,["predictionsFormat"],n);const s=p(t,["gcsUri"]);s!=null&&h(e,["gcsDestination","outputUriPrefix"],s);const i=p(t,["bigqueryUri"]);if(i!=null&&h(e,["bigqueryDestination","outputUri"],i),p(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(p(t,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(p(t,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function mu(t){const e={},n=p(t,["name"]);n!=null&&h(e,["name"],n);const s=p(t,["metadata","displayName"]);s!=null&&h(e,["displayName"],s);const i=p(t,["metadata","state"]);i!=null&&h(e,["state"],ex(i));const o=p(t,["metadata","createTime"]);o!=null&&h(e,["createTime"],o);const u=p(t,["metadata","endTime"]);u!=null&&h(e,["endTime"],u);const d=p(t,["metadata","updateTime"]);d!=null&&h(e,["updateTime"],d);const m=p(t,["metadata","model"]);m!=null&&h(e,["model"],m);const f=p(t,["metadata","output"]);return f!=null&&h(e,["dest"],ON(Z_(f))),e}function hp(t){const e={},n=p(t,["name"]);n!=null&&h(e,["name"],n);const s=p(t,["displayName"]);s!=null&&h(e,["displayName"],s);const i=p(t,["state"]);i!=null&&h(e,["state"],ex(i));const o=p(t,["error"]);o!=null&&h(e,["error"],o);const u=p(t,["createTime"]);u!=null&&h(e,["createTime"],u);const d=p(t,["startTime"]);d!=null&&h(e,["startTime"],d);const m=p(t,["endTime"]);m!=null&&h(e,["endTime"],m);const f=p(t,["updateTime"]);f!=null&&h(e,["updateTime"],f);const y=p(t,["model"]);y!=null&&h(e,["model"],y);const S=p(t,["inputConfig"]);S!=null&&h(e,["src"],FN(S));const _=p(t,["outputConfig"]);_!=null&&h(e,["dest"],qN(Z_(_)));const T=p(t,["completionStats"]);return T!=null&&h(e,["completionStats"],T),e}function FN(t){const e={},n=p(t,["instancesFormat"]);n!=null&&h(e,["format"],n);const s=p(t,["gcsSource","uris"]);s!=null&&h(e,["gcsUri"],s);const i=p(t,["bigquerySource","inputUri"]);return i!=null&&h(e,["bigqueryUri"],i),e}function $N(t,e){const n={};if(p(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(p(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(p(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const s=p(e,["fileName"]);s!=null&&h(n,["fileName"],s);const i=p(e,["inlinedRequests"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(u=>pI(t,u))),h(n,["requests","requests"],o)}return n}function HN(t){const e={},n=p(t,["format"]);n!=null&&h(e,["instancesFormat"],n);const s=p(t,["gcsUri"]);s!=null&&h(e,["gcsSource","uris"],s);const i=p(t,["bigqueryUri"]);if(i!=null&&h(e,["bigquerySource","inputUri"],i),p(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(p(t,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function GN(t){const e={},n=p(t,["data"]);if(n!=null&&h(e,["data"],n),p(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=p(t,["mimeType"]);return s!=null&&h(e,["mimeType"],s),e}function VN(t,e){const n={},s=p(e,["name"]);return s!=null&&h(n,["_url","name"],ei(t,s)),n}function zN(t,e){const n={},s=p(e,["name"]);return s!=null&&h(n,["_url","name"],ei(t,s)),n}function jN(t){const e={},n=p(t,["content"]);n!=null&&h(e,["content"],n);const s=p(t,["citationMetadata"]);s!=null&&h(e,["citationMetadata"],YN(s));const i=p(t,["tokenCount"]);i!=null&&h(e,["tokenCount"],i);const o=p(t,["finishReason"]);o!=null&&h(e,["finishReason"],o);const u=p(t,["avgLogprobs"]);u!=null&&h(e,["avgLogprobs"],u);const d=p(t,["groundingMetadata"]);d!=null&&h(e,["groundingMetadata"],d);const m=p(t,["index"]);m!=null&&h(e,["index"],m);const f=p(t,["logprobsResult"]);f!=null&&h(e,["logprobsResult"],f);const y=p(t,["safetyRatings"]);if(y!=null){let _=y;Array.isArray(_)&&(_=_.map(T=>T)),h(e,["safetyRatings"],_)}const S=p(t,["urlContextMetadata"]);return S!=null&&h(e,["urlContextMetadata"],S),e}function YN(t){const e={},n=p(t,["citationSources"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(i=>i)),h(e,["citations"],s)}return e}function tx(t){const e={},n=p(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>_I(o))),h(e,["parts"],i)}const s=p(t,["role"]);return s!=null&&h(e,["role"],s),e}function JN(t,e){const n={},s=p(t,["displayName"]);if(e!==void 0&&s!=null&&h(e,["batch","displayName"],s),p(t,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return n}function KN(t,e){const n={},s=p(t,["displayName"]);e!==void 0&&s!=null&&h(e,["displayName"],s);const i=p(t,["dest"]);return e!==void 0&&i!=null&&h(e,["outputConfig"],BN(UN(i))),n}function US(t,e){const n={},s=p(e,["model"]);s!=null&&h(n,["_url","model"],Ge(t,s));const i=p(e,["src"]);i!=null&&h(n,["batch","inputConfig"],$N(t,W_(t,i)));const o=p(e,["config"]);return o!=null&&JN(o,n),n}function XN(t,e){const n={},s=p(e,["model"]);s!=null&&h(n,["model"],Ge(t,s));const i=p(e,["src"]);i!=null&&h(n,["inputConfig"],HN(W_(t,i)));const o=p(e,["config"]);return o!=null&&KN(o,n),n}function QN(t,e){const n={},s=p(t,["displayName"]);return e!==void 0&&s!=null&&h(e,["batch","displayName"],s),n}function WN(t,e){const n={},s=p(e,["model"]);s!=null&&h(n,["_url","model"],Ge(t,s));const i=p(e,["src"]);i!=null&&h(n,["batch","inputConfig"],rI(t,i));const o=p(e,["config"]);return o!=null&&QN(o,n),n}function ZN(t,e){const n={},s=p(e,["name"]);return s!=null&&h(n,["_url","name"],ei(t,s)),n}function eI(t,e){const n={},s=p(e,["name"]);return s!=null&&h(n,["_url","name"],ei(t,s)),n}function tI(t){const e={},n=p(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=p(t,["name"]);s!=null&&h(e,["name"],s);const i=p(t,["done"]);i!=null&&h(e,["done"],i);const o=p(t,["error"]);return o!=null&&h(e,["error"],o),e}function nI(t){const e={},n=p(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=p(t,["name"]);s!=null&&h(e,["name"],s);const i=p(t,["done"]);i!=null&&h(e,["done"],i);const o=p(t,["error"]);return o!=null&&h(e,["error"],o),e}function sI(t,e){const n={},s=p(e,["contents"]);if(s!=null){let o=nm(t,s);Array.isArray(o)&&(o=o.map(u=>u)),h(n,["requests[]","request","content"],o)}const i=p(e,["config"]);return i!=null&&(h(n,["_self"],aI(i,n)),eN(n,{"requests[].*":"requests[].request.*"})),n}function aI(t,e){const n={},s=p(t,["taskType"]);e!==void 0&&s!=null&&h(e,["requests[]","taskType"],s);const i=p(t,["title"]);e!==void 0&&i!=null&&h(e,["requests[]","title"],i);const o=p(t,["outputDimensionality"]);if(e!==void 0&&o!=null&&h(e,["requests[]","outputDimensionality"],o),p(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(p(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function rI(t,e){const n={},s=p(e,["fileName"]);s!=null&&h(n,["file_name"],s);const i=p(e,["inlinedRequests"]);return i!=null&&h(n,["requests"],sI(t,i)),n}function iI(t){const e={};if(p(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=p(t,["fileUri"]);n!=null&&h(e,["fileUri"],n);const s=p(t,["mimeType"]);return s!=null&&h(e,["mimeType"],s),e}function oI(t,e,n){const s={},i=p(e,["systemInstruction"]);n!==void 0&&i!=null&&h(n,["systemInstruction"],tx(Bt(i)));const o=p(e,["temperature"]);o!=null&&h(s,["temperature"],o);const u=p(e,["topP"]);u!=null&&h(s,["topP"],u);const d=p(e,["topK"]);d!=null&&h(s,["topK"],d);const m=p(e,["candidateCount"]);m!=null&&h(s,["candidateCount"],m);const f=p(e,["maxOutputTokens"]);f!=null&&h(s,["maxOutputTokens"],f);const y=p(e,["stopSequences"]);y!=null&&h(s,["stopSequences"],y);const S=p(e,["responseLogprobs"]);S!=null&&h(s,["responseLogprobs"],S);const _=p(e,["logprobs"]);_!=null&&h(s,["logprobs"],_);const T=p(e,["presencePenalty"]);T!=null&&h(s,["presencePenalty"],T);const C=p(e,["frequencyPenalty"]);C!=null&&h(s,["frequencyPenalty"],C);const N=p(e,["seed"]);N!=null&&h(s,["seed"],N);const E=p(e,["responseMimeType"]);E!=null&&h(s,["responseMimeType"],E);const L=p(e,["responseSchema"]);L!=null&&h(s,["responseSchema"],sm(L));const B=p(e,["responseJsonSchema"]);if(B!=null&&h(s,["responseJsonSchema"],B),p(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(p(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const O=p(e,["safetySettings"]);if(n!==void 0&&O!=null){let U=O;Array.isArray(U)&&(U=U.map(z=>xI(z))),h(n,["safetySettings"],U)}const x=p(e,["tools"]);if(n!==void 0&&x!=null){let U=Zr(x);Array.isArray(U)&&(U=U.map(z=>bI(Wr(z)))),h(n,["tools"],U)}const I=p(e,["toolConfig"]);if(n!==void 0&&I!=null&&h(n,["toolConfig"],I),p(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const D=p(e,["cachedContent"]);n!==void 0&&D!=null&&h(n,["cachedContent"],Es(t,D));const R=p(e,["responseModalities"]);R!=null&&h(s,["responseModalities"],R);const P=p(e,["mediaResolution"]);P!=null&&h(s,["mediaResolution"],P);const A=p(e,["speechConfig"]);if(A!=null&&h(s,["speechConfig"],am(A)),p(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const k=p(e,["thinkingConfig"]);k!=null&&h(s,["thinkingConfig"],k);const F=p(e,["imageConfig"]);return F!=null&&h(s,["imageConfig"],F),s}function lI(t){const e={},n=p(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=p(t,["candidates"]);if(s!=null){let m=s;Array.isArray(m)&&(m=m.map(f=>jN(f))),h(e,["candidates"],m)}const i=p(t,["modelVersion"]);i!=null&&h(e,["modelVersion"],i);const o=p(t,["promptFeedback"]);o!=null&&h(e,["promptFeedback"],o);const u=p(t,["responseId"]);u!=null&&h(e,["responseId"],u);const d=p(t,["usageMetadata"]);return d!=null&&h(e,["usageMetadata"],d),e}function uI(t,e){const n={},s=p(e,["name"]);return s!=null&&h(n,["_url","name"],ei(t,s)),n}function cI(t,e){const n={},s=p(e,["name"]);return s!=null&&h(n,["_url","name"],ei(t,s)),n}function dI(t){const e={};if(p(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=p(t,["enableWidget"]);return n!=null&&h(e,["enableWidget"],n),e}function fI(t){const e={};if(p(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(p(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=p(t,["timeRangeFilter"]);return n!=null&&h(e,["timeRangeFilter"],n),e}function pI(t,e){const n={},s=p(e,["model"]);s!=null&&h(n,["request","model"],Ge(t,s));const i=p(e,["contents"]);if(i!=null){let d=An(i);Array.isArray(d)&&(d=d.map(m=>tx(m))),h(n,["request","contents"],d)}const o=p(e,["metadata"]);o!=null&&h(n,["metadata"],o);const u=p(e,["config"]);return u!=null&&h(n,["request","generationConfig"],oI(t,u,p(n,["request"],{}))),n}function mI(t){const e={},n=p(t,["response"]);n!=null&&h(e,["response"],lI(n));const s=p(t,["error"]);return s!=null&&h(e,["error"],s),e}function hI(t,e){const n={},s=p(t,["pageSize"]);e!==void 0&&s!=null&&h(e,["_query","pageSize"],s);const i=p(t,["pageToken"]);if(e!==void 0&&i!=null&&h(e,["_query","pageToken"],i),p(t,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return n}function gI(t,e){const n={},s=p(t,["pageSize"]);e!==void 0&&s!=null&&h(e,["_query","pageSize"],s);const i=p(t,["pageToken"]);e!==void 0&&i!=null&&h(e,["_query","pageToken"],i);const o=p(t,["filter"]);return e!==void 0&&o!=null&&h(e,["_query","filter"],o),n}function yI(t){const e={},n=p(t,["config"]);return n!=null&&hI(n,e),e}function vI(t){const e={},n=p(t,["config"]);return n!=null&&gI(n,e),e}function SI(t){const e={},n=p(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=p(t,["nextPageToken"]);s!=null&&h(e,["nextPageToken"],s);const i=p(t,["operations"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(u=>mu(u))),h(e,["batchJobs"],o)}return e}function wI(t){const e={},n=p(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=p(t,["nextPageToken"]);s!=null&&h(e,["nextPageToken"],s);const i=p(t,["batchPredictionJobs"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(u=>hp(u))),h(e,["batchJobs"],o)}return e}function _I(t){const e={},n=p(t,["functionCall"]);n!=null&&h(e,["functionCall"],n);const s=p(t,["codeExecutionResult"]);s!=null&&h(e,["codeExecutionResult"],s);const i=p(t,["executableCode"]);i!=null&&h(e,["executableCode"],i);const o=p(t,["fileData"]);o!=null&&h(e,["fileData"],iI(o));const u=p(t,["functionResponse"]);u!=null&&h(e,["functionResponse"],u);const d=p(t,["inlineData"]);d!=null&&h(e,["inlineData"],GN(d));const m=p(t,["text"]);m!=null&&h(e,["text"],m);const f=p(t,["thought"]);f!=null&&h(e,["thought"],f);const y=p(t,["thoughtSignature"]);y!=null&&h(e,["thoughtSignature"],y);const S=p(t,["videoMetadata"]);return S!=null&&h(e,["videoMetadata"],S),e}function xI(t){const e={},n=p(t,["category"]);if(n!=null&&h(e,["category"],n),p(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const s=p(t,["threshold"]);return s!=null&&h(e,["threshold"],s),e}function bI(t){const e={},n=p(t,["functionDeclarations"]);if(n!=null){let y=n;Array.isArray(y)&&(y=y.map(S=>S)),h(e,["functionDeclarations"],y)}if(p(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=p(t,["googleSearchRetrieval"]);s!=null&&h(e,["googleSearchRetrieval"],s);const i=p(t,["computerUse"]);i!=null&&h(e,["computerUse"],i);const o=p(t,["fileSearch"]);o!=null&&h(e,["fileSearch"],o);const u=p(t,["codeExecution"]);if(u!=null&&h(e,["codeExecution"],u),p(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const d=p(t,["googleMaps"]);d!=null&&h(e,["googleMaps"],dI(d));const m=p(t,["googleSearch"]);m!=null&&h(e,["googleSearch"],fI(m));const f=p(t,["urlContext"]);return f!=null&&h(e,["urlContext"],f),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Cs;(function(t){t.PAGED_ITEM_BATCH_JOBS="batchJobs",t.PAGED_ITEM_MODELS="models",t.PAGED_ITEM_TUNING_JOBS="tuningJobs",t.PAGED_ITEM_FILES="files",t.PAGED_ITEM_CACHED_CONTENTS="cachedContents",t.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",t.PAGED_ITEM_DOCUMENTS="documents"})(Cs||(Cs={}));class Ha{constructor(e,n,s,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=n,this.init(e,s,i)}init(e,n,s){var i,o;this.nameInternal=e,this.pageInternal=n[this.nameInternal]||[],this.sdkHttpResponseInternal=n==null?void 0:n.sdkHttpResponse,this.idxInternal=0;let u={config:{}};!s||Object.keys(s).length===0?u={config:{}}:typeof s=="object"?u=Object.assign({},s):u=s,u.config&&(u.config.pageToken=n.nextPageToken),this.paramsInternal=u,this.pageInternalSize=(o=(i=u.config)===null||i===void 0?void 0:i.pageSize)!==null&&o!==void 0?o:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let TI=class extends As{constructor(e){super(),this.apiClient=e,this.create=async n=>(this.apiClient.isVertexAI()&&(n.config=this.formatDestination(n.src,n.config)),this.createInternal(n)),this.createEmbeddings=async n=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(n)},this.list=async(n={})=>new Ha(Cs.PAGED_ITEM_BATCH_JOBS,s=>this.listInternal(s),await this.listInternal(n),n)}createInlinedGenerateContentRequest(e){const n=US(this.apiClient,e),s=n._url,i=de("{model}:batchGenerateContent",s),d=n.batch.inputConfig.requests,m=d.requests,f=[];for(const y of m){const S=Object.assign({},y);if(S.systemInstruction){const _=S.systemInstruction;delete S.systemInstruction;const T=S.request;T.systemInstruction=_,S.request=T}f.push(S)}return d.requests=f,delete n.config,delete n._url,delete n._query,{path:i,body:n}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,n){const s=n?Object.assign({},n):{},i=Date.now().toString();if(s.displayName||(s.displayName=`genaiBatchJob_${i}`),s.dest===void 0){const o=this.getGcsUri(e),u=this.getBigqueryUri(e);if(o)o.endsWith(".jsonl")?s.dest=`${o.slice(0,-6)}/dest`:s.dest=`${o}_dest_${i}`;else if(u)s.dest=`${u}_dest_${i}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return s}async createInternal(e){var n,s,i,o;let u,d="",m={};if(this.apiClient.isVertexAI()){const f=XN(this.apiClient,e);return d=de("batchPredictionJobs",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json()),u.then(y=>hp(y))}else{const f=US(this.apiClient,e);return d=de("{model}:batchGenerateContent",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(y=>y.json()),u.then(y=>mu(y))}}async createEmbeddingsInternal(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=WN(this.apiClient,e);return o=de("{model}:asyncBatchEmbedContent",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json()),i.then(m=>mu(m))}}async get(e){var n,s,i,o;let u,d="",m={};if(this.apiClient.isVertexAI()){const f=cI(this.apiClient,e);return d=de("batchPredictionJobs/{name}",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json()),u.then(y=>hp(y))}else{const f=uI(this.apiClient,e);return d=de("batches/{name}",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(y=>y.json()),u.then(y=>mu(y))}}async cancel(e){var n,s,i,o;let u="",d={};if(this.apiClient.isVertexAI()){const m=zN(this.apiClient,e);u=de("batchPredictionJobs/{name}:cancel",m._url),d=m._query,delete m._url,delete m._query,await this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}else{const m=VN(this.apiClient,e);u=de("batches/{name}:cancel",m._url),d=m._query,delete m._url,delete m._query,await this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}}async listInternal(e){var n,s,i,o;let u,d="",m={};if(this.apiClient.isVertexAI()){const f=vI(e);return d=de("batchPredictionJobs",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json().then(S=>{const _=S;return _.sdkHttpResponse={headers:y.headers},_})),u.then(y=>{const S=wI(y),_=new PS;return Object.assign(_,S),_})}else{const f=yI(e);return d=de("batches",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(y=>y.json().then(S=>{const _=S;return _.sdkHttpResponse={headers:y.headers},_})),u.then(y=>{const S=SI(y),_=new PS;return Object.assign(_,S),_})}}async delete(e){var n,s,i,o;let u,d="",m={};if(this.apiClient.isVertexAI()){const f=eI(this.apiClient,e);return d=de("batchPredictionJobs/{name}",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json().then(S=>{const _=S;return _.sdkHttpResponse={headers:y.headers},_})),u.then(y=>nI(y))}else{const f=ZN(this.apiClient,e);return d=de("batches/{name}",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(y=>y.json().then(S=>{const _=S;return _.sdkHttpResponse={headers:y.headers},_})),u.then(y=>tI(y))}}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function CI(t){const e={},n=p(t,["data"]);if(n!=null&&h(e,["data"],n),p(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=p(t,["mimeType"]);return s!=null&&h(e,["mimeType"],s),e}function OS(t){const e={},n=p(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>jI(o))),h(e,["parts"],i)}const s=p(t,["role"]);return s!=null&&h(e,["role"],s),e}function AI(t,e){const n={},s=p(t,["ttl"]);e!==void 0&&s!=null&&h(e,["ttl"],s);const i=p(t,["expireTime"]);e!==void 0&&i!=null&&h(e,["expireTime"],i);const o=p(t,["displayName"]);e!==void 0&&o!=null&&h(e,["displayName"],o);const u=p(t,["contents"]);if(e!==void 0&&u!=null){let y=An(u);Array.isArray(y)&&(y=y.map(S=>OS(S))),h(e,["contents"],y)}const d=p(t,["systemInstruction"]);e!==void 0&&d!=null&&h(e,["systemInstruction"],OS(Bt(d)));const m=p(t,["tools"]);if(e!==void 0&&m!=null){let y=m;Array.isArray(y)&&(y=y.map(S=>YI(S))),h(e,["tools"],y)}const f=p(t,["toolConfig"]);if(e!==void 0&&f!=null&&h(e,["toolConfig"],f),p(t,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return n}function EI(t,e){const n={},s=p(t,["ttl"]);e!==void 0&&s!=null&&h(e,["ttl"],s);const i=p(t,["expireTime"]);e!==void 0&&i!=null&&h(e,["expireTime"],i);const o=p(t,["displayName"]);e!==void 0&&o!=null&&h(e,["displayName"],o);const u=p(t,["contents"]);if(e!==void 0&&u!=null){let S=An(u);Array.isArray(S)&&(S=S.map(_=>_)),h(e,["contents"],S)}const d=p(t,["systemInstruction"]);e!==void 0&&d!=null&&h(e,["systemInstruction"],Bt(d));const m=p(t,["tools"]);if(e!==void 0&&m!=null){let S=m;Array.isArray(S)&&(S=S.map(_=>JI(_))),h(e,["tools"],S)}const f=p(t,["toolConfig"]);e!==void 0&&f!=null&&h(e,["toolConfig"],f);const y=p(t,["kmsKeyName"]);return e!==void 0&&y!=null&&h(e,["encryption_spec","kmsKeyName"],y),n}function NI(t,e){const n={},s=p(e,["model"]);s!=null&&h(n,["model"],G_(t,s));const i=p(e,["config"]);return i!=null&&AI(i,n),n}function II(t,e){const n={},s=p(e,["model"]);s!=null&&h(n,["model"],G_(t,s));const i=p(e,["config"]);return i!=null&&EI(i,n),n}function RI(t,e){const n={},s=p(e,["name"]);return s!=null&&h(n,["_url","name"],Es(t,s)),n}function MI(t,e){const n={},s=p(e,["name"]);return s!=null&&h(n,["_url","name"],Es(t,s)),n}function PI(t){const e={},n=p(t,["sdkHttpResponse"]);return n!=null&&h(e,["sdkHttpResponse"],n),e}function DI(t){const e={},n=p(t,["sdkHttpResponse"]);return n!=null&&h(e,["sdkHttpResponse"],n),e}function LI(t){const e={};if(p(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=p(t,["fileUri"]);n!=null&&h(e,["fileUri"],n);const s=p(t,["mimeType"]);return s!=null&&h(e,["mimeType"],s),e}function kI(t){const e={};if(p(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=p(t,["description"]);n!=null&&h(e,["description"],n);const s=p(t,["name"]);s!=null&&h(e,["name"],s);const i=p(t,["parameters"]);i!=null&&h(e,["parameters"],i);const o=p(t,["parametersJsonSchema"]);o!=null&&h(e,["parametersJsonSchema"],o);const u=p(t,["response"]);u!=null&&h(e,["response"],u);const d=p(t,["responseJsonSchema"]);return d!=null&&h(e,["responseJsonSchema"],d),e}function UI(t,e){const n={},s=p(e,["name"]);return s!=null&&h(n,["_url","name"],Es(t,s)),n}function OI(t,e){const n={},s=p(e,["name"]);return s!=null&&h(n,["_url","name"],Es(t,s)),n}function qI(t){const e={};if(p(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=p(t,["enableWidget"]);return n!=null&&h(e,["enableWidget"],n),e}function BI(t){const e={};if(p(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(p(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=p(t,["timeRangeFilter"]);return n!=null&&h(e,["timeRangeFilter"],n),e}function FI(t,e){const n={},s=p(t,["pageSize"]);e!==void 0&&s!=null&&h(e,["_query","pageSize"],s);const i=p(t,["pageToken"]);return e!==void 0&&i!=null&&h(e,["_query","pageToken"],i),n}function $I(t,e){const n={},s=p(t,["pageSize"]);e!==void 0&&s!=null&&h(e,["_query","pageSize"],s);const i=p(t,["pageToken"]);return e!==void 0&&i!=null&&h(e,["_query","pageToken"],i),n}function HI(t){const e={},n=p(t,["config"]);return n!=null&&FI(n,e),e}function GI(t){const e={},n=p(t,["config"]);return n!=null&&$I(n,e),e}function VI(t){const e={},n=p(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=p(t,["nextPageToken"]);s!=null&&h(e,["nextPageToken"],s);const i=p(t,["cachedContents"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(u=>u)),h(e,["cachedContents"],o)}return e}function zI(t){const e={},n=p(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=p(t,["nextPageToken"]);s!=null&&h(e,["nextPageToken"],s);const i=p(t,["cachedContents"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(u=>u)),h(e,["cachedContents"],o)}return e}function jI(t){const e={},n=p(t,["functionCall"]);n!=null&&h(e,["functionCall"],n);const s=p(t,["codeExecutionResult"]);s!=null&&h(e,["codeExecutionResult"],s);const i=p(t,["executableCode"]);i!=null&&h(e,["executableCode"],i);const o=p(t,["fileData"]);o!=null&&h(e,["fileData"],LI(o));const u=p(t,["functionResponse"]);u!=null&&h(e,["functionResponse"],u);const d=p(t,["inlineData"]);d!=null&&h(e,["inlineData"],CI(d));const m=p(t,["text"]);m!=null&&h(e,["text"],m);const f=p(t,["thought"]);f!=null&&h(e,["thought"],f);const y=p(t,["thoughtSignature"]);y!=null&&h(e,["thoughtSignature"],y);const S=p(t,["videoMetadata"]);return S!=null&&h(e,["videoMetadata"],S),e}function YI(t){const e={},n=p(t,["functionDeclarations"]);if(n!=null){let y=n;Array.isArray(y)&&(y=y.map(S=>S)),h(e,["functionDeclarations"],y)}if(p(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=p(t,["googleSearchRetrieval"]);s!=null&&h(e,["googleSearchRetrieval"],s);const i=p(t,["computerUse"]);i!=null&&h(e,["computerUse"],i);const o=p(t,["fileSearch"]);o!=null&&h(e,["fileSearch"],o);const u=p(t,["codeExecution"]);if(u!=null&&h(e,["codeExecution"],u),p(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const d=p(t,["googleMaps"]);d!=null&&h(e,["googleMaps"],qI(d));const m=p(t,["googleSearch"]);m!=null&&h(e,["googleSearch"],BI(m));const f=p(t,["urlContext"]);return f!=null&&h(e,["urlContext"],f),e}function JI(t){const e={},n=p(t,["functionDeclarations"]);if(n!=null){let S=n;Array.isArray(S)&&(S=S.map(_=>kI(_))),h(e,["functionDeclarations"],S)}const s=p(t,["retrieval"]);s!=null&&h(e,["retrieval"],s);const i=p(t,["googleSearchRetrieval"]);i!=null&&h(e,["googleSearchRetrieval"],i);const o=p(t,["computerUse"]);if(o!=null&&h(e,["computerUse"],o),p(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const u=p(t,["codeExecution"]);u!=null&&h(e,["codeExecution"],u);const d=p(t,["enterpriseWebSearch"]);d!=null&&h(e,["enterpriseWebSearch"],d);const m=p(t,["googleMaps"]);m!=null&&h(e,["googleMaps"],m);const f=p(t,["googleSearch"]);f!=null&&h(e,["googleSearch"],f);const y=p(t,["urlContext"]);return y!=null&&h(e,["urlContext"],y),e}function KI(t,e){const n={},s=p(t,["ttl"]);e!==void 0&&s!=null&&h(e,["ttl"],s);const i=p(t,["expireTime"]);return e!==void 0&&i!=null&&h(e,["expireTime"],i),n}function XI(t,e){const n={},s=p(t,["ttl"]);e!==void 0&&s!=null&&h(e,["ttl"],s);const i=p(t,["expireTime"]);return e!==void 0&&i!=null&&h(e,["expireTime"],i),n}function QI(t,e){const n={},s=p(e,["name"]);s!=null&&h(n,["_url","name"],Es(t,s));const i=p(e,["config"]);return i!=null&&KI(i,n),n}function WI(t,e){const n={},s=p(e,["name"]);s!=null&&h(n,["_url","name"],Es(t,s));const i=p(e,["config"]);return i!=null&&XI(i,n),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ZI extends As{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new Ha(Cs.PAGED_ITEM_CACHED_CONTENTS,s=>this.listInternal(s),await this.listInternal(n),n)}async create(e){var n,s,i,o;let u,d="",m={};if(this.apiClient.isVertexAI()){const f=II(this.apiClient,e);return d=de("cachedContents",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json()),u.then(y=>y)}else{const f=NI(this.apiClient,e);return d=de("cachedContents",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(y=>y.json()),u.then(y=>y)}}async get(e){var n,s,i,o;let u,d="",m={};if(this.apiClient.isVertexAI()){const f=OI(this.apiClient,e);return d=de("{name}",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json()),u.then(y=>y)}else{const f=UI(this.apiClient,e);return d=de("{name}",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(y=>y.json()),u.then(y=>y)}}async delete(e){var n,s,i,o;let u,d="",m={};if(this.apiClient.isVertexAI()){const f=MI(this.apiClient,e);return d=de("{name}",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json().then(S=>{const _=S;return _.sdkHttpResponse={headers:y.headers},_})),u.then(y=>{const S=DI(y),_=new RS;return Object.assign(_,S),_})}else{const f=RI(this.apiClient,e);return d=de("{name}",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(y=>y.json().then(S=>{const _=S;return _.sdkHttpResponse={headers:y.headers},_})),u.then(y=>{const S=PI(y),_=new RS;return Object.assign(_,S),_})}}async update(e){var n,s,i,o;let u,d="",m={};if(this.apiClient.isVertexAI()){const f=WI(this.apiClient,e);return d=de("{name}",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json()),u.then(y=>y)}else{const f=QI(this.apiClient,e);return d=de("{name}",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(y=>y.json()),u.then(y=>y)}}async listInternal(e){var n,s,i,o;let u,d="",m={};if(this.apiClient.isVertexAI()){const f=GI(e);return d=de("cachedContents",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json().then(S=>{const _=S;return _.sdkHttpResponse={headers:y.headers},_})),u.then(y=>{const S=zI(y),_=new MS;return Object.assign(_,S),_})}else{const f=HI(e);return d=de("cachedContents",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(y=>y.json().then(S=>{const _=S;return _.sdkHttpResponse={headers:y.headers},_})),u.then(y=>{const S=VI(y),_=new MS;return Object.assign(_,S),_})}}}function qS(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],s=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function at(t){return this instanceof at?(this.v=t,this):new at(t)}function Vr(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=n.apply(t,e||[]),i,o=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),d("next"),d("throw"),d("return",u),i[Symbol.asyncIterator]=function(){return this},i;function u(T){return function(C){return Promise.resolve(C).then(T,S)}}function d(T,C){s[T]&&(i[T]=function(N){return new Promise(function(E,L){o.push([T,N,E,L])>1||m(T,N)})},C&&(i[T]=C(i[T])))}function m(T,C){try{f(s[T](C))}catch(N){_(o[0][3],N)}}function f(T){T.value instanceof at?Promise.resolve(T.value.v).then(y,S):_(o[0][2],T)}function y(T){m("next",T)}function S(T){m("throw",T)}function _(T,C){T(C),o.shift(),o.length&&m(o[0][0],o[0][1])}}function fo(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof qS=="function"?qS(t):t[Symbol.iterator](),n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n);function s(o){n[o]=t[o]&&function(u){return new Promise(function(d,m){u=t[o](u),i(d,m,u.done,u.value)})}}function i(o,u,d,m){Promise.resolve(m).then(function(f){o({value:f,done:d})},u)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function eR(t){var e;if(t.candidates==null||t.candidates.length===0)return!1;const n=(e=t.candidates[0])===null||e===void 0?void 0:e.content;return n===void 0?!1:nx(n)}function nx(t){if(t.parts===void 0||t.parts.length===0)return!1;for(const e of t.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function tR(t){if(t.length!==0){for(const e of t)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function BS(t){if(t===void 0||t.length===0)return[];const e=[],n=t.length;let s=0;for(;s<n;)if(t[s].role==="user")e.push(t[s]),s++;else{const i=[];let o=!0;for(;s<n&&t[s].role==="model";)i.push(t[s]),o&&!nx(t[s])&&(o=!1),s++;o?e.push(...i):e.pop()}return e}class nR{constructor(e,n){this.modelsModule=e,this.apiClient=n}create(e){return new sR(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}let sR=class{constructor(e,n,s,i={},o=[]){this.apiClient=e,this.modelsModule=n,this.model=s,this.config=i,this.history=o,this.sendPromise=Promise.resolve(),tR(o)}async sendMessage(e){var n;await this.sendPromise;const s=Bt(e.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(s),config:(n=e.config)!==null&&n!==void 0?n:this.config});return this.sendPromise=(async()=>{var o,u,d;const m=await i,f=(u=(o=m.candidates)===null||o===void 0?void 0:o[0])===null||u===void 0?void 0:u.content,y=m.automaticFunctionCallingHistory,S=this.getHistory(!0).length;let _=[];y!=null&&(_=(d=y.slice(S))!==null&&d!==void 0?d:[]);const T=f?[f]:[];this.recordHistory(s,T,_)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),i}async sendMessageStream(e){var n;await this.sendPromise;const s=Bt(e.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(s),config:(n=e.config)!==null&&n!==void 0?n:this.config});this.sendPromise=i.then(()=>{}).catch(()=>{});const o=await i;return this.processStreamResponse(o,s)}getHistory(e=!1){const n=e?BS(this.history):this.history;return structuredClone(n)}processStreamResponse(e,n){var s,i;return Vr(this,arguments,function*(){var u,d,m,f;const y=[];try{for(var S=!0,_=fo(e),T;T=yield at(_.next()),u=T.done,!u;S=!0){f=T.value,S=!1;const C=f;if(eR(C)){const N=(i=(s=C.candidates)===null||s===void 0?void 0:s[0])===null||i===void 0?void 0:i.content;N!==void 0&&y.push(N)}yield yield at(C)}}catch(C){d={error:C}}finally{try{!S&&!u&&(m=_.return)&&(yield at(m.call(_)))}finally{if(d)throw d.error}}this.recordHistory(n,y)})}recordHistory(e,n,s){let i=[];n.length>0&&n.every(o=>o.role!==void 0)?i=n:i.push({role:"model",parts:[]}),s&&s.length>0?this.history.push(...BS(s)):this.history.push(e),this.history.push(...i)}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Hu extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,Hu.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function aR(t){const e={},n=p(t,["file"]);return n!=null&&h(e,["file"],n),e}function rR(t){const e={},n=p(t,["sdkHttpResponse"]);return n!=null&&h(e,["sdkHttpResponse"],n),e}function iR(t){const e={},n=p(t,["name"]);return n!=null&&h(e,["_url","file"],K_(n)),e}function oR(t){const e={},n=p(t,["sdkHttpResponse"]);return n!=null&&h(e,["sdkHttpResponse"],n),e}function lR(t){const e={},n=p(t,["name"]);return n!=null&&h(e,["_url","file"],K_(n)),e}function uR(t,e){const n={},s=p(t,["pageSize"]);e!==void 0&&s!=null&&h(e,["_query","pageSize"],s);const i=p(t,["pageToken"]);return e!==void 0&&i!=null&&h(e,["_query","pageToken"],i),n}function cR(t){const e={},n=p(t,["config"]);return n!=null&&uR(n,e),e}function dR(t){const e={},n=p(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=p(t,["nextPageToken"]);s!=null&&h(e,["nextPageToken"],s);const i=p(t,["files"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(u=>u)),h(e,["files"],o)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let fR=class extends As{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new Ha(Cs.PAGED_ITEM_FILES,s=>this.listInternal(s),await this.listInternal(n),n)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(n=>n)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=cR(e);return o=de("files",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json().then(f=>{const y=f;return y.sdkHttpResponse={headers:m.headers},y})),i.then(m=>{const f=dR(m),y=new bN;return Object.assign(y,f),y})}}async createInternal(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=aR(e);return o=de("upload/v1beta/files",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json()),i.then(m=>{const f=rR(m),y=new TN;return Object.assign(y,f),y})}}async get(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=lR(e);return o=de("files/{file}",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json()),i.then(m=>m)}}async delete(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=iR(e);return o=de("files/{file}",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json().then(f=>{const y=f;return y.sdkHttpResponse={headers:m.headers},y})),i.then(m=>{const f=oR(m),y=new CN;return Object.assign(y,f),y})}}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function hu(t){const e={},n=p(t,["data"]);if(n!=null&&h(e,["data"],n),p(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=p(t,["mimeType"]);return s!=null&&h(e,["mimeType"],s),e}function pR(t){const e={},n=p(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>NR(o))),h(e,["parts"],i)}const s=p(t,["role"]);return s!=null&&h(e,["role"],s),e}function mR(t){const e={};if(p(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=p(t,["fileUri"]);n!=null&&h(e,["fileUri"],n);const s=p(t,["mimeType"]);return s!=null&&h(e,["mimeType"],s),e}function hR(t){const e={};if(p(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=p(t,["description"]);n!=null&&h(e,["description"],n);const s=p(t,["name"]);s!=null&&h(e,["name"],s);const i=p(t,["parameters"]);i!=null&&h(e,["parameters"],i);const o=p(t,["parametersJsonSchema"]);o!=null&&h(e,["parametersJsonSchema"],o);const u=p(t,["response"]);u!=null&&h(e,["response"],u);const d=p(t,["responseJsonSchema"]);return d!=null&&h(e,["responseJsonSchema"],d),e}function gR(t){const e={},n=p(t,["modelSelectionConfig"]);n!=null&&h(e,["modelConfig"],n);const s=p(t,["responseJsonSchema"]);s!=null&&h(e,["responseJsonSchema"],s);const i=p(t,["audioTimestamp"]);i!=null&&h(e,["audioTimestamp"],i);const o=p(t,["candidateCount"]);o!=null&&h(e,["candidateCount"],o);const u=p(t,["enableAffectiveDialog"]);u!=null&&h(e,["enableAffectiveDialog"],u);const d=p(t,["frequencyPenalty"]);d!=null&&h(e,["frequencyPenalty"],d);const m=p(t,["logprobs"]);m!=null&&h(e,["logprobs"],m);const f=p(t,["maxOutputTokens"]);f!=null&&h(e,["maxOutputTokens"],f);const y=p(t,["mediaResolution"]);y!=null&&h(e,["mediaResolution"],y);const S=p(t,["presencePenalty"]);S!=null&&h(e,["presencePenalty"],S);const _=p(t,["responseLogprobs"]);_!=null&&h(e,["responseLogprobs"],_);const T=p(t,["responseMimeType"]);T!=null&&h(e,["responseMimeType"],T);const C=p(t,["responseModalities"]);C!=null&&h(e,["responseModalities"],C);const N=p(t,["responseSchema"]);N!=null&&h(e,["responseSchema"],N);const E=p(t,["routingConfig"]);E!=null&&h(e,["routingConfig"],E);const L=p(t,["seed"]);L!=null&&h(e,["seed"],L);const B=p(t,["speechConfig"]);B!=null&&h(e,["speechConfig"],sx(B));const O=p(t,["stopSequences"]);O!=null&&h(e,["stopSequences"],O);const x=p(t,["temperature"]);x!=null&&h(e,["temperature"],x);const I=p(t,["thinkingConfig"]);I!=null&&h(e,["thinkingConfig"],I);const D=p(t,["topK"]);D!=null&&h(e,["topK"],D);const R=p(t,["topP"]);if(R!=null&&h(e,["topP"],R),p(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function yR(t){const e={};if(p(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=p(t,["enableWidget"]);return n!=null&&h(e,["enableWidget"],n),e}function vR(t){const e={};if(p(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(p(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=p(t,["timeRangeFilter"]);return n!=null&&h(e,["timeRangeFilter"],n),e}function SR(t,e){const n={},s=p(t,["generationConfig"]);e!==void 0&&s!=null&&h(e,["setup","generationConfig"],s);const i=p(t,["responseModalities"]);e!==void 0&&i!=null&&h(e,["setup","generationConfig","responseModalities"],i);const o=p(t,["temperature"]);e!==void 0&&o!=null&&h(e,["setup","generationConfig","temperature"],o);const u=p(t,["topP"]);e!==void 0&&u!=null&&h(e,["setup","generationConfig","topP"],u);const d=p(t,["topK"]);e!==void 0&&d!=null&&h(e,["setup","generationConfig","topK"],d);const m=p(t,["maxOutputTokens"]);e!==void 0&&m!=null&&h(e,["setup","generationConfig","maxOutputTokens"],m);const f=p(t,["mediaResolution"]);e!==void 0&&f!=null&&h(e,["setup","generationConfig","mediaResolution"],f);const y=p(t,["seed"]);e!==void 0&&y!=null&&h(e,["setup","generationConfig","seed"],y);const S=p(t,["speechConfig"]);e!==void 0&&S!=null&&h(e,["setup","generationConfig","speechConfig"],rm(S));const _=p(t,["thinkingConfig"]);e!==void 0&&_!=null&&h(e,["setup","generationConfig","thinkingConfig"],_);const T=p(t,["enableAffectiveDialog"]);e!==void 0&&T!=null&&h(e,["setup","generationConfig","enableAffectiveDialog"],T);const C=p(t,["systemInstruction"]);e!==void 0&&C!=null&&h(e,["setup","systemInstruction"],pR(Bt(C)));const N=p(t,["tools"]);if(e!==void 0&&N!=null){let D=Zr(N);Array.isArray(D)&&(D=D.map(R=>RR(Wr(R)))),h(e,["setup","tools"],D)}const E=p(t,["sessionResumption"]);e!==void 0&&E!=null&&h(e,["setup","sessionResumption"],IR(E));const L=p(t,["inputAudioTranscription"]);e!==void 0&&L!=null&&h(e,["setup","inputAudioTranscription"],L);const B=p(t,["outputAudioTranscription"]);e!==void 0&&B!=null&&h(e,["setup","outputAudioTranscription"],B);const O=p(t,["realtimeInputConfig"]);e!==void 0&&O!=null&&h(e,["setup","realtimeInputConfig"],O);const x=p(t,["contextWindowCompression"]);e!==void 0&&x!=null&&h(e,["setup","contextWindowCompression"],x);const I=p(t,["proactivity"]);return e!==void 0&&I!=null&&h(e,["setup","proactivity"],I),n}function wR(t,e){const n={},s=p(t,["generationConfig"]);e!==void 0&&s!=null&&h(e,["setup","generationConfig"],gR(s));const i=p(t,["responseModalities"]);e!==void 0&&i!=null&&h(e,["setup","generationConfig","responseModalities"],i);const o=p(t,["temperature"]);e!==void 0&&o!=null&&h(e,["setup","generationConfig","temperature"],o);const u=p(t,["topP"]);e!==void 0&&u!=null&&h(e,["setup","generationConfig","topP"],u);const d=p(t,["topK"]);e!==void 0&&d!=null&&h(e,["setup","generationConfig","topK"],d);const m=p(t,["maxOutputTokens"]);e!==void 0&&m!=null&&h(e,["setup","generationConfig","maxOutputTokens"],m);const f=p(t,["mediaResolution"]);e!==void 0&&f!=null&&h(e,["setup","generationConfig","mediaResolution"],f);const y=p(t,["seed"]);e!==void 0&&y!=null&&h(e,["setup","generationConfig","seed"],y);const S=p(t,["speechConfig"]);e!==void 0&&S!=null&&h(e,["setup","generationConfig","speechConfig"],sx(rm(S)));const _=p(t,["thinkingConfig"]);e!==void 0&&_!=null&&h(e,["setup","generationConfig","thinkingConfig"],_);const T=p(t,["enableAffectiveDialog"]);e!==void 0&&T!=null&&h(e,["setup","generationConfig","enableAffectiveDialog"],T);const C=p(t,["systemInstruction"]);e!==void 0&&C!=null&&h(e,["setup","systemInstruction"],Bt(C));const N=p(t,["tools"]);if(e!==void 0&&N!=null){let D=Zr(N);Array.isArray(D)&&(D=D.map(R=>MR(Wr(R)))),h(e,["setup","tools"],D)}const E=p(t,["sessionResumption"]);e!==void 0&&E!=null&&h(e,["setup","sessionResumption"],E);const L=p(t,["inputAudioTranscription"]);e!==void 0&&L!=null&&h(e,["setup","inputAudioTranscription"],L);const B=p(t,["outputAudioTranscription"]);e!==void 0&&B!=null&&h(e,["setup","outputAudioTranscription"],B);const O=p(t,["realtimeInputConfig"]);e!==void 0&&O!=null&&h(e,["setup","realtimeInputConfig"],O);const x=p(t,["contextWindowCompression"]);e!==void 0&&x!=null&&h(e,["setup","contextWindowCompression"],x);const I=p(t,["proactivity"]);return e!==void 0&&I!=null&&h(e,["setup","proactivity"],I),n}function _R(t,e){const n={},s=p(e,["model"]);s!=null&&h(n,["setup","model"],Ge(t,s));const i=p(e,["config"]);return i!=null&&h(n,["config"],SR(i,n)),n}function xR(t,e){const n={},s=p(e,["model"]);s!=null&&h(n,["setup","model"],Ge(t,s));const i=p(e,["config"]);return i!=null&&h(n,["config"],wR(i,n)),n}function bR(t){const e={},n=p(t,["musicGenerationConfig"]);return n!=null&&h(e,["musicGenerationConfig"],n),e}function TR(t){const e={},n=p(t,["weightedPrompts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(i=>i)),h(e,["weightedPrompts"],s)}return e}function CR(t){const e={},n=p(t,["media"]);if(n!=null){let f=V_(n);Array.isArray(f)&&(f=f.map(y=>hu(y))),h(e,["mediaChunks"],f)}const s=p(t,["audio"]);s!=null&&h(e,["audio"],hu(j_(s)));const i=p(t,["audioStreamEnd"]);i!=null&&h(e,["audioStreamEnd"],i);const o=p(t,["video"]);o!=null&&h(e,["video"],hu(z_(o)));const u=p(t,["text"]);u!=null&&h(e,["text"],u);const d=p(t,["activityStart"]);d!=null&&h(e,["activityStart"],d);const m=p(t,["activityEnd"]);return m!=null&&h(e,["activityEnd"],m),e}function AR(t){const e={},n=p(t,["media"]);if(n!=null){let f=V_(n);Array.isArray(f)&&(f=f.map(y=>y)),h(e,["mediaChunks"],f)}const s=p(t,["audio"]);s!=null&&h(e,["audio"],j_(s));const i=p(t,["audioStreamEnd"]);i!=null&&h(e,["audioStreamEnd"],i);const o=p(t,["video"]);o!=null&&h(e,["video"],z_(o));const u=p(t,["text"]);u!=null&&h(e,["text"],u);const d=p(t,["activityStart"]);d!=null&&h(e,["activityStart"],d);const m=p(t,["activityEnd"]);return m!=null&&h(e,["activityEnd"],m),e}function ER(t){const e={},n=p(t,["setupComplete"]);n!=null&&h(e,["setupComplete"],n);const s=p(t,["serverContent"]);s!=null&&h(e,["serverContent"],s);const i=p(t,["toolCall"]);i!=null&&h(e,["toolCall"],i);const o=p(t,["toolCallCancellation"]);o!=null&&h(e,["toolCallCancellation"],o);const u=p(t,["usageMetadata"]);u!=null&&h(e,["usageMetadata"],PR(u));const d=p(t,["goAway"]);d!=null&&h(e,["goAway"],d);const m=p(t,["sessionResumptionUpdate"]);return m!=null&&h(e,["sessionResumptionUpdate"],m),e}function NR(t){const e={},n=p(t,["functionCall"]);n!=null&&h(e,["functionCall"],n);const s=p(t,["codeExecutionResult"]);s!=null&&h(e,["codeExecutionResult"],s);const i=p(t,["executableCode"]);i!=null&&h(e,["executableCode"],i);const o=p(t,["fileData"]);o!=null&&h(e,["fileData"],mR(o));const u=p(t,["functionResponse"]);u!=null&&h(e,["functionResponse"],u);const d=p(t,["inlineData"]);d!=null&&h(e,["inlineData"],hu(d));const m=p(t,["text"]);m!=null&&h(e,["text"],m);const f=p(t,["thought"]);f!=null&&h(e,["thought"],f);const y=p(t,["thoughtSignature"]);y!=null&&h(e,["thoughtSignature"],y);const S=p(t,["videoMetadata"]);return S!=null&&h(e,["videoMetadata"],S),e}function IR(t){const e={},n=p(t,["handle"]);if(n!=null&&h(e,["handle"],n),p(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function sx(t){const e={},n=p(t,["languageCode"]);n!=null&&h(e,["languageCode"],n);const s=p(t,["voiceConfig"]);if(s!=null&&h(e,["voiceConfig"],s),p(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function RR(t){const e={},n=p(t,["functionDeclarations"]);if(n!=null){let y=n;Array.isArray(y)&&(y=y.map(S=>S)),h(e,["functionDeclarations"],y)}if(p(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=p(t,["googleSearchRetrieval"]);s!=null&&h(e,["googleSearchRetrieval"],s);const i=p(t,["computerUse"]);i!=null&&h(e,["computerUse"],i);const o=p(t,["fileSearch"]);o!=null&&h(e,["fileSearch"],o);const u=p(t,["codeExecution"]);if(u!=null&&h(e,["codeExecution"],u),p(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const d=p(t,["googleMaps"]);d!=null&&h(e,["googleMaps"],yR(d));const m=p(t,["googleSearch"]);m!=null&&h(e,["googleSearch"],vR(m));const f=p(t,["urlContext"]);return f!=null&&h(e,["urlContext"],f),e}function MR(t){const e={},n=p(t,["functionDeclarations"]);if(n!=null){let S=n;Array.isArray(S)&&(S=S.map(_=>hR(_))),h(e,["functionDeclarations"],S)}const s=p(t,["retrieval"]);s!=null&&h(e,["retrieval"],s);const i=p(t,["googleSearchRetrieval"]);i!=null&&h(e,["googleSearchRetrieval"],i);const o=p(t,["computerUse"]);if(o!=null&&h(e,["computerUse"],o),p(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const u=p(t,["codeExecution"]);u!=null&&h(e,["codeExecution"],u);const d=p(t,["enterpriseWebSearch"]);d!=null&&h(e,["enterpriseWebSearch"],d);const m=p(t,["googleMaps"]);m!=null&&h(e,["googleMaps"],m);const f=p(t,["googleSearch"]);f!=null&&h(e,["googleSearch"],f);const y=p(t,["urlContext"]);return y!=null&&h(e,["urlContext"],y),e}function PR(t){const e={},n=p(t,["promptTokenCount"]);n!=null&&h(e,["promptTokenCount"],n);const s=p(t,["cachedContentTokenCount"]);s!=null&&h(e,["cachedContentTokenCount"],s);const i=p(t,["candidatesTokenCount"]);i!=null&&h(e,["responseTokenCount"],i);const o=p(t,["toolUsePromptTokenCount"]);o!=null&&h(e,["toolUsePromptTokenCount"],o);const u=p(t,["thoughtsTokenCount"]);u!=null&&h(e,["thoughtsTokenCount"],u);const d=p(t,["totalTokenCount"]);d!=null&&h(e,["totalTokenCount"],d);const m=p(t,["promptTokensDetails"]);if(m!=null){let T=m;Array.isArray(T)&&(T=T.map(C=>C)),h(e,["promptTokensDetails"],T)}const f=p(t,["cacheTokensDetails"]);if(f!=null){let T=f;Array.isArray(T)&&(T=T.map(C=>C)),h(e,["cacheTokensDetails"],T)}const y=p(t,["candidatesTokensDetails"]);if(y!=null){let T=y;Array.isArray(T)&&(T=T.map(C=>C)),h(e,["responseTokensDetails"],T)}const S=p(t,["toolUsePromptTokensDetails"]);if(S!=null){let T=S;Array.isArray(T)&&(T=T.map(C=>C)),h(e,["toolUsePromptTokensDetails"],T)}const _=p(t,["trafficType"]);return _!=null&&h(e,["trafficType"],_),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function DR(t){const e={},n=p(t,["data"]);if(n!=null&&h(e,["data"],n),p(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=p(t,["mimeType"]);return s!=null&&h(e,["mimeType"],s),e}function LR(t){const e={},n=p(t,["content"]);n!=null&&h(e,["content"],n);const s=p(t,["citationMetadata"]);s!=null&&h(e,["citationMetadata"],kR(s));const i=p(t,["tokenCount"]);i!=null&&h(e,["tokenCount"],i);const o=p(t,["finishReason"]);o!=null&&h(e,["finishReason"],o);const u=p(t,["avgLogprobs"]);u!=null&&h(e,["avgLogprobs"],u);const d=p(t,["groundingMetadata"]);d!=null&&h(e,["groundingMetadata"],d);const m=p(t,["index"]);m!=null&&h(e,["index"],m);const f=p(t,["logprobsResult"]);f!=null&&h(e,["logprobsResult"],f);const y=p(t,["safetyRatings"]);if(y!=null){let _=y;Array.isArray(_)&&(_=_.map(T=>T)),h(e,["safetyRatings"],_)}const S=p(t,["urlContextMetadata"]);return S!=null&&h(e,["urlContextMetadata"],S),e}function kR(t){const e={},n=p(t,["citationSources"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(i=>i)),h(e,["citations"],s)}return e}function UR(t,e){const n={},s=p(e,["model"]);s!=null&&h(n,["_url","model"],Ge(t,s));const i=p(e,["contents"]);if(i!=null){let o=An(i);Array.isArray(o)&&(o=o.map(u=>u)),h(n,["contents"],o)}return n}function OR(t){const e={},n=p(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=p(t,["tokensInfo"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(o=>o)),h(e,["tokensInfo"],i)}return e}function qR(t){const e={},n=p(t,["values"]);n!=null&&h(e,["values"],n);const s=p(t,["statistics"]);return s!=null&&h(e,["statistics"],BR(s)),e}function BR(t){const e={},n=p(t,["truncated"]);n!=null&&h(e,["truncated"],n);const s=p(t,["token_count"]);return s!=null&&h(e,["tokenCount"],s),e}function Gu(t){const e={},n=p(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>VM(o))),h(e,["parts"],i)}const s=p(t,["role"]);return s!=null&&h(e,["role"],s),e}function FR(t){const e={},n=p(t,["controlType"]);n!=null&&h(e,["controlType"],n);const s=p(t,["enableControlImageComputation"]);return s!=null&&h(e,["computeControl"],s),e}function $R(t){const e={};if(p(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(p(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(p(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function HR(t,e){const n={},s=p(t,["systemInstruction"]);e!==void 0&&s!=null&&h(e,["systemInstruction"],Bt(s));const i=p(t,["tools"]);if(e!==void 0&&i!=null){let u=i;Array.isArray(u)&&(u=u.map(d=>lx(d))),h(e,["tools"],u)}const o=p(t,["generationConfig"]);return e!==void 0&&o!=null&&h(e,["generationConfig"],MM(o)),n}function GR(t,e){const n={},s=p(e,["model"]);s!=null&&h(n,["_url","model"],Ge(t,s));const i=p(e,["contents"]);if(i!=null){let u=An(i);Array.isArray(u)&&(u=u.map(d=>Gu(d))),h(n,["contents"],u)}const o=p(e,["config"]);return o!=null&&$R(o),n}function VR(t,e){const n={},s=p(e,["model"]);s!=null&&h(n,["_url","model"],Ge(t,s));const i=p(e,["contents"]);if(i!=null){let u=An(i);Array.isArray(u)&&(u=u.map(d=>d)),h(n,["contents"],u)}const o=p(e,["config"]);return o!=null&&HR(o,n),n}function zR(t){const e={},n=p(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=p(t,["totalTokens"]);s!=null&&h(e,["totalTokens"],s);const i=p(t,["cachedContentTokenCount"]);return i!=null&&h(e,["cachedContentTokenCount"],i),e}function jR(t){const e={},n=p(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=p(t,["totalTokens"]);return s!=null&&h(e,["totalTokens"],s),e}function YR(t,e){const n={},s=p(e,["model"]);return s!=null&&h(n,["_url","name"],Ge(t,s)),n}function JR(t,e){const n={},s=p(e,["model"]);return s!=null&&h(n,["_url","name"],Ge(t,s)),n}function KR(t){const e={},n=p(t,["sdkHttpResponse"]);return n!=null&&h(e,["sdkHttpResponse"],n),e}function XR(t){const e={},n=p(t,["sdkHttpResponse"]);return n!=null&&h(e,["sdkHttpResponse"],n),e}function QR(t,e){const n={},s=p(t,["outputGcsUri"]);e!==void 0&&s!=null&&h(e,["parameters","storageUri"],s);const i=p(t,["negativePrompt"]);e!==void 0&&i!=null&&h(e,["parameters","negativePrompt"],i);const o=p(t,["numberOfImages"]);e!==void 0&&o!=null&&h(e,["parameters","sampleCount"],o);const u=p(t,["aspectRatio"]);e!==void 0&&u!=null&&h(e,["parameters","aspectRatio"],u);const d=p(t,["guidanceScale"]);e!==void 0&&d!=null&&h(e,["parameters","guidanceScale"],d);const m=p(t,["seed"]);e!==void 0&&m!=null&&h(e,["parameters","seed"],m);const f=p(t,["safetyFilterLevel"]);e!==void 0&&f!=null&&h(e,["parameters","safetySetting"],f);const y=p(t,["personGeneration"]);e!==void 0&&y!=null&&h(e,["parameters","personGeneration"],y);const S=p(t,["includeSafetyAttributes"]);e!==void 0&&S!=null&&h(e,["parameters","includeSafetyAttributes"],S);const _=p(t,["includeRaiReason"]);e!==void 0&&_!=null&&h(e,["parameters","includeRaiReason"],_);const T=p(t,["language"]);e!==void 0&&T!=null&&h(e,["parameters","language"],T);const C=p(t,["outputMimeType"]);e!==void 0&&C!=null&&h(e,["parameters","outputOptions","mimeType"],C);const N=p(t,["outputCompressionQuality"]);e!==void 0&&N!=null&&h(e,["parameters","outputOptions","compressionQuality"],N);const E=p(t,["addWatermark"]);e!==void 0&&E!=null&&h(e,["parameters","addWatermark"],E);const L=p(t,["labels"]);e!==void 0&&L!=null&&h(e,["labels"],L);const B=p(t,["editMode"]);e!==void 0&&B!=null&&h(e,["parameters","editMode"],B);const O=p(t,["baseSteps"]);return e!==void 0&&O!=null&&h(e,["parameters","editConfig","baseSteps"],O),n}function WR(t,e){const n={},s=p(e,["model"]);s!=null&&h(n,["_url","model"],Ge(t,s));const i=p(e,["prompt"]);i!=null&&h(n,["instances[0]","prompt"],i);const o=p(e,["referenceImages"]);if(o!=null){let d=o;Array.isArray(d)&&(d=d.map(m=>XM(m))),h(n,["instances[0]","referenceImages"],d)}const u=p(e,["config"]);return u!=null&&QR(u,n),n}function ZR(t){const e={},n=p(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=p(t,["predictions"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(o=>Vu(o))),h(e,["generatedImages"],i)}return e}function eM(t,e){const n={},s=p(t,["taskType"]);e!==void 0&&s!=null&&h(e,["requests[]","taskType"],s);const i=p(t,["title"]);e!==void 0&&i!=null&&h(e,["requests[]","title"],i);const o=p(t,["outputDimensionality"]);if(e!==void 0&&o!=null&&h(e,["requests[]","outputDimensionality"],o),p(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(p(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function tM(t,e){const n={},s=p(t,["taskType"]);e!==void 0&&s!=null&&h(e,["instances[]","task_type"],s);const i=p(t,["title"]);e!==void 0&&i!=null&&h(e,["instances[]","title"],i);const o=p(t,["outputDimensionality"]);e!==void 0&&o!=null&&h(e,["parameters","outputDimensionality"],o);const u=p(t,["mimeType"]);e!==void 0&&u!=null&&h(e,["instances[]","mimeType"],u);const d=p(t,["autoTruncate"]);return e!==void 0&&d!=null&&h(e,["parameters","autoTruncate"],d),n}function nM(t,e){const n={},s=p(e,["model"]);s!=null&&h(n,["_url","model"],Ge(t,s));const i=p(e,["contents"]);if(i!=null){let d=nm(t,i);Array.isArray(d)&&(d=d.map(m=>m)),h(n,["requests[]","content"],d)}const o=p(e,["config"]);o!=null&&eM(o,n);const u=p(e,["model"]);return u!==void 0&&h(n,["requests[]","model"],Ge(t,u)),n}function sM(t,e){const n={},s=p(e,["model"]);s!=null&&h(n,["_url","model"],Ge(t,s));const i=p(e,["contents"]);if(i!=null){let u=nm(t,i);Array.isArray(u)&&(u=u.map(d=>d)),h(n,["instances[]","content"],u)}const o=p(e,["config"]);return o!=null&&tM(o,n),n}function aM(t){const e={},n=p(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=p(t,["embeddings"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(u=>u)),h(e,["embeddings"],o)}const i=p(t,["metadata"]);return i!=null&&h(e,["metadata"],i),e}function rM(t){const e={},n=p(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=p(t,["predictions[]","embeddings"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(u=>qR(u))),h(e,["embeddings"],o)}const i=p(t,["metadata"]);return i!=null&&h(e,["metadata"],i),e}function iM(t){const e={},n=p(t,["endpoint"]);n!=null&&h(e,["name"],n);const s=p(t,["deployedModelId"]);return s!=null&&h(e,["deployedModelId"],s),e}function oM(t){const e={};if(p(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=p(t,["fileUri"]);n!=null&&h(e,["fileUri"],n);const s=p(t,["mimeType"]);return s!=null&&h(e,["mimeType"],s),e}function lM(t){const e={};if(p(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=p(t,["description"]);n!=null&&h(e,["description"],n);const s=p(t,["name"]);s!=null&&h(e,["name"],s);const i=p(t,["parameters"]);i!=null&&h(e,["parameters"],i);const o=p(t,["parametersJsonSchema"]);o!=null&&h(e,["parametersJsonSchema"],o);const u=p(t,["response"]);u!=null&&h(e,["response"],u);const d=p(t,["responseJsonSchema"]);return d!=null&&h(e,["responseJsonSchema"],d),e}function uM(t,e,n){const s={},i=p(e,["systemInstruction"]);n!==void 0&&i!=null&&h(n,["systemInstruction"],Gu(Bt(i)));const o=p(e,["temperature"]);o!=null&&h(s,["temperature"],o);const u=p(e,["topP"]);u!=null&&h(s,["topP"],u);const d=p(e,["topK"]);d!=null&&h(s,["topK"],d);const m=p(e,["candidateCount"]);m!=null&&h(s,["candidateCount"],m);const f=p(e,["maxOutputTokens"]);f!=null&&h(s,["maxOutputTokens"],f);const y=p(e,["stopSequences"]);y!=null&&h(s,["stopSequences"],y);const S=p(e,["responseLogprobs"]);S!=null&&h(s,["responseLogprobs"],S);const _=p(e,["logprobs"]);_!=null&&h(s,["logprobs"],_);const T=p(e,["presencePenalty"]);T!=null&&h(s,["presencePenalty"],T);const C=p(e,["frequencyPenalty"]);C!=null&&h(s,["frequencyPenalty"],C);const N=p(e,["seed"]);N!=null&&h(s,["seed"],N);const E=p(e,["responseMimeType"]);E!=null&&h(s,["responseMimeType"],E);const L=p(e,["responseSchema"]);L!=null&&h(s,["responseSchema"],sm(L));const B=p(e,["responseJsonSchema"]);if(B!=null&&h(s,["responseJsonSchema"],B),p(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(p(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const O=p(e,["safetySettings"]);if(n!==void 0&&O!=null){let U=O;Array.isArray(U)&&(U=U.map(z=>QM(z))),h(n,["safetySettings"],U)}const x=p(e,["tools"]);if(n!==void 0&&x!=null){let U=Zr(x);Array.isArray(U)&&(U=U.map(z=>s1(Wr(z)))),h(n,["tools"],U)}const I=p(e,["toolConfig"]);if(n!==void 0&&I!=null&&h(n,["toolConfig"],I),p(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const D=p(e,["cachedContent"]);n!==void 0&&D!=null&&h(n,["cachedContent"],Es(t,D));const R=p(e,["responseModalities"]);R!=null&&h(s,["responseModalities"],R);const P=p(e,["mediaResolution"]);P!=null&&h(s,["mediaResolution"],P);const A=p(e,["speechConfig"]);if(A!=null&&h(s,["speechConfig"],am(A)),p(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const k=p(e,["thinkingConfig"]);k!=null&&h(s,["thinkingConfig"],k);const F=p(e,["imageConfig"]);return F!=null&&h(s,["imageConfig"],F),s}function cM(t,e,n){const s={},i=p(e,["systemInstruction"]);n!==void 0&&i!=null&&h(n,["systemInstruction"],Bt(i));const o=p(e,["temperature"]);o!=null&&h(s,["temperature"],o);const u=p(e,["topP"]);u!=null&&h(s,["topP"],u);const d=p(e,["topK"]);d!=null&&h(s,["topK"],d);const m=p(e,["candidateCount"]);m!=null&&h(s,["candidateCount"],m);const f=p(e,["maxOutputTokens"]);f!=null&&h(s,["maxOutputTokens"],f);const y=p(e,["stopSequences"]);y!=null&&h(s,["stopSequences"],y);const S=p(e,["responseLogprobs"]);S!=null&&h(s,["responseLogprobs"],S);const _=p(e,["logprobs"]);_!=null&&h(s,["logprobs"],_);const T=p(e,["presencePenalty"]);T!=null&&h(s,["presencePenalty"],T);const C=p(e,["frequencyPenalty"]);C!=null&&h(s,["frequencyPenalty"],C);const N=p(e,["seed"]);N!=null&&h(s,["seed"],N);const E=p(e,["responseMimeType"]);E!=null&&h(s,["responseMimeType"],E);const L=p(e,["responseSchema"]);L!=null&&h(s,["responseSchema"],sm(L));const B=p(e,["responseJsonSchema"]);B!=null&&h(s,["responseJsonSchema"],B);const O=p(e,["routingConfig"]);O!=null&&h(s,["routingConfig"],O);const x=p(e,["modelSelectionConfig"]);x!=null&&h(s,["modelConfig"],x);const I=p(e,["safetySettings"]);if(n!==void 0&&I!=null){let q=I;Array.isArray(q)&&(q=q.map(j=>j)),h(n,["safetySettings"],q)}const D=p(e,["tools"]);if(n!==void 0&&D!=null){let q=Zr(D);Array.isArray(q)&&(q=q.map(j=>lx(Wr(j)))),h(n,["tools"],q)}const R=p(e,["toolConfig"]);n!==void 0&&R!=null&&h(n,["toolConfig"],R);const P=p(e,["labels"]);n!==void 0&&P!=null&&h(n,["labels"],P);const A=p(e,["cachedContent"]);n!==void 0&&A!=null&&h(n,["cachedContent"],Es(t,A));const k=p(e,["responseModalities"]);k!=null&&h(s,["responseModalities"],k);const F=p(e,["mediaResolution"]);F!=null&&h(s,["mediaResolution"],F);const U=p(e,["speechConfig"]);U!=null&&h(s,["speechConfig"],ox(am(U)));const z=p(e,["audioTimestamp"]);z!=null&&h(s,["audioTimestamp"],z);const oe=p(e,["thinkingConfig"]);oe!=null&&h(s,["thinkingConfig"],oe);const se=p(e,["imageConfig"]);return se!=null&&h(s,["imageConfig"],se),s}function FS(t,e){const n={},s=p(e,["model"]);s!=null&&h(n,["_url","model"],Ge(t,s));const i=p(e,["contents"]);if(i!=null){let u=An(i);Array.isArray(u)&&(u=u.map(d=>Gu(d))),h(n,["contents"],u)}const o=p(e,["config"]);return o!=null&&h(n,["generationConfig"],uM(t,o,n)),n}function $S(t,e){const n={},s=p(e,["model"]);s!=null&&h(n,["_url","model"],Ge(t,s));const i=p(e,["contents"]);if(i!=null){let u=An(i);Array.isArray(u)&&(u=u.map(d=>d)),h(n,["contents"],u)}const o=p(e,["config"]);return o!=null&&h(n,["generationConfig"],cM(t,o,n)),n}function HS(t){const e={},n=p(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=p(t,["candidates"]);if(s!=null){let m=s;Array.isArray(m)&&(m=m.map(f=>LR(f))),h(e,["candidates"],m)}const i=p(t,["modelVersion"]);i!=null&&h(e,["modelVersion"],i);const o=p(t,["promptFeedback"]);o!=null&&h(e,["promptFeedback"],o);const u=p(t,["responseId"]);u!=null&&h(e,["responseId"],u);const d=p(t,["usageMetadata"]);return d!=null&&h(e,["usageMetadata"],d),e}function GS(t){const e={},n=p(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=p(t,["candidates"]);if(s!=null){let f=s;Array.isArray(f)&&(f=f.map(y=>y)),h(e,["candidates"],f)}const i=p(t,["createTime"]);i!=null&&h(e,["createTime"],i);const o=p(t,["modelVersion"]);o!=null&&h(e,["modelVersion"],o);const u=p(t,["promptFeedback"]);u!=null&&h(e,["promptFeedback"],u);const d=p(t,["responseId"]);d!=null&&h(e,["responseId"],d);const m=p(t,["usageMetadata"]);return m!=null&&h(e,["usageMetadata"],m),e}function dM(t,e){const n={};if(p(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(p(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const s=p(t,["numberOfImages"]);e!==void 0&&s!=null&&h(e,["parameters","sampleCount"],s);const i=p(t,["aspectRatio"]);e!==void 0&&i!=null&&h(e,["parameters","aspectRatio"],i);const o=p(t,["guidanceScale"]);if(e!==void 0&&o!=null&&h(e,["parameters","guidanceScale"],o),p(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const u=p(t,["safetyFilterLevel"]);e!==void 0&&u!=null&&h(e,["parameters","safetySetting"],u);const d=p(t,["personGeneration"]);e!==void 0&&d!=null&&h(e,["parameters","personGeneration"],d);const m=p(t,["includeSafetyAttributes"]);e!==void 0&&m!=null&&h(e,["parameters","includeSafetyAttributes"],m);const f=p(t,["includeRaiReason"]);e!==void 0&&f!=null&&h(e,["parameters","includeRaiReason"],f);const y=p(t,["language"]);e!==void 0&&y!=null&&h(e,["parameters","language"],y);const S=p(t,["outputMimeType"]);e!==void 0&&S!=null&&h(e,["parameters","outputOptions","mimeType"],S);const _=p(t,["outputCompressionQuality"]);if(e!==void 0&&_!=null&&h(e,["parameters","outputOptions","compressionQuality"],_),p(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(p(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const T=p(t,["imageSize"]);if(e!==void 0&&T!=null&&h(e,["parameters","sampleImageSize"],T),p(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function fM(t,e){const n={},s=p(t,["outputGcsUri"]);e!==void 0&&s!=null&&h(e,["parameters","storageUri"],s);const i=p(t,["negativePrompt"]);e!==void 0&&i!=null&&h(e,["parameters","negativePrompt"],i);const o=p(t,["numberOfImages"]);e!==void 0&&o!=null&&h(e,["parameters","sampleCount"],o);const u=p(t,["aspectRatio"]);e!==void 0&&u!=null&&h(e,["parameters","aspectRatio"],u);const d=p(t,["guidanceScale"]);e!==void 0&&d!=null&&h(e,["parameters","guidanceScale"],d);const m=p(t,["seed"]);e!==void 0&&m!=null&&h(e,["parameters","seed"],m);const f=p(t,["safetyFilterLevel"]);e!==void 0&&f!=null&&h(e,["parameters","safetySetting"],f);const y=p(t,["personGeneration"]);e!==void 0&&y!=null&&h(e,["parameters","personGeneration"],y);const S=p(t,["includeSafetyAttributes"]);e!==void 0&&S!=null&&h(e,["parameters","includeSafetyAttributes"],S);const _=p(t,["includeRaiReason"]);e!==void 0&&_!=null&&h(e,["parameters","includeRaiReason"],_);const T=p(t,["language"]);e!==void 0&&T!=null&&h(e,["parameters","language"],T);const C=p(t,["outputMimeType"]);e!==void 0&&C!=null&&h(e,["parameters","outputOptions","mimeType"],C);const N=p(t,["outputCompressionQuality"]);e!==void 0&&N!=null&&h(e,["parameters","outputOptions","compressionQuality"],N);const E=p(t,["addWatermark"]);e!==void 0&&E!=null&&h(e,["parameters","addWatermark"],E);const L=p(t,["labels"]);e!==void 0&&L!=null&&h(e,["labels"],L);const B=p(t,["imageSize"]);e!==void 0&&B!=null&&h(e,["parameters","sampleImageSize"],B);const O=p(t,["enhancePrompt"]);return e!==void 0&&O!=null&&h(e,["parameters","enhancePrompt"],O),n}function pM(t,e){const n={},s=p(e,["model"]);s!=null&&h(n,["_url","model"],Ge(t,s));const i=p(e,["prompt"]);i!=null&&h(n,["instances[0]","prompt"],i);const o=p(e,["config"]);return o!=null&&dM(o,n),n}function mM(t,e){const n={},s=p(e,["model"]);s!=null&&h(n,["_url","model"],Ge(t,s));const i=p(e,["prompt"]);i!=null&&h(n,["instances[0]","prompt"],i);const o=p(e,["config"]);return o!=null&&fM(o,n),n}function hM(t){const e={},n=p(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=p(t,["predictions"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(u=>EM(u))),h(e,["generatedImages"],o)}const i=p(t,["positivePromptSafetyAttributes"]);return i!=null&&h(e,["positivePromptSafetyAttributes"],rx(i)),e}function gM(t){const e={},n=p(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=p(t,["predictions"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(u=>Vu(u))),h(e,["generatedImages"],o)}const i=p(t,["positivePromptSafetyAttributes"]);return i!=null&&h(e,["positivePromptSafetyAttributes"],ix(i)),e}function yM(t,e){const n={},s=p(t,["numberOfVideos"]);if(e!==void 0&&s!=null&&h(e,["parameters","sampleCount"],s),p(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(p(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const i=p(t,["durationSeconds"]);if(e!==void 0&&i!=null&&h(e,["parameters","durationSeconds"],i),p(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const o=p(t,["aspectRatio"]);e!==void 0&&o!=null&&h(e,["parameters","aspectRatio"],o);const u=p(t,["resolution"]);e!==void 0&&u!=null&&h(e,["parameters","resolution"],u);const d=p(t,["personGeneration"]);if(e!==void 0&&d!=null&&h(e,["parameters","personGeneration"],d),p(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const m=p(t,["negativePrompt"]);e!==void 0&&m!=null&&h(e,["parameters","negativePrompt"],m);const f=p(t,["enhancePrompt"]);if(e!==void 0&&f!=null&&h(e,["parameters","enhancePrompt"],f),p(t,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const y=p(t,["lastFrame"]);e!==void 0&&y!=null&&h(e,["instances[0]","lastFrame"],zu(y));const S=p(t,["referenceImages"]);if(e!==void 0&&S!=null){let _=S;Array.isArray(_)&&(_=_.map(T=>g1(T))),h(e,["instances[0]","referenceImages"],_)}if(p(t,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(p(t,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return n}function vM(t,e){const n={},s=p(t,["numberOfVideos"]);e!==void 0&&s!=null&&h(e,["parameters","sampleCount"],s);const i=p(t,["outputGcsUri"]);e!==void 0&&i!=null&&h(e,["parameters","storageUri"],i);const o=p(t,["fps"]);e!==void 0&&o!=null&&h(e,["parameters","fps"],o);const u=p(t,["durationSeconds"]);e!==void 0&&u!=null&&h(e,["parameters","durationSeconds"],u);const d=p(t,["seed"]);e!==void 0&&d!=null&&h(e,["parameters","seed"],d);const m=p(t,["aspectRatio"]);e!==void 0&&m!=null&&h(e,["parameters","aspectRatio"],m);const f=p(t,["resolution"]);e!==void 0&&f!=null&&h(e,["parameters","resolution"],f);const y=p(t,["personGeneration"]);e!==void 0&&y!=null&&h(e,["parameters","personGeneration"],y);const S=p(t,["pubsubTopic"]);e!==void 0&&S!=null&&h(e,["parameters","pubsubTopic"],S);const _=p(t,["negativePrompt"]);e!==void 0&&_!=null&&h(e,["parameters","negativePrompt"],_);const T=p(t,["enhancePrompt"]);e!==void 0&&T!=null&&h(e,["parameters","enhancePrompt"],T);const C=p(t,["generateAudio"]);e!==void 0&&C!=null&&h(e,["parameters","generateAudio"],C);const N=p(t,["lastFrame"]);e!==void 0&&N!=null&&h(e,["instances[0]","lastFrame"],Un(N));const E=p(t,["referenceImages"]);if(e!==void 0&&E!=null){let O=E;Array.isArray(O)&&(O=O.map(x=>y1(x))),h(e,["instances[0]","referenceImages"],O)}const L=p(t,["mask"]);e!==void 0&&L!=null&&h(e,["instances[0]","mask"],h1(L));const B=p(t,["compressionQuality"]);return e!==void 0&&B!=null&&h(e,["parameters","compressionQuality"],B),n}function SM(t){const e={},n=p(t,["name"]);n!=null&&h(e,["name"],n);const s=p(t,["metadata"]);s!=null&&h(e,["metadata"],s);const i=p(t,["done"]);i!=null&&h(e,["done"],i);const o=p(t,["error"]);o!=null&&h(e,["error"],o);const u=p(t,["response","generateVideoResponse"]);return u!=null&&h(e,["response"],bM(u)),e}function wM(t){const e={},n=p(t,["name"]);n!=null&&h(e,["name"],n);const s=p(t,["metadata"]);s!=null&&h(e,["metadata"],s);const i=p(t,["done"]);i!=null&&h(e,["done"],i);const o=p(t,["error"]);o!=null&&h(e,["error"],o);const u=p(t,["response"]);return u!=null&&h(e,["response"],TM(u)),e}function _M(t,e){const n={},s=p(e,["model"]);s!=null&&h(n,["_url","model"],Ge(t,s));const i=p(e,["prompt"]);i!=null&&h(n,["instances[0]","prompt"],i);const o=p(e,["image"]);o!=null&&h(n,["instances[0]","image"],zu(o));const u=p(e,["video"]);u!=null&&h(n,["instances[0]","video"],ux(u));const d=p(e,["source"]);d!=null&&CM(d,n);const m=p(e,["config"]);return m!=null&&yM(m,n),n}function xM(t,e){const n={},s=p(e,["model"]);s!=null&&h(n,["_url","model"],Ge(t,s));const i=p(e,["prompt"]);i!=null&&h(n,["instances[0]","prompt"],i);const o=p(e,["image"]);o!=null&&h(n,["instances[0]","image"],Un(o));const u=p(e,["video"]);u!=null&&h(n,["instances[0]","video"],cx(u));const d=p(e,["source"]);d!=null&&AM(d,n);const m=p(e,["config"]);return m!=null&&vM(m,n),n}function bM(t){const e={},n=p(t,["generatedSamples"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(u=>IM(u))),h(e,["generatedVideos"],o)}const s=p(t,["raiMediaFilteredCount"]);s!=null&&h(e,["raiMediaFilteredCount"],s);const i=p(t,["raiMediaFilteredReasons"]);return i!=null&&h(e,["raiMediaFilteredReasons"],i),e}function TM(t){const e={},n=p(t,["videos"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(u=>RM(u))),h(e,["generatedVideos"],o)}const s=p(t,["raiMediaFilteredCount"]);s!=null&&h(e,["raiMediaFilteredCount"],s);const i=p(t,["raiMediaFilteredReasons"]);return i!=null&&h(e,["raiMediaFilteredReasons"],i),e}function CM(t,e){const n={},s=p(t,["prompt"]);e!==void 0&&s!=null&&h(e,["instances[0]","prompt"],s);const i=p(t,["image"]);e!==void 0&&i!=null&&h(e,["instances[0]","image"],zu(i));const o=p(t,["video"]);return e!==void 0&&o!=null&&h(e,["instances[0]","video"],ux(o)),n}function AM(t,e){const n={},s=p(t,["prompt"]);e!==void 0&&s!=null&&h(e,["instances[0]","prompt"],s);const i=p(t,["image"]);e!==void 0&&i!=null&&h(e,["instances[0]","image"],Un(i));const o=p(t,["video"]);return e!==void 0&&o!=null&&h(e,["instances[0]","video"],cx(o)),n}function EM(t){const e={},n=p(t,["_self"]);n!=null&&h(e,["image"],UM(n));const s=p(t,["raiFilteredReason"]);s!=null&&h(e,["raiFilteredReason"],s);const i=p(t,["_self"]);return i!=null&&h(e,["safetyAttributes"],rx(i)),e}function Vu(t){const e={},n=p(t,["_self"]);n!=null&&h(e,["image"],ax(n));const s=p(t,["raiFilteredReason"]);s!=null&&h(e,["raiFilteredReason"],s);const i=p(t,["_self"]);i!=null&&h(e,["safetyAttributes"],ix(i));const o=p(t,["prompt"]);return o!=null&&h(e,["enhancedPrompt"],o),e}function NM(t){const e={},n=p(t,["_self"]);n!=null&&h(e,["mask"],ax(n));const s=p(t,["labels"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(o=>o)),h(e,["labels"],i)}return e}function IM(t){const e={},n=p(t,["video"]);return n!=null&&h(e,["video"],p1(n)),e}function RM(t){const e={},n=p(t,["_self"]);return n!=null&&h(e,["video"],m1(n)),e}function MM(t){const e={},n=p(t,["modelSelectionConfig"]);n!=null&&h(e,["modelConfig"],n);const s=p(t,["responseJsonSchema"]);s!=null&&h(e,["responseJsonSchema"],s);const i=p(t,["audioTimestamp"]);i!=null&&h(e,["audioTimestamp"],i);const o=p(t,["candidateCount"]);o!=null&&h(e,["candidateCount"],o);const u=p(t,["enableAffectiveDialog"]);u!=null&&h(e,["enableAffectiveDialog"],u);const d=p(t,["frequencyPenalty"]);d!=null&&h(e,["frequencyPenalty"],d);const m=p(t,["logprobs"]);m!=null&&h(e,["logprobs"],m);const f=p(t,["maxOutputTokens"]);f!=null&&h(e,["maxOutputTokens"],f);const y=p(t,["mediaResolution"]);y!=null&&h(e,["mediaResolution"],y);const S=p(t,["presencePenalty"]);S!=null&&h(e,["presencePenalty"],S);const _=p(t,["responseLogprobs"]);_!=null&&h(e,["responseLogprobs"],_);const T=p(t,["responseMimeType"]);T!=null&&h(e,["responseMimeType"],T);const C=p(t,["responseModalities"]);C!=null&&h(e,["responseModalities"],C);const N=p(t,["responseSchema"]);N!=null&&h(e,["responseSchema"],N);const E=p(t,["routingConfig"]);E!=null&&h(e,["routingConfig"],E);const L=p(t,["seed"]);L!=null&&h(e,["seed"],L);const B=p(t,["speechConfig"]);B!=null&&h(e,["speechConfig"],ox(B));const O=p(t,["stopSequences"]);O!=null&&h(e,["stopSequences"],O);const x=p(t,["temperature"]);x!=null&&h(e,["temperature"],x);const I=p(t,["thinkingConfig"]);I!=null&&h(e,["thinkingConfig"],I);const D=p(t,["topK"]);D!=null&&h(e,["topK"],D);const R=p(t,["topP"]);if(R!=null&&h(e,["topP"],R),p(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function PM(t,e){const n={},s=p(e,["model"]);return s!=null&&h(n,["_url","name"],Ge(t,s)),n}function DM(t,e){const n={},s=p(e,["model"]);return s!=null&&h(n,["_url","name"],Ge(t,s)),n}function LM(t){const e={};if(p(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=p(t,["enableWidget"]);return n!=null&&h(e,["enableWidget"],n),e}function kM(t){const e={};if(p(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(p(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=p(t,["timeRangeFilter"]);return n!=null&&h(e,["timeRangeFilter"],n),e}function UM(t){const e={},n=p(t,["bytesBase64Encoded"]);n!=null&&h(e,["imageBytes"],oa(n));const s=p(t,["mimeType"]);return s!=null&&h(e,["mimeType"],s),e}function ax(t){const e={},n=p(t,["gcsUri"]);n!=null&&h(e,["gcsUri"],n);const s=p(t,["bytesBase64Encoded"]);s!=null&&h(e,["imageBytes"],oa(s));const i=p(t,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function zu(t){const e={};if(p(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=p(t,["imageBytes"]);n!=null&&h(e,["bytesBase64Encoded"],oa(n));const s=p(t,["mimeType"]);return s!=null&&h(e,["mimeType"],s),e}function Un(t){const e={},n=p(t,["gcsUri"]);n!=null&&h(e,["gcsUri"],n);const s=p(t,["imageBytes"]);s!=null&&h(e,["bytesBase64Encoded"],oa(s));const i=p(t,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function OM(t,e,n){const s={},i=p(e,["pageSize"]);n!==void 0&&i!=null&&h(n,["_query","pageSize"],i);const o=p(e,["pageToken"]);n!==void 0&&o!=null&&h(n,["_query","pageToken"],o);const u=p(e,["filter"]);n!==void 0&&u!=null&&h(n,["_query","filter"],u);const d=p(e,["queryBase"]);return n!==void 0&&d!=null&&h(n,["_url","models_url"],X_(t,d)),s}function qM(t,e,n){const s={},i=p(e,["pageSize"]);n!==void 0&&i!=null&&h(n,["_query","pageSize"],i);const o=p(e,["pageToken"]);n!==void 0&&o!=null&&h(n,["_query","pageToken"],o);const u=p(e,["filter"]);n!==void 0&&u!=null&&h(n,["_query","filter"],u);const d=p(e,["queryBase"]);return n!==void 0&&d!=null&&h(n,["_url","models_url"],X_(t,d)),s}function BM(t,e){const n={},s=p(e,["config"]);return s!=null&&OM(t,s,n),n}function FM(t,e){const n={},s=p(e,["config"]);return s!=null&&qM(t,s,n),n}function $M(t){const e={},n=p(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=p(t,["nextPageToken"]);s!=null&&h(e,["nextPageToken"],s);const i=p(t,["_self"]);if(i!=null){let o=Q_(i);Array.isArray(o)&&(o=o.map(u=>gp(u))),h(e,["models"],o)}return e}function HM(t){const e={},n=p(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=p(t,["nextPageToken"]);s!=null&&h(e,["nextPageToken"],s);const i=p(t,["_self"]);if(i!=null){let o=Q_(i);Array.isArray(o)&&(o=o.map(u=>yp(u))),h(e,["models"],o)}return e}function GM(t){const e={},n=p(t,["maskMode"]);n!=null&&h(e,["maskMode"],n);const s=p(t,["segmentationClasses"]);s!=null&&h(e,["maskClasses"],s);const i=p(t,["maskDilation"]);return i!=null&&h(e,["dilation"],i),e}function gp(t){const e={},n=p(t,["name"]);n!=null&&h(e,["name"],n);const s=p(t,["displayName"]);s!=null&&h(e,["displayName"],s);const i=p(t,["description"]);i!=null&&h(e,["description"],i);const o=p(t,["version"]);o!=null&&h(e,["version"],o);const u=p(t,["_self"]);u!=null&&h(e,["tunedModelInfo"],a1(u));const d=p(t,["inputTokenLimit"]);d!=null&&h(e,["inputTokenLimit"],d);const m=p(t,["outputTokenLimit"]);m!=null&&h(e,["outputTokenLimit"],m);const f=p(t,["supportedGenerationMethods"]);return f!=null&&h(e,["supportedActions"],f),e}function yp(t){const e={},n=p(t,["name"]);n!=null&&h(e,["name"],n);const s=p(t,["displayName"]);s!=null&&h(e,["displayName"],s);const i=p(t,["description"]);i!=null&&h(e,["description"],i);const o=p(t,["versionId"]);o!=null&&h(e,["version"],o);const u=p(t,["deployedModels"]);if(u!=null){let S=u;Array.isArray(S)&&(S=S.map(_=>iM(_))),h(e,["endpoints"],S)}const d=p(t,["labels"]);d!=null&&h(e,["labels"],d);const m=p(t,["_self"]);m!=null&&h(e,["tunedModelInfo"],r1(m));const f=p(t,["defaultCheckpointId"]);f!=null&&h(e,["defaultCheckpointId"],f);const y=p(t,["checkpoints"]);if(y!=null){let S=y;Array.isArray(S)&&(S=S.map(_=>_)),h(e,["checkpoints"],S)}return e}function VM(t){const e={},n=p(t,["functionCall"]);n!=null&&h(e,["functionCall"],n);const s=p(t,["codeExecutionResult"]);s!=null&&h(e,["codeExecutionResult"],s);const i=p(t,["executableCode"]);i!=null&&h(e,["executableCode"],i);const o=p(t,["fileData"]);o!=null&&h(e,["fileData"],oM(o));const u=p(t,["functionResponse"]);u!=null&&h(e,["functionResponse"],u);const d=p(t,["inlineData"]);d!=null&&h(e,["inlineData"],DR(d));const m=p(t,["text"]);m!=null&&h(e,["text"],m);const f=p(t,["thought"]);f!=null&&h(e,["thought"],f);const y=p(t,["thoughtSignature"]);y!=null&&h(e,["thoughtSignature"],y);const S=p(t,["videoMetadata"]);return S!=null&&h(e,["videoMetadata"],S),e}function zM(t){const e={},n=p(t,["productImage"]);return n!=null&&h(e,["image"],Un(n)),e}function jM(t,e){const n={},s=p(t,["numberOfImages"]);e!==void 0&&s!=null&&h(e,["parameters","sampleCount"],s);const i=p(t,["baseSteps"]);e!==void 0&&i!=null&&h(e,["parameters","editConfig","baseSteps"],i);const o=p(t,["outputGcsUri"]);e!==void 0&&o!=null&&h(e,["parameters","storageUri"],o);const u=p(t,["seed"]);e!==void 0&&u!=null&&h(e,["parameters","seed"],u);const d=p(t,["safetyFilterLevel"]);e!==void 0&&d!=null&&h(e,["parameters","safetySetting"],d);const m=p(t,["personGeneration"]);e!==void 0&&m!=null&&h(e,["parameters","personGeneration"],m);const f=p(t,["addWatermark"]);e!==void 0&&f!=null&&h(e,["parameters","addWatermark"],f);const y=p(t,["outputMimeType"]);e!==void 0&&y!=null&&h(e,["parameters","outputOptions","mimeType"],y);const S=p(t,["outputCompressionQuality"]);e!==void 0&&S!=null&&h(e,["parameters","outputOptions","compressionQuality"],S);const _=p(t,["enhancePrompt"]);e!==void 0&&_!=null&&h(e,["parameters","enhancePrompt"],_);const T=p(t,["labels"]);return e!==void 0&&T!=null&&h(e,["labels"],T),n}function YM(t,e){const n={},s=p(e,["model"]);s!=null&&h(n,["_url","model"],Ge(t,s));const i=p(e,["source"]);i!=null&&KM(i,n);const o=p(e,["config"]);return o!=null&&jM(o,n),n}function JM(t){const e={},n=p(t,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(i=>Vu(i))),h(e,["generatedImages"],s)}return e}function KM(t,e){const n={},s=p(t,["prompt"]);e!==void 0&&s!=null&&h(e,["instances[0]","prompt"],s);const i=p(t,["personImage"]);e!==void 0&&i!=null&&h(e,["instances[0]","personImage","image"],Un(i));const o=p(t,["productImages"]);if(e!==void 0&&o!=null){let u=o;Array.isArray(u)&&(u=u.map(d=>zM(d))),h(e,["instances[0]","productImages"],u)}return n}function XM(t){const e={},n=p(t,["referenceImage"]);n!=null&&h(e,["referenceImage"],Un(n));const s=p(t,["referenceId"]);s!=null&&h(e,["referenceId"],s);const i=p(t,["referenceType"]);i!=null&&h(e,["referenceType"],i);const o=p(t,["maskImageConfig"]);o!=null&&h(e,["maskImageConfig"],GM(o));const u=p(t,["controlImageConfig"]);u!=null&&h(e,["controlImageConfig"],FR(u));const d=p(t,["styleImageConfig"]);d!=null&&h(e,["styleImageConfig"],d);const m=p(t,["subjectImageConfig"]);return m!=null&&h(e,["subjectImageConfig"],m),e}function rx(t){const e={},n=p(t,["safetyAttributes","categories"]);n!=null&&h(e,["categories"],n);const s=p(t,["safetyAttributes","scores"]);s!=null&&h(e,["scores"],s);const i=p(t,["contentType"]);return i!=null&&h(e,["contentType"],i),e}function ix(t){const e={},n=p(t,["safetyAttributes","categories"]);n!=null&&h(e,["categories"],n);const s=p(t,["safetyAttributes","scores"]);s!=null&&h(e,["scores"],s);const i=p(t,["contentType"]);return i!=null&&h(e,["contentType"],i),e}function QM(t){const e={},n=p(t,["category"]);if(n!=null&&h(e,["category"],n),p(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const s=p(t,["threshold"]);return s!=null&&h(e,["threshold"],s),e}function WM(t){const e={},n=p(t,["image"]);return n!=null&&h(e,["image"],Un(n)),e}function ZM(t,e){const n={},s=p(t,["mode"]);e!==void 0&&s!=null&&h(e,["parameters","mode"],s);const i=p(t,["maxPredictions"]);e!==void 0&&i!=null&&h(e,["parameters","maxPredictions"],i);const o=p(t,["confidenceThreshold"]);e!==void 0&&o!=null&&h(e,["parameters","confidenceThreshold"],o);const u=p(t,["maskDilation"]);e!==void 0&&u!=null&&h(e,["parameters","maskDilation"],u);const d=p(t,["binaryColorThreshold"]);e!==void 0&&d!=null&&h(e,["parameters","binaryColorThreshold"],d);const m=p(t,["labels"]);return e!==void 0&&m!=null&&h(e,["labels"],m),n}function e1(t,e){const n={},s=p(e,["model"]);s!=null&&h(n,["_url","model"],Ge(t,s));const i=p(e,["source"]);i!=null&&n1(i,n);const o=p(e,["config"]);return o!=null&&ZM(o,n),n}function t1(t){const e={},n=p(t,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(i=>NM(i))),h(e,["generatedMasks"],s)}return e}function n1(t,e){const n={},s=p(t,["prompt"]);e!==void 0&&s!=null&&h(e,["instances[0]","prompt"],s);const i=p(t,["image"]);e!==void 0&&i!=null&&h(e,["instances[0]","image"],Un(i));const o=p(t,["scribbleImage"]);return e!==void 0&&o!=null&&h(e,["instances[0]","scribble"],WM(o)),n}function ox(t){const e={},n=p(t,["languageCode"]);n!=null&&h(e,["languageCode"],n);const s=p(t,["voiceConfig"]);if(s!=null&&h(e,["voiceConfig"],s),p(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function s1(t){const e={},n=p(t,["functionDeclarations"]);if(n!=null){let y=n;Array.isArray(y)&&(y=y.map(S=>S)),h(e,["functionDeclarations"],y)}if(p(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=p(t,["googleSearchRetrieval"]);s!=null&&h(e,["googleSearchRetrieval"],s);const i=p(t,["computerUse"]);i!=null&&h(e,["computerUse"],i);const o=p(t,["fileSearch"]);o!=null&&h(e,["fileSearch"],o);const u=p(t,["codeExecution"]);if(u!=null&&h(e,["codeExecution"],u),p(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const d=p(t,["googleMaps"]);d!=null&&h(e,["googleMaps"],LM(d));const m=p(t,["googleSearch"]);m!=null&&h(e,["googleSearch"],kM(m));const f=p(t,["urlContext"]);return f!=null&&h(e,["urlContext"],f),e}function lx(t){const e={},n=p(t,["functionDeclarations"]);if(n!=null){let S=n;Array.isArray(S)&&(S=S.map(_=>lM(_))),h(e,["functionDeclarations"],S)}const s=p(t,["retrieval"]);s!=null&&h(e,["retrieval"],s);const i=p(t,["googleSearchRetrieval"]);i!=null&&h(e,["googleSearchRetrieval"],i);const o=p(t,["computerUse"]);if(o!=null&&h(e,["computerUse"],o),p(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const u=p(t,["codeExecution"]);u!=null&&h(e,["codeExecution"],u);const d=p(t,["enterpriseWebSearch"]);d!=null&&h(e,["enterpriseWebSearch"],d);const m=p(t,["googleMaps"]);m!=null&&h(e,["googleMaps"],m);const f=p(t,["googleSearch"]);f!=null&&h(e,["googleSearch"],f);const y=p(t,["urlContext"]);return y!=null&&h(e,["urlContext"],y),e}function a1(t){const e={},n=p(t,["baseModel"]);n!=null&&h(e,["baseModel"],n);const s=p(t,["createTime"]);s!=null&&h(e,["createTime"],s);const i=p(t,["updateTime"]);return i!=null&&h(e,["updateTime"],i),e}function r1(t){const e={},n=p(t,["labels","google-vertex-llm-tuning-base-model-id"]);n!=null&&h(e,["baseModel"],n);const s=p(t,["createTime"]);s!=null&&h(e,["createTime"],s);const i=p(t,["updateTime"]);return i!=null&&h(e,["updateTime"],i),e}function i1(t,e){const n={},s=p(t,["displayName"]);e!==void 0&&s!=null&&h(e,["displayName"],s);const i=p(t,["description"]);e!==void 0&&i!=null&&h(e,["description"],i);const o=p(t,["defaultCheckpointId"]);return e!==void 0&&o!=null&&h(e,["defaultCheckpointId"],o),n}function o1(t,e){const n={},s=p(t,["displayName"]);e!==void 0&&s!=null&&h(e,["displayName"],s);const i=p(t,["description"]);e!==void 0&&i!=null&&h(e,["description"],i);const o=p(t,["defaultCheckpointId"]);return e!==void 0&&o!=null&&h(e,["defaultCheckpointId"],o),n}function l1(t,e){const n={},s=p(e,["model"]);s!=null&&h(n,["_url","name"],Ge(t,s));const i=p(e,["config"]);return i!=null&&i1(i,n),n}function u1(t,e){const n={},s=p(e,["model"]);s!=null&&h(n,["_url","model"],Ge(t,s));const i=p(e,["config"]);return i!=null&&o1(i,n),n}function c1(t,e){const n={},s=p(t,["outputGcsUri"]);e!==void 0&&s!=null&&h(e,["parameters","storageUri"],s);const i=p(t,["safetyFilterLevel"]);e!==void 0&&i!=null&&h(e,["parameters","safetySetting"],i);const o=p(t,["personGeneration"]);e!==void 0&&o!=null&&h(e,["parameters","personGeneration"],o);const u=p(t,["includeRaiReason"]);e!==void 0&&u!=null&&h(e,["parameters","includeRaiReason"],u);const d=p(t,["outputMimeType"]);e!==void 0&&d!=null&&h(e,["parameters","outputOptions","mimeType"],d);const m=p(t,["outputCompressionQuality"]);e!==void 0&&m!=null&&h(e,["parameters","outputOptions","compressionQuality"],m);const f=p(t,["enhanceInputImage"]);e!==void 0&&f!=null&&h(e,["parameters","upscaleConfig","enhanceInputImage"],f);const y=p(t,["imagePreservationFactor"]);e!==void 0&&y!=null&&h(e,["parameters","upscaleConfig","imagePreservationFactor"],y);const S=p(t,["labels"]);e!==void 0&&S!=null&&h(e,["labels"],S);const _=p(t,["numberOfImages"]);e!==void 0&&_!=null&&h(e,["parameters","sampleCount"],_);const T=p(t,["mode"]);return e!==void 0&&T!=null&&h(e,["parameters","mode"],T),n}function d1(t,e){const n={},s=p(e,["model"]);s!=null&&h(n,["_url","model"],Ge(t,s));const i=p(e,["image"]);i!=null&&h(n,["instances[0]","image"],Un(i));const o=p(e,["upscaleFactor"]);o!=null&&h(n,["parameters","upscaleConfig","upscaleFactor"],o);const u=p(e,["config"]);return u!=null&&c1(u,n),n}function f1(t){const e={},n=p(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=p(t,["predictions"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(o=>Vu(o))),h(e,["generatedImages"],i)}return e}function p1(t){const e={},n=p(t,["uri"]);n!=null&&h(e,["uri"],n);const s=p(t,["encodedVideo"]);s!=null&&h(e,["videoBytes"],oa(s));const i=p(t,["encoding"]);return i!=null&&h(e,["mimeType"],i),e}function m1(t){const e={},n=p(t,["gcsUri"]);n!=null&&h(e,["uri"],n);const s=p(t,["bytesBase64Encoded"]);s!=null&&h(e,["videoBytes"],oa(s));const i=p(t,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function h1(t){const e={},n=p(t,["image"]);n!=null&&h(e,["_self"],Un(n));const s=p(t,["maskMode"]);return s!=null&&h(e,["maskMode"],s),e}function g1(t){const e={},n=p(t,["image"]);n!=null&&h(e,["image"],zu(n));const s=p(t,["referenceType"]);return s!=null&&h(e,["referenceType"],s),e}function y1(t){const e={},n=p(t,["image"]);n!=null&&h(e,["image"],Un(n));const s=p(t,["referenceType"]);return s!=null&&h(e,["referenceType"],s),e}function ux(t){const e={},n=p(t,["uri"]);n!=null&&h(e,["uri"],n);const s=p(t,["videoBytes"]);s!=null&&h(e,["encodedVideo"],oa(s));const i=p(t,["mimeType"]);return i!=null&&h(e,["encoding"],i),e}function cx(t){const e={},n=p(t,["uri"]);n!=null&&h(e,["gcsUri"],n);const s=p(t,["videoBytes"]);s!=null&&h(e,["bytesBase64Encoded"],oa(s));const i=p(t,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const v1="Content-Type",S1="X-Server-Timeout",w1="User-Agent",vp="x-goog-api-client",_1="1.29.0",x1=`google-genai-sdk/${_1}`,b1="v1beta1",T1="v1beta",VS=/^\s*data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class C1{constructor(e){var n,s;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const i={};this.clientOptions.vertexai?(i.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:b1,i.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(i.apiVersion=(s=this.clientOptions.apiVersion)!==null&&s!==void 0?s:T1,i.baseUrl="https://generativelanguage.googleapis.com/"),i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const s=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&s.push(e.apiVersion),s.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),n=new URL(e);return n.protocol=n.protocol=="http:"?"ws":"wss",n.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,n,s){const i=[this.getRequestUrlInternal(n)];return s&&i.push(this.getBaseResourcePath()),e!==""&&i.push(e),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const s=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,n,s);if(e.queryParams)for(const[u,d]of Object.entries(e.queryParams))i.searchParams.append(u,String(d));let o={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else o.body=e.body;return o=await this.includeExtraHttpOptionsToRequestInit(o,n,i.toString(),e.abortSignal),this.unaryApiCall(i,o,e.httpMethod)}patchHttpOptions(e,n){const s=JSON.parse(JSON.stringify(e));for(const[i,o]of Object.entries(n))typeof o=="object"?s[i]=Object.assign(Object.assign({},s[i]),o):o!==void 0&&(s[i]=o);return s}async requestStream(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const s=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,n,s);(!i.searchParams.has("alt")||i.searchParams.get("alt")!=="sse")&&i.searchParams.set("alt","sse");let o={};return o.body=e.body,o=await this.includeExtraHttpOptionsToRequestInit(o,n,i.toString(),e.abortSignal),this.streamApiCall(i,o,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,n,s,i){if(n&&n.timeout||i){const o=new AbortController,u=o.signal;if(n.timeout&&(n==null?void 0:n.timeout)>0){const d=setTimeout(()=>o.abort(),n.timeout);d&&typeof d.unref=="function"&&d.unref()}i&&i.addEventListener("abort",()=>{o.abort()}),e.signal=u}return n&&n.extraBody!==null&&A1(e,n.extraBody),e.headers=await this.getHeadersInternal(n,s),e}async unaryApiCall(e,n,s){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:s})).then(async i=>(await zS(i),new pp(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(e,n,s){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:s})).then(async i=>(await zS(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(e){var n;return Vr(this,arguments,function*(){const i=(n=e==null?void 0:e.body)===null||n===void 0?void 0:n.getReader(),o=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let u="";for(;;){const{done:d,value:m}=yield at(i.read());if(d){if(u.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const f=o.decode(m,{stream:!0});try{const S=JSON.parse(f);if("error"in S){const _=JSON.parse(JSON.stringify(S.error)),T=_.status,C=_.code,N=`got status: ${T}. ${JSON.stringify(S)}`;if(C>=400&&C<600)throw new Hu({message:N,status:C})}}catch(S){if(S.name==="ApiError")throw S}u+=f;let y=u.match(VS);for(;y;){const S=y[1];try{const _=new Response(S,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield at(new pp(_)),u=u.slice(y[0].length),y=u.match(VS)}catch(_){throw new Error(`exception parsing stream chunk ${S}. ${_}`)}}}}finally{i.releaseLock()}})}async apiCall(e,n){return fetch(e,n).catch(s=>{throw new Error(`exception ${s} sending request`)})}getDefaultHeaders(){const e={},n=x1+" "+this.clientOptions.userAgentExtra;return e[w1]=n,e[vp]=n,e[v1]="application/json",e}async getHeadersInternal(e,n){const s=new Headers;if(e&&e.headers){for(const[i,o]of Object.entries(e.headers))s.append(i,o);e.timeout&&e.timeout>0&&s.append(S1,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(s,n),s}getFileName(e){var n;let s="";return typeof e=="string"&&(s=e.replace(/[/\\]+$/,""),s=(n=s.split(/[/\\]/).pop())!==null&&n!==void 0?n:""),s}async uploadFile(e,n){var s;const i={};n!=null&&(i.mimeType=n.mimeType,i.name=n.name,i.displayName=n.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);const o=this.clientOptions.uploader,u=await o.stat(e);i.sizeBytes=String(u.size);const d=(s=n==null?void 0:n.mimeType)!==null&&s!==void 0?s:u.type;if(d===void 0||d==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=d;const m={file:i},f=this.getFileName(e),y=de("upload/v1beta/files",m._url),S=await this.fetchUploadUrl(y,i.sizeBytes,i.mimeType,f,m,n==null?void 0:n.httpOptions);return o.upload(e,S,this)}async uploadFileToFileSearchStore(e,n,s){var i;const o=this.clientOptions.uploader,u=await o.stat(n),d=String(u.size),m=(i=s==null?void 0:s.mimeType)!==null&&i!==void 0?i:u.type;if(m===void 0||m==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const f=`upload/v1beta/${e}:uploadToFileSearchStore`,y=this.getFileName(n),S={};s!=null&&s.customMetadata&&(S.customMetadata=s.customMetadata),s!=null&&s.chunkingConfig&&(S.chunkingConfig=s.chunkingConfig);const _=await this.fetchUploadUrl(f,d,m,y,S,s==null?void 0:s.httpOptions);return o.uploadToFileSearchStore(n,_,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,n,s,i,o,u){var d;let m={};u?m=u:m={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${n}`,"X-Goog-Upload-Header-Content-Type":`${s}`},i?{"X-Goog-Upload-File-Name":i}:{})};const f=await this.request({path:e,body:JSON.stringify(o),httpMethod:"POST",httpOptions:m});if(!f||!(f!=null&&f.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const y=(d=f==null?void 0:f.headers)===null||d===void 0?void 0:d["x-goog-upload-url"];if(y===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return y}}async function zS(t){var e;if(t===void 0)throw new Error("response is undefined");if(!t.ok){const n=t.status;let s;!((e=t.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?s=await t.json():s={error:{message:await t.text(),code:t.status,status:t.statusText}};const i=JSON.stringify(s);throw n>=400&&n<600?new Hu({message:i,status:n}):new Error(i)}}function A1(t,e){if(!e||Object.keys(e).length===0)return;if(t.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let n={};if(typeof t.body=="string"&&t.body.length>0)try{const o=JSON.parse(t.body);if(typeof o=="object"&&o!==null&&!Array.isArray(o))n=o;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function s(o,u){const d=Object.assign({},o);for(const m in u)if(Object.prototype.hasOwnProperty.call(u,m)){const f=u[m],y=d[m];f&&typeof f=="object"&&!Array.isArray(f)&&y&&typeof y=="object"&&!Array.isArray(y)?d[m]=s(y,f):(y&&f&&typeof y!=typeof f&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${m}". Original type: ${typeof y}, New type: ${typeof f}. Overwriting.`),d[m]=f)}return d}const i=s(n,e);t.body=JSON.stringify(i)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const E1="mcp_used/unknown";let N1=!1;function dx(t){for(const e of t)if(I1(e)||typeof e=="object"&&"inputSchema"in e)return!0;return N1}function fx(t){var e;const n=(e=t[vp])!==null&&e!==void 0?e:"";t[vp]=(n+` ${E1}`).trimStart()}function I1(t){return t!==null&&typeof t=="object"&&t instanceof im}function R1(t,e=100){return Vr(this,arguments,function*(){let s,i=0;for(;i<e;){const o=yield at(t.listTools({cursor:s}));for(const u of o.tools)yield yield at(u),i++;if(!o.nextCursor)break;s=o.nextCursor}})}class im{constructor(e=[],n){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=n}static create(e,n){return new im(e,n)}async initialize(){var e,n,s,i;if(this.mcpTools.length>0)return;const o={},u=[];for(const y of this.mcpClients)try{for(var d=!0,m=(n=void 0,fo(R1(y))),f;f=await m.next(),e=f.done,!e;d=!0){i=f.value,d=!1;const S=i;u.push(S);const _=S.name;if(o[_])throw new Error(`Duplicate function name ${_} found in MCP tools. Please ensure function names are unique.`);o[_]=y}}catch(S){n={error:S}}finally{try{!d&&!e&&(s=m.return)&&await s.call(m)}finally{if(n)throw n.error}}this.mcpTools=u,this.functionNameToMcpClient=o}async tool(){return await this.initialize(),kN(this.mcpTools,this.config)}async callTool(e){await this.initialize();const n=[];for(const s of e)if(s.name in this.functionNameToMcpClient){const i=this.functionNameToMcpClient[s.name];let o;this.config.timeout&&(o={timeout:this.config.timeout});const u=await i.callTool({name:s.name,arguments:s.args},void 0,o);n.push({functionResponse:{name:s.name,response:u.isError?{error:u}:u}})}return n}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function M1(t,e,n){const s=new EN;let i;n.data instanceof Blob?i=JSON.parse(await n.data.text()):i=JSON.parse(n.data),Object.assign(s,i),e(s)}class P1{constructor(e,n,s){this.apiClient=e,this.auth=n,this.webSocketFactory=s}async connect(e){var n,s;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const i=this.apiClient.getWebsocketBaseUrl(),o=this.apiClient.getApiVersion(),u=k1(this.apiClient.getDefaultHeaders()),d=this.apiClient.getApiKey(),m=`${i}/ws/google.ai.generativelanguage.${o}.GenerativeService.BidiGenerateMusic?key=${d}`;let f=()=>{};const y=new Promise(O=>{f=O}),S=e.callbacks,_=function(){f({})},T=this.apiClient,C={onopen:_,onmessage:O=>{M1(T,S.onmessage,O)},onerror:(n=S==null?void 0:S.onerror)!==null&&n!==void 0?n:function(O){},onclose:(s=S==null?void 0:S.onclose)!==null&&s!==void 0?s:function(O){}},N=this.webSocketFactory.create(m,L1(u),C);N.connect(),await y;const B={setup:{model:Ge(this.apiClient,e.model)}};return N.send(JSON.stringify(B)),new D1(N,this.apiClient)}}class D1{constructor(e,n){this.conn=e,this.apiClient=n}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const n=TR(e);this.conn.send(JSON.stringify({clientContent:n}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const n=bR(e);this.conn.send(JSON.stringify(n))}sendPlaybackControl(e){const n={playbackControl:e};this.conn.send(JSON.stringify(n))}play(){this.sendPlaybackControl(qr.PLAY)}pause(){this.sendPlaybackControl(qr.PAUSE)}stop(){this.sendPlaybackControl(qr.STOP)}resetContext(){this.sendPlaybackControl(qr.RESET_CONTEXT)}close(){this.conn.close()}}function L1(t){const e={};return t.forEach((n,s)=>{e[s]=n}),e}function k1(t){const e=new Headers;for(const[n,s]of Object.entries(t))e.append(n,s);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const U1="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function O1(t,e,n){const s=new AN;let i;n.data instanceof Blob?i=await n.data.text():n.data instanceof ArrayBuffer?i=new TextDecoder().decode(n.data):i=n.data;const o=JSON.parse(i);if(t.isVertexAI()){const u=ER(o);Object.assign(s,u)}else Object.assign(s,o);e(s)}class q1{constructor(e,n,s){this.apiClient=e,this.auth=n,this.webSocketFactory=s,this.music=new P1(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var n,s,i,o,u,d;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const m=this.apiClient.getWebsocketBaseUrl(),f=this.apiClient.getApiVersion();let y;const S=this.apiClient.getHeaders();e.config&&e.config.tools&&dx(e.config.tools)&&fx(S);const _=H1(S);if(this.apiClient.isVertexAI())y=`${m}/ws/google.cloud.aiplatform.${f}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(_,y);else{const A=this.apiClient.getApiKey();let k="BidiGenerateContent",F="key";A!=null&&A.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),f!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),k="BidiGenerateContentConstrained",F="access_token"),y=`${m}/ws/google.ai.generativelanguage.${f}.GenerativeService.${k}?${F}=${A}`}let T=()=>{};const C=new Promise(A=>{T=A}),N=e.callbacks,E=function(){var A;(A=N==null?void 0:N.onopen)===null||A===void 0||A.call(N),T({})},L=this.apiClient,B={onopen:E,onmessage:A=>{O1(L,N.onmessage,A)},onerror:(n=N==null?void 0:N.onerror)!==null&&n!==void 0?n:function(A){},onclose:(s=N==null?void 0:N.onclose)!==null&&s!==void 0?s:function(A){}},O=this.webSocketFactory.create(y,$1(_),B);O.connect(),await C;let x=Ge(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&x.startsWith("publishers/")){const A=this.apiClient.getProject(),k=this.apiClient.getLocation();x=`projects/${A}/locations/${k}/`+x}let I={};this.apiClient.isVertexAI()&&((i=e.config)===null||i===void 0?void 0:i.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[Nu.AUDIO]}:e.config.responseModalities=[Nu.AUDIO]),!((o=e.config)===null||o===void 0)&&o.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const D=(d=(u=e.config)===null||u===void 0?void 0:u.tools)!==null&&d!==void 0?d:[],R=[];for(const A of D)if(this.isCallableTool(A)){const k=A;R.push(await k.tool())}else R.push(A);R.length>0&&(e.config.tools=R);const P={model:x,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?I=xR(this.apiClient,P):I=_R(this.apiClient,P),delete I.config,O.send(JSON.stringify(I)),new F1(O,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const B1={turnComplete:!0};class F1{constructor(e,n){this.conn=e,this.apiClient=n}tLiveClientContent(e,n){if(n.turns!==null&&n.turns!==void 0){let s=[];try{s=An(n.turns),e.isVertexAI()||(s=s.map(i=>Gu(i)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof n.turns}'`)}return{clientContent:{turns:s,turnComplete:n.turnComplete}}}return{clientContent:{turnComplete:n.turnComplete}}}tLiveClienttToolResponse(e,n){let s=[];if(n.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(n.functionResponses)?s=n.functionResponses:s=[n.functionResponses],s.length===0)throw new Error("functionResponses is required.");for(const o of s){if(typeof o!="object"||o===null||!("name"in o)||!("response"in o))throw new Error(`Could not parse function response, type '${typeof o}'.`);if(!e.isVertexAI()&&!("id"in o))throw new Error(U1)}return{toolResponse:{functionResponses:s}}}sendClientContent(e){e=Object.assign(Object.assign({},B1),e);const n=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(n))}sendRealtimeInput(e){let n={};this.apiClient.isVertexAI()?n={realtimeInput:AR(e)}:n={realtimeInput:CR(e)},this.conn.send(JSON.stringify(n))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const n=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(n))}close(){this.conn.close()}}function $1(t){const e={};return t.forEach((n,s)=>{e[s]=n}),e}function H1(t){const e=new Headers;for(const[n,s]of Object.entries(t))e.append(n,s);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const jS=10;function YS(t){var e,n,s;if(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let i=!1;for(const u of(n=t==null?void 0:t.tools)!==null&&n!==void 0?n:[])if(zr(u)){i=!0;break}if(!i)return!0;const o=(s=t==null?void 0:t.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls;return o&&(o<0||!Number.isInteger(o))||o==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",o),!0):!1}function zr(t){return"callTool"in t&&typeof t.callTool=="function"}function G1(t){var e,n,s;return(s=(n=(e=t.config)===null||e===void 0?void 0:e.tools)===null||n===void 0?void 0:n.some(i=>zr(i)))!==null&&s!==void 0?s:!1}function JS(t){var e;const n=[];return!((e=t==null?void 0:t.config)===null||e===void 0)&&e.tools&&t.config.tools.forEach((s,i)=>{if(zr(s))return;const o=s;o.functionDeclarations&&o.functionDeclarations.length>0&&n.push(i)}),n}function KS(t){var e;return!(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let V1=class extends As{constructor(e){super(),this.apiClient=e,this.generateContent=async n=>{var s,i,o,u,d;const m=await this.processParamsMaybeAddMcpUsage(n);if(this.maybeMoveToResponseJsonSchem(n),!G1(n)||YS(n.config))return await this.generateContentInternal(m);const f=JS(n);if(f.length>0){const N=f.map(E=>`tools[${E}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${N}.`)}let y,S;const _=An(m.contents),T=(o=(i=(s=m.config)===null||s===void 0?void 0:s.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&o!==void 0?o:jS;let C=0;for(;C<T&&(y=await this.generateContentInternal(m),!(!y.functionCalls||y.functionCalls.length===0));){const N=y.candidates[0].content,E=[];for(const L of(d=(u=n.config)===null||u===void 0?void 0:u.tools)!==null&&d!==void 0?d:[])if(zr(L)){const O=await L.callTool(y.functionCalls);E.push(...O)}C++,S={role:"user",parts:E},m.contents=An(m.contents),m.contents.push(N),m.contents.push(S),KS(m.config)&&(_.push(N),_.push(S))}return KS(m.config)&&(y.automaticFunctionCallingHistory=_),y},this.generateContentStream=async n=>{if(this.maybeMoveToResponseJsonSchem(n),YS(n.config)){const i=await this.processParamsMaybeAddMcpUsage(n);return await this.generateContentStreamInternal(i)}const s=JS(n);if(s.length>0){const i=s.map(o=>`tools[${o}]`).join(", ");throw new Error(`Incompatible tools found at ${i}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}return await this.processAfcStream(n)},this.generateImages=async n=>await this.generateImagesInternal(n).then(s=>{var i;let o;const u=[];if(s!=null&&s.generatedImages)for(const m of s.generatedImages)m&&(m!=null&&m.safetyAttributes)&&((i=m==null?void 0:m.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?o=m==null?void 0:m.safetyAttributes:u.push(m);let d;return o?d={generatedImages:u,positivePromptSafetyAttributes:o,sdkHttpResponse:s.sdkHttpResponse}:d={generatedImages:u,sdkHttpResponse:s.sdkHttpResponse},d}),this.list=async n=>{var s;const u={config:Object.assign(Object.assign({},{queryBase:!0}),n==null?void 0:n.config)};if(this.apiClient.isVertexAI()&&!u.config.queryBase){if(!((s=u.config)===null||s===void 0)&&s.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");u.config.filter="labels.tune-type:*"}return new Ha(Cs.PAGED_ITEM_MODELS,d=>this.listInternal(d),await this.listInternal(u),u)},this.editImage=async n=>{const s={model:n.model,prompt:n.prompt,referenceImages:[],config:n.config};return n.referenceImages&&n.referenceImages&&(s.referenceImages=n.referenceImages.map(i=>i.toReferenceImageAPI())),await this.editImageInternal(s)},this.upscaleImage=async n=>{let s={numberOfImages:1,mode:"upscale"};n.config&&(s=Object.assign(Object.assign({},s),n.config));const i={model:n.model,image:n.image,upscaleFactor:n.upscaleFactor,config:s};return await this.upscaleImageInternal(i)},this.generateVideos=async n=>{var s,i,o,u,d,m;if((n.prompt||n.image||n.video)&&n.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((s=n.video)===null||s===void 0)&&s.uri&&(!((i=n.video)===null||i===void 0)&&i.videoBytes)?n.video={uri:n.video.uri,mimeType:n.video.mimeType}:!((u=(o=n.source)===null||o===void 0?void 0:o.video)===null||u===void 0)&&u.uri&&(!((m=(d=n.source)===null||d===void 0?void 0:d.video)===null||m===void 0)&&m.videoBytes)&&(n.source.video={uri:n.source.video.uri,mimeType:n.source.video.mimeType})),await this.generateVideosInternal(n)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var n,s,i;const o=(n=e.config)===null||n===void 0?void 0:n.tools;if(!o)return e;const u=await Promise.all(o.map(async m=>zr(m)?await m.tool():m)),d={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:u})};if(d.config.tools=u,e.config&&e.config.tools&&dx(e.config.tools)){const m=(i=(s=e.config.httpOptions)===null||s===void 0?void 0:s.headers)!==null&&i!==void 0?i:{};let f=Object.assign({},m);Object.keys(f).length===0&&(f=this.apiClient.getDefaultHeaders()),fx(f),d.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:f})}return d}async initAfcToolsMap(e){var n,s,i;const o=new Map;for(const u of(s=(n=e.config)===null||n===void 0?void 0:n.tools)!==null&&s!==void 0?s:[])if(zr(u)){const d=u,m=await d.tool();for(const f of(i=m.functionDeclarations)!==null&&i!==void 0?i:[]){if(!f.name)throw new Error("Function declaration name is required.");if(o.has(f.name))throw new Error(`Duplicate tool declaration name: ${f.name}`);o.set(f.name,d)}}return o}async processAfcStream(e){var n,s,i;const o=(i=(s=(n=e.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls)!==null&&i!==void 0?i:jS;let u=!1,d=0;const m=await this.initAfcToolsMap(e);return(function(f,y,S){var _,T;return Vr(this,arguments,function*(){for(var C,N,E,L;d<o;){u&&(d++,u=!1);const I=yield at(f.processParamsMaybeAddMcpUsage(S)),D=yield at(f.generateContentStreamInternal(I)),R=[],P=[];try{for(var B=!0,O=(N=void 0,fo(D)),x;x=yield at(O.next()),C=x.done,!C;B=!0){L=x.value,B=!1;const A=L;if(yield yield at(A),A.candidates&&(!((_=A.candidates[0])===null||_===void 0)&&_.content)){P.push(A.candidates[0].content);for(const k of(T=A.candidates[0].content.parts)!==null&&T!==void 0?T:[])if(d<o&&k.functionCall){if(!k.functionCall.name)throw new Error("Function call name was not returned by the model.");if(y.has(k.functionCall.name)){const F=yield at(y.get(k.functionCall.name).callTool([k.functionCall]));R.push(...F)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${y.keys()}, mising tool: ${k.functionCall.name}`)}}}}catch(A){N={error:A}}finally{try{!B&&!C&&(E=O.return)&&(yield at(E.call(O)))}finally{if(N)throw N.error}}if(R.length>0){u=!0;const A=new Zi;A.candidates=[{content:{role:"user",parts:R}}],yield yield at(A);const k=[];k.push(...P),k.push({role:"user",parts:R});const F=An(S.contents).concat(k);S.contents=F}else break}})})(this,m,e)}async generateContentInternal(e){var n,s,i,o;let u,d="",m={};if(this.apiClient.isVertexAI()){const f=$S(this.apiClient,e);return d=de("{model}:generateContent",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json().then(S=>{const _=S;return _.sdkHttpResponse={headers:y.headers},_})),u.then(y=>{const S=GS(y),_=new Zi;return Object.assign(_,S),_})}else{const f=FS(this.apiClient,e);return d=de("{model}:generateContent",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(y=>y.json().then(S=>{const _=S;return _.sdkHttpResponse={headers:y.headers},_})),u.then(y=>{const S=HS(y),_=new Zi;return Object.assign(_,S),_})}}async generateContentStreamInternal(e){var n,s,i,o;let u,d="",m={};if(this.apiClient.isVertexAI()){const f=$S(this.apiClient,e);return d=de("{model}:streamGenerateContent?alt=sse",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.requestStream({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}),u.then(function(S){return Vr(this,arguments,function*(){var _,T,C,N;try{for(var E=!0,L=fo(S),B;B=yield at(L.next()),_=B.done,!_;E=!0){N=B.value,E=!1;const O=N,x=GS(yield at(O.json()));x.sdkHttpResponse={headers:O.headers};const I=new Zi;Object.assign(I,x),yield yield at(I)}}catch(O){T={error:O}}finally{try{!E&&!_&&(C=L.return)&&(yield at(C.call(L)))}finally{if(T)throw T.error}}})})}else{const f=FS(this.apiClient,e);return d=de("{model}:streamGenerateContent?alt=sse",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.requestStream({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}),u.then(function(S){return Vr(this,arguments,function*(){var _,T,C,N;try{for(var E=!0,L=fo(S),B;B=yield at(L.next()),_=B.done,!_;E=!0){N=B.value,E=!1;const O=N,x=HS(yield at(O.json()));x.sdkHttpResponse={headers:O.headers};const I=new Zi;Object.assign(I,x),yield yield at(I)}}catch(O){T={error:O}}finally{try{!E&&!_&&(C=L.return)&&(yield at(C.call(L)))}finally{if(T)throw T.error}}})})}}async embedContent(e){var n,s,i,o;let u,d="",m={};if(this.apiClient.isVertexAI()){const f=sM(this.apiClient,e);return d=de("{model}:predict",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json().then(S=>{const _=S;return _.sdkHttpResponse={headers:y.headers},_})),u.then(y=>{const S=rM(y),_=new TS;return Object.assign(_,S),_})}else{const f=nM(this.apiClient,e);return d=de("{model}:batchEmbedContents",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(y=>y.json().then(S=>{const _=S;return _.sdkHttpResponse={headers:y.headers},_})),u.then(y=>{const S=aM(y),_=new TS;return Object.assign(_,S),_})}}async generateImagesInternal(e){var n,s,i,o;let u,d="",m={};if(this.apiClient.isVertexAI()){const f=mM(this.apiClient,e);return d=de("{model}:predict",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json().then(S=>{const _=S;return _.sdkHttpResponse={headers:y.headers},_})),u.then(y=>{const S=gM(y),_=new CS;return Object.assign(_,S),_})}else{const f=pM(this.apiClient,e);return d=de("{model}:predict",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(y=>y.json().then(S=>{const _=S;return _.sdkHttpResponse={headers:y.headers},_})),u.then(y=>{const S=hM(y),_=new CS;return Object.assign(_,S),_})}}async editImageInternal(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI()){const d=WR(this.apiClient,e);return o=de("{model}:predict",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json().then(f=>{const y=f;return y.sdkHttpResponse={headers:m.headers},y})),i.then(m=>{const f=ZR(m),y=new hN;return Object.assign(y,f),y})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI()){const d=d1(this.apiClient,e);return o=de("{model}:predict",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json().then(f=>{const y=f;return y.sdkHttpResponse={headers:m.headers},y})),i.then(m=>{const f=f1(m),y=new gN;return Object.assign(y,f),y})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI()){const d=YM(this.apiClient,e);return o=de("{model}:predict",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json()),i.then(m=>{const f=JM(m),y=new yN;return Object.assign(y,f),y})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI()){const d=e1(this.apiClient,e);return o=de("{model}:predict",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json()),i.then(m=>{const f=t1(m),y=new vN;return Object.assign(y,f),y})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var n,s,i,o;let u,d="",m={};if(this.apiClient.isVertexAI()){const f=DM(this.apiClient,e);return d=de("{name}",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json()),u.then(y=>yp(y))}else{const f=PM(this.apiClient,e);return d=de("{name}",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(y=>y.json()),u.then(y=>gp(y))}}async listInternal(e){var n,s,i,o;let u,d="",m={};if(this.apiClient.isVertexAI()){const f=FM(this.apiClient,e);return d=de("{models_url}",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json().then(S=>{const _=S;return _.sdkHttpResponse={headers:y.headers},_})),u.then(y=>{const S=HM(y),_=new AS;return Object.assign(_,S),_})}else{const f=BM(this.apiClient,e);return d=de("{models_url}",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(y=>y.json().then(S=>{const _=S;return _.sdkHttpResponse={headers:y.headers},_})),u.then(y=>{const S=$M(y),_=new AS;return Object.assign(_,S),_})}}async update(e){var n,s,i,o;let u,d="",m={};if(this.apiClient.isVertexAI()){const f=u1(this.apiClient,e);return d=de("{model}",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json()),u.then(y=>yp(y))}else{const f=l1(this.apiClient,e);return d=de("{name}",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(y=>y.json()),u.then(y=>gp(y))}}async delete(e){var n,s,i,o;let u,d="",m={};if(this.apiClient.isVertexAI()){const f=JR(this.apiClient,e);return d=de("{name}",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json().then(S=>{const _=S;return _.sdkHttpResponse={headers:y.headers},_})),u.then(y=>{const S=XR(y),_=new ES;return Object.assign(_,S),_})}else{const f=YR(this.apiClient,e);return d=de("{name}",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(y=>y.json().then(S=>{const _=S;return _.sdkHttpResponse={headers:y.headers},_})),u.then(y=>{const S=KR(y),_=new ES;return Object.assign(_,S),_})}}async countTokens(e){var n,s,i,o;let u,d="",m={};if(this.apiClient.isVertexAI()){const f=VR(this.apiClient,e);return d=de("{model}:countTokens",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json().then(S=>{const _=S;return _.sdkHttpResponse={headers:y.headers},_})),u.then(y=>{const S=jR(y),_=new NS;return Object.assign(_,S),_})}else{const f=GR(this.apiClient,e);return d=de("{model}:countTokens",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(y=>y.json().then(S=>{const _=S;return _.sdkHttpResponse={headers:y.headers},_})),u.then(y=>{const S=zR(y),_=new NS;return Object.assign(_,S),_})}}async computeTokens(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI()){const d=UR(this.apiClient,e);return o=de("{model}:computeTokens",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json().then(f=>{const y=f;return y.sdkHttpResponse={headers:m.headers},y})),i.then(m=>{const f=OR(m),y=new SN;return Object.assign(y,f),y})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var n,s,i,o;let u,d="",m={};if(this.apiClient.isVertexAI()){const f=xM(this.apiClient,e);return d=de("{model}:predictLongRunning",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json()),u.then(y=>{const S=wM(y),_=new Iu;return Object.assign(_,S),_})}else{const f=_M(this.apiClient,e);return d=de("{model}:predictLongRunning",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(y=>y.json()),u.then(y=>{const S=SM(y),_=new Iu;return Object.assign(_,S),_})}}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class z1 extends As{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const n=e.operation,s=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=n.name.split("/operations/")[0];let o;s&&"httpOptions"in s&&(o=s.httpOptions);const u=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:i,config:{httpOptions:o}});return n._fromAPIResponse({apiResponse:u,_isVertexAI:!0})}else{const i=await this.getVideosOperationInternal({operationName:n.name,config:s});return n._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async get(e){const n=e.operation,s=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=n.name.split("/operations/")[0];let o;s&&"httpOptions"in s&&(o=s.httpOptions);const u=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:i,config:{httpOptions:o}});return n._fromAPIResponse({apiResponse:u,_isVertexAI:!0})}else{const i=await this.getVideosOperationInternal({operationName:n.name,config:s});return n._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async getVideosOperationInternal(e){var n,s,i,o;let u,d="",m={};if(this.apiClient.isVertexAI()){const f=uN(e);return d=de("{operationName}",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json()),u}else{const f=lN(e);return d=de("{operationName}",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(y=>y.json()),u}}async fetchPredictVideosOperationInternal(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI()){const d=tN(e);return o=de("{resourceName}:fetchPredictOperation",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json()),i}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function j1(t){const e={},n=p(t,["data"]);if(n!=null&&h(e,["data"],n),p(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=p(t,["mimeType"]);return s!=null&&h(e,["mimeType"],s),e}function Y1(t){const e={},n=p(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>tP(o))),h(e,["parts"],i)}const s=p(t,["role"]);return s!=null&&h(e,["role"],s),e}function J1(t,e,n){const s={},i=p(e,["expireTime"]);n!==void 0&&i!=null&&h(n,["expireTime"],i);const o=p(e,["newSessionExpireTime"]);n!==void 0&&o!=null&&h(n,["newSessionExpireTime"],o);const u=p(e,["uses"]);n!==void 0&&u!=null&&h(n,["uses"],u);const d=p(e,["liveConnectConstraints"]);n!==void 0&&d!=null&&h(n,["bidiGenerateContentSetup"],eP(t,d));const m=p(e,["lockAdditionalFields"]);return n!==void 0&&m!=null&&h(n,["fieldMask"],m),s}function K1(t,e){const n={},s=p(e,["config"]);return s!=null&&h(n,["config"],J1(t,s,n)),n}function X1(t){const e={};if(p(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=p(t,["fileUri"]);n!=null&&h(e,["fileUri"],n);const s=p(t,["mimeType"]);return s!=null&&h(e,["mimeType"],s),e}function Q1(t){const e={};if(p(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=p(t,["enableWidget"]);return n!=null&&h(e,["enableWidget"],n),e}function W1(t){const e={};if(p(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(p(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=p(t,["timeRangeFilter"]);return n!=null&&h(e,["timeRangeFilter"],n),e}function Z1(t,e){const n={},s=p(t,["generationConfig"]);e!==void 0&&s!=null&&h(e,["setup","generationConfig"],s);const i=p(t,["responseModalities"]);e!==void 0&&i!=null&&h(e,["setup","generationConfig","responseModalities"],i);const o=p(t,["temperature"]);e!==void 0&&o!=null&&h(e,["setup","generationConfig","temperature"],o);const u=p(t,["topP"]);e!==void 0&&u!=null&&h(e,["setup","generationConfig","topP"],u);const d=p(t,["topK"]);e!==void 0&&d!=null&&h(e,["setup","generationConfig","topK"],d);const m=p(t,["maxOutputTokens"]);e!==void 0&&m!=null&&h(e,["setup","generationConfig","maxOutputTokens"],m);const f=p(t,["mediaResolution"]);e!==void 0&&f!=null&&h(e,["setup","generationConfig","mediaResolution"],f);const y=p(t,["seed"]);e!==void 0&&y!=null&&h(e,["setup","generationConfig","seed"],y);const S=p(t,["speechConfig"]);e!==void 0&&S!=null&&h(e,["setup","generationConfig","speechConfig"],rm(S));const _=p(t,["thinkingConfig"]);e!==void 0&&_!=null&&h(e,["setup","generationConfig","thinkingConfig"],_);const T=p(t,["enableAffectiveDialog"]);e!==void 0&&T!=null&&h(e,["setup","generationConfig","enableAffectiveDialog"],T);const C=p(t,["systemInstruction"]);e!==void 0&&C!=null&&h(e,["setup","systemInstruction"],Y1(Bt(C)));const N=p(t,["tools"]);if(e!==void 0&&N!=null){let D=Zr(N);Array.isArray(D)&&(D=D.map(R=>sP(Wr(R)))),h(e,["setup","tools"],D)}const E=p(t,["sessionResumption"]);e!==void 0&&E!=null&&h(e,["setup","sessionResumption"],nP(E));const L=p(t,["inputAudioTranscription"]);e!==void 0&&L!=null&&h(e,["setup","inputAudioTranscription"],L);const B=p(t,["outputAudioTranscription"]);e!==void 0&&B!=null&&h(e,["setup","outputAudioTranscription"],B);const O=p(t,["realtimeInputConfig"]);e!==void 0&&O!=null&&h(e,["setup","realtimeInputConfig"],O);const x=p(t,["contextWindowCompression"]);e!==void 0&&x!=null&&h(e,["setup","contextWindowCompression"],x);const I=p(t,["proactivity"]);return e!==void 0&&I!=null&&h(e,["setup","proactivity"],I),n}function eP(t,e){const n={},s=p(e,["model"]);s!=null&&h(n,["setup","model"],Ge(t,s));const i=p(e,["config"]);return i!=null&&h(n,["config"],Z1(i,n)),n}function tP(t){const e={},n=p(t,["functionCall"]);n!=null&&h(e,["functionCall"],n);const s=p(t,["codeExecutionResult"]);s!=null&&h(e,["codeExecutionResult"],s);const i=p(t,["executableCode"]);i!=null&&h(e,["executableCode"],i);const o=p(t,["fileData"]);o!=null&&h(e,["fileData"],X1(o));const u=p(t,["functionResponse"]);u!=null&&h(e,["functionResponse"],u);const d=p(t,["inlineData"]);d!=null&&h(e,["inlineData"],j1(d));const m=p(t,["text"]);m!=null&&h(e,["text"],m);const f=p(t,["thought"]);f!=null&&h(e,["thought"],f);const y=p(t,["thoughtSignature"]);y!=null&&h(e,["thoughtSignature"],y);const S=p(t,["videoMetadata"]);return S!=null&&h(e,["videoMetadata"],S),e}function nP(t){const e={},n=p(t,["handle"]);if(n!=null&&h(e,["handle"],n),p(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function sP(t){const e={},n=p(t,["functionDeclarations"]);if(n!=null){let y=n;Array.isArray(y)&&(y=y.map(S=>S)),h(e,["functionDeclarations"],y)}if(p(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=p(t,["googleSearchRetrieval"]);s!=null&&h(e,["googleSearchRetrieval"],s);const i=p(t,["computerUse"]);i!=null&&h(e,["computerUse"],i);const o=p(t,["fileSearch"]);o!=null&&h(e,["fileSearch"],o);const u=p(t,["codeExecution"]);if(u!=null&&h(e,["codeExecution"],u),p(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const d=p(t,["googleMaps"]);d!=null&&h(e,["googleMaps"],Q1(d));const m=p(t,["googleSearch"]);m!=null&&h(e,["googleSearch"],W1(m));const f=p(t,["urlContext"]);return f!=null&&h(e,["urlContext"],f),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function aP(t){const e=[];for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const s=t[n];if(typeof s=="object"&&s!=null&&Object.keys(s).length>0){const i=Object.keys(s).map(o=>`${n}.${o}`);e.push(...i)}else e.push(n)}return e.join(",")}function rP(t,e){let n=null;const s=t.bidiGenerateContentSetup;if(typeof s=="object"&&s!==null&&"setup"in s){const o=s.setup;typeof o=="object"&&o!==null?(t.bidiGenerateContentSetup=o,n=o):delete t.bidiGenerateContentSetup}else s!==void 0&&delete t.bidiGenerateContentSetup;const i=t.fieldMask;if(n){const o=aP(n);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)o?t.fieldMask=o:delete t.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&i!==null&&Array.isArray(i)&&i.length>0){const u=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let d=[];i.length>0&&(d=i.map(f=>u.includes(f)?`generationConfig.${f}`:f));const m=[];o&&m.push(o),d.length>0&&m.push(...d),m.length>0?t.fieldMask=m.join(","):delete t.fieldMask}else delete t.fieldMask}else i!==null&&Array.isArray(i)&&i.length>0?t.fieldMask=i.join(","):delete t.fieldMask;return t}class iP extends As{constructor(e){super(),this.apiClient=e}async create(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const d=K1(this.apiClient,e);o=de("auth_tokens",d._url),u=d._query,delete d.config,delete d._url,delete d._query;const m=rP(d,e.config);return i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),i.then(f=>f)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function oP(t,e){const n={},s=p(t,["displayName"]);return e!==void 0&&s!=null&&h(e,["displayName"],s),n}function lP(t){const e={},n=p(t,["config"]);return n!=null&&oP(n,e),e}function uP(t,e){const n={},s=p(t,["force"]);return e!==void 0&&s!=null&&h(e,["_query","force"],s),n}function cP(t){const e={},n=p(t,["name"]);n!=null&&h(e,["_url","name"],n);const s=p(t,["config"]);return s!=null&&uP(s,e),e}function dP(t){const e={},n=p(t,["name"]);return n!=null&&h(e,["_url","name"],n),e}function fP(t,e){const n={},s=p(t,["customMetadata"]);if(e!==void 0&&s!=null){let o=s;Array.isArray(o)&&(o=o.map(u=>u)),h(e,["customMetadata"],o)}const i=p(t,["chunkingConfig"]);return e!==void 0&&i!=null&&h(e,["chunkingConfig"],i),n}function pP(t){const e={},n=p(t,["name"]);n!=null&&h(e,["name"],n);const s=p(t,["metadata"]);s!=null&&h(e,["metadata"],s);const i=p(t,["done"]);i!=null&&h(e,["done"],i);const o=p(t,["error"]);o!=null&&h(e,["error"],o);const u=p(t,["response"]);return u!=null&&h(e,["response"],hP(u)),e}function mP(t){const e={},n=p(t,["fileSearchStoreName"]);n!=null&&h(e,["_url","file_search_store_name"],n);const s=p(t,["fileName"]);s!=null&&h(e,["fileName"],s);const i=p(t,["config"]);return i!=null&&fP(i,e),e}function hP(t){const e={},n=p(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=p(t,["parent"]);s!=null&&h(e,["parent"],s);const i=p(t,["documentName"]);return i!=null&&h(e,["documentName"],i),e}function gP(t,e){const n={},s=p(t,["pageSize"]);e!==void 0&&s!=null&&h(e,["_query","pageSize"],s);const i=p(t,["pageToken"]);return e!==void 0&&i!=null&&h(e,["_query","pageToken"],i),n}function yP(t){const e={},n=p(t,["config"]);return n!=null&&gP(n,e),e}function vP(t){const e={},n=p(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=p(t,["nextPageToken"]);s!=null&&h(e,["nextPageToken"],s);const i=p(t,["fileSearchStores"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(u=>u)),h(e,["fileSearchStores"],o)}return e}function SP(t,e){const n={},s=p(t,["mimeType"]);e!==void 0&&s!=null&&h(e,["mimeType"],s);const i=p(t,["displayName"]);e!==void 0&&i!=null&&h(e,["displayName"],i);const o=p(t,["customMetadata"]);if(e!==void 0&&o!=null){let d=o;Array.isArray(d)&&(d=d.map(m=>m)),h(e,["customMetadata"],d)}const u=p(t,["chunkingConfig"]);return e!==void 0&&u!=null&&h(e,["chunkingConfig"],u),n}function wP(t){const e={},n=p(t,["fileSearchStoreName"]);n!=null&&h(e,["_url","file_search_store_name"],n);const s=p(t,["config"]);return s!=null&&SP(s,e),e}function _P(t){const e={},n=p(t,["sdkHttpResponse"]);return n!=null&&h(e,["sdkHttpResponse"],n),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function xP(t,e){const n={},s=p(t,["force"]);return e!==void 0&&s!=null&&h(e,["_query","force"],s),n}function bP(t){const e={},n=p(t,["name"]);n!=null&&h(e,["_url","name"],n);const s=p(t,["config"]);return s!=null&&xP(s,e),e}function TP(t){const e={},n=p(t,["name"]);return n!=null&&h(e,["_url","name"],n),e}function CP(t,e){const n={},s=p(t,["pageSize"]);e!==void 0&&s!=null&&h(e,["_query","pageSize"],s);const i=p(t,["pageToken"]);return e!==void 0&&i!=null&&h(e,["_query","pageToken"],i),n}function AP(t){const e={},n=p(t,["parent"]);n!=null&&h(e,["_url","parent"],n);const s=p(t,["config"]);return s!=null&&CP(s,e),e}function EP(t){const e={},n=p(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const s=p(t,["nextPageToken"]);s!=null&&h(e,["nextPageToken"],s);const i=p(t,["documents"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(u=>u)),h(e,["documents"],o)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class NP extends As{constructor(e){super(),this.apiClient=e,this.list=async n=>new Ha(Cs.PAGED_ITEM_DOCUMENTS,s=>this.listInternal({parent:n.parent,config:s.config}),await this.listInternal(n),n)}async get(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=TP(e);return o=de("{name}",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json()),i.then(m=>m)}}async delete(e){var n,s;let i="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=bP(e);i=de("{name}",u._url),o=u._query,delete u._url,delete u._query,await this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}}async listInternal(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=AP(e);return o=de("{parent}/documents",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json()),i.then(m=>{const f=EP(m),y=new wN;return Object.assign(y,f),y})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class IP extends As{constructor(e,n=new NP(e)){super(),this.apiClient=e,this.documents=n,this.list=async(s={})=>new Ha(Cs.PAGED_ITEM_FILE_SEARCH_STORES,i=>this.listInternal(i),await this.listInternal(s),s)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=lP(e);return o=de("fileSearchStores",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json()),i.then(m=>m)}}async get(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=dP(e);return o=de("{name}",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json()),i.then(m=>m)}}async delete(e){var n,s;let i="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=cP(e);i=de("{name}",u._url),o=u._query,delete u._url,delete u._query,await this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}}async listInternal(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=yP(e);return o=de("fileSearchStores",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json()),i.then(m=>{const f=vP(m),y=new _N;return Object.assign(y,f),y})}}async uploadToFileSearchStoreInternal(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=wP(e);return o=de("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json()),i.then(m=>{const f=_P(m),y=new xN;return Object.assign(y,f),y})}}async importFile(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=mP(e);return o=de("{file_search_store_name}:importFile",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json()),i.then(m=>{const f=pP(m),y=new em;return Object.assign(y,f),y})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function RP(t,e){const n={},s=p(t,["name"]);return s!=null&&h(n,["_url","name"],s),n}function MP(t,e){const n={},s=p(t,["name"]);return s!=null&&h(n,["_url","name"],s),n}function PP(t,e,n){const s={};if(p(t,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const i=p(t,["tunedModelDisplayName"]);if(e!==void 0&&i!=null&&h(e,["displayName"],i),p(t,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const o=p(t,["epochCount"]);e!==void 0&&o!=null&&h(e,["tuningTask","hyperparameters","epochCount"],o);const u=p(t,["learningRateMultiplier"]);if(u!=null&&h(s,["tuningTask","hyperparameters","learningRateMultiplier"],u),p(t,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(p(t,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(p(t,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const d=p(t,["batchSize"]);e!==void 0&&d!=null&&h(e,["tuningTask","hyperparameters","batchSize"],d);const m=p(t,["learningRate"]);if(e!==void 0&&m!=null&&h(e,["tuningTask","hyperparameters","learningRate"],m),p(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(p(t,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return s}function DP(t,e,n){const s={};let i=p(n,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){const T=p(t,["validationDataset"]);e!==void 0&&T!=null&&h(e,["supervisedTuningSpec"],XS(T))}else if(i==="PREFERENCE_TUNING"){const T=p(t,["validationDataset"]);e!==void 0&&T!=null&&h(e,["preferenceOptimizationSpec"],XS(T))}const o=p(t,["tunedModelDisplayName"]);e!==void 0&&o!=null&&h(e,["tunedModelDisplayName"],o);const u=p(t,["description"]);e!==void 0&&u!=null&&h(e,["description"],u);let d=p(n,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){const T=p(t,["epochCount"]);e!==void 0&&T!=null&&h(e,["supervisedTuningSpec","hyperParameters","epochCount"],T)}else if(d==="PREFERENCE_TUNING"){const T=p(t,["epochCount"]);e!==void 0&&T!=null&&h(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],T)}let m=p(n,["config","method"]);if(m===void 0&&(m="SUPERVISED_FINE_TUNING"),m==="SUPERVISED_FINE_TUNING"){const T=p(t,["learningRateMultiplier"]);e!==void 0&&T!=null&&h(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],T)}else if(m==="PREFERENCE_TUNING"){const T=p(t,["learningRateMultiplier"]);e!==void 0&&T!=null&&h(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],T)}let f=p(n,["config","method"]);if(f===void 0&&(f="SUPERVISED_FINE_TUNING"),f==="SUPERVISED_FINE_TUNING"){const T=p(t,["exportLastCheckpointOnly"]);e!==void 0&&T!=null&&h(e,["supervisedTuningSpec","exportLastCheckpointOnly"],T)}else if(f==="PREFERENCE_TUNING"){const T=p(t,["exportLastCheckpointOnly"]);e!==void 0&&T!=null&&h(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],T)}let y=p(n,["config","method"]);if(y===void 0&&(y="SUPERVISED_FINE_TUNING"),y==="SUPERVISED_FINE_TUNING"){const T=p(t,["adapterSize"]);e!==void 0&&T!=null&&h(e,["supervisedTuningSpec","hyperParameters","adapterSize"],T)}else if(y==="PREFERENCE_TUNING"){const T=p(t,["adapterSize"]);e!==void 0&&T!=null&&h(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],T)}if(p(t,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(p(t,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const S=p(t,["labels"]);e!==void 0&&S!=null&&h(e,["labels"],S);const _=p(t,["beta"]);return e!==void 0&&_!=null&&h(e,["preferenceOptimizationSpec","hyperParameters","beta"],_),s}function LP(t,e){const n={},s=p(t,["baseModel"]);s!=null&&h(n,["baseModel"],s);const i=p(t,["preTunedModel"]);i!=null&&h(n,["preTunedModel"],i);const o=p(t,["trainingDataset"]);o!=null&&zP(o);const u=p(t,["config"]);return u!=null&&PP(u,n),n}function kP(t,e){const n={},s=p(t,["baseModel"]);s!=null&&h(n,["baseModel"],s);const i=p(t,["preTunedModel"]);i!=null&&h(n,["preTunedModel"],i);const o=p(t,["trainingDataset"]);o!=null&&jP(o,n,e);const u=p(t,["config"]);return u!=null&&DP(u,n,e),n}function UP(t,e){const n={},s=p(t,["name"]);return s!=null&&h(n,["_url","name"],s),n}function OP(t,e){const n={},s=p(t,["name"]);return s!=null&&h(n,["_url","name"],s),n}function qP(t,e,n){const s={},i=p(t,["pageSize"]);e!==void 0&&i!=null&&h(e,["_query","pageSize"],i);const o=p(t,["pageToken"]);e!==void 0&&o!=null&&h(e,["_query","pageToken"],o);const u=p(t,["filter"]);return e!==void 0&&u!=null&&h(e,["_query","filter"],u),s}function BP(t,e,n){const s={},i=p(t,["pageSize"]);e!==void 0&&i!=null&&h(e,["_query","pageSize"],i);const o=p(t,["pageToken"]);e!==void 0&&o!=null&&h(e,["_query","pageToken"],o);const u=p(t,["filter"]);return e!==void 0&&u!=null&&h(e,["_query","filter"],u),s}function FP(t,e){const n={},s=p(t,["config"]);return s!=null&&qP(s,n),n}function $P(t,e){const n={},s=p(t,["config"]);return s!=null&&BP(s,n),n}function HP(t,e){const n={},s=p(t,["sdkHttpResponse"]);s!=null&&h(n,["sdkHttpResponse"],s);const i=p(t,["nextPageToken"]);i!=null&&h(n,["nextPageToken"],i);const o=p(t,["tunedModels"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(d=>px(d))),h(n,["tuningJobs"],u)}return n}function GP(t,e){const n={},s=p(t,["sdkHttpResponse"]);s!=null&&h(n,["sdkHttpResponse"],s);const i=p(t,["nextPageToken"]);i!=null&&h(n,["nextPageToken"],i);const o=p(t,["tuningJobs"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(d=>Sp(d))),h(n,["tuningJobs"],u)}return n}function VP(t,e){const n={},s=p(t,["name"]);s!=null&&h(n,["model"],s);const i=p(t,["name"]);return i!=null&&h(n,["endpoint"],i),n}function zP(t,e){const n={};if(p(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(p(t,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const s=p(t,["examples"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(o=>o)),h(n,["examples","examples"],i)}return n}function jP(t,e,n){const s={};let i=p(n,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){const u=p(t,["gcsUri"]);e!==void 0&&u!=null&&h(e,["supervisedTuningSpec","trainingDatasetUri"],u)}else if(i==="PREFERENCE_TUNING"){const u=p(t,["gcsUri"]);e!==void 0&&u!=null&&h(e,["preferenceOptimizationSpec","trainingDatasetUri"],u)}let o=p(n,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){const u=p(t,["vertexDatasetResource"]);e!==void 0&&u!=null&&h(e,["supervisedTuningSpec","trainingDatasetUri"],u)}else if(o==="PREFERENCE_TUNING"){const u=p(t,["vertexDatasetResource"]);e!==void 0&&u!=null&&h(e,["preferenceOptimizationSpec","trainingDatasetUri"],u)}if(p(t,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return s}function px(t,e){const n={},s=p(t,["sdkHttpResponse"]);s!=null&&h(n,["sdkHttpResponse"],s);const i=p(t,["name"]);i!=null&&h(n,["name"],i);const o=p(t,["state"]);o!=null&&h(n,["state"],J_(o));const u=p(t,["createTime"]);u!=null&&h(n,["createTime"],u);const d=p(t,["tuningTask","startTime"]);d!=null&&h(n,["startTime"],d);const m=p(t,["tuningTask","completeTime"]);m!=null&&h(n,["endTime"],m);const f=p(t,["updateTime"]);f!=null&&h(n,["updateTime"],f);const y=p(t,["description"]);y!=null&&h(n,["description"],y);const S=p(t,["baseModel"]);S!=null&&h(n,["baseModel"],S);const _=p(t,["_self"]);return _!=null&&h(n,["tunedModel"],VP(_)),n}function Sp(t,e){const n={},s=p(t,["sdkHttpResponse"]);s!=null&&h(n,["sdkHttpResponse"],s);const i=p(t,["name"]);i!=null&&h(n,["name"],i);const o=p(t,["state"]);o!=null&&h(n,["state"],J_(o));const u=p(t,["createTime"]);u!=null&&h(n,["createTime"],u);const d=p(t,["startTime"]);d!=null&&h(n,["startTime"],d);const m=p(t,["endTime"]);m!=null&&h(n,["endTime"],m);const f=p(t,["updateTime"]);f!=null&&h(n,["updateTime"],f);const y=p(t,["error"]);y!=null&&h(n,["error"],y);const S=p(t,["description"]);S!=null&&h(n,["description"],S);const _=p(t,["baseModel"]);_!=null&&h(n,["baseModel"],_);const T=p(t,["tunedModel"]);T!=null&&h(n,["tunedModel"],T);const C=p(t,["preTunedModel"]);C!=null&&h(n,["preTunedModel"],C);const N=p(t,["supervisedTuningSpec"]);N!=null&&h(n,["supervisedTuningSpec"],N);const E=p(t,["preferenceOptimizationSpec"]);E!=null&&h(n,["preferenceOptimizationSpec"],E);const L=p(t,["tuningDataStats"]);L!=null&&h(n,["tuningDataStats"],L);const B=p(t,["encryptionSpec"]);B!=null&&h(n,["encryptionSpec"],B);const O=p(t,["partnerModelTuningSpec"]);O!=null&&h(n,["partnerModelTuningSpec"],O);const x=p(t,["customBaseModel"]);x!=null&&h(n,["customBaseModel"],x);const I=p(t,["experiment"]);I!=null&&h(n,["experiment"],I);const D=p(t,["labels"]);D!=null&&h(n,["labels"],D);const R=p(t,["outputUri"]);R!=null&&h(n,["outputUri"],R);const P=p(t,["pipelineJob"]);P!=null&&h(n,["pipelineJob"],P);const A=p(t,["serviceAccount"]);A!=null&&h(n,["serviceAccount"],A);const k=p(t,["tunedModelDisplayName"]);k!=null&&h(n,["tunedModelDisplayName"],k);const F=p(t,["veoTuningSpec"]);return F!=null&&h(n,["veoTuningSpec"],F),n}function YP(t,e){const n={},s=p(t,["sdkHttpResponse"]);s!=null&&h(n,["sdkHttpResponse"],s);const i=p(t,["name"]);i!=null&&h(n,["name"],i);const o=p(t,["metadata"]);o!=null&&h(n,["metadata"],o);const u=p(t,["done"]);u!=null&&h(n,["done"],u);const d=p(t,["error"]);return d!=null&&h(n,["error"],d),n}function XS(t,e){const n={},s=p(t,["gcsUri"]);s!=null&&h(n,["validationDatasetUri"],s);const i=p(t,["vertexDatasetResource"]);return i!=null&&h(n,["validationDatasetUri"],i),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class JP extends As{constructor(e){super(),this.apiClient=e,this.get=async n=>await this.getInternal(n),this.list=async(n={})=>new Ha(Cs.PAGED_ITEM_TUNING_JOBS,s=>this.listInternal(s),await this.listInternal(n),n),this.tune=async n=>{var s;if(this.apiClient.isVertexAI())if(n.baseModel.startsWith("projects/")){const i={tunedModelName:n.baseModel};!((s=n.config)===null||s===void 0)&&s.preTunedModelCheckpointId&&(i.checkpointId=n.config.preTunedModelCheckpointId);const o=Object.assign(Object.assign({},n),{preTunedModel:i});return o.baseModel=void 0,await this.tuneInternal(o)}else{const i=Object.assign({},n);return await this.tuneInternal(i)}else{const i=Object.assign({},n),o=await this.tuneMldevInternal(i);let u="";return o.metadata!==void 0&&o.metadata.tunedModel!==void 0?u=o.metadata.tunedModel:o.name!==void 0&&o.name.includes("/operations/")&&(u=o.name.split("/operations/")[0]),{name:u,state:fp.JOB_STATE_QUEUED}}}}async getInternal(e){var n,s,i,o;let u,d="",m={};if(this.apiClient.isVertexAI()){const f=OP(e);return d=de("{name}",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json().then(S=>{const _=S;return _.sdkHttpResponse={headers:y.headers},_})),u.then(y=>Sp(y))}else{const f=UP(e);return d=de("{name}",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(y=>y.json().then(S=>{const _=S;return _.sdkHttpResponse={headers:y.headers},_})),u.then(y=>px(y))}}async listInternal(e){var n,s,i,o;let u,d="",m={};if(this.apiClient.isVertexAI()){const f=$P(e);return d=de("tuningJobs",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(y=>y.json().then(S=>{const _=S;return _.sdkHttpResponse={headers:y.headers},_})),u.then(y=>{const S=GP(y),_=new IS;return Object.assign(_,S),_})}else{const f=FP(e);return d=de("tunedModels",f._url),m=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:m,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(y=>y.json().then(S=>{const _=S;return _.sdkHttpResponse={headers:y.headers},_})),u.then(y=>{const S=HP(y),_=new IS;return Object.assign(_,S),_})}}async cancel(e){var n,s,i,o;let u="",d={};if(this.apiClient.isVertexAI()){const m=MP(e);u=de("{name}:cancel",m._url),d=m._query,delete m._url,delete m._query,await this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}else{const m=RP(e);u=de("{name}:cancel",m._url),d=m._query,delete m._url,delete m._query,await this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(m),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}}async tuneInternal(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI()){const d=kP(e,e);return o=de("tuningJobs",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json().then(f=>{const y=f;return y.sdkHttpResponse={headers:m.headers},y})),i.then(m=>Sp(m))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var n,s;let i,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=LP(e);return o=de("tunedModels",d._url),u=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(m=>m.json().then(f=>{const y=f;return y.sdkHttpResponse={headers:m.headers},y})),i.then(m=>YP(m))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class KP{async download(e,n){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const XP=1024*1024*8,QP=3,WP=1e3,ZP=2,Mu="x-goog-upload-status";async function eD(t,e,n){var s;const i=await mx(t,e,n),o=await(i==null?void 0:i.json());if(((s=i==null?void 0:i.headers)===null||s===void 0?void 0:s[Mu])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return o.file}async function tD(t,e,n){var s;const i=await mx(t,e,n),o=await(i==null?void 0:i.json());if(((s=i==null?void 0:i.headers)===null||s===void 0?void 0:s[Mu])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const u=H_(o),d=new tm;return Object.assign(d,u),d}async function mx(t,e,n){var s,i;let o=0,u=0,d=new pp(new Response),m="upload";for(o=t.size;u<o;){const f=Math.min(XP,o-u),y=t.slice(u,u+f);u+f>=o&&(m+=", finalize");let S=0,_=WP;for(;S<QP&&(d=await n.request({path:"",body:y,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":m,"X-Goog-Upload-Offset":String(u),"Content-Length":String(f)}}}),!(!((s=d==null?void 0:d.headers)===null||s===void 0)&&s[Mu]));)S++,await sD(_),_=_*ZP;if(u+=f,((i=d==null?void 0:d.headers)===null||i===void 0?void 0:i[Mu])!=="active")break;if(o<=u)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return d}async function nD(t){return{size:t.size,type:t.type}}function sD(t){return new Promise(e=>setTimeout(e,t))}class aD{async upload(e,n,s){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await eD(e,n,s)}async uploadToFileSearchStore(e,n,s){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await tD(e,n,s)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await nD(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class rD{create(e,n,s){return new iD(e,n,s)}}class iD{constructor(e,n,s){this.url=e,this.headers=n,this.callbacks=s}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const QS="x-goog-api-key";class oD{constructor(e){this.apiKey=e}async addAuthHeaders(e,n){if(e.get(QS)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(QS,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const lD="gl-node/";class uD{constructor(e){var n;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(n=e.vertexai)!==null&&n!==void 0?n:!1,this.apiKey=e.apiKey;const s=ZE(e.httpOptions,e.vertexai,void 0,void 0);s&&(e.httpOptions?e.httpOptions.baseUrl=s:e.httpOptions={baseUrl:s}),this.apiVersion=e.apiVersion;const i=new oD(this.apiKey);this.apiClient=new C1({auth:i,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:lD+"web",uploader:new aD,downloader:new KP}),this.models=new V1(this.apiClient),this.live=new q1(this.apiClient,i,new rD),this.batches=new TI(this.apiClient),this.chats=new nR(this.models,this.apiClient),this.caches=new ZI(this.apiClient),this.files=new fR(this.apiClient),this.operations=new z1(this.apiClient),this.authTokens=new iP(this.apiClient),this.tunings=new JP(this.apiClient),this.fileSearchStores=new IP(this.apiClient)}}const wp="RFC3986",_p={RFC1738:t=>String(t).replace(/%20/g,"+"),RFC3986:t=>String(t)},cD="RFC1738",dD=Array.isArray,Hn=(()=>{const t=[];for(let e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t})(),Of=1024,fD=(t,e,n,s,i)=>{if(t.length===0)return t;let o=t;if(typeof t=="symbol"?o=Symbol.prototype.toString.call(t):typeof t!="string"&&(o=String(t)),n==="iso-8859-1")return escape(o).replace(/%u[0-9a-f]{4}/gi,function(d){return"%26%23"+parseInt(d.slice(2),16)+"%3B"});let u="";for(let d=0;d<o.length;d+=Of){const m=o.length>=Of?o.slice(d,d+Of):o,f=[];for(let y=0;y<m.length;++y){let S=m.charCodeAt(y);if(S===45||S===46||S===95||S===126||S>=48&&S<=57||S>=65&&S<=90||S>=97&&S<=122||i===cD&&(S===40||S===41)){f[f.length]=m.charAt(y);continue}if(S<128){f[f.length]=Hn[S];continue}if(S<2048){f[f.length]=Hn[192|S>>6]+Hn[128|S&63];continue}if(S<55296||S>=57344){f[f.length]=Hn[224|S>>12]+Hn[128|S>>6&63]+Hn[128|S&63];continue}y+=1,S=65536+((S&1023)<<10|m.charCodeAt(y)&1023),f[f.length]=Hn[240|S>>18]+Hn[128|S>>12&63]+Hn[128|S>>6&63]+Hn[128|S&63]}u+=f.join("")}return u};function pD(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))}function WS(t,e){if(dD(t)){const n=[];for(let s=0;s<t.length;s+=1)n.push(e(t[s]));return n}return e(t)}const mD=Object.prototype.hasOwnProperty,hx={brackets(t){return String(t)+"[]"},comma:"comma",indices(t,e){return String(t)+"["+e+"]"},repeat(t){return String(t)}},Gn=Array.isArray,hD=Array.prototype.push,gx=function(t,e){hD.apply(t,Gn(e)?e:[e])},gD=Date.prototype.toISOString,_t={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:fD,encodeValuesOnly:!1,format:wp,formatter:_p[wp],indices:!1,serializeDate(t){return gD.call(t)},skipNulls:!1,strictNullHandling:!1};function yD(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"}const qf={};function yx(t,e,n,s,i,o,u,d,m,f,y,S,_,T,C,N,E,L){let B=t,O=L,x=0,I=!1;for(;(O=O.get(qf))!==void 0&&!I;){const k=O.get(t);if(x+=1,typeof k<"u"){if(k===x)throw new RangeError("Cyclic object value");I=!0}typeof O.get(qf)>"u"&&(x=0)}if(typeof f=="function"?B=f(e,B):B instanceof Date?B=_==null?void 0:_(B):n==="comma"&&Gn(B)&&(B=WS(B,function(k){return k instanceof Date?_==null?void 0:_(k):k})),B===null){if(o)return m&&!N?m(e,_t.encoder,E,"key",T):e;B=""}if(yD(B)||pD(B)){if(m){const k=N?e:m(e,_t.encoder,E,"key",T);return[(C==null?void 0:C(k))+"="+(C==null?void 0:C(m(B,_t.encoder,E,"value",T)))]}return[(C==null?void 0:C(e))+"="+(C==null?void 0:C(String(B)))]}const D=[];if(typeof B>"u")return D;let R;if(n==="comma"&&Gn(B))N&&m&&(B=WS(B,m)),R=[{value:B.length>0?B.join(",")||null:void 0}];else if(Gn(f))R=f;else{const k=Object.keys(B);R=y?k.sort(y):k}const P=d?String(e).replace(/\./g,"%2E"):String(e),A=s&&Gn(B)&&B.length===1?P+"[]":P;if(i&&Gn(B)&&B.length===0)return A+"[]";for(let k=0;k<R.length;++k){const F=R[k],U=typeof F=="object"&&typeof F.value<"u"?F.value:B[F];if(u&&U===null)continue;const z=S&&d?F.replace(/\./g,"%2E"):F,oe=Gn(B)?typeof n=="function"?n(A,z):A:A+(S?"."+z:"["+z+"]");L.set(t,x);const se=new WeakMap;se.set(qf,L),gx(D,yx(U,oe,n,s,i,o,u,d,n==="comma"&&N&&Gn(B)?null:m,f,y,S,_,T,C,N,E,se))}return D}function vD(t=_t){if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.encodeDotInKeys<"u"&&typeof t.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=t.charset||_t.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=wp;if(typeof t.format<"u"){if(!mD.call(_p,t.format))throw new TypeError("Unknown format option provided.");n=t.format}const s=_p[n];let i=_t.filter;(typeof t.filter=="function"||Gn(t.filter))&&(i=t.filter);let o;if(t.arrayFormat&&t.arrayFormat in hx?o=t.arrayFormat:"indices"in t?o=t.indices?"indices":"repeat":o=_t.arrayFormat,"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const u=typeof t.allowDots>"u"?t.encodeDotInKeys?!0:_t.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:_t.addQueryPrefix,allowDots:u,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:_t.allowEmptyArrays,arrayFormat:o,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:_t.charsetSentinel,commaRoundTrip:!!t.commaRoundTrip,delimiter:typeof t.delimiter>"u"?_t.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:_t.encode,encodeDotInKeys:typeof t.encodeDotInKeys=="boolean"?t.encodeDotInKeys:_t.encodeDotInKeys,encoder:typeof t.encoder=="function"?t.encoder:_t.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:_t.encodeValuesOnly,filter:i,format:n,formatter:s,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:_t.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:_t.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:_t.strictNullHandling}}function SD(t,e={}){let n=t;const s=vD(e);let i,o;typeof s.filter=="function"?(o=s.filter,n=o("",n)):Gn(s.filter)&&(o=s.filter,i=o);const u=[];if(typeof n!="object"||n===null)return"";const d=hx[s.arrayFormat],m=d==="comma"&&s.commaRoundTrip;i||(i=Object.keys(n)),s.sort&&i.sort(s.sort);const f=new WeakMap;for(let _=0;_<i.length;++_){const T=i[_];s.skipNulls&&n[T]===null||gx(u,yx(n[T],T,d,m,s.allowEmptyArrays,s.strictNullHandling,s.skipNulls,s.encodeDotInKeys,s.encode?s.encoder:null,s.filter,s.sort,s.allowDots,s.serializeDate,s.format,s.formatter,s.encodeValuesOnly,s.charset,f))}const y=u.join(s.delimiter);let S=s.addQueryPrefix===!0?"?":"";return s.charsetSentinel&&(s.charset==="iso-8859-1"?S+="utf8=%26%2310003%3B&":S+="utf8=%E2%9C%93&"),y.length>0?S+y:""}const kr="4.104.0";let ZS=!1,po,vx,Sx,xp,wx,_x,xx,bx,Tx;function wD(t,e={auto:!1}){if(ZS)throw new Error(`you must \`import 'openai/shims/${t.kind}'\` before importing anything else from openai`);if(po)throw new Error(`can't \`import 'openai/shims/${t.kind}'\` after \`import 'openai/shims/${po}'\``);ZS=e.auto,po=t.kind,vx=t.fetch,Sx=t.FormData,xp=t.File,wx=t.ReadableStream,_x=t.getMultipartRequestOptions,xx=t.getDefaultAgent,bx=t.fileFromPath,Tx=t.isFsReadStream}class _D{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function xD({manuallyImported:t}={}){const e=t?"You may need to use polyfills":"Add one of these imports before your first `import  from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let n,s,i,o;try{n=fetch,s=Request,i=Response,o=Headers}catch(u){throw new Error(`this environment is missing the following Web Fetch API type: ${u.message}. ${e}`)}return{kind:"web",fetch:n,Request:s,Response:i,Headers:o,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(u,d)=>({...d,body:new _D(u)}),getDefaultAgent:u=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:u=>!1}}const Cx=()=>{po||wD(xD(),{auto:!0})};Cx();class be extends Error{}class kt extends be{constructor(e,n,s,i){super(`${kt.makeMessage(e,n,s)}`),this.status=e,this.headers=i,this.request_id=i==null?void 0:i["x-request-id"],this.error=n;const o=n;this.code=o==null?void 0:o.code,this.param=o==null?void 0:o.param,this.type=o==null?void 0:o.type}static makeMessage(e,n,s){const i=n!=null&&n.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):n?JSON.stringify(n):s;return e&&i?`${e} ${i}`:e?`${e} status code (no body)`:i||"(no status code or body)"}static generate(e,n,s,i){if(!e||!i)return new ju({message:s,cause:Tp(n)});const o=n==null?void 0:n.error;return e===400?new Ax(e,o,s,i):e===401?new Ex(e,o,s,i):e===403?new Nx(e,o,s,i):e===404?new Ix(e,o,s,i):e===409?new Rx(e,o,s,i):e===422?new Mx(e,o,s,i):e===429?new Px(e,o,s,i):e>=500?new Dx(e,o,s,i):new kt(e,o,s,i)}}class Cn extends kt{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class ju extends kt{constructor({message:e,cause:n}){super(void 0,void 0,e||"Connection error.",void 0),n&&(this.cause=n)}}class om extends ju{constructor({message:e}={}){super({message:e??"Request timed out."})}}class Ax extends kt{}class Ex extends kt{}class Nx extends kt{}class Ix extends kt{}class Rx extends kt{}class Mx extends kt{}class Px extends kt{}class Dx extends kt{}class Lx extends be{constructor(){super("Could not parse response content as the length limit was reached")}}class kx extends be{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var nu=function(t,e,n,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(t,n):i?i.value=n:e.set(t,n),n},Ma=function(t,e,n,s){if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)},dn;class Yu{constructor(){dn.set(this,void 0),this.buffer=new Uint8Array,nu(this,dn,null,"f")}decode(e){if(e==null)return[];const n=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e;let s=new Uint8Array(this.buffer.length+n.length);s.set(this.buffer),s.set(n,this.buffer.length),this.buffer=s;const i=[];let o;for(;(o=bD(this.buffer,Ma(this,dn,"f")))!=null;){if(o.carriage&&Ma(this,dn,"f")==null){nu(this,dn,o.index,"f");continue}if(Ma(this,dn,"f")!=null&&(o.index!==Ma(this,dn,"f")+1||o.carriage)){i.push(this.decodeText(this.buffer.slice(0,Ma(this,dn,"f")-1))),this.buffer=this.buffer.slice(Ma(this,dn,"f")),nu(this,dn,null,"f");continue}const u=Ma(this,dn,"f")!==null?o.preceding-1:o.preceding,d=this.decodeText(this.buffer.slice(0,u));i.push(d),this.buffer=this.buffer.slice(o.index),nu(this,dn,null,"f")}return i}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new be(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new be(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new be("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}}dn=new WeakMap;Yu.NEWLINE_CHARS=new Set([`
`,"\r"]);Yu.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function bD(t,e){for(let i=e??0;i<t.length;i++){if(t[i]===10)return{preceding:i,index:i+1,carriage:!1};if(t[i]===13)return{preceding:i,index:i+1,carriage:!0}}return null}function TD(t){for(let s=0;s<t.length-1;s++){if(t[s]===10&&t[s+1]===10||t[s]===13&&t[s+1]===13)return s+2;if(t[s]===13&&t[s+1]===10&&s+3<t.length&&t[s+2]===13&&t[s+3]===10)return s+4}return-1}function Ux(t){if(t[Symbol.asyncIterator])return t;const e=t.getReader();return{async next(){try{const n=await e.read();return n!=null&&n.done&&e.releaseLock(),n}catch(n){throw e.releaseLock(),n}},async return(){const n=e.cancel();return e.releaseLock(),await n,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}class zn{constructor(e,n){this.iterator=e,this.controller=n}static fromSSEResponse(e,n){let s=!1;async function*i(){if(s)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let o=!1;try{for await(const u of CD(e,n))if(!o){if(u.data.startsWith("[DONE]")){o=!0;continue}if(u.event===null||u.event.startsWith("response.")||u.event.startsWith("transcript.")){let d;try{d=JSON.parse(u.data)}catch(m){throw console.error("Could not parse message into JSON:",u.data),console.error("From chunk:",u.raw),m}if(d&&d.error)throw new kt(void 0,d.error,void 0,Gx(e.headers));yield d}else{let d;try{d=JSON.parse(u.data)}catch(m){throw console.error("Could not parse message into JSON:",u.data),console.error("From chunk:",u.raw),m}if(u.event=="error")throw new kt(void 0,d.error,d.message,void 0);yield{event:u.event,data:d}}}o=!0}catch(u){if(u instanceof Error&&u.name==="AbortError")return;throw u}finally{o||n.abort()}}return new zn(i,n)}static fromReadableStream(e,n){let s=!1;async function*i(){const u=new Yu,d=Ux(e);for await(const m of d)for(const f of u.decode(m))yield f;for(const m of u.flush())yield m}async function*o(){if(s)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let u=!1;try{for await(const d of i())u||d&&(yield JSON.parse(d));u=!0}catch(d){if(d instanceof Error&&d.name==="AbortError")return;throw d}finally{u||n.abort()}}return new zn(o,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],n=[],s=this.iterator(),i=o=>({next:()=>{if(o.length===0){const u=s.next();e.push(u),n.push(u)}return o.shift()}});return[new zn(()=>i(e),this.controller),new zn(()=>i(n),this.controller)]}toReadableStream(){const e=this;let n;const s=new TextEncoder;return new wx({async start(){n=e[Symbol.asyncIterator]()},async pull(i){try{const{value:o,done:u}=await n.next();if(u)return i.close();const d=s.encode(JSON.stringify(o)+`
`);i.enqueue(d)}catch(o){i.error(o)}},async cancel(){var i;await((i=n.return)==null?void 0:i.call(n))}})}}async function*CD(t,e){if(!t.body)throw e.abort(),new be("Attempted to iterate over a response with no body");const n=new ED,s=new Yu,i=Ux(t.body);for await(const o of AD(i))for(const u of s.decode(o)){const d=n.decode(u);d&&(yield d)}for(const o of s.flush()){const u=n.decode(o);u&&(yield u)}}async function*AD(t){let e=new Uint8Array;for await(const n of t){if(n==null)continue;const s=n instanceof ArrayBuffer?new Uint8Array(n):typeof n=="string"?new TextEncoder().encode(n):n;let i=new Uint8Array(e.length+s.length);i.set(e),i.set(s,e.length),e=i;let o;for(;(o=TD(e))!==-1;)yield e.slice(0,o),e=e.slice(o)}e.length>0&&(yield e)}class ED{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const o={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],o}if(this.chunks.push(e),e.startsWith(":"))return null;let[n,s,i]=ND(e,":");return i.startsWith(" ")&&(i=i.substring(1)),n==="event"?this.event=i:n==="data"&&this.data.push(i),null}}function ND(t,e){const n=t.indexOf(e);return n!==-1?[t.substring(0,n),e,t.substring(n+e.length)]:[t,"",""]}const Ox=t=>t!=null&&typeof t=="object"&&typeof t.url=="string"&&typeof t.blob=="function",qx=t=>t!=null&&typeof t=="object"&&typeof t.name=="string"&&typeof t.lastModified=="number"&&Ju(t),Ju=t=>t!=null&&typeof t=="object"&&typeof t.size=="number"&&typeof t.type=="string"&&typeof t.text=="function"&&typeof t.slice=="function"&&typeof t.arrayBuffer=="function",ID=t=>qx(t)||Ox(t)||Tx(t);async function Bx(t,e,n){var i;if(t=await t,qx(t))return t;if(Ox(t)){const o=await t.blob();e||(e=new URL(t.url).pathname.split(/[\\/]/).pop()??"unknown_file");const u=Ju(o)?[await o.arrayBuffer()]:[o];return new xp(u,e,n)}const s=await RD(t);if(e||(e=PD(t)??"unknown_file"),!(n!=null&&n.type)){const o=(i=s[0])==null?void 0:i.type;typeof o=="string"&&(n={...n,type:o})}return new xp(s,e,n)}async function RD(t){var n;let e=[];if(typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)e.push(t);else if(Ju(t))e.push(await t.arrayBuffer());else if(DD(t))for await(const s of t)e.push(s);else throw new Error(`Unexpected data type: ${typeof t}; constructor: ${(n=t==null?void 0:t.constructor)==null?void 0:n.name}; props: ${MD(t)}`);return e}function MD(t){return`[${Object.getOwnPropertyNames(t).map(n=>`"${n}"`).join(", ")}]`}function PD(t){var e;return Bf(t.name)||Bf(t.filename)||((e=Bf(t.path))==null?void 0:e.split(/[\\/]/).pop())}const Bf=t=>{if(typeof t=="string")return t;if(typeof Buffer<"u"&&t instanceof Buffer)return String(t)},DD=t=>t!=null&&typeof t=="object"&&typeof t[Symbol.asyncIterator]=="function",ew=t=>t&&typeof t=="object"&&t.body&&t[Symbol.toStringTag]==="MultipartBody",Fa=async t=>{const e=await LD(t.body);return _x(e,t)},LD=async t=>{const e=new Sx;return await Promise.all(Object.entries(t||{}).map(([n,s])=>bp(e,n,s))),e},bp=async(t,e,n)=>{if(n!==void 0){if(n==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")t.append(e,String(n));else if(ID(n)){const s=await Bx(n);t.append(e,s)}else if(Array.isArray(n))await Promise.all(n.map(s=>bp(t,e+"[]",s)));else if(typeof n=="object")await Promise.all(Object.entries(n).map(([s,i])=>bp(t,`${e}[${s}]`,i)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`)}};var jr={},kD=function(t,e,n,s,i){if(typeof e=="function"?t!==e||!0:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,n),n},UD=function(t,e,n,s){if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)},su;Cx();async function Fx(t){var u;const{response:e}=t;if(t.options.stream)return aa("response",e.status,e.url,e.headers,e.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(e,t.controller):zn.fromSSEResponse(e,t.controller);if(e.status===204)return null;if(t.options.__binaryResponse)return e;const n=e.headers.get("content-type"),s=(u=n==null?void 0:n.split(";")[0])==null?void 0:u.trim();if((s==null?void 0:s.includes("application/json"))||(s==null?void 0:s.endsWith("+json"))){const d=await e.json();return aa("response",e.status,e.url,e.headers,d),$x(d,e)}const o=await e.text();return aa("response",e.status,e.url,e.headers,o),o}function $x(t,e){return!t||typeof t!="object"||Array.isArray(t)?t:Object.defineProperty(t,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}class Ku extends Promise{constructor(e,n=Fx){super(s=>{s(null)}),this.responsePromise=e,this.parseResponse=n}_thenUnwrap(e){return new Ku(this.responsePromise,async n=>$x(e(await this.parseResponse(n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,n]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:n,request_id:n.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,n){return this.parse().then(e,n)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class OD{constructor({baseURL:e,maxRetries:n=2,timeout:s=6e5,httpAgent:i,fetch:o}){this.baseURL=e,this.maxRetries=Ff("maxRetries",n),this.timeout=Ff("timeout",s),this.httpAgent=i,this.fetch=o??vx}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...HD(),...this.authHeaders(e)}}validateHeaders(e,n){}defaultIdempotencyKey(){return`stainless-node-retry-${jD()}`}get(e,n){return this.methodRequest("get",e,n)}post(e,n){return this.methodRequest("post",e,n)}patch(e,n){return this.methodRequest("patch",e,n)}put(e,n){return this.methodRequest("put",e,n)}delete(e,n){return this.methodRequest("delete",e,n)}methodRequest(e,n,s){return this.request(Promise.resolve(s).then(async i=>{const o=i&&Ju(i==null?void 0:i.body)?new DataView(await i.body.arrayBuffer()):(i==null?void 0:i.body)instanceof DataView?i.body:(i==null?void 0:i.body)instanceof ArrayBuffer?new DataView(i.body):i&&ArrayBuffer.isView(i==null?void 0:i.body)?new DataView(i.body.buffer):i==null?void 0:i.body;return{method:e,path:n,...i,body:o}}))}getAPIList(e,n,s){return this.requestAPIList(n,{method:"get",path:e,...s})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:n=0}={}){var N;const s={...e},{method:i,path:o,query:u,headers:d={}}=s,m=ArrayBuffer.isView(s.body)||s.__binaryRequest&&typeof s.body=="string"?s.body:ew(s.body)?s.body.body:s.body?JSON.stringify(s.body,null,2):null,f=this.calculateContentLength(m),y=this.buildURL(o,u);"timeout"in s&&Ff("timeout",s.timeout),s.timeout=s.timeout??this.timeout;const S=s.httpAgent??this.httpAgent??xx(y),_=s.timeout+1e3;typeof((N=S==null?void 0:S.options)==null?void 0:N.timeout)=="number"&&_>(S.options.timeout??0)&&(S.options.timeout=_),this.idempotencyHeader&&i!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),d[this.idempotencyHeader]=e.idempotencyKey);const T=this.buildHeaders({options:s,headers:d,contentLength:f,retryCount:n});return{req:{method:i,...m&&{body:m},headers:T,...S&&{agent:S},signal:s.signal??null},url:y,timeout:s.timeout}}buildHeaders({options:e,headers:n,contentLength:s,retryCount:i}){const o={};s&&(o["content-length"]=s);const u=this.defaultHeaders(e);return aw(o,u),aw(o,n),ew(e.body)&&po!=="node"&&delete o["content-type"],ru(u,"x-stainless-retry-count")===void 0&&ru(n,"x-stainless-retry-count")===void 0&&(o["x-stainless-retry-count"]=String(i)),ru(u,"x-stainless-timeout")===void 0&&ru(n,"x-stainless-timeout")===void 0&&e.timeout&&(o["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(o,n),o}async prepareOptions(e){}async prepareRequest(e,{url:n,options:s}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(n=>[...n])):{...e}:{}}makeStatusError(e,n,s,i){return kt.generate(e,n,s,i)}request(e,n=null){return new Ku(this.makeRequest(e,n))}async makeRequest(e,n){var S,_;const s=await e,i=s.maxRetries??this.maxRetries;n==null&&(n=i),await this.prepareOptions(s);const{req:o,url:u,timeout:d}=this.buildRequest(s,{retryCount:i-n});if(await this.prepareRequest(o,{url:u,options:s}),aa("request",u,s,o.headers),(S=s.signal)!=null&&S.aborted)throw new Cn;const m=new AbortController,f=await this.fetchWithTimeout(u,o,d,m).catch(Tp);if(f instanceof Error){if((_=s.signal)!=null&&_.aborted)throw new Cn;if(n)return this.retryRequest(s,n);throw f.name==="AbortError"?new om:new ju({cause:f})}const y=Gx(f.headers);if(!f.ok){if(n&&this.shouldRetry(f)){const B=`retrying, ${n} attempts remaining`;return aa(`response (error; ${B})`,f.status,u,y),this.retryRequest(s,n,y)}const T=await f.text().catch(B=>Tp(B).message),C=GD(T),N=C?void 0:T;throw aa(`response (error; ${n?"(error; no more retries left)":"(error; not retryable)"})`,f.status,u,y,N),this.makeStatusError(f.status,C,N,y)}return{response:f,options:s,controller:m}}requestAPIList(e,n){const s=this.makeRequest(n,null);return new qD(this,s,e)}buildURL(e,n){const s=zD(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return Vx(i)||(n={...i,...n}),typeof n=="object"&&n&&!Array.isArray(n)&&(s.search=this.stringifyQuery(n)),s.toString()}stringifyQuery(e){return Object.entries(e).filter(([n,s])=>typeof s<"u").map(([n,s])=>{if(typeof s=="string"||typeof s=="number"||typeof s=="boolean")return`${encodeURIComponent(n)}=${encodeURIComponent(s)}`;if(s===null)return`${encodeURIComponent(n)}=`;throw new be(`Cannot stringify type ${typeof s}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,n,s,i){const{signal:o,...u}=n||{};o&&o.addEventListener("abort",()=>i.abort());const d=setTimeout(()=>i.abort(),s),m={signal:i.signal,...u};return m.method&&(m.method=m.method.toUpperCase()),this.fetch.call(void 0,e,m).finally(()=>{clearTimeout(d)})}shouldRetry(e){const n=e.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,n,s){let i;const o=s==null?void 0:s["retry-after-ms"];if(o){const d=parseFloat(o);Number.isNaN(d)||(i=d)}const u=s==null?void 0:s["retry-after"];if(u&&!i){const d=parseFloat(u);Number.isNaN(d)?i=Date.parse(u)-Date.now():i=d*1e3}if(!(i&&0<=i&&i<60*1e3)){const d=e.maxRetries??this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(n,d)}return await No(i),this.makeRequest(e,n-1)}calculateDefaultRetryTimeoutMillis(e,n){const o=n-e,u=Math.min(.5*Math.pow(2,o),8),d=1-Math.random()*.25;return u*d*1e3}getUserAgent(){return`${this.constructor.name}/JS ${kr}`}}class Hx{constructor(e,n,s,i){su.set(this,void 0),kD(this,su,e),this.options=i,this.response=n,this.body=s}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new be("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const n={...this.options};if("params"in e&&typeof n.query=="object")n.query={...n.query,...e.params};else if("url"in e){const s=[...Object.entries(n.query||{}),...e.url.searchParams.entries()];for(const[i,o]of s)e.url.searchParams.set(i,o);n.query=void 0,n.path=e.url.toString()}return await UD(this,su,"f").requestAPIList(this.constructor,n)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(su=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const n of e.getPaginatedItems())yield n}}class qD extends Ku{constructor(e,n,s){super(n,async i=>new s(e,i.response,await Fx(i),i.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const n of e)yield n}}const Gx=t=>new Proxy(Object.fromEntries(t.entries()),{get(e,n){const s=n.toString();return e[s.toLowerCase()]||e[s]}}),BD={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},ot=t=>typeof t=="object"&&t!==null&&!Vx(t)&&Object.keys(t).every(e=>zx(BD,e)),FD=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":kr,"X-Stainless-OS":nw(Deno.build.os),"X-Stainless-Arch":tw(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":kr,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":kr,"X-Stainless-OS":nw(process.platform),"X-Stainless-Arch":tw(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const t=$D();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":kr,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":kr,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function $D(){if(typeof navigator>"u"||!navigator)return null;const t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:n}of t){const s=n.exec(navigator.userAgent);if(s){const i=s[1]||0,o=s[2]||0,u=s[3]||0;return{browser:e,version:`${i}.${o}.${u}`}}}return null}const tw=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",nw=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown");let sw;const HD=()=>sw??(sw=FD()),GD=t=>{try{return JSON.parse(t)}catch{return}},VD=/^[a-z][a-z0-9+.-]*:/i,zD=t=>VD.test(t),No=t=>new Promise(e=>setTimeout(e,t)),Ff=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new be(`${t} must be an integer`);if(e<0)throw new be(`${t} must be a positive integer`);return e},Tp=t=>{if(t instanceof Error)return t;if(typeof t=="object"&&t!==null)try{return new Error(JSON.stringify(t))}catch{}return new Error(t)},au=t=>{var e,n,s,i;if(typeof process<"u")return((e=jr==null?void 0:jr[t])==null?void 0:e.trim())??void 0;if(typeof Deno<"u")return(i=(s=(n=Deno.env)==null?void 0:n.get)==null?void 0:s.call(n,t))==null?void 0:i.trim()};function Vx(t){if(!t)return!0;for(const e in t)return!1;return!0}function zx(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function aw(t,e){for(const n in e){if(!zx(e,n))continue;const s=n.toLowerCase();if(!s)continue;const i=e[n];i===null?delete t[s]:i!==void 0&&(t[s]=i)}}const rw=new Set(["authorization","api-key"]);function aa(t,...e){if(typeof process<"u"&&(jr==null?void 0:jr.DEBUG)==="true"){const n=e.map(s=>{if(!s)return s;if(s.headers){const o={...s,headers:{...s.headers}};for(const u in s.headers)rw.has(u.toLowerCase())&&(o.headers[u]="REDACTED");return o}let i=null;for(const o in s)rw.has(o.toLowerCase())&&(i??(i={...s}),i[o]="REDACTED");return i??s});console.log(`OpenAI:DEBUG:${t}`,...n)}}const jD=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),YD=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",JD=t=>typeof(t==null?void 0:t.get)=="function",ru=(t,e)=>{var s;const n=e.toLowerCase();if(JD(t)){const i=((s=e[0])==null?void 0:s.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(o,u,d)=>u+d.toUpperCase());for(const o of[e,n,e.toUpperCase(),i]){const u=t.get(o);if(u)return u}}for(const[i,o]of Object.entries(t))if(i.toLowerCase()===n)return Array.isArray(o)?(o.length<=1||console.warn(`Received ${o.length} entries for the ${e} header, using the first entry.`),o[0]):o},KD=t=>{if(typeof Buffer<"u"){const e=Buffer.from(t,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{const e=atob(t),n=e.length,s=new Uint8Array(n);for(let i=0;i<n;i++)s[i]=e.charCodeAt(i);return Array.from(new Float32Array(s.buffer))}};function $f(t){return t!=null&&typeof t=="object"&&!Array.isArray(t)}class Xu extends Hx{constructor(e,n,s,i){super(e,n,s,i),this.data=s.data||[],this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class xt extends Hx{constructor(e,n,s,i){super(e,n,s,i),this.data=s.data||[],this.has_more=s.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const n=Object.fromEntries(e.url.searchParams);return Object.keys(n).length?n:null}nextPageInfo(){var s;const e=this.getPaginatedItems();if(!e.length)return null;const n=(s=e[e.length-1])==null?void 0:s.id;return n?{params:{after:n}}:null}}class Te{constructor(e){this._client=e}}let jx=class extends Te{list(e,n={},s){return ot(n)?this.list(e,{},n):this._client.getAPIList(`/chat/completions/${e}/messages`,XD,{query:n,...s})}},Qu=class extends Te{constructor(){super(...arguments),this.messages=new jx(this._client)}create(e,n){return this._client.post("/chat/completions",{body:e,...n,stream:e.stream??!1})}retrieve(e,n){return this._client.get(`/chat/completions/${e}`,n)}update(e,n,s){return this._client.post(`/chat/completions/${e}`,{body:n,...s})}list(e={},n){return ot(e)?this.list({},e):this._client.getAPIList("/chat/completions",Wu,{query:e,...n})}del(e,n){return this._client.delete(`/chat/completions/${e}`,n)}};class Wu extends xt{}class XD extends xt{}Qu.ChatCompletionsPage=Wu;Qu.Messages=jx;let Zu=class extends Te{constructor(){super(...arguments),this.completions=new Qu(this._client)}};Zu.Completions=Qu;Zu.ChatCompletionsPage=Wu;class Yx extends Te{create(e,n){return this._client.post("/audio/speech",{body:e,...n,headers:{Accept:"application/octet-stream",...n==null?void 0:n.headers},__binaryResponse:!0})}}class Jx extends Te{create(e,n){return this._client.post("/audio/transcriptions",Fa({body:e,...n,stream:e.stream??!1,__metadata:{model:e.model}}))}}class Kx extends Te{create(e,n){return this._client.post("/audio/translations",Fa({body:e,...n,__metadata:{model:e.model}}))}}class Io extends Te{constructor(){super(...arguments),this.transcriptions=new Jx(this._client),this.translations=new Kx(this._client),this.speech=new Yx(this._client)}}Io.Transcriptions=Jx;Io.Translations=Kx;Io.Speech=Yx;class lm extends Te{create(e,n){return this._client.post("/batches",{body:e,...n})}retrieve(e,n){return this._client.get(`/batches/${e}`,n)}list(e={},n){return ot(e)?this.list({},e):this._client.getAPIList("/batches",um,{query:e,...n})}cancel(e,n){return this._client.post(`/batches/${e}/cancel`,n)}}class um extends xt{}lm.BatchesPage=um;var Pn=function(t,e,n,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(t,n):i?i.value=n:e.set(t,n),n},it=function(t,e,n,s){if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)},Cp,gu,yu,ao,ro,vu,io,vs,oo,Pu,Du,Ur,Xx;class cm{constructor(){Cp.add(this),this.controller=new AbortController,gu.set(this,void 0),yu.set(this,()=>{}),ao.set(this,()=>{}),ro.set(this,void 0),vu.set(this,()=>{}),io.set(this,()=>{}),vs.set(this,{}),oo.set(this,!1),Pu.set(this,!1),Du.set(this,!1),Ur.set(this,!1),Pn(this,gu,new Promise((e,n)=>{Pn(this,yu,e,"f"),Pn(this,ao,n,"f")}),"f"),Pn(this,ro,new Promise((e,n)=>{Pn(this,vu,e,"f"),Pn(this,io,n,"f")}),"f"),it(this,gu,"f").catch(()=>{}),it(this,ro,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},it(this,Cp,"m",Xx).bind(this))},0)}_connected(){this.ended||(it(this,yu,"f").call(this),this._emit("connect"))}get ended(){return it(this,oo,"f")}get errored(){return it(this,Pu,"f")}get aborted(){return it(this,Du,"f")}abort(){this.controller.abort()}on(e,n){return(it(this,vs,"f")[e]||(it(this,vs,"f")[e]=[])).push({listener:n}),this}off(e,n){const s=it(this,vs,"f")[e];if(!s)return this;const i=s.findIndex(o=>o.listener===n);return i>=0&&s.splice(i,1),this}once(e,n){return(it(this,vs,"f")[e]||(it(this,vs,"f")[e]=[])).push({listener:n,once:!0}),this}emitted(e){return new Promise((n,s)=>{Pn(this,Ur,!0,"f"),e!=="error"&&this.once("error",s),this.once(e,n)})}async done(){Pn(this,Ur,!0,"f"),await it(this,ro,"f")}_emit(e,...n){if(it(this,oo,"f"))return;e==="end"&&(Pn(this,oo,!0,"f"),it(this,vu,"f").call(this));const s=it(this,vs,"f")[e];if(s&&(it(this,vs,"f")[e]=s.filter(i=>!i.once),s.forEach(({listener:i})=>i(...n))),e==="abort"){const i=n[0];!it(this,Ur,"f")&&!(s!=null&&s.length)&&Promise.reject(i),it(this,ao,"f").call(this,i),it(this,io,"f").call(this,i),this._emit("end");return}if(e==="error"){const i=n[0];!it(this,Ur,"f")&&!(s!=null&&s.length)&&Promise.reject(i),it(this,ao,"f").call(this,i),it(this,io,"f").call(this,i),this._emit("end")}}_emitFinal(){}}gu=new WeakMap,yu=new WeakMap,ao=new WeakMap,ro=new WeakMap,vu=new WeakMap,io=new WeakMap,vs=new WeakMap,oo=new WeakMap,Pu=new WeakMap,Du=new WeakMap,Ur=new WeakMap,Cp=new WeakSet,Xx=function(e){if(Pn(this,Pu,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new Cn),e instanceof Cn)return Pn(this,Du,!0,"f"),this._emit("abort",e);if(e instanceof be)return this._emit("error",e);if(e instanceof Error){const n=new be(e.message);return n.cause=e,this._emit("error",n)}return this._emit("error",new be(String(e)))};var ye=function(t,e,n,s){if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)},cn=function(t,e,n,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(t,n):i?i.value=n:e.set(t,n),n},Lt,Ap,Vn,Su,Dn,Ua,Br,ka,Lu,fn,wu,_u,mo,lo,uo,iw,ow,lw,uw,cw,dw,fw;class kn extends cm{constructor(){super(...arguments),Lt.add(this),Ap.set(this,[]),Vn.set(this,{}),Su.set(this,{}),Dn.set(this,void 0),Ua.set(this,void 0),Br.set(this,void 0),ka.set(this,void 0),Lu.set(this,void 0),fn.set(this,void 0),wu.set(this,void 0),_u.set(this,void 0),mo.set(this,void 0)}[(Ap=new WeakMap,Vn=new WeakMap,Su=new WeakMap,Dn=new WeakMap,Ua=new WeakMap,Br=new WeakMap,ka=new WeakMap,Lu=new WeakMap,fn=new WeakMap,wu=new WeakMap,_u=new WeakMap,mo=new WeakMap,Lt=new WeakSet,Symbol.asyncIterator)](){const e=[],n=[];let s=!1;return this.on("event",i=>{const o=n.shift();o?o.resolve(i):e.push(i)}),this.on("end",()=>{s=!0;for(const i of n)i.resolve(void 0);n.length=0}),this.on("abort",i=>{s=!0;for(const o of n)o.reject(i);n.length=0}),this.on("error",i=>{s=!0;for(const o of n)o.reject(i);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((o,u)=>n.push({resolve:o,reject:u})).then(o=>o?{value:o,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const n=new kn;return n._run(()=>n._fromReadableStream(e)),n}async _fromReadableStream(e,n){var o;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),this._connected();const i=zn.fromReadableStream(e,this.controller);for await(const u of i)ye(this,Lt,"m",lo).call(this,u);if((o=i.controller.signal)!=null&&o.aborted)throw new Cn;return this._addRun(ye(this,Lt,"m",uo).call(this))}toReadableStream(){return new zn(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,n,s,i,o){const u=new kn;return u._run(()=>u._runToolAssistantStream(e,n,s,i,{...o,headers:{...o==null?void 0:o.headers,"X-Stainless-Helper-Method":"stream"}})),u}async _createToolAssistantStream(e,n,s,i,o){var f;const u=o==null?void 0:o.signal;u&&(u.aborted&&this.controller.abort(),u.addEventListener("abort",()=>this.controller.abort()));const d={...i,stream:!0},m=await e.submitToolOutputs(n,s,d,{...o,signal:this.controller.signal});this._connected();for await(const y of m)ye(this,Lt,"m",lo).call(this,y);if((f=m.controller.signal)!=null&&f.aborted)throw new Cn;return this._addRun(ye(this,Lt,"m",uo).call(this))}static createThreadAssistantStream(e,n,s){const i=new kn;return i._run(()=>i._threadAssistantStream(e,n,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}static createAssistantStream(e,n,s,i){const o=new kn;return o._run(()=>o._runAssistantStream(e,n,s,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),o}currentEvent(){return ye(this,wu,"f")}currentRun(){return ye(this,_u,"f")}currentMessageSnapshot(){return ye(this,Dn,"f")}currentRunStepSnapshot(){return ye(this,mo,"f")}async finalRunSteps(){return await this.done(),Object.values(ye(this,Vn,"f"))}async finalMessages(){return await this.done(),Object.values(ye(this,Su,"f"))}async finalRun(){if(await this.done(),!ye(this,Ua,"f"))throw Error("Final run was not received.");return ye(this,Ua,"f")}async _createThreadAssistantStream(e,n,s){var d;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const o={...n,stream:!0},u=await e.createAndRun(o,{...s,signal:this.controller.signal});this._connected();for await(const m of u)ye(this,Lt,"m",lo).call(this,m);if((d=u.controller.signal)!=null&&d.aborted)throw new Cn;return this._addRun(ye(this,Lt,"m",uo).call(this))}async _createAssistantStream(e,n,s,i){var m;const o=i==null?void 0:i.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));const u={...s,stream:!0},d=await e.create(n,u,{...i,signal:this.controller.signal});this._connected();for await(const f of d)ye(this,Lt,"m",lo).call(this,f);if((m=d.controller.signal)!=null&&m.aborted)throw new Cn;return this._addRun(ye(this,Lt,"m",uo).call(this))}static accumulateDelta(e,n){for(const[s,i]of Object.entries(n)){if(!e.hasOwnProperty(s)){e[s]=i;continue}let o=e[s];if(o==null){e[s]=i;continue}if(s==="index"||s==="type"){e[s]=i;continue}if(typeof o=="string"&&typeof i=="string")o+=i;else if(typeof o=="number"&&typeof i=="number")o+=i;else if($f(o)&&$f(i))o=this.accumulateDelta(o,i);else if(Array.isArray(o)&&Array.isArray(i)){if(o.every(u=>typeof u=="string"||typeof u=="number")){o.push(...i);continue}for(const u of i){if(!$f(u))throw new Error(`Expected array delta entry to be an object but got: ${u}`);const d=u.index;if(d==null)throw console.error(u),new Error("Expected array delta entry to have an `index` property");if(typeof d!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${d}`);const m=o[d];m==null?o.push(u):o[d]=this.accumulateDelta(m,u)}continue}else throw Error(`Unhandled record type: ${s}, deltaValue: ${i}, accValue: ${o}`);e[s]=o}return e}_addRun(e){return e}async _threadAssistantStream(e,n,s){return await this._createThreadAssistantStream(n,e,s)}async _runAssistantStream(e,n,s,i){return await this._createAssistantStream(n,e,s,i)}async _runToolAssistantStream(e,n,s,i,o){return await this._createToolAssistantStream(s,e,n,i,o)}}lo=function(e){if(!this.ended)switch(cn(this,wu,e,"f"),ye(this,Lt,"m",lw).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":ye(this,Lt,"m",fw).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":ye(this,Lt,"m",ow).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":ye(this,Lt,"m",iw).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},uo=function(){if(this.ended)throw new be("stream has ended, this shouldn't happen");if(!ye(this,Ua,"f"))throw Error("Final run has not been received");return ye(this,Ua,"f")},iw=function(e){const[n,s]=ye(this,Lt,"m",cw).call(this,e,ye(this,Dn,"f"));cn(this,Dn,n,"f"),ye(this,Su,"f")[n.id]=n;for(const i of s){const o=n.content[i.index];(o==null?void 0:o.type)=="text"&&this._emit("textCreated",o.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,n),e.data.delta.content)for(const i of e.data.delta.content){if(i.type=="text"&&i.text){let o=i.text,u=n.content[i.index];if(u&&u.type=="text")this._emit("textDelta",o,u.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(i.index!=ye(this,Br,"f")){if(ye(this,ka,"f"))switch(ye(this,ka,"f").type){case"text":this._emit("textDone",ye(this,ka,"f").text,ye(this,Dn,"f"));break;case"image_file":this._emit("imageFileDone",ye(this,ka,"f").image_file,ye(this,Dn,"f"));break}cn(this,Br,i.index,"f")}cn(this,ka,n.content[i.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(ye(this,Br,"f")!==void 0){const i=e.data.content[ye(this,Br,"f")];if(i)switch(i.type){case"image_file":this._emit("imageFileDone",i.image_file,ye(this,Dn,"f"));break;case"text":this._emit("textDone",i.text,ye(this,Dn,"f"));break}}ye(this,Dn,"f")&&this._emit("messageDone",e.data),cn(this,Dn,void 0,"f")}},ow=function(e){const n=ye(this,Lt,"m",uw).call(this,e);switch(cn(this,mo,n,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const s=e.data.delta;if(s.step_details&&s.step_details.type=="tool_calls"&&s.step_details.tool_calls&&n.step_details.type=="tool_calls")for(const o of s.step_details.tool_calls)o.index==ye(this,Lu,"f")?this._emit("toolCallDelta",o,n.step_details.tool_calls[o.index]):(ye(this,fn,"f")&&this._emit("toolCallDone",ye(this,fn,"f")),cn(this,Lu,o.index,"f"),cn(this,fn,n.step_details.tool_calls[o.index],"f"),ye(this,fn,"f")&&this._emit("toolCallCreated",ye(this,fn,"f")));this._emit("runStepDelta",e.data.delta,n);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":cn(this,mo,void 0,"f"),e.data.step_details.type=="tool_calls"&&ye(this,fn,"f")&&(this._emit("toolCallDone",ye(this,fn,"f")),cn(this,fn,void 0,"f")),this._emit("runStepDone",e.data,n);break}},lw=function(e){ye(this,Ap,"f").push(e),this._emit("event",e)},uw=function(e){switch(e.event){case"thread.run.step.created":return ye(this,Vn,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let n=ye(this,Vn,"f")[e.data.id];if(!n)throw Error("Received a RunStepDelta before creation of a snapshot");let s=e.data;if(s.delta){const i=kn.accumulateDelta(n,s.delta);ye(this,Vn,"f")[e.data.id]=i}return ye(this,Vn,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":ye(this,Vn,"f")[e.data.id]=e.data;break}if(ye(this,Vn,"f")[e.data.id])return ye(this,Vn,"f")[e.data.id];throw new Error("No snapshot available")},cw=function(e,n){let s=[];switch(e.event){case"thread.message.created":return[e.data,s];case"thread.message.delta":if(!n)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let i=e.data;if(i.delta.content)for(const o of i.delta.content)if(o.index in n.content){let u=n.content[o.index];n.content[o.index]=ye(this,Lt,"m",dw).call(this,o,u)}else n.content[o.index]=o,s.push(o);return[n,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(n)return[n,s];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},dw=function(e,n){return kn.accumulateDelta(n,e)},fw=function(e){switch(cn(this,_u,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":cn(this,Ua,e.data,"f"),ye(this,fn,"f")&&(this._emit("toolCallDone",ye(this,fn,"f")),cn(this,fn,void 0,"f"));break}};class dm extends Te{create(e,n){return this._client.post("/assistants",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,n){return this._client.get(`/assistants/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,n,s){return this._client.post(`/assistants/${e}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e={},n){return ot(e)?this.list({},e):this._client.getAPIList("/assistants",fm,{query:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,n){return this._client.delete(`/assistants/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class fm extends xt{}dm.AssistantsPage=fm;function pw(t){return typeof t.parse=="function"}const Yr=t=>(t==null?void 0:t.role)==="assistant",Qx=t=>(t==null?void 0:t.role)==="function",Wx=t=>(t==null?void 0:t.role)==="tool";function pm(t){return(t==null?void 0:t.$brand)==="auto-parseable-response-format"}function Ro(t){return(t==null?void 0:t.$brand)==="auto-parseable-tool"}function QD(t,e){return!e||!Zx(e)?{...t,choices:t.choices.map(n=>({...n,message:{...n.message,parsed:null,...n.message.tool_calls?{tool_calls:n.message.tool_calls}:void 0}}))}:mm(t,e)}function mm(t,e){const n=t.choices.map(s=>{var i;if(s.finish_reason==="length")throw new Lx;if(s.finish_reason==="content_filter")throw new kx;return{...s,message:{...s.message,...s.message.tool_calls?{tool_calls:((i=s.message.tool_calls)==null?void 0:i.map(o=>ZD(e,o)))??void 0}:void 0,parsed:s.message.content&&!s.message.refusal?WD(e,s.message.content):null}}});return{...t,choices:n}}function WD(t,e){var n,s;return((n=t.response_format)==null?void 0:n.type)!=="json_schema"?null:((s=t.response_format)==null?void 0:s.type)==="json_schema"?"$parseRaw"in t.response_format?t.response_format.$parseRaw(e):JSON.parse(e):null}function ZD(t,e){var s;const n=(s=t.tools)==null?void 0:s.find(i=>{var o;return((o=i.function)==null?void 0:o.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:Ro(n)?n.$parseRaw(e.function.arguments):n!=null&&n.function.strict?JSON.parse(e.function.arguments):null}}}function e2(t,e){var s;if(!t)return!1;const n=(s=t.tools)==null?void 0:s.find(i=>{var o;return((o=i.function)==null?void 0:o.name)===e.function.name});return Ro(n)||(n==null?void 0:n.function.strict)||!1}function Zx(t){var e;return pm(t.response_format)?!0:((e=t.tools)==null?void 0:e.some(n=>Ro(n)||n.type==="function"&&n.function.strict===!0))??!1}function t2(t){for(const e of t??[]){if(e.type!=="function")throw new be(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new be(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var Qt=function(t,e,n,s){if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)},qt,Ep,ku,Np,Ip,Rp,eb,Mp;const mw=10;class tb extends cm{constructor(){super(...arguments),qt.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var s;this._chatCompletions.push(e),this._emit("chatCompletion",e);const n=(s=e.choices[0])==null?void 0:s.message;return n&&this._addMessage(n),e}_addMessage(e,n=!0){if("content"in e||(e.content=null),this.messages.push(e),n){if(this._emit("message",e),(Qx(e)||Wx(e))&&e.content)this._emit("functionCallResult",e.content);else if(Yr(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(Yr(e)&&e.tool_calls)for(const s of e.tool_calls)s.type==="function"&&this._emit("functionCall",s.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new be("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),Qt(this,qt,"m",Ep).call(this)}async finalMessage(){return await this.done(),Qt(this,qt,"m",ku).call(this)}async finalFunctionCall(){return await this.done(),Qt(this,qt,"m",Np).call(this)}async finalFunctionCallResult(){return await this.done(),Qt(this,qt,"m",Ip).call(this)}async totalUsage(){return await this.done(),Qt(this,qt,"m",Rp).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const n=Qt(this,qt,"m",ku).call(this);n&&this._emit("finalMessage",n);const s=Qt(this,qt,"m",Ep).call(this);s&&this._emit("finalContent",s);const i=Qt(this,qt,"m",Np).call(this);i&&this._emit("finalFunctionCall",i);const o=Qt(this,qt,"m",Ip).call(this);o!=null&&this._emit("finalFunctionCallResult",o),this._chatCompletions.some(u=>u.usage)&&this._emit("totalUsage",Qt(this,qt,"m",Rp).call(this))}async _createChatCompletion(e,n,s){const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),Qt(this,qt,"m",eb).call(this,n);const o=await e.chat.completions.create({...n,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion(mm(o,n))}async _runChatCompletion(e,n,s){for(const i of n.messages)this._addMessage(i,!1);return await this._createChatCompletion(e,n,s)}async _runFunctions(e,n,s){var _;const i="function",{function_call:o="auto",stream:u,...d}=n,m=typeof o!="string"&&(o==null?void 0:o.name),{maxChatCompletions:f=mw}=s||{},y={};for(const T of n.functions)y[T.name||T.function.name]=T;const S=n.functions.map(T=>({name:T.name||T.function.name,parameters:T.parameters,description:T.description}));for(const T of n.messages)this._addMessage(T,!1);for(let T=0;T<f;++T){const N=(_=(await this._createChatCompletion(e,{...d,function_call:o,functions:S,messages:[...this.messages]},s)).choices[0])==null?void 0:_.message;if(!N)throw new be("missing message in ChatCompletion response");if(!N.function_call)return;const{name:E,arguments:L}=N.function_call,B=y[E];if(B){if(m&&m!==E){const D=`Invalid function_call: ${JSON.stringify(E)}. ${JSON.stringify(m)} requested. Please try again`;this._addMessage({role:i,name:E,content:D});continue}}else{const D=`Invalid function_call: ${JSON.stringify(E)}. Available options are: ${S.map(R=>JSON.stringify(R.name)).join(", ")}. Please try again`;this._addMessage({role:i,name:E,content:D});continue}let O;try{O=pw(B)?await B.parse(L):L}catch(D){this._addMessage({role:i,name:E,content:D instanceof Error?D.message:String(D)});continue}const x=await B.function(O,this),I=Qt(this,qt,"m",Mp).call(this,x);if(this._addMessage({role:i,name:E,content:I}),m)return}}async _runTools(e,n,s){var T,C,N;const i="tool",{tool_choice:o="auto",stream:u,...d}=n,m=typeof o!="string"&&((T=o==null?void 0:o.function)==null?void 0:T.name),{maxChatCompletions:f=mw}=s||{},y=n.tools.map(E=>{if(Ro(E)){if(!E.$callback)throw new be("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:E.$callback,name:E.function.name,description:E.function.description||"",parameters:E.function.parameters,parse:E.$parseRaw,strict:!0}}}return E}),S={};for(const E of y)E.type==="function"&&(S[E.function.name||E.function.function.name]=E.function);const _="tools"in n?y.map(E=>E.type==="function"?{type:"function",function:{name:E.function.name||E.function.function.name,parameters:E.function.parameters,description:E.function.description,strict:E.function.strict}}:E):void 0;for(const E of n.messages)this._addMessage(E,!1);for(let E=0;E<f;++E){const B=(C=(await this._createChatCompletion(e,{...d,tool_choice:o,tools:_,messages:[...this.messages]},s)).choices[0])==null?void 0:C.message;if(!B)throw new be("missing message in ChatCompletion response");if(!((N=B.tool_calls)!=null&&N.length))return;for(const O of B.tool_calls){if(O.type!=="function")continue;const x=O.id,{name:I,arguments:D}=O.function,R=S[I];if(R){if(m&&m!==I){const F=`Invalid tool_call: ${JSON.stringify(I)}. ${JSON.stringify(m)} requested. Please try again`;this._addMessage({role:i,tool_call_id:x,content:F});continue}}else{const F=`Invalid tool_call: ${JSON.stringify(I)}. Available options are: ${Object.keys(S).map(U=>JSON.stringify(U)).join(", ")}. Please try again`;this._addMessage({role:i,tool_call_id:x,content:F});continue}let P;try{P=pw(R)?await R.parse(D):D}catch(F){const U=F instanceof Error?F.message:String(F);this._addMessage({role:i,tool_call_id:x,content:U});continue}const A=await R.function(P,this),k=Qt(this,qt,"m",Mp).call(this,A);if(this._addMessage({role:i,tool_call_id:x,content:k}),m)return}}}}qt=new WeakSet,Ep=function(){return Qt(this,qt,"m",ku).call(this).content??null},ku=function(){let e=this.messages.length;for(;e-- >0;){const n=this.messages[e];if(Yr(n)){const{function_call:s,...i}=n,o={...i,content:n.content??null,refusal:n.refusal??null};return s&&(o.function_call=s),o}}throw new be("stream ended without producing a ChatCompletionMessage with role=assistant")},Np=function(){var e,n;for(let s=this.messages.length-1;s>=0;s--){const i=this.messages[s];if(Yr(i)&&(i!=null&&i.function_call))return i.function_call;if(Yr(i)&&((e=i==null?void 0:i.tool_calls)!=null&&e.length))return(n=i.tool_calls.at(-1))==null?void 0:n.function}},Ip=function(){for(let e=this.messages.length-1;e>=0;e--){const n=this.messages[e];if(Qx(n)&&n.content!=null||Wx(n)&&n.content!=null&&typeof n.content=="string"&&this.messages.some(s=>{var i;return s.role==="assistant"&&((i=s.tool_calls)==null?void 0:i.some(o=>o.type==="function"&&o.id===n.tool_call_id))}))return n.content}},Rp=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:n}of this._chatCompletions)n&&(e.completion_tokens+=n.completion_tokens,e.prompt_tokens+=n.prompt_tokens,e.total_tokens+=n.total_tokens);return e},eb=function(e){if(e.n!=null&&e.n>1)throw new be("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Mp=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class vo extends tb{static runFunctions(e,n,s){const i=new vo,o={...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"runFunctions"}};return i._run(()=>i._runFunctions(e,n,o)),i}static runTools(e,n,s){const i=new vo,o={...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,n,o)),i}_addMessage(e,n=!0){super._addMessage(e,n),Yr(e)&&e.content&&this._emit("content",e.content)}}const nb=1,sb=2,ab=4,rb=8,ib=16,ob=32,lb=64,ub=128,cb=256,db=ub|cb,fb=ib|ob|db|lb,pb=nb|sb|fb,mb=ab|rb,n2=pb|mb,At={STR:nb,NUM:sb,ARR:ab,OBJ:rb,NULL:ib,BOOL:ob,NAN:lb,INFINITY:ub,MINUS_INFINITY:cb,INF:db,SPECIAL:fb,ATOM:pb,COLLECTION:mb,ALL:n2};class s2 extends Error{}class a2 extends Error{}function r2(t,e=At.ALL){if(typeof t!="string")throw new TypeError(`expecting str, got ${typeof t}`);if(!t.trim())throw new Error(`${t} is empty`);return i2(t.trim(),e)}const i2=(t,e)=>{const n=t.length;let s=0;const i=_=>{throw new s2(`${_} at position ${s}`)},o=_=>{throw new a2(`${_} at position ${s}`)},u=()=>(S(),s>=n&&i("Unexpected end of input"),t[s]==='"'?d():t[s]==="{"?m():t[s]==="["?f():t.substring(s,s+4)==="null"||At.NULL&e&&n-s<4&&"null".startsWith(t.substring(s))?(s+=4,null):t.substring(s,s+4)==="true"||At.BOOL&e&&n-s<4&&"true".startsWith(t.substring(s))?(s+=4,!0):t.substring(s,s+5)==="false"||At.BOOL&e&&n-s<5&&"false".startsWith(t.substring(s))?(s+=5,!1):t.substring(s,s+8)==="Infinity"||At.INFINITY&e&&n-s<8&&"Infinity".startsWith(t.substring(s))?(s+=8,1/0):t.substring(s,s+9)==="-Infinity"||At.MINUS_INFINITY&e&&1<n-s&&n-s<9&&"-Infinity".startsWith(t.substring(s))?(s+=9,-1/0):t.substring(s,s+3)==="NaN"||At.NAN&e&&n-s<3&&"NaN".startsWith(t.substring(s))?(s+=3,NaN):y()),d=()=>{const _=s;let T=!1;for(s++;s<n&&(t[s]!=='"'||T&&t[s-1]==="\\");)T=t[s]==="\\"?!T:!1,s++;if(t.charAt(s)=='"')try{return JSON.parse(t.substring(_,++s-Number(T)))}catch(C){o(String(C))}else if(At.STR&e)try{return JSON.parse(t.substring(_,s-Number(T))+'"')}catch{return JSON.parse(t.substring(_,t.lastIndexOf("\\"))+'"')}i("Unterminated string literal")},m=()=>{s++,S();const _={};try{for(;t[s]!=="}";){if(S(),s>=n&&At.OBJ&e)return _;const T=d();S(),s++;try{const C=u();Object.defineProperty(_,T,{value:C,writable:!0,enumerable:!0,configurable:!0})}catch(C){if(At.OBJ&e)return _;throw C}S(),t[s]===","&&s++}}catch{if(At.OBJ&e)return _;i("Expected '}' at end of object")}return s++,_},f=()=>{s++;const _=[];try{for(;t[s]!=="]";)_.push(u()),S(),t[s]===","&&s++}catch{if(At.ARR&e)return _;i("Expected ']' at end of array")}return s++,_},y=()=>{if(s===0){t==="-"&&At.NUM&e&&i("Not sure what '-' is");try{return JSON.parse(t)}catch(T){if(At.NUM&e)try{return t[t.length-1]==="."?JSON.parse(t.substring(0,t.lastIndexOf("."))):JSON.parse(t.substring(0,t.lastIndexOf("e")))}catch{}o(String(T))}}const _=s;for(t[s]==="-"&&s++;t[s]&&!",]}".includes(t[s]);)s++;s==n&&!(At.NUM&e)&&i("Unterminated number literal");try{return JSON.parse(t.substring(_,s))}catch{t.substring(_,s)==="-"&&At.NUM&e&&i("Not sure what '-' is");try{return JSON.parse(t.substring(_,t.lastIndexOf("e")))}catch(C){o(String(C))}}},S=()=>{for(;s<n&&` 
\r	`.includes(t[s]);)s++};return u()},hw=t=>r2(t,At.ALL^At.NUM);var Mr=function(t,e,n,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(t,n):i?i.value=n:e.set(t,n),n},Ze=function(t,e,n,s){if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)},wt,gs,Pr,ea,Hf,iu,Gf,Vf,zf,ou,jf,gw;class So extends tb{constructor(e){super(),wt.add(this),gs.set(this,void 0),Pr.set(this,void 0),ea.set(this,void 0),Mr(this,gs,e,"f"),Mr(this,Pr,[],"f")}get currentChatCompletionSnapshot(){return Ze(this,ea,"f")}static fromReadableStream(e){const n=new So(null);return n._run(()=>n._fromReadableStream(e)),n}static createChatCompletion(e,n,s){const i=new So(n);return i._run(()=>i._runChatCompletion(e,{...n,stream:!0},{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createChatCompletion(e,n,s){var u;super._createChatCompletion;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),Ze(this,wt,"m",Hf).call(this);const o=await e.chat.completions.create({...n,stream:!0},{...s,signal:this.controller.signal});this._connected();for await(const d of o)Ze(this,wt,"m",Gf).call(this,d);if((u=o.controller.signal)!=null&&u.aborted)throw new Cn;return this._addChatCompletion(Ze(this,wt,"m",ou).call(this))}async _fromReadableStream(e,n){var u;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Ze(this,wt,"m",Hf).call(this),this._connected();const i=zn.fromReadableStream(e,this.controller);let o;for await(const d of i)o&&o!==d.id&&this._addChatCompletion(Ze(this,wt,"m",ou).call(this)),Ze(this,wt,"m",Gf).call(this,d),o=d.id;if((u=i.controller.signal)!=null&&u.aborted)throw new Cn;return this._addChatCompletion(Ze(this,wt,"m",ou).call(this))}[(gs=new WeakMap,Pr=new WeakMap,ea=new WeakMap,wt=new WeakSet,Hf=function(){this.ended||Mr(this,ea,void 0,"f")},iu=function(n){let s=Ze(this,Pr,"f")[n.index];return s||(s={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},Ze(this,Pr,"f")[n.index]=s,s)},Gf=function(n){var i,o,u,d,m,f,y,S,_,T,C,N,E,L,B;if(this.ended)return;const s=Ze(this,wt,"m",gw).call(this,n);this._emit("chunk",n,s);for(const O of n.choices){const x=s.choices[O.index];O.delta.content!=null&&((i=x.message)==null?void 0:i.role)==="assistant"&&((o=x.message)!=null&&o.content)&&(this._emit("content",O.delta.content,x.message.content),this._emit("content.delta",{delta:O.delta.content,snapshot:x.message.content,parsed:x.message.parsed})),O.delta.refusal!=null&&((u=x.message)==null?void 0:u.role)==="assistant"&&((d=x.message)!=null&&d.refusal)&&this._emit("refusal.delta",{delta:O.delta.refusal,snapshot:x.message.refusal}),((m=O.logprobs)==null?void 0:m.content)!=null&&((f=x.message)==null?void 0:f.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(y=O.logprobs)==null?void 0:y.content,snapshot:((S=x.logprobs)==null?void 0:S.content)??[]}),((_=O.logprobs)==null?void 0:_.refusal)!=null&&((T=x.message)==null?void 0:T.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(C=O.logprobs)==null?void 0:C.refusal,snapshot:((N=x.logprobs)==null?void 0:N.refusal)??[]});const I=Ze(this,wt,"m",iu).call(this,x);x.finish_reason&&(Ze(this,wt,"m",zf).call(this,x),I.current_tool_call_index!=null&&Ze(this,wt,"m",Vf).call(this,x,I.current_tool_call_index));for(const D of O.delta.tool_calls??[])I.current_tool_call_index!==D.index&&(Ze(this,wt,"m",zf).call(this,x),I.current_tool_call_index!=null&&Ze(this,wt,"m",Vf).call(this,x,I.current_tool_call_index)),I.current_tool_call_index=D.index;for(const D of O.delta.tool_calls??[]){const R=(E=x.message.tool_calls)==null?void 0:E[D.index];R!=null&&R.type&&((R==null?void 0:R.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(L=R.function)==null?void 0:L.name,index:D.index,arguments:R.function.arguments,parsed_arguments:R.function.parsed_arguments,arguments_delta:((B=D.function)==null?void 0:B.arguments)??""}):(R==null||R.type,void 0))}}},Vf=function(n,s){var u,d,m;if(Ze(this,wt,"m",iu).call(this,n).done_tool_calls.has(s))return;const o=(u=n.message.tool_calls)==null?void 0:u[s];if(!o)throw new Error("no tool call snapshot");if(!o.type)throw new Error("tool call snapshot missing `type`");if(o.type==="function"){const f=(m=(d=Ze(this,gs,"f"))==null?void 0:d.tools)==null?void 0:m.find(y=>y.type==="function"&&y.function.name===o.function.name);this._emit("tool_calls.function.arguments.done",{name:o.function.name,index:s,arguments:o.function.arguments,parsed_arguments:Ro(f)?f.$parseRaw(o.function.arguments):f!=null&&f.function.strict?JSON.parse(o.function.arguments):null})}else o.type},zf=function(n){var i,o;const s=Ze(this,wt,"m",iu).call(this,n);if(n.message.content&&!s.content_done){s.content_done=!0;const u=Ze(this,wt,"m",jf).call(this);this._emit("content.done",{content:n.message.content,parsed:u?u.$parseRaw(n.message.content):null})}n.message.refusal&&!s.refusal_done&&(s.refusal_done=!0,this._emit("refusal.done",{refusal:n.message.refusal})),(i=n.logprobs)!=null&&i.content&&!s.logprobs_content_done&&(s.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:n.logprobs.content})),(o=n.logprobs)!=null&&o.refusal&&!s.logprobs_refusal_done&&(s.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:n.logprobs.refusal}))},ou=function(){if(this.ended)throw new be("stream has ended, this shouldn't happen");const n=Ze(this,ea,"f");if(!n)throw new be("request ended without sending any chunks");return Mr(this,ea,void 0,"f"),Mr(this,Pr,[],"f"),o2(n,Ze(this,gs,"f"))},jf=function(){var s;const n=(s=Ze(this,gs,"f"))==null?void 0:s.response_format;return pm(n)?n:null},gw=function(n){var s,i,o,u;let d=Ze(this,ea,"f");const{choices:m,...f}=n;d?Object.assign(d,f):d=Mr(this,ea,{...f,choices:[]},"f");for(const{delta:y,finish_reason:S,index:_,logprobs:T=null,...C}of n.choices){let N=d.choices[_];if(N||(N=d.choices[_]={finish_reason:S,index:_,message:{},logprobs:T,...C}),T)if(!N.logprobs)N.logprobs=Object.assign({},T);else{const{content:D,refusal:R,...P}=T;Object.assign(N.logprobs,P),D&&((s=N.logprobs).content??(s.content=[]),N.logprobs.content.push(...D)),R&&((i=N.logprobs).refusal??(i.refusal=[]),N.logprobs.refusal.push(...R))}if(S&&(N.finish_reason=S,Ze(this,gs,"f")&&Zx(Ze(this,gs,"f")))){if(S==="length")throw new Lx;if(S==="content_filter")throw new kx}if(Object.assign(N,C),!y)continue;const{content:E,refusal:L,function_call:B,role:O,tool_calls:x,...I}=y;if(Object.assign(N.message,I),L&&(N.message.refusal=(N.message.refusal||"")+L),O&&(N.message.role=O),B&&(N.message.function_call?(B.name&&(N.message.function_call.name=B.name),B.arguments&&((o=N.message.function_call).arguments??(o.arguments=""),N.message.function_call.arguments+=B.arguments)):N.message.function_call=B),E&&(N.message.content=(N.message.content||"")+E,!N.message.refusal&&Ze(this,wt,"m",jf).call(this)&&(N.message.parsed=hw(N.message.content))),x){N.message.tool_calls||(N.message.tool_calls=[]);for(const{index:D,id:R,type:P,function:A,...k}of x){const F=(u=N.message.tool_calls)[D]??(u[D]={});Object.assign(F,k),R&&(F.id=R),P&&(F.type=P),A&&(F.function??(F.function={name:A.name??"",arguments:""})),A!=null&&A.name&&(F.function.name=A.name),A!=null&&A.arguments&&(F.function.arguments+=A.arguments,e2(Ze(this,gs,"f"),F)&&(F.function.parsed_arguments=hw(F.function.arguments)))}}}return d},Symbol.asyncIterator)](){const e=[],n=[];let s=!1;return this.on("chunk",i=>{const o=n.shift();o?o.resolve(i):e.push(i)}),this.on("end",()=>{s=!0;for(const i of n)i.resolve(void 0);n.length=0}),this.on("abort",i=>{s=!0;for(const o of n)o.reject(i);n.length=0}),this.on("error",i=>{s=!0;for(const o of n)o.reject(i);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((o,u)=>n.push({resolve:o,reject:u})).then(o=>o?{value:o,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new zn(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function o2(t,e){const{id:n,choices:s,created:i,model:o,system_fingerprint:u,...d}=t,m={...d,id:n,choices:s.map(({message:f,finish_reason:y,index:S,logprobs:_,...T})=>{if(!y)throw new be(`missing finish_reason for choice ${S}`);const{content:C=null,function_call:N,tool_calls:E,...L}=f,B=f.role;if(!B)throw new be(`missing role for choice ${S}`);if(N){const{arguments:O,name:x}=N;if(O==null)throw new be(`missing function_call.arguments for choice ${S}`);if(!x)throw new be(`missing function_call.name for choice ${S}`);return{...T,message:{content:C,function_call:{arguments:O,name:x},role:B,refusal:f.refusal??null},finish_reason:y,index:S,logprobs:_}}return E?{...T,index:S,finish_reason:y,logprobs:_,message:{...L,role:B,content:C,refusal:f.refusal??null,tool_calls:E.map((O,x)=>{const{function:I,type:D,id:R,...P}=O,{arguments:A,name:k,...F}=I||{};if(R==null)throw new be(`missing choices[${S}].tool_calls[${x}].id
${lu(t)}`);if(D==null)throw new be(`missing choices[${S}].tool_calls[${x}].type
${lu(t)}`);if(k==null)throw new be(`missing choices[${S}].tool_calls[${x}].function.name
${lu(t)}`);if(A==null)throw new be(`missing choices[${S}].tool_calls[${x}].function.arguments
${lu(t)}`);return{...P,id:R,type:D,function:{...F,name:k,arguments:A}}})}}:{...T,message:{...L,content:C,role:B,refusal:f.refusal??null},finish_reason:y,index:S,logprobs:_}}),created:i,model:o,object:"chat.completion",...u?{system_fingerprint:u}:{}};return QD(m,e)}function lu(t){return JSON.stringify(t)}class Jr extends So{static fromReadableStream(e){const n=new Jr(null);return n._run(()=>n._fromReadableStream(e)),n}static runFunctions(e,n,s){const i=new Jr(null),o={...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"runFunctions"}};return i._run(()=>i._runFunctions(e,n,o)),i}static runTools(e,n,s){const i=new Jr(n),o={...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,n,o)),i}}let hb=class extends Te{parse(e,n){return t2(e.tools),this._client.chat.completions.create(e,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(s=>mm(s,e))}runFunctions(e,n){return e.stream?Jr.runFunctions(this._client,e,n):vo.runFunctions(this._client,e,n)}runTools(e,n){return e.stream?Jr.runTools(this._client,e,n):vo.runTools(this._client,e,n)}stream(e,n){return So.createChatCompletion(this._client,e,n)}};class Pp extends Te{constructor(){super(...arguments),this.completions=new hb(this._client)}}(function(t){t.Completions=hb})(Pp||(Pp={}));class gb extends Te{create(e,n){return this._client.post("/realtime/sessions",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class yb extends Te{create(e,n){return this._client.post("/realtime/transcription_sessions",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class ec extends Te{constructor(){super(...arguments),this.sessions=new gb(this._client),this.transcriptionSessions=new yb(this._client)}}ec.Sessions=gb;ec.TranscriptionSessions=yb;class hm extends Te{create(e,n,s){return this._client.post(`/threads/${e}/messages`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}retrieve(e,n,s){return this._client.get(`/threads/${e}/messages/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}update(e,n,s,i){return this._client.post(`/threads/${e}/messages/${n}`,{body:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,n={},s){return ot(n)?this.list(e,{},n):this._client.getAPIList(`/threads/${e}/messages`,gm,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}del(e,n,s){return this._client.delete(`/threads/${e}/messages/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class gm extends xt{}hm.MessagesPage=gm;class ym extends Te{retrieve(e,n,s,i={},o){return ot(i)?this.retrieve(e,n,s,{},i):this._client.get(`/threads/${e}/runs/${n}/steps/${s}`,{query:i,...o,headers:{"OpenAI-Beta":"assistants=v2",...o==null?void 0:o.headers}})}list(e,n,s={},i){return ot(s)?this.list(e,n,{},s):this._client.getAPIList(`/threads/${e}/runs/${n}/steps`,vm,{query:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}}class vm extends xt{}ym.RunStepsPage=vm;let Mo=class extends Te{constructor(){super(...arguments),this.steps=new ym(this._client)}create(e,n,s){const{include:i,...o}=n;return this._client.post(`/threads/${e}/runs`,{query:{include:i},body:o,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:n.stream??!1})}retrieve(e,n,s){return this._client.get(`/threads/${e}/runs/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}update(e,n,s,i){return this._client.post(`/threads/${e}/runs/${n}`,{body:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,n={},s){return ot(n)?this.list(e,{},n):this._client.getAPIList(`/threads/${e}/runs`,Sm,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}cancel(e,n,s){return this._client.post(`/threads/${e}/runs/${n}/cancel`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async createAndPoll(e,n,s){const i=await this.create(e,n,s);return await this.poll(e,i.id,s)}createAndStream(e,n,s){return kn.createAssistantStream(e,this._client.beta.threads.runs,n,s)}async poll(e,n,s){const i={...s==null?void 0:s.headers,"X-Stainless-Poll-Helper":"true"};for(s!=null&&s.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){const{data:o,response:u}=await this.retrieve(e,n,{...s,headers:{...s==null?void 0:s.headers,...i}}).withResponse();switch(o.status){case"queued":case"in_progress":case"cancelling":let d=5e3;if(s!=null&&s.pollIntervalMs)d=s.pollIntervalMs;else{const m=u.headers.get("openai-poll-after-ms");if(m){const f=parseInt(m);isNaN(f)||(d=f)}}await No(d);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return o}}}stream(e,n,s){return kn.createAssistantStream(e,this._client.beta.threads.runs,n,s)}submitToolOutputs(e,n,s,i){return this._client.post(`/threads/${e}/runs/${n}/submit_tool_outputs`,{body:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers},stream:s.stream??!1})}async submitToolOutputsAndPoll(e,n,s,i){const o=await this.submitToolOutputs(e,n,s,i);return await this.poll(e,o.id,i)}submitToolOutputsStream(e,n,s,i){return kn.createToolAssistantStream(e,n,this._client.beta.threads.runs,s,i)}};class Sm extends xt{}Mo.RunsPage=Sm;Mo.Steps=ym;Mo.RunStepsPage=vm;class ti extends Te{constructor(){super(...arguments),this.runs=new Mo(this._client),this.messages=new hm(this._client)}create(e={},n){return ot(e)?this.create({},e):this._client.post("/threads",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,n){return this._client.get(`/threads/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,n,s){return this._client.post(`/threads/${e}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}del(e,n){return this._client.delete(`/threads/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}createAndRun(e,n){return this._client.post("/threads/runs",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:e.stream??!1})}async createAndRunPoll(e,n){const s=await this.createAndRun(e,n);return await this.runs.poll(s.thread_id,s.id,n)}createAndRunStream(e,n){return kn.createThreadAssistantStream(e,this._client.beta.threads,n)}}ti.Runs=Mo;ti.RunsPage=Sm;ti.Messages=hm;ti.MessagesPage=gm;class ni extends Te{constructor(){super(...arguments),this.realtime=new ec(this._client),this.chat=new Pp(this._client),this.assistants=new dm(this._client),this.threads=new ti(this._client)}}ni.Realtime=ec;ni.Assistants=dm;ni.AssistantsPage=fm;ni.Threads=ti;class vb extends Te{create(e,n){return this._client.post("/completions",{body:e,...n,stream:e.stream??!1})}}class Sb extends Te{retrieve(e,n,s){return this._client.get(`/containers/${e}/files/${n}/content`,{...s,headers:{Accept:"application/binary",...s==null?void 0:s.headers},__binaryResponse:!0})}}let tc=class extends Te{constructor(){super(...arguments),this.content=new Sb(this._client)}create(e,n,s){return this._client.post(`/containers/${e}/files`,Fa({body:n,...s}))}retrieve(e,n,s){return this._client.get(`/containers/${e}/files/${n}`,s)}list(e,n={},s){return ot(n)?this.list(e,{},n):this._client.getAPIList(`/containers/${e}/files`,wm,{query:n,...s})}del(e,n,s){return this._client.delete(`/containers/${e}/files/${n}`,{...s,headers:{Accept:"*/*",...s==null?void 0:s.headers}})}};class wm extends xt{}tc.FileListResponsesPage=wm;tc.Content=Sb;class Po extends Te{constructor(){super(...arguments),this.files=new tc(this._client)}create(e,n){return this._client.post("/containers",{body:e,...n})}retrieve(e,n){return this._client.get(`/containers/${e}`,n)}list(e={},n){return ot(e)?this.list({},e):this._client.getAPIList("/containers",_m,{query:e,...n})}del(e,n){return this._client.delete(`/containers/${e}`,{...n,headers:{Accept:"*/*",...n==null?void 0:n.headers}})}}class _m extends xt{}Po.ContainerListResponsesPage=_m;Po.Files=tc;Po.FileListResponsesPage=wm;class wb extends Te{create(e,n){const s=!!e.encoding_format;let i=s?e.encoding_format:"base64";s&&aa("Request","User defined encoding_format:",e.encoding_format);const o=this._client.post("/embeddings",{body:{...e,encoding_format:i},...n});return s?o:(aa("response","Decoding base64 embeddings to float32 array"),o._thenUnwrap(u=>(u&&u.data&&u.data.forEach(d=>{const m=d.embedding;d.embedding=KD(m)}),u)))}}class xm extends Te{retrieve(e,n,s,i){return this._client.get(`/evals/${e}/runs/${n}/output_items/${s}`,i)}list(e,n,s={},i){return ot(s)?this.list(e,n,{},s):this._client.getAPIList(`/evals/${e}/runs/${n}/output_items`,bm,{query:s,...i})}}class bm extends xt{}xm.OutputItemListResponsesPage=bm;class Do extends Te{constructor(){super(...arguments),this.outputItems=new xm(this._client)}create(e,n,s){return this._client.post(`/evals/${e}/runs`,{body:n,...s})}retrieve(e,n,s){return this._client.get(`/evals/${e}/runs/${n}`,s)}list(e,n={},s){return ot(n)?this.list(e,{},n):this._client.getAPIList(`/evals/${e}/runs`,Tm,{query:n,...s})}del(e,n,s){return this._client.delete(`/evals/${e}/runs/${n}`,s)}cancel(e,n,s){return this._client.post(`/evals/${e}/runs/${n}`,s)}}class Tm extends xt{}Do.RunListResponsesPage=Tm;Do.OutputItems=xm;Do.OutputItemListResponsesPage=bm;class Lo extends Te{constructor(){super(...arguments),this.runs=new Do(this._client)}create(e,n){return this._client.post("/evals",{body:e,...n})}retrieve(e,n){return this._client.get(`/evals/${e}`,n)}update(e,n,s){return this._client.post(`/evals/${e}`,{body:n,...s})}list(e={},n){return ot(e)?this.list({},e):this._client.getAPIList("/evals",Cm,{query:e,...n})}del(e,n){return this._client.delete(`/evals/${e}`,n)}}class Cm extends xt{}Lo.EvalListResponsesPage=Cm;Lo.Runs=Do;Lo.RunListResponsesPage=Tm;let Am=class extends Te{create(e,n){return this._client.post("/files",Fa({body:e,...n}))}retrieve(e,n){return this._client.get(`/files/${e}`,n)}list(e={},n){return ot(e)?this.list({},e):this._client.getAPIList("/files",Em,{query:e,...n})}del(e,n){return this._client.delete(`/files/${e}`,n)}content(e,n){return this._client.get(`/files/${e}/content`,{...n,headers:{Accept:"application/binary",...n==null?void 0:n.headers},__binaryResponse:!0})}retrieveContent(e,n){return this._client.get(`/files/${e}/content`,n)}async waitForProcessing(e,{pollInterval:n=5e3,maxWait:s=1800*1e3}={}){const i=new Set(["processed","error","deleted"]),o=Date.now();let u=await this.retrieve(e);for(;!u.status||!i.has(u.status);)if(await No(n),u=await this.retrieve(e),Date.now()-o>s)throw new om({message:`Giving up on waiting for file ${e} to finish processing after ${s} milliseconds.`});return u}};class Em extends xt{}Am.FileObjectsPage=Em;class _b extends Te{}let xb=class extends Te{run(e,n){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...n})}validate(e,n){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...n})}};class Nm extends Te{constructor(){super(...arguments),this.graders=new xb(this._client)}}Nm.Graders=xb;class Im extends Te{create(e,n,s){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,Rm,{body:n,method:"post",...s})}retrieve(e,n={},s){return ot(n)?this.retrieve(e,{},n):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:n,...s})}del(e,n,s){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions/${n}`,s)}}class Rm extends Xu{}Im.PermissionCreateResponsesPage=Rm;let nc=class extends Te{constructor(){super(...arguments),this.permissions=new Im(this._client)}};nc.Permissions=Im;nc.PermissionCreateResponsesPage=Rm;class Mm extends Te{list(e,n={},s){return ot(n)?this.list(e,{},n):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Pm,{query:n,...s})}}class Pm extends xt{}Mm.FineTuningJobCheckpointsPage=Pm;class si extends Te{constructor(){super(...arguments),this.checkpoints=new Mm(this._client)}create(e,n){return this._client.post("/fine_tuning/jobs",{body:e,...n})}retrieve(e,n){return this._client.get(`/fine_tuning/jobs/${e}`,n)}list(e={},n){return ot(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Dm,{query:e,...n})}cancel(e,n){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,n)}listEvents(e,n={},s){return ot(n)?this.listEvents(e,{},n):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Lm,{query:n,...s})}pause(e,n){return this._client.post(`/fine_tuning/jobs/${e}/pause`,n)}resume(e,n){return this._client.post(`/fine_tuning/jobs/${e}/resume`,n)}}class Dm extends xt{}class Lm extends xt{}si.FineTuningJobsPage=Dm;si.FineTuningJobEventsPage=Lm;si.Checkpoints=Mm;si.FineTuningJobCheckpointsPage=Pm;class la extends Te{constructor(){super(...arguments),this.methods=new _b(this._client),this.jobs=new si(this._client),this.checkpoints=new nc(this._client),this.alpha=new Nm(this._client)}}la.Methods=_b;la.Jobs=si;la.FineTuningJobsPage=Dm;la.FineTuningJobEventsPage=Lm;la.Checkpoints=nc;la.Alpha=Nm;class bb extends Te{}class km extends Te{constructor(){super(...arguments),this.graderModels=new bb(this._client)}}km.GraderModels=bb;class Tb extends Te{createVariation(e,n){return this._client.post("/images/variations",Fa({body:e,...n}))}edit(e,n){return this._client.post("/images/edits",Fa({body:e,...n}))}generate(e,n){return this._client.post("/images/generations",{body:e,...n})}}class Um extends Te{retrieve(e,n){return this._client.get(`/models/${e}`,n)}list(e){return this._client.getAPIList("/models",Om,e)}del(e,n){return this._client.delete(`/models/${e}`,n)}}class Om extends Xu{}Um.ModelsPage=Om;class Cb extends Te{create(e,n){return this._client.post("/moderations",{body:e,...n})}}function l2(t,e){return!e||!c2(e)?{...t,output_parsed:null,output:t.output.map(n=>n.type==="function_call"?{...n,parsed_arguments:null}:n.type==="message"?{...n,content:n.content.map(s=>({...s,parsed:null}))}:n)}:Ab(t,e)}function Ab(t,e){const n=t.output.map(i=>{if(i.type==="function_call")return{...i,parsed_arguments:p2(e,i)};if(i.type==="message"){const o=i.content.map(u=>u.type==="output_text"?{...u,parsed:u2(e,u.text)}:u);return{...i,content:o}}return i}),s=Object.assign({},t,{output:n});return Object.getOwnPropertyDescriptor(t,"output_text")||Eb(s),Object.defineProperty(s,"output_parsed",{enumerable:!0,get(){for(const i of s.output)if(i.type==="message"){for(const o of i.content)if(o.type==="output_text"&&o.parsed!==null)return o.parsed}return null}}),s}function u2(t,e){var n,s,i,o;return((s=(n=t.text)==null?void 0:n.format)==null?void 0:s.type)!=="json_schema"?null:"$parseRaw"in((i=t.text)==null?void 0:i.format)?((o=t.text)==null?void 0:o.format).$parseRaw(e):JSON.parse(e)}function c2(t){var e;return!!pm((e=t.text)==null?void 0:e.format)}function d2(t){return(t==null?void 0:t.$brand)==="auto-parseable-tool"}function f2(t,e){return t.find(n=>n.type==="function"&&n.name===e)}function p2(t,e){const n=f2(t.tools??[],e.name);return{...e,...e,parsed_arguments:d2(n)?n.$parseRaw(e.arguments):n!=null&&n.strict?JSON.parse(e.arguments):null}}function Eb(t){const e=[];for(const n of t.output)if(n.type==="message")for(const s of n.content)s.type==="output_text"&&e.push(s.text);t.output_text=e.join("")}class Nb extends Te{list(e,n={},s){return ot(n)?this.list(e,{},n):this._client.getAPIList(`/responses/${e}/input_items`,h2,{query:n,...s})}}var Dr=function(t,e,n,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(t,n):i?i.value=n:e.set(t,n),n},ta=function(t,e,n,s){if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)},Lr,uu,na,cu,yw,vw,Sw,ww;class qm extends cm{constructor(e){super(),Lr.add(this),uu.set(this,void 0),na.set(this,void 0),cu.set(this,void 0),Dr(this,uu,e,"f")}static createResponse(e,n,s){const i=new qm(n);return i._run(()=>i._createOrRetrieveResponse(e,n,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createOrRetrieveResponse(e,n,s){var d;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),ta(this,Lr,"m",yw).call(this);let o,u=null;"response_id"in n?(o=await e.responses.retrieve(n.response_id,{stream:!0},{...s,signal:this.controller.signal,stream:!0}),u=n.starting_after??null):o=await e.responses.create({...n,stream:!0},{...s,signal:this.controller.signal}),this._connected();for await(const m of o)ta(this,Lr,"m",vw).call(this,m,u);if((d=o.controller.signal)!=null&&d.aborted)throw new Cn;return ta(this,Lr,"m",Sw).call(this)}[(uu=new WeakMap,na=new WeakMap,cu=new WeakMap,Lr=new WeakSet,yw=function(){this.ended||Dr(this,na,void 0,"f")},vw=function(n,s){if(this.ended)return;const i=(u,d)=>{(s==null||d.sequence_number>s)&&this._emit(u,d)},o=ta(this,Lr,"m",ww).call(this,n);switch(i("event",n),n.type){case"response.output_text.delta":{const u=o.output[n.output_index];if(!u)throw new be(`missing output at index ${n.output_index}`);if(u.type==="message"){const d=u.content[n.content_index];if(!d)throw new be(`missing content at index ${n.content_index}`);if(d.type!=="output_text")throw new be(`expected content to be 'output_text', got ${d.type}`);i("response.output_text.delta",{...n,snapshot:d.text})}break}case"response.function_call_arguments.delta":{const u=o.output[n.output_index];if(!u)throw new be(`missing output at index ${n.output_index}`);u.type==="function_call"&&i("response.function_call_arguments.delta",{...n,snapshot:u.arguments});break}default:i(n.type,n);break}},Sw=function(){if(this.ended)throw new be("stream has ended, this shouldn't happen");const n=ta(this,na,"f");if(!n)throw new be("request ended without sending any events");Dr(this,na,void 0,"f");const s=m2(n,ta(this,uu,"f"));return Dr(this,cu,s,"f"),s},ww=function(n){let s=ta(this,na,"f");if(!s){if(n.type!=="response.created")throw new be(`When snapshot hasn't been set yet, expected 'response.created' event, got ${n.type}`);return s=Dr(this,na,n.response,"f"),s}switch(n.type){case"response.output_item.added":{s.output.push(n.item);break}case"response.content_part.added":{const i=s.output[n.output_index];if(!i)throw new be(`missing output at index ${n.output_index}`);i.type==="message"&&i.content.push(n.part);break}case"response.output_text.delta":{const i=s.output[n.output_index];if(!i)throw new be(`missing output at index ${n.output_index}`);if(i.type==="message"){const o=i.content[n.content_index];if(!o)throw new be(`missing content at index ${n.content_index}`);if(o.type!=="output_text")throw new be(`expected content to be 'output_text', got ${o.type}`);o.text+=n.delta}break}case"response.function_call_arguments.delta":{const i=s.output[n.output_index];if(!i)throw new be(`missing output at index ${n.output_index}`);i.type==="function_call"&&(i.arguments+=n.delta);break}case"response.completed":{Dr(this,na,n.response,"f");break}}return s},Symbol.asyncIterator)](){const e=[],n=[];let s=!1;return this.on("event",i=>{const o=n.shift();o?o.resolve(i):e.push(i)}),this.on("end",()=>{s=!0;for(const i of n)i.resolve(void 0);n.length=0}),this.on("abort",i=>{s=!0;for(const o of n)o.reject(i);n.length=0}),this.on("error",i=>{s=!0;for(const o of n)o.reject(i);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((o,u)=>n.push({resolve:o,reject:u})).then(o=>o?{value:o,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=ta(this,cu,"f");if(!e)throw new be("stream ended without producing a ChatCompletion");return e}}function m2(t,e){return l2(t,e)}class Bm extends Te{constructor(){super(...arguments),this.inputItems=new Nb(this._client)}create(e,n){return this._client.post("/responses",{body:e,...n,stream:e.stream??!1})._thenUnwrap(s=>("object"in s&&s.object==="response"&&Eb(s),s))}retrieve(e,n={},s){return this._client.get(`/responses/${e}`,{query:n,...s,stream:(n==null?void 0:n.stream)??!1})}del(e,n){return this._client.delete(`/responses/${e}`,{...n,headers:{Accept:"*/*",...n==null?void 0:n.headers}})}parse(e,n){return this._client.responses.create(e,n)._thenUnwrap(s=>Ab(s,e))}stream(e,n){return qm.createResponse(this._client,e,n)}cancel(e,n){return this._client.post(`/responses/${e}/cancel`,{...n,headers:{Accept:"*/*",...n==null?void 0:n.headers}})}}class h2 extends xt{}Bm.InputItems=Nb;class Ib extends Te{create(e,n,s){return this._client.post(`/uploads/${e}/parts`,Fa({body:n,...s}))}}class Fm extends Te{constructor(){super(...arguments),this.parts=new Ib(this._client)}create(e,n){return this._client.post("/uploads",{body:e,...n})}cancel(e,n){return this._client.post(`/uploads/${e}/cancel`,n)}complete(e,n,s){return this._client.post(`/uploads/${e}/complete`,{body:n,...s})}}Fm.Parts=Ib;const g2=async t=>{const e=await Promise.allSettled(t),n=e.filter(i=>i.status==="rejected");if(n.length){for(const i of n)console.error(i.reason);throw new Error(`${n.length} promise(s) failed - see the above errors`)}const s=[];for(const i of e)i.status==="fulfilled"&&s.push(i.value);return s};class sc extends Te{create(e,n,s){return this._client.post(`/vector_stores/${e}/files`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}retrieve(e,n,s){return this._client.get(`/vector_stores/${e}/files/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}update(e,n,s,i){return this._client.post(`/vector_stores/${e}/files/${n}`,{body:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,n={},s){return ot(n)?this.list(e,{},n):this._client.getAPIList(`/vector_stores/${e}/files`,ac,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}del(e,n,s){return this._client.delete(`/vector_stores/${e}/files/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async createAndPoll(e,n,s){const i=await this.create(e,n,s);return await this.poll(e,i.id,s)}async poll(e,n,s){const i={...s==null?void 0:s.headers,"X-Stainless-Poll-Helper":"true"};for(s!=null&&s.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){const o=await this.retrieve(e,n,{...s,headers:i}).withResponse(),u=o.data;switch(u.status){case"in_progress":let d=5e3;if(s!=null&&s.pollIntervalMs)d=s.pollIntervalMs;else{const m=o.response.headers.get("openai-poll-after-ms");if(m){const f=parseInt(m);isNaN(f)||(d=f)}}await No(d);break;case"failed":case"completed":return u}}}async upload(e,n,s){const i=await this._client.files.create({file:n,purpose:"assistants"},s);return this.create(e,{file_id:i.id},s)}async uploadAndPoll(e,n,s){const i=await this.upload(e,n,s);return await this.poll(e,i.id,s)}content(e,n,s){return this._client.getAPIList(`/vector_stores/${e}/files/${n}/content`,$m,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class ac extends xt{}class $m extends Xu{}sc.VectorStoreFilesPage=ac;sc.FileContentResponsesPage=$m;class Rb extends Te{create(e,n,s){return this._client.post(`/vector_stores/${e}/file_batches`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}retrieve(e,n,s){return this._client.get(`/vector_stores/${e}/file_batches/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}cancel(e,n,s){return this._client.post(`/vector_stores/${e}/file_batches/${n}/cancel`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async createAndPoll(e,n,s){const i=await this.create(e,n);return await this.poll(e,i.id,s)}listFiles(e,n,s={},i){return ot(s)?this.listFiles(e,n,{},s):this._client.getAPIList(`/vector_stores/${e}/file_batches/${n}/files`,ac,{query:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}async poll(e,n,s){const i={...s==null?void 0:s.headers,"X-Stainless-Poll-Helper":"true"};for(s!=null&&s.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){const{data:o,response:u}=await this.retrieve(e,n,{...s,headers:i}).withResponse();switch(o.status){case"in_progress":let d=5e3;if(s!=null&&s.pollIntervalMs)d=s.pollIntervalMs;else{const m=u.headers.get("openai-poll-after-ms");if(m){const f=parseInt(m);isNaN(f)||(d=f)}}await No(d);break;case"failed":case"cancelled":case"completed":return o}}}async uploadAndPoll(e,{files:n,fileIds:s=[]},i){if(n==null||n.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const o=(i==null?void 0:i.maxConcurrency)??5,u=Math.min(o,n.length),d=this._client,m=n.values(),f=[...s];async function y(_){for(let T of _){const C=await d.files.create({file:T,purpose:"assistants"},i);f.push(C.id)}}const S=Array(u).fill(m).map(y);return await g2(S),await this.createAndPoll(e,{file_ids:f})}}class ua extends Te{constructor(){super(...arguments),this.files=new sc(this._client),this.fileBatches=new Rb(this._client)}create(e,n){return this._client.post("/vector_stores",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,n){return this._client.get(`/vector_stores/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,n,s){return this._client.post(`/vector_stores/${e}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e={},n){return ot(e)?this.list({},e):this._client.getAPIList("/vector_stores",Hm,{query:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,n){return this._client.delete(`/vector_stores/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}search(e,n,s){return this._client.getAPIList(`/vector_stores/${e}/search`,Gm,{body:n,method:"post",...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class Hm extends xt{}class Gm extends Xu{}ua.VectorStoresPage=Hm;ua.VectorStoreSearchResponsesPage=Gm;ua.Files=sc;ua.VectorStoreFilesPage=ac;ua.FileContentResponsesPage=$m;ua.FileBatches=Rb;var Mb;class Ie extends OD{constructor({baseURL:e=au("OPENAI_BASE_URL"),apiKey:n=au("OPENAI_API_KEY"),organization:s=au("OPENAI_ORG_ID")??null,project:i=au("OPENAI_PROJECT_ID")??null,...o}={}){if(n===void 0)throw new be("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const u={apiKey:n,organization:s,project:i,...o,baseURL:e||"https://api.openai.com/v1"};if(!u.dangerouslyAllowBrowser&&YD())throw new be(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:u.baseURL,timeout:u.timeout??6e5,httpAgent:u.httpAgent,maxRetries:u.maxRetries,fetch:u.fetch}),this.completions=new vb(this),this.chat=new Zu(this),this.embeddings=new wb(this),this.files=new Am(this),this.images=new Tb(this),this.audio=new Io(this),this.moderations=new Cb(this),this.models=new Um(this),this.fineTuning=new la(this),this.graders=new km(this),this.vectorStores=new ua(this),this.beta=new ni(this),this.batches=new lm(this),this.uploads=new Fm(this),this.responses=new Bm(this),this.evals=new Lo(this),this.containers=new Po(this),this._options=u,this.apiKey=n,this.organization=s,this.project=i}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return SD(e,{arrayFormat:"brackets"})}}Mb=Ie;Ie.OpenAI=Mb;Ie.DEFAULT_TIMEOUT=6e5;Ie.OpenAIError=be;Ie.APIError=kt;Ie.APIConnectionError=ju;Ie.APIConnectionTimeoutError=om;Ie.APIUserAbortError=Cn;Ie.NotFoundError=Ix;Ie.ConflictError=Rx;Ie.RateLimitError=Px;Ie.BadRequestError=Ax;Ie.AuthenticationError=Ex;Ie.InternalServerError=Dx;Ie.PermissionDeniedError=Nx;Ie.UnprocessableEntityError=Mx;Ie.toFile=Bx;Ie.fileFromPath=bx;Ie.Completions=vb;Ie.Chat=Zu;Ie.ChatCompletionsPage=Wu;Ie.Embeddings=wb;Ie.Files=Am;Ie.FileObjectsPage=Em;Ie.Images=Tb;Ie.Audio=Io;Ie.Moderations=Cb;Ie.Models=Um;Ie.ModelsPage=Om;Ie.FineTuning=la;Ie.Graders=km;Ie.VectorStores=ua;Ie.VectorStoresPage=Hm;Ie.VectorStoreSearchResponsesPage=Gm;Ie.Beta=ni;Ie.Batches=lm;Ie.BatchesPage=um;Ie.Uploads=Fm;Ie.Responses=Bm;Ie.Evals=Lo;Ie.EvalListResponsesPage=Cm;Ie.Containers=Po;Ie.ContainerListResponsesPage=_m;const y2=t=>typeof t=="object"&&t!==null&&"aborted"in t,Pb=t=>t?y2(t)?{signal:t}:t:{},Db=async(t,e=2,n)=>{let s;for(let i=0;i<e;i++){if(n!=null&&n.aborted)throw new DOMException("Aborted","AbortError");try{return await t()}catch(o){if(s=o,n!=null&&n.aborted||i===e-1)throw s;console.warn(`API call failed, retrying... (${i+1}/${e})`,o),await new Promise(u=>setTimeout(u,500))}}throw s};class co extends Error{constructor(e,n){super(e),this.name="PlanParsingError",this.rawContent=n}}const Dp=t=>{try{return JSON.parse(t)}catch{return null}},v2=t=>{const e=[["[","]"],["{","}"]];for(const[n,s]of e){const i=t.indexOf(n),o=t.lastIndexOf(s);if(i!==-1&&o!==-1&&o>i){const u=t.slice(i,o+1).trim();if(u&&Dp(u)!==null)return u}}return null},Uu=(t,e)=>{let n=t.trim();const s=n.match(/```(?:json)?\s*([\s\S]*?)\s*```/);s&&s[1]&&(n=s[1]);let o=Dp(n);if(o===null){const u=v2(n);u&&(o=Dp(u))}if(o!==null){const u=o;if(Array.isArray(u))return u;if(typeof u=="object"&&u!==null){if(e!=null&&e.rootKey){if(!(e.rootKey in u))throw new co(`Response is missing required "${e.rootKey}" property.`,n);if(e.requireRootKeyOnly&&Object.keys(u).some(f=>f!==e.rootKey))throw new co(`Response must only include the "${e.rootKey}" property.`,n);const m=u[e.rootKey];if(!Array.isArray(m))throw new co(`"${e.rootKey}" must be an array.`,n);return m}const d=Object.values(u).find(m=>Array.isArray(m));if(d&&Array.isArray(d))return d;if("chartType"in u&&"title"in u)return[u]}}throw console.error("Failed to parse AI response as JSON. Content:",n),new co(`AI response could not be parsed as JSON. Content starts with: "${n.substring(0,150)}..."`,n)},S2=new Set(["user","assistant","system","developer"]),w2=t=>S2.has(t)?t:"user",_2=t=>{if(typeof t=="string")return t;if(Array.isArray(t))return t.map(e=>typeof e=="string"?e:"text"in e&&typeof e.text=="string"?e.text:JSON.stringify(e)).join(`
`);if(t&&typeof t=="object"&&"text"in t){const e=t.text;if(typeof e=="string")return e}return""},x2=t=>t.map(e=>({role:w2(e.role),content:_2(e.content),type:"message"})),b2=t=>{if(typeof t=="boolean")return t?{type:"json_object"}:void 0;if(t)return{type:"json_schema",name:t.name,schema:t.schema,strict:t.strict??!0}},Yn=async(t,e,n,s)=>{if(!t.openAIApiKey)throw new Error("OpenAI API key is not set.");const i=new Ie({apiKey:t.openAIApiKey,dangerouslyAllowBrowser:!0}),o=Pb(s),u=b2(n),d={model:t.model,input:x2(e)};u&&(d.text={format:u});const m=await Db(()=>i.responses.create(d,o.signal?{signal:o.signal}:void 0),2,o.signal),f=m==null?void 0:m.usage;f&&o.onUsage&&o.onUsage({provider:"openai",model:t.model,promptTokens:f.prompt_tokens??f.input_tokens??f.input_token_count,completionTokens:f.completion_tokens??f.output_tokens??f.output_token_count,totalTokens:f.total_tokens??f.total_token_count,operation:o.operation});const y=(m.output_text??"").trim();if(!y)throw new Error("OpenAI returned an empty response.");return y},Jn=async(t,e,n,s)=>{if(!t.geminiApiKey)throw new Error("Gemini API key is not set.");const i=new uD({apiKey:t.geminiApiKey}),o=Pb(s),u=`${e}
${n?"Your response must be a valid JSON object adhering to the provided schema.":""}`,d=await Db(()=>i.models.generateContent({model:t.model,contents:u,config:n?{responseMimeType:"application/json",responseSchema:n}:void 0},o.signal?{signal:o.signal}:void 0),2,o.signal),m=d.usageMetadata;return m&&o.onUsage&&o.onUsage({provider:"gemini",model:t.model,promptTokens:m.promptTokenCount??void 0,completionTokens:m.candidatesTokenCount??void 0,totalTokens:m.totalTokenCount??void 0,operation:o.operation}),d.text.trim()},Lb={type:X.OBJECT,properties:{chartType:{type:X.STRING,enum:["bar","line","pie","doughnut","scatter","combo"],description:"Type of chart to generate."},title:{type:X.STRING,description:"A concise title for the analysis."},description:{type:X.STRING,minLength:8,description:"A brief explanation of what the analysis shows. Must be a full sentence with at least 8 characters."},aggregation:{type:X.STRING,enum:["sum","count","avg"],description:"The aggregation function to apply. Omit for scatter plots."},groupByColumn:{type:X.STRING,description:"The column to group data by (categorical). Omit for scatter plots."},valueColumn:{type:X.STRING,description:'The column for aggregation (numerical). Not needed for "count".'},xValueColumn:{type:X.STRING,description:"The column for the X-axis of a scatter plot (numerical). Required for scatter plots."},yValueColumn:{type:X.STRING,description:"The column for the Y-axis of a scatter plot (numerical). Required for scatter plots."},secondaryValueColumn:{type:X.STRING,description:"For combo charts, the secondary column for aggregation (numerical)."},secondaryAggregation:{type:X.STRING,enum:["sum","count","avg"],description:"For combo charts, the aggregation for the secondary value column."},defaultTopN:{type:X.INTEGER,description:"Optional. If the analysis has many categories, this suggests a default Top N view (e.g., 8)."},defaultHideOthers:{type:X.BOOLEAN,description:'Optional. If using defaultTopN, suggests whether to hide the "Others" category by default.'},orderBy:{type:X.ARRAY,description:"Optional ordering instructions applied before limiting rows.",items:{type:X.OBJECT,properties:{column:{type:X.STRING,description:"Column to sort by (group or metric alias)."},direction:{type:X.STRING,enum:["asc","desc"],description:"Sort direction (default desc)."}},required:["column","direction"],additionalProperties:!1}},limit:{type:X.INTEGER,description:"Optional limit applied after sorting (e.g., Top N rows)."},rowFilter:{type:X.OBJECT,description:"Optional row-level filter to limit rows before aggregation (e.g., single customer or region).",properties:{column:{type:X.STRING,description:"Column to filter on. Must be categorical."},values:{type:X.ARRAY,minItems:1,description:"Exact values to keep (case-sensitive, as they appear in the dataset).",items:{type:X.STRING}}},required:["column","values"],additionalProperties:!1}},required:["chartType","title","description"],additionalProperties:!1},Vm={type:X.OBJECT,properties:{plans:{type:X.ARRAY,description:"Array of analysis plans to execute.",items:Lb}},required:["plans"],additionalProperties:!1},T2={type:X.OBJECT,properties:{name:{type:X.STRING,description:"The column name."},type:{type:X.STRING,enum:["numerical","categorical","date","time","currency","percentage"],description:"The data type of the column. Identify specific types like 'date', 'currency', etc., where possible."}},required:["name","type"],additionalProperties:!1},kb={type:X.OBJECT,properties:{explanation:{type:X.STRING,description:"A brief, user-facing explanation of the transformations that will be applied to the data (e.g., 'Removed 3 summary rows and reshaped the data from a cross-tab format')."},jsFunctionBody:{type:X.STRING,description:"The body of a JavaScript function that takes two arguments `data` (an array of objects) and `_util` (a helper object) and returns the transformed array of objects. This code will be executed to clean and reshape the data. If no transformation is needed, this should be null."},outputColumns:{type:X.ARRAY,description:"A list of column profiles describing the structure of the data AFTER the transformation. If no transformation is performed, this should be the same as the input column profiles.",items:T2}},required:["explanation","jsFunctionBody","outputColumns"],additionalProperties:!1},Ub={type:X.OBJECT,properties:{explanation:{type:X.STRING,description:"A brief, user-facing explanation of the filter that was created from the natural language query."},jsFunctionBody:{type:X.STRING,description:"The body of a JavaScript function that takes 'data' and '_util' as arguments and returns a filtered array of objects. It should be a single line starting with 'return data.filter(...);'."}},required:["explanation","jsFunctionBody"],additionalProperties:!1},Ob={type:X.OBJECT,properties:{insight:{type:X.STRING,description:"A concise, user-facing message describing the single most important finding."},cardId:{type:X.STRING,description:"The ID of the card where this insight was observed."}},required:["insight","cardId"],additionalProperties:!1},C2=Lb,A2={type:X.OBJECT,properties:{question:{type:X.STRING,description:"The clear, user-facing question to ask for clarification."},options:{type:X.ARRAY,items:{type:X.OBJECT,properties:{label:{type:X.STRING,description:"The user-friendly text for the option button."},value:{type:X.STRING,description:"The exact column name (case-sensitive) or literal value that should be assigned to the plan when this option is selected. Do not invent new names."}},required:["label","value"]}},pendingPlan:{type:X.OBJECT,description:"The partial analysis plan that is waiting for the user's input. It should contain all known parameters.",properties:{chartType:{type:X.STRING,enum:["bar","line","pie","doughnut","scatter","combo"]},title:{type:X.STRING},description:{type:X.STRING},aggregation:{type:X.STRING,enum:["sum","count","avg"]},groupByColumn:{type:X.STRING},valueColumn:{type:X.STRING},xValueColumn:{type:X.STRING},yValueColumn:{type:X.STRING},secondaryValueColumn:{type:X.STRING},secondaryAggregation:{type:X.STRING,enum:["sum","count","avg"]},defaultTopN:{type:X.INTEGER},defaultHideOthers:{type:X.BOOLEAN},orderBy:{type:X.ARRAY,items:{type:X.OBJECT,properties:{column:{type:X.STRING},direction:{type:X.STRING,enum:["asc","desc"]}},required:["column","direction"],additionalProperties:!1}},limit:{type:X.INTEGER},rowFilter:{type:X.OBJECT,properties:{column:{type:X.STRING},values:{type:X.ARRAY,items:{type:X.STRING}}},additionalProperties:!1,required:["column","values"]}}},targetProperty:{type:X.STRING,description:"The name of the property in the 'pendingPlan' that the user's selected value should be assigned to."}},required:["question","options","pendingPlan","targetProperty"]},E2={type:X.OBJECT,description:"Declarative representation of a pending plan step.",properties:{id:{type:X.STRING,minLength:3,description:"Stable identifier (kebab-case recommended) used to reference this step in future actions."},label:{type:X.STRING,minLength:4,description:"Human-readable summary of the step."}},required:["id","label"],additionalProperties:!1},N2={type:X.OBJECT,description:"Structured summary of the agent's current goal, progress, and blockers.",properties:{goal:{type:X.STRING,minLength:6,description:"Overarching objective the agent is pursuing."},contextSummary:{type:X.STRING,description:"Optional short reminder of the context or constraint shaping the plan."},progress:{type:X.STRING,minLength:6,description:"What was just learned or completed from the latest observations."},nextSteps:{type:X.ARRAY,description:"Concrete upcoming actions, ordered by priority.",minItems:1,items:E2},planId:{type:X.STRING,description:"Stable identifier for the active plan (e.g., plan-<timestamp>)."},blockedBy:{type:X.STRING,description:"Describe any blockers or open questions. Omit if none."},observationIds:{type:X.ARRAY,description:"IDs of the observations that informed this update.",items:{type:X.STRING}},confidence:{type:X.NUMBER,description:"Optional confidence score between 0 and 1.",minimum:0,maximum:1},updatedAt:{type:X.STRING,description:"ISO timestamp describing when this snapshot was generated."},currentStepId:{type:X.STRING,description:"The id of the step currently being executed. Must reference one of the declared steps."},steps:{type:X.ARRAY,description:"Full list of steps with their intent + status.",minItems:1,items:{type:X.OBJECT,properties:{id:{type:X.STRING,description:"Stable identifier for the step."},label:{type:X.STRING,description:"Human-readable summary."},intent:{type:X.STRING,description:"High-level intent (e.g., conversation, remove_card)."},status:{type:X.STRING,enum:["ready","in_progress","done","waiting_user"],description:"Current status for the step."}},required:["id","label","intent","status"],additionalProperties:!1}},stateTag:{type:X.STRING,description:'Monotonic tag minted as "<epochMs>-<seq>" or one of the known labels (context_ready, awaiting_clarification, etc.).'}},required:["goal","contextSummary","progress","nextSteps","blockedBy","observationIds","confidence","updatedAt","planId","currentStepId"],additionalProperties:!1},qb={type:X.OBJECT,properties:{actions:{type:X.ARRAY,description:"A sequence of actions for the assistant to perform.",items:{type:X.OBJECT,properties:{reason:{type:X.STRING,maxLength:280,description:"Short, auditable explanation (1-2 sentences) describing why this specific action is being taken."},type:{type:X.STRING,enum:["text_response","await_user","plan_creation","dom_action","execute_js_code","proceed_to_analysis","filter_spreadsheet","clarification_request","plan_state_update"],description:"Primary action type identifier. Must align with responseType for backward compatibility."},stateTag:{type:X.STRING,description:'Monotonic tag minted as "<epochMs>-<seq>" that tracks action chronology (or a known label such as awaiting_clarification).'},stepId:{type:X.STRING,description:"The identifier of the plan step this action is advancing. Required for every action including plan_state_update."},responseType:{type:X.STRING,enum:["text_response","await_user","plan_creation","dom_action","execute_js_code","proceed_to_analysis","filter_spreadsheet","clarification_request","plan_state_update"]},timestamp:{type:X.STRING,description:"ISO timestamp indicating when the action was created."},text:{type:X.STRING,description:"A conversational text response to the user. Required for 'text_response' or 'await_user'."},cardId:{type:X.STRING,description:"Optional. The ID of the card this text response refers to. Used to link text to a specific chart."},meta:{type:X.OBJECT,description:"Optional runner hints controlling halt/wait behavior.",properties:{awaitUser:{type:X.BOOLEAN,description:"Set true to pause planning until the user responds."},haltAfter:{type:X.BOOLEAN,description:"Set true to stop auto-continuations after this turn."},resumePlanner:{type:X.BOOLEAN,description:"Set true to explicitly resume the planner after a previous pause."},promptId:{type:X.STRING,description:"Stable identifier for matching follow-up UI (e.g., question cards)."}},required:["awaitUser","haltAfter","resumePlanner","promptId"],additionalProperties:!1},plan:{...C2,description:"Analysis plan object. Required for 'plan_creation'."},planState:{...N2,description:"Summary of the agent goal and progress. Required for 'plan_state_update'."},domAction:{type:X.OBJECT,description:"A DOM manipulation action for the frontend to execute. Required for 'dom_action'.",properties:{toolName:{type:X.STRING,enum:["highlightCard","changeCardChartType","showCardData","filterCard","setTopN","toggleHideOthers","toggleLegendLabel","exportCard","removeCard"]},target:{type:X.OBJECT,description:"Declaration of the DOM target. Provide byId (card id), byTitle, or a CSS selector.",properties:{byId:{type:X.STRING,description:"Card id target (preferred)."},byTitle:{type:X.STRING,description:"Fallback title target."},selector:{type:X.STRING,description:"CSS selector when id/title are unavailable."}},required:["byId","byTitle","selector"],additionalProperties:!1},args:{type:X.OBJECT,description:"Arguments for the tool. Provide values for all properties; set unused ones to null.",properties:{cardId:{type:X.STRING,description:"The ID of the target analysis card."},cardTitle:{type:X.STRING,description:"Optional title used to look up the card when cardId is unknown (removeCard only)."},newType:{type:X.STRING,enum:["bar","line","pie","doughnut","scatter","combo"],description:"For 'changeCardChartType'."},visible:{type:X.BOOLEAN,description:"For 'showCardData'."},column:{type:X.STRING,description:"For 'filterCard', the column to filter on."},values:{type:X.ARRAY,items:{type:X.STRING},description:"For 'filterCard', the values to include."},topN:{type:X.INTEGER,description:"For 'setTopN'. Provide a positive integer. Omit this field to revert to showing all categories."},hide:{type:X.BOOLEAN,description:"For 'toggleHideOthers'. True hides the 'Others' bucket, false shows it."},label:{type:X.STRING,description:"For 'toggleLegendLabel'. The exact legend label to toggle visibility for."},format:{type:X.STRING,enum:["png","csv","html"],description:"For 'exportCard'. Choose the export format."}},required:["cardId","cardTitle","newType","visible","column","values","topN","hide","label","format"],additionalProperties:!1}},required:["toolName","target","args"]},code:{type:X.OBJECT,description:"For 'execute_js_code', the code to run.",properties:{explanation:{type:X.STRING,description:"A brief, user-facing explanation of what the code will do."},jsFunctionBody:{type:X.STRING,description:"The non-empty body of a JavaScript function that takes 'data' and returns the transformed 'data'. Blank strings or placeholders are invalid.",minLength:10}},required:["explanation","jsFunctionBody"]},args:{type:X.OBJECT,description:"Arguments for other tools, like 'filter_spreadsheet'.",properties:{query:{type:X.STRING,description:"The natural language query to filter the spreadsheet by."}}},clarification:{...A2,description:"The clarification request object. Required for 'clarification_request'."}},required:["type","responseType","reason","stateTag","stepId","timestamp","text"]}}},required:["actions"]},I2=new Map([[X.STRING,"string"],[X.INTEGER,"integer"],[X.NUMBER,"number"],[X.BOOLEAN,"boolean"],[X.ARRAY,"array"],[X.OBJECT,"object"]]),R2=new Set(["","properties.actions.items","properties.actions.items.properties.plan","properties.actions.items.properties.domAction","properties.actions.items.properties.domAction.properties.args","properties.actions.items.properties.code","properties.actions.items.properties.args","properties.actions.items.properties.clarification","properties.actions.items.properties.clarification.properties.options.items","properties.actions.items.properties.clarification.properties.pendingPlan","properties.actions.items.properties.planState","properties.actions.items.properties.planState.properties.nextSteps.items"]),M2=new Set(["properties.actions.items","properties.actions.items.properties.args","properties.actions.items.properties.plan","properties.actions.items.properties.planState","properties.actions.items.properties.clarification.properties.pendingPlan","properties.plans.items"]),_w=new Set(["properties.actions.items.properties.reason","properties.actions.items.properties.text","properties.actions.items.properties.stateTag","properties.actions.items.properties.stepId","properties.actions.items.properties.cardId","properties.actions.items.properties.meta","properties.actions.items.properties.plan","properties.actions.items.properties.plan.properties.aggregation","properties.actions.items.properties.plan.properties.groupByColumn","properties.actions.items.properties.plan.properties.valueColumn","properties.actions.items.properties.plan.properties.xValueColumn","properties.actions.items.properties.plan.properties.yValueColumn","properties.actions.items.properties.plan.properties.secondaryValueColumn","properties.actions.items.properties.plan.properties.secondaryAggregation","properties.actions.items.properties.plan.properties.defaultTopN","properties.actions.items.properties.plan.properties.defaultHideOthers","properties.actions.items.properties.plan.properties.orderBy","properties.actions.items.properties.plan.properties.orderBy.items.properties.direction","properties.actions.items.properties.plan.properties.rowFilter","properties.actions.items.properties.plan.properties.rowFilter.properties.column","properties.actions.items.properties.plan.properties.rowFilter.properties.values","properties.actions.items.properties.plan.properties.limit","properties.actions.items.properties.domAction","properties.actions.items.properties.domAction.properties.args","properties.actions.items.properties.domAction.properties.args.properties.newType","properties.actions.items.properties.domAction.properties.args.properties.visible","properties.actions.items.properties.domAction.properties.args.properties.cardTitle","properties.actions.items.properties.domAction.properties.args.properties.column","properties.actions.items.properties.domAction.properties.args.properties.values","properties.actions.items.properties.domAction.properties.args.properties.topN","properties.actions.items.properties.domAction.properties.args.properties.hide","properties.actions.items.properties.domAction.properties.args.properties.label","properties.actions.items.properties.domAction.properties.args.properties.format","properties.actions.items.properties.domAction.properties.target.properties.byId","properties.actions.items.properties.domAction.properties.target.properties.byTitle","properties.actions.items.properties.domAction.properties.target.properties.selector","properties.actions.items.properties.code","properties.actions.items.properties.args","properties.actions.items.properties.clarification","properties.actions.items.properties.clarification.properties.pendingPlan","properties.actions.items.properties.clarification.properties.pendingPlan.properties.chartType","properties.actions.items.properties.clarification.properties.pendingPlan.properties.title","properties.actions.items.properties.clarification.properties.pendingPlan.properties.description","properties.actions.items.properties.clarification.properties.pendingPlan.properties.aggregation","properties.actions.items.properties.clarification.properties.pendingPlan.properties.groupByColumn","properties.actions.items.properties.clarification.properties.pendingPlan.properties.valueColumn","properties.actions.items.properties.clarification.properties.pendingPlan.properties.xValueColumn","properties.actions.items.properties.clarification.properties.pendingPlan.properties.yValueColumn","properties.actions.items.properties.clarification.properties.pendingPlan.properties.secondaryValueColumn","properties.actions.items.properties.clarification.properties.pendingPlan.properties.secondaryAggregation","properties.actions.items.properties.clarification.properties.pendingPlan.properties.defaultTopN","properties.actions.items.properties.clarification.properties.pendingPlan.properties.defaultHideOthers","properties.actions.items.properties.clarification.properties.pendingPlan.properties.orderBy","properties.actions.items.properties.clarification.properties.pendingPlan.properties.orderBy.items.properties.direction","properties.actions.items.properties.clarification.properties.pendingPlan.properties.rowFilter","properties.actions.items.properties.clarification.properties.pendingPlan.properties.rowFilter.properties.column","properties.actions.items.properties.clarification.properties.pendingPlan.properties.rowFilter.properties.values","properties.actions.items.properties.clarification.properties.pendingPlan.properties.limit","properties.actions.items.properties.planState","properties.actions.items.properties.planState.properties.contextSummary","properties.actions.items.properties.planState.properties.blockedBy","properties.actions.items.properties.planState.properties.stateTag","properties.actions.items.properties.planState.properties.steps.items.properties.intent","properties.jsFunctionBody","properties.plans.items.properties.aggregation","properties.plans.items.properties.groupByColumn","properties.plans.items.properties.valueColumn","properties.plans.items.properties.xValueColumn","properties.plans.items.properties.yValueColumn","properties.plans.items.properties.secondaryValueColumn","properties.plans.items.properties.secondaryAggregation","properties.plans.items.properties.defaultTopN","properties.plans.items.properties.defaultHideOthers","properties.plans.items.properties.orderBy","properties.plans.items.properties.orderBy.items.properties.direction","properties.plans.items.properties.rowFilter","properties.plans.items.properties.rowFilter.properties.column","properties.plans.items.properties.rowFilter.properties.values","properties.plans.items.properties.limit"]),xw=t=>{if(!t)return t;let e=!1;return t.enum&&(e=!0,t.enum.includes(null)||(t.enum=[...t.enum,null])),t.type?Array.isArray(t.type)?t.type.includes("null")||(t.type=[...t.type,"null"]):t.type!=="null"&&(t.type=[t.type,"null"]):!t.anyOf&&!e&&(t.anyOf=[{type:"null"}]),t},_s=(t,e="")=>{if(Array.isArray(t))return t.map(n=>_s(n,`${e}[]`));if(t&&typeof t=="object"){const n={};for(const[s,i]of Object.entries(t)){if(s==="type"){n.type=I2.get(i)??i;continue}if(s==="properties"&&i&&typeof i=="object"){n.properties={};for(const[o,u]of Object.entries(i)){const d=e?`${e}.properties.${o}`:`properties.${o}`;n.properties[o]=_s(u,d)}continue}if(s==="items"){const o=e?`${e}.items`:"items";n.items=_s(i,o);continue}n[s]=_s(i,e?`${e}.${s}`:s)}if(n.type==="object"&&typeof n.additionalProperties>"u"&&R2.has(e)&&(n.additionalProperties=!1),n.type==="object"&&M2.has(e)){const s=n.properties?Object.keys(n.properties):[];n.required=s}return _w.has(e)?xw(n):n}return _w.has(e)?xw(t):t},Bb=_s(Vm),P2=_s(kb),D2=_s(Ub),L2=_s(Ob),k2=_s(qb),U2=7e3,O2="[Context trimmed due to budget: ",zm=(t,e=U2,n)=>{const s=(n==null?void 0:n.includeTrimNote)??!0,i=n!=null&&n.stageFilter?new Set(Array.isArray(n.stageFilter)?n.stageFilter:[n.stageFilter]):null,u=[...i?t.filter(S=>S.stage?i.has(S.stage):!1):t].sort((S,_)=>{const T=typeof S.priority=="number"?S.priority:5,C=typeof _.priority=="number"?_.priority:5;return T-C}),d=[],m=[];let f=0;u.forEach((S,_)=>{var L;const T=(L=S.content)==null?void 0:L.trim();if(!T)return;const C=T,N=C.length+(d.length>0?2:0);S.required||d.length===0||f+N<=e?(d.push(C),f+=N):m.push(S.label||`Section ${_+1}`)});let y=d.join(`

`);if(s&&m.length>0){const S=`${O2}${m.join(", ")}]`;y=`${y}

${S}`}return{prompt:y,trimmedSections:m}},Fr={numberParsing:'- **CRITICAL RULE on NUMBER PARSING**: This is the most common source of errors. To handle numbers that might be formatted as strings (e.g., "$1,234.56", "50%"), you are provided with a safe utility function: `_util.parseNumber(value)`.\n    - **YOU MUST use `_util.parseNumber(value)` for ALL numeric conversions.**\n    - **DO NOT use `parseInt()`, `parseFloat()`, or `Number()` directly.** The provided utility is guaranteed to handle various formats correctly.',splitNumeric:"- **CRITICAL RULE on SPLITTING NUMERIC STRINGS**: If you encounter a single string field that contains multiple comma-separated numbers (which themselves may contain commas as thousand separators, e.g., \"1,234.50,5,678.00,-9,123.45\"), you are provided a utility `_util.splitNumericString(value)` to correctly split the string into an array of number strings.\n    - **YOU MUST use this utility for this specific case.**\n    - **DO NOT use a simple `string.split(',')`**, as this will incorrectly break up numbers.\n    - **Example**: To parse a field 'MonthlyValues' containing \"1,500.00,2,000.00\", your code should be: `const values = _util.splitNumericString(row.MonthlyValues);` This will correctly return `['1,500.00', '2,000.00']`.",dataVsSummaries:`- **Distinguishing Data from Summaries**: Your most critical task is to differentiate between valid data rows and non-data rows (like summaries or metadata).
    - A row is likely **valid data** if it has a value in its primary identifier column(s) (e.g., 'Account Code', 'Product ID') and in its metric columns.
    - **CRITICAL: Do not confuse hierarchical data with summary rows.** Look for patterns in identifier columns where one code is a prefix of another (e.g., '50' is a parent to '5010'). These hierarchical parent rows are **valid data** representing a higher level of aggregation and MUST be kept. Your role is to reshape the data, not to pre-summarize it by removing these levels.
    - A row is likely **non-data** and should be removed if it's explicitly a summary (e.g., contains 'Total', 'Subtotal' in a descriptive column) OR if it's metadata (e.g., the primary identifier column is empty but other columns contain text, like a section header).`,dataframeHelpers:"- **DataFrame Helper DSL**: The runtime provides reliable helpers via `_util`. Use `_util.groupBy(rows, key)`, `_util.pivot(rows, rowKey, columnKey, valueKey, reducer)`, `_util.join(leftRows, rightRows, { leftKey, rightKey, how })`, and `_util.rollingWindow(rows, windowSize, { column, op })` instead of rewriting these routines. These helpers dramatically reduce JavaScript mistakesuse them whenever you need grouping, reshaping, joining, or window calculations."},q2=(t,e,n)=>`
    You are an expert data engineer. Your task is to analyze a raw dataset and, if necessary, provide a JavaScript function to clean and reshape it into a tidy, analysis-ready format. CRITICALLY, you must also provide the schema of the NEW, transformed data with detailed data types.
    A tidy format has: 1. Each variable as a column. 2. Each observation as a row.
    
    Common problems to fix:
    ${Fr.numberParsing}
    ${Fr.splitNumeric}
    ${Fr.dataVsSummaries}
    ${Fr.dataframeHelpers}
    - **Crosstab/Wide Format**: Unpivot data where column headers are values (e.g., years, regions).
    - **Multi-header Rows**: Skip initial junk rows.

    Dataset Columns (Initial Schema):
    ${JSON.stringify(t,null,2)}
    Sample Data (up to 20 rows):
    ${JSON.stringify(e,null,2)}
    ${n?`On the previous attempt, your generated code failed with this error: "${n.message}". Please analyze the error and the data, then provide a corrected response.`:""}
    
    Your task:
    1.  **Analyze**: Look at the initial schema and sample data.
    2.  **Plan Transformation**: Decide if cleaning or reshaping is needed. If you identify date or time columns as strings, your function should attempt to parse them into a standard format (e.g., 'YYYY-MM-DD' for dates).
    3.  **Define Output Schema**: Determine the exact column names and types of the data AFTER your transformation. This is the MOST important step. Be as specific as possible with the types. Use 'categorical' for text labels, 'numerical' for general numbers, but you MUST identify and use the more specific types where they apply:
        - **'date'**: For columns containing dates (e.g., "2023-10-26", "10/26/2023").
        - **'time'**: For columns with time values (e.g., "14:30:00").
        - **'currency'**: For columns representing money, especially if they contain symbols like '$' or ','.
        - **'percentage'**: For columns with '%' symbols or values that are clearly percentages.
    4.  **Write Code**: If transformation is needed, write the body of a JavaScript function. This function receives two arguments, \`data\` and \`_util\`, and must return the transformed array of objects.
    5.  **Explain**: Provide a concise 'explanation' of what you did.

    **CRITICAL REQUIREMENTS:**
    - You MUST provide the \`outputColumns\` array. If you don't transform the data, \`outputColumns\` should be identical to the initial schema (but with more specific types if you identified them). If you do transform it, it must accurately reflect the new structure your code creates.
    - Your JavaScript code MUST include a \`return\` statement as its final operation.

    **Example: Reshaping and identifying types using the utility**
    - Initial Data: [{'Product': 'A', 'DateStr': 'Oct 26 2023', 'Revenue': '$1,500.00'}]
    - Explanation: "Standardized the date format and converted the revenue column to a number."
    - jsFunctionBody: "return data.map(row => ({ ...row, DateStr: new Date(row.DateStr).toISOString().split('T')[0], Revenue: _util.parseNumber(row.Revenue) }));"
    - outputColumns: [{'name': 'Product', 'type': 'categorical'}, {'name': 'DateStr', 'type': 'date'}, {'name': 'Revenue', 'type': 'currency'}]
`,B2=(t,e,n)=>`
    You are an expert data analyst. Your task is to convert a user's natural language query into a JavaScript filter function body for a dataset.
    
    **User Query:** "${t}"
    
    **Dataset Columns (Schema):**
    ${JSON.stringify(e,null,2)}
    
    **Sample Data (first 5 rows):**
    ${JSON.stringify(n,null,2)}
    
    **CRITICAL Rules for Code Generation:**
    ${Fr.numberParsing}
    ${Fr.dataframeHelpers}
    - When comparing strings, convert both the data and the comparison value to the same case (e.g., lower case) using \`.toLowerCase()\` to ensure case-insensitive matching.
    - For date comparisons, you can use \`new Date(row.date_column) > new Date('YYYY-MM-DD')\`.
    - The function you write will be the body of a new Function that receives 'data' (the full array of objects) and '_util'.
    - Your function body MUST start with \`return data.filter(row => ...);\`.
    
    **Your Task:**
    1.  **Analyze Query:** Understand the user's intent. Identify columns, values, and operators (e.g., >, <, =, contains).
    2.  **Write JS Code:** Write a single line of JavaScript that filters the data array.
    3.  **Explain:** Briefly explain the filter you created in plain language.
    
    **Example:**
    - User Query: "show me all rows where sales > 5000 and region is North America"
    - Columns: [{ name: 'sales', type: 'currency' }, { name: 'region', type: 'categorical' }]
    - Your Response (JSON):
    {
      "explanation": "Filtering for rows where 'sales' is greater than 5000 and 'region' is 'North America'.",
      "jsFunctionBody": "return data.filter(row => _util.parseNumber(row.sales) > 5000 && row.region.toLowerCase() === 'north america');"
    }
`,F2=(t,e,n,s,i=[])=>`
    You are a senior business intelligence analyst specializing in ERP and financial data. Your task is to generate a diverse list of insightful analysis plan candidates for a given dataset by identifying common data patterns.
    
    Dataset columns:
    - Categorical: ${t.join(", ")}
    - Numerical: ${e.join(", ")}
    Sample Data (first 5 rows):
    ${JSON.stringify(n,null,2)}

    Historical high-signal views (cached from previous runs):
    ${i.length>0?i.map(o=>`- ${o}`).join(`
`):"None cached yet. Assume this dataset has no prior highlights to reuse."}
    
    Please generate up to ${s} diverse analysis plans.
    **MANDATORY COPY RULE**: Every plan MUST include a natural-language \`description\` (at least 8 characters) that states what the user will learn. Do not leave it blank or use placeholders.
    
    **CRITICAL: Think like a Business/ERP Analyst.**
    1.  **Identify Key Metrics**: First, find the columns that represent measurable values. Look for names like 'VALUE', 'AMOUNT', 'SALES', 'COST', 'QUANTITY', 'PRICE'. These are almost always the columns you should be aggregating (e.g., using 'sum' or 'avg').
    2.  **Identify Dimensions**: Next, find columns that describe the data. Look for names ending in 'CODE', 'ID', 'TYPE', 'CATEGORY', or containing 'NAME', 'DESCRIPTION', 'PROJECT', 'REGION'. These are your primary grouping columns (dimensions).
    3.  **Find Relationships**: Codes and descriptions often go together (e.g., 'PROJECT_CODE' and 'PROJECT_DESCRIPTION'). A very valuable analysis is to group by a description column (which is more human-readable for a chart) and sum a value column.
    4.  **Prioritize High-Value Aggregations**: Focus on creating plans that answer common business questions like 'What are our top revenue sources?', 'Where are the biggest costs?', or 'How are items distributed across categories?'. A simple 'count' is less valuable than a 'sum' of a 'VALUE' or 'AMOUNT' column.
    
    **Example Task**: Given columns ['CODE', 'DESCRIPTION', 'PROJECT_CODE', 'VALUE'], a HIGH-QUALITY plan would be:
    - Title: "Sum of VALUE by DESCRIPTION"
    - Aggregation: 'sum'
    - groupByColumn: 'DESCRIPTION'
    - valueColumn: 'VALUE'
    - Chart Type: 'bar'
    
    For each plan, choose the most appropriate chartType ('bar', 'line', 'pie', 'doughnut', 'scatter', 'combo'). 
    - Use 'line' for time series trends.
    - Use 'bar' for most categorical comparisons, especially for "top X" style reports.
    - Use 'pie' or 'doughnut' for compositions with few categories.
    - Use 'scatter' to show the relationship between two numerical variables.
    - **Use 'combo' (bar + line) to compare two different metrics against the same category (e.g., sum of 'Sales' as bars and average of 'Profit' as a line). You MUST provide both a primary and secondary value column and aggregation for combo charts.**
    
    Rules:
    - For 'scatter' plots, you MUST provide 'xValueColumn' and 'yValueColumn' (both numerical) and you MUST NOT provide 'aggregation' or 'groupByColumn'.
    - For 'combo' charts, you MUST provide 'groupByColumn', 'valueColumn', 'aggregation', 'secondaryValueColumn', and 'secondaryAggregation'.
    - **CRITICAL**: Only use one of the following aggregation types: 'sum', 'count', 'avg'. Do NOT use other statistical measures like 'stddev', 'variance', 'median', etc.
    - Do not create plans that are too granular (e.g., grouping by a unique ID column if there are thousands of them).
    - Never leave the \`description\` empty; summarize the business takeaway in a sentence.

    **Output Format:** Return a single JSON object with this shape:
    {
        "plans": [ /* array of plan objects */ ]
    }
    Do not include any other top-level properties or commentary.
`,$2=(t,e=[])=>`
    You are a Quality Review Data Analyst. Your job is to review a list of proposed analysis plans and their data samples. Your goal is to select ONLY the most insightful and readable charts for the end-user, and configure them for the best default view.
    
    Previously approved high-signal views for this dataset:
    ${e.length>0?e.map(n=>`- ${n}`).join(`
`):"- None cached yet. Prioritize discovering net-new, high-variance stories."}
    
    **Review Criteria & Rules:**
    1.  **Discard Low-Value Charts**: This is your most important task. You MUST discard any plan that is not genuinely insightful.
        - **Example of a low-value chart**: A bar chart where all values are nearly identical (e.g., [77, 77, 77, 76, 78]). This shows uniformity but is not a useful visualization. DISCARD IT.
        - **Example of another low-value chart**: A pie/doughnut chart where one category makes up over 95% of the total. This is not insightful. DISCARD IT.
    2.  **Discard Unreadable Charts**: If a chart groups by a high-cardinality column resulting in too many categories to be readable (e.g., more than 50 tiny bars), discard it unless it's a clear time-series line chart.
    3.  **Configure for Readability**: For good, insightful charts that have a moderate number of categories (e.g., 15 to 50), you MUST add default settings to make them readable. Set \`defaultTopN\` to 8 and \`defaultHideOthers\` to \`true\`.
    4.  **Keep Good Charts**: If a chart is insightful and has a reasonable number of categories (e.g., under 15), keep it as is without adding default settings.
    5.  **Copy Quality Gate**: Reject any plan whose \`description\` is blank, shorter than 8 characters, or not an explanatory sentence.
    6.  **Return the Result**: Your final output must be a JSON object shaped as { "plans": [ ... ] } containing ONLY the good, configured plan objects. Do not include the discarded plans or any additional commentary.
    
    **Proposed Plans and Data Samples:**
    ${JSON.stringify(t,null,2)}
`,H2=(t,e,n)=>{const s=n==="Mandarin"?`Provide a concise, insightful summary in two languages, separated by '---'.
Format: English Summary --- Mandarin Summary`:`Provide a concise, insightful summary in ${n}.`;return`
        You are a business intelligence analyst.
        The following data is for a chart titled "${t}".
        Data:
        ${JSON.stringify(e.slice(0,10),null,2)} 
        ${e.length>10?`(...and ${e.length-10} more rows)`:""}
        ${s}
        The summary should highlight key trends, outliers, or business implications. Do not just describe the data; interpret its meaning.
        For example, instead of "Region A has 500 sales", say "Region A is the top performer, contributing the majority of sales, which suggests a strong market presence there."
    `},G2=(t,e,n)=>`
    You are a senior data analyst. After performing an initial automated analysis of a dataset, your task is to create a concise "Core Analysis Briefing". This briefing will be shown to the user and will serve as the shared foundation of understanding for your conversation.
    Based on the columns and the analysis cards you have just generated, summarize the dataset's primary characteristics.
    Your briefing should cover:
    1.  **Primary Subject**: What is this data fundamentally about? (e.g., "This dataset appears to be about online sales transactions...")
    2.  **Key Metrics**: What are the most important numerical columns? (e.g., "...where the key metrics are 'Sale_Amount' and 'Profit'.")
    3.  **Core Dimensions**: What are the main categorical columns used for analysis? (e.g., "The data is primarily broken down by 'Region' and 'Product_Category'.")
    4.  **Suggested Focus**: Based on the initial charts, what should be the focus of further analysis? (e.g., "Future analysis should focus on identifying the most profitable regions and product categories.")
    
    **Available Information:**
    - **Dataset Columns**: ${JSON.stringify(e.map(s=>s.name))}
    - **Generated Analysis Cards**: ${JSON.stringify(t,null,2)}
    
    Produce a single, concise paragraph in ${n}. This is your initial assessment that you will share with your human counterpart.
`,V2=(t,e)=>`
    You are a proactive data analyst. Review the following summaries of data visualizations you have created. Your task is to identify the single most commercially significant or surprising insight. This could be a major trend, a key outlier, or a dominant category that has clear business implications.
    
    **Generated Analysis Cards & Data Samples:**
    ${JSON.stringify(t,null,2)}

    Your Task:
    1.  **Analyze**: Review all the cards provided.
    2.  **Identify**: Find the ONE most important finding. Don't list everything, just the top insight.
    3.  **Formulate**: Write a concise, user-facing message in ${e} that explains this insight (e.g., "I noticed that sales in August were unusually high, you might want to investigate what caused this spike.").
    4.  **Respond**: Return a JSON object containing this message and the ID of the card it relates to.
`,z2=(t,e)=>`
    You are a senior business strategist. You have been provided with several automated data analyses.
    Your task is to synthesize these individual findings into a single, high-level executive summary in ${e}.
    Here are the individual analysis summaries (they are in English):
    ${t}
    Please provide a concise, overarching summary that connects the dots between these analyses. 
    Identify the most critical business insights, potential opportunities, or risks revealed by the data as a whole.
    Do not just repeat the individual summaries. Create a new, synthesized narrative.
    Your response should be a single paragraph of insightful business analysis.
`,j2=(t,e)=>{const n=t.map((s,i)=>{const o=s.timestamp instanceof Date&&!Number.isNaN(s.timestamp.getTime())?s.timestamp.toISOString():new Date(s.timestamp).toISOString(),u=s.sender==="ai"?"Agent":"User";return`${i+1}. [${o}] ${u}: ${s.text}`}).join(`
`);return`
You are compressing a dialogue between a data analysis agent and the user. Summarize the durable takeaways so the agent can quickly recall prior context.

Instructions:
- Use ${e}.
- Include 23 concise bullet points that capture business insights, commitments, or blockers.
- List any open questions or TODOs separately.
- Mention the relative timing (e.g., "Early discussion", "Later follow-up") so the agent knows where this occurred.
- Do NOT invent facts that aren't in the transcript.

Conversation Transcript:
${n}
`},Fb=(t,e=5)=>{const n=t.length>0?t.slice(-e):[];return n.length===0?"No prior conversation.":n.map(s=>`${s.sender==="ai"?"Agent":"User"}: ${s.text}`).join(`
`)},Y2=(t,e,n,s,i,o,u,d)=>{const m=Fb(e,5),f=`
You are beginning STEP 1 of a multi-stage workflow. Your sole objective in this turn is to emit a high-quality \`plan_state_update\` action that sets the shared goal tracker for the UI. Do **not** run tools, transformations, or DOM actions yet.
Requirements for this response:
- The first action must be \`plan_state_update\` with goal, contextSummary, progress, nextSteps (each having id + label), blockedBy (or null), observationIds (array, can be empty), confidence (0-1 or null), and updatedAt.
- Every action you send must include \`type\`, \`responseType\`, \`stepId\`, and a monotonic \`stateTag\` formatted as "<epochMs>-<seq>" (set \`stateTag\` even on plan_state_update).
- Each action's \`reason\` must be no more than 280 characters and clearly state the immediate justification for that step (e.g., "Plan: drafting the chart creation steps").
- The plan_state_update payload must include \`planId\`, \`currentStepId\`, and a comprehensive \`steps\` array where each entry has \`intent\` and \`status\` (\`ready\`|\`in_progress\`|\`done\`).
- You may optionally include one short \`text_response\` after the plan_state_update to acknowledge the plan to the user in ${s}, but do not trigger other action types.
- If the user's latest message is merely a greeting or check-in (e.g., "hi", "hello there", ""), still include a first nextSteps entry with id "acknowledge_user" and a label that confirms you will greet/clarify with them before moving to data work.
- Keep nextSteps focused on the minimum set of concrete moves (e.g., build chart, run filter, gather clarification). Reference dataset columns exactly as they appear.
`.trim(),y=`
Recent conversation (last ${Math.min(e.length,5)} turn${Math.min(e.length,5)===1?"":"s"}):
${m}
`.trim(),S=`
The user's latest request is: "${n}"

Output your answer as a JSON object with an "actions" array. Remember: stay in planning mode only; do not issue executions until the goal tracker is established.
`.trim(),_=[{label:"Instructions",content:f,required:!0,priority:0,stage:"seed"},{label:"Recent conversation",content:y,priority:1,stage:"conversation"},{label:"Latest request",content:S,required:!0,priority:2,stage:"action"}],{prompt:T,trimmedSections:C}=zm(_);return C.length>0&&typeof console<"u"&&console.info("[promptBudget] Plan primer trimmed sections:",C),T},$b=(t,e,n,s,i,o,u,d,m,f,y,S,_)=>{const T=Fb(e,5),N=`${S.length>0?S.slice(-5).map(q=>`- [${q.source}/${q.status.toUpperCase()}] ${q.actionType}: ${q.summary}${q.details?` (${q.details})`:""}`).join(`
`):"No prior tool actions have been recorded yet. You are starting fresh. Always observe before acting."}
- [DATA_VIEW] Raw Data Explorer filter: ${_}`,E=m.length>0?m.slice(-5).map(q=>{const j=q.outputs?JSON.stringify(q.outputs).slice(0,160):"No structured output reported.";return`- [${q.status.toUpperCase()}] ${q.responseType} (action ${q.actionId.slice(-6)}): ${j}`}).join(`
`):"No runtime observations captured yet for this session.",L=f?`Goal: ${f.goal}
Context: ${f.contextSummary||""}
Progress: ${f.progress}
Next Steps:
${f.nextSteps.map((q,j)=>`  ${j+1}. [${q.id}] ${q.label}`).join(`
`)}
Blocked By: ${f.blockedBy||"Nothing reported."}
Confidence: ${typeof f.confidence=="number"?f.confidence.toFixed(2):"Not provided"}
Referenced Observations: ${f.observationIds&&f.observationIds.length>0?f.observationIds.join(", "):"None specified."}`:"No structured goal has been recorded yet. Your first action must be a plan_state_update that defines a clear goal, ties it to current data, and lists concrete next steps.",B=t.length>0?`Column inventory (${t.length} total, showing up to 10): ${t.slice(0,10).map(q=>`${q.name} (${q.type})`).join(", ")}`:"No columns detected.",O=s.length>0?`Existing cards (${s.length} total, showing up to 4):
${s.slice(0,4).map(q=>`- ${q.title}${q.chartType?` (${q.chartType})`:""}`).join(`
`)}`:"No analysis cards visible yet.",x=`Core analysis briefing:
${o||"Not generated yet."}`,I=y?`Data preparation log:
Explanation: ${y.explanation}
Code:
${y.jsFunctionBody}`:"No AI-driven data preparation was performed.",D=d.length>0?`Long-term memory (top ${Math.min(d.length,3)}):
${d.slice(0,3).join(`
---
`)}`:"No relevant long-term memories.",R=u.length>0?`Raw data sample (first 3 rows):
${JSON.stringify(u.slice(0,3),null,2)}`:"Raw data preview unavailable.",P=`
You are an expert data analyst and strategist operating with a Reason-Act (ReAct) framework. Every action needs a short reason first, then the action payload. Keep final conversational replies in ${i}.
`.trim(),A="\nPLAN TRACKER PROTOCOL (Follow exactly):\n- Every action JSON must include `type`, `responseType`, `stepId`, and a monotonic `stateTag`.\n- `plan_state_update` entries must list `nextSteps` objects (id + label) and a `steps` array including `intent` + `status`.\n- Emit at most two actions per turn (plan_state_update + one atomic action). Reasons 280 chars referencing the plan step.\n- Use `await_user` when the user must choose; include numbered options and set `meta.awaitUser=true`.\n- For `dom_action`, always specify `domAction.target`. If the target is unknown, fall back to a text_response asking the user.\n- When blocked, set `plan_state_update.blockedBy` and change its stateTag to `awaiting_clarification`.\n".trim();`
DATA PREPARATION LOG:
${y?`Explanation: ${y.explanation}
Code:
${y.jsFunctionBody}`:"No AI-driven data preparation was performed."}
`.trim(),`
LONG-TERM MEMORY:
${d.length>0?d.join(`
---
`):"No specific long-term memories are relevant."}
`.trim();const k=`
AGENT PLAN STATE:
${L}
`.trim();s.length>0&&s.slice(0,6).map(q=>`  - ${q.title}${q.chartType?` (${q.chartType})`:""}`).join(`
`),u.length>0&&JSON.stringify(u.slice(0,5),null,2);const F=`
Agent runtime notes:
- Pipeline: Context Builder  Planner  Action Dispatcher. Keep plans concise for downstream executors.
- Ensure \`stateTag\` tokens stay strictly increasing (use "<epochMs>-<seq>" as a fallback).
`.trim(),U=`
Recent tool actions:
${N}
`.trim(),z=`
Runtime observations (latest up to 5):
${E}
`.trim(),oe=`
Recent conversation:
${T||"No prior conversation."}
`.trim(),se=`
Latest user message: "${n}"

Respond with a JSON object containing an "actions" array. Example (pseudocode):
{
  "actions": [
    { "type": "plan_state_update", ... },
    { "type": "text_response", ... }
  ]
}

Primary actions available: text_response, plan_creation, dom_action, execute_js_code, clarification_request, await_user, filter_spreadsheet, proceed_to_analysis. Always acknowledge the user via text_response when you finish a complex step.
`.trim();return[{label:"Seed instructions",content:P,required:!0,priority:0,stage:"seed"},{label:"Plan protocol",content:A,required:!0,priority:1,stage:"seed"},{label:"Conversation",content:oe,priority:2,stage:"conversation"},{label:"Context: columns",content:B,priority:3,stage:"context"},{label:"Context: cards",content:O,priority:3,stage:"context"},{label:"Context: analysis briefing",content:x,priority:4,stage:"context"},{label:"Context: data prep",content:I,priority:4,stage:"context"},{label:"Context: long-term memory",content:D,priority:5,stage:"context"},{label:"Context: plan state",content:k,priority:5,stage:"context"},{label:"Context: raw data sample",content:R,priority:6,stage:"context"},{label:"Context: runtime notes",content:F,priority:7,stage:"context"},{label:"Context: action traces",content:U,priority:7,stage:"context"},{label:"Context: observations",content:z,priority:7,stage:"context"},{label:"Action / user request",content:se,required:!0,priority:8,stage:"action"}]},J2=(t,e,n,s,i,o,u,d,m,f,y,S,_)=>{const T=$b(t,e,n,s,i,o,u,d,m,f,y,S,_),{prompt:C,trimmedSections:N}=zm(T);return N.length>0&&typeof console<"u"&&console.info("[promptBudget] Chat prompt trimmed sections:",N),C},K2=(t,e,n,s,i,o,u,d,m,f,y,S,_,T)=>{const C=$b(e,n,s,i,o,u,d,m,f,y,S,_,T);return zm(C,void 0,{includeTrimNote:!1,stageFilter:t}).prompt},X2=async(t,e,n,s)=>{var o,u;let i;for(let d=0;d<3;d++){if((o=s==null?void 0:s.signal)!=null&&o.aborted)throw new DOMException("Aborted","AbortError");try{let m;const f=q2(t,e,i),y="data_prep.plan";if(n.provider==="openai"){if(!n.openAIApiKey)return{explanation:"No transformation needed as API key is not set.",jsFunctionBody:null,outputColumns:t};m=await Yn(n,[{role:"system",content:`You are an expert data engineer. Your task is to analyze a raw dataset and, if necessary, provide a JavaScript function to clean and reshape it into a tidy, analysis-ready format. CRITICALLY, you must also provide the schema of the NEW, transformed data with detailed data types.
You MUST respond with a single valid JSON object, and nothing else. The JSON object must adhere to the provided schema.`},{role:"user",content:f}],{name:"DataPreparationPlan",schema:P2,strict:!0},{signal:s==null?void 0:s.signal,operation:y,onUsage:C=>{var N;return(N=s==null?void 0:s.onUsage)==null?void 0:N.call(s,{...C,operation:y})}})}else{if(!n.geminiApiKey)return{explanation:"No transformation needed as Gemini API key is not set.",jsFunctionBody:null,outputColumns:t};m=await Jn(n,f,kb,{signal:s==null?void 0:s.signal,operation:y,onUsage:_=>{var T;return(T=s==null?void 0:s.onUsage)==null?void 0:T.call(s,{..._,operation:y})}})}const S=JSON.parse(m);if(S.jsFunctionBody)try{const _={parseNumber:N=>mn(N)??0,splitNumericString:D_},C=new Function("data","_util",S.jsFunctionBody)(e,_);if(!Array.isArray(C))throw new Error("Generated function did not return an array.");return S}catch(_){i=_,console.warn(`AI self-correction attempt ${d+1} failed due to JS execution error. Retrying...`,i);continue}return!S.jsFunctionBody&&(!S.outputColumns||S.outputColumns.length===0)&&(S.outputColumns=t),S}catch(m){if((u=s==null?void 0:s.signal)!=null&&u.aborted)throw m;console.error(`Error in data preparation plan generation (Attempt ${d+1}):`,m),i=m}}throw new Error(`AI failed to generate a valid data preparation plan after multiple attempts. Last error: ${i==null?void 0:i.message}`)},Q2=new Set(["sum","count","avg"]),Hb=(t,e=4)=>!t||t.length===0?[]:t.slice(0,e).map(n=>{const s=n.qualityScore!=null?`score=${n.qualityScore.toFixed(2)}`:"score=n/a",i=n.tags&&n.tags.length>0?`tags: ${n.tags.slice(0,3).join(", ")}`:"";return`${n.title}  ${n.summary} (${s}${i?`, ${i}`:""})`}),W2=t=>{const e={};return t.forEach(n=>{Object.entries(n||{}).forEach(([s,i])=>{s&&(e[s]||(e[s]={distinct:new Set,total:0}),e[s].total+=1,i!=null&&e[s].distinct.add(String(i)))})}),Object.entries(e).reduce((n,[s,i])=>(n[s]={distinct:i.distinct.size,total:i.total},n),{})},Z2=(t,e)=>{const n=new Set(["categorical","date","time"]),s=e.filter(o=>n.has(o.type)),i=s.find(o=>o.name!==t.valueColumn)??s[0]??e.find(o=>o.name!==t.valueColumn);return(i==null?void 0:i.name)??null},Gb=(t,e)=>{const n={...t};if(n.chartType&&n.chartType!=="scatter"&&n.chartType!=="combo"&&!n.groupByColumn){const s=Z2(n,e);s&&(n.groupByColumn=s)}return n},Vb=t=>{if(!t||typeof t!="object"||!t.chartType||!t.title)return console.warn("Skipping invalid plan: missing chartType or title.",t),!1;if(!t.description||typeof t.description!="string"||t.description.trim().length<8)return console.warn("Skipping invalid plan: description missing or too short.",t),!1;if(t.chartType==="scatter"){if(!t.xValueColumn||!t.yValueColumn)return console.warn("Skipping invalid scatter plot plan: missing xValueColumn or yValueColumn.",t),!1}else{if(!t.aggregation||!t.groupByColumn)return console.warn(`Skipping invalid plan: missing aggregation or groupByColumn for chart type ${t.chartType}.`,t),!1;if(!Q2.has(t.aggregation))return console.warn(`Skipping invalid plan: unsupported aggregation type "${t.aggregation}".`,t),!1;if(t.aggregation!=="count"&&!t.valueColumn)return console.warn("Skipping invalid plan: missing valueColumn for sum/avg aggregation.",t),!1}return!0},eL=.01,tL=.95,nL=.9,sL=8,aL=t=>{if(t.length<=1)return!0;const e=Math.max(...t),n=Math.min(...t);if(e===n)return!0;const s=Math.max(Math.abs(e),1);return(e-n)/s<=eL},rL=t=>{if(t.length===0)return!1;const e=t.reduce((s,i)=>s+Math.abs(i),0);return e===0?!0:Math.max(...t.map(s=>Math.abs(s)))/e>=tL},iL=(t,e)=>{const n=t.groupByColumn;if(!n)return!1;const s=e[n];return!s||s.total<sL?!1:s.distinct/s.total>=nL},oL=(t,e,n)=>{if(t.chartType==="scatter"||t.chartType==="combo"||!Array.isArray(e)||e.length===0)return null;const s=t.valueColumn||"count",i=e.map(o=>Number(o[s])).filter(o=>Number.isFinite(o));return i.length<=1?"not enough variation for a readable chart":aL(i)?"metric values are nearly identical":rL(i)?"a single category carries 95% of the total":iL(t,n)?`grouping column "${t.groupByColumn}" behaves like a unique identifier`:null},lL=(t,e)=>{const n=[],s=[];return t.forEach(i=>{const o=oL(i.plan,i.aggregatedSample,e);if(o){s.push({code:"low_value_plan_discarded",message:`Dropped "${i.plan.title}" because ${o}.`,hint:"This dataset needs a more varied metric or different grouping to produce an informative chart."});return}n.push(i)}),{viablePlans:n,warnings:s}},zb=async(t,e,n,s,i)=>{const o=t.filter(f=>f.type==="categorical"||f.type==="date"||f.type==="time").map(f=>f.name),u=t.filter(f=>f.type==="numerical"||f.type==="currency"||f.type==="percentage").map(f=>f.name);let d;const m=F2(o,u,e,s,Hb(i==null?void 0:i.memorySnapshots));if(n.provider==="openai"){const S=await Yn(n,[{role:"system",content:`You are a senior business intelligence analyst specializing in ERP and financial data. Your task is to generate a diverse list of insightful analysis plan candidates for a given dataset by identifying common data patterns.
You MUST respond with JSON that adheres exactly to the provided schema (an array of plan objects) and includes no extra commentary.`},{role:"user",content:m}],{name:"AnalysisPlanArray",schema:Bb,strict:!0},{signal:i==null?void 0:i.signal,operation:"analysis_plan.candidates",onUsage:_=>{var T;return(T=i==null?void 0:i.usageCollector)==null?void 0:T.call(i,{..._,label:"plan_candidates"})}});d=Uu(S,{rootKey:"plans",requireRootKeyOnly:!0})}else{const f=await Jn(n,m,Vm,{signal:i==null?void 0:i.signal,operation:"analysis_plan.candidates",onUsage:y=>{var S;return(S=i==null?void 0:i.usageCollector)==null?void 0:S.call(i,{...y,label:"plan_candidates"})}});d=Uu(f,{rootKey:"plans",requireRootKeyOnly:!0})}return d.map(f=>Gb(f,t)).filter(Vb)},uL=async(t,e,n,s)=>{let i;const o=$2(t,Hb(s==null?void 0:s.memorySnapshots));if(e.provider==="openai"){const f=await Yn(e,[{role:"system",content:`You are a Quality Review Data Analyst. Your job is to review a list of proposed analysis plans and their data samples. Select ONLY the most insightful and readable charts and configure them for the best default view.
You MUST respond with JSON that strictly adheres to the provided schema (an array of plan objects) and contains no additional explanation.`},{role:"user",content:o}],{name:"RefinedAnalysisPlanArray",schema:Bb,strict:!0},{signal:s==null?void 0:s.signal,operation:"analysis_plan.refine",onUsage:y=>{var S;return(S=s==null?void 0:s.usageCollector)==null?void 0:S.call(s,{...y,label:"plan_refine"})}});i=Uu(f,{rootKey:"plans",requireRootKeyOnly:!0})}else{const d=await Jn(e,o,Vm,{signal:s==null?void 0:s.signal,operation:"analysis_plan.refine",onUsage:m=>{var f;return(f=s==null?void 0:s.usageCollector)==null?void 0:f.call(s,{...m,label:"plan_refine"})}});i=Uu(d,{rootKey:"plans",requireRootKeyOnly:!0})}return i.map(d=>d&&d.plan&&typeof d.plan=="object"?d.plan:d).map(d=>Gb(d,n)).filter(Vb)},cL=async(t,e,n,s)=>{if(!(n.provider==="google"&&!!n.geminiApiKey||n.provider==="openai"&&!!n.openAIApiKey))throw new Error("API Key not provided.");const o=[],u=W2(e),d=[],m=await zb(t,e,n,12,{signal:s==null?void 0:s.signal,memorySnapshots:s==null?void 0:s.memorySnapshots,usageCollector:N=>d.push(N)});if(m.length===0)return{plans:[],warnings:o,telemetry:d};const f={fileName:"sample",data:e},y=m.map(N=>{try{const E=O_(f,N);return E.length>0?{plan:N,aggregatedSample:E.slice(0,20)}:null}catch(E){return console.warn(`Execution of plan "${N.title}" failed during review stage:`,E),null}}).filter(N=>N!==null),{viablePlans:S,warnings:_}=lL(y,u);if(_.forEach(N=>o.push(N)),S.length===0)return console.warn("No candidate plans produced high-value samples, returning initial valid candidates."),{plans:m.slice(0,4),warnings:o,telemetry:d};let C=await uL(S,n,t,{signal:s==null?void 0:s.signal,memorySnapshots:s==null?void 0:s.memorySnapshots,usageCollector:N=>d.push(N)});if(C.length<4&&m.length>C.length){const N=new Set(C.map(B=>B.title)),E=m.filter(B=>!N.has(B.title)),L=4-C.length;C.push(...E.slice(0,L))}return{plans:C.slice(0,12),warnings:o,telemetry:d}};class jb extends Error{constructor(e,n,s){super(e),this.name="PlanGenerationFatalError",this.warnings=n,s&&(this.cause=s)}}const dL=async(t,e,n,s)=>{if(!(n.provider==="google"&&!!n.geminiApiKey||n.provider==="openai"&&!!n.openAIApiKey))throw new Error("API Key not provided.");const o=[];try{const{plans:u,warnings:d,telemetry:m}=await cL(t,e,n,s);return o.push(...d),{plans:u,warnings:o,telemetry:m}}catch(u){const d=u instanceof co,m=d?"AI plan response was not valid JSON. Retrying with a simpler generator.":"AI plan generator failed on the first attempt. Retrying with a simpler prompt.";o.push({code:d?"plan_parse_error":"plan_generation_error",message:m,hint:"If this happens repeatedly, ask the assistant to retry with fewer plans."}),console.warn("Plan generation warning:",u);try{const f=[];return{plans:await zb(t,e,n,8,{signal:s==null?void 0:s.signal,memorySnapshots:s==null?void 0:s.memorySnapshots,usageCollector:S=>f.push(S)}),warnings:o,telemetry:f}}catch(f){throw console.error("Fallback plan generation also failed:",f),new jb("Failed to generate any analysis plans from AI.",o,f)}}};class jm{constructor(){this.seq=0,this.lastEpoch=0}mint(e=Date.now(),n){const s=e>this.lastEpoch?e:this.lastEpoch;return s!==this.lastEpoch&&(this.seq=0,this.lastEpoch=s),this.seq+=1,`${s.toString().padStart(13,"0")}-${this.seq}`}}const fL=t=>t.actions.some(e=>{var s;if(e.responseType!=="execute_js_code")return!1;const n=(s=e.code)==null?void 0:s.jsFunctionBody;return!n||n.trim().length===0}),pL=new jm,mL=`Example JSON response (plan_state_update + text acknowledgement):
\`\`\`json
{
  "actions": [
    {
      "type": "plan_state_update",
      "responseType": "plan_state_update",
      "stepId": "plan-init",
      "stateTag": "1731234567890-1",
      "timestamp": "2024-05-18T09:00:00.000Z",
      "reason": "Restating the plan so the UI stays in sync.",
      "planState": {
        "planId": "plan-abc123",
        "goal": "Compare revenue vs. orders by channel.",
        "contextSummary": "User asked for the top-performing channels in 2024.",
        "progress": "Ready to build the comparison card.",
        "blockedBy": null,
        "observationIds": [],
        "confidence": 0.65,
        "updatedAt": "2024-05-18T09:00:00.000Z",
        "currentStepId": "plan-init",
        "nextSteps": [{ "id": "plan-init", "label": "Draft comparison plan", "status": "in_progress" }],
        "steps": [{ "id": "plan-init", "label": "Draft comparison plan", "status": "in_progress" }],
        "stateTag": "1731234567890-1"
      }
    },
    {
      "type": "text_response",
      "responseType": "text_response",
      "stepId": "plan-init",
      "stateTag": "1731234567890-2",
      "timestamp": "2024-05-18T09:00:05.000Z",
      "reason": "Let the user know I captured the plan.",
      "text": "Plan updatedready when you are to proceed with the channel comparison."
    }
  ]
}
\`\`\``,hL=async(t,e,n,s,i,o,u,d,m,f,y,S,_,T,C)=>{if(!(i.provider==="google"&&!!i.geminiApiKey||i.provider==="openai"&&!!i.openAIApiKey))return{actions:[{type:"text_response",responseType:"text_response",stepId:"ad_hoc_response",stateTag:pL.mint(Date.now(),"fallback"),text:"Cloud AI is disabled. API Key not provided.",reason:"API key is missing, so I must inform the user."}]};try{const E=(C==null?void 0:C.mode)??"full",L=E==="full"?C==null?void 0:C.promptStage:void 0,B=E==="plan_only"?"chat.plan_only":"chat.full",O=E==="plan_only"?Y2(t,e,n,i.language,o,m,f,s):L?(Array.isArray(L)?L:[L]).map(R=>K2(R,t,e,n,s,i.language,o,d,m,f,y,S,_,T)).join(`

`):J2(t,e,n,s,i.language,o,d,m,f,y,S,_,T);if(C!=null&&C.onPromptProfile){const R=E==="full"&&L?Array.isArray(L)?L.join("+"):L:null,P=E==="plan_only"?"chat_plan_primer":`chat_full${R?`_stage_${R}`:""}`,A=O.length,k=Math.ceil(A/4);C.onPromptProfile({mode:E,charCount:A,estimatedTokens:k,promptLabel:P})}const x=`You are an expert data analyst and business strategist, required to operate using a Reason-Act (ReAct) framework. For every action you take, you must first explain your reasoning in the 'reason' field, and then define the action itself. Keep each reason under 280 characters (ideally two sentences or fewer) and tie it to the plan step you're executing. You also maintain an explicit goal tracker by emitting a 'plan_state_update' action at the start of each response (and whenever the mission changes) so the UI can display your progress. Every action JSON object must include \`type\`, \`responseType\`, \`stepId\`, a monotonic \`stateTag\` formatted as "<epochMs>-<seq>" (or a known label like \`awaiting_clarification\`), **and** a \`timestamp\` string in ISO-8601 format. The plan_state_update payload must include \`planId\`, \`currentStepId\`, and a \`steps\` array (each entry with intent + status). Emit at most two actions per response: the plan_state_update plus a single atomic action. Your final conversational responses should be in ${i.language}.
${mL}
Your output MUST be a single JSON object with an "actions" key containing an array of action objects.`,I=i.provider==="openai"?2:1;let D="";for(let R=0;R<I;R++){let P;if(i.provider==="openai"){const U=[{role:"system",content:`${x}${D}`},{role:"user",content:O}];P=await Yn(i,U,{name:"MultiActionResponse",schema:k2,strict:!0},{signal:C==null?void 0:C.signal,operation:B,onUsage:z=>{var oe;return(oe=C==null?void 0:C.onUsage)==null?void 0:oe.call(C,{...z,operation:B})}})}else P=await Jn(i,O,qb,{signal:C==null?void 0:C.signal,operation:B,onUsage:F=>{var U;return(U=C==null?void 0:C.onUsage)==null?void 0:U.call(C,{...F,operation:B})}});const A=JSON.parse(P);if(!A.actions||!Array.isArray(A.actions))throw new Error("Invalid response structure from AI: 'actions' array not found.");if(i.provider==="openai"&&fL(A)&&R<I-1){D=`
IMPORTANT VALIDATION FAILURE: Your previous response included an action with responseType=execute_js_code but did not include a valid code.jsFunctionBody. You must respond with executable JavaScript that mutates the provided data and returns the updated array (including an explicit return statement). Provide only valid JSON matching the required schema.`;continue}return A}throw new Error("Failed to obtain a valid AI response after retries.")}catch(E){throw console.error("Error generating chat response:",E),new Error(`Failed to get a valid response from the AI. ${E instanceof Error?E.message:""}`)}},gL=async(t,e,n,s,i)=>{var u,d;let o;for(let m=0;m<2;m++){if((u=i==null?void 0:i.signal)!=null&&u.aborted)throw new DOMException("Aborted","AbortError");try{let f;const y=B2(t,e,n),S="filter.generate";s.provider==="openai"?f=await Yn(s,[{role:"system",content:"You are an expert data analyst. Your task is to convert a user's natural language query into a JavaScript filter function body for a dataset. You MUST respond with a single valid JSON object, and nothing else. The JSON object must adhere to the provided schema."},{role:"user",content:y}],{name:"FilterFunctionResponse",schema:D2,strict:!0},{signal:i==null?void 0:i.signal,operation:S,onUsage:N=>{var E;return(E=i==null?void 0:i.onUsage)==null?void 0:E.call(i,{...N,operation:S})}}):f=await Jn(s,y,Ub,{signal:i==null?void 0:i.signal,operation:S,onUsage:T=>{var C;return(C=i==null?void 0:i.onUsage)==null?void 0:C.call(i,{...T,operation:S})}});const _=JSON.parse(f);if(_.jsFunctionBody&&_.explanation)return _;throw new Error("AI response was missing required fields 'jsFunctionBody' or 'explanation'.")}catch(f){if((d=i==null?void 0:i.signal)!=null&&d.aborted)throw f;console.error(`Error in filter function generation (Attempt ${m+1}):`,f),o=f}}throw new Error(`AI failed to generate a valid filter function. Last error: ${o==null?void 0:o.message}`)},yL=async(t,e,n,s)=>{if(!(n.provider==="google"&&!!n.geminiApiKey||n.provider==="openai"&&!!n.openAIApiKey))return"AI Summaries are disabled. No API Key provided.";try{const o=H2(t,e,n.language),u="summary.generate";return n.provider==="openai"?await Yn(n,[{role:"system",content:'You are a business intelligence analyst. Your response must be only the summary text in the specified format. The summary should highlight key trends, outliers, or business implications. Do not just describe the data; interpret its meaning. For example, instead of "Region A has 500 sales", say "Region A is the top performer, contributing the majority of sales, which suggests a strong market presence there."'},{role:"user",content:o}],!1,{signal:s==null?void 0:s.signal,operation:u,onUsage:f=>{var y;return(y=s==null?void 0:s.onUsage)==null?void 0:y.call(s,{...f,operation:u})}})||"No summary generated.":await Jn(n,o,void 0,{signal:s==null?void 0:s.signal,operation:u,onUsage:d=>{var m;return(m=s==null?void 0:s.onUsage)==null?void 0:m.call(s,{...d,operation:u})}})}catch(o){return console.error("Error generating summary:",o),"Failed to generate AI summary."}},vL=async(t,e,n,s)=>{if(!(n.provider==="google"&&!!n.geminiApiKey||n.provider==="openai"&&!!n.openAIApiKey)||t.length===0)return"Could not generate an initial analysis summary.";try{const o=G2(t,e,n.language),u="summary.core_analysis";if(n.provider==="openai"){const m=[{role:"system",content:`You are a senior data analyst. After performing an initial automated analysis of a dataset, your task is to create a concise "Core Analysis Briefing". This briefing will be shown to the user and will serve as the shared foundation of understanding for your conversation.
Your briefing should cover:
1.  **Primary Subject**: What is this data fundamentally about? (e.g., "This dataset appears to be about online sales transactions...")
2.  **Key Metrics**: What are the most important numerical columns? (e.g., "...where the key metrics are 'Sale_Amount' and 'Profit'.")
3.  **Core Dimensions**: What are the main categorical columns used for analysis? (e.g., "The data is primarily broken down by 'Region' and 'Product_Category'.")
4.  **Suggested Focus**: Based on the initial charts, what should be the focus of further analysis? (e.g., "Future analysis should focus on identifying the most profitable regions and product categories.")
Produce a single, concise paragraph in ${n.language}. This is your initial assessment that you will share with your human counterpart.`},{role:"user",content:o}];return await Yn(n,m,!1,{signal:s==null?void 0:s.signal,operation:u,onUsage:f=>{var y;return(y=s==null?void 0:s.onUsage)==null?void 0:y.call(s,{...f,operation:u})}})||"No summary generated."}else return await Jn(n,o,void 0,{signal:s==null?void 0:s.signal,operation:u,onUsage:d=>{var m;return(m=s==null?void 0:s.onUsage)==null?void 0:m.call(s,{...d,operation:u})}})}catch(o){return console.error("Error generating core analysis summary:",o),"An error occurred while the AI was forming its initial analysis."}},SL=async(t,e,n)=>{if(!(e.provider==="google"&&!!e.geminiApiKey||e.provider==="openai"&&!!e.openAIApiKey)||t.length===0)return null;try{let i;const o=V2(t,e.language),u="summary.proactive_insight";return e.provider==="openai"?i=await Yn(e,[{role:"system",content:"You are a proactive data analyst. Review the following summaries of data visualizations. Your task is to identify the single most commercially significant or surprising insight. This could be a major trend, a key outlier, or a dominant category that has clear business implications. Your response must be a single JSON object with 'insight' and 'cardId' keys."},{role:"user",content:o}],{name:"ProactiveInsight",schema:L2,strict:!0},{signal:n==null?void 0:n.signal,operation:u,onUsage:f=>{var y;return(y=n==null?void 0:n.onUsage)==null?void 0:y.call(n,{...f,operation:u})}}):i=await Jn(e,o,Ob,{signal:n==null?void 0:n.signal,operation:u,onUsage:d=>{var m;return(m=n==null?void 0:n.onUsage)==null?void 0:m.call(n,{...d,operation:u})}}),JSON.parse(i)}catch(i){return console.error("Error generating proactive insight:",i),null}},bw=async(t,e,n)=>{if(!(e.provider==="google"&&!!e.geminiApiKey||e.provider==="openai"&&!!e.openAIApiKey))return"AI Summaries are disabled. No API Key provided.";const i=t.map(o=>{const u=o.summary.split("---")[0];return`Chart Title: ${o.plan.title}
Summary: ${u}`}).join(`

`);try{const o=z2(i,e.language),u="summary.final";if(e.provider==="openai"){const m=[{role:"system",content:`You are a senior business strategist. You have been provided with several automated data analyses.
Your task is to synthesize these individual findings into a single, high-level executive summary in ${e.language}.
Please provide a concise, overarching summary that connects the dots between these analyses. 
Identify the most critical business insights, potential opportunities, or risks revealed by the data as a whole.
Do not just repeat the individual summaries. Create a new, synthesized narrative.
Your response should be a single paragraph of insightful business analysis.`},{role:"user",content:o}];return await Yn(e,m,!1,{signal:n==null?void 0:n.signal,operation:u,onUsage:f=>{var y;return(y=n==null?void 0:n.onUsage)==null?void 0:y.call(n,{...f,operation:u})}})||"No final summary generated."}else return await Jn(e,o,void 0,{signal:n==null?void 0:n.signal,operation:u,onUsage:d=>{var m;return(m=n==null?void 0:n.onUsage)==null?void 0:m.call(n,{...d,operation:u})}})}catch(o){return console.error("Error generating final summary:",o),"Failed to generate the final AI summary."}},du=t=>t.slice(-6).map(n=>`${n.sender==="ai"?"AI":"User"}: ${n.text}`).join(`
`),wL=async(t,e,n)=>{if(t.length===0)return"";const s=j2(t,e.language),i="memory.conversation_summary";if(!(e.provider==="google"&&!!e.geminiApiKey||e.provider==="openai"&&!!e.openAIApiKey))return du(t);try{if(e.provider==="openai"){const m=[{role:"system",content:`You compress conversations between a user and an AI analyst into concise memory notes.
Each response must:
- Contain 23 bullet points summarizing the decisions or insights.
- List outstanding questions or promised follow-ups.
- Mention roughly when in the conversation this occurred (e.g., "Early discussion").
Return plain text in ${e.language}.`},{role:"user",content:s}];return await Yn(e,m,!1,{signal:n==null?void 0:n.signal,operation:i,onUsage:y=>{var S;return(S=n==null?void 0:n.onUsage)==null?void 0:S.call(n,{...y,operation:i})}})||""||du(t)}return await Jn(e,s,void 0,{signal:n==null?void 0:n.signal,operation:i,onUsage:d=>{var m;return(m=n==null?void 0:n.onUsage)==null?void 0:m.call(n,{...d,operation:i})}})||du(t)}catch(u){return console.error("Failed to generate conversation memory summary:",u),du(t)}},Lp=(t,e)=>e.some(n=>t instanceof n);let Tw,Cw;function _L(){return Tw||(Tw=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function xL(){return Cw||(Cw=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const kp=new WeakMap,Yf=new WeakMap,rc=new WeakMap;function bL(t){const e=new Promise((n,s)=>{const i=()=>{t.removeEventListener("success",o),t.removeEventListener("error",u)},o=()=>{n(Oa(t.result)),i()},u=()=>{s(t.error),i()};t.addEventListener("success",o),t.addEventListener("error",u)});return rc.set(e,t),e}function TL(t){if(kp.has(t))return;const e=new Promise((n,s)=>{const i=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",u),t.removeEventListener("abort",u)},o=()=>{n(),i()},u=()=>{s(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",o),t.addEventListener("error",u),t.addEventListener("abort",u)});kp.set(t,e)}let Up={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return kp.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Oa(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function Yb(t){Up=t(Up)}function CL(t){return xL().includes(t)?function(...e){return t.apply(Op(this),e),Oa(this.request)}:function(...e){return Oa(t.apply(Op(this),e))}}function AL(t){return typeof t=="function"?CL(t):(t instanceof IDBTransaction&&TL(t),Lp(t,_L())?new Proxy(t,Up):t)}function Oa(t){if(t instanceof IDBRequest)return bL(t);if(Yf.has(t))return Yf.get(t);const e=AL(t);return e!==t&&(Yf.set(t,e),rc.set(e,t)),e}const Op=t=>rc.get(t);function Ym(t,e,{blocked:n,upgrade:s,blocking:i,terminated:o}={}){const u=indexedDB.open(t,e),d=Oa(u);return s&&u.addEventListener("upgradeneeded",m=>{s(Oa(u.result),m.oldVersion,m.newVersion,Oa(u.transaction),m)}),n&&u.addEventListener("blocked",m=>n(m.oldVersion,m.newVersion,m)),d.then(m=>{o&&m.addEventListener("close",()=>o()),i&&m.addEventListener("versionchange",f=>i(f.oldVersion,f.newVersion,f))}).catch(()=>{}),d}const EL=["get","getKey","getAll","getAllKeys","count"],NL=["put","add","delete","clear"],Jf=new Map;function Aw(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Jf.get(e))return Jf.get(e);const n=e.replace(/FromIndex$/,""),s=e!==n,i=NL.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!(i||EL.includes(n)))return;const o=async function(u,...d){const m=this.transaction(u,i?"readwrite":"readonly");let f=m.store;return s&&(f=f.index(d.shift())),(await Promise.all([f[n](...d),i&&m.done]))[0]};return Jf.set(e,o),o}Yb(t=>({...t,get:(e,n,s)=>Aw(e,n)||t.get(e,n,s),has:(e,n)=>!!Aw(e,n)||t.has(e,n)}));const IL=["continue","continuePrimaryKey","advance"],Ew={},qp=new WeakMap,Jb=new WeakMap,RL={get(t,e){if(!IL.includes(e))return t[e];let n=Ew[e];return n||(n=Ew[e]=function(...s){qp.set(this,Jb.get(this)[e](...s))}),n}};async function*ML(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;const n=new Proxy(e,RL);for(Jb.set(n,e),rc.set(n,Op(e));e;)yield n,e=await(qp.get(n)||e.continue()),qp.delete(n)}function Nw(t,e){return e===Symbol.asyncIterator&&Lp(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&Lp(t,[IDBIndex,IDBObjectStore])}Yb(t=>({...t,get(e,n,s){return Nw(e,n)?ML:t.get(e,n,s)},has(e,n){return Nw(e,n)||t.has(e,n)}}));const PL={showNewButton:!0,showSettingsButton:!0},Kf=t=>{if(typeof t!="string")return;const e=t.trim();return e.length?e:void 0},DL=t=>{if(typeof t!="string")return;const e=t.trim().toLowerCase();if(e==="google")return"google";if(e==="openai")return"openai"},LL=t=>{if(typeof t!="string")return;switch(t.trim().toLowerCase()){case"english":return"English";case"mandarin":return"Mandarin";case"spanish":return"Spanish";case"japanese":return"Japanese";case"french":return"French";default:return}},Iw=t=>{if(typeof t=="boolean")return t;if(typeof t!="string")return;const e=t.trim().toLowerCase();if(["y","yes","true","1"].includes(e))return!0;if(["n","no","false","0"].includes(e))return!1},Kb=()=>typeof window>"u"?{}:window.__CSV_AGENT_DEFAULTS__??{},kL=()=>{if(typeof window>"u")return{};const t={},e=Kf(window.tempGeminiApiKey??window.tempgeminiapikey);e&&(t.geminiApiKey=e);const n=Kf(window.tempOpenAIApiKey??window.tempopenaiapikey);n&&(t.openAIApiKey=n);const s=DL(window.tempProvider??window.tempprovider);s&&(t.provider=s);const i=Kf(window.tempModel??window.tempmodel);i&&(t.model=i);const o=LL(window.tempLanguage??window.templanguage);return o&&(t.language=o),t},UL=()=>{if(typeof window>"u")return{};const t={},e=Iw(window.tempShowNewButton??window.tempshownewbutton);typeof e=="boolean"&&(t.showNewButton=e);const n=Iw(window.tempShowSettingsButton??window.tempshowsettingsbutton);return typeof n=="boolean"&&(t.showSettingsButton=n),t},OL=()=>({...Kb().defaultSettings??{},...kL()}),Xb=()=>{const t=Kb().ui??{};return{...PL,...t,...UL()}},Qb="csv-ai-assistant-db",qL=3,qa="reports",Wb="csv-ai-assistant-settings",sa="current_session";let Xf=null;const BL=()=>new Promise((t,e)=>{const n=indexedDB.deleteDatabase(Qb);n.onsuccess=()=>t(),n.onerror=()=>e(n.error),n.onblocked=()=>{console.warn("IndexedDB delete is blocked. Close other tabs to complete reset.")}}),Rw=()=>Ym(Qb,qL,{upgrade(t,e){if(!t.objectStoreNames.contains(qa)){t.createObjectStore(qa,{keyPath:"id"}).createIndex("updatedAt","updatedAt");return}const n=t.transaction.objectStore(qa);e<2&&!n.indexNames.contains("updatedAt")&&n.createIndex("updatedAt","updatedAt")}}),ic=()=>(Xf||(Xf=Rw().catch(async t=>{if(t instanceof DOMException&&t.name==="VersionError")return console.warn("IndexedDB version mismatch detected. Resetting local database...",t),await BL(),Rw();throw t})),Xf),Bp=async t=>{await(await ic()).put(qa,t)},wo=async t=>{try{return await(await ic()).get(qa,t)}catch(e){console.error("Failed to get report from IndexedDB:",e);return}},FL=async()=>{try{return(await(await ic()).getAllFromIndex(qa,"updatedAt")).sort((n,s)=>s.updatedAt.getTime()-n.updatedAt.getTime()).map(({id:n,filename:s,createdAt:i,updatedAt:o})=>({id:n,filename:s,createdAt:i,updatedAt:o}))}catch(t){return console.error("Failed to get reports list from IndexedDB:",t),[]}},Fp=async t=>{try{await(await ic()).delete(qa,t)}catch(e){console.error("Failed to delete report from IndexedDB:",e)}},$L={provider:"google",geminiApiKey:"",openAIApiKey:"",model:"gemini-2.5-pro",language:"English",autoSaveEnabled:!0,autoSaveIntervalSeconds:15},Mw=()=>({...$L,...OL()}),HL=t=>{try{localStorage.setItem(Wb,JSON.stringify(t))}catch(e){console.error("Failed to save settings to localStorage:",e)}},Pw=()=>{try{const t=localStorage.getItem(Wb);if(t){const e=JSON.parse(t);return e.apiKey&&delete e.apiKey,{...Mw(),...e}}}catch(t){console.error("Failed to get settings from localStorage:",t)}return Mw()};let Qf=null;const GL=async()=>(Qf||(Qf=(async()=>{const t="https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.1/dist/transformers.min.js";try{return await import(t)}catch(e){throw console.error("Failed to load @xenova/transformers from CDN.",e),e}})()),Qf);class $r{constructor(){this.embedder=null,this.documents=[],this.isInitializing=!1,this.isInitialized=!1}static getInstance(){return $r.instance||($r.instance=new $r),$r.instance}getIsInitialized(){return this.isInitialized}async init(e){if(!(this.isInitialized||this.isInitializing))try{this.isInitializing=!0;const{pipeline:n,env:s}=await GL();s.allowRemoteModels=!0,s.allowLocalModels=!0,s.useBrowserCache=!0,s.cacheDir=s.cacheDir||"indexeddb://ai-memory-models",s.localModelPath=s.localModelPath||"indexeddb://ai-memory-models",e==null||e("Loading AI memory model (~34MB). We'll cache it locally after the first download."),this.embedder=await n("feature-extraction","Xenova/all-MiniLM-L6-v2",{progress_callback:i=>{if(i.status==="progress"&&i.total>0){const o=(i.loaded/1024/1024).toFixed(2),u=(i.total/1024/1024).toFixed(2);e==null||e(`Downloading AI memory model: ${o}MB / ${u}MB`)}}}),e==null||e("AI memory model ready (cached locally for future sessions)."),this.isInitialized=!0}catch(n){console.error("Failed to initialize vector store:",n),e==null||e(`Error loading AI memory model: ${n instanceof Error?n.message:String(n)}`),this.isInitialized=!1}finally{this.isInitializing=!1}}rehydrate(e){this.documents=e}async addDocument(e){if(!this.embedder){console.warn("Vector store not initialized. Skipping document add/update.");return}try{const n=await this.embedder(e.text,{pooling:"mean",normalize:!0}),s={...e,embedding:Array.from(n.data)},i=this.documents.findIndex(o=>o.id===e.id);i>-1?this.documents[i]=s:this.documents.push(s)}catch(n){console.error(`Failed to create embedding for document ${e.id}:`,n)}}deleteDocument(e){const n=this.documents.length;return this.documents=this.documents.filter(s=>s.id!==e),this.documents.length<n}getDocumentCount(){return this.documents.length}getDocuments(){return[...this.documents]}clear(){this.documents=[]}async withAbort(e,n){if(!n)return e;if(n.aborted)throw new DOMException("Aborted","AbortError");return new Promise((s,i)=>{const o=()=>{n.removeEventListener("abort",o),i(new DOMException("Aborted","AbortError"))};n.addEventListener("abort",o),e.then(u=>{n.removeEventListener("abort",o),s(u)},u=>{n.removeEventListener("abort",o),i(u)})})}async search(e,n=5,s){if(!this.embedder||this.documents.length===0)return[];try{const i=await this.withAbort(this.embedder(e,{pooling:"mean",normalize:!0}),s==null?void 0:s.signal),o=Array.from(i.data);return this.documents.map(d=>{const m=this.cosineSimilarity(o,d.embedding);return{id:d.id,text:d.text,score:m}}).filter(d=>d.score>.5).sort((d,m)=>m.score-d.score).slice(0,n)}catch(i){return console.error("Failed to perform vector search:",i),[]}}cosineSimilarity(e,n){let s=0,i=0,o=0;for(let u=0;u<e.length;u++)s+=e[u]*n[u],i+=e[u]*e[u],o+=n[u]*n[u];return i===0||o===0?0:s/(Math.sqrt(i)*Math.sqrt(o))}}const Ke=$r.getInstance(),$p=async(t,e,n,s={})=>{const i=!!s.runId,o=s.runId??t.beginBusy(e,{cancellable:s.cancellable});try{return await n(o)}finally{i||t.endBusy(o)}},Dw=["categorical","date","time"],VL=(t,e,n=500)=>{if(!t.length)return 0;const s=new Set,i=Math.min(t.length,n);for(let o=0;o<i;o++){const u=t[o][e];if(u==null)continue;const d=String(u).trim();if(d&&(s.add(d),s.size>200))break}return s.size},Jm=(t,e)=>{if(!t.length)return[];const n=t.map(i=>({profile:i,uniqueValues:typeof i.uniqueValues=="number"?i.uniqueValues:VL(e,i.name)})),s=n.filter(({profile:i,uniqueValues:o})=>o>1&&(Dw.includes(i.type)||o<=50)).sort((i,o)=>{const u=_=>Dw.includes(_)?0:1,d=u(i.profile.type),m=u(o.profile.type);if(d!==m)return d-m;const f=12,y=Math.abs((i.uniqueValues||100)-f),S=Math.abs((o.uniqueValues||100)-f);return y-S});return s.length>0?s:n.filter(i=>(i.uniqueValues||0)>1)},Zb=(t,e)=>{const n=Jm(t,e);return n.length?{column:n[0].profile.name,inferred:!0}:{column:null,inferred:!1}},zL=["sum","count","avg"],jL=25,eT=t=>t.toLowerCase().replace(/[^a-z0-9]+/g,""),Lw=(t,e,n)=>{if(!e)return;const s=t.get(e)??[];s.includes(n)||(s.push(n),t.set(e,s))},YL=(t,e)=>{const n=new Set;t.forEach(o=>{o!=null&&o.name&&n.add(o.name)});for(let o=0;o<Math.min(e.length,jL);o++)Object.keys(e[o]??{}).forEach(u=>n.add(u));const s=new Map,i=new Map;return n.forEach(o=>{Lw(s,o.toLowerCase(),o),Lw(i,eT(o),o)}),{exact:n,caseInsensitive:s,normalized:i}},tT=(t,e)=>{if(!t)return{};if(e.exact.has(t))return{resolved:t};const n=e.caseInsensitive.get(t.toLowerCase());if(n&&n.length===1)return{resolved:n[0]};const s=eT(t);if(s){const i=e.normalized.get(s);if(i&&i.length===1)return{resolved:i[0]};if(i&&i.length>1)return{ambiguous:i}}return{}},JL=(t,e)=>{if(t){const s=t.toLowerCase();if(zL.includes(s))return{value:s,inferred:!1}}return{value:e?"sum":"count",inferred:!0}},eo=(t,e,n,s)=>{const i=t[e];if(!i||typeof i!="string")return{success:!0};const o=tT(i,n);return o.ambiguous&&o.ambiguous.length>1?{success:!1,errorMessage:`Column "${i}" is ambiguous. Choose one of: ${o.ambiguous.join(", ")}.`}:o.resolved?(o.resolved!==i&&(t[e]=o.resolved,s.push(`Normalized column "${i}" to "${o.resolved}".`)),{success:!0}):{success:!1,errorMessage:`Column "${i}" was not found in this dataset.`}},KL=(t,e,n)=>{const s={...t},i=[],o=YL(e,n);if(s.chartType==="scatter"){if(!s.xValueColumn||!s.yValueColumn)return{plan:s,warnings:i,isValid:!1,errorMessage:"Scatter plot plan is missing xValueColumn or yValueColumn."};const y=eo(s,"xValueColumn",o,i);if(!y.success)return{plan:s,warnings:i,isValid:!1,errorMessage:y.errorMessage};const S=eo(s,"yValueColumn",o,i);return S.success?{plan:s,warnings:i,isValid:!0}:{plan:s,warnings:i,isValid:!1,errorMessage:S.errorMessage}}if(!n.length)return{plan:s,warnings:i,isValid:!1,errorMessage:"Dataset appears empty for analysis."};const u=JL(s.aggregation,!!s.valueColumn);if(u.inferred?(s.aggregation=u.value,i.push(`AI plan missing aggregation; defaulting to ${u.value}.`)):s.aggregation=u.value,s.aggregation!=="count"&&!s.valueColumn&&(s.aggregation="count",i.push("Value column missing for sum/avg; using count aggregation instead.")),s.chartType==="combo"){if(!s.valueColumn||!s.secondaryValueColumn)return{plan:s,warnings:i,isValid:!1,errorMessage:"Combo chart requires both valueColumn and secondaryValueColumn."};s.secondaryAggregation||(s.secondaryAggregation=s.aggregation??"sum",i.push("Secondary aggregation missing; mirroring primary aggregation."))}const d=!s.valueColumn||s.aggregation==="count"?"count":s.valueColumn;if(!s.groupByColumn){const y=Zb(e,n);if(y.column)s.groupByColumn=y.column,i.push(`AI plan missing grouping; defaulting to "${y.column}".`);else return{plan:s,warnings:i,isValid:!1,errorMessage:"Unable to infer a grouping column for this chart."}}const m=eo(s,"groupByColumn",o,i);if(!m.success)return{plan:s,warnings:i,isValid:!1,errorMessage:m.errorMessage};const f=eo(s,"valueColumn",o,i);if(!f.success)return{plan:s,warnings:i,isValid:!1,errorMessage:f.errorMessage};if(s.chartType==="combo"){const y=eo(s,"secondaryValueColumn",o,i);if(!y.success)return{plan:s,warnings:i,isValid:!1,errorMessage:y.errorMessage}}if(!Array.isArray(s.orderBy)||s.orderBy.length===0?s.chartType==="line"&&s.groupByColumn?s.orderBy=[{column:s.groupByColumn,direction:"asc"}]:s.orderBy=[{column:d,direction:"desc"}]:s.orderBy=s.orderBy.map(y=>({column:y.column,direction:y.direction??(s.chartType==="line"?"asc":"desc")})),typeof s.limit!="number"&&typeof s.defaultTopN=="number"&&(s.limit=s.defaultTopN),s.rowFilter){const y=s.rowFilter.column;let S=y??null;if(y){const C=tT(y,o);if(C.ambiguous&&C.ambiguous.length>1)return{plan:s,warnings:i,isValid:!1,errorMessage:`Row filter column "${y}" is ambiguous. Options: ${C.ambiguous.join(", ")}.`};if(!C.resolved)return{plan:s,warnings:i,isValid:!1,errorMessage:`Row filter references missing column "${y}".`};C.resolved!==y&&(S=C.resolved,i.push(`Row filter column "${y}" normalized to "${S}".`))}const _=S?o.exact.has(S):!1,T=Array.isArray(s.rowFilter.values)&&s.rowFilter.values.length>0;if(!y||!_||!T){const C=[];y?_||C.push(`column "${y}" not found`):C.push("missing column"),T||C.push("no filter values provided");const N=C.length?` (${C.join(", ")})`:"";i.push(`Row filter invalid${N}; removing filter.`),delete s.rowFilter}else S&&s.rowFilter.column!==S&&(s.rowFilter.column=S)}return{plan:s,warnings:i,isValid:!0}},XL=t=>t.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,""),QL=t=>{const e=new Set,n=XL(t);n&&n!==t&&e.add(n);const s=n.match(/^[a-z]\d?_(.+)$/);return s&&s[1]&&e.add(s[1]),n.includes("__")&&e.add(n.replace(/_+/g,"_")),n.startsWith("column_")&&e.add(n.replace(/^column_/,"")),Array.from(e).filter(Boolean)},_o=t=>{const e={};return t.forEach(n=>{QL(n).forEach(i=>{e[i]||(e[i]=n)})}),e},WL=(t,e)=>{const n=Object.entries(e);return n.length===0?t:t.map(s=>{const i={...s};for(const[o,u]of n)!(o in i)&&i[u]!==void 0&&(i[o]=i[u]);return i})},ZL=(t,e)=>{const n=Object.entries(e);return n.length===0?t:t.map(s=>{const i={...s};for(const[o,u]of n)Object.prototype.hasOwnProperty.call(i,o)&&(Object.prototype.hasOwnProperty.call(i,u)||(i[u]=i[o]),delete i[o]);return i})},kw=t=>t.toLowerCase().replace(/[_-]+/g," ").replace(/[^a-z0-9 ]/g," ").replace(/\s+/g," ").trim(),xo=["groupByColumn","valueColumn","xValueColumn","yValueColumn","secondaryValueColumn"],Ou=(t,e,n=1,s=1/0)=>{if(!e||e.length===0)return!1;const i=e.map(u=>u[t]).filter(u=>u!=null&&String(u).trim()!=="");if(i.length===0)return!1;const o=new Set(i.map(u=>String(u))).size;return o>=n&&o<=s},nT=(t,e,n)=>{if(!xo.includes(e))return t.value;const s=n.find(u=>u===t.value);if(s)return s;const i=n.find(u=>u.toLowerCase()===t.value.toLowerCase());if(i)return i;const o=kw(t.label);return n.find(u=>o.includes(kw(u)))},ek=(t,e,n,s)=>{var m;if(!xo.includes(t.targetProperty)||!e||e.length===0)return t;const i=((m=s==null?void 0:s.preferredColumns)==null?void 0:m.filter(f=>typeof f=="string"&&f.trim().length>0))??[],o=Array.from(new Set([...n,...i])),u=new Set(t.columnHints??[]),d=t.options.map(f=>{const y=nT(f,t.targetProperty,o);if(!y)return null;u.add(y);const S=i.includes(y);if(t.targetProperty==="groupByColumn"){if(!Ou(y,e,2,S?1/0:50))return null}else if(!Ou(y,e))return null;return{...f,value:y}}).filter(f=>f!==null);return d.length===0?null:{...t,options:d,columnHints:Array.from(u)}},Uw=(t,e)=>{if(!t)return null;const n=e.find(s=>s.name===t);return n?n.name:t},tk=(t,e)=>{const n=Uw(t.valueColumn,e)||(t.aggregation==="count"?"Records":"Value"),s=Uw(t.groupByColumn,e)||(t.chartType==="scatter"?"X Axis":"Category"),i={"[metric]":n,"[value]":n,"[dimension]":s,"[group]":s},o=f=>{if(!f)return!1;const y=f.replace(/\s+/g,"");return/(.{3,20})\1{3,}/i.test(y)},u=(f,y)=>{if(!f||f.trim()==="")return y;let S=f;for(const _ of Object.keys(i)){const T=new RegExp(_,"gi");S=S.replace(T,i[_])}return/\[.*\]/.test(S)||S.length>150||o(S)?y:S.trim()},d=`${n} by ${s}`,m=`A chart showing ${n} grouped by ${s}.`;return{...t,title:u(t.title,d),description:u(t.description,m)}},nk="",sk="",ak="",rk="",ik=t=>{let e=t.trim();return e=e.replace(/^\*\*(.+)\*\*$/,"$1").trim(),e=e.replace(/^\*+/,"").replace(/\*+$/,"").trim(),e=e.replace(/^["']+/,"").replace(/["']+$/,"").trim(),e=e.replace(/\s*\(\s*(?:optional|default)\s*\)\s*$/i,"").trim(),e=e.replace(/[:;]+$/,"").trim(),e},ok=[/^([0-9]+|[A-Za-z])[\.\)\]]\s+(.+)$/,/^([0-9]+|[A-Za-z])[]\s+(.+)$/,/^[(\[]?(?:option|choice)?\s*([0-9]+|[A-Za-z])[\)\]\.:-]\s+(.+)$/i,/^([0-9]+|[A-Za-z])\s*[-]\s+(.+)$/,/^[-]\s*(?:option|choice)?\s*([0-9]+|[A-Za-z])?[:\.\-\)]?\s+(.+)$/i],lk=new RegExp(String.raw`(?:^|\n)\s*(?:[\(\\[]?\s*(?:option|choice)?\s*)?([0-9]+|[A-Za-z])[\)\]\.:-]\s+([^\n]+?)(?=\n|$)`,"gi"),sT=t=>{const e=t.replace(/\r/g,"").replace(new RegExp(nk,"g"),".").replace(new RegExp(sk,"g"),"(").replace(new RegExp(ak,"g"),")").replace(new RegExp(rk,"g"),""),n=e.split(/\n+/).map(o=>o.trim()),s=new Set,i=o=>{if(!o)return;const u=ik(o);!u||u.length<2||u.length>140||s.add(u)};for(const o of n)if(o)for(const u of ok){const d=o.match(u);if(d&&d[2]){i(d[2]);break}}if(s.size===0){let o;for(;(o=lk.exec(e))!==null&&(i(o[2]),!(s.size>=5)););}return Array.from(s).slice(0,5)},aT=["context_ready","needs_clarification","transform_drafted","transform_ready","analysis_shared","awaiting_data","error_retrying","awaiting_clarification"],uk=/(remove|delete)\s+card/i,ck=/(filter|show|find)\s+(all\s+)?(rows|entries|records|data)/i,dk=/(clean|transform|restructure|normalize|standardize|add\s+column|create\s+column|calculate)/i,fk=/(which|what)\s+(column|field|value)/i,pk=/^(hi|hello|hey|hola|ciao|salut|+|||||||)([!.?\s]|$)/i,mk=/(how\s+are\s+you||thanks|thank\s+you|||what'?s\s+up|)/i,hk=/^\s*(?:option|choice)?\s*(?:[1-3]|[abc])(?:[\s.:,-].*)?$/i,gk=(t,e)=>{var s,i;const n=(t||"").trim();if(!n)return{intent:"unknown",confidence:.1};if(pk.test(n))return{intent:"greeting",confidence:.9};if(mk.test(n))return{intent:"smalltalk",confidence:.75};if(hk.test(n))return{intent:"ask_user_choice",confidence:.8};if(uk.test(n)){const o=Array.isArray(e.analysisCards)?e.analysisCards:[],u=n.toLowerCase(),d=o.find(m=>{var y;const f=(y=m==null?void 0:m.plan)==null?void 0:y.title;return typeof f=="string"&&u.includes(f.toLowerCase())});return d?{intent:"remove_card",confidence:.95,requiredTool:{responseType:"dom_action",domToolName:"removeCard",payloadHints:{cardId:d.id,cardTitle:(s=d.plan)==null?void 0:s.title}},payloadHints:(i=d.plan)!=null&&i.title?{cardTitle:d.plan.title}:void 0}:{intent:"remove_card",confidence:.8,requiredTool:null}}return ck.test(n)?{intent:"data_filter",confidence:.75,requiredTool:{responseType:"filter_spreadsheet"},payloadHints:{query:n}}:dk.test(n)?{intent:"data_transform",confidence:.7,requiredTool:{responseType:"execute_js_code"}}:fk.test(n)||n.endsWith("?")?{intent:"clarification",confidence:.6}:{intent:"chart_request",confidence:.4}},yk=[{name:"plan_state_update",description:"Update the shared plan tracker before any other action.",tags:["plan","safe","low_latency"],costEstimate:1,latencyClass:"short",risk:"low"},{name:"text_response",description:"Send a conversational reply to the user and suggest next actions.",tags:["conversation","starter","safe","low_latency"],costEstimate:1,latencyClass:"short",risk:"low"},{name:"dom_action",description:"Modify an existing insight card (highlight, toggle legend, etc.).",tags:["dom","ui"],costEstimate:3,latencyClass:"medium",risk:"medium"},{name:"dom_action.removeCard",description:"Remove an existing chart card by id or title.",tags:["dom","destructive"],costEstimate:4,latencyClass:"medium",risk:"medium",applicableIf:{intentsAny:["remove_card"]}},{name:"filter_spreadsheet",description:"Apply a natural-language filter to the raw data explorer.",tags:["data","tool"],costEstimate:2,latencyClass:"short",risk:"low",applicableIf:{intentsAny:["data_filter"]}},{name:"execute_js_code",description:"Run a JavaScript transform to reshape the dataset.",tags:["data","transform"],costEstimate:5,latencyClass:"long",risk:"high",applicableIf:{intentsAny:["data_transform"]}},{name:"clarification_request",description:"Ask the user to choose between concrete options.",tags:["conversation","safe"],costEstimate:2,latencyClass:"short",risk:"low"},{name:"plan_creation",description:"Create a batch of chart plans for later execution.",tags:["plan","analysis"],costEstimate:4,latencyClass:"medium",risk:"medium"},{name:"proceed_to_analysis",description:"Signal that the AI is ready to summarize results.",tags:["conversation"],costEstimate:1,latencyClass:"short",risk:"low"}],Ow=new Map(yk.map(t=>[t.name,t])),vk=t=>{var n;const e=(t.type??t.responseType??"").trim();if(!e)return"unknown";if(e==="dom_action"){const s=(n=t.domAction)==null?void 0:n.toolName;return s?`${e}.${s}`:e}return e},Sk=t=>{const e=vk(t);return Ow.get(e)??Ow.get(e.split(".")[0])},wk=[{id:"greeting_minimal",intent:"greeting",success_criteria:["user_follow_up"],ui:{message_template:"{{greeting}}I am ready to explore your CSV. Pick a quick action or tell me what to analyze next.",quick_action_rules:[{source:"tools",filter:{tags_any:["starter","safe","low_latency"],context:["idle"]},top_k:5}]},governance:{max_tokens:80,deny_tools_if:{latency_class:["long"],risk:["high"]}}},{id:"remove_card_flow",intent:"remove_card",success_criteria:["card_removed"],ui:{message_template:'Removing the card "{{cardTitle}}" from the dashboard now.'},governance:{deny_tools_if:{risk:["high"]}}}],_k=t=>{if(t)return wk.find(e=>e.intent===t)},qu="ad_hoc_response",xk=["text_response","await_user","plan_creation","dom_action","execute_js_code","proceed_to_analysis","filter_spreadsheet","clarification_request","plan_state_update"],bk={plan_update:"plan_state_update",planstateupdate:"plan_state_update",domaction:"dom_action",agent_action:"text_response",agentaction:"text_response",respond:"text_response"},qw=t=>{if(!t)return null;const e=t.trim().toLowerCase();return e?bk[e]??xk.find(s=>s===e)??null:null},Tk=t=>{var e;return t.domAction?"dom_action":t.code?"execute_js_code":t.plan?"plan_creation":t.args?"filter_spreadsheet":t.clarification?"clarification_request":(e=t.meta)!=null&&e.awaitUser?"await_user":"text_response"},Ck=t=>{const n=qw(t.responseType)??qw(t.type)??Tk(t);return t.type=n,t.responseType=n,n},Ak=(t,e)=>{if(t!=null&&t.currentStepId&&Hp(t.currentStepId))return t.currentStepId.trim();const n=e.find(s=>Hp(s==null?void 0:s.id));return n?n.id.trim():qu},rT=()=>({id:qu,label:"Respond directly to the latest request.",intent:"conversation",status:"ready"}),Hp=t=>typeof t=="string"&&t.trim().length>=3,Bw=t=>{if(!Array.isArray(t))return[];const e=new Set,n=[];for(const s of t){const i=typeof(s==null?void 0:s.id)=="string"?s.id.trim():"",o=typeof(s==null?void 0:s.label)=="string"?s.label.trim():"";if(i.length<3||o.length<3||e.has(i))continue;const u=typeof(s==null?void 0:s.intent)=="string"&&s.intent.trim().length>0?s.intent.trim():s==null?void 0:s.intent,d=(s==null?void 0:s.status)??"ready";n.push({id:i,label:o,intent:u,status:d}),e.add(i)}return n},iT=(t,e)=>{var s;const n=rT();return{planId:`plan-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,6)}`,goal:(s=t.detectedIntent)!=null&&s.intent?`Address user intent: ${t.detectedIntent.intent}`:"Acknowledge the user and clarify analysis goals.",contextSummary:t.userMessage.slice(0,200),progress:"Initialized plan scaffold automatically.",nextSteps:[n],steps:[n],currentStepId:n.id,blockedBy:null,observationIds:[],confidence:.6,updatedAt:new Date(t.now).toISOString(),stateTag:e()}},Fw=(t,e,n)=>{const s=t??iT(e,n);let i=Bw(s.steps),o=Bw(s.nextSteps);o.length===0&&(o=i.length>0?i:[rT()]),i.length===0&&(i=o);let u=Hp(s.currentStepId)?s.currentStepId.trim():o[0].id;return i.some(d=>d.id===u)||(i=[{...o[0],id:u,status:o[0].status??"ready"},...i]),o.some(d=>d.id===u)||(o=[{...i[0],id:u,status:i[0].status??"ready"},...o]),{...s,planId:s.planId??`plan-${Date.now().toString(36)}`,currentStepId:u,nextSteps:o,steps:i,updatedAt:s.updatedAt??new Date().toISOString(),stateTag:s.stateTag??n()}},Ek=(t,e)=>{if(t.responseType!=="dom_action"||!t.domAction)return;const n=t.domAction.args??(t.domAction.args={}),s=t.domAction.target??(t.domAction.target={});!s.byId&&typeof n.cardId=="string"&&(s.byId=n.cardId),!s.byTitle&&typeof n.cardTitle=="string"&&(s.byTitle=n.cardTitle),!s.byId&&!s.byTitle&&!s.selector&&(e.push("DOM payload missing target; downgraded to text response."),t.domAction=void 0,t.responseType="text_response",t.type="text_response",t.text="Target not found, please select.")},Nk=(t,e,n)=>{const s=[...t],i=[],o=[];let u=!1;(()=>{var S;let f=s.findIndex(_=>(_.type??_.responseType)==="plan_state_update");if(f===-1&&(s.unshift({type:"plan_state_update",responseType:"plan_state_update",stepId:qu,stateTag:n("plan"),reason:"Seeding plan tracker automatically.",planState:iT(e,()=>n("plan"))}),u=!0,i.push("Inserted plan_state_update because no active plan was found."),f=0),f>0){const[_]=s.splice(f,1);s.unshift(_),u=!0,i.push("Moved plan_state_update to the beginning of the turn.")}const y=s[0];y.planState=Fw(y.planState,e,()=>n("plan")),y.stepId=y.stepId??((S=y.planState)==null?void 0:S.currentStepId)??qu,y.stateTag||(y.stateTag=n("plan"))})();const m=Ak(e.planState,e.pendingSteps);return s.forEach(f=>{var S;const y=Ck(f);y==="plan_state_update"?(f.planState=Fw(f.planState,e,()=>n("plan")),f.stepId=f.stepId??((S=f.planState)==null?void 0:S.currentStepId)??m):(!f.stepId||f.stepId.trim().length<3)&&(f.stepId=m,u=!0,i.push(`Attached stepId=${m} to ${y}.`)),f.stateTag||(f.stateTag=n(y),u=!0),Ek(f,i)}),{actions:s,report:{mutated:u,notes:i,warnings:o}}},Gp={low:.1,medium:.4,high:.9},Vp={short:.1,medium:.3,long:.7},Ik=(t,e)=>{var n;return t?t==="remove_card"?e.responseType==="dom_action"&&((n=e.domAction)==null?void 0:n.toolName)==="removeCard":t==="data_filter"?e.responseType==="filter_spreadsheet":t==="data_transform"?e.responseType==="execute_js_code":t==="clarification"?e.responseType==="clarification_request":t==="greeting"||t==="smalltalk"||t==="ask_user_choice"?e.responseType==="text_response":!1:!1},Rk=(t,e)=>{var o,u;const n=" hi",s="[Filter Data, Create Chart, Clean Data]",i=((u=(o=e.detectedIntent)==null?void 0:o.payloadHints)==null?void 0:u.cardTitle)??"the selected card";return t.replace(/{{\s*greeting\s*}}/gi,n).replace(/{{\s*quick_actions\s*}}/gi,s).replace(/{{\s*cardTitle\s*}}/gi,i).replace(/{{\s*userMessage\s*}}/gi,e.userMessage)},oT=(t,e)=>{var n;return{type:"text_response",responseType:"text_response",stepId:((n=e.planState)==null?void 0:n.currentStepId)??"ad_hoc_response",reason:`Applying playbook ${t.id} for intent ${t.intent}.`,text:Rk(t.ui.message_template,e)}},Mk=new Set(["greeting","smalltalk","ask_user_choice"]),ra={id:"acknowledge_user_greeting",label:"Acknowledge the greeting and ask what to analyze next.",intent:"conversation",status:"in_progress"},Pk=()=>({planId:null,goal:"Acknowledge the user and gather their request.",contextSummary:"User greeted the assistant; no task has been specified yet.",progress:"Greeting acknowledged.",nextSteps:[ra],steps:[ra],currentStepId:ra.id,blockedBy:null,observationIds:[],confidence:.5,updatedAt:new Date().toISOString(),stateTag:"context_ready"}),Dk=t=>{var n,s,i,o,u,d;const e={...t.planState??Pk(),goal:((n=t.planState)==null?void 0:n.goal)||"Acknowledge the user and gather their request.",contextSummary:((s=t.planState)==null?void 0:s.contextSummary)??"User greeted the assistant; awaiting instructions.",progress:((i=t.planState)==null?void 0:i.progress)||"Greeting acknowledged.",nextSteps:(o=t.planState)!=null&&o.nextSteps&&t.planState.nextSteps.length>0?t.planState.nextSteps:[ra],steps:(u=t.planState)!=null&&u.steps&&t.planState.steps.length>0?t.planState.steps:[ra],currentStepId:((d=t.planState)==null?void 0:d.currentStepId)??ra.id,stateTag:"context_ready",updatedAt:new Date().toISOString()};return{...t,planState:e,stateTag:"context_ready"}},Lk=(t,e,n)=>{var o,u;if(!Mk.has(((o=e.detectedIntent)==null?void 0:o.intent)??""))return t;const s=t.find(d=>d.responseType==="plan_state_update")??{type:"plan_state_update",responseType:"plan_state_update",reason:"Auto-initialized greeting plan tracker.",stepId:((u=e.planState)==null?void 0:u.currentStepId)??ra.id},i=t.find(d=>d.responseType==="text_response")??(n?oT(n,e):{type:"text_response",responseType:"text_response",stepId:s.stepId??ra.id,reason:"Auto-generated greeting response.",text:" CSV "});return[Dk(s),i]},Wf=(t,e,n,s)=>{var S,_;const i=Sk(t),o=t.responseType==="plan_state_update"?1.2:.8,u=Ik((S=e.detectedIntent)==null?void 0:S.intent,t)?.4:0,d=(_=t.reason)!=null&&_.trim()?Math.min(1,.5+t.reason.trim().length/200):.4,m=(i==null?void 0:i.costEstimate)??3,f=Gp[(i==null?void 0:i.risk)??"medium"]??.4,y=Vp[(i==null?void 0:i.latencyClass)??"medium"]??.3;return{action:t,source:n,playbookId:s==null?void 0:s.id,utility:o+u,confidence:d,cost:m,risk:f,latency:y}},kk=t=>t.utility+t.confidence-t.cost*.1-t.risk-t.latency,Uk=(t,e)=>{var i;if(!((i=e==null?void 0:e.governance)!=null&&i.deny_tools_if))return t;const{latency_class:n,risk:s}=e.governance.deny_tools_if;return t.filter(o=>{const u=o.risk,d=o.latency,m=s==null?void 0:s.some(y=>y==="high"&&u>=Gp.high||y==="medium"&&u>=Gp.medium),f=n==null?void 0:n.some(y=>y==="long"&&d>=Vp.long||y==="medium"&&d>=Vp.medium);return!m&&!f})},Ok=(t,e)=>{if(t.length===0)return[];const n=t.map(u=>({...u,score:kk(u)})).sort((u,d)=>(d.score??0)-(u.score??0)),s=n.filter(u=>u.action.responseType==="plan_state_update"),i=n.filter(u=>u.action.responseType!=="plan_state_update"),o=[];return s.length>0&&(!e.planState||s[0].source!=="model")||s.length>0?o.push(s[0].action):!e.planState&&i.length>0&&o.push({type:"plan_state_update",responseType:"plan_state_update",reason:"Auto-initializing plan because model skipped it.",stepId:"ad_hoc_response"}),i.length>0&&o.push(i[0].action),o.slice(0,2)},qk=(t,e)=>{var n;return t.length>0?t:[{type:"text_response",responseType:"text_response",stepId:((n=e.planState)==null?void 0:n.currentStepId)??"ad_hoc_response",reason:"Fallback explanation: no valid actions after governance.",text:"I am ready to helpplease let me know what to analyze or adjust."}]};class Bk{constructor(){this.stateTagFactory=new jm}run(e,n){var m,f;const s=Array.isArray(e.actions)?e.actions:[],i=_k((m=n.detectedIntent)==null?void 0:m.intent);let o=s.map(y=>Wf(y,n,"model"));if(o.length===0&&i){const y=oT(i,n);o.push(Wf(y,n,"playbook",i))}if(i&&o.every(y=>y.action.responseType!=="plan_state_update")){const y={type:"plan_state_update",responseType:"plan_state_update",stepId:((f=n.planState)==null?void 0:f.currentStepId)??"ad_hoc_response",reason:`Playbook ${i.id} requires a plan snapshot.`,planState:n.planState??void 0};o.unshift(Wf(y,n,"playbook",i))}o=Uk(o,i);let u=Ok(o,n);u=Lk(u,n,i),u=qk(u,n);const d=Nk(u,n,y=>this.stateTagFactory.mint(n.now,y));return{...e,actions:d.actions}}}const Fk=()=>new Bk,$k={allowLooseSteps:!1},Hk=["seed","conversation","context","action"],Gk={observe:["seed","conversation"],plan:["conversation","context"],act:["context","action"],verify:["action"],idle:["seed","conversation"]},$w={seed:"Seed",conversation:"Conversation",context:"Context",action:"Action"},Vk=t=>[...Gk[t??"observe"]??[],...Hk].filter((i,o,u)=>u.indexOf(i)===o),zk=new Set(aT),lT=/^(\d{5,})-(\d+)(?:-[\w-]+)?$/,jk=5e3,Yk=8e3,uT="Begin every response with a plan_state_update that lists your goal, context, progress, next steps, blockers (or null), referenced observations, confidence, and updatedAt before any other action. Immediately after the plan_state_update, include a short text_response (in Mandarin) that restates the users latest question or intent in your own words so they know you understood it.",Hw=3,cT=2,Jk=2,Kk=1,Xk=new Set(["awaiting_clarification","blocked"]),ko="ad_hoc_response",Qk={id:"acknowledge_user_greeting"},Wk={title:" / Quick start",helperText:"",actions:[{id:"profile_dataset",label:" ",helperText:""},{id:"open_raw_preview",label:" ",helperText:" Raw Data Explorer"},{id:"topn_quick_chart",label:" Top-N ",helperText:" Top-N"}]},dT="show entire table",Zk=["reset plan","start over","","","",""],fT=/^(hi|hello|hey|hola|ciao|salut|+|||||||)([!.?\s]|$)/i,eU="Requesting simplified plan outline...",tU=Fk(),Gw=400,nU=25;let zp=!1,pT=0;const Vw=t=>{const e=t.match(lT);return e?{epochMs:Number(e[1]),seq:Number(e[2]),raw:t}:null},xu=()=>vT(),sU=t=>{const e=t.trim().toLowerCase();return e?!!Zk.some(n=>e.includes(n)):!1},aU=["text_response","await_user","plan_creation","dom_action","execute_js_code","proceed_to_analysis","filter_spreadsheet","clarification_request","plan_state_update"],rU={plan_update:"plan_state_update",planstateupdate:"plan_state_update",planstep:"plan_state_update",domaction:"dom_action",agent_action:"text_response",agentmessage:"text_response",respond:"text_response",awaituser:"await_user",await_user:"await_user",awaiting_user:"await_user"},mT=new Set(["greeting","smalltalk","ask_user_choice"]),iU=new Set(["greeting","clarification","clarification_request","ask_user_choice"]),oU=/(^|\n)\s*(?:\d+[\.\)]|[A-Z][\.\)]|[-]\s*(?:option|choice)\s*\d+)/i,lU=/\b(option|choice|||Type a custom answer|please\s+(?:choose|select|pick)|would\s+you\s+like|should\s+i|need\s+your\s+choice|||||)\b/i,uU=/prompt[-\s]*([A-Za-z0-9_-]+)/i,hT=t=>{if(!t)return!1;const e=t.trim();return e?!!(oU.test(e)||/[?]/.test(e)||lU.test(e)||/Type a custom answer/i.test(e)):!1},Xr=t=>{const e=t.meta??(t.meta={awaitUser:!1,haltAfter:!1,resumePlanner:!1,promptId:""});return e.awaitUser=!!e.awaitUser,e.haltAfter=!!e.haltAfter,e.resumePlanner=!!e.resumePlanner,e.promptId=typeof e.promptId=="string"?e.promptId:"",e},Km=t=>{const e=t.find(n=>n.responseType==="plan_state_update");return e?(e.stateTag="awaiting_clarification",ia(e)&&(e.planState.stateTag="awaiting_clarification"),!0):!1},cU=t=>{t.type="await_user",t.responseType="await_user";const e=Xr(t);if(e.awaitUser=!0,e.haltAfter=!0,!e.promptId){const n=(t.text??"").match(uU);e.promptId=(n==null?void 0:n[1])??bo()}},dU=t=>{if(!Array.isArray(t)||t.length===0)return!1;const e=[...t].reverse().find(n=>(n.responseType==="text_response"||n.responseType==="await_user")&&typeof n.text=="string"&&n.text.trim().length>0);return!e||e.responseType!=="await_user"&&!hT(e.text)?!1:(cU(e),Km(t),!0)},fU=(t,e)=>{if(!Array.isArray(t)||t.length===0)return;const n=t.find(o=>o.responseType==="plan_state_update"),s=o=>{if(!n)return;const u=Xr(n);if(u.awaitUser=!0,u.haltAfter=!0,u.promptId=u.promptId||o||bo(),ia(n))n.planState={...n.planState,blockedBy:"awaiting_user_choice"};else{const d=Co(e,e.get().plannerSession.planState??void 0);d.blockedBy="awaiting_user_choice",n.planState=d,e.get().updatePlannerPlanState(d)}};let i=!1;t.forEach(o=>{if(o.responseType!=="clarification_request")return;i=!0;const u=Xr(o);u.awaitUser=!0,u.haltAfter=!0,u.promptId||(u.promptId=bo()),s(u.promptId)}),i&&Km(t)},pU={maxValidationRetries:cT,allowPlanFallbackPrompt:!0,allowAutoContinuation:!1},mU=new Set(["chart_request","data_filter","data_transform"]),hU=new Set(["plan_creation","execute_js_code","filter_spreadsheet","proceed_to_analysis"]),gU=t=>t&&mT.has(t.intent)?{maxValidationRetries:0,allowPlanFallbackPrompt:!1,allowAutoContinuation:!1}:t&&mU.has(t.intent)?{maxValidationRetries:cT,allowPlanFallbackPrompt:!0,allowAutoContinuation:!0}:pU,zw=t=>{if(!t)return null;const e=t.trim().toLowerCase();return e?aU.includes(e)?e:rU[e]??null:null},yU=t=>{if(!Array.isArray(t)||t.length===0)return[];const e=t.filter(Boolean),n=e.find(o=>o.responseType==="plan_state_update"),s=e.find(o=>o.responseType!=="plan_state_update"),i=[];return n&&i.push(n),s&&i.push(s),i.length===0&&i.push(e[0]),i},vU=(t,e,n)=>{if(!t.length)return;const s=t.findIndex(i=>i.responseType==="plan_state_update");if(s===-1){const i=e.get().plannerSession.planState,o=Co(e,i??void 0),u=AT(o,"Auto-inserted plan tracker for this turn.");t.unshift(u),e.get().updatePlannerPlanState(o),n("Inserted missing plan_state_update as first action.");return}if(s>0){const[i]=t.splice(s,1);t.unshift(i),n("Moved plan_state_update to the first position.")}},SU=(t,e)=>{var y,S;if(!Array.isArray(t.actions)){t.actions=[];return}const n=e.get().agentAwaitingUserInput,s=()=>vT(),i=[],o=new Set,u=_=>o.add(_);for(const _ of t.actions){if(!_)continue;const T=_.type,C=_.responseType,N=zw(_.type)??zw(_.responseType)??(_.domAction?"dom_action":_.plan?"plan_creation":_.text?"text_response":null);if(!N)continue;const E={..._,type:N,responseType:N};(T&&T!==N||C&&C!==N)&&u(`Normalized action type to ${N}`);const L=oc(E.stateTag);if(L?E.stateTag=L:(E.stateTag=s(),u(`Minted stateTag for ${N}`)),typeof E.stepId!="string"||E.stepId.trim().length<3?(E.stepId=jp(e),u(`Attached default stepId (${E.stepId}) for ${N}`)):E.stepId=E.stepId.trim(),typeof E.timestamp=="string"&&!Number.isNaN(Date.parse(E.timestamp))||(E.timestamp=new Date().toISOString(),u(`Stamped timestamp for ${N}`)),Xr(E),E.responseType==="plan_state_update"&&!ia(E)){const O=e.get().plannerSession.planState,x=Co(e,E.planState??O??void 0);E.planState=x,e.get().updatePlannerPlanState(x),u("Auto-filled plan_state_update payload.")}i.push(E)}if(i.length===0){t.actions=[];return}n?u("Skipped plan_state_update primer because planner is waiting for user input."):vU(i,e,u);const d=yU(i);d.length<i.length&&e.get().addProgress("Trimmed extra actions to keep this turn atomic.","system");const m=dU(d);fU(d,e);const f=(y=e.detectedIntent)!=null&&y.intent?mT.has(e.detectedIntent.intent):!1;if(f&&!d.some(_=>_.responseType==="text_response")&&(d.push({type:"text_response",responseType:"text_response",stepId:((S=d[0])==null?void 0:S.stepId)??jp(e),reason:"Auto-generated greeting reply so the assistant can acknowledge the user.",text:" hi",timestamp:new Date().toISOString(),meta:{awaitUser:!1,haltAfter:!1,resumePlanner:!1,promptId:""}}),u("Inserted greeting text_response for low-intent turn")),f){const _=d.find(T=>T.responseType==="text_response");if(_){const T=Xr(_);m||(T.awaitUser=!0,T.haltAfter=!0,T.promptId=T.promptId??bo(),Km(d))}}o.size>0&&e.get().addProgress(`Auto-heal corrections applied: ${Array.from(o).join(" | ")}`,"system"),t.actions=d},jw={awaitUser:!1,haltAfter:!1,resumePlanner:!1,promptId:null,blockedReason:null,stateTagOverride:null},wU=t=>!Array.isArray(t)||t.length===0?{...jw}:t.reduce((e,n)=>{if(!n)return e;const s=Xr(n),i=!!s.awaitUser;return{awaitUser:e.awaitUser||i,haltAfter:e.haltAfter||!!s.haltAfter,resumePlanner:e.resumePlanner||!!s.resumePlanner,promptId:s.promptId||e.promptId,stateTagOverride:i?e.stateTagOverride??"awaiting_clarification":e.stateTagOverride}},{...jw}),Xm=(t,e)=>{t.set(()=>({agentAwaitingUserInput:!0,agentAwaitingPromptId:e??null}));const n=t.get();n.addProgress(" Waiting for your choice to continue.");const s={sender:"ai",text:" ",timestamp:new Date,type:"ai_message"};t.set(i=>({chatHistory:[...i.chatHistory,s]})),typeof n.setAgentPhase=="function"&&n.setAgentPhase("idle","Waiting for your choice...")},_U=t=>{t.set(()=>({agentAwaitingUserInput:!1,agentAwaitingPromptId:null}))},gT=t=>{var n;if(t.get().agentAwaitingUserInput)return!0;const e=(n=t.detectedIntent)==null?void 0:n.intent;return e?iU.has(e):!1},Qm=(t,e)=>{var m;Xm(t,e.promptId);const n=t.get(),s=n.plannerSession.planState;if(!s)return;const i=Array.isArray(s.steps)&&s.steps.length>0?s.steps:s.nextSteps,o=i==null?void 0:i.map(f=>f.id===s.currentStepId?{...f,status:"waiting_user"}:f),u=((m=e.blockedReason)==null?void 0:m.trim())||s.blockedBy||"Waiting for your choice",d=e.stateTagOverride??"awaiting_clarification";n.updatePlannerPlanState({...s,steps:o??s.steps,nextSteps:[],blockedBy:u,stateTag:d})},xU=(t,e)=>{if(e.actions.some(d=>d.responseType==="text_response"||d.responseType==="await_user"))return!0;const s=e.actions.find(d=>d.responseType==="plan_state_update"),i=s&&ia(s)?s.planState:t.get().plannerSession.planState;if(!i)return!1;const o=[];if(i.progress&&o.push(`Progress: ${i.progress}`),i.nextSteps&&i.nextSteps.length>0&&o.push(`Next: ${i.nextSteps[0].label}`),i.blockedBy&&o.push(`Blocked by: ${i.blockedBy}`),o.length===0)return!1;const u={sender:"ai",text:`Status update:
${o.join(`
`)}`,timestamp:new Date,type:"ai_message"};return t.set(d=>({chatHistory:[...d.chatHistory,u]})),!0},bU=(t,e)=>{var n,s,i;if(!t)return[];switch(t.intent){case"remove_card":{const o=(n=t.payloadHints)==null?void 0:n.cardTitle,u=(i=(s=t.requiredTool)==null?void 0:s.payloadHints)==null?void 0:i.cardId;return u&&o?[`USER INTENT: Remove the chart titled "${o}" (cardId: ${u}). ACTION REQUIREMENT: Emit a dom_action removeCard with cardId=${u} (or cardTitle matching that text). Do not use other dom_action tools for this request.`]:[`USER INTENT: Remove a chart but no exact title match was found. Ask the user which chart to remove before proceeding. Available charts: ${(e.analysisCards??[]).map(m=>{var f;return(f=m==null?void 0:m.plan)==null?void 0:f.title}).filter(Boolean).join(", ")}.`]}case"data_filter":return["USER INTENT: Filter the raw data view. ACTION REQUIREMENT: Use filter_spreadsheet immediately with args.query echoing their request before creating new charts."];case"data_transform":return["USER INTENT: Permanently transform the dataset. ACTION REQUIREMENT: Use execute_js_code with valid transformation code before continuing."];case"clarification":return["USER INTENT: Needs clarification. ACTION REQUIREMENT: Ask a clarification_request that lists concrete options or explicitly states the missing detail."];case"smalltalk":return["USER INTENT: Casual smalltalk. Keep the reply lightweight and do not run tools until the user asks for a concrete analysis."];case"ask_user_choice":return["USER INTENT: Responding to a multiple-choice prompt. Acknowledge the selection, restate what it maps to, and resume the pending step without rebuilding the entire plan."];default:return[]}};let Yw=0,Jw=0;const pn=(t,e,n)=>{const s=t.get();typeof s.setAgentPhase=="function"&&s.setAgentPhase(e,n??null)},TU=t=>{const e=t.get();typeof e.setAgentPhase=="function"&&e.setAgentPhase("idle",null)},CU=t=>{var e;return(e=t.get().pendingClarifications)==null?void 0:e.some(n=>n.status==="pending"||n.status==="resolving")},Kw=()=>typeof performance<"u"?performance.now():Date.now(),Xw=t=>new Promise(e=>setTimeout(e,t)),AU=async()=>{for(;zp;)await Xw(nU);zp=!0;const t=Date.now()-pT;t<Gw&&await Xw(Gw-t)},EU=()=>{zp=!1,pT=Date.now()},ze={MISSING_TEXT:"MISSING_TEXT",MISSING_PLAN_PAYLOAD:"MISSING_PLAN_PAYLOAD",DOM_PAYLOAD_MISSING:"DOM_PAYLOAD_MISSING",DATASET_UNAVAILABLE:"DATASET_UNAVAILABLE",MISSING_JS_CODE:"MISSING_JS_CODE",TRANSFORM_PENDING:"TRANSFORM_PENDING",TRANSFORM_FAILED:"TRANSFORM_FAILED",CLARIFICATION_PAYLOAD_MISSING:"CLARIFICATION_PAYLOAD_MISSING",CLARIFICATION_NO_OPTIONS:"CLARIFICATION_NO_OPTIONS",REASON_MISSING:"REASON_MISSING",UNSUPPORTED_ACTION:"UNSUPPORTED_ACTION",PLAN_STATE_PAYLOAD_MISSING:"PLAN_STATE_PAYLOAD_MISSING",VALIDATION_FAILED:"VALIDATION_FAILED",PLAN_STEP_OUT_OF_ORDER:"PLAN_STEP_OUT_OF_ORDER"},yT=()=>`obs-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,bo=()=>`prompt-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,NU=new jm,vT=()=>NU.mint(),IU=new Set(["dom_action","execute_js_code","filter_spreadsheet","proceed_to_analysis"]),RU=t=>{const e=JSON.stringify(t);let n=0;for(let s=0;s<e.length;s++)n=(n<<5)-n+e.charCodeAt(s),n|=0;return Math.abs(n).toString(36)},MU=t=>{if(t==null)return"";const e=String(t),n=/[",\n]/.test(e),s=e.replace(/"/g,'""');return n?`"${s}"`:s},ST=t=>{const{csvData:e,spreadsheetFilterFunction:n,aiFilterExplanation:s,interactiveSelectionFilter:i}=t,o=(e==null?void 0:e.data)??[];if(o.length===0)return{summary:"No dataset loaded; Raw Data Explorer summary unavailable.",metadata:{totalRows:0,filteredRows:0,snippetHash:null,drilldownLabel:null,drilldownValueCount:0}};let u=o;const d=[];let m=null,f=null,y=0;if(i&&i.column){const{label:N,column:E,values:L}=i,B=new Set(L.map(I=>String(I)));u=u.filter(I=>B.has(String(I[E]??"")));const O=L.slice(0,4).map(I=>`"${String(I)}"`).join(", "),x=L.length>4?` +${L.length-4}`:"";d.push(`Chart drilldown "${N}" (${E})  ${O}${x}.`),f=N,y=L.length}if(n)try{u=U_(u,n),s!=null&&s.trim()?d.push(`AI filter active: ${s.trim()}`):d.push("AI filter active via natural-language query (no explanation available).")}catch(N){const E=N instanceof Error?N.message:String(N);d.push(`AI filter active but preview failed: ${E}`)}const S=u.length,_=o.length,C=(()=>{if(u.length===0)return"No rows available.";if(u.length>1e3){const L=Object.keys(u[0]),B=L.join(","),O=5,x=u.slice(0,O).map(R=>L.map(P=>MU(R[P])).join(",")),I=Math.ceil(u.length/O),D=RU(u.slice(0,O));return m=D,`CSV snippet page 1/${I} (hash ${D}):
${[B,...x].join(`
`)}`}const N=u.slice(0,3),E=N.length>0?JSON.stringify(N,null,2):"[]";return E.length>600?`${E.slice(0,600)}`:E})();return d.push(`Filtered rows: ${S}/${_}. Preview sample: ${C}`),{summary:d.join(" "),metadata:{totalRows:_,filteredRows:S,snippetHash:m,drilldownLabel:f,drilldownValueCount:y}}},PU=t=>t.observation?t.observation:t.type==="retry"?{status:"error",outputs:{reason:t.reason}}:{status:"success"},DU=6,LU=t=>{if(!t)return null;const e=t.toLowerCase().replace(/[^a-z0-9\s]/g," ").split(/\s+/).filter(Boolean).slice(0,DU).join(" ").trim();return e.length>=3?e:null},To=t=>{if(!Array.isArray(t))return[];const e=[],n=new Set;for(const s of t){const i=typeof(s==null?void 0:s.id)=="string"?s.id.trim():"",o=typeof(s==null?void 0:s.label)=="string"?s.label.trim():"";if(i.length>=3&&o.length>=3&&!n.has(i)){const u=typeof(s==null?void 0:s.intent)=="string"&&s.intent.trim()||void 0,d=typeof(s==null?void 0:s.status)=="string"?s.status:void 0;e.push({id:i,label:o,intent:u,status:d}),n.add(i)}}return e},kU=(t,e,n)=>{var m,f;if(t.responseType==="plan_state_update")return!1;const s=e.get(),i=s.plannerPendingSteps??[],o=i.find(y=>typeof(y==null?void 0:y.id)=="string"&&y.id.trim().length>=3);if(t.responseType==="text_response"&&((m=e.detectedIntent)==null?void 0:m.intent)==="greeting"&&i.length===1&&(o==null?void 0:o.id)===Qk.id)return t.stepId=o.id,s.addProgress(`Auto-tagged greeting reply to step "${o.id}" so it can proceed.`,"system"),typeof s.recordAgentValidationEvent=="function"&&s.recordAgentValidationEvent({actionType:"text_response",reason:"auto_step_id_greeting_ack",actionIndex:n,runId:e.runId,retryInstruction:"stepId was auto-filled with the greeting acknowledgement step so you can keep chatting."}),!0;const u=typeof((f=s.plannerSession.planState)==null?void 0:f.currentStepId)=="string"?s.plannerSession.planState.currentStepId.trim():"",d=u&&u.length>=3&&u||((o==null?void 0:o.id)??ko);return t.stepId=d,s.addProgress(`Auto-assigned stepId "${d}" to ${t.responseType} so it can continue.`,"system"),typeof s.recordAgentValidationEvent=="function"&&s.recordAgentValidationEvent({actionType:t.responseType,reason:"auto_step_id_assigned",actionIndex:n,runId:e.runId,retryInstruction:`stepId was auto-filled with "${d}" because it was missing.`}),!0},jp=t=>{var n,s;const e=t.get().plannerPendingSteps;if(Array.isArray(e)&&e.length>0){const i=(s=(n=e[0])==null?void 0:n.id)==null?void 0:s.trim();if(i&&i.length>=3)return i}return ko},UU=(t,e)=>e?t?t.toLowerCase().includes(e):!1:!0,OU=(t,e,n)=>({id:yT(),actionId:e,responseType:t.responseType,status:n.status,timestamp:new Date().toISOString(),outputs:n.outputs??null,errorCode:n.errorCode??null,uiDelta:n.uiDelta??null}),qU=t=>{var e,n,s,i;switch(t.responseType){case"text_response":case"await_user":return t.text?t.text.slice(0,120):"AI text response";case"plan_creation":return(e=t.plan)!=null&&e.title?`Create analysis "${t.plan.title}"`:"Create new analysis card";case"dom_action":return t.domAction?`DOM action: ${t.domAction.toolName}`:"DOM action";case"execute_js_code":return((n=t.code)==null?void 0:n.explanation)||"Execute data transformation";case"filter_spreadsheet":return(s=t.args)!=null&&s.query?`Filter spreadsheet by "${t.args.query}"`:"Filter spreadsheet";case"clarification_request":return((i=t.clarification)==null?void 0:i.question)||"Ask user for clarification";case"proceed_to_analysis":return"Proceed to analysis pipeline";default:return"Agent action"}},wT=t=>typeof t.text=="string"&&t.text.trim().length>0,_T=t=>!!t.plan,xT=t=>!!t.domAction,bT=t=>!!t.code&&typeof t.code.jsFunctionBody=="string"&&t.code.jsFunctionBody.trim().length>0,BU=t=>typeof t.args=="object",TT=t=>!!t.clarification,ia=t=>{const e=t.planState;if(!e)return!1;const n=typeof e.goal=="string"&&e.goal.trim().length>0,s=typeof e.progress=="string"&&e.progress.trim().length>0,i=Array.isArray(e.nextSteps)&&e.nextSteps.length>0,o=typeof e.planId=="string"&&e.planId.trim().length>0,u=typeof e.currentStepId=="string"&&e.currentStepId.trim().length>=3,m=To(e.steps??e.nextSteps).length>0;return n&&s&&i&&o&&u&&m},FU=t=>t?xo.map(e=>t==null?void 0:t[e]).filter(e=>typeof e=="string"&&e.trim().length>0):[],$U=t=>{const e=t.get().plannerSession.planState;return{hasPendingSteps:!!(e&&Array.isArray(e.nextSteps)&&e.nextSteps.some(s=>typeof(s==null?void 0:s.id)=="string"&&s.id.trim().length>0&&typeof(s==null?void 0:s.label)=="string")),stateTag:e==null?void 0:e.stateTag,hasBlocker:!!(e!=null&&e.blockedBy&&e.blockedBy.trim().length>0)}},HU=t=>!t||!Array.isArray(t.nextSteps)||t.nextSteps.length===0?"No pending steps were captured previously.":t.nextSteps.map(e=>`- [${e.id}] ${e.label}`).join(`
`),GU=t=>{const e=t.get().plannerSession.planState,n=e?`LAST_KNOWN_PLAN:
Goal: ${e.goal}
Progress: ${e.progress}
Next Steps:
${HU(e)}`:"No previous plan was captured; establish a brand new plan.";return`
${t.userMessage}

SYSTEM NOTE: The UI failed to parse your plan. Respond with ONLY a plan_state_update (plus an optional short text_response) that restates or refines the current goal tracker. Do not execute tools yet.

${uT}

${n}
    `.trim()},Qw=(t,e)=>{if(!e||e.length===0)return t;const n=e.map(s=>`- ${s}`).join(`
`);return`${t}

SYSTEM INTENT NOTES:
${n}`},Wm=(t,e)=>{var y,S,_,T,C;if(!e||e.toolName!=="removeCard")return;const n=t.get(),s=e.args??(e.args={});if(typeof s.cardId=="string"&&s.cardId.trim().length>0)return;const i=n.analysisCards??[];if(!Array.isArray(i)||i.length===0)return;const o=((S=(y=t.detectedIntent)==null?void 0:y.requiredTool)==null?void 0:S.payloadHints)??{},u=[s.cardId,o.cardId].filter(N=>typeof N=="string"&&N.trim().length>0);for(const N of u){const E=i.find(L=>(L==null?void 0:L.id)===N);if(E){s.cardId=E.id,!s.cardTitle&&((_=E.plan)!=null&&_.title)&&(s.cardTitle=E.plan.title),n.addProgress(`Auto-selected cardId ${E.id} for removeCard using intent hints.`,"system");return}}const d=N=>(N??"").toLowerCase().replace(/\s+/g," ").trim(),m=[typeof s.cardTitle=="string"?s.cardTitle:"",typeof o.cardTitle=="string"?o.cardTitle:""].map(d).filter(N=>N.length>=3);if(m.length===0)return;const f=i.filter(N=>{var L;const E=d((L=N==null?void 0:N.plan)==null?void 0:L.title);return E?m.some(B=>E.includes(B)||B.includes(E)):!1});if(f.length===1){const N=f[0];s.cardId=N.id,s.cardTitle=((T=N.plan)==null?void 0:T.title)??s.cardTitle,n.addProgress(`Auto-selected cardId ${N.id} for removeCard using title "${((C=N.plan)==null?void 0:C.title)??""}".`,"system");return}f.length>1&&n.addProgress(`Multiple charts matched "${m[0]}". Please clarify which card to remove.`,"error")},VU=["numerical","currency","percentage"],zU=(t,e)=>{var N;const n=(e.aggregation??"").toLowerCase();if(!(n&&n!=="count"))return null;const i=(N=e.valueColumn)==null?void 0:N.trim(),o=t.get(),u=o.columnProfiles??[],d=u.filter(E=>VU.includes(E.type));if(!!i&&d.some(E=>E.name===i))return null;if(!i&&d.length===0)return o.addProgress("Need a numeric column for this aggregation, but none are available.","error"),null;const f=e.title&&e.title.trim().length>0?`Which metric column should I use for "${e.title}"?`:"Which metric column should I use for this chart?",S=(d.length>0?d:u).slice(0,8).map(E=>({label:`${E.name} (${E.type})`,value:E.name}));if(S.length===0)return o.addProgress("No suitable metric column options were found. Please upload data with numeric metrics.","error"),null;const _={question:f,options:S,pendingPlan:{...e},targetProperty:"valueColumn",contextType:"plan"},T=t.deps.registerClarification(_),C={sender:"ai",text:T.question,timestamp:new Date,type:"ai_clarification",clarificationRequest:T};return t.set(E=>({chatHistory:[...E.chatHistory,C]})),t.set({activeClarificationId:T.id}),Xm(t,T.id),o.addProgress("Need your help picking the metric column before I can build that chart."),T.id},jU=(t,e)=>{const n=t.get(),s=n.analysisCards??[];if(!Array.isArray(s)||s.length===0){const m="There are no charts available yet. Create one before using this action.";n.addProgress(m,"error");const f={sender:"ai",text:m,timestamp:new Date,type:"ai_message",isError:!0};return t.set(y=>({chatHistory:[...y.chatHistory,f]})),null}const o={question:e.toolName==="removeCard"?"Which chart should I remove?":"Which chart should I update?",options:s.slice(0,9).map((m,f)=>{var y,S;return{label:((S=(y=m==null?void 0:m.plan)==null?void 0:y.title)==null?void 0:S.trim())||`Chart ${f+1}`,value:m.id}}),pendingPlan:{domActionContext:{toolName:e.toolName,args:{...e.args??{}}}},targetProperty:"title",contextType:"dom_action"},u=t.deps.registerClarification(o),d={sender:"ai",text:u.question,timestamp:new Date,type:"ai_clarification",clarificationRequest:u};return t.set(m=>({chatHistory:[...m.chatHistory,d]})),t.set({activeClarificationId:u.id}),pn(t,"clarifying","Need your input to keep going..."),t.get().endBusy(t.runId),Xm(t,u.id),u.id},YU=t=>{const e=t.trim();return e.length<3||fT.test(e)?!1:/[\p{L}\p{N}]/u.test(e)},Zm=(t,e,n)=>{var u,d;const s=typeof e=="string"?e.trim():"";if(s)return{query:s,source:"payload"};const i=typeof((u=n==null?void 0:n.payloadHints)==null?void 0:u.query)=="string"?n.payloadHints.query.trim():"";if(i)return{query:i,source:"intent_hint"};const o=((d=t.userMessage)==null?void 0:d.trim())??"";return YU(o)?{query:o,source:"user_message"}:{query:dT,source:"default"}},Ww=(t,e,n)=>{var m,f,y,S,_;if(gT(e)||t.responseType!=="filter_spreadsheet")return!1;const s=((m=e.detectedIntent)==null?void 0:m.intent)==="data_filter"?e.detectedIntent.requiredTool:void 0;if(!s&&((f=t.args)!=null&&f.query))return!1;const i=typeof((y=t.args)==null?void 0:y.query)=="string"?t.args.query:"",{query:o,source:u}=Zm(e,i,s);if((i==null?void 0:i.trim())===o)return!1;t.args={...t.args??{},query:o};const d=u==="default"?'Auto-filled filter query with "show entire table" to keep the conversation moving.':"Auto-filled filter query using your latest request so the filter tool can run.";return e.get().addProgress(d,"system"),(_=(S=e.get()).recordAgentValidationEvent)==null||_.call(S,{actionType:"filter_spreadsheet",reason:"auto_filter_query_filled",actionIndex:n,runId:e.runId,retryInstruction:"Filter query was auto-filled using the user intent/context."}),!0},JU=(t,e,n)=>{var m,f,y,S,_;if(gT(e)||t.responseType!=="dom_action"||!t.domAction)return!1;const s=(m=e.detectedIntent)==null?void 0:m.requiredTool;if(!s||s.responseType!=="dom_action"||s.domToolName&&t.domAction.toolName!==s.domToolName)return!1;const i=t.domAction.args??(t.domAction.args={});let o=!1;const u=typeof((f=s.payloadHints)==null?void 0:f.cardId)=="string"?s.payloadHints.cardId.trim():"",d=typeof((y=s.payloadHints)==null?void 0:y.cardTitle)=="string"?s.payloadHints.cardTitle.trim():"";return!i.cardId&&u&&(i.cardId=u,o=!0),!i.cardTitle&&d&&(i.cardTitle=d,o=!0),o&&(e.get().addProgress("Auto-filled DOM action payload using intent hints.","system"),(_=(S=e.get()).recordAgentValidationEvent)==null||_.call(S,{actionType:"dom_action",reason:"auto_dom_payload_filled",actionIndex:n,runId:e.runId,retryInstruction:"DOM payload fields were auto-filled using the user intent hints."})),o},KU=(t,e)=>{var s,i,o,u,d,m,f;const n=jp(t);switch(e.responseType){case"dom_action":{if(!e.domToolName)return null;const y={};(s=e.payloadHints)!=null&&s.cardId&&(y.cardId=e.payloadHints.cardId),(i=e.payloadHints)!=null&&i.cardTitle&&(y.cardTitle=e.payloadHints.cardTitle);const S={toolName:e.domToolName,args:y};return Wm(t,S),(o=S.args)!=null&&o.cardId?{type:"dom_action",responseType:"dom_action",reason:"Auto-inserted DOM action to satisfy the user intent.",stepId:n,stateTag:xu(),domAction:S}:null}case"filter_spreadsheet":{const{query:y}=Zm(t,((u=e.payloadHints)==null?void 0:u.query)??null,e);return{type:"filter_spreadsheet",responseType:"filter_spreadsheet",reason:"Auto-inserted filter to satisfy the user intent.",stepId:n,stateTag:xu(),args:{query:y}}}case"execute_js_code":{const y=t.get(),S=((d=t.userMessage)==null?void 0:d.toLowerCase())??"",_=y.columnProfiles??[],T=((m=e.payloadHints)==null?void 0:m.column)??((f=_.find(E=>S.includes(E.name.toLowerCase())))==null?void 0:f.name)??null;if(!T)return null;const N=`
const result = data.map(row => {
    const next = { ...row };
    delete next["${T.replace(/"/g,'\\"')}"];
    return next;
});
return result;
            `.trim();return{type:"execute_js_code",responseType:"execute_js_code",reason:`Auto-inserted data transform to remove the column "${T}".`,stepId:n,stateTag:xu(),code:{explanation:`Removes the column "${T}" from every row of the dataset.`,jsFunctionBody:N}}}default:return null}},XU=async(t,e,n,s)=>{const i=e().analysisCards.map(S=>({id:S.id,title:S.plan.title,aggregatedDataSample:S.aggregatedData.slice(0,100)}));let u=(()=>{const{chatMemoryPreview:S,chatMemoryExclusions:_}=e();return S.filter(T=>!_.includes(T.id))})();if(u.length===0&&Ke.getDocumentCount()>0)try{u=await Ke.search(t,3,{signal:n.getRunSignal(s)})}catch(S){S instanceof DOMException&&S.name==="AbortError"||console.error("Fallback memory search failed:",S)}const d=u,m=d.map(S=>S.text),f=()=>ST(e()).summary;return{memorySnapshot:d,requestAiResponse:(S,_)=>{var T;return hL(e().columnProfiles,e().chatHistory,S,i,e().settings,e().aiCoreAnalysisSummary,e().currentView,(((T=e().csvData)==null?void 0:T.data)||[]).slice(0,20),m,e().plannerSession.observations,e().plannerSession.planState,e().dataPreparationPlan,e().agentActionTraces.slice(-10),f(),{signal:(_==null?void 0:_.signal)??n.getRunSignal(s),mode:_==null?void 0:_.mode,onPromptProfile:C=>{var E;const N=e().recordPromptMetric;if(typeof N=="function"){const L={id:`prompt-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,mode:C.mode,charCount:C.charCount,estimatedTokens:C.estimatedTokens,promptLabel:C.promptLabel,createdAt:new Date().toISOString(),runId:s};N(L)}(E=_==null?void 0:_.onPromptProfile)==null||E.call(_,C)},onUsage:C=>{var E;const N=e().recordLlmUsage;N&&N({provider:C.provider,model:C.model,promptTokens:C.promptTokens,completionTokens:C.completionTokens,totalTokens:C.totalTokens,context:C.operation??"chat.response"}),(E=_==null?void 0:_.onUsage)==null||E.call(_,C)}})}}},QU=t=>{var n;const e=t.get();return{planState:e.plannerSession.planState,pendingSteps:e.plannerPendingSteps??[],detectedIntent:t.detectedIntent,userMessage:t.userMessage,runId:t.runId,now:Date.now(),lastStateTag:((n=e.plannerSession.planState)==null?void 0:n.stateTag)??null}},WU=async(t,e)=>{var s;return((s=t.action.reason)==null?void 0:s.trim())?e():(t.runtime.get().addProgress("AI response missing reasoning; action skipped.","error"),MO(t.runtime),t.markTrace("failed","Action blocked because no reasoning was provided.",{errorCode:ze.REASON_MISSING}),{type:"continue",observation:{status:"error",errorCode:ze.REASON_MISSING,outputs:{note:"Action skipped because reason field was empty."}}})},ZU=(t,e)=>!e||t.responseType!=="plan_creation"||!t.plan?!1:[t.plan.title,t.plan.description,t.plan.groupByColumn,t.plan.valueColumn,t.plan.secondaryValueColumn].filter(Boolean).map(s=>String(s).toLowerCase()).some(s=>s.includes(e)),CT=(t,e)=>{var n;return t.responseType!==e.responseType?!1:e.responseType==="dom_action"&&e.domToolName?((n=t.domAction)==null?void 0:n.toolName)===e.domToolName:!0},Pa=Object.create(null),eO=3,tO=t=>{if(!t)return"latest user request";const e=t.trim();return e?e.length>120?`${e.slice(0,117)}`:e:"latest user request"},Co=(t,e)=>{var m,f,y,S,_,T,C,N,E,L,B,O;const n=t.get(),s=new Date().toISOString(),i=To((e==null?void 0:e.steps)??(e==null?void 0:e.nextSteps)),o=i[0]??{id:e!=null&&e.currentStepId&&e.currentStepId.trim().length>=3?e.currentStepId.trim():ko,label:(m=e==null?void 0:e.goal)!=null&&m.trim()?`Advance: ${e.goal.trim().slice(0,60)}`:"Handle the latest user request",intent:((y=(f=e==null?void 0:e.steps)==null?void 0:f[0])==null?void 0:y.intent)??"conversation",status:((_=(S=e==null?void 0:e.steps)==null?void 0:S[0])==null?void 0:_.status)??"ready"},u=i.length>0?i:[o],d=(e!=null&&e.steps?To(e.steps):null)??u;return{planId:((T=e==null?void 0:e.planId)==null?void 0:T.trim())||((C=n.plannerSession.planState)==null?void 0:C.planId)||`plan-${Date.now().toString(36)}`,goal:((N=e==null?void 0:e.goal)==null?void 0:N.trim())||((E=n.plannerSession.planState)==null?void 0:E.goal)||`Clarify and fulfill: ${tO(t.userMessage)}`,contextSummary:(e==null?void 0:e.contextSummary)??((L=n.plannerSession.planState)==null?void 0:L.contextSummary)??"Awaiting concrete instructions.",progress:((B=e==null?void 0:e.progress)==null?void 0:B.trim())||"Initialized plan tracker.",nextSteps:u,steps:d,currentStepId:e!=null&&e.currentStepId&&e.currentStepId.trim().length>=3?e.currentStepId.trim():o.id,blockedBy:typeof(e==null?void 0:e.blockedBy)=="string"?e.blockedBy:(e==null?void 0:e.blockedBy)??null,observationIds:(e==null?void 0:e.observationIds)??[],confidence:typeof(e==null?void 0:e.confidence)=="number"?e.confidence:((O=n.plannerSession.planState)==null?void 0:O.confidence)??.5,updatedAt:(e==null?void 0:e.updatedAt)??s,stateTag:(e==null?void 0:e.stateTag)??"context_ready"}},AT=(t,e)=>({type:"plan_state_update",responseType:"plan_state_update",reason:e??"Auto-initializing plan tracker before continuing.",stateTag:xu(),stepId:t.currentStepId??ko,timestamp:new Date().toISOString(),text:"Plan tracker synchronized.",cardId:null,meta:{awaitUser:!1,haltAfter:!1,resumePlanner:!1,promptId:""},planState:t}),nO=new Set(["greeting","smalltalk","ask_user_choice"]),sO=t=>{var s,i,o;if(t.starterActionsShared||!nO.has(((s=t.detectedIntent)==null?void 0:s.intent)??"")||!!!(t.get().csvData&&((o=(i=t.get().csvData)==null?void 0:i.data)!=null&&o.length)))return;t.starterActionsShared=!0;const n={sender:"ai",text:"",timestamp:new Date,type:"ai_message",quickActions:Wk};t.set(u=>({chatHistory:[...u.chatHistory,n]}))},aO=async(t,e)=>{const n=t.runtime.runId;if(t.action.responseType==="plan_state_update"||t.action.responseType==="text_response"||t.runtime.policy.allowLooseSteps)return Pa[n]=0,e();const o=(t.runtime.get().plannerPendingSteps||[])[0];if(!o)return Pa[n]=0,e();const u=typeof t.action.stepId=="string"?t.action.stepId.trim():"",d=u.length>0&&u===o.id,m=LU(o.label),f=!!m&&(UU(t.action.reason,m)||ZU(t.action,m));if(!d&&!f){const S=(Pa[n]??0)+1;if(Pa[n]=S,S>=eO)return t.runtime.get().addProgress("Relaxing plan-step enforcement after repeated attempts. Proceed carefully and build the pending chart immediately."),Pa[n]=0,typeof t.runtime.get().completePlannerPendingStep=="function"&&t.runtime.get().completePlannerPendingStep(),e();const _=`"${o.label}" [${o.id}]`;t.runtime.get().addProgress(`State consistency check failed. Next planned step is ${_}. Reference it explicitly and set stepId="${o.id}" before taking other actions.`,"error"),t.markTrace("failed","Plan step order violation.",{errorCode:ze.PLAN_STEP_OUT_OF_ORDER,metadata:{expectedStepId:o.id,expectedStepLabel:o.label}});const T=`SYSTEM NOTE: You attempted to skip the plan step ${_}. Reference it explicitly and set stepId="${o.id}" before taking other actions.`;return{type:"retry",reason:`Plan step enforcement triggered for ${_}.`,retryPrompt:T,userFacingMessage:`Plan step enforcement triggered for ${_}. I'll restate the pending step and try again.`,progressMessage:`Refocusing on pending step ${_}...`,phaseMessage:"Reordering plan execution after a failed attempt...",statusMessage:"Refocusing on the pending step...",promptMode:"full",observation:{status:"error",errorCode:ze.PLAN_STEP_OUT_OF_ORDER,outputs:{expectedStepId:o.id,expectedStepLabel:o.label}}}}const y=t.markTrace;t.markTrace=(S,_,T)=>{S==="succeeded"&&(Pa[n]=0,o&&(d||f)&&(d||t.runtime.get().addProgress(`Step ${o.id} completed via fallback inference. Future actions must include stepId="${o.id}" to avoid guard warnings.`,"error"),typeof t.runtime.get().completePlannerPendingStep=="function"&&t.runtime.get().completePlannerPendingStep())),y(S,_,T)};try{return await e()}finally{t.markTrace=y}},rO=async(t,e)=>(t.action.reason&&t.runtime.get().addProgress(`AI Thought: ${t.action.reason}`),e()),iO=async(t,e)=>{const n=Kw(),s=t.markTrace;t.markTrace=(i,o,u)=>{const m=i==="succeeded"||i==="failed"?{...u??{},durationMs:Math.max(0,Kw()-n)}:u;s(i,o,m)};try{return await e()}finally{t.markTrace=s}},oO=[],lO=[WU,aO,rO,iO],uO=()=>[...lO,...oO],cO=(t,e)=>t.reduceRight((n,s)=>async i=>s(i,()=>n(i)),e),dO=async(t,e,n,s)=>{t.responseType==="dom_action"&&t.domAction&&Wm(e,t.domAction);const i=RO[t.responseType];if(!i)return s("failed","Unsupported action type.",{errorCode:ze.UNSUPPORTED_ACTION}),{type:"continue",observation:{status:"error",errorCode:ze.UNSUPPORTED_ACTION}};const o={action:t,runtime:e,remainingAutoRetries:n,markTrace:s};return cO(uO(),i)(o)},ft=(t,e,n,s)=>({isValid:!1,userMessage:t?`AI ${t.responseType} action is invalid: ${n}. Asking it to correct the payload...`:n,retryInstruction:s,details:t?{actionType:t.responseType,actionIndex:e,reason:n}:void 0}),fO=t=>{var s;const e=t.clarification;return(s=e.question)!=null&&s.trim()?!Array.isArray(e.options)||e.options.length===0?"Clarification options are missing.":e.options.find(i=>!i||typeof i.label!="string"||typeof i.value!="string")?"Clarification option missing label or value.":e.targetProperty?null:"Clarification targetProperty is missing.":"Clarification question is empty."},pO=t=>{const e=t.args??{},n=typeof e.cardId=="string"?e.cardId.trim():"",s=typeof e.cardTitle=="string"?e.cardTitle.trim():"";if(t.toolName!=="removeCard"&&!n)return"DOM action missing cardId.";switch(t.toolName){case"changeCardChartType":if(!e.newType)return"changeCardChartType requires newType.";break;case"filterCard":if(!e.column||typeof e.column!="string")return"filterCard requires a column.";if(!Array.isArray(e.values)||e.values.length===0)return"filterCard requires at least one value.";if(e.values.some(o=>typeof o!="string"&&typeof o!="number"))return"filterCard values must be strings or numbers.";break;case"setTopN":if(e.topN===void 0||e.topN===null)return"setTopN requires the topN value.";if(e.topN!=="all"&&(!Number.isFinite(Number(e.topN))||Number(e.topN)<=0||!Number.isInteger(Number(e.topN))))return'setTopN must be a positive integer or "all".';break;case"toggleLegendLabel":if(!e.label||typeof e.label!="string")return"toggleLegendLabel requires a label.";break;case"exportCard":if(!e.format||typeof e.format!="string")return"exportCard requires a format.";break;case"removeCard":if(!n&&!s)return"removeCard requires a cardId (or cardTitle that uniquely identifies the card).";break}return null},mO=(t,e)=>{var d;const n=e.args??{},s=typeof n.cardId=="string"?n.cardId.trim():"";if(!s)return null;const o=(Array.isArray(t.get().analysisCards)?t.get().analysisCards:[]).find(m=>m.id===s);if(!o)return null;const u=((d=o.plan)==null?void 0:d.title)??"this card";switch(e.toolName){case"changeCardChartType":{const m=typeof n.newType=="string"?n.newType:null,f=o.displayChartType??o.plan.chartType;if(m&&m===f)return`Skipped chart switch because "${u}" is already a ${m} chart.`;break}case"showCardData":{if(typeof n.visible!="boolean")break;if(o.isDataVisible===n.visible)return n.visible?`Raw data for "${u}" is already visible.`:`Raw data for "${u}" is already hidden.`;break}case"setTopN":{if(n.topN===void 0)break;const m=n.topN==="all"?null:Number(n.topN);if(m!==null&&!Number.isFinite(m))break;if((typeof o.topN=="number"?o.topN:null)===m){const y=m===null?"all categories":`Top ${m}`;return`Skipped Top N change because "${u}" already shows ${y}.`}break}case"toggleHideOthers":{if(typeof n.hide!="boolean")break;if(o.hideOthers===n.hide)return n.hide?`"${u}" already hides the "Others" bucket.`:`"${u}" is already showing the "Others" bucket.`;break}}return null},Zw=t=>{if(typeof t!="string")return null;const e=t.trim();return e.length===0?null:e.length<3?"Filter query must be at least 3 characters.":e.length>200?"Filter query is too long (max 200 characters).":null},hO=t=>{var s;if((((s=t.code.explanation)==null?void 0:s.trim())??"").length<10)return"Code explanation must be at least 10 characters.";const n=t.code.jsFunctionBody.trim();return/return\s+/i.test(n)?null:"JavaScript transform must include a return statement."},gO=(t,e,n)=>{if(!e)return;const s=`Validation failed at step ${e.actionIndex+1}`,i=t.get().beginAgentActionTrace(e.actionType,s,"system");t.get().updateAgentActionTrace(i,"failed",e.reason,{errorCode:ze.VALIDATION_FAILED,metadata:{actionIndex:e.actionIndex}}),t.get().recordAgentValidationEvent({actionType:e.actionType,reason:e.reason,actionIndex:e.actionIndex,runId:t.runId,retryInstruction:n})},yO=(t,e)=>{var y,S,_,T,C,N;if(!Array.isArray(t.actions)||t.actions.length===0)return{isValid:!1,userMessage:"AI response was empty; requesting it to restate the plan...",retryInstruction:"You must return at least one action. Begin with a plan_state_update that satisfies the required schema before any other steps."};if(t.actions.length>Jk){const E=t.actions[1]??t.actions[0];return ft(E,Math.min(1,t.actions.length-1),"Too many actions returned in a single response.","Limit every response to a plan_state_update followed by exactly one atomic action (text_response, dom_action, execute_js_code, etc.).")}let n=t.actions[0],s=e.get().plannerSession.planState;(y=e.detectedIntent)==null||y.intent;let i=null;const o=(E,L)=>{const B=typeof E.type=="string"?E.type.trim():"";if(!B)return ft(E,L,"Action type is missing.","Every action must include the type field (matching responseType) along with stepId and stateTag.");if(E.responseType!==B)return ft(E,L,"Action type must match responseType.","Keep the type field identical to responseType for every action.");E.type=B;const O=typeof E.stateTag=="string"?E.stateTag.trim():"";if(!O)return ft(E,L,"stateTag is missing.",'Every action must include a monotonic stateTag formatted as "<epochMs>-<seq>" (or a known label like "awaiting_clarification").');const x=oc(O);if(!x)return ft(E,L,"stateTag format is invalid.",'Mint stateTag tokens as "<epochMs>-<seq>" (optionally with a suffix) or use one of the known labels.');const I=Vw(x);if(I){if(i&&(I.epochMs<i.epochMs||I.epochMs===i.epochMs&&I.seq<=i.seq))return ft(E,L,"stateTag must strictly increase with each action.","Ensure every new action increments the numeric portion of the stateTag so it remains monotonic.");i=I}return E.stateTag=x,null},u=()=>{if(s=e.get().plannerSession.planState,n=t.actions[0],!n)return{isValid:!1,userMessage:"AI response was empty; requesting it to restate the plan...",retryInstruction:"You must return at least one action. Begin with a plan_state_update that satisfies the required schema before any other steps."};if(!s){if(n.responseType!=="plan_state_update"){const E=Co(e,n.planState??void 0),L=AT(E,"Auto-inserted plan tracker before executing pending actions.");t.actions.unshift(L),e.get().updatePlannerPlanState(E),e.get().addProgress("Auto-inserted plan_state_update to bootstrap the planner.","system"),n=L,s=E}if(ia(n))e.get().updatePlannerPlanState(n.planState),s=n.planState;else{const E=Co(e,n.planState??void 0);n.planState=E,e.get().updatePlannerPlanState(E),e.get().addProgress("Auto-filled missing plan tracker fields.","system"),s=E}return null}if(n.responseType!=="plan_state_update")return ft(n,0,"First action must be plan_state_update when a plan tracker is active.",uT);if(!ia(n)){const E={...s,updatedAt:new Date().toISOString()};n.planState=E,e.get().updatePlannerPlanState(E),e.get().addProgress("Reused previous plan tracker snapshot for validation.","system")}return null};if(e.get().agentAwaitingUserInput){for(let E=0;E<t.actions.length;E++){const L=t.actions[E],B=o(L,E);if(B)return B;if(L.responseType!=="text_response")return ft(L,E,"Planner is waiting for the user response, so only text_response actions are allowed.","Hold all plan_state_update or continue actions until awaitUser is cleared (resumePlanner:true after the user replies).")}return{isValid:!0}}const m=u();if(m)return m;n=t.actions[0],s=e.get().plannerSession.planState;for(let E=0;E<t.actions.length;E++){const L=t.actions[E],B=o(L,E);if(B)return B;const O=typeof L.stepId=="string"?L.stepId.trim():"";if(O.length<3){if(!kU(L,e,E))return ft(L,E,"stepId is missing or invalid.","Every action must include stepId matching the pending plan step id (>=3 characters, typically kebab-case).")}else L.stepId=O;switch(L.responseType){case"plan_state_update":if(!ia(L))return ft(L,E,"Plan tracker update missing required fields.","Ensure every plan_state_update includes goal, progress, nextSteps, blockedBy, observationIds, confidence, and updatedAt.");break;case"plan_creation":if(!_T(L))return ft(L,E,"Plan payload is missing.","Provide a full analysis plan object with chart type, title, description, and column selections.");break;case"dom_action":if(!xT(L))return ft(L,E,"DOM action payload is missing.","Include domAction with the toolName and args for card interactions.");JU(L,e,E);{const x=pO(L.domAction);if(x)return ft(L,E,x,"Provide the required DOM tool arguments, including cardId and any tool-specific fields.")}break;case"execute_js_code":if(!bT(L))return ft(L,E,"Executable code payload is missing.","Every execute_js_code action must include explanation and a non-empty jsFunctionBody.");{const x=hO(L);if(x)return ft(L,E,x,"Ensure your data transform includes a clear explanation and a return statement.")}break;case"filter_spreadsheet":if(!BU(L)&&!Ww(L,e,E))return ft(L,E,"Filter query is missing.","Provide args.query describing how to filter the spreadsheet.");{let x=Zw(((S=L.args)==null?void 0:S.query)??null);if(x&&Ww(L,e,E)&&(x=Zw(((_=L.args)==null?void 0:_.query)??null)),x)return ft(L,E,x,"Provide a natural-language filter query between 3 and 200 characters.")}break;case"clarification_request":if(!TT(L))return ft(L,E,"Clarification payload is missing.","Include question, options, pendingPlan, and targetProperty fields.");{const x=fO(L);if(x)return ft(L,E,x,"Clarification requests must include a question, at least one option, and a targetProperty.")}break;case"text_response":case"await_user":if(!wT(L))return ft(L,E,"Text response missing text payload.","Every text_response or await_user action must include a non-empty text field.");break}}const f=(T=e.detectedIntent)==null?void 0:T.requiredTool;if(f&&!e.intentRequirementSatisfied&&!t.actions.some(L=>CT(L,f))){const L=KU(e,f);if(L){const B=t.actions[0];t.actions=[B,L],i=Vw((B==null?void 0:B.stateTag)??"")??null;const O=o(L,1);if(O)return O;const x=f.domToolName??f.responseType??"the required tool";e.get().addProgress(`Auto-inserted ${x} to satisfy the user's request.`,"system"),(N=(C=e.get()).recordAgentValidationEvent)==null||N.call(C,{actionType:L.responseType,reason:"auto_insert_required_tool",actionIndex:t.actions.length-1,runId:e.runId,retryInstruction:`Inserted ${x} automatically because it was required by the user intent.`})}else{const B=f.domToolName??f.responseType??"the required tool";return ft(t.actions[0]??null,0,`Required tool ${B} missing.`,`The user's intent requires using ${B}. Include that action (with the correct payload) in your response before other tools.`)}}return{isValid:!0}},vO=async(t,e,n,s,i)=>{n.get().updateBusyStatus(s);const o=await e.requestAiResponse(t,i);return tU.run(o,QU(n))},to=t=>t.get().plannerSession.planState?"full":"plan_only",SO=async(t,e,n)=>{var P;const i="Requesting corrected plan outline...";let o=0,u=0,d=!1,m=!1,f=0,y=0,S=!1;const _=A=>Qw(A,n.intentNotes),T=gU(n.detectedIntent),C=T.maxValidationRetries,N=T.allowPlanFallbackPrompt,E=T.allowAutoContinuation,L=async(A,k,F)=>{const U=await vO(A,e,n,k,F);SU(U,n);const z=wU(U.actions);return z.resumePlanner&&_U(n),{response:U,meta:z}},B=_(t),O=n.get().graphPhase??"observe",x=Vk(O);let I=0;const D=()=>{if(!(to(n)!=="full"||x.length===0))return x[Math.min(I,x.length-1)]},R=()=>{if(I<x.length-1)return I+=1,x[I]};pn(n,"observing","Reviewing the current dataset and prior context...");try{pn(n,"planning","Thinking through your question...");let{response:A,meta:k}=await L(B,"Thinking through your question...",{mode:to(n),promptStage:D()});for(;A;){if(n.get().isRunCancellationRequested(n.runId)){n.get().addProgress("Stopped processing request.");return}const F=yO(A,n);if(!F.isValid){u++,gO(n,F.details,F.retryInstruction),n.get().addProgress(F.userMessage,"error");const W=to(n),le=W==="full"?R():void 0;if(le){u=Math.max(0,u-1),n.get().addProgress(`Adding ${$w[le]} context to assist the planner.`),{response:A,meta:k}=await L(B,`Adding ${$w[le]} context...`,{mode:W,promptStage:le});continue}if(u>=C){if(!m){m=!0,u=0,n.get().addProgress("Plan validation failed; asking the AI to restate your request and try again.","system"),pn(n,"planning","Restating your request before continuing..."),{response:A,meta:k}=await L(_(`${n.userMessage}

SYSTEM NOTE: Restate the user's latest request in your own words to confirm understanding, then provide a valid plan_state_update that follows the shared schema exactly.`),"Restating your request...",{mode:to(n)});continue}if(!d&&N){d=!0,u=0,n.get().addProgress("Plan validation failed twice; requesting a simplified plan snapshot...","system"),pn(n,"planning","Rebuilding the plan outline..."),{response:A,meta:k}=await L(Qw(GU(n),n.intentNotes),eU,{mode:"plan_only"});continue}n.get().addProgress("Unable to obtain a valid plan update after multiple attempts.","error");const ie={sender:"ai",text:"Sorry, I could not establish a valid plan_state_update. Please try again or rephrase your question.",timestamp:new Date,type:"ai_message",isError:!0};n.set(ue=>({chatHistory:[...ue.chatHistory,ie]}));return}pn(n,"planning","Revising the plan outline based on validation feedback..."),{response:A,meta:k}=await L(_(`${n.userMessage}

SYSTEM NOTE: ${F.retryInstruction}`),i,{mode:to(n)});continue}const U=1-o,z=A.actions.some(W=>!["plan_state_update","text_response","await_user"].includes(W.responseType)),oe=A.actions.some(W=>hU.has(W.responseType));pn(n,"acting",z?"Executing the next step of the plan...":"Delivering the latest reasoning step...");const se=await xO(A,n,U),q=A.actions.filter(W=>W.responseType!=="plan_state_update").length;se.type!=="retry"&&(y+=q);let j=A.actions.some(W=>W.responseType==="text_response"||W.responseType==="await_user");if(se.type==="complete"&&!j&&(j=xU(n,A)),se.type==="halt")return;if(se.type==="retry"){const W=o+2;o++;const le=`attempt ${W}`,ie=se.phaseMessage??"Retrying the last action automatically...";pn(n,"retrying",ie);const me={sender:"ai",text:` ${se.userFacingMessage??`The previous action failed (${se.reason}). I'll try again automatically (${le}).`}`,timestamp:new Date,type:"ai_message",isError:!0};n.set(Re=>({chatHistory:[...Re.chatHistory,me]}));const Ee=se.progressMessage??` Auto-retrying last action (${le})...`;n.get().addProgress(Ee);const Ae=se.statusMessage??"Adjusting the plan after a failed attempt...";pn(n,"planning",Ae);const ve=se.retryPrompt??`SYSTEM NOTE: Previous action failed because ${se.reason}. Please adjust and try again.`,Et=se.promptMode??"full";({response:A,meta:k}=await L(_(`${n.userMessage}

${ve}`),Ae,{mode:Et}));continue}if(k.awaitUser){Qm(n,k);return}if(k.haltAfter){n.get().addProgress("Stopped auto-continue per AI instruction.");return}pn(n,"verifying","Reviewing what just happened before continuing...");const{hasPendingSteps:ae,stateTag:ge,hasBlocker:Ce}=$U(n),H=ge?Xk.has(ge):!1,ee=y>=Kk;if(se.type==="complete"&&j&&E&&oe&&f<Hw&&ae&&!H&&!Ce&&!n.get().isRunCancellationRequested(n.runId)&&!z&&!ee){f++;const W=n.get().plannerSession.planState,le=[n.userMessage,"",`SYSTEM NOTE: Continue executing your plan. Current goal: ${(W==null?void 0:W.goal)??"N/A"}.`,(P=W==null?void 0:W.nextSteps)!=null&&P.length?`Remaining steps: ${W.nextSteps.map(ue=>`[${ue.id}] ${ue.label}`).join(" | ")}`:null,W!=null&&W.blockedBy?`Known blockers: ${W.blockedBy}`:null].filter(Boolean).join(`
`),ie=f===1?"Continuing plan":`Continuing plan (cycle ${f}/${Hw})`;n.get().addProgress(ie),pn(n,"planning","Continuing with the remaining plan steps..."),{response:A,meta:k}=await L(_(le),f===1?"Continuing plan...":`Continuing plan (cycle ${f})...`,{mode:"full"});continue}ee&&!S&&(n.get().addProgress("Step budget reached (plan tracker + 1 atomic action). Waiting for your next input before continuing.","system"),S=!0);break}pn(n,"reporting","Summarizing the latest findings...")}finally{CU(n)||TU(n)}},wO=t=>t.responseType==="filter_spreadsheet"||t.responseType==="execute_js_code"?!0:t.responseType==="dom_action"&&t.domAction?["filterCard","setTopN","toggleHideOthers","toggleLegendLabel","highlightCard","showCardData","removeCard"].includes(t.domAction.toolName):!1,_O=(t,e,n,s)=>{if(s.status!=="success"||!wO(e))return;const i=ST(t.get()),o={rawDataExplorerSummary:i.summary,filteredRows:i.metadata.filteredRows,totalRows:i.metadata.totalRows,snippetHash:i.metadata.snippetHash,drilldownLabel:i.metadata.drilldownLabel,drilldownValueCount:i.metadata.drilldownValueCount};t.get().appendPlannerObservation({id:yT(),actionId:n,responseType:e.responseType,status:"success",timestamp:new Date().toISOString(),outputs:o,errorCode:null,uiDelta:null}),typeof t.get().annotateAgentActionTrace=="function"&&t.get().annotateAgentActionTrace(n,o)},xO=async(t,e,n)=>{var s,i,o;await AU();try{for(const u of t.actions){if(e.get().isRunCancellationRequested(e.runId))return e.get().addProgress("Cancelled remaining actions."),{type:"halt"};const d=qU(u),m=e.get().beginAgentActionTrace(u.responseType,d,"chat"),f=(L,B,O)=>{e.get().updateAgentActionTrace(m,L,B,O)},y=oc(u.stateTag),S={};y&&(S.stateTag=y),typeof u.stepId=="string"&&u.stepId.trim().length>0&&(S.stepId=u.stepId.trim());const _=Object.keys(S).length>0?{metadata:S}:void 0;f("executing",void 0,_),u.responseType==="dom_action"&&u.domAction&&Wm(e,u.domAction);const T=await dO(u,e,n,f),C=PU(T),N=OU(u,m,C);if(e.get().appendPlannerObservation(N),_O(e,u,m,N),((s=e.detectedIntent)==null?void 0:s.requiredTool)&&!e.intentRequirementSatisfied&&CT(u,e.detectedIntent.requiredTool)&&N.status==="success"&&(e.intentRequirementSatisfied=!0,e.get().addProgress(`Intent requirement satisfied via ${e.detectedIntent.requiredTool.domToolName??e.detectedIntent.requiredTool.responseType}.`),e.get().annotateAgentActionTrace(m,{intentSatisfied:!0,intent:e.detectedIntent.intent})),T.type==="retry"){const L=((i=T.observation)==null?void 0:i.status)??null,B=!!((o=T.observation)!=null&&o.outputs&&"awaitUser"in T.observation.outputs&&T.observation.outputs.awaitUser);return IU.has(u.responseType)&&L==="error"&&!B?{type:"retry",reason:T.reason,retryPrompt:T.retryPrompt,userFacingMessage:T.userFacingMessage,progressMessage:T.progressMessage,phaseMessage:T.phaseMessage,statusMessage:T.statusMessage,promptMode:T.promptMode}:(e.get().addProgress("Skip auto-heal retry because this action is not eligible.","system"),{type:"halt"})}if(T.type==="halt")return{type:"halt"}}return{type:"complete"}}finally{EU()}},e_=async({action:t,runtime:e,markTrace:n})=>{var y,S,_,T;if(!wT(t))return n("failed","No AI text response provided.",{errorCode:ze.MISSING_TEXT}),{type:"continue",observation:{status:"error",errorCode:ze.MISSING_TEXT}};const s=sT(t.text??""),i=hT(t.text),o=t.responseType==="await_user",u=!!((y=t.meta)!=null&&y.awaitUser)||o;if(u&&s.length===0){const C='SYSTEM NOTE: Your previous message asked the user for a choice but did not include explicit options. Restate the question and list at least two options using a numbered format (e.g., "1)  2) ").';return e.get().addProgress("Await-user question lacked explicit options. Asking the AI to restate it with numbered choices...","error"),n("failed","Await-user prompt missing options.",{errorCode:ze.VALIDATION_FAILED}),{type:"retry",reason:"Await-user prompt missing selectable options.",retryPrompt:C,userFacingMessage:"The assistant needed to restate the question with concrete options. Retrying...",progressMessage:"Requesting a multiple-choice restatement from the assistant...",phaseMessage:"Rephrasing question to include explicit options...",statusMessage:"Rebuilding prompt with options...",promptMode:"full",observation:{status:"error",errorCode:ze.VALIDATION_FAILED,outputs:{issue:"missing_options"}}}}const d=u||s.length>0||i;if(d){const C=t.meta??(t.meta={});C.awaitUser=!0,C.haltAfter=!0,C.promptId||(C.promptId=bo())}const m=!e.memoryTagAttached&&e.memorySnapshot.length>0,f={sender:"ai",text:t.text,timestamp:new Date,type:"ai_message",cardId:t.cardId,usedMemories:m?e.memorySnapshot:void 0,meta:t.meta};return e.set(C=>({chatHistory:[...C.chatHistory,f]})),sO(e),m&&(e.memoryTagAttached=!0),n("succeeded","Shared response with user."),d?(Qm(e,{promptId:((S=t.meta)==null?void 0:S.promptId)??null,blockedReason:((_=t.text)==null?void 0:_.trim())||null,stateTagOverride:"awaiting_clarification"}),{type:"halt",observation:{status:"pending",outputs:{awaitUser:!0,promptId:((T=t.meta)==null?void 0:T.promptId)??null,quickChoices:s}}}):{type:"continue",observation:{status:"success",outputs:{textPreview:t.text.slice(0,200),cardId:t.cardId??null}}}},bO=async({action:t,runtime:e,markTrace:n})=>{var y,S,_,T,C,N;if(!ia(t))return n("failed","Missing plan state payload.",{errorCode:ze.PLAN_STATE_PAYLOAD_MISSING}),{type:"continue",observation:{status:"error",errorCode:ze.PLAN_STATE_PAYLOAD_MISSING}};const s=t.planState,i=To(s.nextSteps),o=To(s.steps),u=((y=i[0])==null?void 0:y.id)??((S=o[0])==null?void 0:S.id)??((_=e.get().plannerPendingSteps[0])==null?void 0:_.id)??ko,d=typeof s.planId=="string"&&s.planId.trim().length>0?s.planId.trim():((T=e.get().plannerSession.planState)==null?void 0:T.planId)??`plan-${Date.now().toString(36)}`,m=typeof s.currentStepId=="string"&&s.currentStepId.trim().length>=3?s.currentStepId.trim():u,f={planId:d,goal:s.goal.trim(),progress:s.progress.trim(),nextSteps:i,steps:o.length>0?o:i,currentStepId:m,blockedBy:((C=s.blockedBy)==null?void 0:C.trim())||null,contextSummary:((N=s.contextSummary)==null?void 0:N.trim())||null,observationIds:Array.isArray(s.observationIds)?s.observationIds.filter(E=>typeof E=="string"&&E.trim().length>0):[],confidence:typeof s.confidence=="number"?Math.min(1,Math.max(0,s.confidence)):s.confidence??null,updatedAt:s.updatedAt||new Date().toISOString(),stateTag:oc(s.stateTag)??null};return e.get().updatePlannerPlanState(f),e.get().addProgress(`Plan goal updated: ${f.goal}`),n("succeeded","Plan state captured."),{type:"continue",observation:{status:"success",outputs:{goal:f.goal,nextSteps:f.nextSteps,blockedBy:f.blockedBy}}}},TO=async({action:t,runtime:e,markTrace:n})=>{const s=e.get().csvData;if(!_T(t)||!s)return n("failed","Missing plan payload or dataset.",{errorCode:ze.MISSING_PLAN_PAYLOAD}),{type:"continue",observation:{status:"error",errorCode:ze.MISSING_PLAN_PAYLOAD}};const i=zU(e,t.plan);if(i)return n("succeeded","Requested metric column clarification before executing plan.",{metadata:{clarificationId:i}}),{type:"halt",observation:{status:"pending",outputs:{clarificationId:i,targetProperty:"valueColumn"}}};const o=await e.deps.runPlanWithChatLifecycle(t.plan,s,e.runId);return n("succeeded",`Executed plan for "${t.plan.title??"analysis"}".`),{type:"continue",observation:{status:"success",outputs:{planTitle:t.plan.title??"analysis",cardsCreated:o.length}}}},CO=async({action:t,runtime:e,markTrace:n})=>{var u,d,m,f,y;if(!xT(t))return n("failed","Missing DOM action payload.",{errorCode:ze.DOM_PAYLOAD_MISSING}),{type:"continue",observation:{status:"error",errorCode:ze.DOM_PAYLOAD_MISSING}};if(!(typeof((u=t.domAction.target)==null?void 0:u.byId)=="string"||typeof((d=t.domAction.target)==null?void 0:d.byTitle)=="string"||typeof((m=t.domAction.target)==null?void 0:m.selector)=="string"||typeof((f=t.domAction.args)==null?void 0:f.cardId)=="string"||typeof((y=t.domAction.args)==null?void 0:y.cardTitle)=="string")){const S="I need you to pick a specific chart before I can perform that action.";e.get().addProgress(S,"error");const _={sender:"ai",text:`${S} Please tap the chart or tell me its title so I can continue.`,timestamp:new Date,type:"ai_message",isError:!0};return e.set(T=>({chatHistory:[...T.chatHistory,_]})),n("succeeded","DOM action skipped due to missing target.",{metadata:{downgraded:!0}}),{type:"continue",observation:{status:"success",outputs:{downgraded:!0}}}}const i=mO(e,t.domAction);if(i){e.get().addProgress(i);const S={sender:"ai",text:i,timestamp:new Date,type:"ai_message"};return e.set(_=>({chatHistory:[..._.chatHistory,S]})),n("succeeded","DOM action skipped (already satisfied).",{metadata:{skipped:!0,toolName:t.domAction.toolName}}),{type:"continue",observation:{status:"success",outputs:{skipped:!0,reason:i}}}}const o=t.domAction.args??(t.domAction.args={});if(typeof o.cardId!="string"||o.cardId.trim().length===0){const S=jU(e,t.domAction);return n("succeeded","Requested card selection before executing DOM action.",{metadata:{clarificationId:S}}),S?{type:"halt",observation:{status:"pending",outputs:{clarificationId:S,awaitingCardSelection:!0}}}:{type:"halt",observation:{status:"error",errorCode:ze.DOM_PAYLOAD_MISSING}}}return e.get().executeDomAction(t.domAction),n("succeeded",`DOM action ${t.domAction.toolName} completed.`),{type:"continue",observation:{status:"success",outputs:{toolName:t.domAction.toolName,args:t.domAction.args??null},uiDelta:t.domAction.toolName}}},AO=async({action:t,runtime:e,remainingAutoRetries:n,markTrace:s})=>{const i=e.get().csvData;if(!i){const o="Dataset unavailable for transformation.";e.get().addProgress(o,"error");const u={sender:"ai",text:`${o} I could not run the requested update.`,timestamp:new Date,type:"ai_message",isError:!0};return e.set(d=>({chatHistory:[...d.chatHistory,u]})),s("failed",o,{errorCode:ze.DATASET_UNAVAILABLE}),{type:"continue",observation:{status:"error",errorCode:ze.DATASET_UNAVAILABLE}}}if(!bT(t)){const o="AI requested a data transformation but did not include executable code, so no changes were applied.";e.get().addProgress(o,"error");const u={sender:"ai",text:o,timestamp:new Date,type:"ai_message",isError:!0};return e.set(d=>({chatHistory:[...d.chatHistory,u]})),s("failed","Missing jsFunctionBody in execute_js_code payload.",{errorCode:ze.MISSING_JS_CODE}),{type:"continue",observation:{status:"error",errorCode:ze.MISSING_JS_CODE}}}if(e.get().pendingDataTransform){const o="A previous AI transformation is still awaiting your approval. Please confirm or discard it before running another one.";e.get().addProgress(o,"error");const u={sender:"ai",text:`${o} You can review it in the Data Change banner above the dashboard.`,timestamp:new Date,type:"ai_message",isError:!0};return e.set(d=>({chatHistory:[...d.chatHistory,u]})),s("failed",o,{errorCode:ze.TRANSFORM_PENDING}),{type:"continue",observation:{status:"error",errorCode:ze.TRANSFORM_PENDING}}}try{const o=(U,z)=>{if(Array.isArray(U)&&U.length>0)return U.map(se=>se.name);const oe=z.find(se=>se&&typeof se=="object");return oe?Object.keys(oe):[]},u=U=>{if(!U||U.length===0)return"(none)";const z=U.slice(0,8).join(", ");return U.length>8?`${z}, `:z},d=e.get().columnAliasMap,m=WL(i.data,d),f=k_(m,t.code.jsFunctionBody.trim()),y=ZL(f.data,d),S={...i,data:y},_=yo(S.data),T=_o(_.map(U=>U.name)),C=o(e.get().columnProfiles,i.data),N=o(_,y),E=C.filter(U=>!N.includes(U)),L=N.filter(U=>!C.includes(U)),B=[`Before (${C.length}): ${u(C)}`,`After (${N.length}): ${u(N)}`,E.length?`Removed: ${u(E)}`:null,L.length?`Added: ${u(L)}`:null].filter(Boolean).join(`
`),{rowsBefore:O,rowsAfter:x,removedRows:I,addedRows:D,modifiedRows:R}=f.meta,P=[`${O}  ${x} rows`,I?`${I} removed`:null,D?`${D} added`:null,R?`${R} modified`:null].filter(Boolean),A=P.length>0?P.join(", "):"changes detected",k=`transform-${Date.now()}`;e.get().queuePendingDataTransform({id:k,summary:A,explanation:t.code.explanation,meta:f.meta,previewRows:y.slice(0,5),nextData:S,nextColumnProfiles:_,nextAliasMap:T,sourceCode:t.code.jsFunctionBody.trim(),createdAt:new Date().toISOString(),beforeColumns:C,afterColumns:N});const F={sender:"ai",text:`I drafted a data transformation (${A}). Please review the banner above the dashboard to confirm or discard it.

${B}`,timestamp:new Date,type:"ai_message",cardId:t.cardId};return e.set(U=>({chatHistory:[...U.chatHistory,F]})),s("succeeded",`${A} (awaiting confirmation)`),{type:"continue",observation:{status:"success",outputs:{summary:A,rowsBefore:O,rowsAfter:x,pendingTransformId:k}}}}catch(o){const u=o instanceof Error?o.message:String(o);e.get().addProgress(`AI data transformation failed: ${u}`,"error");const d={sender:"ai",text:`I couldn't apply that data transformation: ${u}`,timestamp:new Date,type:"ai_message",isError:!0};e.set(f=>({chatHistory:[...f.chatHistory,d]})),s("failed",u,{errorCode:ze.TRANSFORM_FAILED});const m={status:"error",errorCode:ze.TRANSFORM_FAILED,outputs:{message:u}};return n>0?{type:"retry",reason:u,observation:m}:{type:"halt",observation:m}}},EO=async({action:t,runtime:e,markTrace:n})=>{var u,d;const{query:s,source:i}=Zm(e,((u=t.args)==null?void 0:u.query)??null,((d=e.detectedIntent)==null?void 0:d.intent)==="data_filter"?e.detectedIntent.requiredTool:void 0),o=s===dT;return t.args?t.args.query=s:t.args={query:s},i==="user_message"?e.get().addProgress("No filter payload provided; inferring filter from your latest message."):i==="default"&&e.get().addProgress("No useful filter found; showing the entire dataset so you can refine it."),e.get().addProgress(o?"Showing the full raw dataset for you. Apply a natural-language filter any time.":"AI is filtering the data explorer based on your request."),await e.get().handleNaturalLanguageQuery(s),e.set({isSpreadsheetVisible:!0}),setTimeout(()=>{var m;(m=document.getElementById("raw-data-explorer"))==null||m.scrollIntoView({behavior:"smooth",block:"center"})},100),n("succeeded",`Filter query: ${s}`),{type:"continue",observation:{status:"success",outputs:{query:s,showAll:o},uiDelta:"filter_spreadsheet"}}},NO=async({action:t,runtime:e,markTrace:n})=>{var u;if(!TT(t))return n("failed","Clarification payload missing.",{errorCode:ze.CLARIFICATION_PAYLOAD_MISSING}),{type:"continue",observation:{status:"error",errorCode:ze.CLARIFICATION_PAYLOAD_MISSING}};const s=ek(t.clarification,(u=e.get().csvData)==null?void 0:u.data,e.get().columnProfiles.map(d=>d.name),{preferredColumns:FU(t.clarification.pendingPlan)});if(!s){const d="I could not find any usable columns for that question. Try inspecting the data preview to pick a different column.";e.get().addProgress(d,"error");const m={sender:"ai",text:`${d}
You can also open the Data Preview to double-check column names.`,timestamp:new Date,type:"ai_message",isError:!0,cta:{type:"open_data_preview",label:"Open Data Preview",helperText:"Review the raw columns before asking again."}};return e.set(f=>({chatHistory:[...f.chatHistory,m]})),n("failed","Unable to find usable clarification options.",{errorCode:ze.CLARIFICATION_NO_OPTIONS}),{type:"continue",observation:{status:"error",errorCode:ze.CLARIFICATION_NO_OPTIONS}}}if(!s.options||s.options.length===0){const d="SYSTEM NOTE: Clarification requests must include at least two concrete options the user can pick. Please restate the clarification with enumerated options (e.g., Option A, Option B).";return n("failed","Clarification request missing options.",{errorCode:ze.CLARIFICATION_NO_OPTIONS}),e.get().addProgress("Clarification request missing options. Asking the AI to restate with explicit choices...","error"),{type:"retry",reason:"Clarification request missing options.",retryPrompt:d,userFacingMessage:"Clarification was missing explicit options, so I asked the AI to restate it.",progressMessage:"Requesting a clarification with explicit options...",phaseMessage:"Retrying clarification step...",statusMessage:"Rebuilding clarification request...",promptMode:"full"}}const i=e.deps.registerClarification(s);if(i.options.length===1){const d=i.options[0];return e.get().addProgress(`AI inferred you meant "${d.label}" (${d.value}).`),await e.get().handleClarificationResponse(i.id,d),n("succeeded","Auto-resolved clarification based on single option."),{type:"continue",observation:{status:"success",outputs:{clarificationId:i.id,autoResolved:!0}}}}const o={sender:"ai",text:i.columnHints&&i.columnHints.length>0?`${i.question}

(Column context: ${i.columnHints.join(", ")})`:i.question,timestamp:new Date,type:"ai_clarification",clarificationRequest:i};return e.set(d=>({chatHistory:[...d.chatHistory,o]})),e.set({activeClarificationId:i.id}),pn(e,"clarifying","Need your input to keep going..."),e.get().endBusy(e.runId),Qm(e,{promptId:i.id,blockedReason:i.question,stateTagOverride:"awaiting_clarification"}),n("succeeded","Requested user clarification."),{type:"halt",observation:{status:"pending",outputs:{clarificationId:i.id,optionCount:i.options.length}}}},IO=async({markTrace:t})=>(t("succeeded","Proceed to analysis acknowledged."),{type:"continue",observation:{status:"success"}}),RO={text_response:e_,await_user:e_,plan_creation:TO,plan_state_update:bO,dom_action:CO,execute_js_code:AO,filter_spreadsheet:EO,clarification_request:NO,proceed_to_analysis:IO},oc=t=>{if(!t)return;const e=t.trim();if(!e)return;if(zk.has(e)||lT.test(e))return e;const n=Date.now();n-Yw>jk&&(console.warn(`Unknown agent stateTag "${e}". Allowed values: ${aT.join(", ")} or minted "<epoch>-<seq>" tokens.`),Yw=n)},MO=t=>{const e=Date.now();e-Jw<Yk||(Jw=e,t.get().addToast("AI ","info"))};class PO{constructor(e){this.set=e.set,this.get=e.get,this.deps=e.deps,this.policy=e.policy??$k}async handleMessage(e){var T,C;const n=e.trim(),s={sender:"user",text:e,timestamp:new Date,type:"user_message"},i=this.get(),o=i.datasetHash??null,u=i.plannerDatasetHash??null,d=!!(u&&o&&u!==o),m=sU(e),f=fT.test(n),y=gk(e,i);if(y.intent!=="unknown"){const N=((T=y.requiredTool)==null?void 0:T.domToolName)??((C=y.requiredTool)==null?void 0:C.responseType)??"n/a";i.addProgress(`[IntentRouter] Detected intent=${y.intent} (conf=${y.confidence.toFixed(2)}) tool=${N}`)}const S=bU(y,i);(d||m||f&&i.plannerSession.planState)&&(i.resetPlannerObservations(),i.clearPlannerPlanState(),d?i.addProgress("Detected new dataset; resetting the analysis plan tracker."):m?i.addProgress("Resetting the analysis plan as requested."):f&&i.addProgress("Greeting detected; starting a fresh plan for this interaction.")),this.set({agentAwaitingUserInput:!1,agentAwaitingPromptId:null});const _=this.get().beginBusy("Working on your request...",{cancellable:!0});this.set(N=>({chatHistory:[...N.chatHistory,s]}));try{const N=await XU(e,this.get,this.deps,_);if(this.get().isRunCancellationRequested(_)){this.get().addProgress("Stopped processing request.");return}await SO(e,N,{set:this.set,get:this.get,deps:this.deps,runId:_,userMessage:e,memorySnapshot:N.memorySnapshot,memoryTagAttached:!1,starterActionsShared:!1,policy:this.policy,intentNotes:S,detectedIntent:y,intentRequirementSatisfied:!(y!=null&&y.requiredTool)})}catch(N){if(!this.get().isRunCancellationRequested(_)){const E=N instanceof Error?N.message:String(N);this.get().addProgress(`Error: ${E}`,"error");const L={sender:"ai",text:`Sorry, an error occurred: ${E}`,timestamp:new Date,type:"ai_message",isError:!0};this.set(B=>({chatHistory:[...B.chatHistory,L]}))}}finally{this.get().pendingClarifications.some(N=>N.status==="pending"||N.status==="resolving")||this.get().endBusy(_),this.get().clearChatMemoryPreview()}}}const DO=(t,e,n)=>{const s=new PO({set:t,get:e,deps:n});return{chatMemoryPreview:[],chatMemoryExclusions:[],chatMemoryPreviewQuery:"",isMemoryPreviewLoading:!1,handleChatMessage:async i=>{if(!e().isApiKeySet){e().addProgress("API Key not set.","error"),e().setIsSettingsModalOpen(!0);return}await s.handleMessage(i)},previewChatMemories:async i=>{const o=i.trim();if(!o){t({chatMemoryPreview:[],chatMemoryExclusions:[],chatMemoryPreviewQuery:"",isMemoryPreviewLoading:!1});return}if(!Ke.getIsInitialized()||Ke.getDocumentCount()===0){t({chatMemoryPreview:[],chatMemoryExclusions:[],chatMemoryPreviewQuery:o,isMemoryPreviewLoading:!1});return}t({chatMemoryPreviewQuery:o,isMemoryPreviewLoading:!0});try{const u=await Ke.search(o,3);e().chatMemoryPreviewQuery===o&&t({chatMemoryPreview:u,chatMemoryExclusions:[],isMemoryPreviewLoading:!1})}catch(u){console.error("Preview memory search failed:",u),e().chatMemoryPreviewQuery===o&&t({isMemoryPreviewLoading:!1})}},toggleMemoryPreviewSelection:i=>{t(o=>({chatMemoryExclusions:o.chatMemoryExclusions.includes(i)?o.chatMemoryExclusions.filter(d=>d!==i):[...o.chatMemoryExclusions,i]}))},clearChatMemoryPreview:()=>{t({chatMemoryPreview:[],chatMemoryExclusions:[],chatMemoryPreviewQuery:"",isMemoryPreviewLoading:!1})},handleClarificationResponse:async(i,o)=>{const{csvData:u,columnProfiles:d}=e(),m=e().pendingClarifications.find(y=>y.id===i&&y.status==="pending");if(!m||!u)return;const f={sender:"user",text:`Selected: ${o.label}`,timestamp:new Date,type:"user_message"};t(y=>({chatHistory:[...y.chatHistory,f]})),await $p({beginBusy:e().beginBusy,endBusy:e().endBusy},"Applying clarification...",async y=>{try{n.updateClarificationStatus(i,"resolving");const{pendingPlan:S,targetProperty:_}=m,T=()=>{t(x=>({pendingClarifications:x.pendingClarifications.map(I=>I.id===i?{...I,status:"resolved"}:I),agentAwaitingUserInput:!1,agentAwaitingPromptId:x.agentAwaitingPromptId===i?null:x.agentAwaitingPromptId,activeClarificationId:x.activeClarificationId===i?null:x.activeClarificationId}))};if(m.contextType==="dom_action"&&(S!=null&&S.domActionContext)){const x=S.domActionContext,I={...x.args??{},cardId:o.value,cardTitle:o.label};e().executeDomAction({toolName:x.toolName,args:I}),n.updateClarificationStatus(i,"resolved"),t(D=>({chatHistory:[...D.chatHistory,{sender:"ai",text:x.toolName==="removeCard"?`Removed the chart "${o.label}".`:`Updated the chart "${o.label}".`,timestamp:new Date,type:"ai_message"}]})),T(),e().addProgress(`Applied ${x.toolName} to "${o.label}".`);return}const C=d.map(x=>x.name),N=nT(o,_,C);if(xo.includes(_)&&(!N||!C.includes(N))){const x=`I couldn't find a column matching "${o.label}". Please pick another option so I know which column to use.`;e().addProgress(x,"error");const I={sender:"ai",text:x,timestamp:new Date,type:"ai_message",isError:!0};t(D=>({chatHistory:[...D.chatHistory,I]})),n.updateClarificationStatus(i,"pending");return}const E=_==="groupByColumn",L=E?Ou(N,u.data,2,50):Ou(N,u.data);if(xo.includes(_)&&N&&!L){const x=E?`The column "${N}" doesn't look like a good grouping (not enough distinct categories). Please pick another option.`:`Looks like "${N}" does not contain data right now. Please pick another option or ask about a different metric.`;e().addProgress(x,"error");const I={sender:"ai",text:x,timestamp:new Date,type:"ai_message",isError:!0};t(D=>({chatHistory:[...D.chatHistory,I]})),n.updateClarificationStatus(i,"pending");return}const B={...S,[_]:N??o.value},O=tk(B,d);if(O.aggregation||(O.aggregation=O.valueColumn?"sum":"count"),O.chartType||(O.chartType="bar"),O.chartType!=="scatter"&&(delete O.xValueColumn,delete O.yValueColumn),O.chartType!=="combo"&&(delete O.secondaryValueColumn,delete O.secondaryAggregation),!O.groupByColumn&&O.chartType!=="scatter"){const x=d.map(R=>R.name);let I=null;const D=[...x].sort((R,P)=>P.length-R.length);for(const R of D){const P=R.toLowerCase().replace(/_/g," ");if(o.label.toLowerCase().includes(P)){I=R;break}}if(I)O.groupByColumn=I,e().addProgress(`AI inferred grouping by "${I}" based on your selection.`);else{const{column:R}=Zb(d,u.data);R&&(O.groupByColumn=R,e().addProgress(`AI inferred grouping by "${R}" based on your dataset.`))}}if(O.title||(O.title=`Analysis of ${o.label}`),O.description||(O.description=`A chart showing an analysis of ${o.label}.`),O.chartType!=="scatter"&&(!O.chartType||!O.groupByColumn||!O.aggregation)){const x=["chartType","groupByColumn","aggregation"].filter(I=>!O[I]);throw x.includes("groupByColumn")?new Error("/ grouping column (system could not infer the grouping column)."):new Error(`The clarified plan is still missing required fields like ${x.join(", ")}.`)}await n.runPlanWithChatLifecycle(O,u,y),n.updateClarificationStatus(i,"resolved"),T()}catch(S){if(!e().isRunCancellationRequested(y)){const _=S instanceof Error?S.message:String(S);e().addProgress(`Error processing clarification: ${_}`,"error");const T={sender:"ai",text:`Sorry, an error occurred while creating the chart: ${_}`,timestamp:new Date,type:"ai_message",isError:!0};t(C=>({chatHistory:[...C.chatHistory,T]})),n.updateClarificationStatus(i,"pending")}}},{cancellable:!0})},skipClarification:i=>{const o=e().pendingClarifications.find(m=>m.id===i&&m.status==="pending");if(!o)return;const u={sender:"user",text:`Skipped: ${o.question}`,timestamp:new Date,type:"user_message"},d={sender:"ai",text:"No problemI cancelled that request. Ask me something else whenever you are ready.",timestamp:new Date,type:"ai_message"};n.updateClarificationStatus(i,"skipped"),t(m=>({chatHistory:[...m.chatHistory,u,d],pendingClarifications:m.pendingClarifications.map(f=>f.id===i?{...f,status:"skipped"}:f),agentAwaitingUserInput:!1,agentAwaitingPromptId:m.agentAwaitingPromptId===i?null:m.agentAwaitingPromptId,activeClarificationId:m.activeClarificationId===i?null:m.activeClarificationId})),e().endBusy()}}},LO=25,kO=t=>{let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n),e|=0;return Math.abs(e).toString(36)},Bu=t=>{if(!t||!t.data)return null;const e=t.data.slice(0,LO),n=JSON.stringify({name:t.fileName??"unknown",rows:t.data.length,sample:e,columns:e[0]?Object.keys(e[0]):[]});return`ds_${kO(n)}`},ET=2e3,UO=1e3,NT=3e3,IT=3e3,OO=5e3,qO="<NULL>",t_=(t,e)=>typeof t=="number"&&t>0?Math.min(e,t):e,Uo=t=>({trimWhitespace:(t==null?void 0:t.trimWhitespace)??!0,caseStrategy:(t==null?void 0:t.caseStrategy)??"lower",nullReplacement:(t==null?void 0:t.nullReplacement)??qO}),BO=(t,e)=>{const n=e==null?void 0:e.rowCountHint,s=(e==null?void 0:e.preferredMode)==="full"||(e==null?void 0:e.preferredMode)===void 0,i=new Date().toISOString();return{datasetId:t,mode:s?"full":"sample",allowFullScan:s,sampleSize:t_(n,NT),profileSampleSize:t_(n,ET),timeoutMs:IT,updatedAt:i,stringStrategy:Uo()}},FO=(t,e)=>({...t,...e,datasetId:t.datasetId,updatedAt:new Date().toISOString(),stringStrategy:Uo({...t.stringStrategy,...e.stringStrategy})}),$O=t=>t?{...t,stringStrategy:Uo(t.stringStrategy)}:null,RT=t=>({strategy:t,pipeline:[t.trimWhitespace?"trim":"preserve-whitespace","toString",t.caseStrategy==="lower"?"toLowerCase":"case-as-is",`nullCoalesce(${t.nullReplacement})`]}),eh="csv_agent_db",n_=5,$a="provenance",xs="clean_rows",En="columns",jn="views",Kr="preparation_log",bs="memory_snapshots",Ts="dataset_runtime_config",Ao="system_meta",s_="csv_agent_db is in read-only fallback because the last migration failed. Close other tabs or clear site data, then reload.",HO=32;let La=null,bu=null,Yp=!1,ho=null;const go=[],GO=t=>{if(!(t!=null&&t.stringStrategy))return!0;const{caseStrategy:e,trimWhitespace:n,nullReplacement:s}=t.stringStrategy;return typeof n!="boolean"||e!=="as-is"&&e!=="lower"||typeof s!="string"||s.length===0},VO=async t=>{const e=$O(t??null);return t&&e&&GO(t)&&await sh(e),e},lc=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,zO=[{version:1,description:"Initialize core CSV Agent object stores.",up:t=>{[$a,xs,En,jn,Kr,bs,Ts].forEach(n=>i_(t,n))}},{version:5,description:"Add system meta store for migration logging.",up:t=>{i_(t,Ao)}}],jO=t=>{var e;if((e=t==null?void 0:t.db)!=null&&e.objectStoreNames.contains(Ao))try{const n=t.objectStore(Ao);for(;go.length>0;){const s=go[0];n.put(s),go.shift()}}catch(n){console.warn("Failed to persist migration log entry.",n)}},a_=(t,e)=>{const n={id:`migration-${e.version}-${lc()}`,type:"migration",version:e.version,description:e.description,status:e.status,error:e.error??null,createdAt:new Date().toISOString()};go.push(n),jO(t)},YO=(t,e,n,s)=>{if(!s)return;const i=zO.filter(o=>o.version>n&&o.version<=s).sort((o,u)=>o.version-u.version);for(const o of i)try{o.up(t,e),a_(e,{version:o.version,description:o.description,status:"succeeded"})}catch(u){throw ho=o.version,a_(e,{version:o.version,description:o.description,status:"failed",error:u instanceof Error?u.message:String(u)}),u}},JO=(t,e)=>{const n=e.filter(s=>!t.objectStoreNames.contains(s));if(n.length>0)throw new Error(`Missing object stores: ${n.join(", ")}`)},r_=async()=>(bu||(bu=Ym(eh,void 0,{blocked:()=>console.warn("csv_agent_db read-only open is blocked by another tab.")})),bu),MT=async()=>{await new Promise((t,e)=>{const n=indexedDB.deleteDatabase(eh);n.onsuccess=()=>t(),n.onerror=()=>e(n.error),n.onblocked=()=>console.warn("IndexedDB delete blocked. Close other tabs to proceed.")}),La=null,bu=null,Yp=!1,ho=null,go.length=0},i_=(t,e)=>{if(!t.objectStoreNames.contains(e)){if(e===xs){t.createObjectStore(e,{keyPath:"chunkId"}).createIndex("by_dataset","datasetId",{unique:!1});return}if(e===En){t.createObjectStore(e,{keyPath:"datasetId"});return}if(e===jn){t.createObjectStore(e,{keyPath:"id"}).createIndex("by_dataset","datasetId",{unique:!1});return}if(e===$a){t.createObjectStore(e,{keyPath:"datasetId"});return}if(e===Kr){t.createObjectStore(e,{keyPath:"id"}).createIndex("by_dataset","datasetId",{unique:!1});return}if(e===bs){const n=t.createObjectStore(e,{keyPath:"id"});n.createIndex("by_dataset","datasetId",{unique:!1}),n.createIndex("by_view","viewId",{unique:!1});return}if(e===Ts){t.createObjectStore(e,{keyPath:"datasetId"});return}if(e===Ao){const n=t.createObjectStore(e,{keyPath:"id"});n.createIndex("by_type","type",{unique:!1}),n.createIndex("by_version","version",{unique:!1});return}throw new Error(`Unsupported store name: ${e}`)}},KO=async t=>{try{return await t()}catch(e){if(e instanceof DOMException&&e.name==="VersionError")return console.warn("IndexedDB version mismatch detected. Resetting csv_agent_db...",e),await MT(),t();throw e}},XO=[$a,xs,En,jn,Kr,bs,Ts,Ao],Nn=async(t=[],e)=>{const n=(e==null?void 0:e.mode)??"readonly",s=Array.from(new Set([...XO,...t]));if(Yp){if(n==="readwrite")throw new Error(s_);return r_()}La||(ho=null,La=KO(()=>Ym(eh,n_,{upgrade(i,o,u,d){YO(i,d,o,u??n_)},blocked:()=>console.warn("csv_agent_db upgrade is blocked by another tab."),blocking:()=>console.warn("csv_agent_db upgrade is blocking existing tabs. Reload others to proceed."),terminated:()=>{La=null}})));try{const i=await La;return JO(i,s),i}catch(i){if(ho!==null){if(console.error(`csv_agent_db migration to version ${ho} failed; entering read-only fallback.`,i),Yp=!0,La=null,n==="readwrite")throw new Error(s_);return r_()}throw La=null,i}},QO=(t,e)=>{const n=[];for(let s=0;s<t.length;s+=e)n.push(t.slice(s,s+e));return n},WO=async t=>{const{datasetId:e,rows:n,columns:s,provenance:i,chunkSize:o=2e4}=t;if(!e)throw new Error("persistCleanDataset requires datasetId.");const u=async m=>{const y=(await Nn([xs,En,jn],{mode:"readwrite"})).transaction([xs,En,$a],"readwrite"),S=y.objectStore(xs),_=y.objectStore(En),T=y.objectStore($a),C=QO(n,o),N=new Date().toISOString();try{let L=await S.index("by_dataset").openCursor(e);for(;L;)await L.delete(),L=await L.continue();for(let x=0;x<C.length;x+=1){const I=C[x],D={chunkId:`${e}-chunk-${x}`,datasetId:e,rowCount:I.length,startRow:x*o,endRow:x*o+I.length-1,rows:I,createdAt:N};await S.put(D)}const B={datasetId:e,columnCount:s.length,columns:s,rowCount:n.length,updatedAt:N};await _.put(B);const O={datasetId:e,fileName:i.fileName,bytes:i.bytes,checksum:i.checksum,cleanedAt:i.cleanedAt,normalization:RT(m.stringStrategy)};return await T.put(O),await y.done,{chunkCount:C.length,rowCount:n.length}}catch(E){try{y.abort()}catch{}throw await y.done.catch(()=>{}),E}},d=async()=>{const m=await ah(e,{rowCountHint:n.length});return u(m)};try{return await d()}catch(m){if(m instanceof DOMException&&m.name==="NotFoundError")return console.warn("IndexedDB store missing detected. Resetting and retrying persist...",m),await MT(),d();throw m}},ZO=async t=>{const{datasetId:e,title:n,kind:s,queryHash:i,explainer:o,dataRef:u}=t,m=(await Nn([jn],{mode:"readwrite"})).transaction(jn,"readwrite"),f=m.objectStore(jn),y=`${e}-view-${lc()}`,S={id:y,datasetId:e,title:n,kind:s,queryHash:i,explainer:o,dataRef:u,createdAt:new Date().toISOString()};return await f.put(S),await m.done,y},e3=async t=>{const e=await Nn([jn]);try{const n=e.transaction(jn,"readonly"),o=await n.objectStore(jn).index("by_dataset").getAll(t);return await n.done,o}catch(n){return console.warn(`Failed to read card results for ${t}`,n),[]}},PT=async t=>{const n=(await Nn()).transaction($a,"readonly"),i=await n.objectStore($a).get(t);return await n.done,i??void 0},th=async t=>{const n=(await Nn([En])).transaction(En,"readonly"),i=await n.objectStore(En).get(t);return await n.done,i??null},nh=async(t,e)=>{const s=(await Nn([xs])).transaction(xs,"readonly"),o=s.objectStore(xs).index("by_dataset");let u=!1;const d=()=>{u=!0};let m=await o.openCursor(t);for(;m&&!u;){const f=m.value;if(await e(f,d),u)break;m=await m.continue()}await s.done},t3=async t=>{let e=0;return await nh(t,n=>{const s=typeof n.rowCount=="number"?n.rowCount:n.rows.length;e+=s}),e};async function DT(t){const n=(await Nn([Ts])).transaction(Ts,"readonly"),i=await n.objectStore(Ts).get(t);return await n.done,VO(i)}async function sh(t){const n=(await Nn([Ts],{mode:"readwrite"})).transaction(Ts,"readwrite");await n.objectStore(Ts).put(t),await n.done}async function ah(t,e){const n=await DT(t);if(n)return n;const s=BO(t,{rowCountHint:e==null?void 0:e.rowCountHint,preferredMode:e==null?void 0:e.preferredMode});return await sh(s),s}async function n3(t,e,n){const s=await ah(t,{rowCountHint:n==null?void 0:n.rowCountHint}),i=FO(s,e);return await sh(i),i}const LT=async(t,e)=>{const n=[];return await nh(t,(s,i)=>{for(const o of s.rows)if(n.push(o),n.length>=e){i();break}}),n},kT=async t=>{const e=[];return await nh(t,n=>{e.push(...n.rows)}),e},s3=(t,e)=>{const n=new Date().toISOString();return e.map((s,i)=>({...s,datasetId:t,id:s.id??`${t}-prep-${lc()}`,stepOrder:typeof s.stepOrder=="number"?s.stepOrder:i,scope:s.scope??"dataset",columnName:s.columnName??null,source:s.source??"ai_plan",tags:s.tags??[],createdAt:s.createdAt??n}))},o_=async(t,e=[])=>{if(!t)throw new Error("replacePreparationLog requires datasetId.");const s=(await Nn([Kr],{mode:"readwrite"})).transaction(Kr,"readwrite"),i=s.objectStore(Kr);let u=await i.index("by_dataset").openCursor(t);for(;u;)await u.delete(),u=await u.continue();if(e.length>0){const d=s3(t,e).sort((m,f)=>m.stepOrder-f.stepOrder||new Date(m.createdAt).getTime()-new Date(f.createdAt).getTime());for(const m of d)await i.put(m)}await s.done},a3=async(t,e,n=HO)=>{const s=await t.index("by_dataset").getAll(e);if(s.length<=n)return;const i=s.sort((d,m)=>{const f=(m.qualityScore??0)-(d.qualityScore??0);return f!==0?f:new Date(m.createdAt).getTime()-new Date(d.createdAt).getTime()}).slice(0,n),o=new Set(i.map(d=>d.id)),u=s.filter(d=>!o.has(d.id));for(const d of u)await t.delete(d.id)},r3=async t=>{var o,u;if(!t.datasetId)throw new Error("saveMemorySnapshot requires datasetId.");const n=(await Nn([bs],{mode:"readwrite"})).transaction(bs,"readwrite"),s=n.objectStore(bs),i={...t,id:t.id??t.viewId??t.cardId??`${t.datasetId}-memo-${lc()}`,createdAt:t.createdAt??new Date().toISOString(),plan:t.plan??null,viewId:t.viewId??null,cardId:t.cardId??null,summary:t.summary??"",title:t.title??"Untitled View",sampleRows:t.sampleRows??[],tags:t.tags??[],chartType:t.chartType??((o=t.plan)==null?void 0:o.chartType),queryHash:t.queryHash??null,rowCount:typeof t.rowCount=="number"?t.rowCount:((u=t.sampleRows)==null?void 0:u.length)??0,sampled:t.sampled??!1,expiresAt:t.expiresAt??null};return await s.put(i),await a3(s,i.datasetId),await n.done,i.id},i3=async(t,e)=>{if(!t)return[];const n=await Nn([bs]);try{const s=n.transaction(bs,"readonly"),u=await s.objectStore(bs).index("by_dataset").getAll(t);await s.done;const d=u.filter(f=>e!=null&&e.minScore?(f.qualityScore??0)>=e.minScore:!0).filter(f=>{var y;return e!=null&&e.tag?(y=f.tags)==null?void 0:y.includes(e.tag):!0}).sort((f,y)=>{const S=(y.qualityScore??0)-(f.qualityScore??0);return S!==0?S:new Date(y.createdAt).getTime()-new Date(f.createdAt).getTime()}),m=(e==null?void 0:e.limit)??d.length;return d.slice(0,m)}catch(s){return console.warn(`Failed to read memory snapshots for ${t}`,s),[]}},o3=2e3,l3=async t=>{try{const[e,n]=await Promise.all([LT(t,o3),t3(t)]);if(n===0||e.length===0)return console.warn(`CSV Agent: unable to rebuild column metadata for ${t} because the dataset has no cached rows.`),null;const s=yo(e),i={datasetId:t,columnCount:s.length,columns:s,rowCount:n,updatedAt:new Date().toISOString()},u=(await Nn([En],{mode:"readwrite"})).transaction(En,"readwrite");return await u.objectStore(En).put(i),await u.done,console.info(`CSV Agent: rebuilt missing column metadata for dataset ${t}.`),i}catch(e){return console.error(`CSV Agent: failed to rebuild column metadata for dataset ${t}.`,e),null}},u3=async t=>{const e=await th(t);return e||l3(t)},pt={FULL_SCAN_BLOCKED:"FULL_SCAN_BLOCKED",AGG_TIMEOUT:"AGG_TIMEOUT",COLUMN_METADATA_MISSING:"COLUMN_METADATA_MISSING",VERSION_ERROR:"VERSION_ERROR",ORIGIN_BLOCKED:"ORIGIN_BLOCKED",DATASET_UNCHANGED:"DATASET_UNCHANGED",INDEXEDDB_UNAVAILABLE:"INDEXEDDB_UNAVAILABLE",UNKNOWN:"UNKNOWN"},c3="COLUMN_METADATA_MISSING",rh=()=>{throw Object.assign(new Error(pt.COLUMN_METADATA_MISSING),{code:pt.COLUMN_METADATA_MISSING})},d3=t=>{let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n),e|=0;return Math.abs(e).toString(36)},UT=t=>{const e=t.caseStrategy==="lower"?n=>n.toLowerCase():n=>n;return n=>{if(n==null)return t.nullReplacement;let s=typeof n=="string"?n:String(n);return t.trimWhitespace&&(s=s.trim()),s.length===0?t.nullReplacement:e(s)}},f3=UT(Uo()),p3=(t,e=f3)=>e(t),m3=(t,e,n=3)=>{const s=[];for(const i of t){const o=i[e];if(o==null||o==="")continue;const u=p3(o);if(u&&(s.includes(u)||s.push(u),s.length>=n))break}return s},h3=async(t,e)=>{const{datasetId:n,sampleSize:s=ET}=e;if(!n)throw new Error("datasetId is required for profiling.");const[i,o]=await Promise.all([t.readColumnStoreRecord(n),t.readSampledRows(n,s)]);if(i||rh(),o.length===0)throw new Error("No rows available to profile.");const d=yo(o).map(f=>({name:f.name,type:f.type,distinct:f.uniqueValues??new Set(o.map(y=>y[f.name])).size,emptyPercentage:f.missingPercentage??0,examples:m3(o,f.name)})),m=[];return i.rowCount>o.length&&m.push(`Profiled ${o.length.toLocaleString()} rows (sample) out of ${i.rowCount.toLocaleString()}.`),{rowCount:i.rowCount,sampledRows:o.length,columns:d,warnings:m}},g3=(t,e,n)=>!e||e.length===0?!0:e.every(s=>{const i=t[s.column],o=n(i),u=n(s.value??""),d=m=>s.caseInsensitive?m.toLowerCase():m;switch(s.op){case"eq":return d(o)===d(u);case"neq":return d(o)!==d(u);case"gt":return Number(o)>Number(u);case"gte":return Number(o)>=Number(u);case"lt":return Number(o)<Number(u);case"lte":return Number(o)<=Number(u);case"contains":{const m=o.toLowerCase(),f=u.toLowerCase();return m.includes(f)}case"in":{if(!Array.isArray(s.values))return!1;const m=s.values.map(S=>n(S)),f=new Set(m.map(S=>s.caseInsensitive?S.toLowerCase():S)),y=s.caseInsensitive?o.toLowerCase():o;return f.has(y)}default:return!0}}),l_=(t,e,n,s,i)=>{var x;const o=e.mode??"full";if(!Array.isArray(e.metrics)||e.metrics.length===0)throw new Error("metrics[] is required for aggregation.");if(o==="full"&&!e.allowFullScan)throw Object.assign(new Error(pt.FULL_SCAN_BLOCKED),{code:pt.FULL_SCAN_BLOCKED});const u=e.by??[],d=new Map,m=((x=e.filter)==null?void 0:x.length)??0,f=e.timeoutMs??IT,y=(typeof performance<"u"?performance.now():Date.now())+f,S=Uo(i),_=UT(S);for(const I of t){if(!g3(I,e.filter,_))continue;if((typeof performance<"u"?performance.now():Date.now())>y){if(o==="full")throw new Error("AGG_TIMEOUT");break}const R=u.map(k=>_(I[k])),P=R.length>0?R.join("||"):"__total__";if(!d.has(P)){const k={};u.forEach((U,z)=>{k[U]=R[z]});const F={};e.metrics.forEach(U=>{const z=U.as??`${U.fn}_${U.column??"rows"}`;F[z]={sum:0,count:0,min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY}}),d.set(P,{keys:k,accumulators:F})}const A=d.get(P);e.metrics.forEach(k=>{const F=k.as??`${k.fn}_${k.column??"rows"}`,U=A.accumulators[F];if(k.fn==="count"){U.count+=1,U.sum+=1;return}if(!k.column)throw new Error(`Metric ${k.fn} requires a column.`);const z=mn(I[k.column]);z!==null&&(U.count+=1,U.sum+=z,U.min=Math.min(U.min,z),U.max=Math.max(U.max,z))})}const T=I=>{if(!I||!s)return"number";const D=s.find(R=>R.name===I);return!D||D.type==="numerical"?"number":D.type},C=[...u.map(I=>{var D;return{name:I,type:((D=s==null?void 0:s.find(R=>R.name===I))==null?void 0:D.type)??"string"}}),...e.metrics.map(I=>({name:I.as??`${I.fn}_${I.column??"rows"}`,type:I.fn==="count"?"number":T(I.column)}))],N=[];for(const I of d.values()){const D={...I.keys};e.metrics.forEach(R=>{const P=R.as??`${R.fn}_${R.column??"rows"}`,A=I.accumulators[P];let k=null;switch(R.fn){case"sum":k=A.sum;break;case"avg":k=A.count>0?A.sum/A.count:null;break;case"count":k=A.count;break;case"min":k=A.min===Number.POSITIVE_INFINITY?null:A.min;break;case"max":k=A.max===Number.NEGATIVE_INFINITY?null:A.max;break}D[P]=k??0}),N.push(D)}e.orderBy&&e.orderBy.length>0&&N.sort((I,D)=>{for(const R of e.orderBy){const P=(R.direction??"desc").toLowerCase()==="asc"?1:-1,A=I[R.column],k=D[R.column];if(A===k)continue;if(A==null)return 1;if(k==null)return-1;if(typeof A=="number"&&typeof k=="number")return A>k?P:-P;const F=String(A).localeCompare(String(k));if(F!==0)return F*P}return 0});const E=typeof e.limit=="number"?N.slice(0,e.limit):N,L=t.length,B=o!=="full"&&L<n,O=[];return B&&O.push("Aggregated on sampled rows. Retry with allowFullScan for full coverage."),{schema:C,rows:E,provenance:{datasetId:e.datasetId,sampled:B,mode:o,processedRows:L,totalRows:n,queryHash:d3(JSON.stringify({by:u,metrics:e.metrics,filter:e.filter,orderBy:e.orderBy,limit:e.limit,mode:o})),filterCount:m,warnings:O,normalization:RT(S)}}},y3=async(t,e)=>{const[n,s]=await Promise.all([t.readColumnStoreRecord(e.datasetId),t.readDatasetRuntimeConfig(e.datasetId)]);n||rh();const i=e.mode??"full",o=i;e.mode=o;const u=e.sampleSize??NT;try{const d=o==="full"?await t.readAllRows(e.datasetId):await t.readSampledRows(e.datasetId,u);if(d.length===0)throw new Error("No rows available for aggregation.");const m=l_(d,e,n.rowCount,n.columns,s==null?void 0:s.stringStrategy);return m.provenance.requestedMode=i,m}catch(d){if(d instanceof Error&&(d.code===pt.FULL_SCAN_BLOCKED||d.message===pt.FULL_SCAN_BLOCKED))throw Object.assign(new Error("Full scan requires confirmation."),{code:pt.FULL_SCAN_BLOCKED});if(d instanceof Error&&d.message==="AGG_TIMEOUT"&&o==="full"){const m=await t.readSampledRows(e.datasetId,u),f=l_(m,{...e,mode:"sample"},n.rowCount,n.columns,s==null?void 0:s.stringStrategy);return f.provenance.warnings.push("Full scan timed out. "),f.provenance.requestedMode=i,f.provenance.downgradedFrom=i,f.provenance.downgradeReason="timeout",f}throw d instanceof Error&&d.message==="AGG_TIMEOUT"?Object.assign(d,{code:pt.AGG_TIMEOUT}):d}},v3=async(t,e)=>{const{datasetId:n,n:s=UO,withColumns:i=!1}=e;if(!n)throw new Error("datasetId is required for sampling.");const[o,u]=await Promise.all([t.readSampledRows(n,s),i?t.readColumnStoreRecord(n):Promise.resolve(null)]);if(i&&!u&&rh(),o.length===0)throw new Error("No rows available to sample.");return{rows:o,sampled:!0,columns:u==null?void 0:u.columns}};let Ba=null;const Hr=new Map;let Tu=null;const S3=()=>{if(typeof window>"u"||typeof Worker>"u")throw new Error("Web Workers are not supported in this environment.");const t=new Worker(new URL("/agent_csv_dataWorker-sxes9h5U.js",import.meta.url),{type:"module"});return t.onmessage=e=>{const n=e.data;if(!n||typeof n.id!="string")return;const s=Hr.get(n.id);s&&(Hr.delete(n.id),s(n))},t.onerror=e=>{console.error("dataWorker runtime error:",e);const n=e!=null&&e.message&&typeof e.message=="string"?`Data worker crashed: ${e.message}`:"Data worker crashed.";Hr.forEach(s=>s({id:"error",ok:!1,reason:n,hint:"Reload and retry your action."})),Hr.clear(),t.terminate(),Ba=null},t},w3=()=>(Ba=Ba??S3(),Ba),_3=async(t,e)=>{try{const n=w3(),s=`${t}-${Date.now()}-${Math.random().toString(36).slice(2,8)}`;return await new Promise(i=>{Hr.set(s,o=>{o.ok&&o.result?i({ok:!0,data:o.result,durationMs:o.durationMs??0}):i({ok:!1,reason:o.reason??"Worker failed to respond.",hint:o.hint,durationMs:o.durationMs,code:o.code})}),n.postMessage({id:s,action:t,payload:e})})}catch(n){return{ok:!1,reason:n instanceof Error?n.message:"Failed to start worker.",hint:"This browser may not support Web Workers. Try a modern Chromium-based browser."}}},x3=t=>{Tu||(Tu=t??"Data worker disabled due to browser limitations.",Ba&&(Ba.terminate(),Ba=null),Hr.clear(),console.warn(`[dataTools] Worker disabled: ${Tu}`))},b3=(t,e)=>{const n=`${t??""} ${e??""}`.toLowerCase();return n.includes("indexeddb")||n.includes("falling back to main thread")},Qr=()=>typeof performance<"u"?performance.now():Date.now(),ih=t=>t instanceof Error?t.message:String(t??"Unknown error"),u_=t=>typeof t!="string"?!1:t.toUpperCase().includes(c3),T3=async t=>{try{return await u3(t)?(console.info(`[dataTools] Rebuilt column metadata for dataset ${t}.`),!0):(console.warn(`[dataTools] Unable to rebuild column metadata for dataset ${t}.`),!1)}catch(e){return console.error(`[dataTools] Failed to recover column metadata for dataset ${t}.`,e),!1}},Zf=async(t,e)=>{let n=await e();if(!t||n.ok||!u_(n.reason))return n;if(!await T3(t))return{ok:!1,reason:"Cached column metadata is unavailable and auto-recovery failed. Please re-upload your CSV.",hint:n.hint,durationMs:n.durationMs};const i=await e();return!i.ok&&u_(i.reason)?{ok:!1,reason:"Cached column metadata is still missing. Please re-upload your CSV.",hint:i.hint,durationMs:i.durationMs}:i},oh={readColumnStoreRecord:th,readSampledRows:LT,readAllRows:kT,readDatasetRuntimeConfig:DT},C3=async(t,e)=>{try{const n=Qr();return{ok:!0,data:await h3(oh,{datasetId:t,sampleSize:e}),durationMs:Qr()-n}}catch(n){return{ok:!1,reason:ih(n)}}},A3=async(t,e)=>{try{const n=Qr();return{ok:!0,data:await v3(oh,{datasetId:t,...e}),durationMs:Qr()-n}}catch(n){return{ok:!1,reason:ih(n)}}},E3=async t=>{try{const e=Qr();return{ok:!0,data:await y3(oh,t),durationMs:Qr()-e}}catch(e){return{ok:!1,reason:ih(e)}}},ep=async(t,e,n)=>{if(Tu)return n();const s=await _3(t,e);return!s.ok&&b3(s.reason,s.hint)?(x3(s.reason??s.hint),n()):s},Ss={profile:(t,e)=>Zf(t,()=>ep("profile",{datasetId:t,sampleSize:e},()=>C3(t,e))),sample:(t,e)=>Zf(t,()=>ep("sample",{datasetId:t,...e??{}},()=>A3(t,e??{}))),aggregate:t=>Zf(t.datasetId,()=>ep("aggregate",t,()=>E3(t))),createCardFromResult:async({datasetId:t,title:e,kind:n,explainer:s,result:i,plan:o})=>{try{const u={schema:i.schema,rows:i.rows,sampled:i.provenance.sampled,source:"aggregate",planSnapshot:o};return{ok:!0,data:{cardId:await ZO({datasetId:t,title:e,kind:n,queryHash:i.provenance.queryHash,explainer:s,dataRef:u})},durationMs:0}}catch(u){return{ok:!1,reason:u instanceof Error?u.message:"Failed to store card.",hint:"Retry after checking IndexedDB permissions."}}}},lh="csv_agent_last_dataset",OT=t=>{try{t()}catch(e){console.warn("Dataset cache error:",e)}},qT=t=>{OT(()=>{typeof localStorage>"u"||localStorage.setItem(lh,t)})},N3=()=>{OT(()=>{typeof localStorage>"u"||localStorage.removeItem(lh)})},I3=()=>{try{return typeof localStorage>"u"?null:localStorage.getItem(lh)}catch(t){return console.warn("Dataset cache read error:",t),null}},R3=t=>{if(!t)return"AI transformation applied (row delta unknown).";const e=[`Rows ${t.rowsBefore.toLocaleString()}  ${t.rowsAfter.toLocaleString()}`];return t.removedRows>0&&e.push(`${t.removedRows.toLocaleString()} removed`),t.addedRows>0&&e.push(`${t.addedRows.toLocaleString()} added`),t.modifiedRows>0&&e.push(`${t.modifiedRows.toLocaleString()} modified`),e.join(", ")},M3=(t,e,n,s)=>{if(!t)return[];const i=[],o=new Map(n.map(m=>[m.name,m])),u=new Map(s.map(m=>[m.name,m]));i.push({stepOrder:0,scope:"rows",columnName:null,rule:"ai_transformation",impactSummary:R3(e),impactMetrics:e?{...e,totalColumnsBefore:n.length,totalColumnsAfter:s.length}:{totalColumnsBefore:n.length,totalColumnsAfter:s.length},details:{explanation:t.explanation,beforeColumns:n.map(m=>({name:m.name,type:m.type})),afterColumns:s.map(m=>({name:m.name,type:m.type}))},source:"ai_plan",tags:["transformation"]});let d=1;return n.filter(m=>!u.has(m.name)).forEach(m=>{i.push({stepOrder:d++,scope:"column",columnName:m.name,rule:"column_removed",impactSummary:`Column "${m.name}" removed during AI cleanup.`,details:{previousType:m.type},source:"ai_plan",tags:["schema","removed"]})}),s.filter(m=>!o.has(m.name)).forEach(m=>{i.push({stepOrder:d++,scope:"column",columnName:m.name,rule:"column_added",impactSummary:`Column "${m.name}" added by AI transformation.`,details:{newType:m.type},source:"ai_plan",tags:["schema","added"]})}),s.filter(m=>{const f=o.get(m.name);return f&&f.type!==m.type}).forEach(m=>{const f=o.get(m.name);i.push({stepOrder:d++,scope:"column",columnName:m.name,rule:"column_type_change",impactSummary:`Column "${m.name}" type normalized from ${(f==null?void 0:f.type)??"unknown"} to ${m.type}.`,details:{previousType:f==null?void 0:f.type,newType:m.type},source:"ai_plan",tags:["schema","type_change"]})}),i},P3=(t,e,n)=>({handleFileUpload:async s=>{var u;const i=e();if(i.csvData&&i.csvData.data.length>0){const d=await wo(sa);if(d){const m=`report-${d.createdAt.getTime()}`,f={...d,id:m,updatedAt:new Date};try{await Bp(f)}catch(y){console.error("Failed to archive current session before upload:",y)}}}Ke.clear(),await Fp(sa),n.resetAutoSaveSession(),await e().loadReportsList(),t({...n.initialAppState,csvData:{fileName:s.name,data:[]},datasetHash:null,busyRunId:null,isCancellationRequested:!1,aiFilterRunId:null,abortControllers:{},toasts:[],chatMemoryPreview:[],chatMemoryExclusions:[],chatMemoryPreviewQuery:"",isMemoryPreviewLoading:!1});const o=e().beginBusy(`Processing ${s.name}...`,{cancellable:!0});try{const d=async N=>{try{const E=await Ss.profile(N);E.ok?e().applyDatasetProfileSnapshot(E.data):e().addProgress(`Profiling failed: ${E.reason}`,"error")}catch(E){console.error("Failed to profile dataset via worker:",E),e().addProgress("Profiling worker failedretry later from chat.","error")}},m=async N=>{try{const E=await Ss.sample(N,{n:200});E.ok&&t({initialDataSample:E.data.rows})}catch(E){console.error("Failed to sample dataset via worker:",E)}},f=async(N,E)=>{try{const L=await PT(N);if(L!=null&&L.checksum&&L.checksum===N){if(!(typeof window>"u"?!0:window.confirm(""))){e().addProgress(" CSV ","system");return}e().addProgress("")}t(O=>({analysisTimeline:{...O.analysisTimeline,stage:"persisting",totalCards:0,completedCards:0}})),e().addProgress("Persisting cleaned dataset for offline reuse");const B=await WO({datasetId:N,rows:S.data,columns:E,provenance:{fileName:s.name,bytes:s.size,checksum:N,cleanedAt:new Date().toISOString()}});qT(N),e().addProgress(`Cached ${B.rowCount} rows in ${B.chunkCount} chunks.`),t(O=>({analysisTimeline:{...O.analysisTimeline,stage:"profiling"}})),await Promise.all([d(N),m(N)])}catch(L){console.error("Failed to persist cleaned dataset:",L),e().addProgress("IndexedDB cache failedrefreshing may lose progress.","error"),t(B=>({analysisTimeline:{...B.analysisTimeline,stage:"idle"}}))}};e().updateBusyStatus("Parsing CSV file...");const y=await CE(s);if(e().addProgress(`Parsed ${y.data.length} rows.`),e().isRunCancellationRequested(o)){e().addProgress("Upload cancelled before analysis.");return}t({initialDataSample:y.data.slice(0,20)});let S=y,_,T=null,C=[];if(e().isApiKeySet){e().updateBusyStatus("Initializing AI memory..."),await Ke.init(e().addProgress),e().addProgress("AI is analyzing data for cleaning and reshaping...");const N=yo(S.data);e().updateBusyStatus("Drafting data preparation plan...");const E=(u=e().createAbortController(o))==null?void 0:u.signal;if(T=await X2(N,S.data.slice(0,20),e().settings,{signal:E,onUsage:O=>{e().recordLlmUsage({provider:O.provider,model:O.model,promptTokens:O.promptTokens,completionTokens:O.completionTokens,totalTokens:O.totalTokens,context:O.operation??"data_prep.plan"})}}),e().isRunCancellationRequested(o)){e().addProgress("Upload cancelled during preparation.");return}if(T&&T.jsFunctionBody){e().addProgress(`AI Plan: ${T.explanation}`),e().addProgress("Executing AI data transformation...");try{const O=k_(S.data,T.jsFunctionBody);S.data=O.data;const{rowsBefore:x,rowsAfter:I,removedRows:D,addedRows:R,modifiedRows:P}=O.meta,A=[`${x}  ${I} rows`];D&&A.push(`${D} removed`),R&&A.push(`${R} added`),P&&A.push(`${P} modified`),e().addProgress(`Transformation complete (${A.join(", ")}).`),C=M3(T,O.meta,N,T.outputColumns)}catch(O){const x=O instanceof Error?O.message:String(O);throw e().addProgress(`Data transformation failed: ${x}`,"error"),O}}else e().addProgress("AI found no necessary data transformations.");if(_=T.outputColumns,S.data.length===0)throw new Error("Dataset empty after transformation.");const L=_o(_.map(O=>O.name)),B=Bu(S);if(!B)throw new Error(" fingerprint");await f(B,_);try{await o_(B,C)}catch(O){console.warn("Failed to persist preparation log entries:",O)}t({csvData:S,columnProfiles:_,columnAliasMap:L,datasetHash:B,datasetRuntimeConfig:null,dataPreparationPlan:T,currentView:"analysis_dashboard"}),await e().handleInitialAnalysis(S,{runId:o})}else{e().addProgress("API Key not set. Please add it in the settings.","error"),e().setIsSettingsModalOpen(!0),_=yo(S.data);const N=_o(_.map(L=>L.name)),E=Bu(S);if(!E)throw new Error("");await f(E,_);try{await o_(E,[])}catch(L){console.warn("Failed to clear preparation log for dataset:",L)}t({csvData:S,columnProfiles:_,columnAliasMap:N,datasetHash:E,datasetRuntimeConfig:null,currentView:"analysis_dashboard"})}}catch(d){if(!e().isRunCancellationRequested(o)){console.error("File processing error:",d);const m=d instanceof Error?d.message:String(d);e().addProgress(`File Processing Error: ${m}`,"error"),t({currentView:"file_upload"})}}finally{e().endBusy(o)}},handleNewSession:async()=>{if(e().csvData){const s=await wo(sa);if(s){const i=`report-${s.createdAt.getTime()}`;try{await Bp({...s,id:i,updatedAt:new Date})}catch(o){console.error("Failed to archive session before starting new one:",o)}}}Ke.clear(),await Fp(sa),n.resetAutoSaveSession(),N3(),t({...n.initialAppState,busyRunId:null,isCancellationRequested:!1,aiFilterRunId:null,abortControllers:{},toasts:[],chatMemoryPreview:[],chatMemoryExclusions:[],chatMemoryPreviewQuery:"",isMemoryPreviewLoading:!1}),await e().loadReportsList()}}),D3=(t,e,n)=>({handleNaturalLanguageQuery:async s=>{var d;if(!e().isApiKeySet||!e().csvData){e().addProgress("Cannot perform AI query: API Key is not set or no data is loaded.","error");return}const i=e().aiFilterRunId;i&&e().abortRunControllers(i);const o=n.createRunId();t({isAiFiltering:!0,aiFilterRunId:o,spreadsheetFilterFunction:null,aiFilterExplanation:null}),e().addProgress(`AI is processing your data query: "${s}"...`);const u=(d=e().createAbortController(o))==null?void 0:d.signal;try{const m=await gL(s,e().columnProfiles,e().csvData.data.slice(0,5),e().settings,{signal:u,onUsage:f=>{e().recordLlmUsage({provider:f.provider,model:f.model,promptTokens:f.promptTokens,completionTokens:f.completionTokens,totalTokens:f.totalTokens,context:f.operation??"filter.generate"})}});t({spreadsheetFilterFunction:m.jsFunctionBody,aiFilterExplanation:m.explanation}),e().addProgress(`AI filter applied: ${m.explanation}`),e().addToast("AI filter applied successfully.","success")}catch(m){if(m instanceof DOMException&&m.name==="AbortError")e().addProgress("AI filter request cancelled."),e().addToast("AI filter cancelled.","info");else{const f=m instanceof Error?m.message:String(m);e().addProgress(`AI query failed: ${f}`,"error"),e().addToast(`AI filter failed: ${f}`,"error")}}finally{e().clearRunControllers(o),t(m=>m.aiFilterRunId===o?{isAiFiltering:!1,aiFilterRunId:null}:{})}},clearAiFilter:()=>{const s=e().aiFilterRunId;s&&e().abortRunControllers(s);const i=!!e().spreadsheetFilterFunction;if(t({spreadsheetFilterFunction:null,aiFilterExplanation:null,aiFilterRunId:null,isAiFiltering:!1}),i){const o={sender:"ai",text:"System note: Raw Data Explorer AI filter was cleared, so the table now shows all rows.",timestamp:new Date,type:"ai_message"};t(u=>({chatHistory:[...u.chatHistory,o]}))}e().addProgress("AI data filter cleared."),e().addToast("AI filter cleared.","info")},cancelAiFilterRequest:()=>{const{aiFilterRunId:s,isAiFiltering:i}=e();!s||!i||(e().abortRunControllers(s),t({isAiFiltering:!1,aiFilterRunId:null}),e().addProgress("AI data filter cancelled."),e().addToast("AI filter cancelled.","info"))}}),BT=5e3,c_=6e4;class L3{constructor(e){this.deps=e,this.timer=null,this.inFlight=!1,this.failureToastId=null,this.config={enabled:!0,intervalMs:15e3},this.backoffMs=0,this.lastCreatedAt=null}configure(e){const n={enabled:e.enabled,intervalMs:Math.max(BT,e.intervalMs)};if(this.config=n,!e.enabled){this.stop(),this.clearFailureToast();return}this.restart()}triggerImmediateSave(e=!1){!this.config.enabled&&!e||this.schedule(0,e)}resetSessionMetadata(){this.lastCreatedAt=null}seedCreatedAt(e){this.lastCreatedAt=e}stop(){this.timer&&(clearTimeout(this.timer),this.timer=null)}restart(){this.stop(),this.schedule(this.config.intervalMs)}schedule(e,n=!1){this.stop(),this.timer=setTimeout(()=>{this.performSave(n).finally(()=>{if(this.config.enabled){const s=this.config.intervalMs+this.backoffMs;this.schedule(s)}})},Math.max(0,e))}async performSave(e=!1){var s;if(this.inFlight||!this.config.enabled&&!e)return;const n=this.deps.getStore();if(this.shouldSave(n)){this.inFlight=!0;try{const i=this.deps.buildSnapshot(n),o=await this.ensureCreatedAt(),u={id:sa,filename:((s=n.csvData)==null?void 0:s.fileName)||"Current Session",createdAt:o,updatedAt:new Date,appState:i};await Bp(u),this.backoffMs=0,this.clearFailureToast()}catch(i){console.error("Auto-save failed:",i),this.backoffMs=this.backoffMs===0?Math.min(this.config.intervalMs,c_):Math.min(this.backoffMs*2,c_),this.showFailureToast()}finally{this.inFlight=!1}}}async ensureCreatedAt(){if(this.lastCreatedAt)return this.lastCreatedAt;const e=await wo(sa);return this.lastCreatedAt=(e==null?void 0:e.createdAt)??new Date,this.lastCreatedAt}shouldSave(e){return!!(e.csvData&&e.csvData.data.length>0)}showFailureToast(){this.failureToastId||(this.failureToastId=this.deps.addToast("Auto-save failed. Click to retry now.","error",0,{label:"Retry now",onClick:()=>this.triggerImmediateSave(!0)}))}clearFailureToast(){this.failureToastId&&(this.deps.dismissToast(this.failureToastId),this.failureToastId=null)}}const k3=t=>({enabled:t.autoSaveEnabled,intervalMs:Math.max(BT,t.autoSaveIntervalSeconds*1e3)}),FT=t=>{if(!t||typeof t!="object")return!1;const e=t;return typeof e.type=="string"&&e.type.startsWith("graph/")};let tp=null;const U3=async()=>typeof window>"u"?null:(tp||(tp=$u(()=>import("./agent_csv_runner-B8T4Resc.js"),[]).then(t=>t.default)),tp);class O3{constructor(){this.worker=null,this.listeners=new Set,this.pendingMessages=[],this.isReady=!1,this.isBooting=!1,this.handleWorkerMessage=e=>{FT(e.data)&&(e.data.type==="graph/ready"&&!this.isReady&&(this.isReady=!0,this.flushQueue()),this.listeners.forEach(n=>n(e.data)))},this.handleWorkerError=e=>{const n={type:"graph/error",message:e.message||"Graph worker error",timestamp:Date.now()};this.listeners.forEach(s=>s(n)),this.isReady=!1},this.isSupported=typeof window<"u"&&typeof Worker<"u"}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}ensureWorker(){!this.isSupported||this.worker||this.isBooting||(this.isBooting=!0,U3().then(e=>{!e||this.worker||(this.worker=new Worker(e,{name:"csv-agent-graph-worker",type:"module"}),this.worker.addEventListener("message",this.handleWorkerMessage),this.worker.addEventListener("error",this.handleWorkerError))}).catch(e=>{console.error("Failed to initialize graph worker:",e),this.handleWorkerError(new ErrorEvent("error",{message:(e==null?void 0:e.message)??String(e)}))}).finally(()=>{this.isBooting=!1}))}post(e){if(this.isSupported){if(this.ensureWorker(),!this.worker){this.pendingMessages.push(e);return}if(e.type==="graph/init"||this.isReady){this.worker.postMessage(e);return}this.pendingMessages.push(e)}}flushQueue(){if(!(!this.worker||!this.isReady||this.pendingMessages.length===0))for(;this.pendingMessages.length>0;){const e=this.pendingMessages.shift();e&&this.worker.postMessage(e)}}}const q3=new O3;let np=null;const B3=async()=>typeof window>"u"?null:(np||(np=$u(()=>import("./agent_csv_worker-DL35JjTT.js"),[]).then(t=>t.default)),np);class F3{constructor(){this.worker=null,this.listeners=new Set,this.pendingMessages=[],this.isReady=!1,this.isBooting=!1,this.handleWorkerMessage=e=>{FT(e.data)&&(e.data.type==="graph/ready"&&!this.isReady&&(this.isReady=!0,this.flushQueue()),this.listeners.forEach(n=>n(e.data)))},this.handleWorkerError=e=>{const n={type:"graph/error",message:e.message||"LangGraph worker error",timestamp:Date.now()};this.listeners.forEach(s=>s(n)),this.isReady=!1},this.isSupported=typeof window<"u"&&typeof Worker<"u"}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}async ensureWorker(){if(!(!this.isSupported||this.worker||this.isBooting)){this.isBooting=!0;try{const e=await B3();if(!e||this.worker)return;this.worker=new Worker(e,{name:"csv-agent-langgraph-worker",type:"module"}),this.worker.addEventListener("message",this.handleWorkerMessage),this.worker.addEventListener("error",this.handleWorkerError)}catch(e){console.error("Failed to initialize LangGraph worker:",e),this.handleWorkerError(new ErrorEvent("error",{message:(e==null?void 0:e.message)??String(e)}))}finally{this.isBooting=!1}}}post(e){if(this.isSupported){if(this.ensureWorker(),!this.worker){this.pendingMessages.push(e);return}if(e.type==="graph/init"||this.isReady){this.worker.postMessage(e);return}this.pendingMessages.push(e)}}flushQueue(){if(!(!this.worker||!this.isReady||this.pendingMessages.length===0))for(;this.pendingMessages.length>0;){const e=this.pendingMessages.shift();e&&this.worker.postMessage(e)}}}const $3=new F3,Jp=(t,e,n,s,i)=>{var E;if(!e||t.chartType==="scatter"||t.chartType==="combo"||!t.groupByColumn||!t.aggregation||t.aggregation!=="count"&&!t.valueColumn)return null;const o=t.valueColumn??"count",u=t.chartType==="line"?[{column:t.groupByColumn,direction:"asc"}]:[{column:o,direction:"desc"}],d=t.orderBy&&t.orderBy.length>0?t.orderBy.map(L=>({column:L.column,direction:L.direction??(t.chartType==="line"?"asc":"desc")})):u,m=(i==null?void 0:i.runtimeConfig)??null,f=s??((E=n==null?void 0:n.data)==null?void 0:E.length)??0,y=f>0?Math.min(5e3,f):5e3,S=(m==null?void 0:m.sampleSize)??y,_=f>0&&f<=OO,T=typeof t.limit=="number"?t.limit:t.defaultTopN,C={datasetId:e,by:[t.groupByColumn],metrics:[{fn:t.aggregation,column:t.aggregation==="count"?void 0:t.valueColumn,as:o}],filter:t.rowFilter?[{column:t.rowFilter.column,op:"in",values:t.rowFilter.values}]:void 0,limit:typeof T=="number"?T:void 0,mode:_?"full":"sample",sampleSize:S,orderBy:d,allowFullScan:(m==null?void 0:m.allowFullScan)??_,timeoutMs:m==null?void 0:m.timeoutMs},N=(i==null?void 0:i.preferredMode)??(m==null?void 0:m.mode);return _||N==="full"?(C.mode="full",C.allowFullScan=!0):(C.mode="sample",C.allowFullScan=(m==null?void 0:m.allowFullScan)??!1),C};class Ln extends Error{constructor(e,n){super(e),this.name="GraphToolExecutionError",this.code=n==null?void 0:n.code,this.suggestion=n==null?void 0:n.suggestion}}const H3=t=>{if(typeof t=="string"){const e=t.match(/(\d{4})[-/.](\d{1,2})/);if(e){const n=String(e[2]).padStart(2,"0");return`${e[1]}-${n}`}}return null},G3=async t=>{const{plan:e,datasetId:n,csvData:s,rowCountHint:i,options:o}=t,u=Jp(e,n,s,i,o);if(!u)throw new Ln("Plan is not eligible for aggregate tool.");const d=await Ss.aggregate(u);if(!d.ok)throw new Ln(d.reason??"Aggregate tool failed.",{code:d.code,suggestion:d.hint});const m=d.data,f={source:m.provenance.mode,rows:m.rows.length,warnings:m.provenance.warnings??[],processedRows:m.provenance.processedRows,totalRows:m.provenance.totalRows,durationMs:d.durationMs??0},y=` ${e.title??"analysis"}: ${f.rows} ${f.source} ${f.warnings.length}`,S={kind:"aggregate_plan",planTitle:e.title??"analysis",rows:f.rows,viewId:m.provenance.queryHash};return{summary:y,meta:f,payload:S,rows:m.rows,schema:m.schema,viewId:m.provenance.queryHash}},V3=async(t,e)=>{if(!t)throw new Ln("Dataset unavailable for profiling.");const n=await Ss.profile(t,e);if(!n.ok)throw new Ln(n.reason??"Profile tool failed.",{code:n.code,suggestion:n.hint});const s=`${n.data.columns.length}   ${n.data.rowCount.toLocaleString()}  ${n.data.sampledRows.toLocaleString()}`,i={source:n.data.sampledRows===n.data.rowCount?"full":"sample",rows:n.data.rowCount,warnings:n.data.warnings??[],processedRows:n.data.sampledRows,totalRows:n.data.rowCount,durationMs:n.durationMs??0},o={kind:"profile_dataset",columns:n.data.columns.length,rowCount:n.data.rowCount,sampledRows:n.data.sampledRows};return{summary:s,meta:i,payload:o,context:n.data}},z3=(t,e="InvoiceMonth")=>{if(!t)throw new Ln("Dataset unavailable for normalization.");let n=0,s=0;const i=new Set;for(const f of t.data){const y=H3(f[e]);y?(n++,i.size<6&&i.add(y)):s++}const o=n+s,u=` ${e} ${n.toLocaleString()} ${s.toLocaleString()}`,d={source:"full",rows:n,warnings:s?[`Skipped ${s} rows`]:[],processedRows:o,totalRows:o,durationMs:0},m={kind:"normalize_invoice_month",column:e,normalizedCount:n,skippedCount:s,sampleValues:Array.from(i)};return{summary:u,meta:d,payload:m}},j3=(t,e,n=2)=>{if(!t)throw new Ln("Dataset unavailable for outlier detection.");const s=t.data.map(_=>Number(_[e])).filter(_=>Number.isFinite(_));if(s.length===0)return{summary:` ${e}`,meta:{source:"full",rows:0,warnings:["No numeric values detected."],processedRows:t.data.length,totalRows:t.data.length,durationMs:0},payload:{kind:"detect_outliers",column:e,threshold:0,count:0,rows:[]}};const i=s.reduce((_,T)=>_+T,0)/s.length,o=s.reduce((_,T)=>_+Math.pow(T-i,2),0)/s.length,u=Math.sqrt(o),d=i+n*u,m=t.data.filter(_=>Number(_[e])>d).map(_=>{var T;return{label:_.id??((T=_[e])==null?void 0:T.toString())??"row",value:Number(_[e])}}).sort((_,T)=>T.value-_.value).slice(0,5),f=` ${e} ${m.length.toLocaleString()}  ${d.toFixed(2)}`,y={source:"full",rows:m.length,warnings:[],processedRows:t.data.length,totalRows:t.data.length,durationMs:0},S={kind:"detect_outliers",column:e,threshold:Number(d.toFixed(2)),count:m.length,rows:m};return{summary:f,meta:y,payload:S}},no={aggregatePlan:G3,profileDataset:V3,normalizeInvoiceMonth:z3,detectOutliers:j3},Y3={clean_month:{toolCall:{kind:"normalize_invoice_month",params:{column:"InvoiceMonth"}},stepId:"normalize-invoice-month",stepLabel:" InvoiceMonth ",stepIntent:"data_cleaning",planGoal:"",planProgress:" InvoiceMonth ",reason:" InvoiceMonth ",text:" InvoiceMonth YYYY-MM"},outlier:{toolCall:{kind:"detect_outliers",params:{valueColumn:"Amount",multiplier:3}},stepId:"detect-amount-outliers",stepLabel:"",stepIntent:"data_validation",planGoal:"",planProgress:" Amount ",reason:"",text:" Amount "}},J3=t=>t?Y3[t]:void 0,K3=t=>!!J3(t),X3=t=>({source:t.source,planId:t.planId,stepId:t.stepId,summary:t.summary,plan:t.plan,planState:t.planState,telemetry:t.telemetry}),fu={[pt.FULL_SCAN_BLOCKED]:{title:"Full scan needs confirmation",detail:"Please ask the user before scanning every cached row."},[pt.AGG_TIMEOUT]:{title:"Full scan timed out",detail:"The analysis fell back to a sampled preview. Retry or limit the scope."},[pt.COLUMN_METADATA_MISSING]:{title:"Dataset cache incomplete",detail:"The cached schema is missing. Re-upload or rebuild the dataset to continue."},[pt.VERSION_ERROR]:{title:"Browser storage mismatch",detail:"Local IndexedDB version changed. Refresh or clear site data, then retry."},[pt.ORIGIN_BLOCKED]:{title:"Source not allowed",detail:"The embedding origin is not on the allow list for CSV hand-off."},[pt.DATASET_UNCHANGED]:{title:"Dataset unchanged",detail:"This CSV matches the cached dataset. You can skip the import or force a refresh."},[pt.INDEXEDDB_UNAVAILABLE]:{title:"Browser blocked storage access",detail:"IndexedDB is unavailable in this context. Enable storage permissions and retry."},[pt.UNKNOWN]:{title:"Action failed",detail:"The agent could not finish this step. Try again or adjust your request."}},Q3=(t,e)=>t&&fu[t]?fu[t]:e?{title:fu[pt.UNKNOWN].title,detail:e}:fu[pt.UNKNOWN],W3=[{provider:"openai",pattern:/gpt-4o-mini/i,tier:{promptPerMillion:.15,completionPerMillion:.6}},{provider:"openai",pattern:/gpt-4o-?mini-?audio/i,tier:{promptPerMillion:.3,completionPerMillion:1.2}},{provider:"openai",pattern:/gpt-4o/i,tier:{promptPerMillion:5,completionPerMillion:15}},{provider:"openai",pattern:/gpt-4-turbo/i,tier:{promptPerMillion:10,completionPerMillion:30}},{provider:"openai",pattern:/gpt-3\.5-turbo/i,tier:{promptPerMillion:.5,completionPerMillion:1.5}},{provider:"gemini",pattern:/gemini-1\.5-pro/i,tier:{promptPerMillion:7,completionPerMillion:21}},{provider:"gemini",pattern:/gemini-1\.5-flash/i,tier:{promptPerMillion:.35,completionPerMillion:1.05}},{provider:"gemini",pattern:/gemini-1\.(0|1)-pro/i,tier:{promptPerMillion:3.5,completionPerMillion:10.5}}],Z3={openai:{promptPerMillion:5,completionPerMillion:15},gemini:{promptPerMillion:3.5,completionPerMillion:10.5}},eq=(t,e)=>{const n=W3.find(s=>s.provider===t&&s.pattern.test(e));return(n==null?void 0:n.tier)??Z3[t]},tq=t=>{if(t.promptTokens==null&&t.completionTokens==null)return null;const e=eq(t.provider,t.model);if(!e)return null;const n=t.promptTokens??0,s=t.completionTokens??0,i=n/1e6*e.promptPerMillion,o=s/1e6*e.completionPerMillion,u=i+o;return!Number.isFinite(u)||u===0?null:Number(u.toFixed(6))},nq=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`clar-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,sp=()=>`run-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,sq=()=>`toast-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,aq=()=>`val-${Date.now()}-${Math.random().toString(36).slice(2,8)}`;let Wt=null,Fu=null,ap=!1,rp=null,ip=!1,ys=null;const $T=t=>{Fu=k3(t),Wt==null||Wt.configure(Fu)},rq=()=>{Wt==null||Wt.resetSessionMetadata()},d_=t=>{Wt==null||Wt.seedCreatedAt(t)},f_=()=>{Wt==null||Wt.triggerImmediateSave(!0)},op=(t,e)=>Q3(t,e).detail,iq=(t,e,n,s)=>({id:`obs-tool-${t}-${Date.now().toString(36)}`,actionId:t,responseType:"execute_js_code",status:"success",timestamp:new Date().toISOString(),outputs:{summary:e,meta:n,payload:s}}),oq=(t,e,n,s)=>({id:`obs-tool-${t}-err-${Date.now().toString(36)}`,actionId:t,responseType:"execute_js_code",status:"error",timestamp:new Date().toISOString(),outputs:{summary:e,...n??{}},errorCode:s??pt.UNKNOWN}),p_=t=>typeof window>"u"?!0:window.confirm(`${t} 
`),lp=6,lq=12,m_=2,uq=10,HT=()=>({lastIndexedMessage:0,rawChunks:[],summaryChunks:[]}),cq=t=>({...t,id:`llm-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,timestamp:new Date().toISOString()}),dq=t=>{const e=[];return typeof t.promptTokens=="number"&&e.push(`in ${t.promptTokens}`),typeof t.completionTokens=="number"&&e.push(`out ${t.completionTokens}`),typeof t.totalTokens=="number"&&e.push(`total ${t.totalTokens}`),e.length>0?`tokens ${e.join(" / ")}`:"tokens n/a"},fq=t=>{const e=t.estimatedCostUsd!=null?`$${t.estimatedCostUsd.toFixed(4)}`:"cost n/a";return`${t.context}: ${t.provider}/${t.model}  ${dq(t)}, ${e}`},Da=(t,e)=>({provider:t.provider,model:t.model,promptTokens:t.promptTokens,completionTokens:t.completionTokens,totalTokens:t.totalTokens,context:t.operation??e}),pq=t=>{const e=t.timestamp instanceof Date&&!Number.isNaN(t.timestamp.getTime())?t.timestamp:new Date(t.timestamp),n=t.sender==="ai"?"AI":"User";return`[${Number.isNaN(e.getTime())?"Unknown time":e.toLocaleString(void 0,{hour12:!1})}] ${n}: ${t.text}`},mq=(t,e=0)=>t.map((n,s)=>`${e+s+1}. ${pq(n)}`).join(`
`),Kp={langchain_plan:"LangChain Plan",aggregate_plan:"Plan Preview",profile_dataset:"Dataset Profile",normalize_invoice_month:"Invoice Month Cleanup",detect_outliers:"Outlier Detection",tool_result:"Tool Result"},hq=t=>{const e=t.payload??{},s=[`[Observation] ${Kp[t.kind]??t.kind}`];typeof e.summary=="string"?s.push(e.summary):typeof e.description=="string"&&s.push(e.description);const i=e.meta??{};typeof i.rows=="number"&&s.push(`${i.rows} `),typeof i.source=="string"&&s.push(i.source==="full"?"":"");const o=e.telemetry??i.telemetry;if(o){const u=o.tokenUsage;if(u){const d=[];u.promptTokens!=null&&d.push(`in ${u.promptTokens}`),u.completionTokens!=null&&d.push(`out ${u.completionTokens}`),u.totalTokens!=null&&d.push(`total ${u.totalTokens}`),d.length&&s.push(`Tok ${d.join(" / ")}`)}o.estimatedCostUsd!=null?s.push(`$${o.estimatedCostUsd.toFixed(4)}`):o.latencyMs!=null&&s.push(`${Math.round(o.latencyMs)} ms`)}else typeof i.durationMs=="number"&&s.push(`${Math.round(i.durationMs)} ms`);return s.join("  ")},gq=t=>{if(!t)return"latency n/a, tokens n/a, cost n/a";const e=`${Math.round(t.latencyMs)} ms`,n=t.tokenUsage;let s="tokens n/a";if(n){const o=n.promptTokens,u=n.completionTokens,d=n.totalTokens??(o!=null||u!=null?(o??0)+(u??0):void 0);o!=null||u!=null?s=`tokens ${o??"?"} in / ${u??"?"} out${d!=null?` (${d} total)`:""}`:d!=null&&(s=`tokens ${d}`)}const i=t.estimatedCostUsd!=null?`$${t.estimatedCostUsd.toFixed(4)}`:"cost n/a";return`${e}, ${s}, cost ${i}`},yq=(t,e,n)=>!t.langChainPlannerEnabled||!t.isApiKeySet||K3(e)||!t.datasetHash||!t.csvData||t.csvData.data.length===0||!t.columnProfiles.length?!1:!!(e||n&&n.length>0),vq=async t=>{if(!t.datasetHash||!t.csvData)throw new Error("Dataset unavailable for LangChain planner.");const{generateLangChainPlanEnvelope:e}=await $u(async()=>{const{generateLangChainPlanEnvelope:n}=await import("./agent_csv_planBridge-DeGTPupn.js");return{generateLangChainPlanEnvelope:n}},[]);return e({datasetId:t.datasetHash,columns:t.columnProfiles,rows:t.csvData.data,settings:t.settings,addProgress:t.addProgress})},Sq=new Set(["numerical","currency","percentage"]),wq=new Set(["categorical","date","time"]),_q=t=>t.filter(e=>Sq.has(e.type)).sort((e,n)=>{const s=e.numericSampleCount??e.nonNullCount??0;return(n.numericSampleCount??n.nonNullCount??0)-s})[0]??null,xq=(t,e)=>{var y;const n=Jm(t.filter(S=>wq.has(S.type)),e);if(n.length===0)return null;const s=n.find(S=>{const _=S.uniqueValues??0;return _>=4&&_<=40})??n[0],i=(y=s==null?void 0:s.profile)==null?void 0:y.name;if(!i)return null;const o=_q(t),u=(o==null?void 0:o.name)??null,d=u?`Top ${i} by ${u}`:`Top ${i} by count`,m=u?`Summarize the largest ${i} values using ${u}.`:`Show the most frequent ${i} categories.`;return{chartType:"bar",title:d,description:m,aggregation:u?"sum":"count",groupByColumn:i,valueColumn:u??void 0,defaultTopN:8,defaultHideOthers:!0,limit:8,orderBy:[{column:u??"count",direction:"desc"}]}},bq=t=>{var e;return((e=t.find(n=>n.status==="pending"))==null?void 0:e.id)??null},h_=6,Tq=(t,e,n)=>{if(e.promptId){const o=t.findIndex(u=>u.promptId===e.promptId);if(o>=0){const u=[...t];return u[o]={...u[o],question:e.question,optionsSnapshot:e.options,allowFreeText:e.allowFreeText,placeholder:e.placeholder,status:u[o].status==="answered"?"answered":"waiting"},u}}const s={promptId:e.promptId??null,question:e.question,optionsSnapshot:e.options,allowFreeText:e.allowFreeText,placeholder:e.placeholder,askedAt:n,status:"waiting"},i=[...t,s];return i.length>h_?i.slice(-h_):i},Cq=(t,e,n,s)=>{if(!t.length)return t;let i=-1;if(e&&(i=t.findIndex(u=>u.promptId===e)),i===-1){for(let u=t.length-1;u>=0;u-=1)if(t[u].status==="waiting"){i=u;break}}if(i===-1)return t;const o=[...t];return o[i]={...o[i],status:"answered",respondedAt:n,responseLabel:s.label??s.value??null,responseValue:s.value,responseType:s.type},o},Aq=t=>{postGraphClientEvent({type:"graph/tool_result",verification:t,timestamp:Date.now()})&&postGraphClientEvent({type:"graph/runPipeline",payload:{reason:"verification"},timestamp:Date.now()})},Eq=t=>{var e,n;switch(t.kind){case"profile_dataset":return"";case"normalize_invoice_month":return` ${typeof((e=t.params)==null?void 0:e.column)=="string"?t.params.column:"InvoiceMonth"}`;case"detect_outliers":return` ${typeof((n=t.params)==null?void 0:n.valueColumn)=="string"?t.params.valueColumn:"Amount"} `;case"aggregate_plan":default:return""}},g_=t=>(t??[]).map(e=>({id:typeof(e==null?void 0:e.id)=="string"?e.id.trim():"",label:typeof(e==null?void 0:e.label)=="string"?e.label.trim():"",intent:typeof(e==null?void 0:e.intent)=="string"&&e.intent.trim()||void 0,status:typeof(e==null?void 0:e.status)=="string"?e.status:void 0})).filter(e=>e.id.length>=3&&e.label.length>=3),Nq=t=>{if(!t)return"report";const e=t.split(/\r?\n/).map(s=>s.trim()).find(Boolean);return e&&e.replace(/[^a-z0-9-_]+/gi,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||"report"},Iq=t=>({currentView:t.currentView,isBusy:t.isBusy,busyMessage:t.busyMessage,canCancelBusy:t.canCancelBusy,progressMessages:t.progressMessages,csvData:t.csvData,columnProfiles:t.columnProfiles,analysisCards:t.analysisCards,chatHistory:t.chatHistory,finalSummary:t.finalSummary,aiCoreAnalysisSummary:t.aiCoreAnalysisSummary,dataPreparationPlan:t.dataPreparationPlan,initialDataSample:t.initialDataSample,datasetHash:t.datasetHash,vectorStoreDocuments:Ke.getDocuments(),conversationMemoryState:t.conversationMemoryState,spreadsheetFilterFunction:t.spreadsheetFilterFunction,aiFilterExplanation:t.aiFilterExplanation,datasetProfile:t.datasetProfile,pendingClarifications:t.pendingClarifications,activeClarificationId:t.activeClarificationId,toasts:[],agentActionTraces:t.agentActionTraces,agentValidationEvents:t.agentValidationEvents,columnAliasMap:t.columnAliasMap,pendingDataTransform:t.pendingDataTransform,lastAppliedDataTransform:t.lastAppliedDataTransform,isLastAppliedDataTransformBannerDismissed:t.isLastAppliedDataTransformBannerDismissed,interactiveSelectionFilter:t.interactiveSelectionFilter,plannerSession:t.plannerSession,agentPhase:t.agentPhase,plannerPendingSteps:t.plannerPendingSteps,agentPromptMetrics:t.agentPromptMetrics,plannerDatasetHash:t.plannerDatasetHash,agentAwaitingUserInput:t.agentAwaitingUserInput,agentAwaitingPromptId:t.agentAwaitingPromptId,graphToolInFlight:t.graphToolInFlight,analysisTimeline:t.analysisTimeline,langChainLastPlan:t.langChainLastPlan,langChainPlannerEnabled:t.langChainPlannerEnabled,useLangGraphRuntime:t.useLangGraphRuntime,llmUsageLog:t.llmUsageLog,graphObservations:t.graphObservations,graphPhase:t.graphPhase,graphLoopBudget:t.graphLoopBudget}),Rq=t=>{const e=new Date().toISOString().replace(/[:.]/g,"-");return`${Nq(t)}-${e}.csv`},y_=async(t,e,n,s,i,o,u)=>{if(!t||t.length===0)return;let d=null;try{if(!(!!e&&!!n&&e===n)){Ke.clear(),s("Skipped AI memory restore because the dataset changed since last session."),i("AI memory reset for this dataset.","info",5e3);return}if(!Ke.getIsInitialized()&&(d=i("Preparing AI memory from history...","info",0),await Ke.init(s)),!Ke.getIsInitialized()){s("AI memory model failed to load; saved chat context is unavailable right now.","error"),d&&o(d);return}d&&o(d),Ke.rehydrate(t),s(u),i("AI memory ready for this report.","success")}catch(m){d&&o(d),console.error("Failed to restore AI memory from saved session:",m),s("Restoring AI memory failed; chat recall may be incomplete this session.","error"),i("AI memory failed to load. Try reloading or re-importing the file.","error",6e3)}},up=320,Mq=800,Pq=600,Dq=12,v_=(t=[])=>_o(t.map(e=>e.name)),Lq=(t,e,n)=>{const s=Math.min(t,60)/60,i=Math.max(.4,1-e*.15),o=n?.9:1;return Number(((.5+s*.5)*i*o).toFixed(3))},kq=t=>{const e=["auto-memory"];return t.chartType&&e.push(`chart:${t.chartType}`),t.groupByColumn&&e.push(`group:${t.groupByColumn}`),t.valueColumn&&e.push(`value:${t.valueColumn}`),t.aggregation&&e.push(`agg:${t.aggregation}`),e},Xp=t=>({observations:(t==null?void 0:t.observations)??[],planState:(t==null?void 0:t.planState)??null}),Uq=(t,e)=>t.length!==e.length?!1:t.every((n,s)=>n===e[s]),Oq=t=>{switch(t.chartType){case"line":return"trend";case"bar":case"pie":case"doughnut":case"combo":return"topn";default:return"kpi"}},qq=t=>{const e=t.dataRef.planSnapshot??{},n=e.chartType??"bar",s={chartType:n,title:e.title??t.title,description:e.description??t.explainer??"",aggregation:e.aggregation,groupByColumn:e.groupByColumn,valueColumn:e.valueColumn,xValueColumn:e.xValueColumn,yValueColumn:e.yValueColumn,secondaryValueColumn:e.secondaryValueColumn,secondaryAggregation:e.secondaryAggregation,defaultTopN:e.defaultTopN,defaultHideOthers:e.defaultHideOthers,rowFilter:e.rowFilter,orderBy:e.orderBy,limit:e.limit??null};return{id:t.id,plan:s,aggregatedData:t.dataRef.rows,summary:t.explainer,displayChartType:n,isDataVisible:!1,topN:e.defaultTopN??null,hideOthers:e.defaultHideOthers??!1,disableAnimation:!0,hiddenLabels:[],dataRefId:t.id,queryHash:t.queryHash,isSampledResult:t.dataRef.sampled,aggregationMeta:{mode:t.dataRef.sampled?"sample":"full",sampled:t.dataRef.sampled,processedRows:t.dataRef.rows.length,totalRows:t.dataRef.rows.length,warnings:[],lastRunAt:t.createdAt??new Date().toISOString(),requestedMode:t.dataRef.sampled?"sample":"full"},valueSchema:t.dataRef.schema}},so={currentView:"file_upload",isBusy:!1,busyMessage:null,canCancelBusy:!1,progressMessages:[],csvData:null,columnProfiles:[],analysisCards:[],chatHistory:[],finalSummary:null,aiCoreAnalysisSummary:null,dataPreparationPlan:null,initialDataSample:null,datasetHash:null,datasetRuntimeConfig:null,vectorStoreDocuments:[],conversationMemoryState:HT(),spreadsheetFilterFunction:null,aiFilterExplanation:null,datasetProfile:null,pendingClarifications:[],activeClarificationId:null,toasts:[],agentActionTraces:[],agentValidationEvents:[],columnAliasMap:{},pendingDataTransform:null,lastAppliedDataTransform:null,isLastAppliedDataTransformBannerDismissed:!1,interactiveSelectionFilter:null,plannerSession:Xp(),agentPhase:{phase:"idle",message:null,enteredAt:null},plannerPendingSteps:[],agentPromptMetrics:[],plannerDatasetHash:null,agentAwaitingUserInput:!1,agentAwaitingPromptId:null,analysisTimeline:{stage:"idle",totalCards:0,completedCards:0},aggregationModePreference:"full",graphStatus:"idle",graphStatusMessage:null,graphVersion:null,graphLastReadyAt:null,graphAwaitPrompt:null,graphAwaitPromptId:null,graphAwaitHistory:[],graphSessionId:null,graphLastToolSummary:null,graphToolInFlight:null,langChainLastPlan:null,langChainPlannerEnabled:!0,useLangGraphRuntime:!0,llmUsageLog:[],graphObservations:[],graphPhase:"idle",graphLoopBudget:{maxActs:3,actsUsed:0,exceeded:!1}},De=KE((t,e)=>{const n=x=>{const I={...x,id:nq(),status:"pending",contextType:x.contextType??"plan"};return t(D=>({pendingClarifications:[...D.pendingClarifications,I],activeClarificationId:I.id})),I},s=()=>e().useLangGraphRuntime?$3:q3,i=x=>{const I=s();return I.isSupported?(I.post(x),!0):!1},o=(x,I)=>{e().pendingClarifications.some(R=>R.id===x)&&t(R=>{const P=R.pendingClarifications.map(k=>k.id===x?{...k,status:I}:k),A=I==="pending"||I==="resolving"?x:bq(P);return{pendingClarifications:P,activeClarificationId:A}})},u=(x,I)=>{if(!I||I.length===0)return;const D=e().recordLlmUsage;I.forEach(R=>{D(Da(R,`${x}.${R.label}`))})},d=x=>{const I={kind:x.kind,label:Eq(x),startedAt:new Date().toISOString()};t({graphToolInFlight:I})},m=()=>{t({graphToolInFlight:null})},f=(x,I)=>{const D=x.viewId?{...x.payload,viewId:x.viewId}:x.payload,R=(I==null?void 0:I.description)??Kp[D.kind]??D.kind;t({graphLastToolSummary:x.summary}),e().addProgress(x.summary),Aq({description:R,summary:x.summary,meta:x.meta,payload:D}),e().appendPlannerObservation(iq(D.kind,x.summary,x.meta,D))},y=(x,I,D,R)=>{const P=op(I,D),A=`${Kp[x]??x} failed${P}`,k={suggestion:R??P,detail:D??null};return t({graphLastToolSummary:A}),e().addProgress(A,"error"),e().appendPlannerObservation(oq(x,P,k,I)),A},S=async x=>{var I,D,R,P;if(!x)return!1;switch(x.kind){case"profile_dataset":{const A=e().datasetHash;if(!A)return e().addProgress("Graph profile request skipped","error"),!1;d(x);try{const k=typeof((I=x.params)==null?void 0:I.sampleSize)=="number"?x.params.sampleSize:void 0,F=await no.profileDataset(A,k);return f(F,{description:"Dataset profile"}),!0}catch(k){const F=k instanceof Ln?k:null;return y("profile_dataset",F==null?void 0:F.code,(F==null?void 0:F.message)??(k instanceof Error?k.message:String(k)),F==null?void 0:F.suggestion),!1}finally{m()}}case"normalize_invoice_month":{const A=e().csvData;if(!A)return e().addProgress("Graph normalize request skipped CSV ","error"),!1;const k=typeof((D=x.params)==null?void 0:D.column)=="string"?x.params.column:"InvoiceMonth";d(x);try{const F=no.normalizeInvoiceMonth(A,k);return f(F,{description:`Normalize ${k}`}),!0}catch(F){const U=F instanceof Ln?F:null;return y("normalize_invoice_month",U==null?void 0:U.code,(U==null?void 0:U.message)??(F instanceof Error?F.message:String(F)),U==null?void 0:U.suggestion),!1}finally{m()}}case"detect_outliers":{const A=e().csvData;if(!A)return e().addProgress("Graph outlier request skipped CSV ","error"),!1;const k=typeof((R=x.params)==null?void 0:R.valueColumn)=="string"?x.params.valueColumn:null;if(!k)return e().addProgress("Graph outlier request failed valueColumn","error"),!1;const F=typeof((P=x.params)==null?void 0:P.multiplier)=="number"?x.params.multiplier:2;d(x);try{const U=no.detectOutliers(A,k,F);return f(U,{description:`Detect outliers (${k})`}),!0}catch(U){const z=U instanceof Ln?U:null;return y("detect_outliers",z==null?void 0:z.code,(z==null?void 0:z.message)??(U instanceof Error?U.message:String(U)),z==null?void 0:z.suggestion),!1}finally{m()}}default:return!1}},_=x=>{var I;return x?(I=e().createAbortController(x))==null?void 0:I.signal:void 0},T=async(x,I,D)=>{if(D&&e().isRunCancellationRequested(D))return[];const R=x.title??"your requested chart",P={sender:"ai",text:`Okay, creating a chart for "${R}".`,timestamp:new Date,type:"ai_plan_start"};t(k=>({chatHistory:[...k.chatHistory,P]}));const A=await e().runAnalysisPipeline([x],I,{isChatRequest:!0,runId:D});if(A.length>0){const k=A[0].summary.split("---")[0].trim(),F={sender:"ai",text:`Created the chart for "${R}". Here's what I observed:
${k}`,timestamp:new Date,type:"ai_message",cardId:A[0].id};t(U=>({chatHistory:[...U.chatHistory,F]}))}return A},C=async(x,I)=>{if(!x)return null;try{const D=await ah(x,{rowCountHint:I});return t({datasetRuntimeConfig:D,aggregationModePreference:D.mode}),D}catch(D){return console.error("Failed to sync dataset runtime config:",D),null}},N=async(x,I,D)=>{try{const R=await n3(x,I,D);return t({datasetRuntimeConfig:R,aggregationModePreference:R.mode}),R}catch(R){return console.error("Failed to update dataset runtime config:",R),null}},E=DO(t,e,{registerClarification:n,updateClarificationStatus:o,getRunSignal:_,runPlanWithChatLifecycle:T}),L=async x=>{var I;e().addProgress("Restoring cached dataset from IndexedDB");try{const[D,R,P,A]=await Promise.all([PT(x),th(x),kT(x),e3(x)]);if(!P||P.length===0)return e().addProgress("Cached dataset was empty. Please re-upload your CSV.","error"),!1;const k={fileName:(D==null?void 0:D.fileName)??"cached.csv",data:P},F=(R==null?void 0:R.columns)??[],U=_o(F.map(q=>q.name)),z=A.map(qq);t({...so,csvData:k,columnProfiles:F,columnAliasMap:U,analysisCards:z,datasetHash:x,currentView:"analysis_dashboard",analysisTimeline:z.length?{stage:"insight",totalCards:z.length,completedCards:z.length}:{stage:"profiling",totalCards:0,completedCards:0},initialDataSample:P.slice(0,50)}),await C(x,(R==null?void 0:R.rowCount)??P.length),qT(x);const oe=(I=e().datasetRuntimeConfig)==null?void 0:I.profileSampleSize,se=await Ss.profile(x,oe);return se.ok?e().applyDatasetProfileSnapshot(se.data):addProgress(`Profiling worker failed: ${se.reason}`,"error"),!0}catch(D){return console.error("Failed to restore cached dataset:",D),e().addProgress("Cached dataset restore failed. Please re-upload.","error"),!1}},B=P3(t,e,{initialAppState:so,resetAutoSaveSession:rq}),O=D3(t,e,{createRunId:sp});return{...so,...E,...B,...O,busyRunId:null,isCancellationRequested:!1,aiFilterRunId:null,abortControllers:{},isAsideVisible:!0,asideWidth:window.innerWidth/4>up?window.innerWidth/4:up,isSpreadsheetVisible:!0,isDataPrepDebugVisible:!1,isSettingsModalOpen:!1,isHistoryPanelOpen:!1,isMemoryPanelOpen:!1,isAiFiltering:!1,settings:Pw(),reportsList:[],isResizing:!1,isApiKeySet:(()=>{const x=Pw();return x.provider==="google"?!!x.geminiApiKey:!!x.openAIApiKey})(),beginBusy:(x,I)=>{const D=sp();return t({isBusy:!0,busyMessage:x,canCancelBusy:!!(I!=null&&I.cancellable),busyRunId:D,isCancellationRequested:!1}),D},updateBusyStatus:x=>{e().isBusy&&t({busyMessage:x})},endBusy:x=>{const I=e().busyRunId;if(x&&I&&I!==x)return;t({isBusy:!1,busyMessage:null,canCancelBusy:!1,busyRunId:null,isCancellationRequested:!1});const D=x??I;D&&e().clearRunControllers(D)},requestBusyCancel:()=>{if(!e().busyRunId||e().isCancellationRequested)return;t({isCancellationRequested:!0,canCancelBusy:!1,busyMessage:"Cancelling wrapping up safely."}),e().addProgress("Cancelling current request...");const x=e().busyRunId;x&&e().abortRunControllers(x)},isBusyRunActive:x=>e().busyRunId===x,isRunCancellationRequested:x=>e().isCancellationRequested&&e().busyRunId===x,createAbortController:x=>{if(!x)return null;const I=new AbortController;return t(D=>({abortControllers:{...D.abortControllers,[x]:[...D.abortControllers[x]??[],I]}})),I},abortRunControllers:x=>{t(I=>{const D=I.abortControllers[x];if(D==null||D.forEach(P=>{P.signal.aborted||P.abort()}),!D)return{};const R={...I.abortControllers};return delete R[x],{abortControllers:R}})},clearRunControllers:x=>{t(I=>{if(!I.abortControllers[x])return{};const D={...I.abortControllers};return delete D[x],{abortControllers:D}})},addToast:(x,I="info",D=4e3,R)=>{const P=sq();return t(A=>({toasts:[...A.toasts,{id:P,message:x,type:I,actionLabel:R==null?void 0:R.label,onAction:R==null?void 0:R.onClick}]})),D>0&&setTimeout(()=>{e().dismissToast(P)},D),P},dismissToast:x=>{t(I=>({toasts:I.toasts.filter(D=>D.id!==x)}))},queuePendingDataTransform:x=>{if(e().pendingDataTransform){e().addProgress("An AI data transformation is already awaiting approval. Please confirm or discard it first.","error");return}t({pendingDataTransform:x}),e().addProgress("AI proposed a data transformation. Review it above the dashboard before applying."),e().addToast("AI data change pending confirmation.","info",5e3)},confirmPendingDataTransform:async()=>{const x=e().pendingDataTransform;if(!x){e().addProgress("No pending data transformation to confirm.","error");return}const I=e().csvData,D=e().columnProfiles,R=e().columnAliasMap,P=Bu(x.nextData);t({csvData:x.nextData,columnProfiles:x.nextColumnProfiles,columnAliasMap:x.nextAliasMap,datasetHash:P,datasetRuntimeConfig:null,pendingDataTransform:null,isLastAppliedDataTransformBannerDismissed:!1,lastAppliedDataTransform:{id:x.id,summary:x.summary,explanation:x.explanation,meta:x.meta,previousData:I,previousColumnProfiles:D,previousAliasMap:R,appliedAt:new Date().toISOString()}}),e().addProgress("Applied the AI data transformation after confirmation."),await C(P,x.nextData.data.length),await e().regenerateAnalyses(x.nextData);const A=j=>{if(!j||j.length===0)return"(none)";const ae=j.slice(0,8).join(", ");return j.length>8?`${ae}, `:ae},k=(j,ae)=>{if(j&&j.length>0)return j.map(Ce=>Ce.name);const ge=ae==null?void 0:ae.find(Ce=>Ce&&typeof Ce=="object");return ge?Object.keys(ge):[]},F=x.beforeColumns??k(D,(I==null?void 0:I.data)??void 0),U=x.afterColumns??x.nextColumnProfiles.map(j=>j.name),z=F.filter(j=>!U.includes(j)),oe=U.filter(j=>!F.includes(j)),se=[`Before (${F.length}): ${A(F)}`,`After (${U.length}): ${A(U)}`,z.length?`Removed: ${A(z)}`:null,oe.length?`Added: ${A(oe)}`:null].filter(Boolean).join(`
`),q={sender:"ai",text:`Applied transform "${x.summary}".
${se}`,timestamp:new Date,type:"ai_message"};t(j=>({chatHistory:[...j.chatHistory,q]}))},discardPendingDataTransform:()=>{if(!e().pendingDataTransform){e().addProgress("No pending data transformation to discard.","error");return}t({pendingDataTransform:null}),e().addProgress("Discarded the pending AI data transformation.")},undoLastDataTransform:async()=>{if(e().pendingDataTransform){e().addProgress("Resolve the pending AI transformation before undoing.","error");return}const x=e().lastAppliedDataTransform;if(!x||!x.previousData){e().addProgress("No AI data transformation is available to undo.","error");return}const I=Bu(x.previousData);t({csvData:x.previousData,columnProfiles:x.previousColumnProfiles,columnAliasMap:x.previousAliasMap,datasetHash:I,datasetRuntimeConfig:null,lastAppliedDataTransform:null,isLastAppliedDataTransformBannerDismissed:!1}),e().addProgress("Reverted the last AI data transformation."),await C(I,x.previousData.data.length),await e().regenerateAnalyses(x.previousData)},dismissLastAppliedDataTransformBanner:()=>{e().lastAppliedDataTransform&&t({isLastAppliedDataTransformBannerDismissed:!0})},linkChartSelectionToRawData:(x,I,D,R)=>{const P=!!I&&D.length>0,A=e().interactiveSelectionFilter;if(!P){A&&A.sourceCardId===x&&t({interactiveSelectionFilter:null});return}const k=D.map(F=>typeof F=="number"?F:String(F));A&&A.sourceCardId===x&&A.column===I&&Uq(A.values,k)||(t({interactiveSelectionFilter:{sourceCardId:x,column:I,values:k,label:R,createdAt:new Date().toISOString()},isSpreadsheetVisible:!0}),setTimeout(()=>{var F;(F=document.getElementById("raw-data-explorer"))==null||F.scrollIntoView({behavior:"smooth",block:"center"})},150))},clearInteractiveSelectionFilter:()=>{const x=e().interactiveSelectionFilter;if(!x)return;const I={sender:"ai",text:`System note: Cleared chart drilldown "${x.label}" (${x.column}); Raw Data Explorer now shows all rows.`,timestamp:new Date,type:"ai_message"};t(R=>({interactiveSelectionFilter:null,chatHistory:[...R.chatHistory,I]})),e().addProgress("Cleared the linked chart selection filter.");const D=e().beginAgentActionTrace("dom_action","User cleared chart drilldown","system");e().updateAgentActionTrace(D,"succeeded","Chart drilldown reset via UI",{metadata:{drilldownLabel:x.label,drilldownColumn:x.column,valueCount:x.values.length}})},init:async()=>{const x=await wo(sa);if(x){const I=x.appState.useLangGraphRuntime===!1;t({...so,...x.appState,useLangGraphRuntime:!0,isBusy:!1,busyMessage:null,canCancelBusy:!1,busyRunId:null,isCancellationRequested:!1,aiFilterRunId:null,abortControllers:{},toasts:[],currentView:x.appState.csvData?"analysis_dashboard":"file_upload",pendingClarifications:x.appState.pendingClarifications??[],activeClarificationId:x.appState.activeClarificationId??null,agentActionTraces:x.appState.agentActionTraces??[],agentValidationEvents:x.appState.agentValidationEvents??[],chatMemoryPreview:[],chatMemoryExclusions:[],chatMemoryPreviewQuery:"",isMemoryPreviewLoading:!1,columnAliasMap:x.appState.columnAliasMap??v_(x.appState.columnProfiles??[]),pendingDataTransform:null,lastAppliedDataTransform:null,interactiveSelectionFilter:null,plannerSession:Xp(x.appState.plannerSession),plannerDatasetHash:x.appState.plannerDatasetHash??x.appState.datasetHash??null,datasetProfile:x.appState.datasetProfile??null,analysisTimeline:x.appState.analysisTimeline??{...so.analysisTimeline},graphObservations:x.appState.graphObservations??[]}),await y_(x.appState.vectorStoreDocuments,x.appState.datasetHash,e().datasetHash,e().addProgress,e().addToast,e().dismissToast,"Restored AI long-term memory from last session."),d_(x.createdAt),I&&f_()}else{const I=I3();I&&await L(I)}await e().loadReportsList()},connectGraphRuntime:()=>{const x=e().useLangGraphRuntime?"langgraph":"legacy",I=x==="langgraph"?"LangGraph":"Graph";if(ap&&rp===x)return;ys==null||ys(),ys=null,ap=!0,rp=x;const D=s();if(!D.isSupported){t({graphStatus:"error",graphStatusMessage:` ${I} Web Workerruntime `});return}t({graphStatus:"connecting",graphStatusMessage:`Spinning up ${I} runtime`}),ys=D.subscribe(R=>{switch(R.type){case"graph/ready":{const P=new Date(R.timestamp).toISOString();t({graphStatus:"ready",graphStatusMessage:`Graph Ready (v${R.version})`,graphVersion:R.version,graphLastReadyAt:P}),e().addProgress(`Graph runtime ready (v${R.version}).`);return}case"graph/log":e().addProgress(`Graph: ${R.message}`,R.level==="error"?"error":"system");return;case"graph/error":t({graphStatus:"error",graphStatusMessage:R.message}),e().addProgress(`Graph error: ${R.message}`,"error");return;case"graph/pipeline":{const P=e().graphObservations??[],A=new Set(P.map(q=>q.id)),F=(R.state.observations??[]).filter(q=>!A.has(q.id)),U=new Date(R.timestamp).toISOString(),z=R.state.awaitPrompt??null,oe=R.phase??current.graphPhase??"idle",se=R.loopBudget??current.graphLoopBudget;if(t(q=>({graphStatus:"ready",graphStatusMessage:`Pipeline node ${R.node} emitted ${R.actions.length} action(s).`,graphLastReadyAt:U,graphPhase:oe,graphLoopBudget:se,graphAwaitPrompt:z,graphAwaitPromptId:(z==null?void 0:z.promptId)??null,agentAwaitingUserInput:!!z,graphSessionId:R.state.sessionId??q.graphSessionId??null,graphAwaitHistory:z?Tq(q.graphAwaitHistory,z,U):q.graphAwaitHistory,graphObservations:R.state.observations??q.graphObservations})),F.forEach(q=>{e().addProgress(hq(q))}),z)e().addProgress(`Graph awaiting your choice: ${z.question}`);else{const q=se?`Loop ${se.actsUsed}/${se.maxActs}${se.exceeded?" (max reached)":""}`:null,j=`Phase ${oe}`,ae=q?`${j}  ${q}`:j;e().addProgress(`Graph ${ae}  node ${R.node} completed.`),se!=null&&se.exceeded&&e().addProgress("Loop budget reached  awaiting confirmation before further automation.","error"),t({agentAwaitingUserInput:!1})}e().processGraphActions(R.actions??[]);return}case"graph/pong":t({graphLastReadyAt:new Date(R.timestamp).toISOString()});return;default:return}}),D.ensureWorker(),D.post({type:"graph/init",origin:"ui",timestamp:Date.now()})},runGraphPipeline:x=>{i({type:"graph/runPipeline",payload:x,timestamp:Date.now()})},sendGraphUserReply:async(x,I)=>{var q;const D=s();if(!D.isSupported)return;const R=e().graphAwaitPrompt,P=new Date().toISOString(),A=typeof I=="string"?I.trim():void 0;if(!x&&!A)return;const k=x&&R?((q=R.options.find(j=>j.id===x))==null?void 0:q.label)??x:null,F=x?`${k??x}`:`${A??""}`,z={sender:"user",text:R?`${R.question}
${F}`:F,timestamp:new Date,type:"user_message"};t(j=>({chatHistory:[...j.chatHistory,z],graphAwaitHistory:R?Cq(j.graphAwaitHistory,R.promptId??null,P,{label:k??A??null,value:x??A??null,type:x?"option":"free_text"}):j.graphAwaitHistory})),D.post({type:"graph/userReply",optionId:x,freeText:A,timestamp:Date.now()});const oe=e();if(!yq(oe,x,A)){D.post({type:"graph/runPipeline",payload:{reason:"user_reply"},timestamp:Date.now()});return}try{const j=await vq(oe);e().setLangChainLastPlan(j.plan),e().appendPlannerObservation(j.observation),e().updatePlannerPlanState(j.planState),u("langchain_plan",j.usageLog);const ae=gq(j.telemetry);e().addProgress(` LangChain plan ready (${ae})  ${j.summary}`),D.post({type:"graph/runPipeline",payload:{reason:"langchain_plan",langChainPlan:X3(j)},timestamp:Date.now()})}catch(j){const ae=j instanceof Error?j.message:String(j);e().addProgress(`LangChain planner failed: ${ae} planner`,"error"),D.post({type:"graph/runPipeline",payload:{reason:"langchain_plan_fallback"},timestamp:Date.now()})}},processGraphActions:async x=>{var I,D,R,P;if(!(!Array.isArray(x)||x.length===0))for(const A of x)switch(A.responseType){case"plan_state_update":A.planState&&e().updatePlannerPlanState(A.planState);break;case"plan_creation":if(A.plan){const k=e().csvData;if(!k){e().addProgress("Graph plan creation skipped: dataset unavailable.","error");break}const F=e().datasetHash,U=((I=e().datasetProfile)==null?void 0:I.rowCount)??k.data.length,z={kind:"aggregate_plan",params:{planTitle:A.plan.title??"analysis"}};d(z);try{const se=await no.aggregatePlan({plan:A.plan,datasetId:F,csvData:k,rowCountHint:U,options:{preferredMode:e().aggregationModePreference,runtimeConfig:e().datasetRuntimeConfig}});f(se,{description:A.plan.title??"analysis"})}catch(se){const q=se instanceof Ln?se:null;y("aggregate_plan",q==null?void 0:q.code,(q==null?void 0:q.message)??(se instanceof Error?se.message:String(se)),q==null?void 0:q.suggestion)}finally{m()}e().addProgress(`Graph executing plan "${A.plan.title??"analysis"}" via data pipeline.`);const oe=sp();await T(A.plan,k,oe)}break;case"execute_js_code":(A.toolCall||(D=A.meta)!=null&&D.toolCall)&&await S(A.toolCall??((R=A.meta)==null?void 0:R.toolCall));break;case"text_response":case"await_user":{const k=(P=A.text)==null?void 0:P.trim();if(!k)break;const F={sender:"ai",text:k,timestamp:A.timestamp?new Date(A.timestamp):new Date,type:A.responseType==="await_user"?"ai_clarification":"ai_message",cardId:A.cardId,meta:A.meta};t(U=>({chatHistory:[...U.chatHistory,F]}));break}}},addProgress:(x,I="system")=>{const D={text:x,type:I,timestamp:new Date};t(R=>({progressMessages:[...R.progressMessages,D]}))},loadReportsList:async()=>{const x=await FL();t({reportsList:x})},handleSaveSettings:x=>{HL(x);const I=x.provider==="google"?!!x.geminiApiKey:!!x.openAIApiKey;t({settings:x,isApiKeySet:I}),$T(x)},handleAsideMouseDown:x=>{x.preventDefault(),e().setIsResizing(!0);const I=R=>{const P=window.innerWidth-Pq;let A=window.innerWidth-R.clientX;A=Math.max(up,A),A=Math.min(Mq,A,P),e().setAsideWidth(A)},D=()=>{e().setIsResizing(!1),document.removeEventListener("mousemove",I),document.removeEventListener("mouseup",D)};document.addEventListener("mousemove",I),document.addEventListener("mouseup",D)},runAnalysisPipeline:async(x,I,D={})=>{var le;const{isChatRequest:R=!1,runId:P}=D,A=e().addProgress,k=e().settings,F=()=>P?e().isRunCancellationRequested(P):!1,U=()=>_(P);let z=!0;const oe=e().beginAgentActionTrace,se=e().updateAgentActionTrace,q=e().datasetHash,j=!R,ae=()=>{j&&t(ie=>{const ue=ie.analysisTimeline;if(!ue.totalCards)return{};const me=Math.min(ue.totalCards,ue.completedCards+1),Ee=ue.stage==="profiling"&&me>0?"insight":ue.stage;return{analysisTimeline:{...ue,completedCards:me,stage:Ee}}})},ge=((le=e().datasetProfile)==null?void 0:le.rowCount)??I.data.length,Ce=ie=>{var me;const ue=e();return Jp(ie,q,I,ge,{preferredMode:((me=ue.datasetRuntimeConfig)==null?void 0:me.mode)??ue.aggregationModePreference,runtimeConfig:ue.datasetRuntimeConfig})},H=async(ie,ue)=>{const me=Ce(ie);if(!me)return null;ue!=null&&ue.mode&&(me.mode=ue.mode),ue!=null&&ue.allowFullScan&&(me.allowFullScan=!0);const Ee=await Ss.aggregate(me);if(!Ee.ok){if(Ee.code===pt.FULL_SCAN_BLOCKED&&!me.allowFullScan)return p_(ie.title)?(A(`User enabled full scan for "${ie.title}".`,"system"),H(ie,{mode:"full",allowFullScan:!0})):(A(`Skipped "${ie.title}" because full scan was not approved.`,"error"),null);const Ae=op(Ee.code,Ee.reason);return A(`Aggregation worker failed for "${ie.title}": ${Ae}`,"error"),Ee.hint&&A(Ee.hint,"error"),null}return Ee.data.rows.length===0?(A(`Skipping "${ie.title}" due to empty aggregation result.`,"error"),null):{result:Ee.data,durationMs:Ee.durationMs??0}};j&&x.length>0&&t(ie=>({analysisTimeline:{stage:ie.analysisTimeline.stage==="persisting"?"profiling":ie.analysisTimeline.stage,totalCards:x.length,completedCards:0}}));const ee=async ie=>{var Ee;const ue=oe("proceed_to_analysis",`Run analysis "${ie.title}"`,"pipeline"),me=(Ae,ve)=>se(ue,Ae,ve);if(F())return null;try{A(`Executing plan: ${ie.title}...`),P&&e().updateBusyStatus(`Executing "${ie.title}"...`);const Ae=KL(ie,e().columnProfiles,I.data);if(!Ae.isValid)return A(`Skipping "${ie.title}" because ${Ae.errorMessage??"the plan is invalid."}`,"error"),me("failed",Ae.errorMessage??"Plan invalid."),null;Ae.warnings.forEach(Fe=>A(`${ie.title}: ${Fe}`));const ve=Ae.plan;let Et=null,Re=null,On=0,et=[];try{q&&(Et=await H(ve),Et&&(Re=Et.result,On=Et.durationMs)),Re?et=Re.rows:et=O_(I,ve)}catch(Fe){if(Fe instanceof N_&&Fe.code==="no_rows"){const da=ve.rowFilter?`${ve.rowFilter.column}  ${ve.rowFilter.values.join(", ")}`:"the requested filter";return A(`Skipping "${ie.title}" because ${da} returned no rows.`,"error"),me("failed",Fe.message),ae(),null}throw Fe}if(et.length===0)return A(`Skipping "${ie.title}" due to empty result.`,"error"),me("failed","Aggregation returned 0 rows."),ae(),null;if(F())return null;A(`AI is summarizing: ${ie.title}...`),P&&e().updateBusyStatus(`Summarizing "${ie.title}"...`);const Zt=await yL(ve.title,et,k,{signal:U(),onUsage:Fe=>{e().recordLlmUsage(Da(Fe,"summary.generate"))}});if(F())return null;let Ft=null,Se=(Re==null?void 0:Re.provenance.queryHash)??null;const je=(Re==null?void 0:Re.provenance.sampled)??!1;if(Re&&q){const Fe=await Ss.createCardFromResult({datasetId:q,title:ve.title,kind:Oq(ve),explainer:Zt,result:Re,plan:ve});Fe.ok?Ft=Fe.data.cardId:A(`View cache save failed for "${ve.title}": ${Fe.reason}`,"error")}const en=et.length,tn=ve.chartType!=="scatter"&&en>15,mt=Re?{mode:Re.provenance.mode,sampled:Re.provenance.sampled,processedRows:Re.provenance.processedRows,totalRows:Re.provenance.totalRows,warnings:Re.provenance.warnings,durationMs:On,lastRunAt:new Date().toISOString(),filterCount:Re.provenance.filterCount,requestedMode:Re.provenance.requestedMode??Re.provenance.mode,downgradedFrom:Re.provenance.downgradedFrom,downgradeReason:Re.provenance.downgradeReason,normalization:Re.provenance.normalization}:{mode:"full",sampled:!1,processedRows:et.length,totalRows:et.length,warnings:q?["Aggregated on main thread because the worker response was unavailable."]:[],durationMs:On||void 0,lastRunAt:new Date().toISOString(),filterCount:ve.rowFilter?1:0,requestedMode:e().aggregationModePreference??"full",normalization:Re==null?void 0:Re.provenance.normalization},$t={id:`card-${Date.now()}-${Math.random()}`,plan:ve,aggregatedData:et,summary:Zt,displayChartType:ve.chartType,isDataVisible:!1,topN:tn?8:ve.defaultTopN||null,hideOthers:tn?!0:ve.defaultHideOthers||!1,disableAnimation:R||!z||e().analysisCards.length>0,hiddenLabels:[],dataRefId:Ft,queryHash:Se,isSampledResult:(mt==null?void 0:mt.sampled)??je,aggregationMeta:mt,valueSchema:Re==null?void 0:Re.schema};t(Fe=>({analysisCards:[...Fe.analysisCards,$t]})),ae();const ca=`[Chart: ${ve.title}] Description: ${ve.description}. AI Summary: ${Zt.split("---")[0]}`;if(await Ke.addDocument({id:$t.id,text:ca,metadata:{kind:"card",summaryLevel:"summary",cardId:$t.id,createdAt:new Date().toISOString()}}),A(`View #${$t.id.slice(-6)} indexed for long-term memory.`),q&&Ft){const Fe=((Ee=mt==null?void 0:mt.warnings)==null?void 0:Ee.length)??0,da={datasetId:q,viewId:Ft,cardId:$t.id,title:ve.title,summary:Zt,plan:ve,chartType:ve.chartType,schema:Re==null?void 0:Re.schema,sampleRows:et.slice(0,Dq),rowCount:et.length,sampled:(mt==null?void 0:mt.sampled)??je??!1,queryHash:Se,qualityScore:Lq(et.length,Fe,(mt==null?void 0:mt.sampled)??je??!1),tags:kq(ve)};r3(da).catch(Ga=>console.warn("Failed to persist memory snapshot for dataset cache:",Ga))}return z=!1,A(`Saved as View #${$t.id.slice(-6)}`),me("succeeded",`Created card with ${et.length} rows.`),$t}catch(Ae){if(F())return A(`Cancelled "${ie.title}" before completion.`),se(ue,"failed","Cancelled before completion."),ae(),null;console.error("Error executing plan:",ie.title,Ae);const ve=Ae instanceof Error?Ae.message:String(Ae);return A(`Error executing plan "${ie.title}": ${ve}`,"error"),me("failed",ve),ae(),null}},W=(await Promise.all(x.map(ee))).filter(ie=>ie!==null);if(!R&&W.length>0&&!F()){A("AI is forming its core understanding of the data..."),P&&e().updateBusyStatus("Forming core understanding...");const ie=W.map(ve=>({id:ve.id,title:ve.plan.title,aggregatedDataSample:ve.aggregatedData.slice(0,10)})),ue=await vL(ie,e().columnProfiles,k,{signal:U(),onUsage:ve=>{e().recordLlmUsage(Da(ve,"summary.core_analysis"))}});if(F())return W;const me={sender:"ai",text:ue,timestamp:new Date,type:"ai_thinking"};if(t(ve=>({aiCoreAnalysisSummary:ue,chatHistory:[...ve.chatHistory,me]})),A("Indexing core analysis for long-term memory..."),await Ke.addDocument({id:"core-summary",text:`Core Analysis Summary: ${ue}`,metadata:{kind:"card",summaryLevel:"summary",createdAt:new Date().toISOString(),cardId:"core-summary"}}),A("Core analysis indexed."),F())return W;A("AI is looking for key insights..."),P&&e().updateBusyStatus("Looking for key insights...");const Ee=await SL(ie,k,{signal:U(),onUsage:ve=>{e().recordLlmUsage(Da(ve,"summary.proactive_insight"))}});if(F())return W;if(Ee){const ve={sender:"ai",text:Ee.insight,timestamp:new Date,type:"ai_proactive_insight",cardId:Ee.cardId};t(Et=>({chatHistory:[...Et.chatHistory,ve]})),A(`AI proactively identified an insight in View #${Ee.cardId.slice(-6)}.`)}if(F())return W;const Ae=await bw(W,k,{signal:U(),onUsage:ve=>{e().recordLlmUsage(Da(ve,"summary.final"))}});if(F())return W;t({finalSummary:Ae}),A("Overall summary generated.")}return W},handleInitialAnalysis:async(x,I={})=>{if(!x)return;t(R=>R.analysisTimeline.stage==="persisting"?{}:{analysisTimeline:{...R.analysisTimeline,stage:"profiling",totalCards:0,completedCards:0}});const{runId:D}=I;await $p({beginBusy:e().beginBusy,endBusy:e().endBusy},"Running analysis...",async R=>{e().addProgress("Starting main analysis...");try{e().addProgress("AI is generating analysis plans..."),e().updateBusyStatus("Drafting analysis plans...");const P=e().datasetHash;P&&await C(P,x.data.length);const A=P?await i3(P,{limit:6,minScore:.4}):[],k=await dL(e().columnProfiles,x.data.slice(0,50),e().settings,{signal:_(R),memorySnapshots:A});k.warnings.forEach(U=>{const z=`Plan generator warning: ${U.message}`;e().addProgress(z,"error"),e().addToast(U.message,"error",6e3)});const F=k.plans;if(u("analysis_plan",k.telemetry),R&&e().isRunCancellationRequested(R)){e().addProgress("Analysis cancelled before execution.");return}e().addProgress(`AI proposed ${F.length} plans.`),F.length>0?await e().runAnalysisPipeline(F,x,{runId:R}):(e().addProgress("AI did not propose any analysis plans.","error"),t(U=>({analysisTimeline:{...U.analysisTimeline,stage:"idle",totalCards:0,completedCards:0}})))}catch(P){if(P instanceof jb)P.warnings.forEach(A=>{e().addProgress(`Plan generator warning: ${A.message}`,"error"),e().addToast(A.message,"error",7e3)}),e().addProgress("Plan generation failed. Please retry analysis or adjust your prompt.","error"),e().addToast("Plan generation failed. Retry?","error",0,{label:"Retry analysis",onClick:()=>{const A=e().csvData;A&&e().handleInitialAnalysis(A)}}),t(A=>({analysisTimeline:{...A.analysisTimeline,stage:"idle"}}));else if(!(R&&e().isRunCancellationRequested(R))){console.error("Analysis pipeline error:",P);const A=P instanceof Error?P.message:String(P);e().addProgress(`Error during analysis: ${A}`,"error"),e().addToast("Analysis failed. Retry?","error",0,{label:"Retry",onClick:()=>{const k=e().csvData;k&&e().handleInitialAnalysis(k)}})}}finally{R&&e().isRunCancellationRequested(R)?e().addProgress("Stopped current analysis."):e().addProgress("Analysis complete. Ready for chat.")}},{runId:D,cancellable:!0})},regenerateAnalyses:async x=>{e().addProgress("Data has changed. Regenerating all analysis cards...");const I=e().analysisCards.map(D=>D.plan);t({analysisCards:[],finalSummary:null}),await $p({beginBusy:e().beginBusy,endBusy:e().endBusy},"Regenerating insight cards...",async D=>{try{if(I.length>0){const R=await e().runAnalysisPipeline(I,x,{isChatRequest:!0,runId:D});if(R.length>0&&!(D&&e().isRunCancellationRequested(D))){const P=await bw(R,e().settings,{signal:_(D),onUsage:A=>{e().recordLlmUsage(Da(A,"summary.final"))}});D&&e().isRunCancellationRequested(D)||(t({finalSummary:P}),e().addProgress("All analysis cards have been updated."))}}else e().addProgress("No existing plans found to regenerate.","error")}catch(R){if(!(D&&e().isRunCancellationRequested(D))){console.error("Error regenerating analyses:",R);const P=R instanceof Error?R.message:String(R);e().addProgress(`Error updating analyses: ${P}`,"error")}}},{cancellable:!0})},executeQuickAction:async x=>{var D;const I=()=>e().addToast(" CSV ","error",4e3);switch(x){case"profile_dataset":{const R=e().datasetHash;if(!R){I();return}e().addProgress("Running quick data profile");try{const P=await no.profileDataset(R,(D=e().datasetRuntimeConfig)==null?void 0:D.profileSampleSize),A=P.context??null;A&&e().applyDatasetProfileSnapshot(A),f(P,{description:"Dataset profile (quick action)"});const k=P.summary,F={sender:"ai",text:`  ${P.payload.columns} ${P.payload.rowCount.toLocaleString()}  Data Profile `,timestamp:new Date,type:"ai_message"};t(U=>({chatHistory:[...U.chatHistory,F]}))}catch(P){const A=P instanceof Ln?P:null;y("profile_dataset",A==null?void 0:A.code,(A==null?void 0:A.message)??(P instanceof Error?P.message:String(P)),A==null?void 0:A.suggestion)}break}case"open_raw_preview":{e().focusDataPreview();const R={sender:"ai",text:" Raw Data Explorer ",timestamp:new Date,type:"ai_message"};t(P=>({chatHistory:[...P.chatHistory,R]}));break}case"topn_quick_chart":{const R=e().csvData;if(!R||R.data.length===0){I();return}const P=xq(e().columnProfiles,R.data.slice(0,200));if(!P){e().addProgress(" /  Top-N ","error");return}e().addProgress(`Running quick Top-N chart: ${P.title}`);const k=(await e().runAnalysisPipeline([P],R,{isChatRequest:!0}))[0];if(k){const F={sender:"ai",text:`  Top-N ${k.plan.title}`,timestamp:new Date,type:"ai_message",cardId:k.id};t(U=>({chatHistory:[...U.chatHistory,F]}))}else e().addProgress("Quick Top-N ","error");break}default:e().addProgress("Unknown quick action.","error")}},executeDomAction:x=>{e().addProgress(`AI is performing action: ${x.toolName}...`);const I=(P,A)=>{t(k=>{const F=k.analysisCards.findIndex(oe=>oe.id===P);if(F===-1)return{};const U=A(k.analysisCards[F]);if(!U)return{};const z=[...k.analysisCards];return z[F]=U,{analysisCards:z}})},D=P=>e().analysisCards.find(A=>A.id===P),R=P=>{const A=P.plan.groupByColumn||"",k=P.plan.valueColumn||"count";let F=P.aggregatedData;const U=P.filter;if(U!=null&&U.column&&U.values&&U.values.length>0&&(F=F.filter(z=>U.values.includes(z[U.column]))),P.plan.chartType!=="scatter"&&A&&P.topN&&(F=P_(F,A,k,P.topN)),P.topN&&P.hideOthers&&A&&(F=F.filter(z=>z[A]!=="Others")),A&&P.hiddenLabels&&P.hiddenLabels.length>0){const z=new Set(P.hiddenLabels.map(String));F=F.filter(oe=>!z.has(String(oe[A])))}return F};switch(x.toolName){case"highlightCard":{const P=x.args.cardId,A=document.getElementById(P);A&&(A.scrollIntoView({behavior:"smooth",block:"center"}),A.classList.add("ring-4","ring-blue-500","transition-all","duration-500"),setTimeout(()=>A.classList.remove("ring-4","ring-blue-500"),2500));break}case"changeCardChartType":{const{cardId:P,newType:A}=x.args;I(P,k=>({...k,displayChartType:A}));break}case"showCardData":{const{cardId:P,visible:A}=x.args,k=typeof A=="boolean"?A:!0;I(P,F=>({...F,isDataVisible:k}));break}case"filterCard":{const{cardId:P,column:A,values:k}=x.args;if(!A)break;const F=Array.isArray(k)?k:[];I(P,U=>({...U,filter:F.length>0?{column:A,values:F}:void 0}));break}case"setTopN":{const{cardId:P,topN:A}=x.args,k=A==null||A==="all"?null:Number(A);if(k!==null&&(!Number.isFinite(k)||k<=0))break;I(P,F=>({...F,topN:k}));break}case"toggleHideOthers":{const{cardId:P,hide:A}=x.args;I(P,k=>({...k,hideOthers:typeof A=="boolean"?A:!k.hideOthers}));break}case"toggleLegendLabel":{const{cardId:P,label:A}=x.args;if(!A)break;I(P,k=>{const F=k.hiddenLabels||[],z=F.includes(A)?F.filter(oe=>oe!==A):[...F,A];return{...k,hiddenLabels:z}});break}case"exportCard":{const{cardId:P,format:A="png"}=x.args,k=D(P),F=document.getElementById(P);if(!k||!F){console.warn("exportCard: card or DOM node not found",P);break}const U=R(k),z=typeof A=="string"?A.toLowerCase():"png";(async()=>{try{switch(z){case"csv":B_(U,k.plan.title);break;case"html":await F_(F,k.plan.title,U,k.summary);break;default:await q_(F,k.plan.title);break}e().addProgress(`Exported "${k.plan.title}" as ${z.toUpperCase()}.`)}catch(oe){console.error("Failed to export card",oe),e().addProgress("Export failed. Please try again.","error")}})();break}case"removeCard":{const{cardId:P}=x.args;if(!P||typeof P!="string")break;let A=null,k=!1;t(F=>{var oe,se;const U=F.analysisCards.find(q=>q.id===P);if(!U)return{};k=!0,A=((oe=U.plan)==null?void 0:oe.title)??P;const z={analysisCards:F.analysisCards.filter(q=>q.id!==P)};return((se=F.interactiveSelectionFilter)==null?void 0:se.sourceCardId)===P&&(z.interactiveSelectionFilter=null),z}),k?e().addProgress(`Removed card "${A??P}" as requested.`):e().addProgress("Unable to remove the requested card because it was not found.","error");break}}},handleExternalCsvPayload:async x=>{var P;if(!x||typeof x.csv!="string"||!x.csv.trim()){e().addToast("Received empty CSV payload from source page.","error");return}const I=((P=x.fileName)==null?void 0:P.trim())||Rq(x.header),D=new Blob([x.csv],{type:"text/csv"});let R;try{R=new File([D],I,{type:"text/csv"})}catch{R=Object.assign(D,{name:I,lastModified:Date.now()})}try{await e().handleFileUpload(R)}catch(A){console.error("Failed to import CSV payload from opener.",A),e().addToast("Failed to import CSV from report page.","error")}},applyDatasetProfileSnapshot:x=>{const I=`obs-profile-${Date.now().toString(36)}`,D=new Date().toISOString(),R={id:I,actionId:"dataset_profile",responseType:"plan_state_update",status:"success",timestamp:D,outputs:{rowCount:x.rowCount,sampledRows:x.sampledRows,sampleRatio:x.rowCount>0?Number((x.sampledRows/x.rowCount).toFixed(3)):1}};t(P=>{const A=P.plannerSession.planState;if(!A)return{datasetProfile:x};const k=A.observationIds??[];return k.includes(I)?{datasetProfile:x}:{datasetProfile:x,plannerSession:{...P.plannerSession,planState:{...A,observationIds:[...k,I]}}}}),e().appendPlannerObservation(R)},handleChartTypeChange:(x,I)=>{t(D=>({analysisCards:D.analysisCards.map(R=>R.id===x?{...R,displayChartType:I}:R)}))},handleToggleDataVisibility:x=>{t(I=>({analysisCards:I.analysisCards.map(D=>D.id===x?{...D,isDataVisible:!D.isDataVisible}:D)}))},handleTopNChange:(x,I)=>{t(D=>({analysisCards:D.analysisCards.map(R=>R.id===x?{...R,topN:I}:R)}))},handleHideOthersChange:(x,I)=>{t(D=>({analysisCards:D.analysisCards.map(R=>R.id===x?{...R,hideOthers:I}:R)}))},handleToggleLegendLabel:(x,I)=>{t(D=>({analysisCards:D.analysisCards.map(R=>{if(R.id===x){const P=R.hiddenLabels||[],A=P.includes(I)?P.filter(k=>k!==I):[...P,I];return{...R,hiddenLabels:A}}return R})}))},setAggregationModePreference:x=>{if(e().aggregationModePreference===x)return;t({aggregationModePreference:x});const I=e().datasetHash;I&&N(I,{mode:x,allowFullScan:x==="full"});const D=x==="full"?"":"";e().addProgress(D)},resetConversationMemory:()=>{Ke.clear(),t({conversationMemoryState:HT(),vectorStoreDocuments:[],chatMemoryPreview:[],chatMemoryExclusions:[],chatMemoryPreviewQuery:"",isMemoryPreviewLoading:!1}),e().addProgress("Conversation memory has been reset.")},maybeCompactConversationMemory:async()=>{if(ip)return;const x=e();if(x.chatHistory.length!==0){ip=!0;try{if(Ke.getIsInitialized()||await Ke.init(x.addProgress),!Ke.getIsInitialized())return;let I={...x.conversationMemoryState};const{chatHistory:D}=x,R=new Date().toISOString(),P=Math.max(0,D.length-lq);for(;I.lastIndexedMessage+lp<=P&&lp>0;){const A=I.lastIndexedMessage,k=A+lp-1,F=D.slice(A,k+1);if(F.length===0)break;const U=`conv-raw-${A}-${k}-${Date.now().toString(36)}`,z=mq(F,A);await Ke.addDocument({id:U,text:`Conversation Memory (raw snippet)
${z}`,metadata:{kind:"conversation",summaryLevel:"raw",startIndex:A,endIndex:k,createdAt:R,messageCount:F.length}}),I={...I,lastIndexedMessage:k+1,rawChunks:[...I.rawChunks,{id:U,startIndex:A,endIndex:k,summaryLevel:"raw",createdAt:R}]}}if(I.rawChunks.length>m_){const A=I.rawChunks.length-m_,k=I.rawChunks.slice(0,A);if(k.reduce((U,z)=>U+(z.endIndex-z.startIndex+1),0)>=uq){const U=k[0].startIndex,z=k[k.length-1].endIndex,oe=D.slice(U,z+1),se=await wL(oe,x.settings,{onUsage:j=>x.recordLlmUsage(Da(j,"memory.conversation"))}),q=`conv-summary-${U}-${z}-${Date.now().toString(36)}`;await Ke.addDocument({id:q,text:`Compressed Memory (messages ${U+1}-${z+1})
${se}`,metadata:{kind:"conversation",summaryLevel:"summary",startIndex:U,endIndex:z,createdAt:new Date().toISOString(),sourceDocIds:k.map(j=>j.id),messageCount:oe.length}}),k.forEach(j=>Ke.deleteDocument(j.id)),I={...I,rawChunks:I.rawChunks.slice(A),summaryChunks:[...I.summaryChunks,{id:q,startIndex:U,endIndex:z,summaryLevel:"summary",createdAt:new Date().toISOString()}]}}}t({conversationMemoryState:I,vectorStoreDocuments:Ke.getDocuments()})}catch(I){console.error("Conversation memory compaction failed:",I)}finally{ip=!1}}},recordLlmUsage:x=>{const I=x.estimatedCostUsd!=null?x.estimatedCostUsd:tq({provider:x.provider,model:x.model,promptTokens:x.promptTokens,completionTokens:x.completionTokens,totalTokens:x.totalTokens}),D=cq({...x,estimatedCostUsd:I??null});t(R=>({llmUsageLog:[...R.llmUsageLog,D].slice(-40)})),e().addProgress(`LLM ${fq(D)}`)},clearLlmUsage:()=>{t({llmUsageLog:[]})},toggleLangGraphRuntime:x=>{e().useLangGraphRuntime!==x&&(ys==null||ys(),ys=null,ap=!1,rp=null,t({useLangGraphRuntime:x,graphStatus:"idle",graphStatusMessage:"Graph runtime not connected.",graphVersion:null,graphLastReadyAt:null}))},setLangChainLastPlan:x=>{t({langChainLastPlan:x})},setLangChainPlannerEnabled:x=>{t({langChainPlannerEnabled:x})},rerunAggregationForCard:async(x,I={})=>{var se,q,j;const D=e().analysisCards.find(ae=>ae.id===x),R=e().datasetHash,P=e().csvData;if(!D||!R)return e().addProgress("Cannot refresh this chart because the dataset is unavailable.","error"),!1;const A=((se=e().datasetProfile)==null?void 0:se.rowCount)??((q=P==null?void 0:P.data)==null?void 0:q.length)??0,k=Jp(D.plan,R,P,A,{preferredMode:((j=e().datasetRuntimeConfig)==null?void 0:j.mode)??e().aggregationModePreference,runtimeConfig:e().datasetRuntimeConfig});if(!k)return e().addProgress(`"${D.plan.title}" cannot be recalculated automatically.`,"error"),!1;I.mode&&(k.mode=I.mode),I.allowFullScan&&(k.allowFullScan=!0);const F=e().beginAgentActionTrace("proceed_to_analysis",`Manual aggregation rerun: ${D.plan.title}`,"system");e().updateAgentActionTrace(F,"executing",void 0,{metadata:{cardId:x,requestedMode:k.mode,allowFullScan:!!k.allowFullScan}});let U=await Ss.aggregate(k);if(!U.ok&&U.code===pt.FULL_SCAN_BLOCKED&&!k.allowFullScan)if(p_(D.plan.title))e().addProgress(`User enabled full scan for "${D.plan.title}".`,"system"),k.mode="full",k.allowFullScan=!0,U=await Ss.aggregate(k);else return e().addProgress(`Skipped "${D.plan.title}" because full scan was not approved.`,"error"),e().updateAgentActionTrace(F,"failed","Full scan not approved.",{metadata:{cardId:x,requestedMode:k.mode,allowFullScan:!!k.allowFullScan}}),!1;if(!U.ok){const ae=op(U.code,U.reason);return e().addProgress(`Aggregation refresh failed for "${D.plan.title}": ${ae}`,"error"),e().addToast(ae,"error"),e().updateAgentActionTrace(F,"failed",ae??"Aggregation failed.",{metadata:{cardId:x,requestedMode:k.mode,allowFullScan:!!k.allowFullScan}}),!1}const z=U.data,oe={mode:z.provenance.mode,sampled:z.provenance.sampled,processedRows:z.provenance.processedRows,totalRows:z.provenance.totalRows,warnings:z.provenance.warnings,durationMs:U.durationMs??0,lastRunAt:new Date().toISOString(),filterCount:z.provenance.filterCount,requestedMode:z.provenance.requestedMode??z.provenance.mode,downgradedFrom:z.provenance.downgradedFrom,downgradeReason:z.provenance.downgradeReason,normalization:z.provenance.normalization};return t(ae=>({analysisCards:ae.analysisCards.map(ge=>ge.id===x?{...ge,aggregatedData:z.rows,isSampledResult:oe.sampled,aggregationMeta:oe,valueSchema:z.schema}:ge)})),e().addProgress(`${D.plan.title} refreshed (${oe.sampled?"sampled":"full scan"}).`),e().addToast(oe.sampled?`"${D.plan.title}" refreshed on sampled rows.`:`"${D.plan.title}" full scan completed.`,"success"),e().updateAgentActionTrace(F,"succeeded","Aggregation refreshed.",{metadata:{cardId:x,mode:oe.mode,processedRows:oe.processedRows,totalRows:oe.totalRows,durationMs:oe.durationMs,warnings:oe.warnings}}),!0},clearCardFilter:x=>{t(I=>({analysisCards:I.analysisCards.map(D=>D.id===x?{...D,filter:void 0}:D)}))},triggerAutoSaveNow:()=>{f_()},handleLoadReport:async x=>{var D,R;e().addProgress(`Loading report ${x}...`);const I=await wo(x);I?(Ke.clear(),t({...I.appState,useLangGraphRuntime:!0,agentAwaitingUserInput:I.appState.agentAwaitingUserInput??!1,agentAwaitingPromptId:I.appState.agentAwaitingPromptId??null,currentView:"analysis_dashboard",isHistoryPanelOpen:!1,chatMemoryPreview:[],chatMemoryExclusions:[],chatMemoryPreviewQuery:"",isMemoryPreviewLoading:!1,agentActionTraces:I.appState.agentActionTraces??[],agentValidationEvents:I.appState.agentValidationEvents??[],columnAliasMap:I.appState.columnAliasMap??v_(I.appState.columnProfiles??[]),plannerSession:Xp(I.appState.plannerSession),plannerDatasetHash:I.appState.plannerDatasetHash??I.appState.datasetHash??null}),await C(I.appState.datasetHash??null,((D=I.appState.datasetProfile)==null?void 0:D.rowCount)??((R=I.appState.csvData)==null?void 0:R.data.length)),await y_(I.appState.vectorStoreDocuments,I.appState.datasetHash,e().datasetHash,e().addProgress,e().addToast,e().dismissToast,"Restored AI long-term memory from loaded report."),e().addProgress(`Report "${I.filename}" loaded.`),d_(I.createdAt)):e().addProgress(`Failed to load report ${x}.`,"error")},handleDeleteReport:async x=>{await Fp(x),await e().loadReportsList()},handleShowCardFromChat:x=>{const I=document.getElementById(x);I&&(I.scrollIntoView({behavior:"smooth",block:"center"}),I.classList.add("ring-4","ring-blue-500","transition-all","duration-500"),setTimeout(()=>I.classList.remove("ring-4","ring-blue-500"),2500))},setAgentPhase:(x,I)=>t({agentPhase:{phase:x,message:I??null,enteredAt:new Date().toISOString()}}),setIsAsideVisible:x=>t({isAsideVisible:x}),setAsideWidth:x=>t({asideWidth:x}),setIsSpreadsheetVisible:x=>t({isSpreadsheetVisible:x}),setIsDataPrepDebugVisible:x=>t({isDataPrepDebugVisible:x}),setIsSettingsModalOpen:x=>t({isSettingsModalOpen:x}),setIsHistoryPanelOpen:x=>t({isHistoryPanelOpen:x}),setIsMemoryPanelOpen:x=>t({isMemoryPanelOpen:x}),setIsResizing:x=>t({isResizing:x}),recordAgentValidationEvent:({actionType:x,reason:I,actionIndex:D,runId:R,retryInstruction:P,timestamp:A})=>{const k={id:aq(),actionType:x,reason:I,actionIndex:D,runId:R??null,retryInstruction:P,timestamp:A??new Date().toISOString()};t(F=>({agentValidationEvents:[...F.agentValidationEvents,k].slice(-25)})),typeof window<"u"&&typeof window.dispatchEvent=="function"&&window.dispatchEvent(new CustomEvent("agent-validation-event",{detail:k}))},dismissAgentValidationEvent:x=>{t(I=>({agentValidationEvents:I.agentValidationEvents.filter(D=>D.id!==x)}))},clearAgentValidationEvents:()=>t({agentValidationEvents:[]}),recordPromptMetric:x=>{t(I=>({agentPromptMetrics:[...I.agentPromptMetrics,x].slice(-20)}))},clearPromptMetrics:()=>t({agentPromptMetrics:[]}),beginAgentActionTrace:(x,I,D="chat")=>{const R=`trace-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,P={id:R,actionType:x,status:"observing",summary:I,timestamp:new Date,source:D};return t(A=>({agentActionTraces:[...A.agentActionTraces,P].slice(-40)})),R},updateAgentActionTrace:(x,I,D,R)=>{t(P=>({agentActionTraces:P.agentActionTraces.map(A=>{if(A.id!==x)return A;const k=R!=null&&R.metadata?{...A.metadata??{},...R.metadata}:A.metadata;return{...A,status:I,details:D,timestamp:new Date,durationMs:(R==null?void 0:R.durationMs)??A.durationMs,errorCode:(R==null?void 0:R.errorCode)??A.errorCode,metadata:k}})}))},annotateAgentActionTrace:(x,I)=>{!I||Object.keys(I).length===0||t(D=>({agentActionTraces:D.agentActionTraces.map(R=>R.id===x?{...R,metadata:{...R.metadata??{},...I}}:R)}))},appendPlannerObservation:x=>{t(I=>{const D=[...I.plannerSession.observations,x].slice(-12);return{plannerSession:{...I.plannerSession,observations:D}}})},resetPlannerObservations:()=>{t(x=>({plannerSession:{...x.plannerSession,observations:[]}}))},updatePlannerPlanState:x=>{const I=g_(x.nextSteps);t(D=>({plannerSession:{...D.plannerSession,planState:{...x,nextSteps:I}},plannerPendingSteps:I,plannerDatasetHash:D.datasetHash??null}))},clearPlannerPlanState:()=>{t(x=>({plannerSession:{...x.plannerSession,planState:null},plannerPendingSteps:[],plannerDatasetHash:null}))},setPlannerPendingSteps:x=>{t({plannerPendingSteps:g_(x)})},completePlannerPendingStep:()=>{t(x=>x.plannerPendingSteps.length===0?{}:{plannerPendingSteps:x.plannerPendingSteps.slice(1)})},focusDataPreview:()=>{t({isSpreadsheetVisible:!0}),setTimeout(()=>{var x;(x=document.getElementById("raw-data-explorer"))==null||x.scrollIntoView({behavior:"smooth",block:"center"})},100)}}});De.subscribe(t=>t.chatHistory.length,(t,e)=>{t>e&&De.getState().maybeCompactConversationMemory()});$T(De.getState().settings);Wt=new L3({getStore:()=>De.getState(),buildSnapshot:Iq,addToast:(t,e,n,s)=>De.getState().addToast(t,e,n,s),dismissToast:t=>De.getState().dismissToast(t)});Fu&&Wt.configure(Fu);const Bq=()=>w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),Fq=()=>w.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:[w.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 000 2h6a1 1 0 100-2H7z",clipRule:"evenodd"}),w.jsx("path",{d:"M12.293 5.293a1 1 0 011.414 0l2 2a1 1 0 01-1.414 1.414L13 7.414V10a1 1 0 11-2 0V7.414l-1.293 1.293a1 1 0 01-1.414-1.414l2-2zM7.707 14.707a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L7 12.586V10a1 1 0 112 0v2.586l1.293-1.293a1 1 0 011.414 1.414l-2 2z"})]}),$q=()=>w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:w.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})}),S_=()=>w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-amber-600",viewBox:"0 0 20 20",fill:"currentColor",children:w.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.721-1.36 3.486 0l6.518 11.59c.75 1.334-.213 2.987-1.743 2.987H3.482c-1.53 0-2.493-1.653-1.743-2.987l6.518-11.59zM10 7a1 1 0 00-1 1v3.25a1 1 0 002 0V8a1 1 0 00-1-1zm0 8a1.25 1.25 0 100-2.5A1.25 1.25 0 0010 15z",clipRule:"evenodd"})}),Hq=t=>typeof t!="number"||Number.isNaN(t)?null:t<1e3?`${Math.round(t)} ms`:`${(t/1e3).toFixed(1)} s`,Gq=t=>{if(!t)return null;const e=new Date(t);return Number.isNaN(e.getTime())?null:e.toLocaleTimeString()},Vq=({meta:t,onRunFullScan:e,isRefreshing:n})=>{var C;if(!t)return null;const s=t.sampled,i=s?"bg-amber-100 text-amber-800 border-amber-200":"bg-emerald-100 text-emerald-700 border-emerald-200",o=s?"Sampled result":"Full scan",u=s?`${t.processedRows.toLocaleString()} of ${t.totalRows.toLocaleString()} rows`:`${t.totalRows.toLocaleString()} rows`,d=Hq(t.durationMs),m=Gq(t.lastRunAt),f=((C=t.warnings)==null?void 0:C.filter(Boolean))??[],S=(t.requestedMode??(s?"sample":"full"))==="full"&&t.mode!=="full",_=t.downgradeReason==="timeout"?"Full scan timed out":t.downgradeReason==="fallback"?"Full scan was not available":null,T=S?`${_??"Full scan fell back to a sample"} after processing ${t.processedRows.toLocaleString()} of ${t.totalRows.toLocaleString()} rows.`:null;return w.jsxs("div",{className:"mb-3 rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-600",children:[w.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[w.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-semibold border ${i}`,children:o}),w.jsx("span",{children:u}),d&&w.jsx("span",{className:"text-slate-400",children:""}),d&&w.jsx("span",{children:d}),m&&w.jsxs(w.Fragment,{children:[w.jsx("span",{className:"text-slate-400",children:""}),w.jsxs("span",{children:["Last run ",m]})]}),s&&w.jsxs(w.Fragment,{children:[w.jsx("span",{className:"text-slate-400",children:""}),w.jsx("span",{className:"text-xs text-slate-500",children:"Showing a quick preview. Full scan processes every row."})]}),s&&e&&!S&&w.jsx("button",{type:"button",onClick:()=>e(),disabled:n,className:"ml-auto inline-flex items-center rounded-md border border-slate-300 bg-white px-3 py-1 text-xs font-medium text-slate-700 hover:bg-slate-100 disabled:opacity-50",children:n?"Running":"Run full scan"})]}),T&&w.jsxs("div",{className:"mt-2 flex items-start gap-2 rounded-md border border-amber-200 bg-amber-50 px-3 py-2 text-xs text-amber-800",children:[w.jsx(S_,{}),w.jsxs("span",{className:"flex-1",children:[T," ",e&&w.jsx("button",{type:"button",onClick:()=>e(),disabled:n,className:"ml-1 underline decoration-dotted hover:text-amber-900 disabled:opacity-50",children:n?"Retrying":"Retry full scan"})]})]}),f.length>0&&w.jsxs("div",{className:"mt-2 flex items-start gap-2 text-xs text-amber-700",children:[w.jsx(S_,{}),w.jsx("span",{className:"flex-1",children:f.join("  ")})]})]})},zq=({meta:t,plan:e})=>{if(!t)return null;const n=`${t.processedRows.toLocaleString()} / ${t.totalRows.toLocaleString()}`,s=t.filterCount&&t.filterCount>0?`${t.filterCount} ${t.filterCount===1?"filter":"filters"} applied`:"No filters applied",i=e.orderBy&&e.orderBy.length>0?e.orderBy.map(u=>`${u.column} ${(u.direction??"desc").toUpperCase()}`).join(", "):e.chartType==="line"&&e.groupByColumn?`${e.groupByColumn} ASC`:`${e.valueColumn??"count"} DESC`,o=typeof e.limit=="number"?`${e.limit.toLocaleString()} rows`:e.defaultTopN?`${e.defaultTopN.toLocaleString()} rows (default)`:"All rows";return w.jsx("div",{className:"mt-4 border-t border-slate-200 pt-3 text-xs text-slate-500",children:w.jsxs("div",{className:"flex flex-wrap gap-x-6 gap-y-2",children:[w.jsxs("div",{children:[w.jsx("span",{className:"text-slate-400",children:"Rows processed"}),w.jsx("span",{className:"ml-1 font-semibold text-slate-700",children:n})]}),w.jsxs("div",{children:[w.jsx("span",{className:"text-slate-400",children:"Filters"}),w.jsx("span",{className:"ml-1 text-slate-700",children:s})]}),w.jsxs("div",{children:[w.jsx("span",{className:"text-slate-400",children:"Order"}),w.jsx("span",{className:"ml-1 text-slate-700",children:i})]}),w.jsxs("div",{children:[w.jsx("span",{className:"text-slate-400",children:"Limit"}),w.jsx("span",{className:"ml-1 text-slate-700",children:o})]})]})})},jq=({filter:t})=>{const n=t.values.slice(0,3).map(u=>String(u)).join(", "),s=t.values.length-3,i=s>0?`${n} +${s}`:n,o=`Rows limited to ${t.column}  ${t.values.map(u=>String(u)).join(", ")}`;return w.jsxs("span",{className:"ml-2 inline-flex items-center rounded-full bg-slate-100 px-2 py-0.5 text-xs font-medium text-slate-700 border border-slate-200",title:o,children:["Filtered  ",t.column,": ",i]})},Yq=({cardId:t})=>{var Zt,Ft;const e=De(Se=>Se.analysisCards.find(je=>je.id===t)),{handleChartTypeChange:n,handleToggleDataVisibility:s,handleTopNChange:i,handleHideOthersChange:o,handleToggleLegendLabel:u,rerunAggregationForCard:d,linkChartSelectionToRawData:m,clearCardFilter:f}=De(Se=>({handleChartTypeChange:Se.handleChartTypeChange,handleToggleDataVisibility:Se.handleToggleDataVisibility,handleTopNChange:Se.handleTopNChange,handleHideOthersChange:Se.handleHideOthersChange,handleToggleLegendLabel:Se.handleToggleLegendLabel,rerunAggregationForCard:Se.rerunAggregationForCard,linkChartSelectionToRawData:Se.linkChartSelectionToRawData,clearCardFilter:Se.clearCardFilter})),y=re.useRef(null),S=re.useRef(null),[_,T]=re.useState(!1),[C,N]=re.useState([]),[E,L]=re.useState(!1),[B,O]=re.useState(!0),[x,I]=re.useState(!1);if(!e)return null;const{id:D,plan:R,aggregatedData:P,summary:A,displayChartType:k,isDataVisible:F,topN:U,hideOthers:z,disableAnimation:oe,filter:se,hiddenLabels:q=[],aggregationMeta:j,valueSchema:ae}=e,ge=A.split("---"),Ce=(Zt=ge[0])==null?void 0:Zt.trim(),H=(Ft=ge[1])==null?void 0:Ft.trim(),ee=R.valueColumn||"count",W=R.groupByColumn||"",le=re.useMemo(()=>{let Se=P;return se&&se.column&&se.values.length>0&&(Se=Se.filter(je=>se.values.includes(je[se.column]))),Se},[P,se]),ie=re.useMemo(()=>R.chartType!=="scatter"&&W&&U?P_(le,W,ee,U):le,[le,R.chartType,W,U,ee]),ue=re.useMemo(()=>{let Se=ie;return U&&z&&(Se=Se.filter(je=>je[W]!=="Others")),W&&(Se=Se.filter(je=>!q.includes(String(je[W])))),Se},[ie,U,z,W,q]),me=re.useMemo(()=>le.reduce((Se,je)=>Se+(Number(je[ee])||0),0),[le,ee]),Ee=async Se=>{if(y.current){T(!0);try{switch(Se){case"png":await q_(y.current,R.title);break;case"csv":B_(ue,R.title);break;case"html":await F_(y.current,R.title,ue,A);break;case"json":RE({plan:R,data:ue,aggregationMeta:j,schema:ae??[]});break}}finally{T(!1)}}},Ae=(Se,je)=>{const en=je.ctrlKey||je.metaKey;N(tn=>en?(tn.includes(Se)?tn.filter($t=>$t!==Se):[...tn,Se]).sort(($t,ca)=>$t-ca):tn.includes(Se)?[]:[Se])},ve=()=>{var Se;return(Se=S.current)==null?void 0:Se.resetZoom()},Et=()=>N([]),Re=Se=>{const je=Se.target.value==="all"?null:parseInt(Se.target.value,10);i(D,je)},On=C.map(Se=>ue[Se]),et=re.useCallback(async()=>{if(d){I(!0);try{await d(D,{mode:"full",allowFullScan:!0})}finally{I(!1)}}},[D,d]);return re.useEffect(()=>{if(!W||C.length===0){m(D,null,[],R.title);return}const Se=C.map(je=>{var en;return(en=ue[je])==null?void 0:en[W]}).filter(je=>je!=null);if(Se.length===0){m(D,null,[],R.title);return}return m(D,W,Se,R.title),()=>{m(D,null,[],R.title)}},[W,C,ue,D,m,R.title]),w.jsxs("div",{ref:y,id:D,className:"bg-white rounded-lg shadow-lg p-4 flex flex-col transition-all duration-300 hover:shadow-blue-500/20 border border-slate-200 w-full",children:[w.jsxs("div",{className:"flex justify-between items-start gap-4 mb-2",children:[w.jsx("div",{className:"flex flex-col flex-1 min-w-0",children:w.jsxs("div",{className:"flex items-center flex-wrap",children:[w.jsx("h3",{className:"text-lg font-bold text-slate-900",children:R.title}),R.rowFilter&&w.jsx(jq,{filter:R.rowFilter})]})}),w.jsxs("div",{className:"flex items-center bg-slate-100 rounded-md p-0.5 space-x-0.5 flex-shrink-0",children:[w.jsx(DE,{currentType:k,onChange:Se=>n(D,Se)}),w.jsxs("div",{className:"relative group",children:[w.jsx("button",{disabled:_,className:"p-1.5 text-slate-500 hover:text-slate-900 rounded-md transition-colors hover:bg-slate-200",children:w.jsx(Bq,{})}),w.jsxs("div",{className:"absolute right-0 mt-2 w-36 bg-white border border-slate-200 rounded-md shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none group-hover:pointer-events-auto",children:[w.jsx("a",{onClick:()=>Ee("png"),className:"block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 cursor-pointer rounded-t-md",children:"Export as PNG"}),w.jsx("a",{onClick:()=>Ee("csv"),className:"block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 cursor-pointer",children:"Export as CSV"}),w.jsx("a",{onClick:()=>Ee("html"),className:"block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 cursor-pointer",children:"Export as HTML"}),w.jsx("a",{onClick:()=>Ee("json"),className:"block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 cursor-pointer rounded-b-md",children:"Export as JSON"})]})]})]})]}),w.jsx("p",{className:"text-sm text-slate-500 mb-4",children:R.description}),w.jsx(Vq,{meta:j,onRunFullScan:j!=null&&j.sampled?et:void 0,isRefreshing:x}),w.jsxs("div",{className:"grid gap-4 flex-grow grid-cols-1",children:[w.jsxs("div",{className:"relative h-64",children:[w.jsx(xE,{ref:S,chartType:k,data:ue,plan:R,selectedIndices:C,onElementClick:Ae,onZoomChange:L,disableAnimation:oe}),w.jsxs("div",{className:"absolute top-1 right-1 flex items-center space-x-1",children:[C.length>0&&w.jsx("button",{onClick:Et,title:"Clear selection",className:"p-1 bg-white/50 text-slate-600 rounded-full hover:bg-slate-100 hover:text-slate-800 transition-all backdrop-blur-sm",children:w.jsx($q,{})}),E&&w.jsx("button",{onClick:ve,title:"Reset zoom",className:"p-1 bg-white/50 text-slate-600 rounded-full hover:bg-slate-100 hover:text-slate-800 transition-all backdrop-blur-sm",children:w.jsx(Fq,{})})]})]}),W&&w.jsx("div",{className:"flex flex-col",children:w.jsx(LE,{data:ie,total:me,groupByKey:W,valueKey:ee,hiddenLabels:q,onLabelClick:Se=>u(D,Se)})})]}),se&&w.jsx("div",{className:"text-xs text-yellow-800 bg-yellow-100 p-3 rounded-md my-3 border border-yellow-200",children:w.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[w.jsxs("span",{children:[w.jsx("b",{children:"AI Filter Active:"})," Showing where '",se.column,"' is '",se.values.join(", "),`'. Ask AI to "clear filter" or use the button to remove.`]}),w.jsx("button",{type:"button",onClick:()=>f(D),className:"px-3 py-1 text-xs font-semibold text-yellow-900 bg-white/70 border border-yellow-300 rounded-md hover:bg-white hover:border-yellow-400 transition",children:"Clear filter"})]})}),w.jsx("div",{className:"mt-4 border-t border-slate-200 pt-4",children:w.jsxs("div",{className:"bg-slate-50 p-3 rounded-md text-sm border border-slate-200",children:[w.jsxs("div",{className:"flex justify-between items-baseline mb-2",children:[w.jsx("p",{className:"font-semibold text-blue-600",children:"AI Summary"}),R.aggregation==="sum"&&w.jsxs("p",{className:"text-xs text-slate-500",children:["Total: ",w.jsx("span",{className:"font-bold text-base text-slate-800",children:me.toLocaleString(void 0,{maximumFractionDigits:0})})]})]}),w.jsx("p",{className:"text-slate-700 text-xs",children:Ce}),H&&w.jsx("p",{className:"text-slate-500 mt-2 text-xs",children:H})]})}),w.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[w.jsx("div",{children:w.jsxs("button",{onClick:()=>s(D),className:"text-sm text-blue-600 hover:underline",children:[F?"Hide":"Show"," Full Data Table"]})}),R.chartType!=="scatter"&&P.length>5&&w.jsxs("div",{className:"flex items-center space-x-2",children:[w.jsx("label",{htmlFor:`top-n-${D}`,className:"text-xs text-slate-500",children:"Show"}),w.jsxs("select",{id:`top-n-${D}`,value:U||"all",onChange:Re,className:"bg-white border border-slate-300 text-slate-800 text-xs rounded-md py-1 px-2 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[w.jsx("option",{value:"all",children:"All"}),w.jsx("option",{value:"5",children:"Top 5"}),w.jsx("option",{value:"8",children:"Top 8"}),w.jsx("option",{value:"10",children:"Top 10"}),w.jsx("option",{value:"15",children:"Top 15"}),w.jsx("option",{value:"20",children:"Top 20"})]}),U&&w.jsx("div",{className:"flex items-center",children:w.jsxs("label",{htmlFor:`hide-others-${D}`,className:"flex items-center space-x-1.5 text-xs text-slate-500",children:[w.jsx("input",{type:"checkbox",id:`hide-others-${D}`,checked:z,onChange:Se=>o(D,Se.target.checked),className:"bg-slate-100 border-slate-300 rounded focus:ring-blue-500 text-blue-600 h-3.5 w-3.5"}),w.jsx("span",{children:'Hide "Others"'})]})})]})]}),C.length>0&&w.jsxs("div",{className:"mt-4 bg-slate-50 p-3 rounded-md text-sm border border-slate-200",children:[w.jsxs("button",{onClick:()=>O(!B),className:"w-full text-left font-semibold text-blue-600 mb-1",children:[B?"":""," Selection Details (",C.length," items)"]}),B&&w.jsx(Eu,{data:On,schema:ae})]}),F&&w.jsx("div",{className:"mt-2 max-h-48 overflow-y-auto border border-slate-200 rounded-md",children:w.jsx(Eu,{data:ue,schema:ae})}),w.jsx(zq,{meta:j,plan:R})]})},Jq=()=>w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 inline-block mr-2 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),Kq=({summary:t})=>w.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg shadow-lg p-6 mb-6",children:[w.jsxs("h2",{className:"text-xl font-bold text-slate-900 mb-3 flex items-center",children:[w.jsx(Jq,{}),"Overall Insights"]}),w.jsx("p",{className:"text-slate-700 whitespace-pre-wrap leading-relaxed",children:t})]}),Qp=[1,2,3],Xq=({isManual:t,statusLabel:e,selectedCount:n,onToggleMode:s,onSelectManualCount:i})=>w.jsx("div",{className:"flex justify-end",children:w.jsxs("div",{className:"flex flex-wrap items-center gap-4 rounded-2xl border border-slate-200 bg-white/80 px-4 py-3 shadow-sm",children:[w.jsxs("div",{className:"text-right",children:[w.jsx("p",{className:"text-sm font-semibold text-slate-600",children:"Cards per row"}),w.jsx("p",{className:"text-xs text-slate-400",children:e})]}),w.jsx("button",{type:"button",onClick:s,className:`rounded-full border px-3 py-1.5 text-xs font-semibold transition ${t?"border-amber-300 bg-amber-50 text-amber-700":"border-slate-200 bg-white text-slate-500 hover:bg-slate-50"}`,children:t?"Switch to Auto":"Manual override"}),w.jsx("div",{className:"inline-flex overflow-hidden rounded-xl border border-slate-200 bg-white shadow-inner",children:Qp.map(o=>{const u=n===o;return w.jsx("button",{type:"button",onClick:()=>t&&i(o),disabled:!t,className:`px-4 py-1.5 text-sm font-semibold transition-colors ${u?"bg-slate-100 text-slate-900":"text-slate-500 hover:bg-slate-50"} ${t?"":"cursor-not-allowed opacity-60"}`,"aria-pressed":u,title:t?void 0:"Auto layout is active. Enable manual override to pick.",children:o},o)})})]})}),w_=t=>`${(t*100).toFixed(1)}%`,Qq=()=>{const t=De(o=>o.datasetProfile),[e,n]=re.useState(!1);if(!t)return null;const s=t.rowCount>0?Math.min(1,t.sampledRows/t.rowCount):1,i=s===1;return w.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg shadow-sm",children:[w.jsxs("button",{type:"button",onClick:()=>n(o=>!o),className:"w-full flex items-center justify-between px-4 py-3 text-left",children:[w.jsxs("div",{children:[w.jsxs("div",{className:"text-sm font-semibold text-slate-800 flex items-center gap-2",children:[w.jsx("span",{className:"text-base",children:""}),w.jsx("span",{children:"Data Profile"})]}),w.jsx("p",{className:"text-xs text-slate-500 mt-0.5",children:i?"Full dataset profiled.":`Sampled ${t.sampledRows.toLocaleString()} of ${t.rowCount.toLocaleString()} rows (${w_(s)}).`})]}),w.jsx("span",{className:"text-sm text-slate-500",children:e?"Hide":"Show"})]}),e&&w.jsxs("div",{className:"px-4 pb-4 space-y-4",children:[w.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-xs",children:[w.jsxs("div",{className:"bg-slate-50 rounded-md p-3 border border-slate-100",children:[w.jsx("p",{className:"text-slate-500",children:"Total rows"}),w.jsx("p",{className:"text-lg font-semibold text-slate-900",children:t.rowCount.toLocaleString()})]}),w.jsxs("div",{className:"bg-slate-50 rounded-md p-3 border border-slate-100",children:[w.jsx("p",{className:"text-slate-500",children:"Sampled rows"}),w.jsx("p",{className:"text-lg font-semibold text-slate-900",children:t.sampledRows.toLocaleString()})]}),w.jsxs("div",{className:"bg-slate-50 rounded-md p-3 border border-slate-100",children:[w.jsx("p",{className:"text-slate-500",children:"Columns"}),w.jsx("p",{className:"text-lg font-semibold text-slate-900",children:t.columns.length})]}),w.jsxs("div",{className:"bg-slate-50 rounded-md p-3 border border-slate-100",children:[w.jsx("p",{className:"text-slate-500",children:"Profile Scope"}),w.jsx("p",{className:"text-lg font-semibold text-slate-900",children:i?"Full":"Sample"})]})]}),w.jsx("div",{className:"overflow-x-auto border border-slate-100 rounded-md",children:w.jsxs("table",{className:"min-w-full text-xs",children:[w.jsx("thead",{className:"bg-slate-100 text-slate-600",children:w.jsxs("tr",{children:[w.jsx("th",{className:"p-2 text-left font-semibold",children:"Column"}),w.jsx("th",{className:"p-2 text-left font-semibold",children:"Type"}),w.jsx("th",{className:"p-2 text-left font-semibold",children:"Distinct"}),w.jsx("th",{className:"p-2 text-left font-semibold",children:"Missing"}),w.jsx("th",{className:"p-2 text-left font-semibold",children:"Examples"})]})}),w.jsx("tbody",{children:t.columns.map(o=>{var u;return w.jsxs("tr",{className:"border-t border-slate-100",children:[w.jsx("td",{className:"p-2 font-medium text-slate-800",children:o.name}),w.jsx("td",{className:"p-2 text-slate-600 capitalize",children:o.type}),w.jsx("td",{className:"p-2 text-slate-600",children:((u=o.distinct)==null?void 0:u.toLocaleString())??""}),w.jsx("td",{className:"p-2 text-slate-600",children:typeof o.emptyPercentage=="number"?w_(o.emptyPercentage/100):""}),w.jsx("td",{className:"p-2 text-slate-600",children:o.examples&&o.examples.length>0?o.examples.slice(0,3).join(", "):""})]},o.name)})})]})}),t.warnings.length>0&&w.jsxs("div",{className:"text-xs text-amber-700 bg-amber-50 border border-amber-200 rounded-md p-3",children:[w.jsx("p",{className:"font-semibold mb-1",children:"Warnings"}),w.jsx("ul",{className:"list-disc list-inside space-y-1",children:t.warnings.map((o,u)=>w.jsx("li",{children:o},`warning-${u}`))})]})]})]})},Wq=Qp[Qp.length-1],Zq=[{minWidth:1280,columns:3},{minWidth:720,columns:2},{minWidth:0,columns:1}],eB=t=>{if(!t)return 1;for(const e of Zq)if(t>=e.minWidth)return Math.min(Wq,e.columns);return 1},tB=()=>{const t=De(_=>_.analysisCards),e=De(_=>_.finalSummary),n=re.useRef(null),s=re.useRef(null),[i,o]=re.useState(1),[u,d]=re.useState(2),[m,f]=re.useState(!1),y=m?u:i;re.useLayoutEffect(()=>{if(m)return;const _=n.current;if(!_)return;const T=N=>{s.current!==null&&cancelAnimationFrame(s.current),s.current=requestAnimationFrame(()=>{s.current=null,o(E=>{const L=eB(N);return E===L?E:L})})};if(T(_.getBoundingClientRect().width),typeof ResizeObserver<"u"){const N=new ResizeObserver(E=>{var L;for(const B of E)if(B.target===_){const O=((L=B.contentRect)==null?void 0:L.width)??_.getBoundingClientRect().width;T(O)}});return N.observe(_),()=>{N.disconnect(),s.current!==null&&cancelAnimationFrame(s.current)}}const C=()=>{T(_.getBoundingClientRect().width)};return window.addEventListener("resize",C),()=>{window.removeEventListener("resize",C),s.current!==null&&cancelAnimationFrame(s.current)}},[m,t.length]);const S=()=>{f(_=>(_||d(y),!_))};return t.length===0?w.jsx("div",{className:"flex items-center justify-center h-full",children:w.jsxs("div",{className:"text-center p-4",children:[w.jsx("p",{className:"text-slate-500",children:"Your analysis results will appear here."}),w.jsx("p",{className:"text-slate-400 text-sm mt-2",children:"The AI is generating the initial analysis..."})]})}):w.jsxs("div",{className:"p-1",ref:n,children:[w.jsxs("div",{className:"mb-6 space-y-4",children:[w.jsx(Qq,{}),e&&w.jsx("div",{children:w.jsx(Kq,{summary:e})}),w.jsx(Xq,{isManual:m,statusLabel:m?"Manual control enabled":"Auto based on panel width",selectedCount:y,onToggleMode:S,onSelectManualCount:_=>d(_)})]}),w.jsx("div",{className:"mt-6",children:w.jsx(E_,{breakpointCols:y,className:"flex w-auto -ml-6",columnClassName:"pl-6 space-y-6",children:t.map(_=>w.jsx("div",{className:"analysis-card",children:w.jsx(Yq,{cardId:_.id})},_.id))})})]})};function uc(t,e){if(Object.is(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;if(t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(const[s,i]of t)if(!Object.is(i,e.get(s)))return!1;return!0}if(t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(const s of t)if(!e.has(s))return!1;return!0}const n=Object.keys(t);if(n.length!==Object.keys(e).length)return!1;for(const s of n)if(!Object.prototype.hasOwnProperty.call(e,s)||!Object.is(t[s],e[s]))return!1;return!0}const nB=240,sB=(t,e,n)=>{const{maxHeight:s=nB,minHeight:i=0}=n??{};re.useLayoutEffect(()=>{const o=t.current;if(!o)return;o.style.height="auto";const u=o.scrollHeight,d=Math.min(Math.max(u,i),s);o.style.height=`${d}px`,o.style.overflowY=u>s?"auto":"hidden"},[t,e,s,i])},aB=({promptId:t,message:e,onSubmit:n,disabled:s=!1,isActive:i})=>{const o=re.useMemo(()=>sT(e),[e]),[u,d]=re.useState(""),[m,f]=re.useState(!1),y=s||m,S=T=>{const C=T.trim();C&&(f(!0),n(C))},_=T=>{T.preventDefault(),!(!u.trim()||y)&&(S(u),d(""))};return w.jsxs("div",{className:`rounded-md border px-3 py-2 ${i?"border-blue-300 bg-blue-50":"border-slate-200 bg-slate-50"} transition-colors`,children:[w.jsxs("div",{className:"flex items-center justify-between text-[11px] uppercase tracking-wide text-slate-500 mb-2",children:[w.jsxs("span",{children:["Prompt ",t]}),m&&w.jsx("span",{className:"text-emerald-600 font-semibold",children:"Sent"})]}),o.length>0&&w.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:o.map(T=>w.jsx("button",{type:"button",onClick:()=>S(T),disabled:y,className:`text-xs px-3 py-1 rounded-full border ${y?"text-slate-400 border-slate-200 bg-white cursor-not-allowed":"text-blue-700 border-blue-200 bg-white hover:bg-blue-100"} transition-colors`,children:T},`${t}-${T}`))}),w.jsxs("form",{onSubmit:_,className:"flex items-center gap-2",children:[w.jsx("input",{type:"text",value:u,onChange:T=>d(T.target.value),placeholder:"Type a custom answer",disabled:y,className:"flex-grow rounded-md border border-slate-200 px-2 py-1 text-sm text-slate-700 placeholder-slate-400 focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:bg-slate-100"}),w.jsx("button",{type:"submit",disabled:y||!u.trim(),className:"text-xs font-semibold px-3 py-1 rounded-md bg-blue-600 text-white disabled:bg-slate-300 disabled:text-slate-500 transition-colors",children:"Send"})]})]})},rB=({prompt:t,onSelect:e,onSubmitFreeText:n,disabled:s,waitingHint:i,latestObservation:o})=>{const[u,d]=re.useState(""),m=f=>{f.preventDefault(),!(!u.trim()||s)&&(n(u.trim()),d(""))};return w.jsxs("div",{className:"bg-white border border-amber-200 rounded-xl p-4 shadow-sm space-y-3",children:[w.jsxs("div",{className:"flex items-center gap-2 text-amber-800",children:[w.jsx("span",{className:"text-xl",children:""}),w.jsxs("div",{children:[w.jsx("p",{className:"text-sm font-semibold",children:""}),w.jsx("p",{className:"text-base font-bold",children:t.question})]})]}),o&&w.jsxs("div",{className:"border border-amber-100 bg-amber-50 rounded-lg p-3 text-xs text-amber-800 space-y-1",children:[w.jsxs("p",{className:"font-semibold flex items-center gap-1",children:[w.jsx("span",{children:""}),w.jsxs("span",{children:["",o.title]})]}),o.detail&&w.jsx("p",{className:"text-amber-700",children:o.detail}),o.meta&&w.jsx("p",{className:"text-[11px] text-amber-600",children:o.meta})]}),w.jsx("div",{className:"flex flex-wrap gap-2",children:t.options.map(f=>w.jsx("button",{type:"button",onClick:()=>e(f.id),disabled:s,className:"px-3 py-2 rounded-lg border border-amber-300 bg-amber-50 text-amber-800 text-sm font-semibold hover:bg-amber-100 disabled:opacity-50 disabled:cursor-not-allowed",children:f.label},f.id))}),t.allowFreeText&&w.jsxs("form",{onSubmit:m,className:"flex gap-2 items-center",children:[w.jsx("input",{value:u,onChange:f=>d(f.target.value),placeholder:t.placeholder??"",disabled:s,className:"flex-1 border border-amber-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-300 disabled:opacity-50"}),w.jsx("button",{type:"submit",disabled:!u.trim()||s,className:"px-3 py-2 rounded-lg bg-amber-500 text-white text-sm font-semibold hover:bg-amber-600 disabled:opacity-50 disabled:cursor-not-allowed",children:""})]}),i&&w.jsx("p",{className:"text-xs text-amber-600",children:i})]})},iB=()=>w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),oB=()=>w.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),lB=()=>w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:w.jsx("path",{d:"M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"})}),uB=()=>w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:w.jsx("path",{d:"M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"})}),cB=()=>w.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[w.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),w.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),__=(t,e=60)=>t.length>e?`${t.slice(0,e)}`:t,dB=/card-\d+-[0-9.]+/g,fB=t=>{if(!t)return[];const e=t.match(dB);return e?Array.from(new Set(e)):[]},x_=240,pB=Xb(),mB=1e4,hB=()=>De(t=>({progressMessages:t.progressMessages,chatHistory:t.chatHistory,isBusy:t.isBusy,handleChatMessage:t.handleChatMessage,isApiKeySet:t.isApiKeySet,setIsAsideVisible:t.setIsAsideVisible,setIsSettingsModalOpen:t.setIsSettingsModalOpen,setIsMemoryPanelOpen:t.setIsMemoryPanelOpen,handleShowCardFromChat:t.handleShowCardFromChat,currentView:t.currentView,pendingClarifications:t.pendingClarifications,activeClarificationId:t.activeClarificationId,handleClarificationResponse:t.handleClarificationResponse,skipClarification:t.skipClarification,columnProfiles:t.columnProfiles,csvData:t.csvData,focusDataPreview:t.focusDataPreview,isCancellationRequested:t.isCancellationRequested,chatMemoryPreview:t.chatMemoryPreview,chatMemoryExclusions:t.chatMemoryExclusions,previewChatMemories:t.previewChatMemories,toggleMemoryPreviewSelection:t.toggleMemoryPreviewSelection,isMemoryPreviewLoading:t.isMemoryPreviewLoading,agentAwaitingUserInput:t.agentAwaitingUserInput,agentAwaitingPromptId:t.agentAwaitingPromptId,executeQuickAction:t.executeQuickAction,graphAwaitPrompt:t.graphAwaitPrompt,graphAwaitPromptId:t.graphAwaitPromptId,graphAwaitHistory:t.graphAwaitHistory,graphToolInFlight:t.graphToolInFlight,sendGraphUserReply:t.sendGraphUserReply,runGraphPipeline:t.runGraphPipeline,addProgress:t.addProgress,graphObservations:t.graphObservations}),uc),gB=()=>{var Ut;const t=hB(),{progressMessages:e,chatHistory:n,isBusy:s,handleChatMessage:i,isApiKeySet:o,setIsAsideVisible:u,setIsSettingsModalOpen:d,setIsMemoryPanelOpen:m,handleShowCardFromChat:f,currentView:y,pendingClarifications:S,activeClarificationId:_,handleClarificationResponse:T,skipClarification:C,columnProfiles:N,csvData:E,focusDataPreview:L,isCancellationRequested:B,chatMemoryPreview:O,chatMemoryExclusions:x,previewChatMemories:I,toggleMemoryPreviewSelection:D,isMemoryPreviewLoading:R,agentAwaitingUserInput:P,agentAwaitingPromptId:A,executeQuickAction:k,graphAwaitPrompt:F,graphAwaitPromptId:U,graphAwaitHistory:z,graphToolInFlight:oe,sendGraphUserReply:se,runGraphPipeline:q,addProgress:j,graphObservations:ae}=t,[ge,Ce]=re.useState(""),[H,ee]=re.useState(null),[W,le]=re.useState({}),[ie,ue]=re.useState(null),me=re.useRef(U),Ee=re.useRef(null),Ae=re.useRef(null);sB(Ae,ge,{maxHeight:x_});const ve=re.useCallback(ce=>{if(!ce)return"";const we=new Date(ce);return Number.isNaN(we.getTime())?"":we.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},[]),Et=s||!!oe;re.useMemo(()=>U?z.find(ce=>ce.promptId===U)??null:null,[z,U]);const Re=re.useMemo(()=>z.length?[...z].slice(-3).reverse():[],[z]);re.useMemo(()=>{for(let ce=z.length-1;ce>=0;ce-=1)if(z[ce].status==="answered")return z[ce];return null},[z]);const On=oe?` ${oe.label} `:ie,et=re.useMemo(()=>!ae||ae.length===0?null:zT(ae[ae.length-1]),[ae]),Zt=et?{title:et.title,detail:et.detail??void 0,meta:et.metaLine??void 0}:void 0,Ft=S.some(ce=>ce.status==="pending"),Se=re.useMemo(()=>[...n].sort((ce,we)=>ce.timestamp.getTime()-we.timestamp.getTime()),[n]),je=(E==null?void 0:E.data)??[],en=re.useMemo(()=>{if(!N||N.length===0)return[];const ce=Jm(N,je);return ce.length>0?ce:N.filter(we=>["categorical","date","time"].includes(we.type)).map(we=>({profile:we,uniqueValues:typeof we.uniqueValues=="number"?we.uniqueValues:0}))},[N,je]);re.useEffect(()=>{if(!U){ue(null),me.current&&(j(" "),q({reason:"auto_resume"})),me.current=null;return}U!==me.current&&(j(" Graph "),me.current=U),ue(null);const ce=window.setTimeout(()=>{ue("")},mB);return()=>{window.clearTimeout(ce)}},[U,j,q]);const tn=re.useCallback(ce=>{const we=ce.trim();we&&i(we)},[i]),mt=re.useCallback(ce=>{var Kn;const we=((Kn=F==null?void 0:F.options.find(za=>za.id===ce))==null?void 0:Kn.label)??ce,Gt=F!=null&&F.question?`${F.question}`:"";j(` ${we}${Gt}`),se(ce,void 0)},[se,j,F]),$t=re.useCallback(ce=>{const we=ce.trim();if(!we)return;const Gt=F!=null&&F.question?`${F.question}`:"";j(` ${we}${Gt}`),se(void 0,we)},[se,j,F]),ca=re.useCallback((ce,we)=>{const Gt=we.trim();if(!Gt||s||!o)return;const Kn=ce?`[prompt:${ce}] ${Gt}`:Gt;i(Kn)},[i,s,o]),Fe=O.filter(ce=>!x.includes(ce.id)).length,da=O.length>0;_??((Ut=S.find(ce=>ce.status==="pending"))==null||Ut.id);const Ga=()=>{var ce;(ce=Ee.current)==null||ce.scrollIntoView({behavior:"smooth"})},Oo=(ce,we)=>{le(Gt=>({...Gt,[ce]:we}))},Va=ce=>{const we=W[ce];we&&T(ce,{label:`Manual grouping: ${we}`,value:we})},cc=async ce=>{if(!H){ee(ce);try{await k(ce)}finally{ee(null)}}};re.useEffect(Ga,[Se]),re.useEffect(()=>{const ce=ge.trim();if(!ce){I("");return}const we=window.setTimeout(()=>{I(ce)},400);return()=>window.clearTimeout(we)},[ge,I]);const ai=ce=>{ce.preventDefault(),ge.trim()&&!s&&(tn(ge),Ce(""))},dc=ce=>{ce.key==="Enter"&&!ce.shiftKey&&ai(ce)},fc=()=>{if(!o)return"Set API Key in settings to chat";if(Ft)return"Please resolve or skip the clarification above";if(P)return"Answer the AI question above to resume";switch(y){case"analysis_dashboard":return"New analysis or transformation?";case"file_upload":default:return"Upload a file to begin chatting"}},fa=(ce,we)=>{var Gt,Kn,za;if("sender"in ce){const he=ce;if(he.type==="ai_clarification"&&he.clarificationRequest){const Be=S.find(bt=>bt.id===he.clarificationRequest.id),Nt=(Be==null?void 0:Be.status)??"resolved",Qn=Nt==="pending",Ns=Nt==="resolving",ri=(Qn||Ns)&&(Be==null?void 0:Be.id)===_,qo=Be?Nt==="pending":!1,ii=he.clarificationRequest.targetProperty==="groupByColumn",Is=W[he.clarificationRequest.id]??"",pc=ii&&en.length>0,Bo={pending:ri?"bg-blue-100 text-blue-800 border-blue-200":"bg-slate-100 text-slate-600 border-slate-200",resolving:"bg-amber-100 text-amber-800 border-amber-200",resolved:"bg-emerald-100 text-emerald-800 border-emerald-200",skipped:"bg-slate-200 text-slate-500 border-slate-300"},Fo=`clarification-${(Be==null?void 0:Be.id)??he.clarificationRequest.id}`,$o=Nt==="pending"?ri?"Active":"Queued":Nt==="resolving"?"Working":Nt==="skipped"?"Skipped":"Answered";return w.jsxs("div",{id:Fo,className:`my-2 p-3 bg-white border rounded-lg transition-colors ${ri?"border-blue-400 shadow shadow-blue-100":"border-blue-200"} ${Nt==="resolved"?"opacity-90":""} ${Nt==="skipped"?"opacity-60":""}`,children:[w.jsxs("div",{className:"flex items-center justify-between mb-2",children:[w.jsxs("div",{className:"flex items-center text-blue-700",children:[w.jsx("span",{className:"text-lg mr-2",children:""}),w.jsx("h4",{className:"font-semibold",children:"Clarification Needed"})]}),w.jsx("span",{className:`text-xs px-2 py-1 border rounded-full ${Bo[Nt]??"bg-slate-100 text-slate-600 border-slate-200"}`,children:$o})]}),w.jsx("p",{className:"text-sm text-slate-700 mb-1",children:he.clarificationRequest.question}),he.clarificationRequest.columnHints&&he.clarificationRequest.columnHints.length>0&&w.jsxs("p",{className:"text-xs text-slate-500 mb-2",children:["Column context: ",he.clarificationRequest.columnHints.join(", ")]}),w.jsx("div",{className:"flex flex-col space-y-2",children:he.clarificationRequest.options.map(bt=>w.jsxs("button",{onClick:()=>T(he.clarificationRequest.id,bt),disabled:!Qn||s,className:"w-full text-left text-sm px-3 py-2 bg-slate-100 rounded-md hover:bg-blue-100 hover:border-blue-500 border border-slate-200 transition-colors disabled:opacity-60 disabled:cursor-not-allowed disabled:hover:bg-slate-100",children:[w.jsx("span",{className:"font-medium text-slate-800",children:bt.label}),w.jsxs("span",{className:"block text-xs text-slate-500",children:["Column: ",bt.value]})]},`${he.clarificationRequest.id}-${bt.value}`))}),pc&&w.jsxs("div",{className:"mt-3 border-t border-slate-200 pt-3",children:[w.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"  / Pick a grouping column manually"}),w.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[w.jsxs("select",{className:"flex-1 border border-slate-200 rounded-md px-3 py-2 text-sm text-slate-700 bg-white",value:Is,onChange:bt=>Oo(he.clarificationRequest.id,bt.target.value),disabled:!Qn||Ns,children:[w.jsx("option",{value:"",children:" / Choose a grouping column"}),en.map(bt=>w.jsxs("option",{value:bt.profile.name,children:[bt.profile.name,bt.uniqueValues?` (${bt.uniqueValues} distinct)`:" (distinct unknown)"]},`${he.clarificationRequest.id}-${bt.profile.name}`))]}),w.jsx("button",{onClick:()=>Va(he.clarificationRequest.id),disabled:!Qn||s||!Is,className:"text-sm px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:" / Use column"})]})]}),w.jsx("div",{className:"flex justify-end mt-3",children:w.jsx("button",{onClick:()=>C(he.clarificationRequest.id),disabled:!qo,className:"text-xs text-slate-500 hover:text-red-600 border border-slate-200 px-3 py-1 rounded-md transition-colors disabled:opacity-40 disabled:cursor-not-allowed",children:"Skip / Cancel"})})]},`chat-${we}`)}if(he.type==="ai_plan_start")return w.jsxs("div",{className:"my-2 p-3 bg-slate-100 border border-slate-200 rounded-lg",children:[w.jsxs("div",{className:"flex items-center text-slate-700 mb-2",children:[w.jsx("span",{className:"text-lg mr-2",children:""}),w.jsx("h4",{className:"font-semibold",children:"Plan Execution"})]}),w.jsx("p",{className:"text-sm text-slate-700 whitespace-pre-wrap",children:he.text})]},`chat-${we}`);if(he.type==="ai_thinking")return w.jsxs("div",{className:"my-2 p-3 bg-white border border-blue-200 rounded-lg",children:[w.jsxs("div",{className:"flex items-center text-blue-700 mb-2",children:[w.jsx("span",{className:"text-lg mr-2",children:""}),w.jsx("h4",{className:"font-semibold",children:"AI's Initial Analysis"})]}),w.jsx("p",{className:"text-sm text-slate-700 whitespace-pre-wrap",children:he.text})]},`chat-${we}`);if(he.type==="ai_proactive_insight")return w.jsxs("div",{className:"my-2 p-3 bg-yellow-50 border border-yellow-300 rounded-lg",children:[w.jsxs("div",{className:"flex items-center text-yellow-800 mb-2",children:[w.jsx("span",{className:"text-lg mr-2",children:""}),w.jsx("h4",{className:"font-semibold",children:"Proactive Insight"})]}),w.jsx("p",{className:"text-sm text-slate-700 whitespace-pre-wrap",children:he.text}),he.cardId&&w.jsx("button",{onClick:()=>f(he.cardId),className:"mt-2 text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-md hover:bg-yellow-200 transition-colors w-full text-left font-medium",children:" Show Related Card"})]},`chat-${we}`);if(he.sender==="user")return w.jsx("div",{className:"flex justify-end",children:w.jsx("div",{className:"bg-blue-600 rounded-lg px-3 py-2 max-w-xs lg:max-w-md",children:w.jsx("p",{className:"text-sm text-white",style:{whiteSpace:"break-spaces"},children:he.text})})},`chat-${we}`);const Xn=[];return he.isError||(he.cardId&&Xn.push(he.cardId),fB(he.text).forEach(Be=>{Xn.includes(Be)||Xn.push(Be)})),w.jsx("div",{className:"flex",children:w.jsxs("div",{className:`rounded-lg px-3 py-2 max-w-xs lg:max-w-md ${he.isError?"bg-red-100":"bg-slate-200"}`,children:[w.jsx("p",{className:`text-sm ${he.isError?"text-red-800":"text-slate-800"}`,style:{whiteSpace:"break-spaces"},children:he.text}),!he.isError&&Xn.map(Be=>w.jsxs("button",{onClick:()=>f(Be),className:"mt-2 text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-md hover:bg-blue-200 transition-colors w-full text-left font-medium",children:[" Show Related Card (",Be,")"]},`${Be}-${we}`)),((Gt=he.cta)==null?void 0:Gt.type)==="open_data_preview"&&w.jsxs("button",{onClick:L,className:"mt-2 text-xs bg-white text-blue-700 border border-blue-200 px-2 py-1 rounded-md hover:bg-blue-50 transition-colors w-full text-left font-medium",children:[" ",he.cta.label,he.cta.helperText&&w.jsx("span",{className:"block text-[11px] text-slate-500 mt-0.5",children:he.cta.helperText})]}),he.quickActions&&w.jsxs("div",{className:"mt-3 border border-slate-300 rounded-lg bg-white p-3 space-y-2",children:[w.jsxs("div",{children:[w.jsx("p",{className:"text-xs font-semibold text-slate-700",children:he.quickActions.title??"Quick start actions"}),he.quickActions.helperText&&w.jsx("p",{className:"text-[11px] text-slate-500 mt-0.5",children:he.quickActions.helperText})]}),w.jsx("div",{className:"space-y-2",children:he.quickActions.actions.map(Be=>w.jsxs("button",{onClick:()=>cc(Be.id),disabled:!!H,className:"w-full text-left rounded-md border border-slate-200 bg-blue-50 px-3 py-2 text-sm text-blue-900 hover:bg-blue-100 disabled:opacity-50 disabled:cursor-not-allowed",children:[w.jsx("span",{className:"font-semibold block",children:Be.label}),Be.helperText&&w.jsx("span",{className:"text-xs text-blue-700 block",children:Be.helperText})]},`${Be.id}-${we}`))})]}),he.usedMemories&&he.usedMemories.length>0&&w.jsxs("div",{className:"mt-2 border border-blue-100 bg-white rounded-md p-2",children:[w.jsxs("p",{className:"text-[11px] font-semibold text-blue-700 mb-1",children:["Used memory (",he.usedMemories.length,")"]}),w.jsx("div",{className:"flex flex-wrap gap-1",children:he.usedMemories.map(Be=>w.jsx("span",{className:"text-[11px] text-slate-600 bg-blue-50 border border-blue-100 rounded-full px-2 py-0.5",children:__(Be.text,48)},Be.id))})]}),((Kn=he.meta)==null?void 0:Kn.awaitUser)&&((za=he.meta)==null?void 0:za.promptId)&&w.jsx("div",{className:"mt-3",children:w.jsx(aB,{promptId:he.meta.promptId,message:he.text,onSubmit:Be=>ca(he.meta.promptId,Be),disabled:!o||s&&!P,isActive:!A||A===he.meta.promptId})})]})},`chat-${we}`)}};return w.jsxs("div",{className:"flex flex-col h-full bg-slate-100 rounded-lg md:rounded-none",children:[w.jsxs("div",{className:"p-4 border-b border-slate-200 flex justify-between items-center relative",children:[w.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Assistant"}),w.jsxs("div",{className:"flex items-center space-x-3",children:[w.jsx("button",{onClick:()=>m(!0),className:"p-1 text-slate-500 rounded-full hover:bg-slate-200 hover:text-slate-800 transition-colors",title:"View AI Memory","aria-label":"View AI Memory",children:w.jsx(lB,{})}),pB.showSettingsButton&&w.jsx("button",{onClick:()=>d(!0),className:"p-1 text-slate-500 rounded-full hover:bg-slate-200 hover:text-slate-800 transition-colors",title:"Settings","aria-label":"Open Settings",children:w.jsx(oB,{})}),w.jsx("button",{onClick:()=>u(!1),className:"p-1 text-slate-500 rounded-full hover:bg-slate-200 hover:text-slate-800 transition-colors",title:"Hide Panel","aria-label":"Hide Assistant Panel",children:w.jsx(iB,{})})]})]}),w.jsxs("div",{className:"flex-1 p-4 overflow-y-auto space-y-4",children:[w.jsx(VT,{}),w.jsx(jT,{}),Se.map(fa),w.jsx("div",{ref:Ee})]}),w.jsxs("div",{className:"p-4 border-t border-slate-200 bg-white",children:[da&&w.jsxs("div",{className:"mb-3",children:[w.jsxs("div",{className:"flex items-center gap-2 text-[11px] font-semibold text-slate-600 uppercase tracking-wide",children:["Used memory (",Fe,"/",O.length,")",R&&w.jsx("span",{className:"text-slate-400 font-normal normal-case",children:"Updating"})]}),w.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:O.map(ce=>{const we=x.includes(ce.id);return w.jsx("button",{type:"button",onClick:()=>D(ce.id),className:`text-[11px] px-2 py-1 rounded-full border transition-colors ${we?"bg-white border-slate-300 text-slate-400 line-through":"bg-blue-50 border-blue-200 text-blue-700"}`,title:we?"Click to include this memory":"Click to exclude this memory",children:__(ce.text,42)},ce.id)})})]}),F&&w.jsxs("div",{className:"mb-4","aria-live":"polite",children:[w.jsx(rB,{prompt:F,onSelect:mt,onSubmitFreeText:$t,disabled:Et,waitingHint:On,latestObservation:Zt}),oe&&w.jsxs("div",{className:"mt-2 rounded-md border border-indigo-200 bg-indigo-50 px-3 py-2 text-xs text-indigo-800",role:"status",children:[w.jsxs("p",{children:[" ",oe.label," "]}),w.jsx("p",{className:"text-[11px] mt-1",children:oe.startedAt?` ${ve(oe.startedAt)}`:""})]}),Re.length>0&&w.jsxs("div",{className:"mt-3 rounded-lg border border-slate-200 bg-slate-50 p-3",children:[w.jsx("p",{className:"text-xs font-semibold text-slate-700",children:""}),w.jsx("ul",{className:"mt-2 space-y-1 text-[12px] text-slate-600",children:Re.map(ce=>w.jsxs("li",{className:"flex flex-col",children:[w.jsx("span",{className:"text-slate-800 font-medium",children:ce.question}),w.jsx("span",{children:ce.status==="answered"?`${ce.responseLabel??ce.responseValue??""}  ${ve(ce.respondedAt)}`:""})]},`${ce.promptId??ce.askedAt}`))})]})]}),w.jsxs("form",{onSubmit:ai,className:"flex items-start space-x-2",children:[w.jsxs("div",{className:"relative flex-grow",children:[w.jsx("textarea",{ref:Ae,rows:1,value:ge,onChange:ce=>Ce(ce.target.value),onKeyDown:dc,placeholder:fc(),disabled:!o||y==="file_upload"||Ft||P,"aria-describedby":"chat-input-char-count",className:"w-full bg-white border border-slate-300 rounded-md py-2 pl-3 pr-14 text-sm leading-5 text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 resize-none",style:{minHeight:"40px",maxHeight:`${x_}px`,overflowY:"hidden"}}),w.jsxs("span",{id:"chat-input-char-count",className:"pointer-events-none absolute bottom-2 right-3 text-[11px] text-slate-400",children:[ge.length," chars"]})]}),w.jsxs("button",{type:"submit",disabled:s||!ge.trim()||!o||y==="file_upload"||Ft||P,className:"flex-shrink-0 px-4 h-10 flex items-center justify-center gap-2 bg-blue-600 text-white font-semibold rounded-md hover:bg-blue-700 transition-colors disabled:bg-blue-300 disabled:cursor-not-allowed","aria-label":s?B?"Cancelling request":"Sending message":"Send message",children:[s?w.jsx(cB,{}):w.jsx(uB,{}),w.jsx("span",{className:"text-sm",children:s?B?"Cancelling":"Sending":"Send"})]})]}),w.jsx("div",{className:"mt-3",children:w.jsx(GT,{className:"mt-0"})})]})]})},yB=t=>{const e=[];let n=0,s=null;return t.forEach(i=>{if(i.text.startsWith("Continuing plan")){n+=1,s=i.timestamp;return}n>0&&(e.push({text:n===1?"Continuing plan":`Continuing plan retried ${n}`,type:"system",timestamp:s??i.timestamp}),n=0,s=null),e.push(i)}),n>0&&e.push({text:n===1?"Continuing plan":`Continuing plan retried ${n}`,type:"system",timestamp:s??new Date}),e.slice(-30)},vB={observing:"bg-slate-400",executing:"bg-blue-500",succeeded:"bg-emerald-500",failed:"bg-red-500"},SB={chat:"Chat",pipeline:"Analysis Pipeline",system:"System"},wB=t=>(t instanceof Date?t:new Date(t)).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),GT=ws.memo(({className:t})=>{const{progressMessages:e,agentActionTraces:n}=De(f=>({progressMessages:f.progressMessages,agentActionTraces:f.agentActionTraces}),uc),[s,i]=re.useState(!0),o=re.useMemo(()=>yB(e),[e]),u=re.useMemo(()=>n.slice(-20),[n]),d=re.useMemo(()=>{const f=o.map((S,_)=>({kind:"progress",id:`sys-${S.timestamp.getTime()}-${_}`,timestamp:S.timestamp,entry:S})),y=u.map(S=>({kind:"action",id:S.id,timestamp:S.timestamp instanceof Date?S.timestamp:new Date(S.timestamp),trace:S}));return[...f,...y].sort((S,_)=>_.timestamp.getTime()-S.timestamp.getTime()).slice(0,40)},[o,u]);if(d.length===0)return null;const m=`${t??"mb-4"} rounded-lg border border-slate-200 bg-white shadow-sm`.trim();return w.jsxs("div",{className:m,children:[w.jsxs("button",{type:"button",onClick:()=>i(f=>!f),className:"w-full flex items-center justify-between px-3 py-2 text-xs font-medium text-slate-600",children:[w.jsx("span",{className:"uppercase tracking-wide",children:"System log"}),w.jsxs("span",{className:"text-[11px] text-slate-400",children:[d.length," events  ",s?"Show":"Hide"]})]}),!s&&w.jsx("div",{className:"max-h-64 overflow-y-auto divide-y divide-slate-100 px-1",children:d.map(f=>{if(f.kind==="progress"){const{entry:T}=f;return w.jsxs("div",{className:`px-2 py-2 text-xs flex gap-2 ${T.type==="error"?"text-red-600":"text-slate-600"}`,children:[w.jsx("span",{className:"text-slate-400",children:T.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),w.jsx("span",{className:"leading-snug",children:T.text})]},f.id)}const y=f.trace,S=y.status??"observing",_=y.source??"chat";return w.jsxs("div",{className:"px-2 py-3 text-sm",children:[w.jsxs("div",{className:"flex items-center text-xs text-slate-500 gap-2",children:[w.jsx("span",{className:`w-2 h-2 rounded-full ${vB[S]}`}),w.jsx("span",{className:"font-medium",children:wB(y.timestamp)}),w.jsx("span",{children:""}),w.jsx("span",{children:SB[_]??"AI"}),w.jsx("span",{children:""}),w.jsx("span",{className:"capitalize",children:S})]}),w.jsx("p",{className:"text-slate-800 mt-0.5 leading-snug whitespace-pre-line",children:y.summary}),y.details&&w.jsx("p",{className:"text-xs text-slate-500 mt-1 leading-snug whitespace-pre-line",children:y.details})]},f.id)})})]})});GT.displayName="SystemLogPanel";const VT=ws.memo(()=>{const{planState:t,pendingClarifications:e,handleClarificationResponse:n,skipClarification:s,agentAwaitingUserInput:i,isBusy:o}=De(P=>{var A;return{planState:((A=P.plannerSession)==null?void 0:A.planState)??null,pendingClarifications:P.pendingClarifications,handleClarificationResponse:P.handleClarificationResponse,skipClarification:P.skipClarification,agentAwaitingUserInput:P.agentAwaitingUserInput,isBusy:P.isBusy}},uc),[u,d]=re.useState(!0),[m,f]=re.useState({}),y=re.useMemo(()=>t?t.steps&&t.steps.length>0?t.steps:t.nextSteps??[]:[],[t]);if(!t)return null;const S=y.length,_=y.filter(P=>P.status==="done").length,T=t.currentStepId?y.findIndex(P=>P.id===t.currentStepId):-1,C=t.updatedAt?new Date(t.updatedAt):new Date,N=S>0?`${_} / ${S} completed`:t.progress??"Tracking",E=S>0&&T>=0?`Step ${Math.min(T+1,S)} of ${S}`:S>0?`Tracking ${S} steps`:null,L=e.find(P=>P.status==="pending"||P.status==="resolving")??null,B=t.currentStepId&&y.length>0?y.find(P=>P.id===t.currentStepId):null,O=!!B&&(B.status==="waiting_user"||i)&&!!L,x={done:"bg-emerald-500",in_progress:"bg-blue-500",ready:"bg-slate-400",waiting_user:"bg-amber-500"},I={done:"Done",in_progress:"In progress",ready:"Queued",waiting_user:"Awaiting you"},D=(P,A)=>{f(k=>({...k,[P]:A}))},R=P=>{const A=(m[P]??"").trim();A&&(n(P,{label:A,value:A}),f(k=>({...k,[P]:""})))};return w.jsxs("div",{className:"mb-4 rounded-xl border border-slate-200 bg-gradient-to-b from-white to-slate-50 shadow-sm",children:[w.jsxs("button",{type:"button",className:"w-full px-4 py-3 flex flex-col text-left focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 rounded-t-xl",onClick:()=>d(P=>!P),children:[w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsxs("div",{children:[w.jsx("p",{className:"text-sm font-semibold text-slate-900",children:"Agent Working Status"}),w.jsx("p",{className:"text-xs text-slate-500",children:N})]}),w.jsxs("div",{className:"text-right",children:[E&&w.jsx("p",{className:"text-xs text-slate-500",children:E}),w.jsx("span",{className:"text-[11px] uppercase tracking-wide text-slate-400",children:u?"Show details":"Hide details"})]})]}),t.blockedBy&&w.jsxs("p",{className:"mt-1 text-xs text-amber-600",children:["Blocked: ",t.blockedBy]}),S>0&&w.jsx("div",{className:"mt-3 h-1.5 w-full bg-slate-200 rounded-full overflow-hidden",children:w.jsx("div",{className:"h-full bg-blue-500 transition-all",style:{width:`${Math.min(_/S*100,100)}%`}})}),w.jsxs("p",{className:"mt-1 text-[11px] text-slate-400",children:["Updated ",C.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),!u&&w.jsxs("div",{className:"px-4 pb-4 space-y-4 text-sm text-slate-700",children:[t.goal&&w.jsxs("p",{className:"text-sm",children:[w.jsx("span",{className:"font-medium text-slate-900",children:"Goal:"})," ",t.goal]}),t.contextSummary&&w.jsxs("p",{className:"text-xs text-slate-500",children:[w.jsx("span",{className:"font-semibold text-slate-600",children:"Context:"})," ",t.contextSummary]}),w.jsxs("ol",{className:"relative space-y-3",children:[y.map((P,A)=>{const k=P.status??"ready",F=P.id===t.currentStepId,U=O&&L&&F;return w.jsxs("li",{className:"relative pl-6",children:[w.jsx("span",{className:`absolute left-0 top-1.5 h-3 w-3 rounded-full ${x[k]??"bg-slate-300"}`,"aria-hidden":!0}),w.jsxs("div",{className:"flex items-start justify-between gap-3",children:[w.jsxs("div",{children:[w.jsx("p",{className:`font-medium ${F?"text-slate-900":"text-slate-700"}`,children:P.label}),P.intent&&w.jsx("p",{className:"text-xs text-slate-500",children:P.intent})]}),w.jsx("span",{className:"text-xs text-slate-500",children:I[k]??k})]}),U&&w.jsxs("div",{className:"mt-3 rounded-lg border border-blue-100 bg-blue-50 p-3",children:[w.jsxs("p",{className:"text-sm font-medium text-blue-900 flex items-center gap-2 mb-2",children:[w.jsx("span",{className:"text-base",children:""}),L.question]}),w.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:L.options.map(z=>w.jsx("button",{type:"button",onClick:()=>n(L.id,z),disabled:o,className:"text-xs px-3 py-1 rounded-full border border-blue-200 bg-white text-blue-700 hover:bg-blue-100 disabled:opacity-60 disabled:cursor-not-allowed",children:z.label},`${L.id}-${z.value}`))}),w.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[w.jsx("input",{type:"text",value:m[L.id]??"",onChange:z=>D(L.id,z.target.value),placeholder:"Type your answer",className:"flex-1 rounded-md border border-blue-100 bg-white px-3 py-2 text-sm text-slate-800 placeholder-slate-400 focus:border-blue-300 focus:ring-1 focus:ring-blue-300",disabled:o}),w.jsx("button",{type:"button",onClick:()=>R(L.id),disabled:o||!(m[L.id]??"").trim(),className:"px-4 py-2 rounded-md bg-blue-600 text-white text-xs font-semibold uppercase tracking-wide disabled:opacity-50 disabled:cursor-not-allowed",children:"Send"}),w.jsx("button",{type:"button",onClick:()=>s(L.id),disabled:o,className:"px-3 py-2 rounded-md border border-transparent text-xs text-slate-500 hover:text-red-600",children:"Skip"})]})]})]},P.id??A)}),y.length===0&&w.jsx("li",{className:"text-xs text-slate-500",children:"Waiting for the agent to draft a plan"})]})]})]})});VT.displayName="PlannerGoalTracker";const _B={langchain_plan:{icon:"",label:"LangChain Plan"},aggregate_plan:{icon:"",label:"Plan Preview"},profile_dataset:{icon:"",label:"Dataset Profile"},normalize_invoice_month:{icon:"",label:"Invoice Month Clean"},detect_outliers:{icon:"",label:"Outlier Detection"},tool_result:{icon:"",label:"Tool Result"}},xB=t=>{const e=new Date(t);return Number.isNaN(e.getTime())?"":e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},bB=t=>{if(!t)return null;const{promptTokens:e,completionTokens:n,totalTokens:s}=t;if(e==null&&n==null&&s==null)return null;const i=e!=null?`in ${e}`:null,o=n!=null?`out ${n}`:null,u=s!=null?`total ${s}`:e!=null||n!=null?`total ${(e??0)+(n??0)}`:null;return["Tok",i,o,u].filter(Boolean).join("  ")},zT=t=>{const e=t.payload??{},n=_B[t.kind]??{icon:"",label:t.kind.replace(/_/g," ")};let s=null;typeof e.summary=="string"?s=e.summary:typeof e.description=="string"?s=e.description:typeof e.text=="string"&&(s=e.text);const i=[],o=e.meta??{};typeof o.rows=="number"&&i.push(`${o.rows} `),typeof o.source=="string"&&i.push(o.source==="full"?"":""),typeof o.durationMs=="number"&&i.push(`${Math.round(o.durationMs)} ms`);const u=e.telemetry??o.telemetry;(u==null?void 0:u.latencyMs)!=null&&i.push(`Latency ${Math.round(u.latencyMs)} ms`);const d=bB(u==null?void 0:u.tokenUsage);d&&i.push(d),(u==null?void 0:u.estimatedCostUsd)!=null&&i.push(`$${u.estimatedCostUsd.toFixed(4)}`);const m=i.length>0?i.join("  "):null;return{id:t.id,timestamp:t.at,icon:n.icon,title:n.label,detail:s,metaLine:m}},jT=ws.memo(()=>{const{observations:t,isBusy:e}=De(s=>({observations:s.graphObservations,isBusy:s.isBusy}),uc),n=re.useMemo(()=>t.slice(-10).reverse(),[t]);return n.length===0?null:w.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg p-3 shadow-sm",children:[w.jsxs("div",{className:"flex items-center justify-between mb-3",children:[w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx("span",{className:"text-lg",children:""}),w.jsxs("div",{children:[w.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Realtime Observation Timeline"}),w.jsx("p",{className:"text-xs text-slate-500",children:"Newest events shown first"})]})]}),e&&w.jsx("span",{className:"text-xs uppercase tracking-wide text-blue-600 font-semibold",children:"Running"})]}),w.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto pr-1",children:n.map(s=>{const i=zT(s);return w.jsxs("div",{className:"relative border-l-2 border-slate-100 pl-3",children:[w.jsx("span",{className:"absolute -left-[5px] top-2 text-sm",children:i.icon}),w.jsx("div",{className:"flex items-center justify-between text-[11px] text-slate-500",children:w.jsx("span",{className:"font-medium",children:xB(i.timestamp)})}),w.jsx("p",{className:"text-sm font-semibold text-slate-800 mt-1",children:i.title}),i.detail&&w.jsx("p",{className:"text-xs text-slate-600 mt-1 whitespace-pre-line",children:i.detail}),i.metaLine&&w.jsx("p",{className:"text-[11px] text-slate-500 mt-1",children:i.metaLine})]},i.id)})})]})});jT.displayName="GraphObservationTimeline";const TB=()=>{const{handleFileUpload:t,isBusy:e,isApiKeySet:n,progressMessages:s,fileName:i}=De(S=>{var _;return{handleFileUpload:S.handleFileUpload,isBusy:S.isBusy,isApiKeySet:S.isApiKeySet,progressMessages:S.progressMessages,fileName:((_=S.csvData)==null?void 0:_.fileName)||null}}),[o,u]=re.useState(!1),d={id:"file-upload-panel"},m=re.useCallback(S=>{S.preventDefault(),S.stopPropagation(),n&&(S.type==="dragenter"||S.type==="dragover"?u(!0):S.type==="dragleave"&&u(!1))},[n]),f=re.useCallback(S=>{S.preventDefault(),S.stopPropagation(),u(!1),n&&S.dataTransfer.files&&S.dataTransfer.files[0]&&t(S.dataTransfer.files[0])},[t,n]),y=S=>{n&&S.target.files&&S.target.files[0]&&t(S.target.files[0])};return e&&i?w.jsxs("div",{...d,className:"flex flex-col items-center justify-center p-12 border-2 border-dashed rounded-lg border-blue-500 bg-slate-100 h-full",children:[w.jsxs("div",{className:"flex items-center text-xl text-slate-800 mb-4",children:[w.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[w.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),w.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),w.jsxs("span",{children:['Processing "',i,'"...']})]}),w.jsx("div",{className:"w-full max-w-lg bg-white rounded-md p-4 max-h-64 overflow-y-auto border border-slate-200",children:w.jsx("ul",{className:"space-y-1",children:s.map((S,_)=>w.jsxs("li",{className:`flex text-xs ${S.type==="error"?"text-red-600":"text-slate-500"}`,children:[w.jsx("span",{className:"mr-2 text-slate-400",children:S.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})}),w.jsx("span",{children:S.text})]},_))})}),w.jsx("p",{className:"mt-4 text-xs text-slate-500",children:"All processing is done locally in your browser. Your data stays private."})]}):n?w.jsxs("div",{...d,onDragEnter:m,onDragLeave:m,onDragOver:m,onDrop:f,className:`flex flex-col items-center justify-center p-12 border-2 border-dashed rounded-lg transition-colors duration-300 h-full ${o?"border-blue-500 bg-slate-100":"border-slate-300 hover:border-blue-500"}`,children:[w.jsx("svg",{className:"w-16 h-16 text-slate-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V7a2 2 0 012-2h10a2 2 0 012 2v10a2 2 0 01-2 2z"})}),w.jsx("p",{className:"text-xl text-slate-500 mb-2",children:"Drag & drop your CSV file here"}),w.jsx("p",{className:"text-slate-400",children:"or"}),w.jsx("label",{htmlFor:"file-upload",className:"mt-4 cursor-pointer bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors",children:"Select a file"}),w.jsx("input",{id:"file-upload",type:"file",accept:".csv",onChange:y,className:"hidden",disabled:e}),w.jsx("p",{className:"mt-4 text-xs text-slate-500",children:"All processing is done locally in your browser. Your data stays private."})]}):w.jsxs("div",{...d,className:"flex flex-col items-center justify-center p-12 border-2 border-dashed rounded-lg border-slate-300 h-full",children:[w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-16 h-16 text-slate-400 mb-4",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 5.25a3 3 0 013 3m3 0a6 6 0 01-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1121.75 8.25z"})}),w.jsx("h3",{className:"text-xl font-semibold text-slate-800",children:"API Key Required"}),w.jsx("p",{className:"mt-2 max-w-sm text-center text-slate-500",children:"To unlock the AI analysis features, please add your Google Gemini API key in the Assistant's settings panel."}),w.jsx("p",{className:"mt-6 text-xs text-slate-400",children:"Your data remains local and private even when using the AI."})]})},CB=["English","Mandarin","Spanish","Japanese","French"],b_=["gemini-2.5-flash","gemini-2.5-pro"],T_=["gpt-5","gpt-5-mini"],AB=[{label:"Every 15 seconds",value:15},{label:"Every 30 seconds",value:30},{label:"Every minute",value:60},{label:"Every 2 minutes",value:120}],EB=()=>{const{isOpen:t,onClose:e,onSave:n,currentSettings:s,aggregationMode:i,setAggregationMode:o}=De(_=>({isOpen:_.isSettingsModalOpen,onClose:()=>_.setIsSettingsModalOpen(!1),onSave:_.handleSaveSettings,currentSettings:_.settings,aggregationMode:_.aggregationModePreference,setAggregationMode:_.setAggregationModePreference})),[u,d]=re.useState(s);if(re.useEffect(()=>{d(s)},[s,t]),!t)return null;const m=()=>{n(u),e()},f=_=>{const{name:T,value:C}=_.target;d(T==="autoSaveIntervalSeconds"?N=>({...N,[T]:Number(C)}):N=>({...N,[T]:C}))},y=_=>{d(T=>{const C=b_.includes(T.model),N=T_.includes(T.model);let E=T.model;return _==="google"&&!C?E="gemini-2.5-pro":_==="openai"&&!N&&(E="gpt-5"),{...T,provider:_,model:E}})},S=_=>`px-3 py-1 text-xs font-semibold rounded-md transition ${i===_?"bg-blue-600 text-white shadow-sm":"bg-white text-slate-600 hover:bg-slate-100 border border-slate-200"}`;return w.jsx("div",{className:"fixed inset-0 bg-slate-900 bg-opacity-50 flex items-center justify-center z-50",onClick:e,children:w.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-md border border-slate-200 max-h-[80vh] overflow-y-auto",onClick:_=>_.stopPropagation(),children:[w.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-6",children:"Settings"}),w.jsxs("div",{className:"space-y-6",children:[w.jsxs("div",{children:[w.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"AI Provider"}),w.jsxs("div",{className:"flex space-x-2 rounded-lg bg-slate-200 p-1",children:[w.jsx("button",{onClick:()=>y("google"),className:`w-full rounded-md py-1.5 text-sm font-medium transition-colors ${u.provider==="google"?"bg-blue-600 text-white shadow":"text-slate-700 hover:bg-slate-300"}`,children:"Google Gemini"}),w.jsx("button",{onClick:()=>y("openai"),className:`w-full rounded-md py-1.5 text-sm font-medium transition-colors ${u.provider==="openai"?"bg-blue-600 text-white shadow":"text-slate-700 hover:bg-slate-300"}`,children:"OpenAI"})]})]}),u.provider==="google"&&w.jsxs("div",{children:[w.jsx("label",{htmlFor:"geminiApiKey",className:"block text-sm font-medium text-slate-700",children:"Gemini API Key"}),w.jsx("input",{type:"password",id:"geminiApiKey",name:"geminiApiKey",value:u.geminiApiKey,onChange:f,className:"mt-1 block w-full bg-white border border-slate-300 rounded-md py-2 px-3 text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter your API key"}),w.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Get your key from ",w.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"Google AI Studio"}),"."]})]}),u.provider==="openai"&&w.jsxs("div",{children:[w.jsx("label",{htmlFor:"openAIApiKey",className:"block text-sm font-medium text-slate-700",children:"OpenAI API Key"}),w.jsx("input",{type:"password",id:"openAIApiKey",name:"openAIApiKey",value:u.openAIApiKey,onChange:f,className:"mt-1 block w-full bg-white border border-slate-300 rounded-md py-2 px-3 text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter your API key (sk-...)"}),w.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Get your key from ",w.jsx("a",{href:"https://platform.openai.com/api-keys",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"OpenAI Platform"}),"."]})]}),w.jsxs("div",{children:[w.jsx("label",{htmlFor:"model",className:"block text-sm font-medium text-slate-700",children:"AI Model"}),w.jsx("input",{type:"text",id:"model",name:"model",value:u.model,onChange:f,list:"model-list",className:"mt-1 block w-full bg-white border border-slate-300 rounded-md py-2 px-3 text-slate-900 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., gpt-5"}),w.jsx("datalist",{id:"model-list",children:(u.provider==="google"?b_:T_).map(_=>w.jsx("option",{value:_},_))}),w.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Select a suggested model or type a custom one."})]}),w.jsxs("div",{children:[w.jsx("label",{htmlFor:"language",className:"block text-sm font-medium text-slate-700",children:"Agent Language"}),w.jsx("select",{id:"language",name:"language",value:u.language,onChange:f,className:"mt-1 block w-full bg-white border border-slate-300 rounded-md py-2 px-3 text-slate-900 focus:outline-none focus:ring-2 focus:ring-blue-500",children:CB.map(_=>w.jsx("option",{value:_,children:_},_))}),w.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Primary language for AI summaries and chat responses."})]}),w.jsxs("div",{className:"border-t border-slate-200 pt-4",children:[w.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Aggregation Mode  "}),w.jsx("p",{className:"text-xs text-slate-500 mb-3 max-w-sm",children:" = DuckDB  =  5k "}),w.jsxs("div",{className:"inline-flex items-center gap-1 rounded-lg bg-slate-100 p-1",children:[w.jsx("button",{type:"button",className:S("full"),onClick:()=>o("full"),children:""}),w.jsx("button",{type:"button",className:S("sample"),onClick:()=>o("sample"),children:""})]})]}),w.jsxs("div",{className:"border-t border-slate-200 pt-4",children:[w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsxs("div",{children:[w.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Auto-Save"}),w.jsx("p",{className:"text-xs text-slate-500",children:"Periodically store the current analysis so you can recover it later."})]}),w.jsx("button",{onClick:()=>d(_=>({..._,autoSaveEnabled:!_.autoSaveEnabled})),className:`px-3 py-1 rounded-full text-sm font-medium transition-colors ${u.autoSaveEnabled?"bg-blue-600 text-white":"bg-slate-200 text-slate-700"}`,children:u.autoSaveEnabled?"Enabled":"Paused"})]}),u.autoSaveEnabled&&w.jsxs("div",{className:"mt-4",children:[w.jsx("label",{htmlFor:"autoSaveIntervalSeconds",className:"block text-sm font-medium text-slate-700",children:"Auto-Save Frequency"}),w.jsx("select",{id:"autoSaveIntervalSeconds",name:"autoSaveIntervalSeconds",value:u.autoSaveIntervalSeconds,onChange:f,className:"mt-1 block w-full bg-white border border-slate-300 rounded-md py-2 px-3 text-slate-900 focus:outline-none focus:ring-2 focus:ring-blue-500",children:AB.map(_=>w.jsx("option",{value:_.value,children:_.label},_.value))})]})]})]}),w.jsxs("div",{className:"mt-8 flex justify-end space-x-3",children:[w.jsx("button",{onClick:e,className:"px-4 py-2 bg-slate-200 text-slate-800 rounded-md hover:bg-slate-300 transition-colors",children:"Cancel"}),w.jsx("button",{onClick:m,className:"px-4 py-2 bg-blue-600 text-white font-semibold rounded-md hover:bg-blue-700 transition-colors",children:"Save Settings"})]})]})})},NB=()=>w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),IB=()=>w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),RB=()=>{const{isOpen:t,onClose:e,reports:n,onLoadReport:s,onDeleteReport:i}=De(u=>({isOpen:u.isHistoryPanelOpen,onClose:()=>u.setIsHistoryPanelOpen(!1),reports:u.reportsList,onLoadReport:u.handleLoadReport,onDeleteReport:u.handleDeleteReport}));if(!t)return null;const o=(u,d,m)=>{u.stopPropagation(),window.confirm(`Are you sure you want to delete the report for "${m}"? This cannot be undone.`)&&i(d)};return w.jsx("div",{className:"fixed inset-0 bg-slate-900 bg-opacity-50 flex items-center justify-center z-50",onClick:e,children:w.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-2xl h-full max-h-[80vh] border border-slate-200 flex flex-col",onClick:u=>u.stopPropagation(),children:[w.jsxs("div",{className:"flex justify-between items-center mb-4",children:[w.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"Analysis History"}),w.jsx("button",{onClick:e,className:"p-1 text-slate-500 rounded-full hover:bg-slate-100 hover:text-slate-800 transition-colors",title:"Close History",children:w.jsx(NB,{})})]}),w.jsx("div",{className:"flex-grow overflow-y-auto pr-2",children:n.length===0?w.jsx("div",{className:"flex items-center justify-center h-full",children:w.jsx("p",{className:"text-slate-500",children:"No past reports found. Upload a CSV to start."})}):w.jsx("ul",{className:"space-y-3",children:n.map(u=>{const d=u.id===sa;return w.jsx("li",{children:w.jsx("div",{onClick:()=>!d&&s(u.id),className:`block p-4 bg-slate-50 rounded-lg transition-all ${d?"ring-2 ring-blue-500 cursor-default":"hover:bg-slate-100 hover:ring-2 hover:ring-blue-500 cursor-pointer"}`,children:w.jsxs("div",{className:"flex justify-between items-center",children:[w.jsxs("div",{children:[w.jsxs("p",{className:"font-semibold text-slate-800 truncate",children:[d?w.jsx("span",{className:"text-blue-600 font-bold",children:"[Current Session] "}):null,u.filename]}),w.jsxs("p",{className:"text-sm text-slate-500",children:["Last saved: ",new Date(u.updatedAt).toLocaleString()]})]}),!d&&w.jsx("button",{onClick:m=>o(m,u.id,u.filename),className:"p-2 text-slate-500 rounded-full hover:bg-red-100 hover:text-red-600 transition-colors flex-shrink-0 ml-4",title:"Delete Report",children:w.jsx(IB,{})})]})})},u.id)})})}),w.jsx("p",{className:"text-xs text-slate-500 mt-4 text-center",children:"Your reports are saved securely in your browser's IndexedDB."})]})})},MB=()=>w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),PB=()=>w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),DB=5*1024,LB=()=>{const t=De(P=>P.isMemoryPanelOpen),e=De(P=>P.addToast),n=De(P=>P.resetConversationMemory),s=()=>De.getState().setIsMemoryPanelOpen(!1),[i,o]=re.useState([]),[u,d]=re.useState(""),[m,f]=re.useState([]),[y,S]=re.useState(!1),[_,T]=re.useState(null),C=re.useRef(null),N=Ke.getIsInitialized(),E=re.useCallback(()=>{o(Ke.getDocuments())},[]),L=re.useMemo(()=>{if(i.length===0)return 0;const P=i.reduce((k,F)=>k+F.text.length*2,0),A=i.length*384*4;return(P+A)/1024},[i]);re.useEffect(()=>{t?E():(d(""),f([]),T(null))},[t,E]),re.useEffect(()=>()=>{var P;(P=C.current)==null||P.abort()},[]);const B=async P=>{var k;if(P.preventDefault(),!u.trim()||!N)return;(k=C.current)==null||k.abort();const A=new AbortController;C.current=A,S(!0),T(null);try{const F=await Ke.search(u,5,{signal:A.signal});A.signal.aborted||f(F)}catch(F){F instanceof DOMException&&F.name==="AbortError"||console.error("Memory search failed:",F)}finally{C.current===A&&(C.current=null),S(!1)}},O=()=>{C.current&&(C.current.abort(),C.current=null,S(!1),e("Memory search cancelled.","info"))},x=P=>{window.confirm("Are you sure you want to delete this memory item?")&&(Ke.deleteDocument(P),E())},I=()=>{window.confirm("Reset conversation memory? This clears the AIs long-term memory (including cards and summaries).")&&(n(),E(),f([]),e("Conversation memory reset.","info"))},D=P=>{T(P);const A=document.getElementById(`memory-doc-${P.substring(0,30)}`);A==null||A.scrollIntoView({behavior:"smooth",block:"center"})};if(!t)return null;const R=Math.min(L/DB*100,100);return w.jsx("div",{className:"fixed inset-0 bg-slate-900 bg-opacity-50 flex items-center justify-center z-50 transition-opacity",onClick:s,children:w.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-4xl h-full max-h-[85vh] border border-slate-200 flex flex-col",onClick:P=>P.stopPropagation(),children:[w.jsxs("header",{className:"flex justify-between items-start mb-4 flex-shrink-0",children:[w.jsxs("div",{children:[w.jsxs("div",{className:"flex items-center space-x-3",children:[w.jsx("span",{className:"text-3xl",children:""}),w.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"AI Long-Term Memory"})]}),w.jsxs("div",{className:"mt-2 pl-12",children:[w.jsxs("div",{className:"flex items-baseline space-x-2 text-sm text-slate-500",children:[w.jsxs("span",{children:[i.length," items"]}),w.jsx("span",{className:"text-slate-300",children:"|"}),w.jsxs("span",{children:["Using ~",L.toFixed(2)," KB"]})]}),w.jsx("div",{className:"w-full bg-slate-200 rounded-full h-1.5 mt-1",children:w.jsx("div",{className:"bg-blue-600 h-1.5 rounded-full",style:{width:`${R}%`}})})]})]}),w.jsx("button",{onClick:s,className:"p-1 text-slate-500 rounded-full hover:bg-slate-100 hover:text-slate-800 transition-colors",title:"Close",children:w.jsx(MB,{})})]}),w.jsxs("div",{className:"flex-grow grid md:grid-cols-2 gap-6 min-h-0",children:[w.jsxs("div",{className:"flex flex-col min-h-0",children:[w.jsxs("div",{className:"mb-4 p-4 bg-slate-50 border border-slate-200 rounded-lg flex-shrink-0",children:[w.jsx("h3",{className:"font-semibold text-slate-800 mb-2",children:"Test Similarity Search"}),w.jsxs("form",{onSubmit:B,className:"flex items-center space-x-2",children:[w.jsx("input",{type:"text",value:u,onChange:P=>d(P.target.value),placeholder:N?"Enter query to find memories...":"Memory model is loading...",disabled:!N||y,className:"flex-grow bg-white border border-slate-300 rounded-md py-1.5 px-3 text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:opacity-50"}),w.jsxs("div",{className:"flex items-center space-x-2",children:[w.jsx("button",{type:"submit",disabled:!N||y||!u.trim(),className:"px-4 py-1.5 bg-blue-600 text-white font-semibold rounded-md hover:bg-blue-700 transition-colors disabled:bg-blue-300 disabled:cursor-not-allowed",children:y?"Searching":"Search"}),y&&w.jsx("button",{type:"button",onClick:O,className:"px-3 py-1.5 border border-slate-300 rounded-md text-slate-600 hover:bg-slate-100 transition-colors",children:"Cancel"})]})]})]}),w.jsx("div",{className:"flex-grow overflow-y-auto pr-2",children:m.length>0&&w.jsxs("div",{className:"space-y-2",children:[w.jsx("h4",{className:"text-sm font-medium text-slate-600",children:"Top Results:"}),m.map(P=>w.jsxs("div",{onClick:()=>D(P.text),className:"bg-white p-2.5 border border-slate-200 rounded-lg text-xs cursor-pointer hover:border-blue-500 hover:ring-1 hover:ring-blue-500",children:[w.jsxs("div",{className:"flex justify-between items-center mb-1",children:[w.jsx("p",{className:"text-slate-700 font-semibold",children:"Match"}),w.jsxs("p",{className:"text-blue-600 font-bold",children:[(P.score*100).toFixed(1),"%"]})]}),w.jsx("div",{className:"w-full bg-slate-200 rounded-full h-1 mb-2",children:w.jsx("div",{className:"bg-blue-500 h-1 rounded-full",style:{width:`${P.score*100}%`}})}),w.jsxs("p",{className:"text-slate-600 italic",children:['"',P.text,'"']})]},P.id))]})})]}),w.jsxs("div",{className:"flex flex-col min-h-0",children:[w.jsxs("div",{className:"flex justify-between items-center mb-2 flex-shrink-0",children:[w.jsxs("h3",{className:"font-semibold text-slate-800",children:["All Stored Memories (",i.length,")"]}),i.length>0&&w.jsx("button",{onClick:I,className:"text-xs text-red-600 hover:underline",children:"Reset Conversation Memory"})]}),w.jsx("div",{className:"flex-grow overflow-y-auto pr-2 border-t border-slate-200 pt-2",children:i.length===0?w.jsx("div",{className:"flex items-center justify-center h-full text-slate-500 text-sm",children:w.jsx("p",{children:"The AI's memory is currently empty."})}):w.jsx("ul",{className:"space-y-2",children:i.map(P=>{const A=P.metadata??{},k=A.summaryLevel??"raw",F=A.kind??"general",U=A.startIndex!=null&&A.endIndex!=null?`Messages ${A.startIndex+1}-${A.endIndex+1}`:null;return w.jsxs("li",{id:`memory-doc-${P.text.substring(0,30)}`,className:`p-3 bg-slate-50 rounded-lg text-sm text-slate-800 border border-slate-200 flex justify-between items-start group transition-all duration-300 ${_===P.text?"border-blue-500 ring-2 ring-blue-500":""}`,children:[w.jsxs("div",{className:"flex-grow pr-4 break-words space-y-1",children:[w.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-[11px] uppercase tracking-wide text-slate-500",children:[w.jsx("span",{className:"px-2 py-0.5 border border-slate-300 rounded-full bg-white",children:F==="conversation"?"Conversation":"Card"}),w.jsx("span",{className:`px-2 py-0.5 rounded-full ${k==="summary"?"bg-indigo-100 text-indigo-700 border border-indigo-200":"bg-emerald-50 text-emerald-700 border border-emerald-200"}`,children:k==="summary"?"Compressed":"Raw"}),U&&w.jsx("span",{className:"text-slate-400",children:U})]}),w.jsx("p",{children:P.text})]}),w.jsx("button",{onClick:()=>x(P.id),className:"p-1 text-slate-400 rounded-full hover:bg-red-100 hover:text-red-600 transition-colors opacity-0 group-hover:opacity-100 flex-shrink-0",title:"Delete Memory",children:w.jsx(PB,{})})]},P.id)})})})]})]})]})})},pu=50,kB=({direction:t})=>t?t==="ascending"?w.jsx("span",{className:"text-slate-800",children:""}):w.jsx("span",{className:"text-slate-800",children:""}):w.jsx("span",{className:"text-slate-400",children:""}),UB=({data:t,sortConfig:e,onSort:n,columnWidths:s,onColumnResizeStart:i})=>{const[o,u]=re.useState(0);if(!t||t.length===0)return w.jsx("p",{className:"text-slate-500 p-4 text-center",children:"No data matches your search."});const d=Object.keys(t[0]),m=Math.ceil(t.length/pu),f=o*pu,y=t.slice(f,f+pu),S=()=>u(C=>Math.max(0,C-1)),_=()=>u(C=>Math.min(m-1,C+1)),T=C=>{let N,E="";for(;C>=0;)N=C%26,E=String.fromCharCode(N+65)+E,C=Math.floor(C/26)-1;return E};return w.jsxs("div",{className:"w-full text-sm h-full flex flex-col",children:[w.jsx("div",{className:"flex-grow overflow-auto",children:w.jsxs("table",{className:"w-full text-left border-collapse",style:{tableLayout:"fixed"},children:[w.jsx("thead",{className:"bg-slate-100 text-slate-600 sticky top-0 z-10",children:w.jsxs("tr",{children:[w.jsx("th",{className:"p-2 font-semibold text-slate-500 text-center sticky left-0 z-20 bg-slate-100 border-r border-slate-200",style:{width:"60px"},children:"#"}),d.map((C,N)=>w.jsxs("th",{className:"p-2 font-semibold whitespace-nowrap border-r border-l border-slate-200 relative",style:{width:s[C]||150},children:[w.jsxs("button",{onClick:()=>n(C),className:"flex items-center justify-between w-full h-full",children:[w.jsxs("span",{className:"truncate",title:C,children:[T(N)," - ",C]}),w.jsx(kB,{direction:(e==null?void 0:e.key)===C?e.direction:void 0})]}),w.jsx("div",{onMouseDown:E=>i(C,E),className:"absolute top-0 right-0 h-full w-2 cursor-col-resize z-30"})]},C))]})}),w.jsx("tbody",{className:"bg-white",children:y.map((C,N)=>w.jsxs("tr",{className:"border-b border-slate-200 last:border-b-0 hover:bg-slate-50",children:[w.jsx("td",{className:"p-2 text-slate-400 text-center sticky left-0 z-10 bg-white border-r border-slate-200",style:{width:"60px"},children:f+N+1}),d.map(E=>w.jsx("td",{className:"p-2 text-slate-700 whitespace-nowrap overflow-hidden text-ellipsis border-r border-l border-slate-200",children:Au(C[E])},`${N}-${E}`))]},N))})]})}),m>1&&w.jsxs("div",{className:"flex justify-between items-center p-2 bg-slate-100 border-t border-slate-200 flex-shrink-0",children:[w.jsxs("span",{className:"text-xs text-slate-500",children:["Showing ",f+1," - ",Math.min(f+pu,t.length)," of ",t.length," rows"]}),w.jsxs("div",{className:"flex items-center space-x-2",children:[w.jsx("button",{onClick:S,disabled:o===0,className:"px-2 py-1 text-xs bg-slate-200 rounded disabled:opacity-50 hover:bg-slate-300",children:"Previous"}),w.jsxs("span",{className:"text-xs text-slate-500",children:["Page ",o+1," of ",m]}),w.jsx("button",{onClick:_,disabled:o===m-1,className:"px-2 py-1 text-xs bg-slate-200 rounded disabled:opacity-50 hover:bg-slate-300",children:"Next"})]})]})]})},OB=()=>w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-slate-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),qB=({isOpen:t})=>w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-6 w-6 transform transition-transform duration-200 ${t?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),C_=()=>w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:w.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})}),BB=()=>w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:w.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})}),FB=()=>w.jsxs("svg",{className:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[w.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),w.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),$B=t=>{const e=t instanceof Date?t:new Date(t);return Number.isNaN(e.getTime())?"":e.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"})},HB=({isVisible:t})=>{const{csvData:e,spreadsheetFilterFunction:n,aiFilterExplanation:s,isAiFiltering:i,handleNaturalLanguageQuery:o,clearAiFilter:u,cancelAiFilterRequest:d,interactiveSelectionFilter:m,chatHistory:f,datasetHash:y,addToast:S}=De(U=>({csvData:U.csvData,spreadsheetFilterFunction:U.spreadsheetFilterFunction,aiFilterExplanation:U.aiFilterExplanation,isAiFiltering:U.isAiFiltering,handleNaturalLanguageQuery:U.handleNaturalLanguageQuery,clearAiFilter:U.clearAiFilter,cancelAiFilterRequest:U.cancelAiFilterRequest,interactiveSelectionFilter:U.interactiveSelectionFilter,chatHistory:U.chatHistory,datasetHash:U.datasetHash,addToast:U.addToast})),_=()=>De.getState().setIsSpreadsheetVisible(!t),[T,C]=re.useState(null),[N,E]=re.useState(""),L=re.useMemo(()=>(e==null?void 0:e.data.length)>0?Object.keys(e.data[0]):[],[e==null?void 0:e.data]),[B,O]=re.useState({});re.useEffect(()=>{if(!e)return;const U={};L.forEach(z=>{var q;const oe=z.length*8+30,se=String(((q=e.data[0])==null?void 0:q[z])||"").length*7;U[z]=Math.max(120,oe,se)}),O(U)},[L,e]);const x=U=>{let z="ascending";T&&T.key===U&&T.direction==="ascending"&&(z="descending"),C({key:U,direction:z})},I=(U,z)=>{z.preventDefault();const oe=z.clientX,se=B[U],q=ae=>{const ge=se+(ae.clientX-oe);ge>60&&O(Ce=>({...Ce,[U]:ge}))},j=()=>{document.removeEventListener("mousemove",q),document.removeEventListener("mouseup",j),document.body.style.cursor=""};document.body.style.cursor="col-resize",document.addEventListener("mousemove",q),document.addEventListener("mouseup",j)},D=()=>{if(!e||e.data.length===0||L.length===0)return;const U=j=>{const ae=j==null?"":String(j);return/[",\n]/.test(ae)?`"${ae.replace(/"/g,'""')}"`:ae},z=[L.join(","),...e.data.map(j=>L.map(ae=>U(j[ae])).join(","))],oe=new Blob([z.join(`
`)],{type:"text/csv;charset=utf-8;"}),se=URL.createObjectURL(oe),q=document.createElement("a");q.href=se,q.download=e.fileName||"dataset.csv",q.click(),URL.revokeObjectURL(se)},R=async()=>{if(y)try{await navigator.clipboard.writeText(y),S("Checksum copied.","success",2e3)}catch(U){console.error("Failed to copy checksum:",U),S("Copy failed. Please copy manually.","error",3e3)}},P=()=>{N.trim()&&o(N.trim())},A=U=>{U.key==="Enter"&&P()},k=re.useMemo(()=>{if(!e)return[];let U=[...e.data];if(m&&m.column){const z=m.values.map(oe=>String(oe));U=U.filter(oe=>{const se=oe[m.column];return z.includes(se==null?"":String(se))})}if(n)try{U=U_(U,n)}catch(z){console.error("AI filter execution failed:",z)}else if(N){const z=N.toLowerCase();U=U.filter(oe=>Object.values(oe).some(se=>String(se).toLowerCase().includes(z)))}return T!==null&&U.sort((z,oe)=>{const se=z[T.key],q=oe[T.key];if(se==null)return 1;if(q==null)return-1;const j=typeof se=="number"?se:parseFloat(String(se).replace(/[^0-9.-]+/g,"")),ae=typeof q=="number"?q:parseFloat(String(q).replace(/[^0-9.-]+/g,""));if(!isNaN(j)&&!isNaN(ae))return T.direction==="ascending"?j-ae:ae-j;const ge=String(se).toLowerCase(),Ce=String(q).toLowerCase();return ge<Ce?T.direction==="ascending"?-1:1:ge>Ce?T.direction==="ascending"?1:-1:0}),U},[e,T,N,n,m]),F=re.useMemo(()=>f.filter(U=>typeof U.text=="string"&&U.text.startsWith("System note:")&&(U.text.includes("Raw Data Explorer")||U.text.includes("chart drilldown"))).slice(-5).reverse(),[f]);return e?w.jsxs("div",{id:"raw-data-explorer",className:"bg-white rounded-lg shadow-lg flex flex-col transition-all duration-300 border border-slate-200",children:[w.jsxs("button",{onClick:_,className:"flex justify-between items-center p-4 cursor-pointer w-full text-left rounded-t-lg hover:bg-slate-50","aria-expanded":t,children:[w.jsxs("div",{children:[w.jsx("h3",{className:"text-lg font-bold text-slate-900",children:"Raw Data Explorer"}),w.jsxs("p",{className:"text-sm text-slate-500",children:["File: ",e.fileName]}),w.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-xs text-slate-500",children:[w.jsx("button",{type:"button",onClick:D,className:"underline decoration-dotted hover:text-slate-700",children:"Download Original"}),w.jsx("span",{className:"text-slate-300",children:""}),w.jsx("button",{type:"button",onClick:R,disabled:!y,className:`underline decoration-dotted ${y?"hover:text-slate-700":"text-slate-300 cursor-not-allowed"}`,children:"Copy checksum"})]})]}),w.jsx(qB,{isOpen:t})]}),t&&w.jsxs("div",{className:"flex flex-col h-full p-4 pt-0",children:[m&&w.jsxs("div",{className:"bg-amber-50 text-amber-900 border border-amber-200 rounded-md p-2 text-xs mb-2",children:[w.jsx("p",{className:"font-semibold",children:"Chart Drilldown Active"}),w.jsxs("p",{className:"mt-1",children:[m.label,"  ",m.column," "," ",m.values.map(U=>String(U)).join(", ")]}),w.jsx("p",{className:"mt-1 text-amber-800",children:"Adjust or clear the selection directly on the chart to remove this link."})]}),F.length>0&&w.jsxs("div",{className:"bg-slate-50 text-slate-700 border border-slate-200 rounded-md p-2 text-xs mb-2",children:[w.jsx("p",{className:"font-semibold mb-1",children:"Filter Provenance"}),w.jsx("ul",{className:"space-y-1",children:F.map((U,z)=>w.jsxs("li",{className:"flex justify-between items-start gap-2",children:[w.jsx("span",{className:"flex-1 text-slate-600",children:U.text}),w.jsx("span",{className:"text-slate-400 whitespace-nowrap",children:$B(U.timestamp)})]},`${U.timestamp}-${z}`))})]}),w.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[w.jsxs("div",{className:"flex flex-col flex-grow space-y-1",children:[w.jsxs("div",{className:"relative",children:[w.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:w.jsx(OB,{})}),w.jsx("input",{type:"text",placeholder:"Search table or ask AI (e.g., 'show rows where column_3 > 100')",value:N,onChange:U=>E(U.target.value),onKeyDown:A,className:"bg-white border border-slate-300 rounded-md py-1.5 pl-10 pr-4 text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-1 focus:ring-blue-500 w-full"})]}),w.jsxs("div",{className:"text-xs text-slate-500 flex items-center space-x-3 flex-wrap",children:[w.jsxs("span",{children:["Filtered rows: ",k.length,"/",e.data.length]}),n&&w.jsxs("button",{type:"button",onClick:u,className:"flex items-center space-x-1 text-blue-600 hover:text-blue-800 underline decoration-dotted",title:"Clear AI filter",children:[w.jsx(C_,{}),w.jsx("span",{children:"AI filter active (click to clear)"})]}),m&&w.jsxs("span",{className:"text-amber-700",children:['Drilldown from "',m.label,'"']})]})]}),w.jsxs("div",{className:"flex items-center space-x-2",children:[w.jsxs("button",{onClick:P,disabled:i||!N.trim(),className:"flex items-center space-x-2 px-3 py-1.5 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:bg-blue-300 disabled:cursor-not-allowed",title:"Use AI to filter data based on your query",children:[i?w.jsx(FB,{}):w.jsx(C_,{}),w.jsx("span",{children:i?"Working":"Ask AI"})]}),i&&w.jsx("button",{type:"button",onClick:d,className:"px-3 py-1.5 border border-slate-300 rounded-md text-slate-600 hover:bg-slate-100 transition-colors",children:"Cancel"})]})]}),s&&w.jsxs("div",{className:"bg-blue-50 text-blue-800 border border-blue-200 rounded-md p-2 text-sm flex justify-between items-center mb-2",children:[w.jsxs("p",{children:[w.jsx("span",{className:"font-semibold",children:"AI Filter:"})," ",s]}),w.jsx("button",{onClick:u,className:"p-1 rounded-full hover:bg-blue-200",title:"Clear AI filter",children:w.jsx(BB,{})})]}),w.jsx("div",{className:"flex-grow overflow-auto border border-slate-200 rounded-md",style:{maxHeight:"60vh"},children:w.jsx(UB,{data:k,sortConfig:T,onSort:x,columnWidths:B,onColumnResizeStart:I})})]})]}):null},GB=({isOpen:t})=>w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-6 w-6 transform transition-transform duration-200 ${t?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),VB=()=>w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:w.jsx("path",{fillRule:"evenodd",d:"M12.316 3.051a1 1 0 01.633 1.265l-4 12a1 1 0 11-1.898-.632l4-12a1 1 0 011.265-.633zM5.707 6.293a1 1 0 010 1.414L3.414 10l2.293 2.293a1 1 0 11-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0zm8.586 0a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 11-1.414-1.414L16.586 10l-2.293-2.293a1 1 0 010-1.414z",clipRule:"evenodd"})}),zB=({isVisible:t})=>{const{plan:e,originalSample:n,transformedSample:s}=De(o=>{var u;return{plan:o.dataPreparationPlan,originalSample:o.initialDataSample,transformedSample:((u=o.csvData)==null?void 0:u.data.slice(0,20))||[]}}),i=()=>De.getState().setIsDataPrepDebugVisible(!t);return!e||!n?null:w.jsxs("div",{className:"bg-white rounded-lg shadow-lg flex flex-col transition-all duration-300 border border-slate-200",children:[w.jsxs("button",{onClick:i,className:"flex justify-between items-center p-4 cursor-pointer w-full text-left rounded-t-lg hover:bg-slate-50","aria-expanded":t,children:[w.jsxs("div",{children:[w.jsxs("h3",{className:"text-lg font-bold text-slate-900 flex items-center",children:[w.jsx(VB,{})," AI Data Transformation Log"]}),w.jsx("p",{className:"text-sm text-slate-500",children:"See how the AI cleaned and reshaped your data."})]}),w.jsx(GB,{isOpen:t})]}),t&&w.jsxs("div",{className:"p-4 pt-0 space-y-6",children:[w.jsxs("div",{children:[w.jsx("h4",{className:"font-semibold text-slate-800 mb-2",children:"AI's Plan"}),w.jsxs("p",{className:"text-sm bg-slate-50 p-3 rounded-md border border-slate-200 text-slate-700 italic",children:['"',e.explanation,'"']})]}),w.jsxs("div",{children:[w.jsx("h4",{className:"font-semibold text-slate-800 mb-2",children:"Transformation Code"}),w.jsx("pre",{className:"bg-slate-900 text-slate-100 p-3 rounded-md text-xs overflow-x-auto",children:w.jsx("code",{children:`// AI-generated function to transform data
function transform(data, _util) {
${e.jsFunctionBody}
}`})})]}),w.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[w.jsxs("div",{children:[w.jsx("h4",{className:"font-semibold text-slate-800 mb-2",children:"Data Before (Raw Sample)"}),w.jsx("div",{className:"max-h-64 overflow-y-auto border border-slate-200 rounded-md",children:w.jsx(Eu,{data:n})})]}),w.jsxs("div",{children:[w.jsx("h4",{className:"font-semibold text-slate-800 mb-2",children:"Data After (Transformed Sample)"}),w.jsx("div",{className:"max-h-64 overflow-y-auto border border-slate-200 rounded-md",children:w.jsx(Eu,{data:s})})]})]})]})]})},jB=()=>w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),YB=()=>w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),JB=()=>w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2-2z"})}),KB=Xb(),XB=()=>{const{onNewSession:t,onOpenHistory:e,isAsideVisible:n,onShowAssistant:s,graphStatus:i,graphStatusMessage:o,graphVersion:u,graphLastReadyAt:d}=De(S=>({onNewSession:S.handleNewSession,onOpenHistory:()=>{S.loadReportsList(),S.setIsHistoryPanelOpen(!0)},isAsideVisible:S.isAsideVisible,onShowAssistant:()=>S.setIsAsideVisible(!0),graphStatus:S.graphStatus,graphStatusMessage:S.graphStatusMessage,graphVersion:S.graphVersion,graphLastReadyAt:S.graphLastReadyAt})),m=(()=>{switch(i){case"ready":return`Graph Ready (v${u??""})`;case"connecting":return"Graph Initializing";case"error":return o??"Graph Offline";default:return"Graph Idle"}})(),f={ready:"bg-emerald-100 text-emerald-700 border-emerald-200",connecting:"bg-amber-100 text-amber-700 border-amber-200",error:"bg-rose-100 text-rose-700 border-rose-200",idle:"bg-slate-100 text-slate-600 border-slate-200"},y=f[i]??f.idle;return w.jsxs("header",{className:"mb-6 flex justify-between items-start flex-shrink-0",children:[w.jsxs("div",{className:"max-w-xs",children:[w.jsx("h1",{className:"text-xl font-extrabold text-slate-900 leading-tight",children:"CSV Data Analysis Agent"}),w.jsxs("div",{className:"mt-2 flex flex-col gap-1",children:[w.jsxs("span",{className:`inline-flex items-center gap-2 rounded-full border px-3 py-1 text-[11px] font-semibold ${y}`,children:["  ",m]}),d&&w.jsxs("span",{className:"text-[11px] text-slate-400",children:["Last heartbeat: ",new Date(d).toLocaleTimeString()]})]})]}),w.jsx("div",{className:"flex flex-col items-end gap-4 sm:flex-row sm:items-center sm:gap-6",children:w.jsxs("div",{className:"flex items-center space-x-2",children:[KB.showNewButton&&w.jsxs("button",{onClick:t,className:"flex items-center space-x-2 px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",title:"Start a new analysis session",children:[w.jsx(JB,{}),w.jsx("span",{className:"hidden sm:inline",children:"New"})]}),w.jsxs("button",{onClick:e,className:"flex items-center space-x-2 px-3 py-2 bg-white border border-slate-300 text-slate-700 rounded-md hover:bg-slate-100 transition-colors",title:"View analysis history",children:[w.jsx(YB,{}),w.jsx("span",{className:"hidden sm:inline",children:"History"})]}),!n&&w.jsx("button",{onClick:s,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors","aria-label":"Show Assistant Panel",title:"Show Assistant Panel",children:w.jsx(jB,{})})]})})]})},QB=({className:t="h-4 w-4 text-blue-600 animate-spin",ariaLabel:e="Loading"})=>w.jsxs("svg",{className:t,viewBox:"0 0 24 24",fill:"none",role:"status","aria-label":e,children:[w.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),w.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),WB={observe:"Observe",plan:"Plan",act:"Act",verify:"Verify",idle:"Idle"},ZB=({runtimeLabel:t,graphStatus:e,graphStatusMessage:n,graphToolInFlight:s,graphLastToolSummary:i,agentAwaitingUserInput:o,graphAwaitPrompt:u})=>s?{headline:`${t}  ${s.label}`,detail:n??""}:o?{headline:`${t} `,detail:(u==null?void 0:u.question)??n??""}:e==="connecting"?{headline:`${t} runtime `,detail:n??"Spinning up worker"}:e==="error"?{headline:`${t} runtime `,detail:n??" System Log"}:i?{headline:`${t} runtime `,detail:i}:{headline:`${t} runtime`,detail:n},e4=()=>{const{runtimeLabel:t,graphStatus:e,graphStatusMessage:n,graphToolInFlight:s,graphLastToolSummary:i,agentAwaitingUserInput:o,graphAwaitPrompt:u,graphPhase:d,graphLoopBudget:m}=De(f=>({runtimeLabel:f.useLangGraphRuntime?"LangGraph":"Graph",graphStatus:f.graphStatus,graphStatusMessage:f.graphStatusMessage,graphToolInFlight:f.graphToolInFlight,graphLastToolSummary:f.graphLastToolSummary,agentAwaitingUserInput:f.agentAwaitingUserInput,graphAwaitPrompt:f.graphAwaitPrompt,graphPhase:f.graphPhase,graphLoopBudget:f.graphLoopBudget}));return re.useMemo(()=>{const T=!!s||o||e==="connecting"||e==="error"||!!i,{headline:C,detail:N}=ZB({runtimeLabel:t,graphStatus:e,graphStatusMessage:n,graphToolInFlight:s,graphLastToolSummary:i,agentAwaitingUserInput:o,graphAwaitPrompt:u}),E=d?WB[d]??d:null,L=m?`${m.actsUsed}/${m.maxActs}${m.exceeded?" (max reached)":""}`:null;return{shouldRender:T,headline:C,detail:N,runtimeLabel:t,agentAwaitingUserInput:o,activeToolLabel:(s==null?void 0:s.label)??null,graphStatus:e,phaseLabel:E,loopSummary:L}},[t,e,n,s,i,o,u,d,m])},t4=()=>{const{isBusy:t,busyMessage:e,canCancelBusy:n,requestBusyCancel:s,isCancellationRequested:i}=De(S=>({isBusy:S.isBusy,busyMessage:S.busyMessage,canCancelBusy:S.canCancelBusy,requestBusyCancel:S.requestBusyCancel,isCancellationRequested:S.isCancellationRequested})),o=e4(),u=t,d=!t&&o.shouldRender;if(!u&&!d)return null;const m=u?e||"Thinking through your question...":o.headline,f=o.phaseLabel||o.loopSummary?`Phase: ${o.phaseLabel??"Idle"}${o.loopSummary?`  Loop ${o.loopSummary}`:""}`:null,y=o.detail;return w.jsxs("div",{className:"mb-4 rounded-lg border border-blue-200 bg-blue-50 px-4 py-3 shadow-sm flex flex-col gap-2 md:flex-row md:items-center md:justify-between",role:"status","aria-live":"polite",children:[w.jsxs("div",{className:"flex items-center gap-3 text-blue-900",children:[w.jsx(QB,{}),w.jsxs("div",{children:[w.jsx("p",{className:"text-sm font-semibold",children:m}),u&&i&&w.jsx("p",{className:"text-xs text-blue-700",children:"Cancelling wrapping up safely."}),y&&w.jsx("p",{className:"text-xs text-blue-700",children:y}),f&&w.jsx("p",{className:"text-xs text-blue-700",children:f})]})]}),u&&n?w.jsx("button",{type:"button",onClick:s,disabled:i,className:"text-sm font-semibold rounded-md border border-blue-300 px-3 py-1.5 text-blue-700 hover:bg-blue-100 disabled:opacity-60 disabled:cursor-not-allowed",children:i?"Cancelling":"Cancel"}):d&&w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsxs("span",{className:"inline-flex items-center rounded-full bg-blue-100 px-2 py-0.5 text-xs font-semibold text-blue-700",children:[o.runtimeLabel," runtime"]}),o.phaseLabel&&w.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-200 px-2 py-0.5 text-xs font-semibold text-slate-700",children:o.phaseLabel}),o.loopSummary&&w.jsxs("span",{className:"text-xs text-slate-600",children:["Loop ",o.loopSummary]}),o.agentAwaitingUserInput&&w.jsx("span",{className:"text-xs font-semibold text-orange-600",children:"Waiting for your input"}),o.activeToolLabel&&w.jsxs("span",{className:"text-xs text-blue-700",children:["",o.activeToolLabel]})]})]})},n4={info:"bg-slate-800 text-white",success:"bg-emerald-600 text-white",error:"bg-red-600 text-white"},s4=()=>{const{toasts:t,dismissToast:e}=De(n=>({toasts:n.toasts,dismissToast:n.dismissToast}));return t.length===0?null:w.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-3 max-w-sm",children:t.map(n=>w.jsxs("div",{className:`flex items-start justify-between rounded-lg shadow-lg px-4 py-3 text-sm ${n4[n.type]}`,children:[w.jsxs("div",{className:"pr-4 space-y-2",children:[w.jsx("p",{children:n.message}),n.actionLabel&&n.onAction&&w.jsx("button",{className:"underline text-white/90 hover:text-white text-xs font-medium",onClick:()=>{var s;(s=n.onAction)==null||s.call(n),e(n.id)},children:n.actionLabel})]}),w.jsx("button",{onClick:()=>e(n.id),className:"text-white/70 hover:text-white text-lg leading-none","aria-label":"Dismiss notification",children:""})]},n.id))})},a4=(t,e,n,s,i)=>{const o=[`${t}  ${e} rows`];return n&&o.push(`${n} removed`),s&&o.push(`${s} added`),i&&o.push(`${i} modified`),o.join("  ")},r4=()=>{const{pendingDataTransform:t,lastAppliedDataTransform:e,isLastAppliedDataTransformBannerDismissed:n,confirmPendingDataTransform:s,discardPendingDataTransform:i,undoLastDataTransform:o,dismissLastAppliedDataTransformBanner:u}=De(f=>({pendingDataTransform:f.pendingDataTransform,lastAppliedDataTransform:f.lastAppliedDataTransform,isLastAppliedDataTransformBannerDismissed:f.isLastAppliedDataTransformBannerDismissed,confirmPendingDataTransform:f.confirmPendingDataTransform,discardPendingDataTransform:f.discardPendingDataTransform,undoLastDataTransform:f.undoLastDataTransform,dismissLastAppliedDataTransformBanner:f.dismissLastAppliedDataTransformBanner})),d=n?null:e,m=!!d;return!t&&!m?null:w.jsxs("div",{className:"space-y-3 mt-4",children:[t&&w.jsxs("div",{className:"border border-amber-200 bg-amber-50 rounded-md p-4 shadow-sm",children:[w.jsx("p",{className:"text-sm font-semibold text-amber-900",children:"AI Data Change Pending Confirmation"}),w.jsx("p",{className:"text-xs text-amber-900 mt-1",children:t.explanation||"The AI prepared a dataset update."}),w.jsx("p",{className:"text-xs text-amber-800 mt-1",children:a4(t.meta.rowsBefore,t.meta.rowsAfter,t.meta.removedRows,t.meta.addedRows,t.meta.modifiedRows)}),t.previewRows.length>0&&w.jsx("pre",{className:"bg-white text-amber-900 text-xs rounded-md mt-2 p-2 overflow-auto max-h-40 border border-amber-200",children:JSON.stringify(t.previewRows.slice(0,2),null,2)}),w.jsxs("div",{className:"flex flex-wrap gap-2 mt-3",children:[w.jsx("button",{onClick:s,className:"px-3 py-1.5 bg-amber-600 text-white rounded-md text-sm hover:bg-amber-700 transition-colors",children:"Apply Change"}),w.jsx("button",{onClick:i,className:"px-3 py-1.5 border border-amber-400 text-amber-900 rounded-md text-sm hover:bg-amber-100 transition-colors",children:"Discard"})]})]}),m&&w.jsx("div",{className:"border border-emerald-200 bg-emerald-50 rounded-md p-3",children:w.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[w.jsxs("div",{children:[w.jsx("p",{className:"text-sm font-semibold text-emerald-900",children:"Last Applied AI Change"}),w.jsx("p",{className:"text-xs text-emerald-800 mt-1",children:d.summary})]}),w.jsxs("div",{className:"flex items-center gap-2 self-start sm:self-auto",children:[w.jsx("button",{onClick:o,className:"px-3 py-1.5 border border-emerald-400 text-emerald-900 rounded-md text-sm hover:bg-emerald-100 transition-colors",children:"Undo Change"}),w.jsx("button",{type:"button",onClick:u,"aria-label":"Dismiss last applied AI change",className:"p-1.5 rounded-full text-emerald-700 hover:text-emerald-900 hover:bg-emerald-100 transition-colors",children:w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-4 h-4","aria-hidden":"true",children:w.jsx("path",{fillRule:"evenodd",d:"M5.22 5.22a.75.75 0 0 1 1.06 0L10 8.94l3.72-3.72a.75.75 0 1 1 1.06 1.06L11.06 10l3.72 3.72a.75.75 0 1 1-1.06 1.06L10 11.06l-3.72 3.72a.75.75 0 1 1-1.06-1.06L8.94 10 5.22 6.28a.75.75 0 0 1 0-1.06Z",clipRule:"evenodd"})})})]})]})})]})},i4=()=>{const{datasetHash:t,langChainLastPlan:e,isBusy:n,addProgress:s,isApiKeySet:i}=De(f=>({datasetHash:f.datasetHash,langChainLastPlan:f.langChainLastPlan,isBusy:f.isBusy,addProgress:f.addProgress,isApiKeySet:f.isApiKeySet})),[o,u]=re.useState(!1),d=!!(t&&i&&!n&&!o),m=async()=>{if(!t){s("LangChain PoC requires an uploaded dataset.","error");return}u(!0);try{const{runLangChainPrompt:f}=await $u(async()=>{const{runLangChainPrompt:y}=await import("./agent_csv_promptRunner-C4Kucmg5.js");return{runLangChainPrompt:y}},__vite__mapDeps([0,1]));await f({datasetId:t,debug:!0})}catch(f){const y=f instanceof Error?f.message:String(f??"Unknown error");s(`LangChain PoC failed: ${y}`,"error")}finally{u(!1)}};return w.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl shadow-sm p-4 space-y-4",children:[w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsxs("div",{children:[w.jsx("p",{className:"text-sm font-semibold text-slate-900",children:"LangChain PoC"}),w.jsx("p",{className:"text-xs text-slate-500",children:"Run promptplan pipeline via LangChain."})]}),w.jsx("button",{type:"button",onClick:m,disabled:!d,className:"px-3 py-1.5 text-xs font-semibold rounded-md border border-slate-300 text-slate-700 hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed",children:o?"Running":"Run LangChain Plan"})]}),e?w.jsxs("div",{className:"text-sm text-slate-700 space-y-1",children:[w.jsx("p",{className:"font-semibold",children:e.title}),w.jsx("p",{className:"text-xs text-slate-500",children:e.description}),w.jsxs("div",{className:"text-xs text-slate-600 mt-2",children:[w.jsxs("span",{className:"inline-flex items-center gap-1",children:[w.jsx("span",{className:"font-semibold",children:"Chart:"}),e.chartType]}),e.groupByColumn&&w.jsxs("span",{className:"inline-flex items-center gap-1 ml-4",children:[w.jsx("span",{className:"font-semibold",children:"Group by:"}),e.groupByColumn]}),e.valueColumn&&w.jsxs("span",{className:"inline-flex items-center gap-1 ml-4",children:[w.jsx("span",{className:"font-semibold",children:"Metric:"}),e.valueColumn]})]})]}):w.jsx("p",{className:"text-xs text-slate-500",children:" LangChain "})]})},cp=new Intl.NumberFormat(void 0,{maximumFractionDigits:2}),A_=new Intl.NumberFormat(void 0,{style:"currency",currency:"USD",maximumFractionDigits:4}),o4=()=>{const{usageLog:t,clearUsage:e}=De(s=>({usageLog:s.llmUsageLog,clearUsage:s.clearLlmUsage})),n=t.reduce((s,i)=>s+(i.estimatedCostUsd??0),0);return w.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl shadow-sm p-4 space-y-4",children:[w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsxs("div",{children:[w.jsx("p",{className:"text-sm font-semibold text-slate-900",children:"LLM Usage"}),w.jsx("p",{className:"text-xs text-slate-500",children:" 40  LLM  tokens / cost "})]}),w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsxs("span",{className:"text-xs text-slate-500",children:[" ",A_.format(n)]}),w.jsx("button",{type:"button",onClick:e,disabled:t.length===0,className:"px-2 py-1 text-xs font-semibold rounded-md border border-slate-300 text-slate-700 hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed",children:""})]})]}),t.length===0?w.jsx("p",{className:"text-xs text-slate-500",children:" LLM "}):w.jsx("div",{className:"max-h-64 overflow-y-auto",children:w.jsxs("table",{className:"min-w-full text-xs text-left",children:[w.jsx("thead",{className:"text-slate-500",children:w.jsxs("tr",{children:[w.jsx("th",{className:"pb-2 pr-4 font-medium",children:""}),w.jsx("th",{className:"pb-2 pr-4 font-medium",children:"Context"}),w.jsx("th",{className:"pb-2 pr-4 font-medium",children:"Provider  Model"}),w.jsx("th",{className:"pb-2 pr-4 font-medium",children:"Tokens (in/out/total)"}),w.jsx("th",{className:"pb-2 font-medium",children:"Cost"})]})}),w.jsx("tbody",{className:"text-slate-700",children:t.slice().reverse().map(s=>w.jsxs("tr",{className:"border-t border-slate-100",children:[w.jsx("td",{className:"py-2 pr-4 whitespace-nowrap",children:new Date(s.timestamp).toLocaleTimeString()}),w.jsx("td",{className:"py-2 pr-4",children:s.context}),w.jsxs("td",{className:"py-2 pr-4 whitespace-nowrap",children:[s.provider,"/",s.model]}),w.jsxs("td",{className:"py-2 pr-4 whitespace-nowrap",children:[cp.format(s.promptTokens??0)," /"," ",cp.format(s.completionTokens??0)," /"," ",cp.format(s.totalTokens??(s.promptTokens??0)+(s.completionTokens??0))]}),w.jsx("td",{className:"py-2 whitespace-nowrap",children:s.estimatedCostUsd!=null?A_.format(s.estimatedCostUsd):""})]},s.id))})]})})]})},l4=()=>{const{init:t,currentView:e,csvData:n,isAsideVisible:s,asideWidth:i,isResizing:o,handleAsideMouseDown:u,isDataPrepDebugVisible:d,isSpreadsheetVisible:m,dataPreparationPlan:f,initialDataSample:y}=De(E=>({init:E.init,currentView:E.currentView,csvData:E.csvData,isAsideVisible:E.isAsideVisible,asideWidth:E.asideWidth,isResizing:E.isResizing,handleAsideMouseDown:E.handleAsideMouseDown,isDataPrepDebugVisible:E.isDataPrepDebugVisible,isSpreadsheetVisible:E.isSpreadsheetVisible,dataPreparationPlan:E.dataPreparationPlan,initialDataSample:E.initialDataSample})),S=De(E=>E.setIsAsideVisible),_=De(E=>E.addToast),T=De(E=>E.handleExternalCsvPayload),C=De(E=>E.connectGraphRuntime);re.useEffect(()=>{t()},[t]),re.useEffect(()=>{C()},[C]),re.useEffect(()=>{const E=O=>{!O||typeof O.csv!="string"||T(O).catch(x=>{console.error("Failed to process external CSV payload.",x)})},L=()=>{if(typeof window>"u"||typeof window.__getNextCsvPayload!="function")return;let O;do O=window.__getNextCsvPayload(),O&&E(O);while(O)},B=O=>{E(O.detail||null)};return L(),window.addEventListener("ai-table-csv",B),()=>{window.removeEventListener("ai-table-csv",B)}},[T]),re.useEffect(()=>{if(typeof window>"u")return;const E=()=>{if(!Array.isArray(window.__CSV_AGENT_PENDING_NOTICES__))return;window.__CSV_AGENT_PENDING_NOTICES__.splice(0).forEach(O=>{_(O,"warning",6e3)})},L=B=>{var x;const O=B;(x=O.detail)!=null&&x.message&&_(O.detail.message,"warning",6e3)};return E(),window.addEventListener("ai-table-csv-notice",L),()=>{window.removeEventListener("ai-table-csv-notice",L)}},[_]);const N=()=>e==="file_upload"||!n?w.jsx("div",{className:"flex-grow min-h-0",children:w.jsx(TB,{})}):w.jsxs("div",{className:"flex-grow min-h-0 overflow-y-auto",children:[w.jsx(tB,{}),f&&f.jsFunctionBody&&y&&w.jsx("div",{className:"mt-8",children:w.jsx(zB,{isVisible:d})}),w.jsxs("div",{className:"mt-8 space-y-8",children:[w.jsx(i4,{}),w.jsx(o4,{})]}),w.jsx("div",{className:"mt-8",children:w.jsx(HB,{isVisible:m})})]});return w.jsxs("div",{className:"flex flex-col md:flex-row h-screen bg-slate-50 text-slate-800 font-sans",children:[w.jsx(EB,{}),w.jsx(RB,{}),w.jsx(LB,{}),w.jsx(s4,{}),w.jsxs("main",{className:"flex-1 overflow-hidden p-4 flex flex-col",children:[w.jsx(XB,{}),w.jsx(t4,{}),w.jsx(r4,{}),N()]}),s&&w.jsxs(w.Fragment,{children:[w.jsx("div",{onMouseDown:u,onDoubleClick:()=>S(!1),className:"hidden md:flex group items-center justify-center w-2.5 cursor-col-resize",title:"Drag to resize, double-click to hide",children:w.jsx("div",{className:`w-0.5 h-8 bg-slate-300 rounded-full transition-colors duration-200 group-hover:bg-brand-secondary ${o?"!bg-blue-600":""}`})}),w.jsx("aside",{className:"w-full md:w-auto bg-white flex flex-col h-full border-l border-slate-200",style:{width:i},children:w.jsx("div",{className:"flex-1 overflow-hidden flex flex-col",children:w.jsx(gB,{})})})]})]})},YT=document.getElementById("root");if(!YT)throw new Error("Could not find root element to mount to");const u4=hE.createRoot(YT);u4.render(w.jsx(ws.StrictMode,{children:w.jsx(l4,{})}));export{no as a,dL as b,tq as e,Wp as g,De as u};
