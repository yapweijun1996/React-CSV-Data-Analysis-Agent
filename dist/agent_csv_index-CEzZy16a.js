(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function n(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(r){if(r.ep)return;r.ep=!0;const l=n(r);fetch(r.href,l)}})();function sp(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Bd={exports:{}},Nr={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qy;function Aw(){if(Qy)return Nr;Qy=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(a,r,l){var c=null;if(l!==void 0&&(c=""+l),r.key!==void 0&&(c=""+r.key),"key"in r){l={};for(var f in r)f!=="key"&&(l[f]=r[f])}else l=r;return r=l.ref,{$$typeof:t,type:a,key:c,ref:r!==void 0?r:null,props:l}}return Nr.Fragment=e,Nr.jsx=n,Nr.jsxs=n,Nr}var Wy;function ww(){return Wy||(Wy=1,Bd.exports=Aw()),Bd.exports}var T=ww(),Hd={exports:{}},Ae={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zy;function Cw(){if(Zy)return Ae;Zy=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),c=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),y=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),v=Symbol.for("react.activity"),_=Symbol.iterator;function x(P){return P===null||typeof P!="object"?null:(P=_&&P[_]||P["@@iterator"],typeof P=="function"?P:null)}var w={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},A=Object.assign,C={};function N(P,X,se){this.props=P,this.context=X,this.refs=C,this.updater=se||w}N.prototype.isReactComponent={},N.prototype.setState=function(P,X){if(typeof P!="object"&&typeof P!="function"&&P!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,P,X,"setState")},N.prototype.forceUpdate=function(P){this.updater.enqueueForceUpdate(this,P,"forceUpdate")};function I(){}I.prototype=N.prototype;function R(P,X,se){this.props=P,this.context=X,this.refs=C,this.updater=se||w}var M=R.prototype=new I;M.constructor=R,A(M,N.prototype),M.isPureReactComponent=!0;var z=Array.isArray;function B(){}var k={H:null,A:null,T:null,S:null},W=Object.prototype.hasOwnProperty;function Y(P,X,se){var re=se.ref;return{$$typeof:t,type:P,key:X,ref:re!==void 0?re:null,props:se}}function Z(P,X){return Y(P.type,X,P.props)}function te(P){return typeof P=="object"&&P!==null&&P.$$typeof===t}function L(P){var X={"=":"=0",":":"=2"};return"$"+P.replace(/[=:]/g,function(se){return X[se]})}var ne=/\/+/g;function fe(P,X){return typeof P=="object"&&P!==null&&P.key!=null?L(""+P.key):X.toString(36)}function ae(P){switch(P.status){case"fulfilled":return P.value;case"rejected":throw P.reason;default:switch(typeof P.status=="string"?P.then(B,B):(P.status="pending",P.then(function(X){P.status==="pending"&&(P.status="fulfilled",P.value=X)},function(X){P.status==="pending"&&(P.status="rejected",P.reason=X)})),P.status){case"fulfilled":return P.value;case"rejected":throw P.reason}}throw P}function O(P,X,se,re,ge){var xe=typeof P;(xe==="undefined"||xe==="boolean")&&(P=null);var Te=!1;if(P===null)Te=!0;else switch(xe){case"bigint":case"string":case"number":Te=!0;break;case"object":switch(P.$$typeof){case t:case e:Te=!0;break;case m:return Te=P._init,O(Te(P._payload),X,se,re,ge)}}if(Te)return ge=ge(P),Te=re===""?"."+fe(P,0):re,z(ge)?(se="",Te!=null&&(se=Te.replace(ne,"$&/")+"/"),O(ge,X,se,"",function(wn){return wn})):ge!=null&&(te(ge)&&(ge=Z(ge,se+(ge.key==null||P&&P.key===ge.key?"":(""+ge.key).replace(ne,"$&/")+"/")+Te)),X.push(ge)),1;Te=0;var tt=re===""?".":re+":";if(z(P))for(var Ke=0;Ke<P.length;Ke++)re=P[Ke],xe=tt+fe(re,Ke),Te+=O(re,X,se,xe,ge);else if(Ke=x(P),typeof Ke=="function")for(P=Ke.call(P),Ke=0;!(re=P.next()).done;)re=re.value,xe=tt+fe(re,Ke++),Te+=O(re,X,se,xe,ge);else if(xe==="object"){if(typeof P.then=="function")return O(ae(P),X,se,re,ge);throw X=String(P),Error("Objects are not valid as a React child (found: "+(X==="[object Object]"?"object with keys {"+Object.keys(P).join(", ")+"}":X)+"). If you meant to render a collection of children, use an array instead.")}return Te}function K(P,X,se){if(P==null)return P;var re=[],ge=0;return O(P,re,"","",function(xe){return X.call(se,xe,ge++)}),re}function ee(P){if(P._status===-1){var X=P._result;X=X(),X.then(function(se){(P._status===0||P._status===-1)&&(P._status=1,P._result=se)},function(se){(P._status===0||P._status===-1)&&(P._status=2,P._result=se)}),P._status===-1&&(P._status=0,P._result=X)}if(P._status===1)return P._result.default;throw P._result}var ve=typeof reportError=="function"?reportError:function(P){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var X=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof P=="object"&&P!==null&&typeof P.message=="string"?String(P.message):String(P),error:P});if(!window.dispatchEvent(X))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",P);return}console.error(P)},be={map:K,forEach:function(P,X,se){K(P,function(){X.apply(this,arguments)},se)},count:function(P){var X=0;return K(P,function(){X++}),X},toArray:function(P){return K(P,function(X){return X})||[]},only:function(P){if(!te(P))throw Error("React.Children.only expected to receive a single React element child.");return P}};return Ae.Activity=v,Ae.Children=be,Ae.Component=N,Ae.Fragment=n,Ae.Profiler=r,Ae.PureComponent=R,Ae.StrictMode=a,Ae.Suspense=y,Ae.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=k,Ae.__COMPILER_RUNTIME={__proto__:null,c:function(P){return k.H.useMemoCache(P)}},Ae.cache=function(P){return function(){return P.apply(null,arguments)}},Ae.cacheSignal=function(){return null},Ae.cloneElement=function(P,X,se){if(P==null)throw Error("The argument must be a React element, but you passed "+P+".");var re=A({},P.props),ge=P.key;if(X!=null)for(xe in X.key!==void 0&&(ge=""+X.key),X)!W.call(X,xe)||xe==="key"||xe==="__self"||xe==="__source"||xe==="ref"&&X.ref===void 0||(re[xe]=X[xe]);var xe=arguments.length-2;if(xe===1)re.children=se;else if(1<xe){for(var Te=Array(xe),tt=0;tt<xe;tt++)Te[tt]=arguments[tt+2];re.children=Te}return Y(P.type,ge,re)},Ae.createContext=function(P){return P={$$typeof:c,_currentValue:P,_currentValue2:P,_threadCount:0,Provider:null,Consumer:null},P.Provider=P,P.Consumer={$$typeof:l,_context:P},P},Ae.createElement=function(P,X,se){var re,ge={},xe=null;if(X!=null)for(re in X.key!==void 0&&(xe=""+X.key),X)W.call(X,re)&&re!=="key"&&re!=="__self"&&re!=="__source"&&(ge[re]=X[re]);var Te=arguments.length-2;if(Te===1)ge.children=se;else if(1<Te){for(var tt=Array(Te),Ke=0;Ke<Te;Ke++)tt[Ke]=arguments[Ke+2];ge.children=tt}if(P&&P.defaultProps)for(re in Te=P.defaultProps,Te)ge[re]===void 0&&(ge[re]=Te[re]);return Y(P,xe,ge)},Ae.createRef=function(){return{current:null}},Ae.forwardRef=function(P){return{$$typeof:f,render:P}},Ae.isValidElement=te,Ae.lazy=function(P){return{$$typeof:m,_payload:{_status:-1,_result:P},_init:ee}},Ae.memo=function(P,X){return{$$typeof:p,type:P,compare:X===void 0?null:X}},Ae.startTransition=function(P){var X=k.T,se={};k.T=se;try{var re=P(),ge=k.S;ge!==null&&ge(se,re),typeof re=="object"&&re!==null&&typeof re.then=="function"&&re.then(B,ve)}catch(xe){ve(xe)}finally{X!==null&&se.types!==null&&(X.types=se.types),k.T=X}},Ae.unstable_useCacheRefresh=function(){return k.H.useCacheRefresh()},Ae.use=function(P){return k.H.use(P)},Ae.useActionState=function(P,X,se){return k.H.useActionState(P,X,se)},Ae.useCallback=function(P,X){return k.H.useCallback(P,X)},Ae.useContext=function(P){return k.H.useContext(P)},Ae.useDebugValue=function(){},Ae.useDeferredValue=function(P,X){return k.H.useDeferredValue(P,X)},Ae.useEffect=function(P,X){return k.H.useEffect(P,X)},Ae.useEffectEvent=function(P){return k.H.useEffectEvent(P)},Ae.useId=function(){return k.H.useId()},Ae.useImperativeHandle=function(P,X,se){return k.H.useImperativeHandle(P,X,se)},Ae.useInsertionEffect=function(P,X){return k.H.useInsertionEffect(P,X)},Ae.useLayoutEffect=function(P,X){return k.H.useLayoutEffect(P,X)},Ae.useMemo=function(P,X){return k.H.useMemo(P,X)},Ae.useOptimistic=function(P,X){return k.H.useOptimistic(P,X)},Ae.useReducer=function(P,X,se){return k.H.useReducer(P,X,se)},Ae.useRef=function(P){return k.H.useRef(P)},Ae.useState=function(P){return k.H.useState(P)},Ae.useSyncExternalStore=function(P,X,se){return k.H.useSyncExternalStore(P,X,se)},Ae.useTransition=function(){return k.H.useTransition()},Ae.version="19.2.0",Ae}var e0;function Xr(){return e0||(e0=1,Hd.exports=Cw()),Hd.exports}var ue=Xr();const bn=sp(ue);var Vd={exports:{}},Ir={},Fd={exports:{}},Gd={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var t0;function Ew(){return t0||(t0=1,(function(t){function e(O,K){var ee=O.length;O.push(K);e:for(;0<ee;){var ve=ee-1>>>1,be=O[ve];if(0<r(be,K))O[ve]=K,O[ee]=be,ee=ve;else break e}}function n(O){return O.length===0?null:O[0]}function a(O){if(O.length===0)return null;var K=O[0],ee=O.pop();if(ee!==K){O[0]=ee;e:for(var ve=0,be=O.length,P=be>>>1;ve<P;){var X=2*(ve+1)-1,se=O[X],re=X+1,ge=O[re];if(0>r(se,ee))re<be&&0>r(ge,se)?(O[ve]=ge,O[re]=ee,ve=re):(O[ve]=se,O[X]=ee,ve=X);else if(re<be&&0>r(ge,ee))O[ve]=ge,O[re]=ee,ve=re;else break e}}return K}function r(O,K){var ee=O.sortIndex-K.sortIndex;return ee!==0?ee:O.id-K.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;t.unstable_now=function(){return l.now()}}else{var c=Date,f=c.now();t.unstable_now=function(){return c.now()-f}}var y=[],p=[],m=1,v=null,_=3,x=!1,w=!1,A=!1,C=!1,N=typeof setTimeout=="function"?setTimeout:null,I=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;function M(O){for(var K=n(p);K!==null;){if(K.callback===null)a(p);else if(K.startTime<=O)a(p),K.sortIndex=K.expirationTime,e(y,K);else break;K=n(p)}}function z(O){if(A=!1,M(O),!w)if(n(y)!==null)w=!0,B||(B=!0,L());else{var K=n(p);K!==null&&ae(z,K.startTime-O)}}var B=!1,k=-1,W=5,Y=-1;function Z(){return C?!0:!(t.unstable_now()-Y<W)}function te(){if(C=!1,B){var O=t.unstable_now();Y=O;var K=!0;try{e:{w=!1,A&&(A=!1,I(k),k=-1),x=!0;var ee=_;try{t:{for(M(O),v=n(y);v!==null&&!(v.expirationTime>O&&Z());){var ve=v.callback;if(typeof ve=="function"){v.callback=null,_=v.priorityLevel;var be=ve(v.expirationTime<=O);if(O=t.unstable_now(),typeof be=="function"){v.callback=be,M(O),K=!0;break t}v===n(y)&&a(y),M(O)}else a(y);v=n(y)}if(v!==null)K=!0;else{var P=n(p);P!==null&&ae(z,P.startTime-O),K=!1}}break e}finally{v=null,_=ee,x=!1}K=void 0}}finally{K?L():B=!1}}}var L;if(typeof R=="function")L=function(){R(te)};else if(typeof MessageChannel<"u"){var ne=new MessageChannel,fe=ne.port2;ne.port1.onmessage=te,L=function(){fe.postMessage(null)}}else L=function(){N(te,0)};function ae(O,K){k=N(function(){O(t.unstable_now())},K)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(O){O.callback=null},t.unstable_forceFrameRate=function(O){0>O||125<O?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):W=0<O?Math.floor(1e3/O):5},t.unstable_getCurrentPriorityLevel=function(){return _},t.unstable_next=function(O){switch(_){case 1:case 2:case 3:var K=3;break;default:K=_}var ee=_;_=K;try{return O()}finally{_=ee}},t.unstable_requestPaint=function(){C=!0},t.unstable_runWithPriority=function(O,K){switch(O){case 1:case 2:case 3:case 4:case 5:break;default:O=3}var ee=_;_=O;try{return K()}finally{_=ee}},t.unstable_scheduleCallback=function(O,K,ee){var ve=t.unstable_now();switch(typeof ee=="object"&&ee!==null?(ee=ee.delay,ee=typeof ee=="number"&&0<ee?ve+ee:ve):ee=ve,O){case 1:var be=-1;break;case 2:be=250;break;case 5:be=1073741823;break;case 4:be=1e4;break;default:be=5e3}return be=ee+be,O={id:m++,callback:K,priorityLevel:O,startTime:ee,expirationTime:be,sortIndex:-1},ee>ve?(O.sortIndex=ee,e(p,O),n(y)===null&&O===n(p)&&(A?(I(k),k=-1):A=!0,ae(z,ee-ve))):(O.sortIndex=be,e(y,O),w||x||(w=!0,B||(B=!0,L()))),O},t.unstable_shouldYield=Z,t.unstable_wrapCallback=function(O){var K=_;return function(){var ee=_;_=K;try{return O.apply(this,arguments)}finally{_=ee}}}})(Gd)),Gd}var n0;function Nw(){return n0||(n0=1,Fd.exports=Ew()),Fd.exports}var zd={exports:{}},It={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var s0;function Iw(){if(s0)return It;s0=1;var t=Xr();function e(y){var p="https://react.dev/errors/"+y;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)p+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+y+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var a={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},r=Symbol.for("react.portal");function l(y,p,m){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:v==null?null:""+v,children:y,containerInfo:p,implementation:m}}var c=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function f(y,p){if(y==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return It.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=a,It.createPortal=function(y,p){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(e(299));return l(y,p,null,m)},It.flushSync=function(y){var p=c.T,m=a.p;try{if(c.T=null,a.p=2,y)return y()}finally{c.T=p,a.p=m,a.d.f()}},It.preconnect=function(y,p){typeof y=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,a.d.C(y,p))},It.prefetchDNS=function(y){typeof y=="string"&&a.d.D(y)},It.preinit=function(y,p){if(typeof y=="string"&&p&&typeof p.as=="string"){var m=p.as,v=f(m,p.crossOrigin),_=typeof p.integrity=="string"?p.integrity:void 0,x=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;m==="style"?a.d.S(y,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:v,integrity:_,fetchPriority:x}):m==="script"&&a.d.X(y,{crossOrigin:v,integrity:_,fetchPriority:x,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},It.preinitModule=function(y,p){if(typeof y=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var m=f(p.as,p.crossOrigin);a.d.M(y,{crossOrigin:m,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&a.d.M(y)},It.preload=function(y,p){if(typeof y=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var m=p.as,v=f(m,p.crossOrigin);a.d.L(y,m,{crossOrigin:v,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},It.preloadModule=function(y,p){if(typeof y=="string")if(p){var m=f(p.as,p.crossOrigin);a.d.m(y,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:m,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else a.d.m(y)},It.requestFormReset=function(y){a.d.r(y)},It.unstable_batchedUpdates=function(y,p){return y(p)},It.useFormState=function(y,p,m){return c.H.useFormState(y,p,m)},It.useFormStatus=function(){return c.H.useHostTransitionStatus()},It.version="19.2.0",It}var a0;function Rw(){if(a0)return zd.exports;a0=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),zd.exports=Iw(),zd.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var i0;function Mw(){if(i0)return Ir;i0=1;var t=Nw(),e=Xr(),n=Rw();function a(s){var i="https://react.dev/errors/"+s;if(1<arguments.length){i+="?args[]="+encodeURIComponent(arguments[1]);for(var o=2;o<arguments.length;o++)i+="&args[]="+encodeURIComponent(arguments[o])}return"Minified React error #"+s+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function l(s){var i=s,o=s;if(s.alternate)for(;i.return;)i=i.return;else{s=i;do i=s,(i.flags&4098)!==0&&(o=i.return),s=i.return;while(s)}return i.tag===3?o:null}function c(s){if(s.tag===13){var i=s.memoizedState;if(i===null&&(s=s.alternate,s!==null&&(i=s.memoizedState)),i!==null)return i.dehydrated}return null}function f(s){if(s.tag===31){var i=s.memoizedState;if(i===null&&(s=s.alternate,s!==null&&(i=s.memoizedState)),i!==null)return i.dehydrated}return null}function y(s){if(l(s)!==s)throw Error(a(188))}function p(s){var i=s.alternate;if(!i){if(i=l(s),i===null)throw Error(a(188));return i!==s?null:s}for(var o=s,u=i;;){var g=o.return;if(g===null)break;var S=g.alternate;if(S===null){if(u=g.return,u!==null){o=u;continue}break}if(g.child===S.child){for(S=g.child;S;){if(S===o)return y(g),s;if(S===u)return y(g),i;S=S.sibling}throw Error(a(188))}if(o.return!==u.return)o=g,u=S;else{for(var b=!1,E=g.child;E;){if(E===o){b=!0,o=g,u=S;break}if(E===u){b=!0,u=g,o=S;break}E=E.sibling}if(!b){for(E=S.child;E;){if(E===o){b=!0,o=S,u=g;break}if(E===u){b=!0,u=S,o=g;break}E=E.sibling}if(!b)throw Error(a(189))}}if(o.alternate!==u)throw Error(a(190))}if(o.tag!==3)throw Error(a(188));return o.stateNode.current===o?s:i}function m(s){var i=s.tag;if(i===5||i===26||i===27||i===6)return s;for(s=s.child;s!==null;){if(i=m(s),i!==null)return i;s=s.sibling}return null}var v=Object.assign,_=Symbol.for("react.element"),x=Symbol.for("react.transitional.element"),w=Symbol.for("react.portal"),A=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),N=Symbol.for("react.profiler"),I=Symbol.for("react.consumer"),R=Symbol.for("react.context"),M=Symbol.for("react.forward_ref"),z=Symbol.for("react.suspense"),B=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),W=Symbol.for("react.lazy"),Y=Symbol.for("react.activity"),Z=Symbol.for("react.memo_cache_sentinel"),te=Symbol.iterator;function L(s){return s===null||typeof s!="object"?null:(s=te&&s[te]||s["@@iterator"],typeof s=="function"?s:null)}var ne=Symbol.for("react.client.reference");function fe(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===ne?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case A:return"Fragment";case N:return"Profiler";case C:return"StrictMode";case z:return"Suspense";case B:return"SuspenseList";case Y:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case w:return"Portal";case R:return s.displayName||"Context";case I:return(s._context.displayName||"Context")+".Consumer";case M:var i=s.render;return s=s.displayName,s||(s=i.displayName||i.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case k:return i=s.displayName||null,i!==null?i:fe(s.type)||"Memo";case W:i=s._payload,s=s._init;try{return fe(s(i))}catch{}}return null}var ae=Array.isArray,O=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,K=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ee={pending:!1,data:null,method:null,action:null},ve=[],be=-1;function P(s){return{current:s}}function X(s){0>be||(s.current=ve[be],ve[be]=null,be--)}function se(s,i){be++,ve[be]=s.current,s.current=i}var re=P(null),ge=P(null),xe=P(null),Te=P(null);function tt(s,i){switch(se(xe,i),se(ge,s),se(re,null),i.nodeType){case 9:case 11:s=(s=i.documentElement)&&(s=s.namespaceURI)?_y(s):0;break;default:if(s=i.tagName,i=i.namespaceURI)i=_y(i),s=Ty(i,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}X(re),se(re,s)}function Ke(){X(re),X(ge),X(xe)}function wn(s){s.memoizedState!==null&&se(Te,s);var i=re.current,o=Ty(i,s.type);i!==o&&(se(ge,s),se(re,o))}function he(s){ge.current===s&&(X(re),X(ge)),Te.current===s&&(X(Te),Ar._currentValue=ee)}var qe,Cn;function Ut(s){if(qe===void 0)try{throw Error()}catch(o){var i=o.stack.trim().match(/\n( *(at )?)/);qe=i&&i[1]||"",Cn=-1<o.stack.indexOf(`
    at`)?" (<anonymous>)":-1<o.stack.indexOf("@")?"@unknown:0:0":""}return`
`+qe+s+Cn}var xa=!1;function Un(s,i){if(!s||xa)return"";xa=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var u={DetermineComponentFrameRoot:function(){try{if(i){var Q=function(){throw Error()};if(Object.defineProperty(Q.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Q,[])}catch(G){var F=G}Reflect.construct(s,[],Q)}else{try{Q.call()}catch(G){F=G}s.call(Q.prototype)}}else{try{throw Error()}catch(G){F=G}(Q=s())&&typeof Q.catch=="function"&&Q.catch(function(){})}}catch(G){if(G&&F&&typeof G.stack=="string")return[G.stack,F.stack]}return[null,null]}};u.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var g=Object.getOwnPropertyDescriptor(u.DetermineComponentFrameRoot,"name");g&&g.configurable&&Object.defineProperty(u.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var S=u.DetermineComponentFrameRoot(),b=S[0],E=S[1];if(b&&E){var D=b.split(`
`),V=E.split(`
`);for(g=u=0;u<D.length&&!D[u].includes("DetermineComponentFrameRoot");)u++;for(;g<V.length&&!V[g].includes("DetermineComponentFrameRoot");)g++;if(u===D.length||g===V.length)for(u=D.length-1,g=V.length-1;1<=u&&0<=g&&D[u]!==V[g];)g--;for(;1<=u&&0<=g;u--,g--)if(D[u]!==V[g]){if(u!==1||g!==1)do if(u--,g--,0>g||D[u]!==V[g]){var J=`
`+D[u].replace(" at new "," at ");return s.displayName&&J.includes("<anonymous>")&&(J=J.replace("<anonymous>",s.displayName)),J}while(1<=u&&0<=g);break}}}finally{xa=!1,Error.prepareStackTrace=o}return(o=s?s.displayName||s.name:"")?Ut(o):""}function Aa(s,i){switch(s.tag){case 26:case 27:case 5:return Ut(s.type);case 16:return Ut("Lazy");case 13:return s.child!==i&&i!==null?Ut("Suspense Fallback"):Ut("Suspense");case 19:return Ut("SuspenseList");case 0:case 15:return Un(s.type,!1);case 11:return Un(s.type.render,!1);case 1:return Un(s.type,!0);case 31:return Ut("Activity");default:return""}}function ki(s){try{var i="",o=null;do i+=Aa(s,o),o=s,s=s.return;while(s);return i}catch(u){return`
Error generating stack: `+u.message+`
`+u.stack}}var oe=Object.prototype.hasOwnProperty,Re=t.unstable_scheduleCallback,Dt=t.unstable_cancelCallback,yt=t.unstable_shouldYield,$s=t.unstable_requestPaint,ce=t.unstable_now,lt=t.unstable_getCurrentPriorityLevel,nn=t.unstable_ImmediatePriority,Ys=t.unstable_UserBlockingPriority,Js=t.unstable_NormalPriority,Ui=t.unstable_LowPriority,ao=t.unstable_IdlePriority,Cu=t.log,io=t.unstable_setDisableYieldValue,Ks=null,Pt=null;function En(s){if(typeof Cu=="function"&&io(s),Pt&&typeof Pt.setStrictMode=="function")try{Pt.setStrictMode(Ks,s)}catch{}}var Lt=Math.clz32?Math.clz32:cx,Nt=Math.log,ux=Math.LN2;function cx(s){return s>>>=0,s===0?32:31-(Nt(s)/ux|0)|0}var ro=256,oo=262144,lo=4194304;function js(s){var i=s&42;if(i!==0)return i;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return s&261888;case 262144:case 524288:case 1048576:case 2097152:return s&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function uo(s,i,o){var u=s.pendingLanes;if(u===0)return 0;var g=0,S=s.suspendedLanes,b=s.pingedLanes;s=s.warmLanes;var E=u&134217727;return E!==0?(u=E&~S,u!==0?g=js(u):(b&=E,b!==0?g=js(b):o||(o=E&~s,o!==0&&(g=js(o))))):(E=u&~S,E!==0?g=js(E):b!==0?g=js(b):o||(o=u&~s,o!==0&&(g=js(o)))),g===0?0:i!==0&&i!==g&&(i&S)===0&&(S=g&-g,o=i&-i,S>=o||S===32&&(o&4194048)!==0)?i:g}function Oi(s,i){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&i)===0}function dx(s,i){switch(s){case 1:case 2:case 4:case 8:case 64:return i+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function tm(){var s=lo;return lo<<=1,(lo&62914560)===0&&(lo=4194304),s}function Eu(s){for(var i=[],o=0;31>o;o++)i.push(s);return i}function qi(s,i){s.pendingLanes|=i,i!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function fx(s,i,o,u,g,S){var b=s.pendingLanes;s.pendingLanes=o,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=o,s.entangledLanes&=o,s.errorRecoveryDisabledLanes&=o,s.shellSuspendCounter=0;var E=s.entanglements,D=s.expirationTimes,V=s.hiddenUpdates;for(o=b&~o;0<o;){var J=31-Lt(o),Q=1<<J;E[J]=0,D[J]=-1;var F=V[J];if(F!==null)for(V[J]=null,J=0;J<F.length;J++){var G=F[J];G!==null&&(G.lane&=-536870913)}o&=~Q}u!==0&&nm(s,u,0),S!==0&&g===0&&s.tag!==0&&(s.suspendedLanes|=S&~(b&~i))}function nm(s,i,o){s.pendingLanes|=i,s.suspendedLanes&=~i;var u=31-Lt(i);s.entangledLanes|=i,s.entanglements[u]=s.entanglements[u]|1073741824|o&261930}function sm(s,i){var o=s.entangledLanes|=i;for(s=s.entanglements;o;){var u=31-Lt(o),g=1<<u;g&i|s[u]&i&&(s[u]|=i),o&=~g}}function am(s,i){var o=i&-i;return o=(o&42)!==0?1:Nu(o),(o&(s.suspendedLanes|i))!==0?0:o}function Nu(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function Iu(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function im(){var s=K.p;return s!==0?s:(s=window.event,s===void 0?32:zy(s.type))}function rm(s,i){var o=K.p;try{return K.p=s,i()}finally{K.p=o}}var ds=Math.random().toString(36).slice(2),Tt="__reactFiber$"+ds,Ot="__reactProps$"+ds,wa="__reactContainer$"+ds,Ru="__reactEvents$"+ds,px="__reactListeners$"+ds,mx="__reactHandles$"+ds,om="__reactResources$"+ds,Bi="__reactMarker$"+ds;function Mu(s){delete s[Tt],delete s[Ot],delete s[Ru],delete s[px],delete s[mx]}function Ca(s){var i=s[Tt];if(i)return i;for(var o=s.parentNode;o;){if(i=o[wa]||o[Tt]){if(o=i.alternate,i.child!==null||o!==null&&o.child!==null)for(s=Ny(s);s!==null;){if(o=s[Tt])return o;s=Ny(s)}return i}s=o,o=s.parentNode}return null}function Ea(s){if(s=s[Tt]||s[wa]){var i=s.tag;if(i===5||i===6||i===13||i===31||i===26||i===27||i===3)return s}return null}function Hi(s){var i=s.tag;if(i===5||i===26||i===27||i===6)return s.stateNode;throw Error(a(33))}function Na(s){var i=s[om];return i||(i=s[om]={hoistableStyles:new Map,hoistableScripts:new Map}),i}function vt(s){s[Bi]=!0}var lm=new Set,um={};function Xs(s,i){Ia(s,i),Ia(s+"Capture",i)}function Ia(s,i){for(um[s]=i,s=0;s<i.length;s++)lm.add(i[s])}var hx=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),cm={},dm={};function gx(s){return oe.call(dm,s)?!0:oe.call(cm,s)?!1:hx.test(s)?dm[s]=!0:(cm[s]=!0,!1)}function co(s,i,o){if(gx(i))if(o===null)s.removeAttribute(i);else{switch(typeof o){case"undefined":case"function":case"symbol":s.removeAttribute(i);return;case"boolean":var u=i.toLowerCase().slice(0,5);if(u!=="data-"&&u!=="aria-"){s.removeAttribute(i);return}}s.setAttribute(i,""+o)}}function fo(s,i,o){if(o===null)s.removeAttribute(i);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(i);return}s.setAttribute(i,""+o)}}function On(s,i,o,u){if(u===null)s.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(o);return}s.setAttributeNS(i,o,""+u)}}function sn(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function fm(s){var i=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function yx(s,i,o){var u=Object.getOwnPropertyDescriptor(s.constructor.prototype,i);if(!s.hasOwnProperty(i)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var g=u.get,S=u.set;return Object.defineProperty(s,i,{configurable:!0,get:function(){return g.call(this)},set:function(b){o=""+b,S.call(this,b)}}),Object.defineProperty(s,i,{enumerable:u.enumerable}),{getValue:function(){return o},setValue:function(b){o=""+b},stopTracking:function(){s._valueTracker=null,delete s[i]}}}}function Du(s){if(!s._valueTracker){var i=fm(s)?"checked":"value";s._valueTracker=yx(s,i,""+s[i])}}function pm(s){if(!s)return!1;var i=s._valueTracker;if(!i)return!0;var o=i.getValue(),u="";return s&&(u=fm(s)?s.checked?"true":"false":s.value),s=u,s!==o?(i.setValue(s),!0):!1}function po(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var vx=/[\n"\\]/g;function an(s){return s.replace(vx,function(i){return"\\"+i.charCodeAt(0).toString(16)+" "})}function Pu(s,i,o,u,g,S,b,E){s.name="",b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"?s.type=b:s.removeAttribute("type"),i!=null?b==="number"?(i===0&&s.value===""||s.value!=i)&&(s.value=""+sn(i)):s.value!==""+sn(i)&&(s.value=""+sn(i)):b!=="submit"&&b!=="reset"||s.removeAttribute("value"),i!=null?Lu(s,b,sn(i)):o!=null?Lu(s,b,sn(o)):u!=null&&s.removeAttribute("value"),g==null&&S!=null&&(s.defaultChecked=!!S),g!=null&&(s.checked=g&&typeof g!="function"&&typeof g!="symbol"),E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"?s.name=""+sn(E):s.removeAttribute("name")}function mm(s,i,o,u,g,S,b,E){if(S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"&&(s.type=S),i!=null||o!=null){if(!(S!=="submit"&&S!=="reset"||i!=null)){Du(s);return}o=o!=null?""+sn(o):"",i=i!=null?""+sn(i):o,E||i===s.value||(s.value=i),s.defaultValue=i}u=u??g,u=typeof u!="function"&&typeof u!="symbol"&&!!u,s.checked=E?s.checked:!!u,s.defaultChecked=!!u,b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(s.name=b),Du(s)}function Lu(s,i,o){i==="number"&&po(s.ownerDocument)===s||s.defaultValue===""+o||(s.defaultValue=""+o)}function Ra(s,i,o,u){if(s=s.options,i){i={};for(var g=0;g<o.length;g++)i["$"+o[g]]=!0;for(o=0;o<s.length;o++)g=i.hasOwnProperty("$"+s[o].value),s[o].selected!==g&&(s[o].selected=g),g&&u&&(s[o].defaultSelected=!0)}else{for(o=""+sn(o),i=null,g=0;g<s.length;g++){if(s[g].value===o){s[g].selected=!0,u&&(s[g].defaultSelected=!0);return}i!==null||s[g].disabled||(i=s[g])}i!==null&&(i.selected=!0)}}function hm(s,i,o){if(i!=null&&(i=""+sn(i),i!==s.value&&(s.value=i),o==null)){s.defaultValue!==i&&(s.defaultValue=i);return}s.defaultValue=o!=null?""+sn(o):""}function gm(s,i,o,u){if(i==null){if(u!=null){if(o!=null)throw Error(a(92));if(ae(u)){if(1<u.length)throw Error(a(93));u=u[0]}o=u}o==null&&(o=""),i=o}o=sn(i),s.defaultValue=o,u=s.textContent,u===o&&u!==""&&u!==null&&(s.value=u),Du(s)}function Ma(s,i){if(i){var o=s.firstChild;if(o&&o===s.lastChild&&o.nodeType===3){o.nodeValue=i;return}}s.textContent=i}var Sx=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function ym(s,i,o){var u=i.indexOf("--")===0;o==null||typeof o=="boolean"||o===""?u?s.setProperty(i,""):i==="float"?s.cssFloat="":s[i]="":u?s.setProperty(i,o):typeof o!="number"||o===0||Sx.has(i)?i==="float"?s.cssFloat=o:s[i]=(""+o).trim():s[i]=o+"px"}function vm(s,i,o){if(i!=null&&typeof i!="object")throw Error(a(62));if(s=s.style,o!=null){for(var u in o)!o.hasOwnProperty(u)||i!=null&&i.hasOwnProperty(u)||(u.indexOf("--")===0?s.setProperty(u,""):u==="float"?s.cssFloat="":s[u]="");for(var g in i)u=i[g],i.hasOwnProperty(g)&&o[g]!==u&&ym(s,g,u)}else for(var S in i)i.hasOwnProperty(S)&&ym(s,S,i[S])}function ku(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _x=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Tx=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function mo(s){return Tx.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}function qn(){}var Uu=null;function Ou(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Da=null,Pa=null;function Sm(s){var i=Ea(s);if(i&&(s=i.stateNode)){var o=s[Ot]||null;e:switch(s=i.stateNode,i.type){case"input":if(Pu(s,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name),i=o.name,o.type==="radio"&&i!=null){for(o=s;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll('input[name="'+an(""+i)+'"][type="radio"]'),i=0;i<o.length;i++){var u=o[i];if(u!==s&&u.form===s.form){var g=u[Ot]||null;if(!g)throw Error(a(90));Pu(u,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name)}}for(i=0;i<o.length;i++)u=o[i],u.form===s.form&&pm(u)}break e;case"textarea":hm(s,o.value,o.defaultValue);break e;case"select":i=o.value,i!=null&&Ra(s,!!o.multiple,i,!1)}}}var qu=!1;function _m(s,i,o){if(qu)return s(i,o);qu=!0;try{var u=s(i);return u}finally{if(qu=!1,(Da!==null||Pa!==null)&&(tl(),Da&&(i=Da,s=Pa,Pa=Da=null,Sm(i),s)))for(i=0;i<s.length;i++)Sm(s[i])}}function Vi(s,i){var o=s.stateNode;if(o===null)return null;var u=o[Ot]||null;if(u===null)return null;o=u[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(u=!u.disabled)||(s=s.type,u=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!u;break e;default:s=!1}if(s)return null;if(o&&typeof o!="function")throw Error(a(231,i,typeof o));return o}var Bn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Bu=!1;if(Bn)try{var Fi={};Object.defineProperty(Fi,"passive",{get:function(){Bu=!0}}),window.addEventListener("test",Fi,Fi),window.removeEventListener("test",Fi,Fi)}catch{Bu=!1}var fs=null,Hu=null,ho=null;function Tm(){if(ho)return ho;var s,i=Hu,o=i.length,u,g="value"in fs?fs.value:fs.textContent,S=g.length;for(s=0;s<o&&i[s]===g[s];s++);var b=o-s;for(u=1;u<=b&&i[o-u]===g[S-u];u++);return ho=g.slice(s,1<u?1-u:void 0)}function go(s){var i=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&i===13&&(s=13)):s=i,s===10&&(s=13),32<=s||s===13?s:0}function yo(){return!0}function bm(){return!1}function qt(s){function i(o,u,g,S,b){this._reactName=o,this._targetInst=g,this.type=u,this.nativeEvent=S,this.target=b,this.currentTarget=null;for(var E in s)s.hasOwnProperty(E)&&(o=s[E],this[E]=o?o(S):S[E]);return this.isDefaultPrevented=(S.defaultPrevented!=null?S.defaultPrevented:S.returnValue===!1)?yo:bm,this.isPropagationStopped=bm,this}return v(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=yo)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=yo)},persist:function(){},isPersistent:yo}),i}var Qs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},vo=qt(Qs),Gi=v({},Qs,{view:0,detail:0}),bx=qt(Gi),Vu,Fu,zi,So=v({},Gi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zu,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==zi&&(zi&&s.type==="mousemove"?(Vu=s.screenX-zi.screenX,Fu=s.screenY-zi.screenY):Fu=Vu=0,zi=s),Vu)},movementY:function(s){return"movementY"in s?s.movementY:Fu}}),xm=qt(So),xx=v({},So,{dataTransfer:0}),Ax=qt(xx),wx=v({},Gi,{relatedTarget:0}),Gu=qt(wx),Cx=v({},Qs,{animationName:0,elapsedTime:0,pseudoElement:0}),Ex=qt(Cx),Nx=v({},Qs,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),Ix=qt(Nx),Rx=v({},Qs,{data:0}),Am=qt(Rx),Mx={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Dx={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Px={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Lx(s){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(s):(s=Px[s])?!!i[s]:!1}function zu(){return Lx}var kx=v({},Gi,{key:function(s){if(s.key){var i=Mx[s.key]||s.key;if(i!=="Unidentified")return i}return s.type==="keypress"?(s=go(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?Dx[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zu,charCode:function(s){return s.type==="keypress"?go(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?go(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),Ux=qt(kx),Ox=v({},So,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),wm=qt(Ox),qx=v({},Gi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zu}),Bx=qt(qx),Hx=v({},Qs,{propertyName:0,elapsedTime:0,pseudoElement:0}),Vx=qt(Hx),Fx=v({},So,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),Gx=qt(Fx),zx=v({},Qs,{newState:0,oldState:0}),$x=qt(zx),Yx=[9,13,27,32],$u=Bn&&"CompositionEvent"in window,$i=null;Bn&&"documentMode"in document&&($i=document.documentMode);var Jx=Bn&&"TextEvent"in window&&!$i,Cm=Bn&&(!$u||$i&&8<$i&&11>=$i),Em=" ",Nm=!1;function Im(s,i){switch(s){case"keyup":return Yx.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Rm(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var La=!1;function Kx(s,i){switch(s){case"compositionend":return Rm(i);case"keypress":return i.which!==32?null:(Nm=!0,Em);case"textInput":return s=i.data,s===Em&&Nm?null:s;default:return null}}function jx(s,i){if(La)return s==="compositionend"||!$u&&Im(s,i)?(s=Tm(),ho=Hu=fs=null,La=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return Cm&&i.locale!=="ko"?null:i.data;default:return null}}var Xx={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Mm(s){var i=s&&s.nodeName&&s.nodeName.toLowerCase();return i==="input"?!!Xx[s.type]:i==="textarea"}function Dm(s,i,o,u){Da?Pa?Pa.push(u):Pa=[u]:Da=u,i=ll(i,"onChange"),0<i.length&&(o=new vo("onChange","change",null,o,u),s.push({event:o,listeners:i}))}var Yi=null,Ji=null;function Qx(s){my(s,0)}function _o(s){var i=Hi(s);if(pm(i))return s}function Pm(s,i){if(s==="change")return i}var Lm=!1;if(Bn){var Yu;if(Bn){var Ju="oninput"in document;if(!Ju){var km=document.createElement("div");km.setAttribute("oninput","return;"),Ju=typeof km.oninput=="function"}Yu=Ju}else Yu=!1;Lm=Yu&&(!document.documentMode||9<document.documentMode)}function Um(){Yi&&(Yi.detachEvent("onpropertychange",Om),Ji=Yi=null)}function Om(s){if(s.propertyName==="value"&&_o(Ji)){var i=[];Dm(i,Ji,s,Ou(s)),_m(Qx,i)}}function Wx(s,i,o){s==="focusin"?(Um(),Yi=i,Ji=o,Yi.attachEvent("onpropertychange",Om)):s==="focusout"&&Um()}function Zx(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return _o(Ji)}function eA(s,i){if(s==="click")return _o(i)}function tA(s,i){if(s==="input"||s==="change")return _o(i)}function nA(s,i){return s===i&&(s!==0||1/s===1/i)||s!==s&&i!==i}var Yt=typeof Object.is=="function"?Object.is:nA;function Ki(s,i){if(Yt(s,i))return!0;if(typeof s!="object"||s===null||typeof i!="object"||i===null)return!1;var o=Object.keys(s),u=Object.keys(i);if(o.length!==u.length)return!1;for(u=0;u<o.length;u++){var g=o[u];if(!oe.call(i,g)||!Yt(s[g],i[g]))return!1}return!0}function qm(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function Bm(s,i){var o=qm(s);s=0;for(var u;o;){if(o.nodeType===3){if(u=s+o.textContent.length,s<=i&&u>=i)return{node:o,offset:i-s};s=u}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=qm(o)}}function Hm(s,i){return s&&i?s===i?!0:s&&s.nodeType===3?!1:i&&i.nodeType===3?Hm(s,i.parentNode):"contains"in s?s.contains(i):s.compareDocumentPosition?!!(s.compareDocumentPosition(i)&16):!1:!1}function Vm(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var i=po(s.document);i instanceof s.HTMLIFrameElement;){try{var o=typeof i.contentWindow.location.href=="string"}catch{o=!1}if(o)s=i.contentWindow;else break;i=po(s.document)}return i}function Ku(s){var i=s&&s.nodeName&&s.nodeName.toLowerCase();return i&&(i==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||i==="textarea"||s.contentEditable==="true")}var sA=Bn&&"documentMode"in document&&11>=document.documentMode,ka=null,ju=null,ji=null,Xu=!1;function Fm(s,i,o){var u=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;Xu||ka==null||ka!==po(u)||(u=ka,"selectionStart"in u&&Ku(u)?u={start:u.selectionStart,end:u.selectionEnd}:(u=(u.ownerDocument&&u.ownerDocument.defaultView||window).getSelection(),u={anchorNode:u.anchorNode,anchorOffset:u.anchorOffset,focusNode:u.focusNode,focusOffset:u.focusOffset}),ji&&Ki(ji,u)||(ji=u,u=ll(ju,"onSelect"),0<u.length&&(i=new vo("onSelect","select",null,i,o),s.push({event:i,listeners:u}),i.target=ka)))}function Ws(s,i){var o={};return o[s.toLowerCase()]=i.toLowerCase(),o["Webkit"+s]="webkit"+i,o["Moz"+s]="moz"+i,o}var Ua={animationend:Ws("Animation","AnimationEnd"),animationiteration:Ws("Animation","AnimationIteration"),animationstart:Ws("Animation","AnimationStart"),transitionrun:Ws("Transition","TransitionRun"),transitionstart:Ws("Transition","TransitionStart"),transitioncancel:Ws("Transition","TransitionCancel"),transitionend:Ws("Transition","TransitionEnd")},Qu={},Gm={};Bn&&(Gm=document.createElement("div").style,"AnimationEvent"in window||(delete Ua.animationend.animation,delete Ua.animationiteration.animation,delete Ua.animationstart.animation),"TransitionEvent"in window||delete Ua.transitionend.transition);function Zs(s){if(Qu[s])return Qu[s];if(!Ua[s])return s;var i=Ua[s],o;for(o in i)if(i.hasOwnProperty(o)&&o in Gm)return Qu[s]=i[o];return s}var zm=Zs("animationend"),$m=Zs("animationiteration"),Ym=Zs("animationstart"),aA=Zs("transitionrun"),iA=Zs("transitionstart"),rA=Zs("transitioncancel"),Jm=Zs("transitionend"),Km=new Map,Wu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Wu.push("scrollEnd");function yn(s,i){Km.set(s,i),Xs(i,[s])}var To=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var i=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(i))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},rn=[],Oa=0,Zu=0;function bo(){for(var s=Oa,i=Zu=Oa=0;i<s;){var o=rn[i];rn[i++]=null;var u=rn[i];rn[i++]=null;var g=rn[i];rn[i++]=null;var S=rn[i];if(rn[i++]=null,u!==null&&g!==null){var b=u.pending;b===null?g.next=g:(g.next=b.next,b.next=g),u.pending=g}S!==0&&jm(o,g,S)}}function xo(s,i,o,u){rn[Oa++]=s,rn[Oa++]=i,rn[Oa++]=o,rn[Oa++]=u,Zu|=u,s.lanes|=u,s=s.alternate,s!==null&&(s.lanes|=u)}function ec(s,i,o,u){return xo(s,i,o,u),Ao(s)}function ea(s,i){return xo(s,null,null,i),Ao(s)}function jm(s,i,o){s.lanes|=o;var u=s.alternate;u!==null&&(u.lanes|=o);for(var g=!1,S=s.return;S!==null;)S.childLanes|=o,u=S.alternate,u!==null&&(u.childLanes|=o),S.tag===22&&(s=S.stateNode,s===null||s._visibility&1||(g=!0)),s=S,S=S.return;return s.tag===3?(S=s.stateNode,g&&i!==null&&(g=31-Lt(o),s=S.hiddenUpdates,u=s[g],u===null?s[g]=[i]:u.push(i),i.lane=o|536870912),S):null}function Ao(s){if(50<yr)throw yr=0,ud=null,Error(a(185));for(var i=s.return;i!==null;)s=i,i=s.return;return s.tag===3?s.stateNode:null}var qa={};function oA(s,i,o,u){this.tag=s,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=u,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Jt(s,i,o,u){return new oA(s,i,o,u)}function tc(s){return s=s.prototype,!(!s||!s.isReactComponent)}function Hn(s,i){var o=s.alternate;return o===null?(o=Jt(s.tag,i,s.key,s.mode),o.elementType=s.elementType,o.type=s.type,o.stateNode=s.stateNode,o.alternate=s,s.alternate=o):(o.pendingProps=i,o.type=s.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=s.flags&65011712,o.childLanes=s.childLanes,o.lanes=s.lanes,o.child=s.child,o.memoizedProps=s.memoizedProps,o.memoizedState=s.memoizedState,o.updateQueue=s.updateQueue,i=s.dependencies,o.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},o.sibling=s.sibling,o.index=s.index,o.ref=s.ref,o.refCleanup=s.refCleanup,o}function Xm(s,i){s.flags&=65011714;var o=s.alternate;return o===null?(s.childLanes=0,s.lanes=i,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,i=o.dependencies,s.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),s}function wo(s,i,o,u,g,S){var b=0;if(u=s,typeof s=="function")tc(s)&&(b=1);else if(typeof s=="string")b=fw(s,o,re.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case Y:return s=Jt(31,o,i,g),s.elementType=Y,s.lanes=S,s;case A:return ta(o.children,g,S,i);case C:b=8,g|=24;break;case N:return s=Jt(12,o,i,g|2),s.elementType=N,s.lanes=S,s;case z:return s=Jt(13,o,i,g),s.elementType=z,s.lanes=S,s;case B:return s=Jt(19,o,i,g),s.elementType=B,s.lanes=S,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case R:b=10;break e;case I:b=9;break e;case M:b=11;break e;case k:b=14;break e;case W:b=16,u=null;break e}b=29,o=Error(a(130,s===null?"null":typeof s,"")),u=null}return i=Jt(b,o,i,g),i.elementType=s,i.type=u,i.lanes=S,i}function ta(s,i,o,u){return s=Jt(7,s,u,i),s.lanes=o,s}function nc(s,i,o){return s=Jt(6,s,null,i),s.lanes=o,s}function Qm(s){var i=Jt(18,null,null,0);return i.stateNode=s,i}function sc(s,i,o){return i=Jt(4,s.children!==null?s.children:[],s.key,i),i.lanes=o,i.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},i}var Wm=new WeakMap;function on(s,i){if(typeof s=="object"&&s!==null){var o=Wm.get(s);return o!==void 0?o:(i={value:s,source:i,stack:ki(i)},Wm.set(s,i),i)}return{value:s,source:i,stack:ki(i)}}var Ba=[],Ha=0,Co=null,Xi=0,ln=[],un=0,ps=null,Nn=1,In="";function Vn(s,i){Ba[Ha++]=Xi,Ba[Ha++]=Co,Co=s,Xi=i}function Zm(s,i,o){ln[un++]=Nn,ln[un++]=In,ln[un++]=ps,ps=s;var u=Nn;s=In;var g=32-Lt(u)-1;u&=~(1<<g),o+=1;var S=32-Lt(i)+g;if(30<S){var b=g-g%5;S=(u&(1<<b)-1).toString(32),u>>=b,g-=b,Nn=1<<32-Lt(i)+g|o<<g|u,In=S+s}else Nn=1<<S|o<<g|u,In=s}function ac(s){s.return!==null&&(Vn(s,1),Zm(s,1,0))}function ic(s){for(;s===Co;)Co=Ba[--Ha],Ba[Ha]=null,Xi=Ba[--Ha],Ba[Ha]=null;for(;s===ps;)ps=ln[--un],ln[un]=null,In=ln[--un],ln[un]=null,Nn=ln[--un],ln[un]=null}function eh(s,i){ln[un++]=Nn,ln[un++]=In,ln[un++]=ps,Nn=i.id,In=i.overflow,ps=s}var bt=null,je=null,Pe=!1,ms=null,cn=!1,rc=Error(a(519));function hs(s){var i=Error(a(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Qi(on(i,s)),rc}function th(s){var i=s.stateNode,o=s.type,u=s.memoizedProps;switch(i[Tt]=s,i[Ot]=u,o){case"dialog":Ie("cancel",i),Ie("close",i);break;case"iframe":case"object":case"embed":Ie("load",i);break;case"video":case"audio":for(o=0;o<Sr.length;o++)Ie(Sr[o],i);break;case"source":Ie("error",i);break;case"img":case"image":case"link":Ie("error",i),Ie("load",i);break;case"details":Ie("toggle",i);break;case"input":Ie("invalid",i),mm(i,u.value,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name,!0);break;case"select":Ie("invalid",i);break;case"textarea":Ie("invalid",i),gm(i,u.value,u.defaultValue,u.children)}o=u.children,typeof o!="string"&&typeof o!="number"&&typeof o!="bigint"||i.textContent===""+o||u.suppressHydrationWarning===!0||vy(i.textContent,o)?(u.popover!=null&&(Ie("beforetoggle",i),Ie("toggle",i)),u.onScroll!=null&&Ie("scroll",i),u.onScrollEnd!=null&&Ie("scrollend",i),u.onClick!=null&&(i.onclick=qn),i=!0):i=!1,i||hs(s,!0)}function nh(s){for(bt=s.return;bt;)switch(bt.tag){case 5:case 31:case 13:cn=!1;return;case 27:case 3:cn=!0;return;default:bt=bt.return}}function Va(s){if(s!==bt)return!1;if(!Pe)return nh(s),Pe=!0,!1;var i=s.tag,o;if((o=i!==3&&i!==27)&&((o=i===5)&&(o=s.type,o=!(o!=="form"&&o!=="button")||Ad(s.type,s.memoizedProps)),o=!o),o&&je&&hs(s),nh(s),i===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(a(317));je=Ey(s)}else if(i===31){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(a(317));je=Ey(s)}else i===27?(i=je,Is(s.type)?(s=Id,Id=null,je=s):je=i):je=bt?fn(s.stateNode.nextSibling):null;return!0}function na(){je=bt=null,Pe=!1}function oc(){var s=ms;return s!==null&&(Ft===null?Ft=s:Ft.push.apply(Ft,s),ms=null),s}function Qi(s){ms===null?ms=[s]:ms.push(s)}var lc=P(null),sa=null,Fn=null;function gs(s,i,o){se(lc,i._currentValue),i._currentValue=o}function Gn(s){s._currentValue=lc.current,X(lc)}function uc(s,i,o){for(;s!==null;){var u=s.alternate;if((s.childLanes&i)!==i?(s.childLanes|=i,u!==null&&(u.childLanes|=i)):u!==null&&(u.childLanes&i)!==i&&(u.childLanes|=i),s===o)break;s=s.return}}function cc(s,i,o,u){var g=s.child;for(g!==null&&(g.return=s);g!==null;){var S=g.dependencies;if(S!==null){var b=g.child;S=S.firstContext;e:for(;S!==null;){var E=S;S=g;for(var D=0;D<i.length;D++)if(E.context===i[D]){S.lanes|=o,E=S.alternate,E!==null&&(E.lanes|=o),uc(S.return,o,s),u||(b=null);break e}S=E.next}}else if(g.tag===18){if(b=g.return,b===null)throw Error(a(341));b.lanes|=o,S=b.alternate,S!==null&&(S.lanes|=o),uc(b,o,s),b=null}else b=g.child;if(b!==null)b.return=g;else for(b=g;b!==null;){if(b===s){b=null;break}if(g=b.sibling,g!==null){g.return=b.return,b=g;break}b=b.return}g=b}}function Fa(s,i,o,u){s=null;for(var g=i,S=!1;g!==null;){if(!S){if((g.flags&524288)!==0)S=!0;else if((g.flags&262144)!==0)break}if(g.tag===10){var b=g.alternate;if(b===null)throw Error(a(387));if(b=b.memoizedProps,b!==null){var E=g.type;Yt(g.pendingProps.value,b.value)||(s!==null?s.push(E):s=[E])}}else if(g===Te.current){if(b=g.alternate,b===null)throw Error(a(387));b.memoizedState.memoizedState!==g.memoizedState.memoizedState&&(s!==null?s.push(Ar):s=[Ar])}g=g.return}s!==null&&cc(i,s,o,u),i.flags|=262144}function Eo(s){for(s=s.firstContext;s!==null;){if(!Yt(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function aa(s){sa=s,Fn=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function xt(s){return sh(sa,s)}function No(s,i){return sa===null&&aa(s),sh(s,i)}function sh(s,i){var o=i._currentValue;if(i={context:i,memoizedValue:o,next:null},Fn===null){if(s===null)throw Error(a(308));Fn=i,s.dependencies={lanes:0,firstContext:i},s.flags|=524288}else Fn=Fn.next=i;return o}var lA=typeof AbortController<"u"?AbortController:function(){var s=[],i=this.signal={aborted:!1,addEventListener:function(o,u){s.push(u)}};this.abort=function(){i.aborted=!0,s.forEach(function(o){return o()})}},uA=t.unstable_scheduleCallback,cA=t.unstable_NormalPriority,ut={$$typeof:R,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function dc(){return{controller:new lA,data:new Map,refCount:0}}function Wi(s){s.refCount--,s.refCount===0&&uA(cA,function(){s.controller.abort()})}var Zi=null,fc=0,Ga=0,za=null;function dA(s,i){if(Zi===null){var o=Zi=[];fc=0,Ga=hd(),za={status:"pending",value:void 0,then:function(u){o.push(u)}}}return fc++,i.then(ah,ah),i}function ah(){if(--fc===0&&Zi!==null){za!==null&&(za.status="fulfilled");var s=Zi;Zi=null,Ga=0,za=null;for(var i=0;i<s.length;i++)(0,s[i])()}}function fA(s,i){var o=[],u={status:"pending",value:null,reason:null,then:function(g){o.push(g)}};return s.then(function(){u.status="fulfilled",u.value=i;for(var g=0;g<o.length;g++)(0,o[g])(i)},function(g){for(u.status="rejected",u.reason=g,g=0;g<o.length;g++)(0,o[g])(void 0)}),u}var ih=O.S;O.S=function(s,i){Fg=ce(),typeof i=="object"&&i!==null&&typeof i.then=="function"&&dA(s,i),ih!==null&&ih(s,i)};var ia=P(null);function pc(){var s=ia.current;return s!==null?s:Je.pooledCache}function Io(s,i){i===null?se(ia,ia.current):se(ia,i.pool)}function rh(){var s=pc();return s===null?null:{parent:ut._currentValue,pool:s}}var $a=Error(a(460)),mc=Error(a(474)),Ro=Error(a(542)),Mo={then:function(){}};function oh(s){return s=s.status,s==="fulfilled"||s==="rejected"}function lh(s,i,o){switch(o=s[o],o===void 0?s.push(i):o!==i&&(i.then(qn,qn),i=o),i.status){case"fulfilled":return i.value;case"rejected":throw s=i.reason,ch(s),s;default:if(typeof i.status=="string")i.then(qn,qn);else{if(s=Je,s!==null&&100<s.shellSuspendCounter)throw Error(a(482));s=i,s.status="pending",s.then(function(u){if(i.status==="pending"){var g=i;g.status="fulfilled",g.value=u}},function(u){if(i.status==="pending"){var g=i;g.status="rejected",g.reason=u}})}switch(i.status){case"fulfilled":return i.value;case"rejected":throw s=i.reason,ch(s),s}throw oa=i,$a}}function ra(s){try{var i=s._init;return i(s._payload)}catch(o){throw o!==null&&typeof o=="object"&&typeof o.then=="function"?(oa=o,$a):o}}var oa=null;function uh(){if(oa===null)throw Error(a(459));var s=oa;return oa=null,s}function ch(s){if(s===$a||s===Ro)throw Error(a(483))}var Ya=null,er=0;function Do(s){var i=er;return er+=1,Ya===null&&(Ya=[]),lh(Ya,s,i)}function tr(s,i){i=i.props.ref,s.ref=i!==void 0?i:null}function Po(s,i){throw i.$$typeof===_?Error(a(525)):(s=Object.prototype.toString.call(i),Error(a(31,s==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":s)))}function dh(s){function i(q,U){if(s){var H=q.deletions;H===null?(q.deletions=[U],q.flags|=16):H.push(U)}}function o(q,U){if(!s)return null;for(;U!==null;)i(q,U),U=U.sibling;return null}function u(q){for(var U=new Map;q!==null;)q.key!==null?U.set(q.key,q):U.set(q.index,q),q=q.sibling;return U}function g(q,U){return q=Hn(q,U),q.index=0,q.sibling=null,q}function S(q,U,H){return q.index=H,s?(H=q.alternate,H!==null?(H=H.index,H<U?(q.flags|=67108866,U):H):(q.flags|=67108866,U)):(q.flags|=1048576,U)}function b(q){return s&&q.alternate===null&&(q.flags|=67108866),q}function E(q,U,H,j){return U===null||U.tag!==6?(U=nc(H,q.mode,j),U.return=q,U):(U=g(U,H),U.return=q,U)}function D(q,U,H,j){var me=H.type;return me===A?J(q,U,H.props.children,j,H.key):U!==null&&(U.elementType===me||typeof me=="object"&&me!==null&&me.$$typeof===W&&ra(me)===U.type)?(U=g(U,H.props),tr(U,H),U.return=q,U):(U=wo(H.type,H.key,H.props,null,q.mode,j),tr(U,H),U.return=q,U)}function V(q,U,H,j){return U===null||U.tag!==4||U.stateNode.containerInfo!==H.containerInfo||U.stateNode.implementation!==H.implementation?(U=sc(H,q.mode,j),U.return=q,U):(U=g(U,H.children||[]),U.return=q,U)}function J(q,U,H,j,me){return U===null||U.tag!==7?(U=ta(H,q.mode,j,me),U.return=q,U):(U=g(U,H),U.return=q,U)}function Q(q,U,H){if(typeof U=="string"&&U!==""||typeof U=="number"||typeof U=="bigint")return U=nc(""+U,q.mode,H),U.return=q,U;if(typeof U=="object"&&U!==null){switch(U.$$typeof){case x:return H=wo(U.type,U.key,U.props,null,q.mode,H),tr(H,U),H.return=q,H;case w:return U=sc(U,q.mode,H),U.return=q,U;case W:return U=ra(U),Q(q,U,H)}if(ae(U)||L(U))return U=ta(U,q.mode,H,null),U.return=q,U;if(typeof U.then=="function")return Q(q,Do(U),H);if(U.$$typeof===R)return Q(q,No(q,U),H);Po(q,U)}return null}function F(q,U,H,j){var me=U!==null?U.key:null;if(typeof H=="string"&&H!==""||typeof H=="number"||typeof H=="bigint")return me!==null?null:E(q,U,""+H,j);if(typeof H=="object"&&H!==null){switch(H.$$typeof){case x:return H.key===me?D(q,U,H,j):null;case w:return H.key===me?V(q,U,H,j):null;case W:return H=ra(H),F(q,U,H,j)}if(ae(H)||L(H))return me!==null?null:J(q,U,H,j,null);if(typeof H.then=="function")return F(q,U,Do(H),j);if(H.$$typeof===R)return F(q,U,No(q,H),j);Po(q,H)}return null}function G(q,U,H,j,me){if(typeof j=="string"&&j!==""||typeof j=="number"||typeof j=="bigint")return q=q.get(H)||null,E(U,q,""+j,me);if(typeof j=="object"&&j!==null){switch(j.$$typeof){case x:return q=q.get(j.key===null?H:j.key)||null,D(U,q,j,me);case w:return q=q.get(j.key===null?H:j.key)||null,V(U,q,j,me);case W:return j=ra(j),G(q,U,H,j,me)}if(ae(j)||L(j))return q=q.get(H)||null,J(U,q,j,me,null);if(typeof j.then=="function")return G(q,U,H,Do(j),me);if(j.$$typeof===R)return G(q,U,H,No(U,j),me);Po(U,j)}return null}function le(q,U,H,j){for(var me=null,Le=null,de=U,Ee=U=0,De=null;de!==null&&Ee<H.length;Ee++){de.index>Ee?(De=de,de=null):De=de.sibling;var ke=F(q,de,H[Ee],j);if(ke===null){de===null&&(de=De);break}s&&de&&ke.alternate===null&&i(q,de),U=S(ke,U,Ee),Le===null?me=ke:Le.sibling=ke,Le=ke,de=De}if(Ee===H.length)return o(q,de),Pe&&Vn(q,Ee),me;if(de===null){for(;Ee<H.length;Ee++)de=Q(q,H[Ee],j),de!==null&&(U=S(de,U,Ee),Le===null?me=de:Le.sibling=de,Le=de);return Pe&&Vn(q,Ee),me}for(de=u(de);Ee<H.length;Ee++)De=G(de,q,Ee,H[Ee],j),De!==null&&(s&&De.alternate!==null&&de.delete(De.key===null?Ee:De.key),U=S(De,U,Ee),Le===null?me=De:Le.sibling=De,Le=De);return s&&de.forEach(function(Ls){return i(q,Ls)}),Pe&&Vn(q,Ee),me}function ye(q,U,H,j){if(H==null)throw Error(a(151));for(var me=null,Le=null,de=U,Ee=U=0,De=null,ke=H.next();de!==null&&!ke.done;Ee++,ke=H.next()){de.index>Ee?(De=de,de=null):De=de.sibling;var Ls=F(q,de,ke.value,j);if(Ls===null){de===null&&(de=De);break}s&&de&&Ls.alternate===null&&i(q,de),U=S(Ls,U,Ee),Le===null?me=Ls:Le.sibling=Ls,Le=Ls,de=De}if(ke.done)return o(q,de),Pe&&Vn(q,Ee),me;if(de===null){for(;!ke.done;Ee++,ke=H.next())ke=Q(q,ke.value,j),ke!==null&&(U=S(ke,U,Ee),Le===null?me=ke:Le.sibling=ke,Le=ke);return Pe&&Vn(q,Ee),me}for(de=u(de);!ke.done;Ee++,ke=H.next())ke=G(de,q,Ee,ke.value,j),ke!==null&&(s&&ke.alternate!==null&&de.delete(ke.key===null?Ee:ke.key),U=S(ke,U,Ee),Le===null?me=ke:Le.sibling=ke,Le=ke);return s&&de.forEach(function(xw){return i(q,xw)}),Pe&&Vn(q,Ee),me}function ze(q,U,H,j){if(typeof H=="object"&&H!==null&&H.type===A&&H.key===null&&(H=H.props.children),typeof H=="object"&&H!==null){switch(H.$$typeof){case x:e:{for(var me=H.key;U!==null;){if(U.key===me){if(me=H.type,me===A){if(U.tag===7){o(q,U.sibling),j=g(U,H.props.children),j.return=q,q=j;break e}}else if(U.elementType===me||typeof me=="object"&&me!==null&&me.$$typeof===W&&ra(me)===U.type){o(q,U.sibling),j=g(U,H.props),tr(j,H),j.return=q,q=j;break e}o(q,U);break}else i(q,U);U=U.sibling}H.type===A?(j=ta(H.props.children,q.mode,j,H.key),j.return=q,q=j):(j=wo(H.type,H.key,H.props,null,q.mode,j),tr(j,H),j.return=q,q=j)}return b(q);case w:e:{for(me=H.key;U!==null;){if(U.key===me)if(U.tag===4&&U.stateNode.containerInfo===H.containerInfo&&U.stateNode.implementation===H.implementation){o(q,U.sibling),j=g(U,H.children||[]),j.return=q,q=j;break e}else{o(q,U);break}else i(q,U);U=U.sibling}j=sc(H,q.mode,j),j.return=q,q=j}return b(q);case W:return H=ra(H),ze(q,U,H,j)}if(ae(H))return le(q,U,H,j);if(L(H)){if(me=L(H),typeof me!="function")throw Error(a(150));return H=me.call(H),ye(q,U,H,j)}if(typeof H.then=="function")return ze(q,U,Do(H),j);if(H.$$typeof===R)return ze(q,U,No(q,H),j);Po(q,H)}return typeof H=="string"&&H!==""||typeof H=="number"||typeof H=="bigint"?(H=""+H,U!==null&&U.tag===6?(o(q,U.sibling),j=g(U,H),j.return=q,q=j):(o(q,U),j=nc(H,q.mode,j),j.return=q,q=j),b(q)):o(q,U)}return function(q,U,H,j){try{er=0;var me=ze(q,U,H,j);return Ya=null,me}catch(de){if(de===$a||de===Ro)throw de;var Le=Jt(29,de,null,q.mode);return Le.lanes=j,Le.return=q,Le}finally{}}}var la=dh(!0),fh=dh(!1),ys=!1;function hc(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function gc(s,i){s=s.updateQueue,i.updateQueue===s&&(i.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function vs(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function Ss(s,i,o){var u=s.updateQueue;if(u===null)return null;if(u=u.shared,(Be&2)!==0){var g=u.pending;return g===null?i.next=i:(i.next=g.next,g.next=i),u.pending=i,i=Ao(s),jm(s,null,o),i}return xo(s,u,i,o),Ao(s)}function nr(s,i,o){if(i=i.updateQueue,i!==null&&(i=i.shared,(o&4194048)!==0)){var u=i.lanes;u&=s.pendingLanes,o|=u,i.lanes=o,sm(s,o)}}function yc(s,i){var o=s.updateQueue,u=s.alternate;if(u!==null&&(u=u.updateQueue,o===u)){var g=null,S=null;if(o=o.firstBaseUpdate,o!==null){do{var b={lane:o.lane,tag:o.tag,payload:o.payload,callback:null,next:null};S===null?g=S=b:S=S.next=b,o=o.next}while(o!==null);S===null?g=S=i:S=S.next=i}else g=S=i;o={baseState:u.baseState,firstBaseUpdate:g,lastBaseUpdate:S,shared:u.shared,callbacks:u.callbacks},s.updateQueue=o;return}s=o.lastBaseUpdate,s===null?o.firstBaseUpdate=i:s.next=i,o.lastBaseUpdate=i}var vc=!1;function sr(){if(vc){var s=za;if(s!==null)throw s}}function ar(s,i,o,u){vc=!1;var g=s.updateQueue;ys=!1;var S=g.firstBaseUpdate,b=g.lastBaseUpdate,E=g.shared.pending;if(E!==null){g.shared.pending=null;var D=E,V=D.next;D.next=null,b===null?S=V:b.next=V,b=D;var J=s.alternate;J!==null&&(J=J.updateQueue,E=J.lastBaseUpdate,E!==b&&(E===null?J.firstBaseUpdate=V:E.next=V,J.lastBaseUpdate=D))}if(S!==null){var Q=g.baseState;b=0,J=V=D=null,E=S;do{var F=E.lane&-536870913,G=F!==E.lane;if(G?(Me&F)===F:(u&F)===F){F!==0&&F===Ga&&(vc=!0),J!==null&&(J=J.next={lane:0,tag:E.tag,payload:E.payload,callback:null,next:null});e:{var le=s,ye=E;F=i;var ze=o;switch(ye.tag){case 1:if(le=ye.payload,typeof le=="function"){Q=le.call(ze,Q,F);break e}Q=le;break e;case 3:le.flags=le.flags&-65537|128;case 0:if(le=ye.payload,F=typeof le=="function"?le.call(ze,Q,F):le,F==null)break e;Q=v({},Q,F);break e;case 2:ys=!0}}F=E.callback,F!==null&&(s.flags|=64,G&&(s.flags|=8192),G=g.callbacks,G===null?g.callbacks=[F]:G.push(F))}else G={lane:F,tag:E.tag,payload:E.payload,callback:E.callback,next:null},J===null?(V=J=G,D=Q):J=J.next=G,b|=F;if(E=E.next,E===null){if(E=g.shared.pending,E===null)break;G=E,E=G.next,G.next=null,g.lastBaseUpdate=G,g.shared.pending=null}}while(!0);J===null&&(D=Q),g.baseState=D,g.firstBaseUpdate=V,g.lastBaseUpdate=J,S===null&&(g.shared.lanes=0),As|=b,s.lanes=b,s.memoizedState=Q}}function ph(s,i){if(typeof s!="function")throw Error(a(191,s));s.call(i)}function mh(s,i){var o=s.callbacks;if(o!==null)for(s.callbacks=null,s=0;s<o.length;s++)ph(o[s],i)}var Ja=P(null),Lo=P(0);function hh(s,i){s=Wn,se(Lo,s),se(Ja,i),Wn=s|i.baseLanes}function Sc(){se(Lo,Wn),se(Ja,Ja.current)}function _c(){Wn=Lo.current,X(Ja),X(Lo)}var Kt=P(null),dn=null;function _s(s){var i=s.alternate;se(it,it.current&1),se(Kt,s),dn===null&&(i===null||Ja.current!==null||i.memoizedState!==null)&&(dn=s)}function Tc(s){se(it,it.current),se(Kt,s),dn===null&&(dn=s)}function gh(s){s.tag===22?(se(it,it.current),se(Kt,s),dn===null&&(dn=s)):Ts()}function Ts(){se(it,it.current),se(Kt,Kt.current)}function jt(s){X(Kt),dn===s&&(dn=null),X(it)}var it=P(0);function ko(s){for(var i=s;i!==null;){if(i.tag===13){var o=i.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||Ed(o)||Nd(o)))return i}else if(i.tag===19&&(i.memoizedProps.revealOrder==="forwards"||i.memoizedProps.revealOrder==="backwards"||i.memoizedProps.revealOrder==="unstable_legacy-backwards"||i.memoizedProps.revealOrder==="together")){if((i.flags&128)!==0)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break;for(;i.sibling===null;){if(i.return===null||i.return===s)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var zn=0,Ce=null,Fe=null,ct=null,Uo=!1,Ka=!1,ua=!1,Oo=0,ir=0,ja=null,pA=0;function nt(){throw Error(a(321))}function bc(s,i){if(i===null)return!1;for(var o=0;o<i.length&&o<s.length;o++)if(!Yt(s[o],i[o]))return!1;return!0}function xc(s,i,o,u,g,S){return zn=S,Ce=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,O.H=s===null||s.memoizedState===null?Zh:qc,ua=!1,S=o(u,g),ua=!1,Ka&&(S=vh(i,o,u,g)),yh(s),S}function yh(s){O.H=lr;var i=Fe!==null&&Fe.next!==null;if(zn=0,ct=Fe=Ce=null,Uo=!1,ir=0,ja=null,i)throw Error(a(300));s===null||dt||(s=s.dependencies,s!==null&&Eo(s)&&(dt=!0))}function vh(s,i,o,u){Ce=s;var g=0;do{if(Ka&&(ja=null),ir=0,Ka=!1,25<=g)throw Error(a(301));if(g+=1,ct=Fe=null,s.updateQueue!=null){var S=s.updateQueue;S.lastEffect=null,S.events=null,S.stores=null,S.memoCache!=null&&(S.memoCache.index=0)}O.H=eg,S=i(o,u)}while(Ka);return S}function mA(){var s=O.H,i=s.useState()[0];return i=typeof i.then=="function"?rr(i):i,s=s.useState()[0],(Fe!==null?Fe.memoizedState:null)!==s&&(Ce.flags|=1024),i}function Ac(){var s=Oo!==0;return Oo=0,s}function wc(s,i,o){i.updateQueue=s.updateQueue,i.flags&=-2053,s.lanes&=~o}function Cc(s){if(Uo){for(s=s.memoizedState;s!==null;){var i=s.queue;i!==null&&(i.pending=null),s=s.next}Uo=!1}zn=0,ct=Fe=Ce=null,Ka=!1,ir=Oo=0,ja=null}function kt(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ct===null?Ce.memoizedState=ct=s:ct=ct.next=s,ct}function rt(){if(Fe===null){var s=Ce.alternate;s=s!==null?s.memoizedState:null}else s=Fe.next;var i=ct===null?Ce.memoizedState:ct.next;if(i!==null)ct=i,Fe=s;else{if(s===null)throw Ce.alternate===null?Error(a(467)):Error(a(310));Fe=s,s={memoizedState:Fe.memoizedState,baseState:Fe.baseState,baseQueue:Fe.baseQueue,queue:Fe.queue,next:null},ct===null?Ce.memoizedState=ct=s:ct=ct.next=s}return ct}function qo(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function rr(s){var i=ir;return ir+=1,ja===null&&(ja=[]),s=lh(ja,s,i),i=Ce,(ct===null?i.memoizedState:ct.next)===null&&(i=i.alternate,O.H=i===null||i.memoizedState===null?Zh:qc),s}function Bo(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return rr(s);if(s.$$typeof===R)return xt(s)}throw Error(a(438,String(s)))}function Ec(s){var i=null,o=Ce.updateQueue;if(o!==null&&(i=o.memoCache),i==null){var u=Ce.alternate;u!==null&&(u=u.updateQueue,u!==null&&(u=u.memoCache,u!=null&&(i={data:u.data.map(function(g){return g.slice()}),index:0})))}if(i==null&&(i={data:[],index:0}),o===null&&(o=qo(),Ce.updateQueue=o),o.memoCache=i,o=i.data[i.index],o===void 0)for(o=i.data[i.index]=Array(s),u=0;u<s;u++)o[u]=Z;return i.index++,o}function $n(s,i){return typeof i=="function"?i(s):i}function Ho(s){var i=rt();return Nc(i,Fe,s)}function Nc(s,i,o){var u=s.queue;if(u===null)throw Error(a(311));u.lastRenderedReducer=o;var g=s.baseQueue,S=u.pending;if(S!==null){if(g!==null){var b=g.next;g.next=S.next,S.next=b}i.baseQueue=g=S,u.pending=null}if(S=s.baseState,g===null)s.memoizedState=S;else{i=g.next;var E=b=null,D=null,V=i,J=!1;do{var Q=V.lane&-536870913;if(Q!==V.lane?(Me&Q)===Q:(zn&Q)===Q){var F=V.revertLane;if(F===0)D!==null&&(D=D.next={lane:0,revertLane:0,gesture:null,action:V.action,hasEagerState:V.hasEagerState,eagerState:V.eagerState,next:null}),Q===Ga&&(J=!0);else if((zn&F)===F){V=V.next,F===Ga&&(J=!0);continue}else Q={lane:0,revertLane:V.revertLane,gesture:null,action:V.action,hasEagerState:V.hasEagerState,eagerState:V.eagerState,next:null},D===null?(E=D=Q,b=S):D=D.next=Q,Ce.lanes|=F,As|=F;Q=V.action,ua&&o(S,Q),S=V.hasEagerState?V.eagerState:o(S,Q)}else F={lane:Q,revertLane:V.revertLane,gesture:V.gesture,action:V.action,hasEagerState:V.hasEagerState,eagerState:V.eagerState,next:null},D===null?(E=D=F,b=S):D=D.next=F,Ce.lanes|=Q,As|=Q;V=V.next}while(V!==null&&V!==i);if(D===null?b=S:D.next=E,!Yt(S,s.memoizedState)&&(dt=!0,J&&(o=za,o!==null)))throw o;s.memoizedState=S,s.baseState=b,s.baseQueue=D,u.lastRenderedState=S}return g===null&&(u.lanes=0),[s.memoizedState,u.dispatch]}function Ic(s){var i=rt(),o=i.queue;if(o===null)throw Error(a(311));o.lastRenderedReducer=s;var u=o.dispatch,g=o.pending,S=i.memoizedState;if(g!==null){o.pending=null;var b=g=g.next;do S=s(S,b.action),b=b.next;while(b!==g);Yt(S,i.memoizedState)||(dt=!0),i.memoizedState=S,i.baseQueue===null&&(i.baseState=S),o.lastRenderedState=S}return[S,u]}function Sh(s,i,o){var u=Ce,g=rt(),S=Pe;if(S){if(o===void 0)throw Error(a(407));o=o()}else o=i();var b=!Yt((Fe||g).memoizedState,o);if(b&&(g.memoizedState=o,dt=!0),g=g.queue,Dc(bh.bind(null,u,g,s),[s]),g.getSnapshot!==i||b||ct!==null&&ct.memoizedState.tag&1){if(u.flags|=2048,Xa(9,{destroy:void 0},Th.bind(null,u,g,o,i),null),Je===null)throw Error(a(349));S||(zn&127)!==0||_h(u,i,o)}return o}function _h(s,i,o){s.flags|=16384,s={getSnapshot:i,value:o},i=Ce.updateQueue,i===null?(i=qo(),Ce.updateQueue=i,i.stores=[s]):(o=i.stores,o===null?i.stores=[s]:o.push(s))}function Th(s,i,o,u){i.value=o,i.getSnapshot=u,xh(i)&&Ah(s)}function bh(s,i,o){return o(function(){xh(i)&&Ah(s)})}function xh(s){var i=s.getSnapshot;s=s.value;try{var o=i();return!Yt(s,o)}catch{return!0}}function Ah(s){var i=ea(s,2);i!==null&&Gt(i,s,2)}function Rc(s){var i=kt();if(typeof s=="function"){var o=s;if(s=o(),ua){En(!0);try{o()}finally{En(!1)}}}return i.memoizedState=i.baseState=s,i.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:$n,lastRenderedState:s},i}function wh(s,i,o,u){return s.baseState=o,Nc(s,Fe,typeof u=="function"?u:$n)}function hA(s,i,o,u,g){if(Go(s))throw Error(a(485));if(s=i.action,s!==null){var S={payload:g,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(b){S.listeners.push(b)}};O.T!==null?o(!0):S.isTransition=!1,u(S),o=i.pending,o===null?(S.next=i.pending=S,Ch(i,S)):(S.next=o.next,i.pending=o.next=S)}}function Ch(s,i){var o=i.action,u=i.payload,g=s.state;if(i.isTransition){var S=O.T,b={};O.T=b;try{var E=o(g,u),D=O.S;D!==null&&D(b,E),Eh(s,i,E)}catch(V){Mc(s,i,V)}finally{S!==null&&b.types!==null&&(S.types=b.types),O.T=S}}else try{S=o(g,u),Eh(s,i,S)}catch(V){Mc(s,i,V)}}function Eh(s,i,o){o!==null&&typeof o=="object"&&typeof o.then=="function"?o.then(function(u){Nh(s,i,u)},function(u){return Mc(s,i,u)}):Nh(s,i,o)}function Nh(s,i,o){i.status="fulfilled",i.value=o,Ih(i),s.state=o,i=s.pending,i!==null&&(o=i.next,o===i?s.pending=null:(o=o.next,i.next=o,Ch(s,o)))}function Mc(s,i,o){var u=s.pending;if(s.pending=null,u!==null){u=u.next;do i.status="rejected",i.reason=o,Ih(i),i=i.next;while(i!==u)}s.action=null}function Ih(s){s=s.listeners;for(var i=0;i<s.length;i++)(0,s[i])()}function Rh(s,i){return i}function Mh(s,i){if(Pe){var o=Je.formState;if(o!==null){e:{var u=Ce;if(Pe){if(je){t:{for(var g=je,S=cn;g.nodeType!==8;){if(!S){g=null;break t}if(g=fn(g.nextSibling),g===null){g=null;break t}}S=g.data,g=S==="F!"||S==="F"?g:null}if(g){je=fn(g.nextSibling),u=g.data==="F!";break e}}hs(u)}u=!1}u&&(i=o[0])}}return o=kt(),o.memoizedState=o.baseState=i,u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Rh,lastRenderedState:i},o.queue=u,o=Xh.bind(null,Ce,u),u.dispatch=o,u=Rc(!1),S=Oc.bind(null,Ce,!1,u.queue),u=kt(),g={state:i,dispatch:null,action:s,pending:null},u.queue=g,o=hA.bind(null,Ce,g,S,o),g.dispatch=o,u.memoizedState=s,[i,o,!1]}function Dh(s){var i=rt();return Ph(i,Fe,s)}function Ph(s,i,o){if(i=Nc(s,i,Rh)[0],s=Ho($n)[0],typeof i=="object"&&i!==null&&typeof i.then=="function")try{var u=rr(i)}catch(b){throw b===$a?Ro:b}else u=i;i=rt();var g=i.queue,S=g.dispatch;return o!==i.memoizedState&&(Ce.flags|=2048,Xa(9,{destroy:void 0},gA.bind(null,g,o),null)),[u,S,s]}function gA(s,i){s.action=i}function Lh(s){var i=rt(),o=Fe;if(o!==null)return Ph(i,o,s);rt(),i=i.memoizedState,o=rt();var u=o.queue.dispatch;return o.memoizedState=s,[i,u,!1]}function Xa(s,i,o,u){return s={tag:s,create:o,deps:u,inst:i,next:null},i=Ce.updateQueue,i===null&&(i=qo(),Ce.updateQueue=i),o=i.lastEffect,o===null?i.lastEffect=s.next=s:(u=o.next,o.next=s,s.next=u,i.lastEffect=s),s}function kh(){return rt().memoizedState}function Vo(s,i,o,u){var g=kt();Ce.flags|=s,g.memoizedState=Xa(1|i,{destroy:void 0},o,u===void 0?null:u)}function Fo(s,i,o,u){var g=rt();u=u===void 0?null:u;var S=g.memoizedState.inst;Fe!==null&&u!==null&&bc(u,Fe.memoizedState.deps)?g.memoizedState=Xa(i,S,o,u):(Ce.flags|=s,g.memoizedState=Xa(1|i,S,o,u))}function Uh(s,i){Vo(8390656,8,s,i)}function Dc(s,i){Fo(2048,8,s,i)}function yA(s){Ce.flags|=4;var i=Ce.updateQueue;if(i===null)i=qo(),Ce.updateQueue=i,i.events=[s];else{var o=i.events;o===null?i.events=[s]:o.push(s)}}function Oh(s){var i=rt().memoizedState;return yA({ref:i,nextImpl:s}),function(){if((Be&2)!==0)throw Error(a(440));return i.impl.apply(void 0,arguments)}}function qh(s,i){return Fo(4,2,s,i)}function Bh(s,i){return Fo(4,4,s,i)}function Hh(s,i){if(typeof i=="function"){s=s();var o=i(s);return function(){typeof o=="function"?o():i(null)}}if(i!=null)return s=s(),i.current=s,function(){i.current=null}}function Vh(s,i,o){o=o!=null?o.concat([s]):null,Fo(4,4,Hh.bind(null,i,s),o)}function Pc(){}function Fh(s,i){var o=rt();i=i===void 0?null:i;var u=o.memoizedState;return i!==null&&bc(i,u[1])?u[0]:(o.memoizedState=[s,i],s)}function Gh(s,i){var o=rt();i=i===void 0?null:i;var u=o.memoizedState;if(i!==null&&bc(i,u[1]))return u[0];if(u=s(),ua){En(!0);try{s()}finally{En(!1)}}return o.memoizedState=[u,i],u}function Lc(s,i,o){return o===void 0||(zn&1073741824)!==0&&(Me&261930)===0?s.memoizedState=i:(s.memoizedState=o,s=zg(),Ce.lanes|=s,As|=s,o)}function zh(s,i,o,u){return Yt(o,i)?o:Ja.current!==null?(s=Lc(s,o,u),Yt(s,i)||(dt=!0),s):(zn&42)===0||(zn&1073741824)!==0&&(Me&261930)===0?(dt=!0,s.memoizedState=o):(s=zg(),Ce.lanes|=s,As|=s,i)}function $h(s,i,o,u,g){var S=K.p;K.p=S!==0&&8>S?S:8;var b=O.T,E={};O.T=E,Oc(s,!1,i,o);try{var D=g(),V=O.S;if(V!==null&&V(E,D),D!==null&&typeof D=="object"&&typeof D.then=="function"){var J=fA(D,u);or(s,i,J,Wt(s))}else or(s,i,u,Wt(s))}catch(Q){or(s,i,{then:function(){},status:"rejected",reason:Q},Wt())}finally{K.p=S,b!==null&&E.types!==null&&(b.types=E.types),O.T=b}}function vA(){}function kc(s,i,o,u){if(s.tag!==5)throw Error(a(476));var g=Yh(s).queue;$h(s,g,i,ee,o===null?vA:function(){return Jh(s),o(u)})}function Yh(s){var i=s.memoizedState;if(i!==null)return i;i={memoizedState:ee,baseState:ee,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:$n,lastRenderedState:ee},next:null};var o={};return i.next={memoizedState:o,baseState:o,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:$n,lastRenderedState:o},next:null},s.memoizedState=i,s=s.alternate,s!==null&&(s.memoizedState=i),i}function Jh(s){var i=Yh(s);i.next===null&&(i=s.alternate.memoizedState),or(s,i.next.queue,{},Wt())}function Uc(){return xt(Ar)}function Kh(){return rt().memoizedState}function jh(){return rt().memoizedState}function SA(s){for(var i=s.return;i!==null;){switch(i.tag){case 24:case 3:var o=Wt();s=vs(o);var u=Ss(i,s,o);u!==null&&(Gt(u,i,o),nr(u,i,o)),i={cache:dc()},s.payload=i;return}i=i.return}}function _A(s,i,o){var u=Wt();o={lane:u,revertLane:0,gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null},Go(s)?Qh(i,o):(o=ec(s,i,o,u),o!==null&&(Gt(o,s,u),Wh(o,i,u)))}function Xh(s,i,o){var u=Wt();or(s,i,o,u)}function or(s,i,o,u){var g={lane:u,revertLane:0,gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null};if(Go(s))Qh(i,g);else{var S=s.alternate;if(s.lanes===0&&(S===null||S.lanes===0)&&(S=i.lastRenderedReducer,S!==null))try{var b=i.lastRenderedState,E=S(b,o);if(g.hasEagerState=!0,g.eagerState=E,Yt(E,b))return xo(s,i,g,0),Je===null&&bo(),!1}catch{}finally{}if(o=ec(s,i,g,u),o!==null)return Gt(o,s,u),Wh(o,i,u),!0}return!1}function Oc(s,i,o,u){if(u={lane:2,revertLane:hd(),gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null},Go(s)){if(i)throw Error(a(479))}else i=ec(s,o,u,2),i!==null&&Gt(i,s,2)}function Go(s){var i=s.alternate;return s===Ce||i!==null&&i===Ce}function Qh(s,i){Ka=Uo=!0;var o=s.pending;o===null?i.next=i:(i.next=o.next,o.next=i),s.pending=i}function Wh(s,i,o){if((o&4194048)!==0){var u=i.lanes;u&=s.pendingLanes,o|=u,i.lanes=o,sm(s,o)}}var lr={readContext:xt,use:Bo,useCallback:nt,useContext:nt,useEffect:nt,useImperativeHandle:nt,useLayoutEffect:nt,useInsertionEffect:nt,useMemo:nt,useReducer:nt,useRef:nt,useState:nt,useDebugValue:nt,useDeferredValue:nt,useTransition:nt,useSyncExternalStore:nt,useId:nt,useHostTransitionStatus:nt,useFormState:nt,useActionState:nt,useOptimistic:nt,useMemoCache:nt,useCacheRefresh:nt};lr.useEffectEvent=nt;var Zh={readContext:xt,use:Bo,useCallback:function(s,i){return kt().memoizedState=[s,i===void 0?null:i],s},useContext:xt,useEffect:Uh,useImperativeHandle:function(s,i,o){o=o!=null?o.concat([s]):null,Vo(4194308,4,Hh.bind(null,i,s),o)},useLayoutEffect:function(s,i){return Vo(4194308,4,s,i)},useInsertionEffect:function(s,i){Vo(4,2,s,i)},useMemo:function(s,i){var o=kt();i=i===void 0?null:i;var u=s();if(ua){En(!0);try{s()}finally{En(!1)}}return o.memoizedState=[u,i],u},useReducer:function(s,i,o){var u=kt();if(o!==void 0){var g=o(i);if(ua){En(!0);try{o(i)}finally{En(!1)}}}else g=i;return u.memoizedState=u.baseState=g,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:g},u.queue=s,s=s.dispatch=_A.bind(null,Ce,s),[u.memoizedState,s]},useRef:function(s){var i=kt();return s={current:s},i.memoizedState=s},useState:function(s){s=Rc(s);var i=s.queue,o=Xh.bind(null,Ce,i);return i.dispatch=o,[s.memoizedState,o]},useDebugValue:Pc,useDeferredValue:function(s,i){var o=kt();return Lc(o,s,i)},useTransition:function(){var s=Rc(!1);return s=$h.bind(null,Ce,s.queue,!0,!1),kt().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,i,o){var u=Ce,g=kt();if(Pe){if(o===void 0)throw Error(a(407));o=o()}else{if(o=i(),Je===null)throw Error(a(349));(Me&127)!==0||_h(u,i,o)}g.memoizedState=o;var S={value:o,getSnapshot:i};return g.queue=S,Uh(bh.bind(null,u,S,s),[s]),u.flags|=2048,Xa(9,{destroy:void 0},Th.bind(null,u,S,o,i),null),o},useId:function(){var s=kt(),i=Je.identifierPrefix;if(Pe){var o=In,u=Nn;o=(u&~(1<<32-Lt(u)-1)).toString(32)+o,i="_"+i+"R_"+o,o=Oo++,0<o&&(i+="H"+o.toString(32)),i+="_"}else o=pA++,i="_"+i+"r_"+o.toString(32)+"_";return s.memoizedState=i},useHostTransitionStatus:Uc,useFormState:Mh,useActionState:Mh,useOptimistic:function(s){var i=kt();i.memoizedState=i.baseState=s;var o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return i.queue=o,i=Oc.bind(null,Ce,!0,o),o.dispatch=i,[s,i]},useMemoCache:Ec,useCacheRefresh:function(){return kt().memoizedState=SA.bind(null,Ce)},useEffectEvent:function(s){var i=kt(),o={impl:s};return i.memoizedState=o,function(){if((Be&2)!==0)throw Error(a(440));return o.impl.apply(void 0,arguments)}}},qc={readContext:xt,use:Bo,useCallback:Fh,useContext:xt,useEffect:Dc,useImperativeHandle:Vh,useInsertionEffect:qh,useLayoutEffect:Bh,useMemo:Gh,useReducer:Ho,useRef:kh,useState:function(){return Ho($n)},useDebugValue:Pc,useDeferredValue:function(s,i){var o=rt();return zh(o,Fe.memoizedState,s,i)},useTransition:function(){var s=Ho($n)[0],i=rt().memoizedState;return[typeof s=="boolean"?s:rr(s),i]},useSyncExternalStore:Sh,useId:Kh,useHostTransitionStatus:Uc,useFormState:Dh,useActionState:Dh,useOptimistic:function(s,i){var o=rt();return wh(o,Fe,s,i)},useMemoCache:Ec,useCacheRefresh:jh};qc.useEffectEvent=Oh;var eg={readContext:xt,use:Bo,useCallback:Fh,useContext:xt,useEffect:Dc,useImperativeHandle:Vh,useInsertionEffect:qh,useLayoutEffect:Bh,useMemo:Gh,useReducer:Ic,useRef:kh,useState:function(){return Ic($n)},useDebugValue:Pc,useDeferredValue:function(s,i){var o=rt();return Fe===null?Lc(o,s,i):zh(o,Fe.memoizedState,s,i)},useTransition:function(){var s=Ic($n)[0],i=rt().memoizedState;return[typeof s=="boolean"?s:rr(s),i]},useSyncExternalStore:Sh,useId:Kh,useHostTransitionStatus:Uc,useFormState:Lh,useActionState:Lh,useOptimistic:function(s,i){var o=rt();return Fe!==null?wh(o,Fe,s,i):(o.baseState=s,[s,o.queue.dispatch])},useMemoCache:Ec,useCacheRefresh:jh};eg.useEffectEvent=Oh;function Bc(s,i,o,u){i=s.memoizedState,o=o(u,i),o=o==null?i:v({},i,o),s.memoizedState=o,s.lanes===0&&(s.updateQueue.baseState=o)}var Hc={enqueueSetState:function(s,i,o){s=s._reactInternals;var u=Wt(),g=vs(u);g.payload=i,o!=null&&(g.callback=o),i=Ss(s,g,u),i!==null&&(Gt(i,s,u),nr(i,s,u))},enqueueReplaceState:function(s,i,o){s=s._reactInternals;var u=Wt(),g=vs(u);g.tag=1,g.payload=i,o!=null&&(g.callback=o),i=Ss(s,g,u),i!==null&&(Gt(i,s,u),nr(i,s,u))},enqueueForceUpdate:function(s,i){s=s._reactInternals;var o=Wt(),u=vs(o);u.tag=2,i!=null&&(u.callback=i),i=Ss(s,u,o),i!==null&&(Gt(i,s,o),nr(i,s,o))}};function tg(s,i,o,u,g,S,b){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(u,S,b):i.prototype&&i.prototype.isPureReactComponent?!Ki(o,u)||!Ki(g,S):!0}function ng(s,i,o,u){s=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(o,u),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(o,u),i.state!==s&&Hc.enqueueReplaceState(i,i.state,null)}function ca(s,i){var o=i;if("ref"in i){o={};for(var u in i)u!=="ref"&&(o[u]=i[u])}if(s=s.defaultProps){o===i&&(o=v({},o));for(var g in s)o[g]===void 0&&(o[g]=s[g])}return o}function sg(s){To(s)}function ag(s){console.error(s)}function ig(s){To(s)}function zo(s,i){try{var o=s.onUncaughtError;o(i.value,{componentStack:i.stack})}catch(u){setTimeout(function(){throw u})}}function rg(s,i,o){try{var u=s.onCaughtError;u(o.value,{componentStack:o.stack,errorBoundary:i.tag===1?i.stateNode:null})}catch(g){setTimeout(function(){throw g})}}function Vc(s,i,o){return o=vs(o),o.tag=3,o.payload={element:null},o.callback=function(){zo(s,i)},o}function og(s){return s=vs(s),s.tag=3,s}function lg(s,i,o,u){var g=o.type.getDerivedStateFromError;if(typeof g=="function"){var S=u.value;s.payload=function(){return g(S)},s.callback=function(){rg(i,o,u)}}var b=o.stateNode;b!==null&&typeof b.componentDidCatch=="function"&&(s.callback=function(){rg(i,o,u),typeof g!="function"&&(ws===null?ws=new Set([this]):ws.add(this));var E=u.stack;this.componentDidCatch(u.value,{componentStack:E!==null?E:""})})}function TA(s,i,o,u,g){if(o.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){if(i=o.alternate,i!==null&&Fa(i,o,g,!0),o=Kt.current,o!==null){switch(o.tag){case 31:case 13:return dn===null?nl():o.alternate===null&&st===0&&(st=3),o.flags&=-257,o.flags|=65536,o.lanes=g,u===Mo?o.flags|=16384:(i=o.updateQueue,i===null?o.updateQueue=new Set([u]):i.add(u),fd(s,u,g)),!1;case 22:return o.flags|=65536,u===Mo?o.flags|=16384:(i=o.updateQueue,i===null?(i={transitions:null,markerInstances:null,retryQueue:new Set([u])},o.updateQueue=i):(o=i.retryQueue,o===null?i.retryQueue=new Set([u]):o.add(u)),fd(s,u,g)),!1}throw Error(a(435,o.tag))}return fd(s,u,g),nl(),!1}if(Pe)return i=Kt.current,i!==null?((i.flags&65536)===0&&(i.flags|=256),i.flags|=65536,i.lanes=g,u!==rc&&(s=Error(a(422),{cause:u}),Qi(on(s,o)))):(u!==rc&&(i=Error(a(423),{cause:u}),Qi(on(i,o))),s=s.current.alternate,s.flags|=65536,g&=-g,s.lanes|=g,u=on(u,o),g=Vc(s.stateNode,u,g),yc(s,g),st!==4&&(st=2)),!1;var S=Error(a(520),{cause:u});if(S=on(S,o),gr===null?gr=[S]:gr.push(S),st!==4&&(st=2),i===null)return!0;u=on(u,o),o=i;do{switch(o.tag){case 3:return o.flags|=65536,s=g&-g,o.lanes|=s,s=Vc(o.stateNode,u,s),yc(o,s),!1;case 1:if(i=o.type,S=o.stateNode,(o.flags&128)===0&&(typeof i.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(ws===null||!ws.has(S))))return o.flags|=65536,g&=-g,o.lanes|=g,g=og(g),lg(g,s,o,u),yc(o,g),!1}o=o.return}while(o!==null);return!1}var Fc=Error(a(461)),dt=!1;function At(s,i,o,u){i.child=s===null?fh(i,null,o,u):la(i,s.child,o,u)}function ug(s,i,o,u,g){o=o.render;var S=i.ref;if("ref"in u){var b={};for(var E in u)E!=="ref"&&(b[E]=u[E])}else b=u;return aa(i),u=xc(s,i,o,b,S,g),E=Ac(),s!==null&&!dt?(wc(s,i,g),Yn(s,i,g)):(Pe&&E&&ac(i),i.flags|=1,At(s,i,u,g),i.child)}function cg(s,i,o,u,g){if(s===null){var S=o.type;return typeof S=="function"&&!tc(S)&&S.defaultProps===void 0&&o.compare===null?(i.tag=15,i.type=S,dg(s,i,S,u,g)):(s=wo(o.type,null,u,i,i.mode,g),s.ref=i.ref,s.return=i,i.child=s)}if(S=s.child,!Xc(s,g)){var b=S.memoizedProps;if(o=o.compare,o=o!==null?o:Ki,o(b,u)&&s.ref===i.ref)return Yn(s,i,g)}return i.flags|=1,s=Hn(S,u),s.ref=i.ref,s.return=i,i.child=s}function dg(s,i,o,u,g){if(s!==null){var S=s.memoizedProps;if(Ki(S,u)&&s.ref===i.ref)if(dt=!1,i.pendingProps=u=S,Xc(s,g))(s.flags&131072)!==0&&(dt=!0);else return i.lanes=s.lanes,Yn(s,i,g)}return Gc(s,i,o,u,g)}function fg(s,i,o,u){var g=u.children,S=s!==null?s.memoizedState:null;if(s===null&&i.stateNode===null&&(i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),u.mode==="hidden"){if((i.flags&128)!==0){if(S=S!==null?S.baseLanes|o:o,s!==null){for(u=i.child=s.child,g=0;u!==null;)g=g|u.lanes|u.childLanes,u=u.sibling;u=g&~S}else u=0,i.child=null;return pg(s,i,S,o,u)}if((o&536870912)!==0)i.memoizedState={baseLanes:0,cachePool:null},s!==null&&Io(i,S!==null?S.cachePool:null),S!==null?hh(i,S):Sc(),gh(i);else return u=i.lanes=536870912,pg(s,i,S!==null?S.baseLanes|o:o,o,u)}else S!==null?(Io(i,S.cachePool),hh(i,S),Ts(),i.memoizedState=null):(s!==null&&Io(i,null),Sc(),Ts());return At(s,i,g,o),i.child}function ur(s,i){return s!==null&&s.tag===22||i.stateNode!==null||(i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),i.sibling}function pg(s,i,o,u,g){var S=pc();return S=S===null?null:{parent:ut._currentValue,pool:S},i.memoizedState={baseLanes:o,cachePool:S},s!==null&&Io(i,null),Sc(),gh(i),s!==null&&Fa(s,i,u,!0),i.childLanes=g,null}function $o(s,i){return i=Jo({mode:i.mode,children:i.children},s.mode),i.ref=s.ref,s.child=i,i.return=s,i}function mg(s,i,o){return la(i,s.child,null,o),s=$o(i,i.pendingProps),s.flags|=2,jt(i),i.memoizedState=null,s}function bA(s,i,o){var u=i.pendingProps,g=(i.flags&128)!==0;if(i.flags&=-129,s===null){if(Pe){if(u.mode==="hidden")return s=$o(i,u),i.lanes=536870912,ur(null,s);if(Tc(i),(s=je)?(s=Cy(s,cn),s=s!==null&&s.data==="&"?s:null,s!==null&&(i.memoizedState={dehydrated:s,treeContext:ps!==null?{id:Nn,overflow:In}:null,retryLane:536870912,hydrationErrors:null},o=Qm(s),o.return=i,i.child=o,bt=i,je=null)):s=null,s===null)throw hs(i);return i.lanes=536870912,null}return $o(i,u)}var S=s.memoizedState;if(S!==null){var b=S.dehydrated;if(Tc(i),g)if(i.flags&256)i.flags&=-257,i=mg(s,i,o);else if(i.memoizedState!==null)i.child=s.child,i.flags|=128,i=null;else throw Error(a(558));else if(dt||Fa(s,i,o,!1),g=(o&s.childLanes)!==0,dt||g){if(u=Je,u!==null&&(b=am(u,o),b!==0&&b!==S.retryLane))throw S.retryLane=b,ea(s,b),Gt(u,s,b),Fc;nl(),i=mg(s,i,o)}else s=S.treeContext,je=fn(b.nextSibling),bt=i,Pe=!0,ms=null,cn=!1,s!==null&&eh(i,s),i=$o(i,u),i.flags|=4096;return i}return s=Hn(s.child,{mode:u.mode,children:u.children}),s.ref=i.ref,i.child=s,s.return=i,s}function Yo(s,i){var o=i.ref;if(o===null)s!==null&&s.ref!==null&&(i.flags|=4194816);else{if(typeof o!="function"&&typeof o!="object")throw Error(a(284));(s===null||s.ref!==o)&&(i.flags|=4194816)}}function Gc(s,i,o,u,g){return aa(i),o=xc(s,i,o,u,void 0,g),u=Ac(),s!==null&&!dt?(wc(s,i,g),Yn(s,i,g)):(Pe&&u&&ac(i),i.flags|=1,At(s,i,o,g),i.child)}function hg(s,i,o,u,g,S){return aa(i),i.updateQueue=null,o=vh(i,u,o,g),yh(s),u=Ac(),s!==null&&!dt?(wc(s,i,S),Yn(s,i,S)):(Pe&&u&&ac(i),i.flags|=1,At(s,i,o,S),i.child)}function gg(s,i,o,u,g){if(aa(i),i.stateNode===null){var S=qa,b=o.contextType;typeof b=="object"&&b!==null&&(S=xt(b)),S=new o(u,S),i.memoizedState=S.state!==null&&S.state!==void 0?S.state:null,S.updater=Hc,i.stateNode=S,S._reactInternals=i,S=i.stateNode,S.props=u,S.state=i.memoizedState,S.refs={},hc(i),b=o.contextType,S.context=typeof b=="object"&&b!==null?xt(b):qa,S.state=i.memoizedState,b=o.getDerivedStateFromProps,typeof b=="function"&&(Bc(i,o,b,u),S.state=i.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof S.getSnapshotBeforeUpdate=="function"||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(b=S.state,typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount(),b!==S.state&&Hc.enqueueReplaceState(S,S.state,null),ar(i,u,S,g),sr(),S.state=i.memoizedState),typeof S.componentDidMount=="function"&&(i.flags|=4194308),u=!0}else if(s===null){S=i.stateNode;var E=i.memoizedProps,D=ca(o,E);S.props=D;var V=S.context,J=o.contextType;b=qa,typeof J=="object"&&J!==null&&(b=xt(J));var Q=o.getDerivedStateFromProps;J=typeof Q=="function"||typeof S.getSnapshotBeforeUpdate=="function",E=i.pendingProps!==E,J||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(E||V!==b)&&ng(i,S,u,b),ys=!1;var F=i.memoizedState;S.state=F,ar(i,u,S,g),sr(),V=i.memoizedState,E||F!==V||ys?(typeof Q=="function"&&(Bc(i,o,Q,u),V=i.memoizedState),(D=ys||tg(i,o,D,u,F,V,b))?(J||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount()),typeof S.componentDidMount=="function"&&(i.flags|=4194308)):(typeof S.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=u,i.memoizedState=V),S.props=u,S.state=V,S.context=b,u=D):(typeof S.componentDidMount=="function"&&(i.flags|=4194308),u=!1)}else{S=i.stateNode,gc(s,i),b=i.memoizedProps,J=ca(o,b),S.props=J,Q=i.pendingProps,F=S.context,V=o.contextType,D=qa,typeof V=="object"&&V!==null&&(D=xt(V)),E=o.getDerivedStateFromProps,(V=typeof E=="function"||typeof S.getSnapshotBeforeUpdate=="function")||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(b!==Q||F!==D)&&ng(i,S,u,D),ys=!1,F=i.memoizedState,S.state=F,ar(i,u,S,g),sr();var G=i.memoizedState;b!==Q||F!==G||ys||s!==null&&s.dependencies!==null&&Eo(s.dependencies)?(typeof E=="function"&&(Bc(i,o,E,u),G=i.memoizedState),(J=ys||tg(i,o,J,u,F,G,D)||s!==null&&s.dependencies!==null&&Eo(s.dependencies))?(V||typeof S.UNSAFE_componentWillUpdate!="function"&&typeof S.componentWillUpdate!="function"||(typeof S.componentWillUpdate=="function"&&S.componentWillUpdate(u,G,D),typeof S.UNSAFE_componentWillUpdate=="function"&&S.UNSAFE_componentWillUpdate(u,G,D)),typeof S.componentDidUpdate=="function"&&(i.flags|=4),typeof S.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof S.componentDidUpdate!="function"||b===s.memoizedProps&&F===s.memoizedState||(i.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||b===s.memoizedProps&&F===s.memoizedState||(i.flags|=1024),i.memoizedProps=u,i.memoizedState=G),S.props=u,S.state=G,S.context=D,u=J):(typeof S.componentDidUpdate!="function"||b===s.memoizedProps&&F===s.memoizedState||(i.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||b===s.memoizedProps&&F===s.memoizedState||(i.flags|=1024),u=!1)}return S=u,Yo(s,i),u=(i.flags&128)!==0,S||u?(S=i.stateNode,o=u&&typeof o.getDerivedStateFromError!="function"?null:S.render(),i.flags|=1,s!==null&&u?(i.child=la(i,s.child,null,g),i.child=la(i,null,o,g)):At(s,i,o,g),i.memoizedState=S.state,s=i.child):s=Yn(s,i,g),s}function yg(s,i,o,u){return na(),i.flags|=256,At(s,i,o,u),i.child}var zc={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function $c(s){return{baseLanes:s,cachePool:rh()}}function Yc(s,i,o){return s=s!==null?s.childLanes&~o:0,i&&(s|=Qt),s}function vg(s,i,o){var u=i.pendingProps,g=!1,S=(i.flags&128)!==0,b;if((b=S)||(b=s!==null&&s.memoizedState===null?!1:(it.current&2)!==0),b&&(g=!0,i.flags&=-129),b=(i.flags&32)!==0,i.flags&=-33,s===null){if(Pe){if(g?_s(i):Ts(),(s=je)?(s=Cy(s,cn),s=s!==null&&s.data!=="&"?s:null,s!==null&&(i.memoizedState={dehydrated:s,treeContext:ps!==null?{id:Nn,overflow:In}:null,retryLane:536870912,hydrationErrors:null},o=Qm(s),o.return=i,i.child=o,bt=i,je=null)):s=null,s===null)throw hs(i);return Nd(s)?i.lanes=32:i.lanes=536870912,null}var E=u.children;return u=u.fallback,g?(Ts(),g=i.mode,E=Jo({mode:"hidden",children:E},g),u=ta(u,g,o,null),E.return=i,u.return=i,E.sibling=u,i.child=E,u=i.child,u.memoizedState=$c(o),u.childLanes=Yc(s,b,o),i.memoizedState=zc,ur(null,u)):(_s(i),Jc(i,E))}var D=s.memoizedState;if(D!==null&&(E=D.dehydrated,E!==null)){if(S)i.flags&256?(_s(i),i.flags&=-257,i=Kc(s,i,o)):i.memoizedState!==null?(Ts(),i.child=s.child,i.flags|=128,i=null):(Ts(),E=u.fallback,g=i.mode,u=Jo({mode:"visible",children:u.children},g),E=ta(E,g,o,null),E.flags|=2,u.return=i,E.return=i,u.sibling=E,i.child=u,la(i,s.child,null,o),u=i.child,u.memoizedState=$c(o),u.childLanes=Yc(s,b,o),i.memoizedState=zc,i=ur(null,u));else if(_s(i),Nd(E)){if(b=E.nextSibling&&E.nextSibling.dataset,b)var V=b.dgst;b=V,u=Error(a(419)),u.stack="",u.digest=b,Qi({value:u,source:null,stack:null}),i=Kc(s,i,o)}else if(dt||Fa(s,i,o,!1),b=(o&s.childLanes)!==0,dt||b){if(b=Je,b!==null&&(u=am(b,o),u!==0&&u!==D.retryLane))throw D.retryLane=u,ea(s,u),Gt(b,s,u),Fc;Ed(E)||nl(),i=Kc(s,i,o)}else Ed(E)?(i.flags|=192,i.child=s.child,i=null):(s=D.treeContext,je=fn(E.nextSibling),bt=i,Pe=!0,ms=null,cn=!1,s!==null&&eh(i,s),i=Jc(i,u.children),i.flags|=4096);return i}return g?(Ts(),E=u.fallback,g=i.mode,D=s.child,V=D.sibling,u=Hn(D,{mode:"hidden",children:u.children}),u.subtreeFlags=D.subtreeFlags&65011712,V!==null?E=Hn(V,E):(E=ta(E,g,o,null),E.flags|=2),E.return=i,u.return=i,u.sibling=E,i.child=u,ur(null,u),u=i.child,E=s.child.memoizedState,E===null?E=$c(o):(g=E.cachePool,g!==null?(D=ut._currentValue,g=g.parent!==D?{parent:D,pool:D}:g):g=rh(),E={baseLanes:E.baseLanes|o,cachePool:g}),u.memoizedState=E,u.childLanes=Yc(s,b,o),i.memoizedState=zc,ur(s.child,u)):(_s(i),o=s.child,s=o.sibling,o=Hn(o,{mode:"visible",children:u.children}),o.return=i,o.sibling=null,s!==null&&(b=i.deletions,b===null?(i.deletions=[s],i.flags|=16):b.push(s)),i.child=o,i.memoizedState=null,o)}function Jc(s,i){return i=Jo({mode:"visible",children:i},s.mode),i.return=s,s.child=i}function Jo(s,i){return s=Jt(22,s,null,i),s.lanes=0,s}function Kc(s,i,o){return la(i,s.child,null,o),s=Jc(i,i.pendingProps.children),s.flags|=2,i.memoizedState=null,s}function Sg(s,i,o){s.lanes|=i;var u=s.alternate;u!==null&&(u.lanes|=i),uc(s.return,i,o)}function jc(s,i,o,u,g,S){var b=s.memoizedState;b===null?s.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:u,tail:o,tailMode:g,treeForkCount:S}:(b.isBackwards=i,b.rendering=null,b.renderingStartTime=0,b.last=u,b.tail=o,b.tailMode=g,b.treeForkCount=S)}function _g(s,i,o){var u=i.pendingProps,g=u.revealOrder,S=u.tail;u=u.children;var b=it.current,E=(b&2)!==0;if(E?(b=b&1|2,i.flags|=128):b&=1,se(it,b),At(s,i,u,o),u=Pe?Xi:0,!E&&s!==null&&(s.flags&128)!==0)e:for(s=i.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&Sg(s,o,i);else if(s.tag===19)Sg(s,o,i);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break e;for(;s.sibling===null;){if(s.return===null||s.return===i)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}switch(g){case"forwards":for(o=i.child,g=null;o!==null;)s=o.alternate,s!==null&&ko(s)===null&&(g=o),o=o.sibling;o=g,o===null?(g=i.child,i.child=null):(g=o.sibling,o.sibling=null),jc(i,!1,g,o,S,u);break;case"backwards":case"unstable_legacy-backwards":for(o=null,g=i.child,i.child=null;g!==null;){if(s=g.alternate,s!==null&&ko(s)===null){i.child=g;break}s=g.sibling,g.sibling=o,o=g,g=s}jc(i,!0,o,null,S,u);break;case"together":jc(i,!1,null,null,void 0,u);break;default:i.memoizedState=null}return i.child}function Yn(s,i,o){if(s!==null&&(i.dependencies=s.dependencies),As|=i.lanes,(o&i.childLanes)===0)if(s!==null){if(Fa(s,i,o,!1),(o&i.childLanes)===0)return null}else return null;if(s!==null&&i.child!==s.child)throw Error(a(153));if(i.child!==null){for(s=i.child,o=Hn(s,s.pendingProps),i.child=o,o.return=i;s.sibling!==null;)s=s.sibling,o=o.sibling=Hn(s,s.pendingProps),o.return=i;o.sibling=null}return i.child}function Xc(s,i){return(s.lanes&i)!==0?!0:(s=s.dependencies,!!(s!==null&&Eo(s)))}function xA(s,i,o){switch(i.tag){case 3:tt(i,i.stateNode.containerInfo),gs(i,ut,s.memoizedState.cache),na();break;case 27:case 5:wn(i);break;case 4:tt(i,i.stateNode.containerInfo);break;case 10:gs(i,i.type,i.memoizedProps.value);break;case 31:if(i.memoizedState!==null)return i.flags|=128,Tc(i),null;break;case 13:var u=i.memoizedState;if(u!==null)return u.dehydrated!==null?(_s(i),i.flags|=128,null):(o&i.child.childLanes)!==0?vg(s,i,o):(_s(i),s=Yn(s,i,o),s!==null?s.sibling:null);_s(i);break;case 19:var g=(s.flags&128)!==0;if(u=(o&i.childLanes)!==0,u||(Fa(s,i,o,!1),u=(o&i.childLanes)!==0),g){if(u)return _g(s,i,o);i.flags|=128}if(g=i.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),se(it,it.current),u)break;return null;case 22:return i.lanes=0,fg(s,i,o,i.pendingProps);case 24:gs(i,ut,s.memoizedState.cache)}return Yn(s,i,o)}function Tg(s,i,o){if(s!==null)if(s.memoizedProps!==i.pendingProps)dt=!0;else{if(!Xc(s,o)&&(i.flags&128)===0)return dt=!1,xA(s,i,o);dt=(s.flags&131072)!==0}else dt=!1,Pe&&(i.flags&1048576)!==0&&Zm(i,Xi,i.index);switch(i.lanes=0,i.tag){case 16:e:{var u=i.pendingProps;if(s=ra(i.elementType),i.type=s,typeof s=="function")tc(s)?(u=ca(s,u),i.tag=1,i=gg(null,i,s,u,o)):(i.tag=0,i=Gc(null,i,s,u,o));else{if(s!=null){var g=s.$$typeof;if(g===M){i.tag=11,i=ug(null,i,s,u,o);break e}else if(g===k){i.tag=14,i=cg(null,i,s,u,o);break e}}throw i=fe(s)||s,Error(a(306,i,""))}}return i;case 0:return Gc(s,i,i.type,i.pendingProps,o);case 1:return u=i.type,g=ca(u,i.pendingProps),gg(s,i,u,g,o);case 3:e:{if(tt(i,i.stateNode.containerInfo),s===null)throw Error(a(387));u=i.pendingProps;var S=i.memoizedState;g=S.element,gc(s,i),ar(i,u,null,o);var b=i.memoizedState;if(u=b.cache,gs(i,ut,u),u!==S.cache&&cc(i,[ut],o,!0),sr(),u=b.element,S.isDehydrated)if(S={element:u,isDehydrated:!1,cache:b.cache},i.updateQueue.baseState=S,i.memoizedState=S,i.flags&256){i=yg(s,i,u,o);break e}else if(u!==g){g=on(Error(a(424)),i),Qi(g),i=yg(s,i,u,o);break e}else{switch(s=i.stateNode.containerInfo,s.nodeType){case 9:s=s.body;break;default:s=s.nodeName==="HTML"?s.ownerDocument.body:s}for(je=fn(s.firstChild),bt=i,Pe=!0,ms=null,cn=!0,o=fh(i,null,u,o),i.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling}else{if(na(),u===g){i=Yn(s,i,o);break e}At(s,i,u,o)}i=i.child}return i;case 26:return Yo(s,i),s===null?(o=Dy(i.type,null,i.pendingProps,null))?i.memoizedState=o:Pe||(o=i.type,s=i.pendingProps,u=ul(xe.current).createElement(o),u[Tt]=i,u[Ot]=s,wt(u,o,s),vt(u),i.stateNode=u):i.memoizedState=Dy(i.type,s.memoizedProps,i.pendingProps,s.memoizedState),null;case 27:return wn(i),s===null&&Pe&&(u=i.stateNode=Iy(i.type,i.pendingProps,xe.current),bt=i,cn=!0,g=je,Is(i.type)?(Id=g,je=fn(u.firstChild)):je=g),At(s,i,i.pendingProps.children,o),Yo(s,i),s===null&&(i.flags|=4194304),i.child;case 5:return s===null&&Pe&&((g=u=je)&&(u=ZA(u,i.type,i.pendingProps,cn),u!==null?(i.stateNode=u,bt=i,je=fn(u.firstChild),cn=!1,g=!0):g=!1),g||hs(i)),wn(i),g=i.type,S=i.pendingProps,b=s!==null?s.memoizedProps:null,u=S.children,Ad(g,S)?u=null:b!==null&&Ad(g,b)&&(i.flags|=32),i.memoizedState!==null&&(g=xc(s,i,mA,null,null,o),Ar._currentValue=g),Yo(s,i),At(s,i,u,o),i.child;case 6:return s===null&&Pe&&((s=o=je)&&(o=ew(o,i.pendingProps,cn),o!==null?(i.stateNode=o,bt=i,je=null,s=!0):s=!1),s||hs(i)),null;case 13:return vg(s,i,o);case 4:return tt(i,i.stateNode.containerInfo),u=i.pendingProps,s===null?i.child=la(i,null,u,o):At(s,i,u,o),i.child;case 11:return ug(s,i,i.type,i.pendingProps,o);case 7:return At(s,i,i.pendingProps,o),i.child;case 8:return At(s,i,i.pendingProps.children,o),i.child;case 12:return At(s,i,i.pendingProps.children,o),i.child;case 10:return u=i.pendingProps,gs(i,i.type,u.value),At(s,i,u.children,o),i.child;case 9:return g=i.type._context,u=i.pendingProps.children,aa(i),g=xt(g),u=u(g),i.flags|=1,At(s,i,u,o),i.child;case 14:return cg(s,i,i.type,i.pendingProps,o);case 15:return dg(s,i,i.type,i.pendingProps,o);case 19:return _g(s,i,o);case 31:return bA(s,i,o);case 22:return fg(s,i,o,i.pendingProps);case 24:return aa(i),u=xt(ut),s===null?(g=pc(),g===null&&(g=Je,S=dc(),g.pooledCache=S,S.refCount++,S!==null&&(g.pooledCacheLanes|=o),g=S),i.memoizedState={parent:u,cache:g},hc(i),gs(i,ut,g)):((s.lanes&o)!==0&&(gc(s,i),ar(i,null,null,o),sr()),g=s.memoizedState,S=i.memoizedState,g.parent!==u?(g={parent:u,cache:u},i.memoizedState=g,i.lanes===0&&(i.memoizedState=i.updateQueue.baseState=g),gs(i,ut,u)):(u=S.cache,gs(i,ut,u),u!==g.cache&&cc(i,[ut],o,!0))),At(s,i,i.pendingProps.children,o),i.child;case 29:throw i.pendingProps}throw Error(a(156,i.tag))}function Jn(s){s.flags|=4}function Qc(s,i,o,u,g){if((i=(s.mode&32)!==0)&&(i=!1),i){if(s.flags|=16777216,(g&335544128)===g)if(s.stateNode.complete)s.flags|=8192;else if(Kg())s.flags|=8192;else throw oa=Mo,mc}else s.flags&=-16777217}function bg(s,i){if(i.type!=="stylesheet"||(i.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!Oy(i))if(Kg())s.flags|=8192;else throw oa=Mo,mc}function Ko(s,i){i!==null&&(s.flags|=4),s.flags&16384&&(i=s.tag!==22?tm():536870912,s.lanes|=i,ei|=i)}function cr(s,i){if(!Pe)switch(s.tailMode){case"hidden":i=s.tail;for(var o=null;i!==null;)i.alternate!==null&&(o=i),i=i.sibling;o===null?s.tail=null:o.sibling=null;break;case"collapsed":o=s.tail;for(var u=null;o!==null;)o.alternate!==null&&(u=o),o=o.sibling;u===null?i||s.tail===null?s.tail=null:s.tail.sibling=null:u.sibling=null}}function Xe(s){var i=s.alternate!==null&&s.alternate.child===s.child,o=0,u=0;if(i)for(var g=s.child;g!==null;)o|=g.lanes|g.childLanes,u|=g.subtreeFlags&65011712,u|=g.flags&65011712,g.return=s,g=g.sibling;else for(g=s.child;g!==null;)o|=g.lanes|g.childLanes,u|=g.subtreeFlags,u|=g.flags,g.return=s,g=g.sibling;return s.subtreeFlags|=u,s.childLanes=o,i}function AA(s,i,o){var u=i.pendingProps;switch(ic(i),i.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Xe(i),null;case 1:return Xe(i),null;case 3:return o=i.stateNode,u=null,s!==null&&(u=s.memoizedState.cache),i.memoizedState.cache!==u&&(i.flags|=2048),Gn(ut),Ke(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(s===null||s.child===null)&&(Va(i)?Jn(i):s===null||s.memoizedState.isDehydrated&&(i.flags&256)===0||(i.flags|=1024,oc())),Xe(i),null;case 26:var g=i.type,S=i.memoizedState;return s===null?(Jn(i),S!==null?(Xe(i),bg(i,S)):(Xe(i),Qc(i,g,null,u,o))):S?S!==s.memoizedState?(Jn(i),Xe(i),bg(i,S)):(Xe(i),i.flags&=-16777217):(s=s.memoizedProps,s!==u&&Jn(i),Xe(i),Qc(i,g,s,u,o)),null;case 27:if(he(i),o=xe.current,g=i.type,s!==null&&i.stateNode!=null)s.memoizedProps!==u&&Jn(i);else{if(!u){if(i.stateNode===null)throw Error(a(166));return Xe(i),null}s=re.current,Va(i)?th(i):(s=Iy(g,u,o),i.stateNode=s,Jn(i))}return Xe(i),null;case 5:if(he(i),g=i.type,s!==null&&i.stateNode!=null)s.memoizedProps!==u&&Jn(i);else{if(!u){if(i.stateNode===null)throw Error(a(166));return Xe(i),null}if(S=re.current,Va(i))th(i);else{var b=ul(xe.current);switch(S){case 1:S=b.createElementNS("http://www.w3.org/2000/svg",g);break;case 2:S=b.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;default:switch(g){case"svg":S=b.createElementNS("http://www.w3.org/2000/svg",g);break;case"math":S=b.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;case"script":S=b.createElement("div"),S.innerHTML="<script><\/script>",S=S.removeChild(S.firstChild);break;case"select":S=typeof u.is=="string"?b.createElement("select",{is:u.is}):b.createElement("select"),u.multiple?S.multiple=!0:u.size&&(S.size=u.size);break;default:S=typeof u.is=="string"?b.createElement(g,{is:u.is}):b.createElement(g)}}S[Tt]=i,S[Ot]=u;e:for(b=i.child;b!==null;){if(b.tag===5||b.tag===6)S.appendChild(b.stateNode);else if(b.tag!==4&&b.tag!==27&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===i)break e;for(;b.sibling===null;){if(b.return===null||b.return===i)break e;b=b.return}b.sibling.return=b.return,b=b.sibling}i.stateNode=S;e:switch(wt(S,g,u),g){case"button":case"input":case"select":case"textarea":u=!!u.autoFocus;break e;case"img":u=!0;break e;default:u=!1}u&&Jn(i)}}return Xe(i),Qc(i,i.type,s===null?null:s.memoizedProps,i.pendingProps,o),null;case 6:if(s&&i.stateNode!=null)s.memoizedProps!==u&&Jn(i);else{if(typeof u!="string"&&i.stateNode===null)throw Error(a(166));if(s=xe.current,Va(i)){if(s=i.stateNode,o=i.memoizedProps,u=null,g=bt,g!==null)switch(g.tag){case 27:case 5:u=g.memoizedProps}s[Tt]=i,s=!!(s.nodeValue===o||u!==null&&u.suppressHydrationWarning===!0||vy(s.nodeValue,o)),s||hs(i,!0)}else s=ul(s).createTextNode(u),s[Tt]=i,i.stateNode=s}return Xe(i),null;case 31:if(o=i.memoizedState,s===null||s.memoizedState!==null){if(u=Va(i),o!==null){if(s===null){if(!u)throw Error(a(318));if(s=i.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(a(557));s[Tt]=i}else na(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;Xe(i),s=!1}else o=oc(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=o),s=!0;if(!s)return i.flags&256?(jt(i),i):(jt(i),null);if((i.flags&128)!==0)throw Error(a(558))}return Xe(i),null;case 13:if(u=i.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(g=Va(i),u!==null&&u.dehydrated!==null){if(s===null){if(!g)throw Error(a(318));if(g=i.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(a(317));g[Tt]=i}else na(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;Xe(i),g=!1}else g=oc(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=g),g=!0;if(!g)return i.flags&256?(jt(i),i):(jt(i),null)}return jt(i),(i.flags&128)!==0?(i.lanes=o,i):(o=u!==null,s=s!==null&&s.memoizedState!==null,o&&(u=i.child,g=null,u.alternate!==null&&u.alternate.memoizedState!==null&&u.alternate.memoizedState.cachePool!==null&&(g=u.alternate.memoizedState.cachePool.pool),S=null,u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(S=u.memoizedState.cachePool.pool),S!==g&&(u.flags|=2048)),o!==s&&o&&(i.child.flags|=8192),Ko(i,i.updateQueue),Xe(i),null);case 4:return Ke(),s===null&&Sd(i.stateNode.containerInfo),Xe(i),null;case 10:return Gn(i.type),Xe(i),null;case 19:if(X(it),u=i.memoizedState,u===null)return Xe(i),null;if(g=(i.flags&128)!==0,S=u.rendering,S===null)if(g)cr(u,!1);else{if(st!==0||s!==null&&(s.flags&128)!==0)for(s=i.child;s!==null;){if(S=ko(s),S!==null){for(i.flags|=128,cr(u,!1),s=S.updateQueue,i.updateQueue=s,Ko(i,s),i.subtreeFlags=0,s=o,o=i.child;o!==null;)Xm(o,s),o=o.sibling;return se(it,it.current&1|2),Pe&&Vn(i,u.treeForkCount),i.child}s=s.sibling}u.tail!==null&&ce()>Zo&&(i.flags|=128,g=!0,cr(u,!1),i.lanes=4194304)}else{if(!g)if(s=ko(S),s!==null){if(i.flags|=128,g=!0,s=s.updateQueue,i.updateQueue=s,Ko(i,s),cr(u,!0),u.tail===null&&u.tailMode==="hidden"&&!S.alternate&&!Pe)return Xe(i),null}else 2*ce()-u.renderingStartTime>Zo&&o!==536870912&&(i.flags|=128,g=!0,cr(u,!1),i.lanes=4194304);u.isBackwards?(S.sibling=i.child,i.child=S):(s=u.last,s!==null?s.sibling=S:i.child=S,u.last=S)}return u.tail!==null?(s=u.tail,u.rendering=s,u.tail=s.sibling,u.renderingStartTime=ce(),s.sibling=null,o=it.current,se(it,g?o&1|2:o&1),Pe&&Vn(i,u.treeForkCount),s):(Xe(i),null);case 22:case 23:return jt(i),_c(),u=i.memoizedState!==null,s!==null?s.memoizedState!==null!==u&&(i.flags|=8192):u&&(i.flags|=8192),u?(o&536870912)!==0&&(i.flags&128)===0&&(Xe(i),i.subtreeFlags&6&&(i.flags|=8192)):Xe(i),o=i.updateQueue,o!==null&&Ko(i,o.retryQueue),o=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(o=s.memoizedState.cachePool.pool),u=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(u=i.memoizedState.cachePool.pool),u!==o&&(i.flags|=2048),s!==null&&X(ia),null;case 24:return o=null,s!==null&&(o=s.memoizedState.cache),i.memoizedState.cache!==o&&(i.flags|=2048),Gn(ut),Xe(i),null;case 25:return null;case 30:return null}throw Error(a(156,i.tag))}function wA(s,i){switch(ic(i),i.tag){case 1:return s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 3:return Gn(ut),Ke(),s=i.flags,(s&65536)!==0&&(s&128)===0?(i.flags=s&-65537|128,i):null;case 26:case 27:case 5:return he(i),null;case 31:if(i.memoizedState!==null){if(jt(i),i.alternate===null)throw Error(a(340));na()}return s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 13:if(jt(i),s=i.memoizedState,s!==null&&s.dehydrated!==null){if(i.alternate===null)throw Error(a(340));na()}return s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 19:return X(it),null;case 4:return Ke(),null;case 10:return Gn(i.type),null;case 22:case 23:return jt(i),_c(),s!==null&&X(ia),s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 24:return Gn(ut),null;case 25:return null;default:return null}}function xg(s,i){switch(ic(i),i.tag){case 3:Gn(ut),Ke();break;case 26:case 27:case 5:he(i);break;case 4:Ke();break;case 31:i.memoizedState!==null&&jt(i);break;case 13:jt(i);break;case 19:X(it);break;case 10:Gn(i.type);break;case 22:case 23:jt(i),_c(),s!==null&&X(ia);break;case 24:Gn(ut)}}function dr(s,i){try{var o=i.updateQueue,u=o!==null?o.lastEffect:null;if(u!==null){var g=u.next;o=g;do{if((o.tag&s)===s){u=void 0;var S=o.create,b=o.inst;u=S(),b.destroy=u}o=o.next}while(o!==g)}}catch(E){Ve(i,i.return,E)}}function bs(s,i,o){try{var u=i.updateQueue,g=u!==null?u.lastEffect:null;if(g!==null){var S=g.next;u=S;do{if((u.tag&s)===s){var b=u.inst,E=b.destroy;if(E!==void 0){b.destroy=void 0,g=i;var D=o,V=E;try{V()}catch(J){Ve(g,D,J)}}}u=u.next}while(u!==S)}}catch(J){Ve(i,i.return,J)}}function Ag(s){var i=s.updateQueue;if(i!==null){var o=s.stateNode;try{mh(i,o)}catch(u){Ve(s,s.return,u)}}}function wg(s,i,o){o.props=ca(s.type,s.memoizedProps),o.state=s.memoizedState;try{o.componentWillUnmount()}catch(u){Ve(s,i,u)}}function fr(s,i){try{var o=s.ref;if(o!==null){switch(s.tag){case 26:case 27:case 5:var u=s.stateNode;break;case 30:u=s.stateNode;break;default:u=s.stateNode}typeof o=="function"?s.refCleanup=o(u):o.current=u}}catch(g){Ve(s,i,g)}}function Rn(s,i){var o=s.ref,u=s.refCleanup;if(o!==null)if(typeof u=="function")try{u()}catch(g){Ve(s,i,g)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof o=="function")try{o(null)}catch(g){Ve(s,i,g)}else o.current=null}function Cg(s){var i=s.type,o=s.memoizedProps,u=s.stateNode;try{e:switch(i){case"button":case"input":case"select":case"textarea":o.autoFocus&&u.focus();break e;case"img":o.src?u.src=o.src:o.srcSet&&(u.srcset=o.srcSet)}}catch(g){Ve(s,s.return,g)}}function Wc(s,i,o){try{var u=s.stateNode;JA(u,s.type,o,i),u[Ot]=i}catch(g){Ve(s,s.return,g)}}function Eg(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&Is(s.type)||s.tag===4}function Zc(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||Eg(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&Is(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function ed(s,i,o){var u=s.tag;if(u===5||u===6)s=s.stateNode,i?(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o).insertBefore(s,i):(i=o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,i.appendChild(s),o=o._reactRootContainer,o!=null||i.onclick!==null||(i.onclick=qn));else if(u!==4&&(u===27&&Is(s.type)&&(o=s.stateNode,i=null),s=s.child,s!==null))for(ed(s,i,o),s=s.sibling;s!==null;)ed(s,i,o),s=s.sibling}function jo(s,i,o){var u=s.tag;if(u===5||u===6)s=s.stateNode,i?o.insertBefore(s,i):o.appendChild(s);else if(u!==4&&(u===27&&Is(s.type)&&(o=s.stateNode),s=s.child,s!==null))for(jo(s,i,o),s=s.sibling;s!==null;)jo(s,i,o),s=s.sibling}function Ng(s){var i=s.stateNode,o=s.memoizedProps;try{for(var u=s.type,g=i.attributes;g.length;)i.removeAttributeNode(g[0]);wt(i,u,o),i[Tt]=s,i[Ot]=o}catch(S){Ve(s,s.return,S)}}var Kn=!1,ft=!1,td=!1,Ig=typeof WeakSet=="function"?WeakSet:Set,St=null;function CA(s,i){if(s=s.containerInfo,bd=gl,s=Vm(s),Ku(s)){if("selectionStart"in s)var o={start:s.selectionStart,end:s.selectionEnd};else e:{o=(o=s.ownerDocument)&&o.defaultView||window;var u=o.getSelection&&o.getSelection();if(u&&u.rangeCount!==0){o=u.anchorNode;var g=u.anchorOffset,S=u.focusNode;u=u.focusOffset;try{o.nodeType,S.nodeType}catch{o=null;break e}var b=0,E=-1,D=-1,V=0,J=0,Q=s,F=null;t:for(;;){for(var G;Q!==o||g!==0&&Q.nodeType!==3||(E=b+g),Q!==S||u!==0&&Q.nodeType!==3||(D=b+u),Q.nodeType===3&&(b+=Q.nodeValue.length),(G=Q.firstChild)!==null;)F=Q,Q=G;for(;;){if(Q===s)break t;if(F===o&&++V===g&&(E=b),F===S&&++J===u&&(D=b),(G=Q.nextSibling)!==null)break;Q=F,F=Q.parentNode}Q=G}o=E===-1||D===-1?null:{start:E,end:D}}else o=null}o=o||{start:0,end:0}}else o=null;for(xd={focusedElem:s,selectionRange:o},gl=!1,St=i;St!==null;)if(i=St,s=i.child,(i.subtreeFlags&1028)!==0&&s!==null)s.return=i,St=s;else for(;St!==null;){switch(i=St,S=i.alternate,s=i.flags,i.tag){case 0:if((s&4)!==0&&(s=i.updateQueue,s=s!==null?s.events:null,s!==null))for(o=0;o<s.length;o++)g=s[o],g.ref.impl=g.nextImpl;break;case 11:case 15:break;case 1:if((s&1024)!==0&&S!==null){s=void 0,o=i,g=S.memoizedProps,S=S.memoizedState,u=o.stateNode;try{var le=ca(o.type,g);s=u.getSnapshotBeforeUpdate(le,S),u.__reactInternalSnapshotBeforeUpdate=s}catch(ye){Ve(o,o.return,ye)}}break;case 3:if((s&1024)!==0){if(s=i.stateNode.containerInfo,o=s.nodeType,o===9)Cd(s);else if(o===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":Cd(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(a(163))}if(s=i.sibling,s!==null){s.return=i.return,St=s;break}St=i.return}}function Rg(s,i,o){var u=o.flags;switch(o.tag){case 0:case 11:case 15:Xn(s,o),u&4&&dr(5,o);break;case 1:if(Xn(s,o),u&4)if(s=o.stateNode,i===null)try{s.componentDidMount()}catch(b){Ve(o,o.return,b)}else{var g=ca(o.type,i.memoizedProps);i=i.memoizedState;try{s.componentDidUpdate(g,i,s.__reactInternalSnapshotBeforeUpdate)}catch(b){Ve(o,o.return,b)}}u&64&&Ag(o),u&512&&fr(o,o.return);break;case 3:if(Xn(s,o),u&64&&(s=o.updateQueue,s!==null)){if(i=null,o.child!==null)switch(o.child.tag){case 27:case 5:i=o.child.stateNode;break;case 1:i=o.child.stateNode}try{mh(s,i)}catch(b){Ve(o,o.return,b)}}break;case 27:i===null&&u&4&&Ng(o);case 26:case 5:Xn(s,o),i===null&&u&4&&Cg(o),u&512&&fr(o,o.return);break;case 12:Xn(s,o);break;case 31:Xn(s,o),u&4&&Pg(s,o);break;case 13:Xn(s,o),u&4&&Lg(s,o),u&64&&(s=o.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(o=kA.bind(null,o),tw(s,o))));break;case 22:if(u=o.memoizedState!==null||Kn,!u){i=i!==null&&i.memoizedState!==null||ft,g=Kn;var S=ft;Kn=u,(ft=i)&&!S?Qn(s,o,(o.subtreeFlags&8772)!==0):Xn(s,o),Kn=g,ft=S}break;case 30:break;default:Xn(s,o)}}function Mg(s){var i=s.alternate;i!==null&&(s.alternate=null,Mg(i)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(i=s.stateNode,i!==null&&Mu(i)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var We=null,Bt=!1;function jn(s,i,o){for(o=o.child;o!==null;)Dg(s,i,o),o=o.sibling}function Dg(s,i,o){if(Pt&&typeof Pt.onCommitFiberUnmount=="function")try{Pt.onCommitFiberUnmount(Ks,o)}catch{}switch(o.tag){case 26:ft||Rn(o,i),jn(s,i,o),o.memoizedState?o.memoizedState.count--:o.stateNode&&(o=o.stateNode,o.parentNode.removeChild(o));break;case 27:ft||Rn(o,i);var u=We,g=Bt;Is(o.type)&&(We=o.stateNode,Bt=!1),jn(s,i,o),Tr(o.stateNode),We=u,Bt=g;break;case 5:ft||Rn(o,i);case 6:if(u=We,g=Bt,We=null,jn(s,i,o),We=u,Bt=g,We!==null)if(Bt)try{(We.nodeType===9?We.body:We.nodeName==="HTML"?We.ownerDocument.body:We).removeChild(o.stateNode)}catch(S){Ve(o,i,S)}else try{We.removeChild(o.stateNode)}catch(S){Ve(o,i,S)}break;case 18:We!==null&&(Bt?(s=We,Ay(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,o.stateNode),li(s)):Ay(We,o.stateNode));break;case 4:u=We,g=Bt,We=o.stateNode.containerInfo,Bt=!0,jn(s,i,o),We=u,Bt=g;break;case 0:case 11:case 14:case 15:bs(2,o,i),ft||bs(4,o,i),jn(s,i,o);break;case 1:ft||(Rn(o,i),u=o.stateNode,typeof u.componentWillUnmount=="function"&&wg(o,i,u)),jn(s,i,o);break;case 21:jn(s,i,o);break;case 22:ft=(u=ft)||o.memoizedState!==null,jn(s,i,o),ft=u;break;default:jn(s,i,o)}}function Pg(s,i){if(i.memoizedState===null&&(s=i.alternate,s!==null&&(s=s.memoizedState,s!==null))){s=s.dehydrated;try{li(s)}catch(o){Ve(i,i.return,o)}}}function Lg(s,i){if(i.memoizedState===null&&(s=i.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{li(s)}catch(o){Ve(i,i.return,o)}}function EA(s){switch(s.tag){case 31:case 13:case 19:var i=s.stateNode;return i===null&&(i=s.stateNode=new Ig),i;case 22:return s=s.stateNode,i=s._retryCache,i===null&&(i=s._retryCache=new Ig),i;default:throw Error(a(435,s.tag))}}function Xo(s,i){var o=EA(s);i.forEach(function(u){if(!o.has(u)){o.add(u);var g=UA.bind(null,s,u);u.then(g,g)}})}function Ht(s,i){var o=i.deletions;if(o!==null)for(var u=0;u<o.length;u++){var g=o[u],S=s,b=i,E=b;e:for(;E!==null;){switch(E.tag){case 27:if(Is(E.type)){We=E.stateNode,Bt=!1;break e}break;case 5:We=E.stateNode,Bt=!1;break e;case 3:case 4:We=E.stateNode.containerInfo,Bt=!0;break e}E=E.return}if(We===null)throw Error(a(160));Dg(S,b,g),We=null,Bt=!1,S=g.alternate,S!==null&&(S.return=null),g.return=null}if(i.subtreeFlags&13886)for(i=i.child;i!==null;)kg(i,s),i=i.sibling}var vn=null;function kg(s,i){var o=s.alternate,u=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:Ht(i,s),Vt(s),u&4&&(bs(3,s,s.return),dr(3,s),bs(5,s,s.return));break;case 1:Ht(i,s),Vt(s),u&512&&(ft||o===null||Rn(o,o.return)),u&64&&Kn&&(s=s.updateQueue,s!==null&&(u=s.callbacks,u!==null&&(o=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=o===null?u:o.concat(u))));break;case 26:var g=vn;if(Ht(i,s),Vt(s),u&512&&(ft||o===null||Rn(o,o.return)),u&4){var S=o!==null?o.memoizedState:null;if(u=s.memoizedState,o===null)if(u===null)if(s.stateNode===null){e:{u=s.type,o=s.memoizedProps,g=g.ownerDocument||g;t:switch(u){case"title":S=g.getElementsByTagName("title")[0],(!S||S[Bi]||S[Tt]||S.namespaceURI==="http://www.w3.org/2000/svg"||S.hasAttribute("itemprop"))&&(S=g.createElement(u),g.head.insertBefore(S,g.querySelector("head > title"))),wt(S,u,o),S[Tt]=s,vt(S),u=S;break e;case"link":var b=ky("link","href",g).get(u+(o.href||""));if(b){for(var E=0;E<b.length;E++)if(S=b[E],S.getAttribute("href")===(o.href==null||o.href===""?null:o.href)&&S.getAttribute("rel")===(o.rel==null?null:o.rel)&&S.getAttribute("title")===(o.title==null?null:o.title)&&S.getAttribute("crossorigin")===(o.crossOrigin==null?null:o.crossOrigin)){b.splice(E,1);break t}}S=g.createElement(u),wt(S,u,o),g.head.appendChild(S);break;case"meta":if(b=ky("meta","content",g).get(u+(o.content||""))){for(E=0;E<b.length;E++)if(S=b[E],S.getAttribute("content")===(o.content==null?null:""+o.content)&&S.getAttribute("name")===(o.name==null?null:o.name)&&S.getAttribute("property")===(o.property==null?null:o.property)&&S.getAttribute("http-equiv")===(o.httpEquiv==null?null:o.httpEquiv)&&S.getAttribute("charset")===(o.charSet==null?null:o.charSet)){b.splice(E,1);break t}}S=g.createElement(u),wt(S,u,o),g.head.appendChild(S);break;default:throw Error(a(468,u))}S[Tt]=s,vt(S),u=S}s.stateNode=u}else Uy(g,s.type,s.stateNode);else s.stateNode=Ly(g,u,s.memoizedProps);else S!==u?(S===null?o.stateNode!==null&&(o=o.stateNode,o.parentNode.removeChild(o)):S.count--,u===null?Uy(g,s.type,s.stateNode):Ly(g,u,s.memoizedProps)):u===null&&s.stateNode!==null&&Wc(s,s.memoizedProps,o.memoizedProps)}break;case 27:Ht(i,s),Vt(s),u&512&&(ft||o===null||Rn(o,o.return)),o!==null&&u&4&&Wc(s,s.memoizedProps,o.memoizedProps);break;case 5:if(Ht(i,s),Vt(s),u&512&&(ft||o===null||Rn(o,o.return)),s.flags&32){g=s.stateNode;try{Ma(g,"")}catch(le){Ve(s,s.return,le)}}u&4&&s.stateNode!=null&&(g=s.memoizedProps,Wc(s,g,o!==null?o.memoizedProps:g)),u&1024&&(td=!0);break;case 6:if(Ht(i,s),Vt(s),u&4){if(s.stateNode===null)throw Error(a(162));u=s.memoizedProps,o=s.stateNode;try{o.nodeValue=u}catch(le){Ve(s,s.return,le)}}break;case 3:if(fl=null,g=vn,vn=cl(i.containerInfo),Ht(i,s),vn=g,Vt(s),u&4&&o!==null&&o.memoizedState.isDehydrated)try{li(i.containerInfo)}catch(le){Ve(s,s.return,le)}td&&(td=!1,Ug(s));break;case 4:u=vn,vn=cl(s.stateNode.containerInfo),Ht(i,s),Vt(s),vn=u;break;case 12:Ht(i,s),Vt(s);break;case 31:Ht(i,s),Vt(s),u&4&&(u=s.updateQueue,u!==null&&(s.updateQueue=null,Xo(s,u)));break;case 13:Ht(i,s),Vt(s),s.child.flags&8192&&s.memoizedState!==null!=(o!==null&&o.memoizedState!==null)&&(Wo=ce()),u&4&&(u=s.updateQueue,u!==null&&(s.updateQueue=null,Xo(s,u)));break;case 22:g=s.memoizedState!==null;var D=o!==null&&o.memoizedState!==null,V=Kn,J=ft;if(Kn=V||g,ft=J||D,Ht(i,s),ft=J,Kn=V,Vt(s),u&8192)e:for(i=s.stateNode,i._visibility=g?i._visibility&-2:i._visibility|1,g&&(o===null||D||Kn||ft||da(s)),o=null,i=s;;){if(i.tag===5||i.tag===26){if(o===null){D=o=i;try{if(S=D.stateNode,g)b=S.style,typeof b.setProperty=="function"?b.setProperty("display","none","important"):b.display="none";else{E=D.stateNode;var Q=D.memoizedProps.style,F=Q!=null&&Q.hasOwnProperty("display")?Q.display:null;E.style.display=F==null||typeof F=="boolean"?"":(""+F).trim()}}catch(le){Ve(D,D.return,le)}}}else if(i.tag===6){if(o===null){D=i;try{D.stateNode.nodeValue=g?"":D.memoizedProps}catch(le){Ve(D,D.return,le)}}}else if(i.tag===18){if(o===null){D=i;try{var G=D.stateNode;g?wy(G,!0):wy(D.stateNode,!1)}catch(le){Ve(D,D.return,le)}}}else if((i.tag!==22&&i.tag!==23||i.memoizedState===null||i===s)&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break e;for(;i.sibling===null;){if(i.return===null||i.return===s)break e;o===i&&(o=null),i=i.return}o===i&&(o=null),i.sibling.return=i.return,i=i.sibling}u&4&&(u=s.updateQueue,u!==null&&(o=u.retryQueue,o!==null&&(u.retryQueue=null,Xo(s,o))));break;case 19:Ht(i,s),Vt(s),u&4&&(u=s.updateQueue,u!==null&&(s.updateQueue=null,Xo(s,u)));break;case 30:break;case 21:break;default:Ht(i,s),Vt(s)}}function Vt(s){var i=s.flags;if(i&2){try{for(var o,u=s.return;u!==null;){if(Eg(u)){o=u;break}u=u.return}if(o==null)throw Error(a(160));switch(o.tag){case 27:var g=o.stateNode,S=Zc(s);jo(s,S,g);break;case 5:var b=o.stateNode;o.flags&32&&(Ma(b,""),o.flags&=-33);var E=Zc(s);jo(s,E,b);break;case 3:case 4:var D=o.stateNode.containerInfo,V=Zc(s);ed(s,V,D);break;default:throw Error(a(161))}}catch(J){Ve(s,s.return,J)}s.flags&=-3}i&4096&&(s.flags&=-4097)}function Ug(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var i=s;Ug(i),i.tag===5&&i.flags&1024&&i.stateNode.reset(),s=s.sibling}}function Xn(s,i){if(i.subtreeFlags&8772)for(i=i.child;i!==null;)Rg(s,i.alternate,i),i=i.sibling}function da(s){for(s=s.child;s!==null;){var i=s;switch(i.tag){case 0:case 11:case 14:case 15:bs(4,i,i.return),da(i);break;case 1:Rn(i,i.return);var o=i.stateNode;typeof o.componentWillUnmount=="function"&&wg(i,i.return,o),da(i);break;case 27:Tr(i.stateNode);case 26:case 5:Rn(i,i.return),da(i);break;case 22:i.memoizedState===null&&da(i);break;case 30:da(i);break;default:da(i)}s=s.sibling}}function Qn(s,i,o){for(o=o&&(i.subtreeFlags&8772)!==0,i=i.child;i!==null;){var u=i.alternate,g=s,S=i,b=S.flags;switch(S.tag){case 0:case 11:case 15:Qn(g,S,o),dr(4,S);break;case 1:if(Qn(g,S,o),u=S,g=u.stateNode,typeof g.componentDidMount=="function")try{g.componentDidMount()}catch(V){Ve(u,u.return,V)}if(u=S,g=u.updateQueue,g!==null){var E=u.stateNode;try{var D=g.shared.hiddenCallbacks;if(D!==null)for(g.shared.hiddenCallbacks=null,g=0;g<D.length;g++)ph(D[g],E)}catch(V){Ve(u,u.return,V)}}o&&b&64&&Ag(S),fr(S,S.return);break;case 27:Ng(S);case 26:case 5:Qn(g,S,o),o&&u===null&&b&4&&Cg(S),fr(S,S.return);break;case 12:Qn(g,S,o);break;case 31:Qn(g,S,o),o&&b&4&&Pg(g,S);break;case 13:Qn(g,S,o),o&&b&4&&Lg(g,S);break;case 22:S.memoizedState===null&&Qn(g,S,o),fr(S,S.return);break;case 30:break;default:Qn(g,S,o)}i=i.sibling}}function nd(s,i){var o=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(o=s.memoizedState.cachePool.pool),s=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(s=i.memoizedState.cachePool.pool),s!==o&&(s!=null&&s.refCount++,o!=null&&Wi(o))}function sd(s,i){s=null,i.alternate!==null&&(s=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==s&&(i.refCount++,s!=null&&Wi(s))}function Sn(s,i,o,u){if(i.subtreeFlags&10256)for(i=i.child;i!==null;)Og(s,i,o,u),i=i.sibling}function Og(s,i,o,u){var g=i.flags;switch(i.tag){case 0:case 11:case 15:Sn(s,i,o,u),g&2048&&dr(9,i);break;case 1:Sn(s,i,o,u);break;case 3:Sn(s,i,o,u),g&2048&&(s=null,i.alternate!==null&&(s=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==s&&(i.refCount++,s!=null&&Wi(s)));break;case 12:if(g&2048){Sn(s,i,o,u),s=i.stateNode;try{var S=i.memoizedProps,b=S.id,E=S.onPostCommit;typeof E=="function"&&E(b,i.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(D){Ve(i,i.return,D)}}else Sn(s,i,o,u);break;case 31:Sn(s,i,o,u);break;case 13:Sn(s,i,o,u);break;case 23:break;case 22:S=i.stateNode,b=i.alternate,i.memoizedState!==null?S._visibility&2?Sn(s,i,o,u):pr(s,i):S._visibility&2?Sn(s,i,o,u):(S._visibility|=2,Qa(s,i,o,u,(i.subtreeFlags&10256)!==0||!1)),g&2048&&nd(b,i);break;case 24:Sn(s,i,o,u),g&2048&&sd(i.alternate,i);break;default:Sn(s,i,o,u)}}function Qa(s,i,o,u,g){for(g=g&&((i.subtreeFlags&10256)!==0||!1),i=i.child;i!==null;){var S=s,b=i,E=o,D=u,V=b.flags;switch(b.tag){case 0:case 11:case 15:Qa(S,b,E,D,g),dr(8,b);break;case 23:break;case 22:var J=b.stateNode;b.memoizedState!==null?J._visibility&2?Qa(S,b,E,D,g):pr(S,b):(J._visibility|=2,Qa(S,b,E,D,g)),g&&V&2048&&nd(b.alternate,b);break;case 24:Qa(S,b,E,D,g),g&&V&2048&&sd(b.alternate,b);break;default:Qa(S,b,E,D,g)}i=i.sibling}}function pr(s,i){if(i.subtreeFlags&10256)for(i=i.child;i!==null;){var o=s,u=i,g=u.flags;switch(u.tag){case 22:pr(o,u),g&2048&&nd(u.alternate,u);break;case 24:pr(o,u),g&2048&&sd(u.alternate,u);break;default:pr(o,u)}i=i.sibling}}var mr=8192;function Wa(s,i,o){if(s.subtreeFlags&mr)for(s=s.child;s!==null;)qg(s,i,o),s=s.sibling}function qg(s,i,o){switch(s.tag){case 26:Wa(s,i,o),s.flags&mr&&s.memoizedState!==null&&pw(o,vn,s.memoizedState,s.memoizedProps);break;case 5:Wa(s,i,o);break;case 3:case 4:var u=vn;vn=cl(s.stateNode.containerInfo),Wa(s,i,o),vn=u;break;case 22:s.memoizedState===null&&(u=s.alternate,u!==null&&u.memoizedState!==null?(u=mr,mr=16777216,Wa(s,i,o),mr=u):Wa(s,i,o));break;default:Wa(s,i,o)}}function Bg(s){var i=s.alternate;if(i!==null&&(s=i.child,s!==null)){i.child=null;do i=s.sibling,s.sibling=null,s=i;while(s!==null)}}function hr(s){var i=s.deletions;if((s.flags&16)!==0){if(i!==null)for(var o=0;o<i.length;o++){var u=i[o];St=u,Vg(u,s)}Bg(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Hg(s),s=s.sibling}function Hg(s){switch(s.tag){case 0:case 11:case 15:hr(s),s.flags&2048&&bs(9,s,s.return);break;case 3:hr(s);break;case 12:hr(s);break;case 22:var i=s.stateNode;s.memoizedState!==null&&i._visibility&2&&(s.return===null||s.return.tag!==13)?(i._visibility&=-3,Qo(s)):hr(s);break;default:hr(s)}}function Qo(s){var i=s.deletions;if((s.flags&16)!==0){if(i!==null)for(var o=0;o<i.length;o++){var u=i[o];St=u,Vg(u,s)}Bg(s)}for(s=s.child;s!==null;){switch(i=s,i.tag){case 0:case 11:case 15:bs(8,i,i.return),Qo(i);break;case 22:o=i.stateNode,o._visibility&2&&(o._visibility&=-3,Qo(i));break;default:Qo(i)}s=s.sibling}}function Vg(s,i){for(;St!==null;){var o=St;switch(o.tag){case 0:case 11:case 15:bs(8,o,i);break;case 23:case 22:if(o.memoizedState!==null&&o.memoizedState.cachePool!==null){var u=o.memoizedState.cachePool.pool;u!=null&&u.refCount++}break;case 24:Wi(o.memoizedState.cache)}if(u=o.child,u!==null)u.return=o,St=u;else e:for(o=s;St!==null;){u=St;var g=u.sibling,S=u.return;if(Mg(u),u===o){St=null;break e}if(g!==null){g.return=S,St=g;break e}St=S}}}var NA={getCacheForType:function(s){var i=xt(ut),o=i.data.get(s);return o===void 0&&(o=s(),i.data.set(s,o)),o},cacheSignal:function(){return xt(ut).controller.signal}},IA=typeof WeakMap=="function"?WeakMap:Map,Be=0,Je=null,Ne=null,Me=0,He=0,Xt=null,xs=!1,Za=!1,ad=!1,Wn=0,st=0,As=0,fa=0,id=0,Qt=0,ei=0,gr=null,Ft=null,rd=!1,Wo=0,Fg=0,Zo=1/0,el=null,ws=null,pt=0,Cs=null,ti=null,Zn=0,od=0,ld=null,Gg=null,yr=0,ud=null;function Wt(){return(Be&2)!==0&&Me!==0?Me&-Me:O.T!==null?hd():im()}function zg(){if(Qt===0)if((Me&536870912)===0||Pe){var s=oo;oo<<=1,(oo&3932160)===0&&(oo=262144),Qt=s}else Qt=536870912;return s=Kt.current,s!==null&&(s.flags|=32),Qt}function Gt(s,i,o){(s===Je&&(He===2||He===9)||s.cancelPendingCommit!==null)&&(ni(s,0),Es(s,Me,Qt,!1)),qi(s,o),((Be&2)===0||s!==Je)&&(s===Je&&((Be&2)===0&&(fa|=o),st===4&&Es(s,Me,Qt,!1)),Mn(s))}function $g(s,i,o){if((Be&6)!==0)throw Error(a(327));var u=!o&&(i&127)===0&&(i&s.expiredLanes)===0||Oi(s,i),g=u?DA(s,i):dd(s,i,!0),S=u;do{if(g===0){Za&&!u&&Es(s,i,0,!1);break}else{if(o=s.current.alternate,S&&!RA(o)){g=dd(s,i,!1),S=!1;continue}if(g===2){if(S=i,s.errorRecoveryDisabledLanes&S)var b=0;else b=s.pendingLanes&-536870913,b=b!==0?b:b&536870912?536870912:0;if(b!==0){i=b;e:{var E=s;g=gr;var D=E.current.memoizedState.isDehydrated;if(D&&(ni(E,b).flags|=256),b=dd(E,b,!1),b!==2){if(ad&&!D){E.errorRecoveryDisabledLanes|=S,fa|=S,g=4;break e}S=Ft,Ft=g,S!==null&&(Ft===null?Ft=S:Ft.push.apply(Ft,S))}g=b}if(S=!1,g!==2)continue}}if(g===1){ni(s,0),Es(s,i,0,!0);break}e:{switch(u=s,S=g,S){case 0:case 1:throw Error(a(345));case 4:if((i&4194048)!==i)break;case 6:Es(u,i,Qt,!xs);break e;case 2:Ft=null;break;case 3:case 5:break;default:throw Error(a(329))}if((i&62914560)===i&&(g=Wo+300-ce(),10<g)){if(Es(u,i,Qt,!xs),uo(u,0,!0)!==0)break e;Zn=i,u.timeoutHandle=by(Yg.bind(null,u,o,Ft,el,rd,i,Qt,fa,ei,xs,S,"Throttled",-0,0),g);break e}Yg(u,o,Ft,el,rd,i,Qt,fa,ei,xs,S,null,-0,0)}}break}while(!0);Mn(s)}function Yg(s,i,o,u,g,S,b,E,D,V,J,Q,F,G){if(s.timeoutHandle=-1,Q=i.subtreeFlags,Q&8192||(Q&16785408)===16785408){Q={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:qn},qg(i,S,Q);var le=(S&62914560)===S?Wo-ce():(S&4194048)===S?Fg-ce():0;if(le=mw(Q,le),le!==null){Zn=S,s.cancelPendingCommit=le(ey.bind(null,s,i,S,o,u,g,b,E,D,J,Q,null,F,G)),Es(s,S,b,!V);return}}ey(s,i,S,o,u,g,b,E,D)}function RA(s){for(var i=s;;){var o=i.tag;if((o===0||o===11||o===15)&&i.flags&16384&&(o=i.updateQueue,o!==null&&(o=o.stores,o!==null)))for(var u=0;u<o.length;u++){var g=o[u],S=g.getSnapshot;g=g.value;try{if(!Yt(S(),g))return!1}catch{return!1}}if(o=i.child,i.subtreeFlags&16384&&o!==null)o.return=i,i=o;else{if(i===s)break;for(;i.sibling===null;){if(i.return===null||i.return===s)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function Es(s,i,o,u){i&=~id,i&=~fa,s.suspendedLanes|=i,s.pingedLanes&=~i,u&&(s.warmLanes|=i),u=s.expirationTimes;for(var g=i;0<g;){var S=31-Lt(g),b=1<<S;u[S]=-1,g&=~b}o!==0&&nm(s,o,i)}function tl(){return(Be&6)===0?(vr(0),!1):!0}function cd(){if(Ne!==null){if(He===0)var s=Ne.return;else s=Ne,Fn=sa=null,Cc(s),Ya=null,er=0,s=Ne;for(;s!==null;)xg(s.alternate,s),s=s.return;Ne=null}}function ni(s,i){var o=s.timeoutHandle;o!==-1&&(s.timeoutHandle=-1,XA(o)),o=s.cancelPendingCommit,o!==null&&(s.cancelPendingCommit=null,o()),Zn=0,cd(),Je=s,Ne=o=Hn(s.current,null),Me=i,He=0,Xt=null,xs=!1,Za=Oi(s,i),ad=!1,ei=Qt=id=fa=As=st=0,Ft=gr=null,rd=!1,(i&8)!==0&&(i|=i&32);var u=s.entangledLanes;if(u!==0)for(s=s.entanglements,u&=i;0<u;){var g=31-Lt(u),S=1<<g;i|=s[g],u&=~S}return Wn=i,bo(),o}function Jg(s,i){Ce=null,O.H=lr,i===$a||i===Ro?(i=uh(),He=3):i===mc?(i=uh(),He=4):He=i===Fc?8:i!==null&&typeof i=="object"&&typeof i.then=="function"?6:1,Xt=i,Ne===null&&(st=1,zo(s,on(i,s.current)))}function Kg(){var s=Kt.current;return s===null?!0:(Me&4194048)===Me?dn===null:(Me&62914560)===Me||(Me&536870912)!==0?s===dn:!1}function jg(){var s=O.H;return O.H=lr,s===null?lr:s}function Xg(){var s=O.A;return O.A=NA,s}function nl(){st=4,xs||(Me&4194048)!==Me&&Kt.current!==null||(Za=!0),(As&134217727)===0&&(fa&134217727)===0||Je===null||Es(Je,Me,Qt,!1)}function dd(s,i,o){var u=Be;Be|=2;var g=jg(),S=Xg();(Je!==s||Me!==i)&&(el=null,ni(s,i)),i=!1;var b=st;e:do try{if(He!==0&&Ne!==null){var E=Ne,D=Xt;switch(He){case 8:cd(),b=6;break e;case 3:case 2:case 9:case 6:Kt.current===null&&(i=!0);var V=He;if(He=0,Xt=null,si(s,E,D,V),o&&Za){b=0;break e}break;default:V=He,He=0,Xt=null,si(s,E,D,V)}}MA(),b=st;break}catch(J){Jg(s,J)}while(!0);return i&&s.shellSuspendCounter++,Fn=sa=null,Be=u,O.H=g,O.A=S,Ne===null&&(Je=null,Me=0,bo()),b}function MA(){for(;Ne!==null;)Qg(Ne)}function DA(s,i){var o=Be;Be|=2;var u=jg(),g=Xg();Je!==s||Me!==i?(el=null,Zo=ce()+500,ni(s,i)):Za=Oi(s,i);e:do try{if(He!==0&&Ne!==null){i=Ne;var S=Xt;t:switch(He){case 1:He=0,Xt=null,si(s,i,S,1);break;case 2:case 9:if(oh(S)){He=0,Xt=null,Wg(i);break}i=function(){He!==2&&He!==9||Je!==s||(He=7),Mn(s)},S.then(i,i);break e;case 3:He=7;break e;case 4:He=5;break e;case 7:oh(S)?(He=0,Xt=null,Wg(i)):(He=0,Xt=null,si(s,i,S,7));break;case 5:var b=null;switch(Ne.tag){case 26:b=Ne.memoizedState;case 5:case 27:var E=Ne;if(b?Oy(b):E.stateNode.complete){He=0,Xt=null;var D=E.sibling;if(D!==null)Ne=D;else{var V=E.return;V!==null?(Ne=V,sl(V)):Ne=null}break t}}He=0,Xt=null,si(s,i,S,5);break;case 6:He=0,Xt=null,si(s,i,S,6);break;case 8:cd(),st=6;break e;default:throw Error(a(462))}}PA();break}catch(J){Jg(s,J)}while(!0);return Fn=sa=null,O.H=u,O.A=g,Be=o,Ne!==null?0:(Je=null,Me=0,bo(),st)}function PA(){for(;Ne!==null&&!yt();)Qg(Ne)}function Qg(s){var i=Tg(s.alternate,s,Wn);s.memoizedProps=s.pendingProps,i===null?sl(s):Ne=i}function Wg(s){var i=s,o=i.alternate;switch(i.tag){case 15:case 0:i=hg(o,i,i.pendingProps,i.type,void 0,Me);break;case 11:i=hg(o,i,i.pendingProps,i.type.render,i.ref,Me);break;case 5:Cc(i);default:xg(o,i),i=Ne=Xm(i,Wn),i=Tg(o,i,Wn)}s.memoizedProps=s.pendingProps,i===null?sl(s):Ne=i}function si(s,i,o,u){Fn=sa=null,Cc(i),Ya=null,er=0;var g=i.return;try{if(TA(s,g,i,o,Me)){st=1,zo(s,on(o,s.current)),Ne=null;return}}catch(S){if(g!==null)throw Ne=g,S;st=1,zo(s,on(o,s.current)),Ne=null;return}i.flags&32768?(Pe||u===1?s=!0:Za||(Me&536870912)!==0?s=!1:(xs=s=!0,(u===2||u===9||u===3||u===6)&&(u=Kt.current,u!==null&&u.tag===13&&(u.flags|=16384))),Zg(i,s)):sl(i)}function sl(s){var i=s;do{if((i.flags&32768)!==0){Zg(i,xs);return}s=i.return;var o=AA(i.alternate,i,Wn);if(o!==null){Ne=o;return}if(i=i.sibling,i!==null){Ne=i;return}Ne=i=s}while(i!==null);st===0&&(st=5)}function Zg(s,i){do{var o=wA(s.alternate,s);if(o!==null){o.flags&=32767,Ne=o;return}if(o=s.return,o!==null&&(o.flags|=32768,o.subtreeFlags=0,o.deletions=null),!i&&(s=s.sibling,s!==null)){Ne=s;return}Ne=s=o}while(s!==null);st=6,Ne=null}function ey(s,i,o,u,g,S,b,E,D){s.cancelPendingCommit=null;do al();while(pt!==0);if((Be&6)!==0)throw Error(a(327));if(i!==null){if(i===s.current)throw Error(a(177));if(S=i.lanes|i.childLanes,S|=Zu,fx(s,o,S,b,E,D),s===Je&&(Ne=Je=null,Me=0),ti=i,Cs=s,Zn=o,od=S,ld=g,Gg=u,(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,OA(Js,function(){return iy(),null})):(s.callbackNode=null,s.callbackPriority=0),u=(i.flags&13878)!==0,(i.subtreeFlags&13878)!==0||u){u=O.T,O.T=null,g=K.p,K.p=2,b=Be,Be|=4;try{CA(s,i,o)}finally{Be=b,K.p=g,O.T=u}}pt=1,ty(),ny(),sy()}}function ty(){if(pt===1){pt=0;var s=Cs,i=ti,o=(i.flags&13878)!==0;if((i.subtreeFlags&13878)!==0||o){o=O.T,O.T=null;var u=K.p;K.p=2;var g=Be;Be|=4;try{kg(i,s);var S=xd,b=Vm(s.containerInfo),E=S.focusedElem,D=S.selectionRange;if(b!==E&&E&&E.ownerDocument&&Hm(E.ownerDocument.documentElement,E)){if(D!==null&&Ku(E)){var V=D.start,J=D.end;if(J===void 0&&(J=V),"selectionStart"in E)E.selectionStart=V,E.selectionEnd=Math.min(J,E.value.length);else{var Q=E.ownerDocument||document,F=Q&&Q.defaultView||window;if(F.getSelection){var G=F.getSelection(),le=E.textContent.length,ye=Math.min(D.start,le),ze=D.end===void 0?ye:Math.min(D.end,le);!G.extend&&ye>ze&&(b=ze,ze=ye,ye=b);var q=Bm(E,ye),U=Bm(E,ze);if(q&&U&&(G.rangeCount!==1||G.anchorNode!==q.node||G.anchorOffset!==q.offset||G.focusNode!==U.node||G.focusOffset!==U.offset)){var H=Q.createRange();H.setStart(q.node,q.offset),G.removeAllRanges(),ye>ze?(G.addRange(H),G.extend(U.node,U.offset)):(H.setEnd(U.node,U.offset),G.addRange(H))}}}}for(Q=[],G=E;G=G.parentNode;)G.nodeType===1&&Q.push({element:G,left:G.scrollLeft,top:G.scrollTop});for(typeof E.focus=="function"&&E.focus(),E=0;E<Q.length;E++){var j=Q[E];j.element.scrollLeft=j.left,j.element.scrollTop=j.top}}gl=!!bd,xd=bd=null}finally{Be=g,K.p=u,O.T=o}}s.current=i,pt=2}}function ny(){if(pt===2){pt=0;var s=Cs,i=ti,o=(i.flags&8772)!==0;if((i.subtreeFlags&8772)!==0||o){o=O.T,O.T=null;var u=K.p;K.p=2;var g=Be;Be|=4;try{Rg(s,i.alternate,i)}finally{Be=g,K.p=u,O.T=o}}pt=3}}function sy(){if(pt===4||pt===3){pt=0,$s();var s=Cs,i=ti,o=Zn,u=Gg;(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?pt=5:(pt=0,ti=Cs=null,ay(s,s.pendingLanes));var g=s.pendingLanes;if(g===0&&(ws=null),Iu(o),i=i.stateNode,Pt&&typeof Pt.onCommitFiberRoot=="function")try{Pt.onCommitFiberRoot(Ks,i,void 0,(i.current.flags&128)===128)}catch{}if(u!==null){i=O.T,g=K.p,K.p=2,O.T=null;try{for(var S=s.onRecoverableError,b=0;b<u.length;b++){var E=u[b];S(E.value,{componentStack:E.stack})}}finally{O.T=i,K.p=g}}(Zn&3)!==0&&al(),Mn(s),g=s.pendingLanes,(o&261930)!==0&&(g&42)!==0?s===ud?yr++:(yr=0,ud=s):yr=0,vr(0)}}function ay(s,i){(s.pooledCacheLanes&=i)===0&&(i=s.pooledCache,i!=null&&(s.pooledCache=null,Wi(i)))}function al(){return ty(),ny(),sy(),iy()}function iy(){if(pt!==5)return!1;var s=Cs,i=od;od=0;var o=Iu(Zn),u=O.T,g=K.p;try{K.p=32>o?32:o,O.T=null,o=ld,ld=null;var S=Cs,b=Zn;if(pt=0,ti=Cs=null,Zn=0,(Be&6)!==0)throw Error(a(331));var E=Be;if(Be|=4,Hg(S.current),Og(S,S.current,b,o),Be=E,vr(0,!1),Pt&&typeof Pt.onPostCommitFiberRoot=="function")try{Pt.onPostCommitFiberRoot(Ks,S)}catch{}return!0}finally{K.p=g,O.T=u,ay(s,i)}}function ry(s,i,o){i=on(o,i),i=Vc(s.stateNode,i,2),s=Ss(s,i,2),s!==null&&(qi(s,2),Mn(s))}function Ve(s,i,o){if(s.tag===3)ry(s,s,o);else for(;i!==null;){if(i.tag===3){ry(i,s,o);break}else if(i.tag===1){var u=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof u.componentDidCatch=="function"&&(ws===null||!ws.has(u))){s=on(o,s),o=og(2),u=Ss(i,o,2),u!==null&&(lg(o,u,i,s),qi(u,2),Mn(u));break}}i=i.return}}function fd(s,i,o){var u=s.pingCache;if(u===null){u=s.pingCache=new IA;var g=new Set;u.set(i,g)}else g=u.get(i),g===void 0&&(g=new Set,u.set(i,g));g.has(o)||(ad=!0,g.add(o),s=LA.bind(null,s,i,o),i.then(s,s))}function LA(s,i,o){var u=s.pingCache;u!==null&&u.delete(i),s.pingedLanes|=s.suspendedLanes&o,s.warmLanes&=~o,Je===s&&(Me&o)===o&&(st===4||st===3&&(Me&62914560)===Me&&300>ce()-Wo?(Be&2)===0&&ni(s,0):id|=o,ei===Me&&(ei=0)),Mn(s)}function oy(s,i){i===0&&(i=tm()),s=ea(s,i),s!==null&&(qi(s,i),Mn(s))}function kA(s){var i=s.memoizedState,o=0;i!==null&&(o=i.retryLane),oy(s,o)}function UA(s,i){var o=0;switch(s.tag){case 31:case 13:var u=s.stateNode,g=s.memoizedState;g!==null&&(o=g.retryLane);break;case 19:u=s.stateNode;break;case 22:u=s.stateNode._retryCache;break;default:throw Error(a(314))}u!==null&&u.delete(i),oy(s,o)}function OA(s,i){return Re(s,i)}var il=null,ai=null,pd=!1,rl=!1,md=!1,Ns=0;function Mn(s){s!==ai&&s.next===null&&(ai===null?il=ai=s:ai=ai.next=s),rl=!0,pd||(pd=!0,BA())}function vr(s,i){if(!md&&rl){md=!0;do for(var o=!1,u=il;u!==null;){if(s!==0){var g=u.pendingLanes;if(g===0)var S=0;else{var b=u.suspendedLanes,E=u.pingedLanes;S=(1<<31-Lt(42|s)+1)-1,S&=g&~(b&~E),S=S&201326741?S&201326741|1:S?S|2:0}S!==0&&(o=!0,dy(u,S))}else S=Me,S=uo(u,u===Je?S:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),(S&3)===0||Oi(u,S)||(o=!0,dy(u,S));u=u.next}while(o);md=!1}}function qA(){ly()}function ly(){rl=pd=!1;var s=0;Ns!==0&&jA()&&(s=Ns);for(var i=ce(),o=null,u=il;u!==null;){var g=u.next,S=uy(u,i);S===0?(u.next=null,o===null?il=g:o.next=g,g===null&&(ai=o)):(o=u,(s!==0||(S&3)!==0)&&(rl=!0)),u=g}pt!==0&&pt!==5||vr(s),Ns!==0&&(Ns=0)}function uy(s,i){for(var o=s.suspendedLanes,u=s.pingedLanes,g=s.expirationTimes,S=s.pendingLanes&-62914561;0<S;){var b=31-Lt(S),E=1<<b,D=g[b];D===-1?((E&o)===0||(E&u)!==0)&&(g[b]=dx(E,i)):D<=i&&(s.expiredLanes|=E),S&=~E}if(i=Je,o=Me,o=uo(s,s===i?o:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),u=s.callbackNode,o===0||s===i&&(He===2||He===9)||s.cancelPendingCommit!==null)return u!==null&&u!==null&&Dt(u),s.callbackNode=null,s.callbackPriority=0;if((o&3)===0||Oi(s,o)){if(i=o&-o,i===s.callbackPriority)return i;switch(u!==null&&Dt(u),Iu(o)){case 2:case 8:o=Ys;break;case 32:o=Js;break;case 268435456:o=ao;break;default:o=Js}return u=cy.bind(null,s),o=Re(o,u),s.callbackPriority=i,s.callbackNode=o,i}return u!==null&&u!==null&&Dt(u),s.callbackPriority=2,s.callbackNode=null,2}function cy(s,i){if(pt!==0&&pt!==5)return s.callbackNode=null,s.callbackPriority=0,null;var o=s.callbackNode;if(al()&&s.callbackNode!==o)return null;var u=Me;return u=uo(s,s===Je?u:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),u===0?null:($g(s,u,i),uy(s,ce()),s.callbackNode!=null&&s.callbackNode===o?cy.bind(null,s):null)}function dy(s,i){if(al())return null;$g(s,i,!0)}function BA(){QA(function(){(Be&6)!==0?Re(nn,qA):ly()})}function hd(){if(Ns===0){var s=Ga;s===0&&(s=ro,ro<<=1,(ro&261888)===0&&(ro=256)),Ns=s}return Ns}function fy(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:mo(""+s)}function py(s,i){var o=i.ownerDocument.createElement("input");return o.name=i.name,o.value=i.value,s.id&&o.setAttribute("form",s.id),i.parentNode.insertBefore(o,i),s=new FormData(s),o.parentNode.removeChild(o),s}function HA(s,i,o,u,g){if(i==="submit"&&o&&o.stateNode===g){var S=fy((g[Ot]||null).action),b=u.submitter;b&&(i=(i=b[Ot]||null)?fy(i.formAction):b.getAttribute("formAction"),i!==null&&(S=i,b=null));var E=new vo("action","action",null,u,g);s.push({event:E,listeners:[{instance:null,listener:function(){if(u.defaultPrevented){if(Ns!==0){var D=b?py(g,b):new FormData(g);kc(o,{pending:!0,data:D,method:g.method,action:S},null,D)}}else typeof S=="function"&&(E.preventDefault(),D=b?py(g,b):new FormData(g),kc(o,{pending:!0,data:D,method:g.method,action:S},S,D))},currentTarget:g}]})}}for(var gd=0;gd<Wu.length;gd++){var yd=Wu[gd],VA=yd.toLowerCase(),FA=yd[0].toUpperCase()+yd.slice(1);yn(VA,"on"+FA)}yn(zm,"onAnimationEnd"),yn($m,"onAnimationIteration"),yn(Ym,"onAnimationStart"),yn("dblclick","onDoubleClick"),yn("focusin","onFocus"),yn("focusout","onBlur"),yn(aA,"onTransitionRun"),yn(iA,"onTransitionStart"),yn(rA,"onTransitionCancel"),yn(Jm,"onTransitionEnd"),Ia("onMouseEnter",["mouseout","mouseover"]),Ia("onMouseLeave",["mouseout","mouseover"]),Ia("onPointerEnter",["pointerout","pointerover"]),Ia("onPointerLeave",["pointerout","pointerover"]),Xs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Xs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Xs("onBeforeInput",["compositionend","keypress","textInput","paste"]),Xs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Xs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Xs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Sr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),GA=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Sr));function my(s,i){i=(i&4)!==0;for(var o=0;o<s.length;o++){var u=s[o],g=u.event;u=u.listeners;e:{var S=void 0;if(i)for(var b=u.length-1;0<=b;b--){var E=u[b],D=E.instance,V=E.currentTarget;if(E=E.listener,D!==S&&g.isPropagationStopped())break e;S=E,g.currentTarget=V;try{S(g)}catch(J){To(J)}g.currentTarget=null,S=D}else for(b=0;b<u.length;b++){if(E=u[b],D=E.instance,V=E.currentTarget,E=E.listener,D!==S&&g.isPropagationStopped())break e;S=E,g.currentTarget=V;try{S(g)}catch(J){To(J)}g.currentTarget=null,S=D}}}}function Ie(s,i){var o=i[Ru];o===void 0&&(o=i[Ru]=new Set);var u=s+"__bubble";o.has(u)||(hy(i,s,2,!1),o.add(u))}function vd(s,i,o){var u=0;i&&(u|=4),hy(o,s,u,i)}var ol="_reactListening"+Math.random().toString(36).slice(2);function Sd(s){if(!s[ol]){s[ol]=!0,lm.forEach(function(o){o!=="selectionchange"&&(GA.has(o)||vd(o,!1,s),vd(o,!0,s))});var i=s.nodeType===9?s:s.ownerDocument;i===null||i[ol]||(i[ol]=!0,vd("selectionchange",!1,i))}}function hy(s,i,o,u){switch(zy(i)){case 2:var g=yw;break;case 8:g=vw;break;default:g=Ld}o=g.bind(null,i,o,s),g=void 0,!Bu||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(g=!0),u?g!==void 0?s.addEventListener(i,o,{capture:!0,passive:g}):s.addEventListener(i,o,!0):g!==void 0?s.addEventListener(i,o,{passive:g}):s.addEventListener(i,o,!1)}function _d(s,i,o,u,g){var S=u;if((i&1)===0&&(i&2)===0&&u!==null)e:for(;;){if(u===null)return;var b=u.tag;if(b===3||b===4){var E=u.stateNode.containerInfo;if(E===g)break;if(b===4)for(b=u.return;b!==null;){var D=b.tag;if((D===3||D===4)&&b.stateNode.containerInfo===g)return;b=b.return}for(;E!==null;){if(b=Ca(E),b===null)return;if(D=b.tag,D===5||D===6||D===26||D===27){u=S=b;continue e}E=E.parentNode}}u=u.return}_m(function(){var V=S,J=Ou(o),Q=[];e:{var F=Km.get(s);if(F!==void 0){var G=vo,le=s;switch(s){case"keypress":if(go(o)===0)break e;case"keydown":case"keyup":G=Ux;break;case"focusin":le="focus",G=Gu;break;case"focusout":le="blur",G=Gu;break;case"beforeblur":case"afterblur":G=Gu;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":G=xm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":G=Ax;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":G=Bx;break;case zm:case $m:case Ym:G=Ex;break;case Jm:G=Vx;break;case"scroll":case"scrollend":G=bx;break;case"wheel":G=Gx;break;case"copy":case"cut":case"paste":G=Ix;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":G=wm;break;case"toggle":case"beforetoggle":G=$x}var ye=(i&4)!==0,ze=!ye&&(s==="scroll"||s==="scrollend"),q=ye?F!==null?F+"Capture":null:F;ye=[];for(var U=V,H;U!==null;){var j=U;if(H=j.stateNode,j=j.tag,j!==5&&j!==26&&j!==27||H===null||q===null||(j=Vi(U,q),j!=null&&ye.push(_r(U,j,H))),ze)break;U=U.return}0<ye.length&&(F=new G(F,le,null,o,J),Q.push({event:F,listeners:ye}))}}if((i&7)===0){e:{if(F=s==="mouseover"||s==="pointerover",G=s==="mouseout"||s==="pointerout",F&&o!==Uu&&(le=o.relatedTarget||o.fromElement)&&(Ca(le)||le[wa]))break e;if((G||F)&&(F=J.window===J?J:(F=J.ownerDocument)?F.defaultView||F.parentWindow:window,G?(le=o.relatedTarget||o.toElement,G=V,le=le?Ca(le):null,le!==null&&(ze=l(le),ye=le.tag,le!==ze||ye!==5&&ye!==27&&ye!==6)&&(le=null)):(G=null,le=V),G!==le)){if(ye=xm,j="onMouseLeave",q="onMouseEnter",U="mouse",(s==="pointerout"||s==="pointerover")&&(ye=wm,j="onPointerLeave",q="onPointerEnter",U="pointer"),ze=G==null?F:Hi(G),H=le==null?F:Hi(le),F=new ye(j,U+"leave",G,o,J),F.target=ze,F.relatedTarget=H,j=null,Ca(J)===V&&(ye=new ye(q,U+"enter",le,o,J),ye.target=H,ye.relatedTarget=ze,j=ye),ze=j,G&&le)t:{for(ye=zA,q=G,U=le,H=0,j=q;j;j=ye(j))H++;j=0;for(var me=U;me;me=ye(me))j++;for(;0<H-j;)q=ye(q),H--;for(;0<j-H;)U=ye(U),j--;for(;H--;){if(q===U||U!==null&&q===U.alternate){ye=q;break t}q=ye(q),U=ye(U)}ye=null}else ye=null;G!==null&&gy(Q,F,G,ye,!1),le!==null&&ze!==null&&gy(Q,ze,le,ye,!0)}}e:{if(F=V?Hi(V):window,G=F.nodeName&&F.nodeName.toLowerCase(),G==="select"||G==="input"&&F.type==="file")var Le=Pm;else if(Mm(F))if(Lm)Le=tA;else{Le=Zx;var de=Wx}else G=F.nodeName,!G||G.toLowerCase()!=="input"||F.type!=="checkbox"&&F.type!=="radio"?V&&ku(V.elementType)&&(Le=Pm):Le=eA;if(Le&&(Le=Le(s,V))){Dm(Q,Le,o,J);break e}de&&de(s,F,V),s==="focusout"&&V&&F.type==="number"&&V.memoizedProps.value!=null&&Lu(F,"number",F.value)}switch(de=V?Hi(V):window,s){case"focusin":(Mm(de)||de.contentEditable==="true")&&(ka=de,ju=V,ji=null);break;case"focusout":ji=ju=ka=null;break;case"mousedown":Xu=!0;break;case"contextmenu":case"mouseup":case"dragend":Xu=!1,Fm(Q,o,J);break;case"selectionchange":if(sA)break;case"keydown":case"keyup":Fm(Q,o,J)}var Ee;if($u)e:{switch(s){case"compositionstart":var De="onCompositionStart";break e;case"compositionend":De="onCompositionEnd";break e;case"compositionupdate":De="onCompositionUpdate";break e}De=void 0}else La?Im(s,o)&&(De="onCompositionEnd"):s==="keydown"&&o.keyCode===229&&(De="onCompositionStart");De&&(Cm&&o.locale!=="ko"&&(La||De!=="onCompositionStart"?De==="onCompositionEnd"&&La&&(Ee=Tm()):(fs=J,Hu="value"in fs?fs.value:fs.textContent,La=!0)),de=ll(V,De),0<de.length&&(De=new Am(De,s,null,o,J),Q.push({event:De,listeners:de}),Ee?De.data=Ee:(Ee=Rm(o),Ee!==null&&(De.data=Ee)))),(Ee=Jx?Kx(s,o):jx(s,o))&&(De=ll(V,"onBeforeInput"),0<De.length&&(de=new Am("onBeforeInput","beforeinput",null,o,J),Q.push({event:de,listeners:De}),de.data=Ee)),HA(Q,s,V,o,J)}my(Q,i)})}function _r(s,i,o){return{instance:s,listener:i,currentTarget:o}}function ll(s,i){for(var o=i+"Capture",u=[];s!==null;){var g=s,S=g.stateNode;if(g=g.tag,g!==5&&g!==26&&g!==27||S===null||(g=Vi(s,o),g!=null&&u.unshift(_r(s,g,S)),g=Vi(s,i),g!=null&&u.push(_r(s,g,S))),s.tag===3)return u;s=s.return}return[]}function zA(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function gy(s,i,o,u,g){for(var S=i._reactName,b=[];o!==null&&o!==u;){var E=o,D=E.alternate,V=E.stateNode;if(E=E.tag,D!==null&&D===u)break;E!==5&&E!==26&&E!==27||V===null||(D=V,g?(V=Vi(o,S),V!=null&&b.unshift(_r(o,V,D))):g||(V=Vi(o,S),V!=null&&b.push(_r(o,V,D)))),o=o.return}b.length!==0&&s.push({event:i,listeners:b})}var $A=/\r\n?/g,YA=/\u0000|\uFFFD/g;function yy(s){return(typeof s=="string"?s:""+s).replace($A,`
`).replace(YA,"")}function vy(s,i){return i=yy(i),yy(s)===i}function Ge(s,i,o,u,g,S){switch(o){case"children":typeof u=="string"?i==="body"||i==="textarea"&&u===""||Ma(s,u):(typeof u=="number"||typeof u=="bigint")&&i!=="body"&&Ma(s,""+u);break;case"className":fo(s,"class",u);break;case"tabIndex":fo(s,"tabindex",u);break;case"dir":case"role":case"viewBox":case"width":case"height":fo(s,o,u);break;case"style":vm(s,u,S);break;case"data":if(i!=="object"){fo(s,"data",u);break}case"src":case"href":if(u===""&&(i!=="a"||o!=="href")){s.removeAttribute(o);break}if(u==null||typeof u=="function"||typeof u=="symbol"||typeof u=="boolean"){s.removeAttribute(o);break}u=mo(""+u),s.setAttribute(o,u);break;case"action":case"formAction":if(typeof u=="function"){s.setAttribute(o,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof S=="function"&&(o==="formAction"?(i!=="input"&&Ge(s,i,"name",g.name,g,null),Ge(s,i,"formEncType",g.formEncType,g,null),Ge(s,i,"formMethod",g.formMethod,g,null),Ge(s,i,"formTarget",g.formTarget,g,null)):(Ge(s,i,"encType",g.encType,g,null),Ge(s,i,"method",g.method,g,null),Ge(s,i,"target",g.target,g,null)));if(u==null||typeof u=="symbol"||typeof u=="boolean"){s.removeAttribute(o);break}u=mo(""+u),s.setAttribute(o,u);break;case"onClick":u!=null&&(s.onclick=qn);break;case"onScroll":u!=null&&Ie("scroll",s);break;case"onScrollEnd":u!=null&&Ie("scrollend",s);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(a(61));if(o=u.__html,o!=null){if(g.children!=null)throw Error(a(60));s.innerHTML=o}}break;case"multiple":s.multiple=u&&typeof u!="function"&&typeof u!="symbol";break;case"muted":s.muted=u&&typeof u!="function"&&typeof u!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(u==null||typeof u=="function"||typeof u=="boolean"||typeof u=="symbol"){s.removeAttribute("xlink:href");break}o=mo(""+u),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":u!=null&&typeof u!="function"&&typeof u!="symbol"?s.setAttribute(o,""+u):s.removeAttribute(o);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":u&&typeof u!="function"&&typeof u!="symbol"?s.setAttribute(o,""):s.removeAttribute(o);break;case"capture":case"download":u===!0?s.setAttribute(o,""):u!==!1&&u!=null&&typeof u!="function"&&typeof u!="symbol"?s.setAttribute(o,u):s.removeAttribute(o);break;case"cols":case"rows":case"size":case"span":u!=null&&typeof u!="function"&&typeof u!="symbol"&&!isNaN(u)&&1<=u?s.setAttribute(o,u):s.removeAttribute(o);break;case"rowSpan":case"start":u==null||typeof u=="function"||typeof u=="symbol"||isNaN(u)?s.removeAttribute(o):s.setAttribute(o,u);break;case"popover":Ie("beforetoggle",s),Ie("toggle",s),co(s,"popover",u);break;case"xlinkActuate":On(s,"http://www.w3.org/1999/xlink","xlink:actuate",u);break;case"xlinkArcrole":On(s,"http://www.w3.org/1999/xlink","xlink:arcrole",u);break;case"xlinkRole":On(s,"http://www.w3.org/1999/xlink","xlink:role",u);break;case"xlinkShow":On(s,"http://www.w3.org/1999/xlink","xlink:show",u);break;case"xlinkTitle":On(s,"http://www.w3.org/1999/xlink","xlink:title",u);break;case"xlinkType":On(s,"http://www.w3.org/1999/xlink","xlink:type",u);break;case"xmlBase":On(s,"http://www.w3.org/XML/1998/namespace","xml:base",u);break;case"xmlLang":On(s,"http://www.w3.org/XML/1998/namespace","xml:lang",u);break;case"xmlSpace":On(s,"http://www.w3.org/XML/1998/namespace","xml:space",u);break;case"is":co(s,"is",u);break;case"innerText":case"textContent":break;default:(!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(o=_x.get(o)||o,co(s,o,u))}}function Td(s,i,o,u,g,S){switch(o){case"style":vm(s,u,S);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(a(61));if(o=u.__html,o!=null){if(g.children!=null)throw Error(a(60));s.innerHTML=o}}break;case"children":typeof u=="string"?Ma(s,u):(typeof u=="number"||typeof u=="bigint")&&Ma(s,""+u);break;case"onScroll":u!=null&&Ie("scroll",s);break;case"onScrollEnd":u!=null&&Ie("scrollend",s);break;case"onClick":u!=null&&(s.onclick=qn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!um.hasOwnProperty(o))e:{if(o[0]==="o"&&o[1]==="n"&&(g=o.endsWith("Capture"),i=o.slice(2,g?o.length-7:void 0),S=s[Ot]||null,S=S!=null?S[o]:null,typeof S=="function"&&s.removeEventListener(i,S,g),typeof u=="function")){typeof S!="function"&&S!==null&&(o in s?s[o]=null:s.hasAttribute(o)&&s.removeAttribute(o)),s.addEventListener(i,u,g);break e}o in s?s[o]=u:u===!0?s.setAttribute(o,""):co(s,o,u)}}}function wt(s,i,o){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ie("error",s),Ie("load",s);var u=!1,g=!1,S;for(S in o)if(o.hasOwnProperty(S)){var b=o[S];if(b!=null)switch(S){case"src":u=!0;break;case"srcSet":g=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(a(137,i));default:Ge(s,i,S,b,o,null)}}g&&Ge(s,i,"srcSet",o.srcSet,o,null),u&&Ge(s,i,"src",o.src,o,null);return;case"input":Ie("invalid",s);var E=S=b=g=null,D=null,V=null;for(u in o)if(o.hasOwnProperty(u)){var J=o[u];if(J!=null)switch(u){case"name":g=J;break;case"type":b=J;break;case"checked":D=J;break;case"defaultChecked":V=J;break;case"value":S=J;break;case"defaultValue":E=J;break;case"children":case"dangerouslySetInnerHTML":if(J!=null)throw Error(a(137,i));break;default:Ge(s,i,u,J,o,null)}}mm(s,S,E,D,V,b,g,!1);return;case"select":Ie("invalid",s),u=b=S=null;for(g in o)if(o.hasOwnProperty(g)&&(E=o[g],E!=null))switch(g){case"value":S=E;break;case"defaultValue":b=E;break;case"multiple":u=E;default:Ge(s,i,g,E,o,null)}i=S,o=b,s.multiple=!!u,i!=null?Ra(s,!!u,i,!1):o!=null&&Ra(s,!!u,o,!0);return;case"textarea":Ie("invalid",s),S=g=u=null;for(b in o)if(o.hasOwnProperty(b)&&(E=o[b],E!=null))switch(b){case"value":u=E;break;case"defaultValue":g=E;break;case"children":S=E;break;case"dangerouslySetInnerHTML":if(E!=null)throw Error(a(91));break;default:Ge(s,i,b,E,o,null)}gm(s,u,g,S);return;case"option":for(D in o)if(o.hasOwnProperty(D)&&(u=o[D],u!=null))switch(D){case"selected":s.selected=u&&typeof u!="function"&&typeof u!="symbol";break;default:Ge(s,i,D,u,o,null)}return;case"dialog":Ie("beforetoggle",s),Ie("toggle",s),Ie("cancel",s),Ie("close",s);break;case"iframe":case"object":Ie("load",s);break;case"video":case"audio":for(u=0;u<Sr.length;u++)Ie(Sr[u],s);break;case"image":Ie("error",s),Ie("load",s);break;case"details":Ie("toggle",s);break;case"embed":case"source":case"link":Ie("error",s),Ie("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(V in o)if(o.hasOwnProperty(V)&&(u=o[V],u!=null))switch(V){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,i));default:Ge(s,i,V,u,o,null)}return;default:if(ku(i)){for(J in o)o.hasOwnProperty(J)&&(u=o[J],u!==void 0&&Td(s,i,J,u,o,void 0));return}}for(E in o)o.hasOwnProperty(E)&&(u=o[E],u!=null&&Ge(s,i,E,u,o,null))}function JA(s,i,o,u){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var g=null,S=null,b=null,E=null,D=null,V=null,J=null;for(G in o){var Q=o[G];if(o.hasOwnProperty(G)&&Q!=null)switch(G){case"checked":break;case"value":break;case"defaultValue":D=Q;default:u.hasOwnProperty(G)||Ge(s,i,G,null,u,Q)}}for(var F in u){var G=u[F];if(Q=o[F],u.hasOwnProperty(F)&&(G!=null||Q!=null))switch(F){case"type":S=G;break;case"name":g=G;break;case"checked":V=G;break;case"defaultChecked":J=G;break;case"value":b=G;break;case"defaultValue":E=G;break;case"children":case"dangerouslySetInnerHTML":if(G!=null)throw Error(a(137,i));break;default:G!==Q&&Ge(s,i,F,G,u,Q)}}Pu(s,b,E,D,V,J,S,g);return;case"select":G=b=E=F=null;for(S in o)if(D=o[S],o.hasOwnProperty(S)&&D!=null)switch(S){case"value":break;case"multiple":G=D;default:u.hasOwnProperty(S)||Ge(s,i,S,null,u,D)}for(g in u)if(S=u[g],D=o[g],u.hasOwnProperty(g)&&(S!=null||D!=null))switch(g){case"value":F=S;break;case"defaultValue":E=S;break;case"multiple":b=S;default:S!==D&&Ge(s,i,g,S,u,D)}i=E,o=b,u=G,F!=null?Ra(s,!!o,F,!1):!!u!=!!o&&(i!=null?Ra(s,!!o,i,!0):Ra(s,!!o,o?[]:"",!1));return;case"textarea":G=F=null;for(E in o)if(g=o[E],o.hasOwnProperty(E)&&g!=null&&!u.hasOwnProperty(E))switch(E){case"value":break;case"children":break;default:Ge(s,i,E,null,u,g)}for(b in u)if(g=u[b],S=o[b],u.hasOwnProperty(b)&&(g!=null||S!=null))switch(b){case"value":F=g;break;case"defaultValue":G=g;break;case"children":break;case"dangerouslySetInnerHTML":if(g!=null)throw Error(a(91));break;default:g!==S&&Ge(s,i,b,g,u,S)}hm(s,F,G);return;case"option":for(var le in o)if(F=o[le],o.hasOwnProperty(le)&&F!=null&&!u.hasOwnProperty(le))switch(le){case"selected":s.selected=!1;break;default:Ge(s,i,le,null,u,F)}for(D in u)if(F=u[D],G=o[D],u.hasOwnProperty(D)&&F!==G&&(F!=null||G!=null))switch(D){case"selected":s.selected=F&&typeof F!="function"&&typeof F!="symbol";break;default:Ge(s,i,D,F,u,G)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ye in o)F=o[ye],o.hasOwnProperty(ye)&&F!=null&&!u.hasOwnProperty(ye)&&Ge(s,i,ye,null,u,F);for(V in u)if(F=u[V],G=o[V],u.hasOwnProperty(V)&&F!==G&&(F!=null||G!=null))switch(V){case"children":case"dangerouslySetInnerHTML":if(F!=null)throw Error(a(137,i));break;default:Ge(s,i,V,F,u,G)}return;default:if(ku(i)){for(var ze in o)F=o[ze],o.hasOwnProperty(ze)&&F!==void 0&&!u.hasOwnProperty(ze)&&Td(s,i,ze,void 0,u,F);for(J in u)F=u[J],G=o[J],!u.hasOwnProperty(J)||F===G||F===void 0&&G===void 0||Td(s,i,J,F,u,G);return}}for(var q in o)F=o[q],o.hasOwnProperty(q)&&F!=null&&!u.hasOwnProperty(q)&&Ge(s,i,q,null,u,F);for(Q in u)F=u[Q],G=o[Q],!u.hasOwnProperty(Q)||F===G||F==null&&G==null||Ge(s,i,Q,F,u,G)}function Sy(s){switch(s){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function KA(){if(typeof performance.getEntriesByType=="function"){for(var s=0,i=0,o=performance.getEntriesByType("resource"),u=0;u<o.length;u++){var g=o[u],S=g.transferSize,b=g.initiatorType,E=g.duration;if(S&&E&&Sy(b)){for(b=0,E=g.responseEnd,u+=1;u<o.length;u++){var D=o[u],V=D.startTime;if(V>E)break;var J=D.transferSize,Q=D.initiatorType;J&&Sy(Q)&&(D=D.responseEnd,b+=J*(D<E?1:(E-V)/(D-V)))}if(--u,i+=8*(S+b)/(g.duration/1e3),s++,10<s)break}}if(0<s)return i/s/1e6}return navigator.connection&&(s=navigator.connection.downlink,typeof s=="number")?s:5}var bd=null,xd=null;function ul(s){return s.nodeType===9?s:s.ownerDocument}function _y(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Ty(s,i){if(s===0)switch(i){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&i==="foreignObject"?0:s}function Ad(s,i){return s==="textarea"||s==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.children=="bigint"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var wd=null;function jA(){var s=window.event;return s&&s.type==="popstate"?s===wd?!1:(wd=s,!0):(wd=null,!1)}var by=typeof setTimeout=="function"?setTimeout:void 0,XA=typeof clearTimeout=="function"?clearTimeout:void 0,xy=typeof Promise=="function"?Promise:void 0,QA=typeof queueMicrotask=="function"?queueMicrotask:typeof xy<"u"?function(s){return xy.resolve(null).then(s).catch(WA)}:by;function WA(s){setTimeout(function(){throw s})}function Is(s){return s==="head"}function Ay(s,i){var o=i,u=0;do{var g=o.nextSibling;if(s.removeChild(o),g&&g.nodeType===8)if(o=g.data,o==="/$"||o==="/&"){if(u===0){s.removeChild(g),li(i);return}u--}else if(o==="$"||o==="$?"||o==="$~"||o==="$!"||o==="&")u++;else if(o==="html")Tr(s.ownerDocument.documentElement);else if(o==="head"){o=s.ownerDocument.head,Tr(o);for(var S=o.firstChild;S;){var b=S.nextSibling,E=S.nodeName;S[Bi]||E==="SCRIPT"||E==="STYLE"||E==="LINK"&&S.rel.toLowerCase()==="stylesheet"||o.removeChild(S),S=b}}else o==="body"&&Tr(s.ownerDocument.body);o=g}while(o);li(i)}function wy(s,i){var o=s;s=0;do{var u=o.nextSibling;if(o.nodeType===1?i?(o._stashedDisplay=o.style.display,o.style.display="none"):(o.style.display=o._stashedDisplay||"",o.getAttribute("style")===""&&o.removeAttribute("style")):o.nodeType===3&&(i?(o._stashedText=o.nodeValue,o.nodeValue=""):o.nodeValue=o._stashedText||""),u&&u.nodeType===8)if(o=u.data,o==="/$"){if(s===0)break;s--}else o!=="$"&&o!=="$?"&&o!=="$~"&&o!=="$!"||s++;o=u}while(o)}function Cd(s){var i=s.firstChild;for(i&&i.nodeType===10&&(i=i.nextSibling);i;){var o=i;switch(i=i.nextSibling,o.nodeName){case"HTML":case"HEAD":case"BODY":Cd(o),Mu(o);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(o.rel.toLowerCase()==="stylesheet")continue}s.removeChild(o)}}function ZA(s,i,o,u){for(;s.nodeType===1;){var g=o;if(s.nodeName.toLowerCase()!==i.toLowerCase()){if(!u&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(u){if(!s[Bi])switch(i){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(S=s.getAttribute("rel"),S==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(S!==g.rel||s.getAttribute("href")!==(g.href==null||g.href===""?null:g.href)||s.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin)||s.getAttribute("title")!==(g.title==null?null:g.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(S=s.getAttribute("src"),(S!==(g.src==null?null:g.src)||s.getAttribute("type")!==(g.type==null?null:g.type)||s.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin))&&S&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(i==="input"&&s.type==="hidden"){var S=g.name==null?null:""+g.name;if(g.type==="hidden"&&s.getAttribute("name")===S)return s}else return s;if(s=fn(s.nextSibling),s===null)break}return null}function ew(s,i,o){if(i==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!o||(s=fn(s.nextSibling),s===null))return null;return s}function Cy(s,i){for(;s.nodeType!==8;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!i||(s=fn(s.nextSibling),s===null))return null;return s}function Ed(s){return s.data==="$?"||s.data==="$~"}function Nd(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState!=="loading"}function tw(s,i){var o=s.ownerDocument;if(s.data==="$~")s._reactRetry=i;else if(s.data!=="$?"||o.readyState!=="loading")i();else{var u=function(){i(),o.removeEventListener("DOMContentLoaded",u)};o.addEventListener("DOMContentLoaded",u),s._reactRetry=u}}function fn(s){for(;s!=null;s=s.nextSibling){var i=s.nodeType;if(i===1||i===3)break;if(i===8){if(i=s.data,i==="$"||i==="$!"||i==="$?"||i==="$~"||i==="&"||i==="F!"||i==="F")break;if(i==="/$"||i==="/&")return null}}return s}var Id=null;function Ey(s){s=s.nextSibling;for(var i=0;s;){if(s.nodeType===8){var o=s.data;if(o==="/$"||o==="/&"){if(i===0)return fn(s.nextSibling);i--}else o!=="$"&&o!=="$!"&&o!=="$?"&&o!=="$~"&&o!=="&"||i++}s=s.nextSibling}return null}function Ny(s){s=s.previousSibling;for(var i=0;s;){if(s.nodeType===8){var o=s.data;if(o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"){if(i===0)return s;i--}else o!=="/$"&&o!=="/&"||i++}s=s.previousSibling}return null}function Iy(s,i,o){switch(i=ul(o),s){case"html":if(s=i.documentElement,!s)throw Error(a(452));return s;case"head":if(s=i.head,!s)throw Error(a(453));return s;case"body":if(s=i.body,!s)throw Error(a(454));return s;default:throw Error(a(451))}}function Tr(s){for(var i=s.attributes;i.length;)s.removeAttributeNode(i[0]);Mu(s)}var pn=new Map,Ry=new Set;function cl(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var es=K.d;K.d={f:nw,r:sw,D:aw,C:iw,L:rw,m:ow,X:uw,S:lw,M:cw};function nw(){var s=es.f(),i=tl();return s||i}function sw(s){var i=Ea(s);i!==null&&i.tag===5&&i.type==="form"?Jh(i):es.r(s)}var ii=typeof document>"u"?null:document;function My(s,i,o){var u=ii;if(u&&typeof i=="string"&&i){var g=an(i);g='link[rel="'+s+'"][href="'+g+'"]',typeof o=="string"&&(g+='[crossorigin="'+o+'"]'),Ry.has(g)||(Ry.add(g),s={rel:s,crossOrigin:o,href:i},u.querySelector(g)===null&&(i=u.createElement("link"),wt(i,"link",s),vt(i),u.head.appendChild(i)))}}function aw(s){es.D(s),My("dns-prefetch",s,null)}function iw(s,i){es.C(s,i),My("preconnect",s,i)}function rw(s,i,o){es.L(s,i,o);var u=ii;if(u&&s&&i){var g='link[rel="preload"][as="'+an(i)+'"]';i==="image"&&o&&o.imageSrcSet?(g+='[imagesrcset="'+an(o.imageSrcSet)+'"]',typeof o.imageSizes=="string"&&(g+='[imagesizes="'+an(o.imageSizes)+'"]')):g+='[href="'+an(s)+'"]';var S=g;switch(i){case"style":S=ri(s);break;case"script":S=oi(s)}pn.has(S)||(s=v({rel:"preload",href:i==="image"&&o&&o.imageSrcSet?void 0:s,as:i},o),pn.set(S,s),u.querySelector(g)!==null||i==="style"&&u.querySelector(br(S))||i==="script"&&u.querySelector(xr(S))||(i=u.createElement("link"),wt(i,"link",s),vt(i),u.head.appendChild(i)))}}function ow(s,i){es.m(s,i);var o=ii;if(o&&s){var u=i&&typeof i.as=="string"?i.as:"script",g='link[rel="modulepreload"][as="'+an(u)+'"][href="'+an(s)+'"]',S=g;switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":S=oi(s)}if(!pn.has(S)&&(s=v({rel:"modulepreload",href:s},i),pn.set(S,s),o.querySelector(g)===null)){switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(o.querySelector(xr(S)))return}u=o.createElement("link"),wt(u,"link",s),vt(u),o.head.appendChild(u)}}}function lw(s,i,o){es.S(s,i,o);var u=ii;if(u&&s){var g=Na(u).hoistableStyles,S=ri(s);i=i||"default";var b=g.get(S);if(!b){var E={loading:0,preload:null};if(b=u.querySelector(br(S)))E.loading=5;else{s=v({rel:"stylesheet",href:s,"data-precedence":i},o),(o=pn.get(S))&&Rd(s,o);var D=b=u.createElement("link");vt(D),wt(D,"link",s),D._p=new Promise(function(V,J){D.onload=V,D.onerror=J}),D.addEventListener("load",function(){E.loading|=1}),D.addEventListener("error",function(){E.loading|=2}),E.loading|=4,dl(b,i,u)}b={type:"stylesheet",instance:b,count:1,state:E},g.set(S,b)}}}function uw(s,i){es.X(s,i);var o=ii;if(o&&s){var u=Na(o).hoistableScripts,g=oi(s),S=u.get(g);S||(S=o.querySelector(xr(g)),S||(s=v({src:s,async:!0},i),(i=pn.get(g))&&Md(s,i),S=o.createElement("script"),vt(S),wt(S,"link",s),o.head.appendChild(S)),S={type:"script",instance:S,count:1,state:null},u.set(g,S))}}function cw(s,i){es.M(s,i);var o=ii;if(o&&s){var u=Na(o).hoistableScripts,g=oi(s),S=u.get(g);S||(S=o.querySelector(xr(g)),S||(s=v({src:s,async:!0,type:"module"},i),(i=pn.get(g))&&Md(s,i),S=o.createElement("script"),vt(S),wt(S,"link",s),o.head.appendChild(S)),S={type:"script",instance:S,count:1,state:null},u.set(g,S))}}function Dy(s,i,o,u){var g=(g=xe.current)?cl(g):null;if(!g)throw Error(a(446));switch(s){case"meta":case"title":return null;case"style":return typeof o.precedence=="string"&&typeof o.href=="string"?(i=ri(o.href),o=Na(g).hoistableStyles,u=o.get(i),u||(u={type:"style",instance:null,count:0,state:null},o.set(i,u)),u):{type:"void",instance:null,count:0,state:null};case"link":if(o.rel==="stylesheet"&&typeof o.href=="string"&&typeof o.precedence=="string"){s=ri(o.href);var S=Na(g).hoistableStyles,b=S.get(s);if(b||(g=g.ownerDocument||g,b={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},S.set(s,b),(S=g.querySelector(br(s)))&&!S._p&&(b.instance=S,b.state.loading=5),pn.has(s)||(o={rel:"preload",as:"style",href:o.href,crossOrigin:o.crossOrigin,integrity:o.integrity,media:o.media,hrefLang:o.hrefLang,referrerPolicy:o.referrerPolicy},pn.set(s,o),S||dw(g,s,o,b.state))),i&&u===null)throw Error(a(528,""));return b}if(i&&u!==null)throw Error(a(529,""));return null;case"script":return i=o.async,o=o.src,typeof o=="string"&&i&&typeof i!="function"&&typeof i!="symbol"?(i=oi(o),o=Na(g).hoistableScripts,u=o.get(i),u||(u={type:"script",instance:null,count:0,state:null},o.set(i,u)),u):{type:"void",instance:null,count:0,state:null};default:throw Error(a(444,s))}}function ri(s){return'href="'+an(s)+'"'}function br(s){return'link[rel="stylesheet"]['+s+"]"}function Py(s){return v({},s,{"data-precedence":s.precedence,precedence:null})}function dw(s,i,o,u){s.querySelector('link[rel="preload"][as="style"]['+i+"]")?u.loading=1:(i=s.createElement("link"),u.preload=i,i.addEventListener("load",function(){return u.loading|=1}),i.addEventListener("error",function(){return u.loading|=2}),wt(i,"link",o),vt(i),s.head.appendChild(i))}function oi(s){return'[src="'+an(s)+'"]'}function xr(s){return"script[async]"+s}function Ly(s,i,o){if(i.count++,i.instance===null)switch(i.type){case"style":var u=s.querySelector('style[data-href~="'+an(o.href)+'"]');if(u)return i.instance=u,vt(u),u;var g=v({},o,{"data-href":o.href,"data-precedence":o.precedence,href:null,precedence:null});return u=(s.ownerDocument||s).createElement("style"),vt(u),wt(u,"style",g),dl(u,o.precedence,s),i.instance=u;case"stylesheet":g=ri(o.href);var S=s.querySelector(br(g));if(S)return i.state.loading|=4,i.instance=S,vt(S),S;u=Py(o),(g=pn.get(g))&&Rd(u,g),S=(s.ownerDocument||s).createElement("link"),vt(S);var b=S;return b._p=new Promise(function(E,D){b.onload=E,b.onerror=D}),wt(S,"link",u),i.state.loading|=4,dl(S,o.precedence,s),i.instance=S;case"script":return S=oi(o.src),(g=s.querySelector(xr(S)))?(i.instance=g,vt(g),g):(u=o,(g=pn.get(S))&&(u=v({},o),Md(u,g)),s=s.ownerDocument||s,g=s.createElement("script"),vt(g),wt(g,"link",u),s.head.appendChild(g),i.instance=g);case"void":return null;default:throw Error(a(443,i.type))}else i.type==="stylesheet"&&(i.state.loading&4)===0&&(u=i.instance,i.state.loading|=4,dl(u,o.precedence,s));return i.instance}function dl(s,i,o){for(var u=o.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),g=u.length?u[u.length-1]:null,S=g,b=0;b<u.length;b++){var E=u[b];if(E.dataset.precedence===i)S=E;else if(S!==g)break}S?S.parentNode.insertBefore(s,S.nextSibling):(i=o.nodeType===9?o.head:o,i.insertBefore(s,i.firstChild))}function Rd(s,i){s.crossOrigin==null&&(s.crossOrigin=i.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=i.referrerPolicy),s.title==null&&(s.title=i.title)}function Md(s,i){s.crossOrigin==null&&(s.crossOrigin=i.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=i.referrerPolicy),s.integrity==null&&(s.integrity=i.integrity)}var fl=null;function ky(s,i,o){if(fl===null){var u=new Map,g=fl=new Map;g.set(o,u)}else g=fl,u=g.get(o),u||(u=new Map,g.set(o,u));if(u.has(s))return u;for(u.set(s,null),o=o.getElementsByTagName(s),g=0;g<o.length;g++){var S=o[g];if(!(S[Bi]||S[Tt]||s==="link"&&S.getAttribute("rel")==="stylesheet")&&S.namespaceURI!=="http://www.w3.org/2000/svg"){var b=S.getAttribute(i)||"";b=s+b;var E=u.get(b);E?E.push(S):u.set(b,[S])}}return u}function Uy(s,i,o){s=s.ownerDocument||s,s.head.insertBefore(o,i==="title"?s.querySelector("head > title"):null)}function fw(s,i,o){if(o===1||i.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof i.precedence!="string"||typeof i.href!="string"||i.href==="")break;return!0;case"link":if(typeof i.rel!="string"||typeof i.href!="string"||i.href===""||i.onLoad||i.onError)break;switch(i.rel){case"stylesheet":return s=i.disabled,typeof i.precedence=="string"&&s==null;default:return!0}case"script":if(i.async&&typeof i.async!="function"&&typeof i.async!="symbol"&&!i.onLoad&&!i.onError&&i.src&&typeof i.src=="string")return!0}return!1}function Oy(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}function pw(s,i,o,u){if(o.type==="stylesheet"&&(typeof u.media!="string"||matchMedia(u.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var g=ri(u.href),S=i.querySelector(br(g));if(S){i=S._p,i!==null&&typeof i=="object"&&typeof i.then=="function"&&(s.count++,s=pl.bind(s),i.then(s,s)),o.state.loading|=4,o.instance=S,vt(S);return}S=i.ownerDocument||i,u=Py(u),(g=pn.get(g))&&Rd(u,g),S=S.createElement("link"),vt(S);var b=S;b._p=new Promise(function(E,D){b.onload=E,b.onerror=D}),wt(S,"link",u),o.instance=S}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(o,i),(i=o.state.preload)&&(o.state.loading&3)===0&&(s.count++,o=pl.bind(s),i.addEventListener("load",o),i.addEventListener("error",o))}}var Dd=0;function mw(s,i){return s.stylesheets&&s.count===0&&hl(s,s.stylesheets),0<s.count||0<s.imgCount?function(o){var u=setTimeout(function(){if(s.stylesheets&&hl(s,s.stylesheets),s.unsuspend){var S=s.unsuspend;s.unsuspend=null,S()}},6e4+i);0<s.imgBytes&&Dd===0&&(Dd=62500*KA());var g=setTimeout(function(){if(s.waitingForImages=!1,s.count===0&&(s.stylesheets&&hl(s,s.stylesheets),s.unsuspend)){var S=s.unsuspend;s.unsuspend=null,S()}},(s.imgBytes>Dd?50:800)+i);return s.unsuspend=o,function(){s.unsuspend=null,clearTimeout(u),clearTimeout(g)}}:null}function pl(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)hl(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var ml=null;function hl(s,i){s.stylesheets=null,s.unsuspend!==null&&(s.count++,ml=new Map,i.forEach(hw,s),ml=null,pl.call(s))}function hw(s,i){if(!(i.state.loading&4)){var o=ml.get(s);if(o)var u=o.get(null);else{o=new Map,ml.set(s,o);for(var g=s.querySelectorAll("link[data-precedence],style[data-precedence]"),S=0;S<g.length;S++){var b=g[S];(b.nodeName==="LINK"||b.getAttribute("media")!=="not all")&&(o.set(b.dataset.precedence,b),u=b)}u&&o.set(null,u)}g=i.instance,b=g.getAttribute("data-precedence"),S=o.get(b)||u,S===u&&o.set(null,g),o.set(b,g),this.count++,u=pl.bind(this),g.addEventListener("load",u),g.addEventListener("error",u),S?S.parentNode.insertBefore(g,S.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(g,s.firstChild)),i.state.loading|=4}}var Ar={$$typeof:R,Provider:null,Consumer:null,_currentValue:ee,_currentValue2:ee,_threadCount:0};function gw(s,i,o,u,g,S,b,E,D){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Eu(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Eu(0),this.hiddenUpdates=Eu(null),this.identifierPrefix=u,this.onUncaughtError=g,this.onCaughtError=S,this.onRecoverableError=b,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=D,this.incompleteTransitions=new Map}function qy(s,i,o,u,g,S,b,E,D,V,J,Q){return s=new gw(s,i,o,b,D,V,J,Q,E),i=1,S===!0&&(i|=24),S=Jt(3,null,null,i),s.current=S,S.stateNode=s,i=dc(),i.refCount++,s.pooledCache=i,i.refCount++,S.memoizedState={element:u,isDehydrated:o,cache:i},hc(S),s}function By(s){return s?(s=qa,s):qa}function Hy(s,i,o,u,g,S){g=By(g),u.context===null?u.context=g:u.pendingContext=g,u=vs(i),u.payload={element:o},S=S===void 0?null:S,S!==null&&(u.callback=S),o=Ss(s,u,i),o!==null&&(Gt(o,s,i),nr(o,s,i))}function Vy(s,i){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var o=s.retryLane;s.retryLane=o!==0&&o<i?o:i}}function Pd(s,i){Vy(s,i),(s=s.alternate)&&Vy(s,i)}function Fy(s){if(s.tag===13||s.tag===31){var i=ea(s,67108864);i!==null&&Gt(i,s,67108864),Pd(s,67108864)}}function Gy(s){if(s.tag===13||s.tag===31){var i=Wt();i=Nu(i);var o=ea(s,i);o!==null&&Gt(o,s,i),Pd(s,i)}}var gl=!0;function yw(s,i,o,u){var g=O.T;O.T=null;var S=K.p;try{K.p=2,Ld(s,i,o,u)}finally{K.p=S,O.T=g}}function vw(s,i,o,u){var g=O.T;O.T=null;var S=K.p;try{K.p=8,Ld(s,i,o,u)}finally{K.p=S,O.T=g}}function Ld(s,i,o,u){if(gl){var g=kd(u);if(g===null)_d(s,i,u,yl,o),$y(s,u);else if(_w(g,s,i,o,u))u.stopPropagation();else if($y(s,u),i&4&&-1<Sw.indexOf(s)){for(;g!==null;){var S=Ea(g);if(S!==null)switch(S.tag){case 3:if(S=S.stateNode,S.current.memoizedState.isDehydrated){var b=js(S.pendingLanes);if(b!==0){var E=S;for(E.pendingLanes|=2,E.entangledLanes|=2;b;){var D=1<<31-Lt(b);E.entanglements[1]|=D,b&=~D}Mn(S),(Be&6)===0&&(Zo=ce()+500,vr(0))}}break;case 31:case 13:E=ea(S,2),E!==null&&Gt(E,S,2),tl(),Pd(S,2)}if(S=kd(u),S===null&&_d(s,i,u,yl,o),S===g)break;g=S}g!==null&&u.stopPropagation()}else _d(s,i,u,null,o)}}function kd(s){return s=Ou(s),Ud(s)}var yl=null;function Ud(s){if(yl=null,s=Ca(s),s!==null){var i=l(s);if(i===null)s=null;else{var o=i.tag;if(o===13){if(s=c(i),s!==null)return s;s=null}else if(o===31){if(s=f(i),s!==null)return s;s=null}else if(o===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;s=null}else i!==s&&(s=null)}}return yl=s,null}function zy(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(lt()){case nn:return 2;case Ys:return 8;case Js:case Ui:return 32;case ao:return 268435456;default:return 32}default:return 32}}var Od=!1,Rs=null,Ms=null,Ds=null,wr=new Map,Cr=new Map,Ps=[],Sw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function $y(s,i){switch(s){case"focusin":case"focusout":Rs=null;break;case"dragenter":case"dragleave":Ms=null;break;case"mouseover":case"mouseout":Ds=null;break;case"pointerover":case"pointerout":wr.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":Cr.delete(i.pointerId)}}function Er(s,i,o,u,g,S){return s===null||s.nativeEvent!==S?(s={blockedOn:i,domEventName:o,eventSystemFlags:u,nativeEvent:S,targetContainers:[g]},i!==null&&(i=Ea(i),i!==null&&Fy(i)),s):(s.eventSystemFlags|=u,i=s.targetContainers,g!==null&&i.indexOf(g)===-1&&i.push(g),s)}function _w(s,i,o,u,g){switch(i){case"focusin":return Rs=Er(Rs,s,i,o,u,g),!0;case"dragenter":return Ms=Er(Ms,s,i,o,u,g),!0;case"mouseover":return Ds=Er(Ds,s,i,o,u,g),!0;case"pointerover":var S=g.pointerId;return wr.set(S,Er(wr.get(S)||null,s,i,o,u,g)),!0;case"gotpointercapture":return S=g.pointerId,Cr.set(S,Er(Cr.get(S)||null,s,i,o,u,g)),!0}return!1}function Yy(s){var i=Ca(s.target);if(i!==null){var o=l(i);if(o!==null){if(i=o.tag,i===13){if(i=c(o),i!==null){s.blockedOn=i,rm(s.priority,function(){Gy(o)});return}}else if(i===31){if(i=f(o),i!==null){s.blockedOn=i,rm(s.priority,function(){Gy(o)});return}}else if(i===3&&o.stateNode.current.memoizedState.isDehydrated){s.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}s.blockedOn=null}function vl(s){if(s.blockedOn!==null)return!1;for(var i=s.targetContainers;0<i.length;){var o=kd(s.nativeEvent);if(o===null){o=s.nativeEvent;var u=new o.constructor(o.type,o);Uu=u,o.target.dispatchEvent(u),Uu=null}else return i=Ea(o),i!==null&&Fy(i),s.blockedOn=o,!1;i.shift()}return!0}function Jy(s,i,o){vl(s)&&o.delete(i)}function Tw(){Od=!1,Rs!==null&&vl(Rs)&&(Rs=null),Ms!==null&&vl(Ms)&&(Ms=null),Ds!==null&&vl(Ds)&&(Ds=null),wr.forEach(Jy),Cr.forEach(Jy)}function Sl(s,i){s.blockedOn===i&&(s.blockedOn=null,Od||(Od=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Tw)))}var _l=null;function Ky(s){_l!==s&&(_l=s,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){_l===s&&(_l=null);for(var i=0;i<s.length;i+=3){var o=s[i],u=s[i+1],g=s[i+2];if(typeof u!="function"){if(Ud(u||o)===null)continue;break}var S=Ea(o);S!==null&&(s.splice(i,3),i-=3,kc(S,{pending:!0,data:g,method:o.method,action:u},u,g))}}))}function li(s){function i(D){return Sl(D,s)}Rs!==null&&Sl(Rs,s),Ms!==null&&Sl(Ms,s),Ds!==null&&Sl(Ds,s),wr.forEach(i),Cr.forEach(i);for(var o=0;o<Ps.length;o++){var u=Ps[o];u.blockedOn===s&&(u.blockedOn=null)}for(;0<Ps.length&&(o=Ps[0],o.blockedOn===null);)Yy(o),o.blockedOn===null&&Ps.shift();if(o=(s.ownerDocument||s).$$reactFormReplay,o!=null)for(u=0;u<o.length;u+=3){var g=o[u],S=o[u+1],b=g[Ot]||null;if(typeof S=="function")b||Ky(o);else if(b){var E=null;if(S&&S.hasAttribute("formAction")){if(g=S,b=S[Ot]||null)E=b.formAction;else if(Ud(g)!==null)continue}else E=b.action;typeof E=="function"?o[u+1]=E:(o.splice(u,3),u-=3),Ky(o)}}}function jy(){function s(S){S.canIntercept&&S.info==="react-transition"&&S.intercept({handler:function(){return new Promise(function(b){return g=b})},focusReset:"manual",scroll:"manual"})}function i(){g!==null&&(g(),g=null),u||setTimeout(o,20)}function o(){if(!u&&!navigation.transition){var S=navigation.currentEntry;S&&S.url!=null&&navigation.navigate(S.url,{state:S.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var u=!1,g=null;return navigation.addEventListener("navigate",s),navigation.addEventListener("navigatesuccess",i),navigation.addEventListener("navigateerror",i),setTimeout(o,100),function(){u=!0,navigation.removeEventListener("navigate",s),navigation.removeEventListener("navigatesuccess",i),navigation.removeEventListener("navigateerror",i),g!==null&&(g(),g=null)}}}function qd(s){this._internalRoot=s}Tl.prototype.render=qd.prototype.render=function(s){var i=this._internalRoot;if(i===null)throw Error(a(409));var o=i.current,u=Wt();Hy(o,u,s,i,null,null)},Tl.prototype.unmount=qd.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var i=s.containerInfo;Hy(s.current,2,null,s,null,null),tl(),i[wa]=null}};function Tl(s){this._internalRoot=s}Tl.prototype.unstable_scheduleHydration=function(s){if(s){var i=im();s={blockedOn:null,target:s,priority:i};for(var o=0;o<Ps.length&&i!==0&&i<Ps[o].priority;o++);Ps.splice(o,0,s),o===0&&Yy(s)}};var Xy=e.version;if(Xy!=="19.2.0")throw Error(a(527,Xy,"19.2.0"));K.findDOMNode=function(s){var i=s._reactInternals;if(i===void 0)throw typeof s.render=="function"?Error(a(188)):(s=Object.keys(s).join(","),Error(a(268,s)));return s=p(i),s=s!==null?m(s):null,s=s===null?null:s.stateNode,s};var bw={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:O,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var bl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!bl.isDisabled&&bl.supportsFiber)try{Ks=bl.inject(bw),Pt=bl}catch{}}return Ir.createRoot=function(s,i){if(!r(s))throw Error(a(299));var o=!1,u="",g=sg,S=ag,b=ig;return i!=null&&(i.unstable_strictMode===!0&&(o=!0),i.identifierPrefix!==void 0&&(u=i.identifierPrefix),i.onUncaughtError!==void 0&&(g=i.onUncaughtError),i.onCaughtError!==void 0&&(S=i.onCaughtError),i.onRecoverableError!==void 0&&(b=i.onRecoverableError)),i=qy(s,1,!1,null,null,o,u,null,g,S,b,jy),s[wa]=i.current,Sd(s),new qd(i)},Ir.hydrateRoot=function(s,i,o){if(!r(s))throw Error(a(299));var u=!1,g="",S=sg,b=ag,E=ig,D=null;return o!=null&&(o.unstable_strictMode===!0&&(u=!0),o.identifierPrefix!==void 0&&(g=o.identifierPrefix),o.onUncaughtError!==void 0&&(S=o.onUncaughtError),o.onCaughtError!==void 0&&(b=o.onCaughtError),o.onRecoverableError!==void 0&&(E=o.onRecoverableError),o.formState!==void 0&&(D=o.formState)),i=qy(s,1,!0,i,o??null,u,g,D,S,b,E,jy),i.context=By(null),o=i.current,u=Wt(),u=Nu(u),g=vs(u),g.callback=null,Ss(o,g,u),o=u,i.current.lanes=o,qi(i,o),Mn(i),s[wa]=i.current,Sd(s),new Tl(i)},Ir.version="19.2.0",Ir}var r0;function Dw(){if(r0)return Vd.exports;r0=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Vd.exports=Mw(),Vd.exports}var Pw=Dw();const Lw=sp(Pw);function kw(t,e){if(t==null)return{};var n=Uw(t,e),a,r;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(r=0;r<l.length;r++)a=l[r],!(e.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(t,a)&&(n[a]=t[a])}return n}function Uw(t,e){if(t==null)return{};var n={},a=Object.keys(t),r,l;for(l=0;l<a.length;l++)r=a[l],!(e.indexOf(r)>=0)&&(n[r]=t[r]);return n}function zl(){return zl=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t},zl.apply(this,arguments)}function o0(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,a)}return n}function Rr(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?o0(Object(n),!0).forEach(function(a){Ow(t,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o0(Object(n)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(n,a))})}return t}function Ow(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const qw={breakpointCols:void 0,className:void 0,columnClassName:void 0,children:void 0,columnAttrs:void 0,column:void 0},$d=2;class i_ extends bn.Component{constructor(e){super(e),this.reCalculateColumnCount=this.reCalculateColumnCount.bind(this),this.reCalculateColumnCountDebounce=this.reCalculateColumnCountDebounce.bind(this);let n;this.props.breakpointCols&&this.props.breakpointCols.default?n=this.props.breakpointCols.default:n=parseInt(this.props.breakpointCols)||$d,this.state={columnCount:n}}componentDidMount(){this.reCalculateColumnCount(),window&&window.addEventListener("resize",this.reCalculateColumnCountDebounce)}componentDidUpdate(){this.reCalculateColumnCount()}componentWillUnmount(){window&&window.removeEventListener("resize",this.reCalculateColumnCountDebounce)}reCalculateColumnCountDebounce(){if(!window||!window.requestAnimationFrame){this.reCalculateColumnCount();return}window.cancelAnimationFrame&&window.cancelAnimationFrame(this._lastRecalculateAnimationFrame),this._lastRecalculateAnimationFrame=window.requestAnimationFrame(()=>{this.reCalculateColumnCount()})}reCalculateColumnCount(){const e=window&&window.innerWidth||1/0;let n=this.props.breakpointCols;typeof n!="object"&&(n={default:parseInt(n)||$d});let a=1/0,r=n.default||$d;for(let l in n){const c=parseInt(l);c>0&&e<=c&&c<a&&(a=c,r=n[l])}r=Math.max(1,parseInt(r)||1),this.state.columnCount!==r&&this.setState({columnCount:r})}itemsInColumns(){const e=this.state.columnCount,n=new Array(e),a=bn.Children.toArray(this.props.children);for(let r=0;r<a.length;r++){const l=r%e;n[l]||(n[l]=[]),n[l].push(a[r])}return n}renderColumns(){const{column:e,columnAttrs:n={},columnClassName:a}=this.props,r=this.itemsInColumns(),l=`${100/r.length}%`;let c=a;c&&typeof c!="string"&&(this.logDeprecated('The property "columnClassName" requires a string'),typeof c>"u"&&(c="my-masonry-grid_column"));const f=Rr(Rr(Rr({},e),n),{},{style:Rr(Rr({},n.style),{},{width:l}),className:c});return r.map((y,p)=>bn.createElement("div",zl({},f,{key:p}),y))}logDeprecated(e){console.error("[Masonry]",e)}render(){const e=this.props,{children:n,breakpointCols:a,columnClassName:r,columnAttrs:l,column:c,className:f}=e,y=kw(e,["children","breakpointCols","columnClassName","columnAttrs","column","className"]);let p=f;return typeof f!="string"&&(this.logDeprecated('The property "className" requires a string'),typeof f>"u"&&(p="my-masonry-grid")),bn.createElement("div",zl({},y,{className:p}),this.renderColumns())}}i_.defaultProps=qw;const gi=["#4e79a7","#f28e2c","#e15759","#76b7b2","#59a14f","#edc949","#af7aa1","#ff9da7","#9c755f","#bab0ab"],ui=gi.map(t=>`${t}B3`),xl=gi.map(t=>`${t}80`),Bw="#3b82f6",Hw="#2563eb",l0="rgba(107, 114, 128, 0.2)",Al="rgba(107, 114, 128, 0.5)";let u0=!1;const Vw=ue.forwardRef(({chartType:t,data:e,plan:n,selectedIndices:a,onElementClick:r,onZoomChange:l,disableAnimation:c},f)=>{const y=ue.useRef(null),p=ue.useRef(null);return typeof Chart<"u"&&typeof ChartZoom<"u"&&!u0&&(Chart.register(ChartZoom),u0=!0),ue.useImperativeHandle(f,()=>({resetZoom:()=>{var m;(m=p.current)==null||m.resetZoom()}})),ue.useEffect(()=>{if(!y.current||!n)return;p.current&&p.current.destroy();const m=y.current.getContext("2d");if(!m)return;const{groupByColumn:v,valueColumn:_,xValueColumn:x,yValueColumn:w}=n,A=_||"count",C=a.length>0,N=W=>C?e.map((Y,Z)=>a.includes(Z)?Bw:l0):W,I=W=>C?e.map((Y,Z)=>a.includes(Z)?Hw:Al):W,R=W=>{if(!W||!W.scales||!W.scales.x)return!1;const Y=W.getInitialScaleBounds().x,Z={min:W.scales.x.min,max:W.scales.x.max};return Y.min!==Z.min||Y.max!==Z.max},M={maintainAspectRatio:!1,responsive:!0,animation:c?{duration:0}:void 0,onClick:(W,Y)=>{Y.length>0&&r(Y[0].index,W)},plugins:{legend:{display:!1},tooltip:{backgroundColor:"#ffffff",titleColor:"#1e293b",bodyColor:"#475569",borderColor:"#e2e8f0",borderWidth:1,titleFont:{weight:"bold"},bodyFont:{size:13},padding:10}},scales:{x:{ticks:{color:"#64748b",callback:function(W){const Y=this.getLabelForValue(Number(W));return typeof Y=="string"&&Y.length>30?Y.substring(0,27)+"...":Y}},grid:{color:"#e2e8f0"}},y:{ticks:{color:"#64748b"},grid:{color:"#e2e8f0"}}}},z={pan:{enabled:!0,mode:"xy",onPanComplete:({chart:W})=>l(R(W))},zoom:{wheel:{enabled:!1},pinch:{enabled:!0},mode:"xy",onZoomComplete:({chart:W})=>l(R(W))}},B=v?e.map(W=>W[v]):[],k=e.map(W=>W[A]);switch(t){case"bar":p.current=new Chart(m,{type:"bar",data:{labels:B,datasets:[{label:A,data:k,backgroundColor:N(xl),borderColor:I(ui),borderWidth:1}]},options:{...M}});break;case"line":p.current=new Chart(m,{type:"line",data:{labels:B,datasets:[{label:A,data:k,fill:!1,borderColor:C?Al:gi[0],pointBackgroundColor:N([gi[0]]),pointBorderColor:I([ui[0]]),pointRadius:C?5:3,pointHoverRadius:7,tension:.1}]},options:{...M,plugins:{...M.plugins,zoom:z}}});break;case"pie":case"doughnut":p.current=new Chart(m,{type:t,data:{labels:B,datasets:[{label:A,data:k,backgroundColor:N(xl),borderColor:I(ui),borderWidth:1,offset:C?e.map((L,ne)=>a.includes(ne)?20:0):0}]},options:{...M,scales:{x:{display:!1},y:{display:!1}}}});break;case"scatter":if(!x||!w)break;const W=e.map(L=>({x:L[x],y:L[w]}));p.current=new Chart(m,{type:"scatter",data:{datasets:[{label:`${w} vs ${x}`,data:W,backgroundColor:N(xl),borderColor:I(ui),borderWidth:1.5,pointRadius:C?e.map((L,ne)=>a.includes(ne)?7:4):5,pointHoverRadius:C?e.map((L,ne)=>a.includes(ne)?9:6):7}]},options:{...M,scales:{x:{...M.scales.x,title:{display:!0,text:x,color:"#64748b"}},y:{...M.scales.y,title:{display:!0,text:w,color:"#64748b"}}},plugins:{...M.plugins,zoom:z}}});break;case"combo":if(!v||!A||!n.secondaryValueColumn)break;const Y=n.secondaryValueColumn,Z=e.map(L=>L[A]),te=e.map(L=>L[Y]);p.current=new Chart(m,{type:"bar",data:{labels:B,datasets:[{type:"bar",label:A,data:Z,backgroundColor:N(xl),borderColor:I(ui),borderWidth:1,yAxisID:"y"},{type:"line",label:Y,data:te,fill:!1,borderColor:C?Al:gi[1],pointBackgroundColor:C?l0:gi[1],pointBorderColor:C?Al:ui[1],pointRadius:C?5:3,pointHoverRadius:7,tension:.1,yAxisID:"y1"}]},options:{...M,scales:{...M.scales,y:{type:"linear",display:!0,position:"left",ticks:{color:"#64748b"},grid:{color:"#e2e8f0"},title:{display:!0,text:A,color:"#64748b"}},y1:{type:"linear",display:!0,position:"right",ticks:{color:"#64748b"},grid:{drawOnChartArea:!1},title:{display:!0,text:Y,color:"#64748b"}}}}});break}return()=>{p.current&&p.current.destroy()}},[t,e,n,a,r,l,c]),T.jsx("canvas",{ref:y})}),$l=(t,e=0)=>{if(t==null)return"";if(typeof t=="number")return t.toLocaleString(void 0,{maximumFractionDigits:2});if(typeof t=="string")return t;if(typeof t=="boolean")return t?"true":"false";if(Array.isArray(t))return e>=1?`[${t.length} items]`:t.map(n=>$l(n,e+1)).join(", ");if(typeof t=="object"){const n=Object.entries(t);return n.length===0?"{}":e>=1?`{${n.length} keys}`:n.map(([a,r])=>`${a}: ${$l(r,e+1)}`).join("; ")}return String(t)},Yl=({data:t})=>{if(!t||t.length===0)return T.jsx("p",{className:"text-slate-500",children:"No data to display."});const e=Object.keys(t[0]);return T.jsx("div",{className:"w-full text-sm",children:T.jsxs("table",{className:"w-full text-left",children:[T.jsx("thead",{className:"bg-slate-100 text-slate-600",children:T.jsx("tr",{children:e.map(n=>T.jsx("th",{className:"p-2 font-semibold",children:n},n))})}),T.jsx("tbody",{className:"bg-white",children:t.map((n,a)=>T.jsx("tr",{className:"border-b border-slate-200 last:border-b-0",children:e.map(r=>T.jsx("td",{className:"p-2 text-slate-700",children:$l(n[r])},`${a}-${r}`))},a))})]})})},r_=async(t,e)=>{try{const n=await htmlToImage.toPng(t,{backgroundColor:"#ffffff",pixelRatio:2}),a=document.createElement("a");a.download=`${e.replace(/ /g,"_")}.png`,a.href=n,a.click()}catch(n){console.error("Error exporting to PNG:",n)}},o_=(t,e)=>{try{const n=Papa.unparse(t),a=new Blob([n],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");r.href=URL.createObjectURL(a),r.setAttribute("download",`${e.replace(/ /g,"_")}.csv`),r.click()}catch(n){console.error("Error exporting to CSV:",n)}},l_=async(t,e,n,a)=>{try{const r=t.querySelector("canvas");if(!r)throw new Error("Chart canvas not found for export.");const l=r.toDataURL("image/png"),c=`
      <table border="1" style="border-collapse: collapse; width: 100%; font-family: sans-serif; color: #333;">
        <thead>
          <tr style="background-color: #f2f2f2;">
            ${Object.keys(n[0]||{}).map(v=>`<th style="padding: 8px;">${v}</th>`).join("")}
          </tr>
        </thead>
        <tbody>
          ${n.map(v=>`
            <tr>
              ${Object.values(v).map(_=>`<td style="padding: 8px;">${_}</td>`).join("")}
            </tr>
          `).join("")}
        </tbody>
      </table>
    `,f=a.replace(/\n/g,"<br>").replace("---","<hr>"),y=`
      <!DOCTYPE html>
      <html lang="en">
        <head>
          <meta charset="UTF-8">
          <title>${e}</title>
          <style> body { font-family: sans-serif; line-height: 1.6; padding: 20px; } h1, h2 { color: #111827; } .card { border: 1px solid #ddd; padding: 20px; border-radius: 8px; margin-bottom: 20px; } </style>
        </head>
        <body>
          <h1>Analysis Report: ${e}</h1>
          <div class="card">
            <h2>Chart</h2>
            <img src="${l}" alt="Chart for ${e}" style="max-width: 100%; border: 1px solid #ddd; border-radius: 4px;">
          </div>
          <div class="card">
            <h2>AI Summary</h2>
            <p>${f}</p>
          </div>
          <div class="card">
            <h2>Data</h2>
            ${c}
          </div>
          <p style="font-size: 0.8em; color: #888;">Generated by CSV Data Analysis Agent on ${new Date().toLocaleString()}</p>
        </body>
      </html>
    `,p=new Blob([y],{type:"text/html;charset=utf-8;"}),m=document.createElement("a");m.href=URL.createObjectURL(p),m.setAttribute("download",`Report_${e.replace(/ /g,"_")}.html`),m.click()}catch(r){console.error("Error exporting to HTML:",r)}},Fw=({type:t})=>{switch(t){case"bar":return T.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:T.jsx("path",{d:"M2 10a1 1 0 011-1h1a1 1 0 011 1v4a1 1 0 01-1 1H3a1 1 0 01-1-1v-4zM8 8a1 1 0 011-1h1a1 1 0 011 1v6a1 1 0 01-1 1H9a1 1 0 01-1-1V8zM14 4a1 1 0 011-1h1a1 1 0 011 1v10a1 1 0 01-1 1h-1a1 1 0 01-1-1V4z"})});case"line":return T.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:T.jsx("path",{fillRule:"evenodd",d:"M3 3a1 1 0 000 2v8a1 1 0 001 1h12a1 1 0 100-2H5V3a1 1 0 00-2 0zm12.293 4.293a1 1 0 011.414 0l2 2a1 1 0 01-1.414 1.414L15 8.414l-2.293 2.293a1 1 0 01-1.414 0l-2-2a1 1 0 111.414-1.414L12 7.586l1.293-1.293z",clipRule:"evenodd"})});case"pie":return T.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:[T.jsx("path",{d:"M2 10a8 8 0 018-8v8h8a8 8 0 11-16 0z"}),T.jsx("path",{d:"M12 2.252A8.014 8.014 0 0117.748 8H12V2.252z"})]});case"doughnut":return T.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:T.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM7 10a3 3 0 116 0 3 3 0 01-6 0z",clipRule:"evenodd"})});case"scatter":return T.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:T.jsx("path",{d:"M5 3a2 2 0 100 4 2 2 0 000-4zM5 13a2 2 0 100 4 2 2 0 000-4zM15 3a2 2 0 100 4 2 2 0 000-4zM15 13a2 2 0 100 4 2 2 0 000-4zM8 8a2 2 0 100 4 2 2 0 000-4zM12 8a2 2 0 100 4 2 2 0 000-4z"})});case"combo":return T.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:[T.jsx("path",{opacity:"0.6",d:"M2 10a1 1 0 011-1h1a1 1 0 011 1v4a1 1 0 01-1 1H3a1 1 0 01-1-1v-4zM8 8a1 1 0 011-1h1a1 1 0 011 1v6a1 1 0 01-1 1H9a1 1 0 01-1-1V8zM14 4a1 1 0 011-1h1a1 1 0 011 1v10a1 1 0 01-1 1h-1a1 1 0 01-1-1V4z"}),T.jsx("path",{fillRule:"evenodd",d:"M3.293 11.293a1 1 0 011.414 0L8 14.586l2.293-2.293a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 15.414l-2.293 2.293a1 1 0 01-1.414 0L3.293 12.707a1 1 0 010-1.414z",clipRule:"evenodd"})]});default:return null}},Gw=["bar","line","pie","doughnut","scatter","combo"],zw=({currentType:t,onChange:e})=>T.jsx("div",{className:"flex items-center space-x-1 bg-slate-200 p-1 rounded-md",children:Gw.map(n=>T.jsx("button",{onClick:()=>e(n),title:`Switch to ${n} chart`,className:`p-1 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed ${t===n?"bg-blue-600 text-white":"text-slate-500 hover:bg-slate-300 hover:text-slate-700"}`,children:T.jsx(Fw,{type:n})},n))});class u_ extends Error{constructor(e,n="unknown"){super(e),this.name="PlanExecutionError",this.code=n}}const $w=t=>typeof t=="string"&&t.startsWith("=")?`'${t}`:t,ss=t=>{if(t==null)return null;let e=String(t).trim();if(e==="")return null;let n=!1;e.startsWith("(")&&e.endsWith(")")&&(e=e.substring(1,e.length-1),n=!0),e=e.replace(/[$\s%]/g,"");const a=e.lastIndexOf(","),r=e.lastIndexOf(".");a>r?e=e.replace(/\./g,"").replace(",","."):e=e.replace(/,/g,"");const l=parseFloat(e);return isNaN(l)?null:n?-l:l},Yw=t=>typeof t!="string"||!t?!1:!isNaN(new Date(t).getTime())&&/[0-9]{1,4}[-/][0-9]{1,2}[-/][0-9]{1,4}/.test(t),c_=/^Q([1-4])(?:\s*\/?\s*('?\d{2,4}))?$/i,d_={january:1,jan:1,february:2,feb:2,march:3,mar:3,april:4,apr:4,may:5,june:6,jun:6,july:7,jul:7,august:8,aug:8,september:9,sep:9,october:10,oct:10,november:11,nov:11,december:12,dec:12},f_={monday:1,mon:1,tuesday:2,tue:2,wednesday:3,wed:3,thursday:4,thu:4,friday:5,fri:5,saturday:6,sat:6,sunday:7,sun:7},c0=(t,e)=>{const n=String(t).toLowerCase().trim();switch(e){case"quarter":const a=n.match(c_);if(a){const r=parseInt(a[1],10);let l=0;if(a[2]){const c=a[2].replace("'","");l=parseInt(c,10),c.length===2&&(l+=l>50?1900:2e3)}return l*10+r}return 1/0;case"month":return d_[n]||1/0;case"day":return f_[n]||1/0}return 1/0},d0=(t,e)=>{if(t.length<2)return t;const n=t.slice(0,10).map(y=>String(y[e]).toLowerCase().trim());let a=null;const r=n.filter(y=>c_.test(y)).length,l=n.filter(y=>d_[y]!==void 0).length,c=n.filter(y=>f_[y]!==void 0).length,f=n.filter(Yw).length;if(r/n.length>=.5)a="quarter";else if(l/n.length>=.5)a="month";else if(c/n.length>=.5)a="day";else if(f/n.length>=.5)return[...t].sort((y,p)=>new Date(String(y[e])).getTime()-new Date(String(p[e])).getTime());return a?[...t].sort((y,p)=>{const m=c0(String(y[e]),a),v=c0(String(p[e]),a);return m-v}):null},p_=(t,e,n,a)=>{if(t.length<=a)return t;const r=[...t].sort((f,y)=>(Number(y[n])||0)-(Number(f[n])||0)),l=r.slice(0,a),c=r.slice(a);if(c.length>0){const f=c.reduce((p,m)=>p+(Number(m[n])||0),0),y={[e]:"Others",[n]:f};return[...l,y]}return l},Jw=t=>new Promise((e,n)=>{Papa.parse(t,{header:!1,skipEmptyLines:!0,worker:!0,complete:a=>{if(a.data.length===0){e({fileName:t.name,data:[]});return}const r=a.data.reduce((f,y)=>Math.max(f,y.length),0),l=Array.from({length:r},(f,y)=>`column_${y+1}`),c=a.data.map(f=>{const y={};return l.forEach((p,m)=>{const v=f[m]!==void 0?f[m]:"";y[p]=$w(String(v))}),y});e({fileName:t.name,data:c})},error:a=>{n(a)}})}),vf=t=>{if(!t||t.length===0)return[];const e=Object.keys(t[0]),n=[];for(const a of e){let r=!0;const l=t.map(f=>f[a]);let c=0;for(const f of l){const y=ss(f);if(f!==null&&String(f).trim()!==""){if(y===null){r=!1;break}c++}}if(r&&c>0){const f=l.map(ss).filter(y=>y!==null);n.push({name:a,type:"numerical",valueRange:[Math.min(...f),Math.max(...f)],missingPercentage:(1-f.length/t.length)*100})}else{const f=new Set(l.map(String));n.push({name:a,type:"categorical",uniqueValues:f.size,missingPercentage:l.filter(y=>y===null||String(y).trim()==="").length/t.length*100})}}return n},Kw=t=>t?String(t).replace(/,(?=-?\d)/g,"|").split("|"):[],pa=t=>t==null||t===""?"__NULL__":String(t),f0=(t,e)=>{const n=t.map(r=>typeof r=="number"?r:ss(r)).filter(r=>typeof r=="number");if(n.length===0)return 0;const a=n.reduce((r,l)=>r+l,0);switch(e){case"avg":return a/n.length;case"count":return n.length;default:return a}},m_=()=>({parseNumber:ss,splitNumericString:Kw,groupBy:(t=[],e)=>{const n=typeof e=="function"?e:r=>r[e],a={};return t.forEach(r=>{const l=pa(n(r));a[l]||(a[l]=[]),a[l].push(r)}),Object.entries(a).map(([r,l])=>({key:r==="__NULL__"?null:r,rows:l,count:l.length}))},pivot:(t=[],e,n,a,r="sum")=>{const l=new Set,c=new Map;t.forEach(p=>{const m=pa(p[e]),v=pa(p[n]);l.add(v);const _=c.get(m)??{[e]:p[e]},x=_[v]??[];x.push(p[a]),_[v]=x,c.set(m,_)});const f=typeof r=="function"?r:p=>f0(p,r),y=Array.from(l);return Array.from(c.values()).map(p=>{const m={...p};return y.forEach(v=>{const _=Array.isArray(m[v])?m[v]:[];m[v]=f(_)}),m})},join:(t=[],e=[],n)=>{if(!(n!=null&&n.leftKey))throw new Error("join requires a leftKey.");const a=n.how||"inner",r=n.rightKey??n.leftKey,l=new Map;e.forEach(p=>{const m=pa(p[r]),v=l.get(m)??[];v.push(p),l.set(m,v)});const c=(p,m)=>p&&m?{...m,...p}:p?{...p}:m?{...m}:{},f=[],y=new Set;return t.forEach(p=>{const m=pa(p[n.leftKey]),v=l.get(m);v&&v.length>0?v.forEach(_=>{y.add(_),f.push(c(p,_))}):(a==="left"||a==="full")&&f.push(c(p,null))}),(a==="right"||a==="full")&&e.forEach(p=>{if(!y.has(p)){if(a==="right")f.push(c(null,p));else if(a==="full"){const m=pa(p[r]);t.filter(_=>pa(_[n.leftKey])===m).length===0&&f.push(c(null,p))}}}),f},rollingWindow:(t=[],e,n={column:"value",op:"avg"})=>{if(!Array.isArray(t)||e<=0)return[];const a=typeof n=="function"?n:r=>{const l=r.map(c=>c[n.column]);return f0(l,n.op??"avg")};return t.map((r,l)=>{const c=Math.max(0,l-e+1),f=t.slice(c,l+1);return{index:l,start:c,end:l,value:a(f,l)}})}}),p0=t=>t==null?"":typeof t=="number"?t.toString():String(t),jw=(t,e)=>{const n=Object.keys(t),a=Object.keys(e);if(n.length!==a.length)return!1;for(const r of n)if(!Object.prototype.hasOwnProperty.call(e,r)||p0(t[r])!==p0(e[r]))return!1;return!0},h_=(t,e)=>{try{const n=m_(),r=new Function("data","_util",e)(t,n);if(!Array.isArray(r))throw console.error("AI-generated transform function returned a non-array value. This is likely due to a missing 'return' statement in the generated code.",{returnedValue:r,generatedCode:e}),new Error("AI-generated transform function did not return an array.");if(r.length>0&&typeof r[0]!="object")throw new Error("AI-generated transform function did not return an array of objects.");const l=r,c=t.length,f=l.length,y=c>f?c-f:0,p=f>c?f-c:0,m=Math.min(c,f);let v=0;for(let x=0;x<m;x++)jw(t[x],l[x])||v++;if(!(y>0||p>0||v>0))throw new Error("AI-generated data transformation produced no observable changes. Please refine the instruction or regenerate the code.");return{data:l,meta:{rowsBefore:c,rowsAfter:f,addedRows:p,removedRows:y,modifiedRows:v}}}catch(n){throw console.error("Error executing AI-generated JavaScript:",n),new Error(`AI-generated data transformation failed: ${n instanceof Error?n.message:String(n)}`)}},g_=(t,e)=>{try{const n=m_(),r=new Function("data","_util",e)(t,n);if(!Array.isArray(r))throw new Error("AI-generated filter function did not return an array.");return r}catch(n){throw console.error("Error executing AI-generated JavaScript filter:",n),new Error(`AI-generated data filter failed: ${n instanceof Error?n.message:String(n)}`)}},m0=t=>{if(t==null)return null;const e=String(t).trim();return e===""?null:e},Xw=(t,e)=>{if(!(e!=null&&e.column)||!Array.isArray(e.values)||e.values.length===0)return t;const n=new Set(e.values.map(m0).filter(a=>a!==null));return n.size===0?t:t.filter(a=>{const r=m0(a[e.column]);return r!==null&&n.has(r)})},Yd=(t,e)=>{if(t.length===0)return 0;switch(e){case"sum":return t.reduce((a,r)=>a+r,0);case"count":return t.length;case"avg":return t.reduce((a,r)=>a+r,0)/t.length;default:throw new Error(`Unsupported aggregation type: ${e}`)}},y_=(t,e)=>{const n=Xw(t.data,e.rowFilter);if(e.rowFilter&&e.rowFilter.column&&Array.isArray(e.rowFilter.values)&&e.rowFilter.values.length>0&&n.length===0){const p=e.rowFilter.values.map(m=>`"${String(m)}"`).join(", ");throw new u_(`No rows matched the filter ${e.rowFilter.column}  ${p}. Remove or adjust the filter and try again.`,"no_rows")}if(e.chartType==="scatter"){const{xValueColumn:p,yValueColumn:m}=e;if(!p||!m)throw new Error("Scatter plot plan is missing xValueColumn or yValueColumn.");return n.map(v=>({[p]:ss(v[p]),[m]:ss(v[m])})).filter(v=>v[p]!==null&&v[m]!==null)}if(e.chartType==="combo"){const{groupByColumn:p,valueColumn:m,aggregation:v,secondaryValueColumn:_,secondaryAggregation:x}=e;if(!p||!m||!v||!_||!x)throw new Error("Combo chart plan is missing required aggregation fields.");const w={};n.forEach(N=>{const I=String(N[p]);if(I==="undefined"||I==="null")return;w[I]||(w[I]={primaryValues:[],secondaryValues:[]});const R=ss(N[m]);R!==null&&w[I].primaryValues.push(R);const M=ss(N[_]);M!==null&&w[I].secondaryValues.push(M)});const A=Object.keys(w).filter(N=>w[N].primaryValues.length>0||w[N].secondaryValues.length>0).map(N=>{const I=Yd(w[N].primaryValues,v),R=Yd(w[N].secondaryValues,x);return{[p]:N,[m]:I,[_]:R}});return d0(A,p)||A.sort((N,I)=>(Number(I[m])||0)-(Number(N[m])||0))}const{groupByColumn:a,valueColumn:r,aggregation:l}=e;if(!a||!l)throw new Error("Analysis plan is missing groupByColumn or aggregation type for non-scatter chart.");const c={};n.forEach(p=>{const m=String(p[a]);if(!(m==="undefined"||m==="null"))if(c[m]||(c[m]=[]),r){const v=ss(p[r]);v!==null&&c[m].push(v)}else l==="count"&&c[m].push(1)});const f=Object.keys(c).filter(p=>c[p].length>0).map(p=>{const m=Yd(c[p],l),v=r||"count";return{[a]:p,[v]:m}}),y=d0(f,a);if(y)return y;{const p=r||"count";return f.sort((m,v)=>(Number(v[p])||0)-(Number(m[p])||0))}},h0=["#4e79a7","#f28e2c","#e15759","#76b7b2","#59a14f","#edc949","#af7aa1","#ff9da7","#9c755f","#bab0ab"],Qw=({data:t,total:e,groupByKey:n,valueKey:a,hiddenLabels:r,onLabelClick:l})=>{const c=f=>typeof f=="number"?f.toLocaleString(void 0,{maximumFractionDigits:2}):f;return T.jsx("div",{className:"text-sm space-y-1 max-h-48 overflow-y-auto pr-2",children:t.map((f,y)=>{const p=String(f[n]),m=Number(f[a])||0,v=e>0?(m/e*100).toFixed(1):"0.0",_=r.includes(p),x=h0[y%h0.length];return T.jsxs("button",{onClick:()=>l(p),className:`w-full flex items-center justify-between p-1.5 rounded-md transition-all duration-200 ${_?"opacity-50":"hover:bg-slate-100"}`,title:`Click to ${_?"show":"hide"} "${p}"`,children:[T.jsxs("div",{className:"flex items-center truncate mr-2",children:[T.jsx("span",{className:"w-3 h-3 rounded-sm mr-2 flex-shrink-0",style:{backgroundColor:_?"#9ca3af":x}}),T.jsx("span",{className:`truncate text-xs ${_?"line-through text-slate-400":"text-slate-700"}`,children:p})]}),T.jsxs("div",{className:"flex items-baseline ml-2 flex-shrink-0",children:[T.jsx("span",{className:`font-semibold text-xs ${_?"text-slate-400":"text-slate-800"}`,children:c(m)}),T.jsxs("span",{className:"text-xs text-slate-500 ml-1.5 w-12 text-right",children:["(",v,"%)"]})]})]},p)})})},Ww={},g0=t=>{let e;const n=new Set,a=(m,v)=>{const _=typeof m=="function"?m(e):m;if(!Object.is(_,e)){const x=e;e=v??(typeof _!="object"||_===null)?_:Object.assign({},e,_),n.forEach(w=>w(e,x))}},r=()=>e,y={setState:a,getState:r,getInitialState:()=>p,subscribe:m=>(n.add(m),()=>n.delete(m)),destroy:()=>{(Ww?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},p=e=t(a,r,y);return y},Zw=t=>t?g0(t):g0;var Jd={exports:{}},Kd={},jd={exports:{}},Xd={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var y0;function eC(){if(y0)return Xd;y0=1;var t=Xr();function e(v,_){return v===_&&(v!==0||1/v===1/_)||v!==v&&_!==_}var n=typeof Object.is=="function"?Object.is:e,a=t.useState,r=t.useEffect,l=t.useLayoutEffect,c=t.useDebugValue;function f(v,_){var x=_(),w=a({inst:{value:x,getSnapshot:_}}),A=w[0].inst,C=w[1];return l(function(){A.value=x,A.getSnapshot=_,y(A)&&C({inst:A})},[v,x,_]),r(function(){return y(A)&&C({inst:A}),v(function(){y(A)&&C({inst:A})})},[v]),c(x),x}function y(v){var _=v.getSnapshot;v=v.value;try{var x=_();return!n(v,x)}catch{return!0}}function p(v,_){return _()}var m=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?p:f;return Xd.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:m,Xd}var v0;function tC(){return v0||(v0=1,jd.exports=eC()),jd.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var S0;function nC(){if(S0)return Kd;S0=1;var t=Xr(),e=tC();function n(p,m){return p===m&&(p!==0||1/p===1/m)||p!==p&&m!==m}var a=typeof Object.is=="function"?Object.is:n,r=e.useSyncExternalStore,l=t.useRef,c=t.useEffect,f=t.useMemo,y=t.useDebugValue;return Kd.useSyncExternalStoreWithSelector=function(p,m,v,_,x){var w=l(null);if(w.current===null){var A={hasValue:!1,value:null};w.current=A}else A=w.current;w=f(function(){function N(B){if(!I){if(I=!0,R=B,B=_(B),x!==void 0&&A.hasValue){var k=A.value;if(x(k,B))return M=k}return M=B}if(k=M,a(R,B))return k;var W=_(B);return x!==void 0&&x(k,W)?(R=B,k):(R=B,M=W)}var I=!1,R,M,z=v===void 0?null:v;return[function(){return N(m())},z===null?void 0:function(){return N(z())}]},[m,v,_,x]);var C=r(p,w[0],w[1]);return c(function(){A.hasValue=!0,A.value=C},[C]),y(C),C},Kd}var _0;function sC(){return _0||(_0=1,Jd.exports=nC()),Jd.exports}var aC=sC();const iC=sp(aC),v_={},{useDebugValue:rC}=bn,{useSyncExternalStoreWithSelector:oC}=iC;let T0=!1;const lC=t=>t;function uC(t,e=lC,n){(v_?"production":void 0)!=="production"&&n&&!T0&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),T0=!0);const a=oC(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,n);return rC(a),a}const b0=t=>{(v_?"production":void 0)!=="production"&&typeof t!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof t=="function"?Zw(t):t,n=(a,r)=>uC(e,a,r);return Object.assign(n,e),n},cC=t=>t?b0(t):b0;/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let dC,fC;function pC(){return{geminiUrl:dC,vertexUrl:fC}}function mC(t,e,n,a){var r,l;if(!(t!=null&&t.baseUrl)){const c=pC();return e?(r=c.vertexUrl)!==null&&r!==void 0?r:n:(l=c.geminiUrl)!==null&&l!==void 0?l:a}return t.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class os{}function ie(t,e){const n=/\{([^}]+)\}/g;return t.replace(n,(a,r)=>{if(Object.prototype.hasOwnProperty.call(e,r)){const l=e[r];return l!=null?String(l):""}else throw new Error(`Key '${r}' not found in valueMap.`)})}function h(t,e,n){for(let l=0;l<e.length-1;l++){const c=e[l];if(c.endsWith("[]")){const f=c.slice(0,-2);if(!(f in t))if(Array.isArray(n))t[f]=Array.from({length:n.length},()=>({}));else throw new Error(`Value must be a list given an array path ${c}`);if(Array.isArray(t[f])){const y=t[f];if(Array.isArray(n))for(let p=0;p<y.length;p++){const m=y[p];h(m,e.slice(l+1),n[p])}else for(const p of y)h(p,e.slice(l+1),n)}return}else if(c.endsWith("[0]")){const f=c.slice(0,-3);f in t||(t[f]=[{}]);const y=t[f];h(y[0],e.slice(l+1),n);return}(!t[c]||typeof t[c]!="object")&&(t[c]={}),t=t[c]}const a=e[e.length-1],r=t[a];if(r!==void 0){if(!n||typeof n=="object"&&Object.keys(n).length===0||n===r)return;if(typeof r=="object"&&typeof n=="object"&&r!==null&&n!==null)Object.assign(r,n);else throw new Error(`Cannot set value for an existing key. Key: ${a}`)}else a==="_self"&&typeof n=="object"&&n!==null&&!Array.isArray(n)?Object.assign(t,n):t[a]=n}function d(t,e,n=void 0){try{if(e.length===1&&e[0]==="_self")return t;for(let a=0;a<e.length;a++){if(typeof t!="object"||t===null)return n;const r=e[a];if(r.endsWith("[]")){const l=r.slice(0,-2);if(l in t){const c=t[l];return Array.isArray(c)?c.map(f=>d(f,e.slice(a+1),n)):n}else return n}else t=t[r]}return t}catch(a){if(a instanceof TypeError)return n;throw a}}function hC(t,e){for(const[n,a]of Object.entries(e)){const r=n.split("."),l=a.split("."),c=new Set;let f=-1;for(let y=0;y<r.length;y++)if(r[y]==="*"){f=y;break}if(f!==-1&&l.length>f)for(let y=f;y<l.length;y++){const p=l[y];p!=="*"&&!p.endsWith("[]")&&!p.endsWith("[0]")&&c.add(p)}Sf(t,r,l,0,c)}}function Sf(t,e,n,a,r){if(a>=e.length||typeof t!="object"||t===null)return;const l=e[a];if(l.endsWith("[]")){const c=l.slice(0,-2),f=t;if(c in f&&Array.isArray(f[c]))for(const y of f[c])Sf(y,e,n,a+1,r)}else if(l==="*"){if(typeof t=="object"&&t!==null&&!Array.isArray(t)){const c=t,f=Object.keys(c).filter(p=>!p.startsWith("_")&&!r.has(p)),y={};for(const p of f)y[p]=c[p];for(const[p,m]of Object.entries(y)){const v=[];for(const _ of n.slice(a))_==="*"?v.push(p):v.push(_);h(c,v,m)}for(const p of f)delete c[p]}}else{const c=t;l in c&&Sf(c[l],e,n,a+1,r)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ap(t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function gC(t){const e={},n=d(t,["operationName"]);n!=null&&h(e,["operationName"],n);const a=d(t,["resourceName"]);return a!=null&&h(e,["_url","resourceName"],a),e}function yC(t){const e={},n=d(t,["name"]);n!=null&&h(e,["name"],n);const a=d(t,["metadata"]);a!=null&&h(e,["metadata"],a);const r=d(t,["done"]);r!=null&&h(e,["done"],r);const l=d(t,["error"]);l!=null&&h(e,["error"],l);const c=d(t,["response","generateVideoResponse"]);return c!=null&&h(e,["response"],SC(c)),e}function vC(t){const e={},n=d(t,["name"]);n!=null&&h(e,["name"],n);const a=d(t,["metadata"]);a!=null&&h(e,["metadata"],a);const r=d(t,["done"]);r!=null&&h(e,["done"],r);const l=d(t,["error"]);l!=null&&h(e,["error"],l);const c=d(t,["response"]);return c!=null&&h(e,["response"],_C(c)),e}function SC(t){const e={},n=d(t,["generatedSamples"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(c=>TC(c))),h(e,["generatedVideos"],l)}const a=d(t,["raiMediaFilteredCount"]);a!=null&&h(e,["raiMediaFilteredCount"],a);const r=d(t,["raiMediaFilteredReasons"]);return r!=null&&h(e,["raiMediaFilteredReasons"],r),e}function _C(t){const e={},n=d(t,["videos"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(c=>bC(c))),h(e,["generatedVideos"],l)}const a=d(t,["raiMediaFilteredCount"]);a!=null&&h(e,["raiMediaFilteredCount"],a);const r=d(t,["raiMediaFilteredReasons"]);return r!=null&&h(e,["raiMediaFilteredReasons"],r),e}function TC(t){const e={},n=d(t,["video"]);return n!=null&&h(e,["video"],NC(n)),e}function bC(t){const e={},n=d(t,["_self"]);return n!=null&&h(e,["video"],IC(n)),e}function xC(t){const e={},n=d(t,["operationName"]);return n!=null&&h(e,["_url","operationName"],n),e}function AC(t){const e={},n=d(t,["operationName"]);return n!=null&&h(e,["_url","operationName"],n),e}function wC(t){const e={},n=d(t,["name"]);n!=null&&h(e,["name"],n);const a=d(t,["metadata"]);a!=null&&h(e,["metadata"],a);const r=d(t,["done"]);r!=null&&h(e,["done"],r);const l=d(t,["error"]);l!=null&&h(e,["error"],l);const c=d(t,["response"]);return c!=null&&h(e,["response"],CC(c)),e}function CC(t){const e={},n=d(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const a=d(t,["parent"]);a!=null&&h(e,["parent"],a);const r=d(t,["documentName"]);return r!=null&&h(e,["documentName"],r),e}function S_(t){const e={},n=d(t,["name"]);n!=null&&h(e,["name"],n);const a=d(t,["metadata"]);a!=null&&h(e,["metadata"],a);const r=d(t,["done"]);r!=null&&h(e,["done"],r);const l=d(t,["error"]);l!=null&&h(e,["error"],l);const c=d(t,["response"]);return c!=null&&h(e,["response"],EC(c)),e}function EC(t){const e={},n=d(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const a=d(t,["parent"]);a!=null&&h(e,["parent"],a);const r=d(t,["documentName"]);return r!=null&&h(e,["documentName"],r),e}function NC(t){const e={},n=d(t,["uri"]);n!=null&&h(e,["uri"],n);const a=d(t,["encodedVideo"]);a!=null&&h(e,["videoBytes"],ap(a));const r=d(t,["encoding"]);return r!=null&&h(e,["mimeType"],r),e}function IC(t){const e={},n=d(t,["gcsUri"]);n!=null&&h(e,["uri"],n);const a=d(t,["bytesBase64Encoded"]);a!=null&&h(e,["videoBytes"],ap(a));const r=d(t,["mimeType"]);return r!=null&&h(e,["mimeType"],r),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var x0;(function(t){t.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",t.OUTCOME_OK="OUTCOME_OK",t.OUTCOME_FAILED="OUTCOME_FAILED",t.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(x0||(x0={}));var A0;(function(t){t.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",t.PYTHON="PYTHON"})(A0||(A0={}));var w0;(function(t){t.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",t.SILENT="SILENT",t.WHEN_IDLE="WHEN_IDLE",t.INTERRUPT="INTERRUPT"})(w0||(w0={}));var $;(function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.STRING="STRING",t.NUMBER="NUMBER",t.INTEGER="INTEGER",t.BOOLEAN="BOOLEAN",t.ARRAY="ARRAY",t.OBJECT="OBJECT",t.NULL="NULL"})($||($={}));var C0;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(C0||(C0={}));var E0;(function(t){t.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",t.SIMPLE_SEARCH="SIMPLE_SEARCH",t.ELASTIC_SEARCH="ELASTIC_SEARCH"})(E0||(E0={}));var N0;(function(t){t.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",t.NO_AUTH="NO_AUTH",t.API_KEY_AUTH="API_KEY_AUTH",t.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",t.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",t.OAUTH="OAUTH",t.OIDC_AUTH="OIDC_AUTH"})(N0||(N0={}));var I0;(function(t){t.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",t.HTTP_IN_QUERY="HTTP_IN_QUERY",t.HTTP_IN_HEADER="HTTP_IN_HEADER",t.HTTP_IN_PATH="HTTP_IN_PATH",t.HTTP_IN_BODY="HTTP_IN_BODY",t.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(I0||(I0={}));var R0;(function(t){t.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",t.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",t.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",t.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(R0||(R0={}));var M0;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",t.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",t.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",t.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",t.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(M0||(M0={}));var D0;(function(t){t.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",t.SEVERITY="SEVERITY",t.PROBABILITY="PROBABILITY"})(D0||(D0={}));var P0;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE",t.OFF="OFF"})(P0||(P0={}));var L0;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.IMAGE_SAFETY="IMAGE_SAFETY",t.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",t.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",t.NO_IMAGE="NO_IMAGE"})(L0||(L0={}));var k0;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(k0||(k0={}));var U0;(function(t){t.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",t.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",t.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",t.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",t.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(U0||(U0={}));var O0;(function(t){t.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",t.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",t.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",t.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",t.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(O0||(O0={}));var q0;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.IMAGE_SAFETY="IMAGE_SAFETY",t.MODEL_ARMOR="MODEL_ARMOR",t.JAILBREAK="JAILBREAK"})(q0||(q0={}));var B0;(function(t){t.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",t.ON_DEMAND="ON_DEMAND",t.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(B0||(B0={}));var Jl;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.AUDIO="AUDIO"})(Jl||(Jl={}));var H0;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(H0||(H0={}));var V0;(function(t){t.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",t.TUNING_MODE_FULL="TUNING_MODE_FULL",t.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(V0||(V0={}));var F0;(function(t){t.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",t.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",t.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",t.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",t.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",t.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",t.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(F0||(F0={}));var _f;(function(t){t.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",t.JOB_STATE_QUEUED="JOB_STATE_QUEUED",t.JOB_STATE_PENDING="JOB_STATE_PENDING",t.JOB_STATE_RUNNING="JOB_STATE_RUNNING",t.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",t.JOB_STATE_FAILED="JOB_STATE_FAILED",t.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",t.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",t.JOB_STATE_PAUSED="JOB_STATE_PAUSED",t.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",t.JOB_STATE_UPDATING="JOB_STATE_UPDATING",t.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(_f||(_f={}));var G0;(function(t){t.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",t.TUNING_TASK_I2V="TUNING_TASK_I2V",t.TUNING_TASK_T2V="TUNING_TASK_T2V",t.TUNING_TASK_R2V="TUNING_TASK_R2V"})(G0||(G0={}));var z0;(function(t){t.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",t.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",t.BALANCED="BALANCED",t.PRIORITIZE_COST="PRIORITIZE_COST"})(z0||(z0={}));var $0;(function(t){t.UNSPECIFIED="UNSPECIFIED",t.BLOCKING="BLOCKING",t.NON_BLOCKING="NON_BLOCKING"})($0||($0={}));var Y0;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(Y0||(Y0={}));var J0;(function(t){t.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",t.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(J0||(J0={}));var K0;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE",t.VALIDATED="VALIDATED"})(K0||(K0={}));var j0;(function(t){t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(j0||(j0={}));var X0;(function(t){t.DONT_ALLOW="DONT_ALLOW",t.ALLOW_ADULT="ALLOW_ADULT",t.ALLOW_ALL="ALLOW_ALL"})(X0||(X0={}));var Q0;(function(t){t.auto="auto",t.en="en",t.ja="ja",t.ko="ko",t.hi="hi",t.zh="zh",t.pt="pt",t.es="es"})(Q0||(Q0={}));var W0;(function(t){t.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",t.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",t.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",t.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",t.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(W0||(W0={}));var Z0;(function(t){t.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",t.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",t.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",t.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(Z0||(Z0={}));var ev;(function(t){t.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",t.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",t.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",t.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(ev||(ev={}));var tv;(function(t){t.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",t.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",t.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",t.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",t.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",t.EDIT_MODE_STYLE="EDIT_MODE_STYLE",t.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",t.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(tv||(tv={}));var nv;(function(t){t.FOREGROUND="FOREGROUND",t.BACKGROUND="BACKGROUND",t.PROMPT="PROMPT",t.SEMANTIC="SEMANTIC",t.INTERACTIVE="INTERACTIVE"})(nv||(nv={}));var sv;(function(t){t.ASSET="ASSET",t.STYLE="STYLE"})(sv||(sv={}));var av;(function(t){t.INSERT="INSERT",t.REMOVE="REMOVE",t.REMOVE_STATIC="REMOVE_STATIC",t.OUTPAINT="OUTPAINT"})(av||(av={}));var iv;(function(t){t.OPTIMIZED="OPTIMIZED",t.LOSSLESS="LOSSLESS"})(iv||(iv={}));var rv;(function(t){t.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",t.PREFERENCE_TUNING="PREFERENCE_TUNING"})(rv||(rv={}));var ov;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.STATE_PENDING="STATE_PENDING",t.STATE_ACTIVE="STATE_ACTIVE",t.STATE_FAILED="STATE_FAILED"})(ov||(ov={}));var lv;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.PROCESSING="PROCESSING",t.ACTIVE="ACTIVE",t.FAILED="FAILED"})(lv||(lv={}));var uv;(function(t){t.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",t.UPLOADED="UPLOADED",t.GENERATED="GENERATED"})(uv||(uv={}));var cv;(function(t){t.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.RESPONSE_REJECTED="RESPONSE_REJECTED",t.NEED_MORE_INPUT="NEED_MORE_INPUT"})(cv||(cv={}));var dv;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.VIDEO="VIDEO",t.AUDIO="AUDIO",t.DOCUMENT="DOCUMENT"})(dv||(dv={}));var fv;(function(t){t.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",t.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",t.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(fv||(fv={}));var pv;(function(t){t.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",t.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",t.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(pv||(pv={}));var mv;(function(t){t.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",t.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",t.NO_INTERRUPTION="NO_INTERRUPTION"})(mv||(mv={}));var hv;(function(t){t.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",t.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",t.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(hv||(hv={}));var gv;(function(t){t.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",t.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",t.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",t.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",t.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",t.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",t.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",t.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",t.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",t.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",t.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",t.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",t.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(gv||(gv={}));var yv;(function(t){t.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",t.QUALITY="QUALITY",t.DIVERSITY="DIVERSITY",t.VOCALIZATION="VOCALIZATION"})(yv||(yv={}));var yi;(function(t){t.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",t.PLAY="PLAY",t.PAUSE="PAUSE",t.STOP="STOP",t.RESET_CONTEXT="RESET_CONTEXT"})(yi||(yi={}));class Tf{constructor(e){const n={};for(const a of e.headers.entries())n[a[0]]=a[1];this.headers=n,this.responseInternal=e}json(){return this.responseInternal.json()}}class Mr{get text(){var e,n,a,r,l,c,f,y;if(((r=(a=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||a===void 0?void 0:a.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let p="",m=!1;const v=[];for(const _ of(y=(f=(c=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.content)===null||f===void 0?void 0:f.parts)!==null&&y!==void 0?y:[]){for(const[x,w]of Object.entries(_))x!=="text"&&x!=="thought"&&(w!==null||w!==void 0)&&v.push(x);if(typeof _.text=="string"){if(typeof _.thought=="boolean"&&_.thought)continue;m=!0,p+=_.text}}return v.length>0&&console.warn(`there are non-text parts ${v} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),m?p:void 0}get data(){var e,n,a,r,l,c,f,y;if(((r=(a=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||a===void 0?void 0:a.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let p="";const m=[];for(const v of(y=(f=(c=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.content)===null||f===void 0?void 0:f.parts)!==null&&y!==void 0?y:[]){for(const[_,x]of Object.entries(v))_!=="inlineData"&&(x!==null||x!==void 0)&&m.push(_);v.inlineData&&typeof v.inlineData.data=="string"&&(p+=atob(v.inlineData.data))}return m.length>0&&console.warn(`there are non-data parts ${m} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),p.length>0?btoa(p):void 0}get functionCalls(){var e,n,a,r,l,c,f,y;if(((r=(a=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||a===void 0?void 0:a.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const p=(y=(f=(c=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.content)===null||f===void 0?void 0:f.parts)===null||y===void 0?void 0:y.filter(m=>m.functionCall).map(m=>m.functionCall).filter(m=>m!==void 0);if((p==null?void 0:p.length)!==0)return p}get executableCode(){var e,n,a,r,l,c,f,y,p;if(((r=(a=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||a===void 0?void 0:a.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const m=(y=(f=(c=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.content)===null||f===void 0?void 0:f.parts)===null||y===void 0?void 0:y.filter(v=>v.executableCode).map(v=>v.executableCode).filter(v=>v!==void 0);if((m==null?void 0:m.length)!==0)return(p=m==null?void 0:m[0])===null||p===void 0?void 0:p.code}get codeExecutionResult(){var e,n,a,r,l,c,f,y,p;if(((r=(a=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||a===void 0?void 0:a.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const m=(y=(f=(c=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.content)===null||f===void 0?void 0:f.parts)===null||y===void 0?void 0:y.filter(v=>v.codeExecutionResult).map(v=>v.codeExecutionResult).filter(v=>v!==void 0);if((m==null?void 0:m.length)!==0)return(p=m==null?void 0:m[0])===null||p===void 0?void 0:p.output}}class vv{}class Sv{}class RC{}class MC{}class DC{}class PC{}class _v{}class Tv{}class bv{}class LC{}class Kl{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const a=new Kl;let r;const l=e;return n?r=vC(l):r=yC(l),Object.assign(a,r),a}}class xv{}class Av{}class wv{}class kC{}class UC{}class OC{}class ip{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const a=new ip,l=wC(e);return Object.assign(a,l),a}}class qC{}class BC{}class HC{}class Cv{}class VC{get text(){var e,n,a;let r="",l=!1;const c=[];for(const f of(a=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&a!==void 0?a:[]){for(const[y,p]of Object.entries(f))y!=="text"&&y!=="thought"&&p!==null&&c.push(y);if(typeof f.text=="string"){if(typeof f.thought=="boolean"&&f.thought)continue;l=!0,r+=f.text}}return c.length>0&&console.warn(`there are non-text parts ${c} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),l?r:void 0}get data(){var e,n,a;let r="";const l=[];for(const c of(a=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&a!==void 0?a:[]){for(const[f,y]of Object.entries(c))f!=="inlineData"&&y!==null&&l.push(f);c.inlineData&&typeof c.inlineData.data=="string"&&(r+=atob(c.inlineData.data))}return l.length>0&&console.warn(`there are non-data parts ${l} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),r.length>0?btoa(r):void 0}}class FC{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class rp{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const a=new rp,l=S_(e);return Object.assign(a,l),a}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Oe(t,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(t.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const n=e.split("/",2);return`publishers/${n[0]}/models/${n[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function __(t,e){const n=Oe(t,e);return n?n.startsWith("publishers/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}`:n.startsWith("models/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/publishers/google/${n}`:n:""}function T_(t){return Array.isArray(t)?t.map(e=>jl(e)):[jl(t)]}function jl(t){if(typeof t=="object"&&t!==null)return t;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof t}`)}function b_(t){const e=jl(t);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function x_(t){const e=jl(t);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Ev(t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function A_(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>Ev(e)):[Ev(t)]}function bf(t){return t!=null&&typeof t=="object"&&"parts"in t&&Array.isArray(t.parts)}function Nv(t){return t!=null&&typeof t=="object"&&"functionCall"in t}function Iv(t){return t!=null&&typeof t=="object"&&"functionResponse"in t}function Mt(t){if(t==null)throw new Error("ContentUnion is required");return bf(t)?t:{role:"user",parts:A_(t)}}function op(t,e){if(!e)return[];if(t.isVertexAI()&&Array.isArray(e))return e.flatMap(n=>{const a=Mt(n);return a.parts&&a.parts.length>0&&a.parts[0].text!==void 0?[a.parts[0].text]:[]});if(t.isVertexAI()){const n=Mt(e);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]}return Array.isArray(e)?e.map(n=>Mt(n)):[Mt(e)]}function gn(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t)){if(Nv(t)||Iv(t))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[Mt(t)]}const e=[],n=[],a=bf(t[0]);for(const r of t){const l=bf(r);if(l!=a)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(l)e.push(r);else{if(Nv(r)||Iv(r))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(r)}}return a||e.push({role:"user",parts:A_(n)}),e}function GC(t,e){t.includes("null")&&(e.nullable=!0);const n=t.filter(a=>a!=="null");if(n.length===1)e.type=Object.values($).includes(n[0].toUpperCase())?n[0].toUpperCase():$.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const a of n)e.anyOf.push({type:Object.values($).includes(a.toUpperCase())?a.toUpperCase():$.TYPE_UNSPECIFIED})}}function Ti(t){const e={},n=["items"],a=["anyOf"],r=["properties"];if(t.type&&t.anyOf)throw new Error("type and anyOf cannot be both populated.");const l=t.anyOf;l!=null&&l.length==2&&(l[0].type==="null"?(e.nullable=!0,t=l[1]):l[1].type==="null"&&(e.nullable=!0,t=l[0])),t.type instanceof Array&&GC(t.type,e);for(const[c,f]of Object.entries(t))if(f!=null)if(c=="type"){if(f==="null")throw new Error("type: null can not be the only possible type for the field.");if(f instanceof Array)continue;e.type=Object.values($).includes(f.toUpperCase())?f.toUpperCase():$.TYPE_UNSPECIFIED}else if(n.includes(c))e[c]=Ti(f);else if(a.includes(c)){const y=[];for(const p of f){if(p.type=="null"){e.nullable=!0;continue}y.push(Ti(p))}e[c]=y}else if(r.includes(c)){const y={};for(const[p,m]of Object.entries(f))y[p]=Ti(m);e[c]=y}else{if(c==="additionalProperties")continue;e[c]=f}return e}function lp(t){return Ti(t)}function up(t){if(typeof t=="object")return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function cp(t){if("multiSpeakerVoiceConfig"in t)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return t}function Ni(t){if(t.functionDeclarations)for(const e of t.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=Ti(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=Ti(e.response));return t}function Ii(t){if(t==null)throw new Error("tools is required");if(!Array.isArray(t))throw new Error("tools is required and must be an array of Tools");const e=[];for(const n of t)e.push(n);return e}function zC(t,e,n,a=1){const r=!e.startsWith(`${n}/`)&&e.split("/").length===a;return t.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${t.getProject()}/${e}`:e.startsWith(`${n}/`)?`projects/${t.getProject()}/locations/${t.getLocation()}/${e}`:r?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}/${e}`:e:r?`${n}/${e}`:e}function ls(t,e){if(typeof e!="string")throw new Error("name must be a string");return zC(t,e,"cachedContents")}function w_(t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function Fs(t){return ap(t)}function $C(t){return t!=null&&typeof t=="object"&&"name"in t}function YC(t){return t!=null&&typeof t=="object"&&"video"in t}function JC(t){return t!=null&&typeof t=="object"&&"uri"in t}function C_(t){var e;let n;if($C(t)&&(n=t.name),!(JC(t)&&(n=t.uri,n===void 0))&&!(YC(t)&&(n=(e=t.video)===null||e===void 0?void 0:e.uri,n===void 0))){if(typeof t=="string"&&(n=t),n===void 0)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){const r=n.split("files/")[1].match(/[a-z0-9]+/);if(r===null)throw new Error(`Could not extract file name from URI ${n}`);n=r[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function E_(t,e){let n;return t.isVertexAI()?n=e?"publishers/google/models":"models":n=e?"models":"tunedModels",n}function N_(t){for(const e of["models","tunedModels","publisherModels"])if(KC(t,e))return t[e];return[]}function KC(t,e){return t!==null&&typeof t=="object"&&e in t}function jC(t,e={}){const n=t,a={name:n.name,description:n.description,parametersJsonSchema:n.inputSchema};return n.outputSchema&&(a.responseJsonSchema=n.outputSchema),e.behavior&&(a.behavior=e.behavior),{functionDeclarations:[a]}}function XC(t,e={}){const n=[],a=new Set;for(const r of t){const l=r.name;if(a.has(l))throw new Error(`Duplicate function name ${l} found in MCP tools. Please ensure function names are unique.`);a.add(l);const c=jC(r,e);c.functionDeclarations&&n.push(...c.functionDeclarations)}return{functionDeclarations:n}}function I_(t,e){let n;if(typeof e=="string")if(t.isVertexAI())if(e.startsWith("gs://"))n={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))n={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))n={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(t.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:e}}else n=e;const a=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,r=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(t.isVertexAI()){if(r>0||a!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(a>0||r!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function QC(t){if(typeof t!="string")return t;const e=t;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function R_(t){if(typeof t!="object"||t===null)return{};const e=t,n=e.inlinedResponses;if(typeof n!="object"||n===null)return t;const r=n.inlinedResponses;if(!Array.isArray(r)||r.length===0)return t;let l=!1;for(const c of r){if(typeof c!="object"||c===null)continue;const y=c.response;if(typeof y!="object"||y===null)continue;if(y.embedding!==void 0){l=!0;break}}return l&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),t}function Ri(t,e){const n=e;if(!t.isVertexAI()){if(/batches\/[^/]+$/.test(n))return n.split("/").pop();throw new Error(`Invalid batch job name: ${n}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(n))return n.split("/").pop();if(/^\d+$/.test(n))return n;throw new Error(`Invalid batch job name: ${n}.`)}function M_(t){const e=t;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function WC(t){const e={},n=d(t,["responsesFile"]);n!=null&&h(e,["fileName"],n);const a=d(t,["inlinedResponses","inlinedResponses"]);if(a!=null){let l=a;Array.isArray(l)&&(l=l.map(c=>IE(c))),h(e,["inlinedResponses"],l)}const r=d(t,["inlinedEmbedContentResponses","inlinedResponses"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(c=>c)),h(e,["inlinedEmbedContentResponses"],l)}return e}function ZC(t){const e={},n=d(t,["predictionsFormat"]);n!=null&&h(e,["format"],n);const a=d(t,["gcsDestination","outputUriPrefix"]);a!=null&&h(e,["gcsUri"],a);const r=d(t,["bigqueryDestination","outputUri"]);return r!=null&&h(e,["bigqueryUri"],r),e}function eE(t){const e={},n=d(t,["format"]);n!=null&&h(e,["predictionsFormat"],n);const a=d(t,["gcsUri"]);a!=null&&h(e,["gcsDestination","outputUriPrefix"],a);const r=d(t,["bigqueryUri"]);if(r!=null&&h(e,["bigqueryDestination","outputUri"],r),d(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(d(t,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(d(t,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function kl(t){const e={},n=d(t,["name"]);n!=null&&h(e,["name"],n);const a=d(t,["metadata","displayName"]);a!=null&&h(e,["displayName"],a);const r=d(t,["metadata","state"]);r!=null&&h(e,["state"],M_(r));const l=d(t,["metadata","createTime"]);l!=null&&h(e,["createTime"],l);const c=d(t,["metadata","endTime"]);c!=null&&h(e,["endTime"],c);const f=d(t,["metadata","updateTime"]);f!=null&&h(e,["updateTime"],f);const y=d(t,["metadata","model"]);y!=null&&h(e,["model"],y);const p=d(t,["metadata","output"]);return p!=null&&h(e,["dest"],WC(R_(p))),e}function xf(t){const e={},n=d(t,["name"]);n!=null&&h(e,["name"],n);const a=d(t,["displayName"]);a!=null&&h(e,["displayName"],a);const r=d(t,["state"]);r!=null&&h(e,["state"],M_(r));const l=d(t,["error"]);l!=null&&h(e,["error"],l);const c=d(t,["createTime"]);c!=null&&h(e,["createTime"],c);const f=d(t,["startTime"]);f!=null&&h(e,["startTime"],f);const y=d(t,["endTime"]);y!=null&&h(e,["endTime"],y);const p=d(t,["updateTime"]);p!=null&&h(e,["updateTime"],p);const m=d(t,["model"]);m!=null&&h(e,["model"],m);const v=d(t,["inputConfig"]);v!=null&&h(e,["src"],tE(v));const _=d(t,["outputConfig"]);_!=null&&h(e,["dest"],ZC(R_(_)));const x=d(t,["completionStats"]);return x!=null&&h(e,["completionStats"],x),e}function tE(t){const e={},n=d(t,["instancesFormat"]);n!=null&&h(e,["format"],n);const a=d(t,["gcsSource","uris"]);a!=null&&h(e,["gcsUri"],a);const r=d(t,["bigquerySource","inputUri"]);return r!=null&&h(e,["bigqueryUri"],r),e}function nE(t,e){const n={};if(d(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(d(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(d(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const a=d(e,["fileName"]);a!=null&&h(n,["fileName"],a);const r=d(e,["inlinedRequests"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(c=>NE(t,c))),h(n,["requests","requests"],l)}return n}function sE(t){const e={},n=d(t,["format"]);n!=null&&h(e,["instancesFormat"],n);const a=d(t,["gcsUri"]);a!=null&&h(e,["gcsSource","uris"],a);const r=d(t,["bigqueryUri"]);if(r!=null&&h(e,["bigquerySource","inputUri"],r),d(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(d(t,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function aE(t){const e={},n=d(t,["data"]);if(n!=null&&h(e,["data"],n),d(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const a=d(t,["mimeType"]);return a!=null&&h(e,["mimeType"],a),e}function iE(t,e){const n={},a=d(e,["name"]);return a!=null&&h(n,["_url","name"],Ri(t,a)),n}function rE(t,e){const n={},a=d(e,["name"]);return a!=null&&h(n,["_url","name"],Ri(t,a)),n}function oE(t){const e={},n=d(t,["content"]);n!=null&&h(e,["content"],n);const a=d(t,["citationMetadata"]);a!=null&&h(e,["citationMetadata"],lE(a));const r=d(t,["tokenCount"]);r!=null&&h(e,["tokenCount"],r);const l=d(t,["finishReason"]);l!=null&&h(e,["finishReason"],l);const c=d(t,["avgLogprobs"]);c!=null&&h(e,["avgLogprobs"],c);const f=d(t,["groundingMetadata"]);f!=null&&h(e,["groundingMetadata"],f);const y=d(t,["index"]);y!=null&&h(e,["index"],y);const p=d(t,["logprobsResult"]);p!=null&&h(e,["logprobsResult"],p);const m=d(t,["safetyRatings"]);if(m!=null){let _=m;Array.isArray(_)&&(_=_.map(x=>x)),h(e,["safetyRatings"],_)}const v=d(t,["urlContextMetadata"]);return v!=null&&h(e,["urlContextMetadata"],v),e}function lE(t){const e={},n=d(t,["citationSources"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(r=>r)),h(e,["citations"],a)}return e}function D_(t){const e={},n=d(t,["parts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(l=>UE(l))),h(e,["parts"],r)}const a=d(t,["role"]);return a!=null&&h(e,["role"],a),e}function uE(t,e){const n={},a=d(t,["displayName"]);if(e!==void 0&&a!=null&&h(e,["batch","displayName"],a),d(t,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return n}function cE(t,e){const n={},a=d(t,["displayName"]);e!==void 0&&a!=null&&h(e,["displayName"],a);const r=d(t,["dest"]);return e!==void 0&&r!=null&&h(e,["outputConfig"],eE(QC(r))),n}function Rv(t,e){const n={},a=d(e,["model"]);a!=null&&h(n,["_url","model"],Oe(t,a));const r=d(e,["src"]);r!=null&&h(n,["batch","inputConfig"],nE(t,I_(t,r)));const l=d(e,["config"]);return l!=null&&uE(l,n),n}function dE(t,e){const n={},a=d(e,["model"]);a!=null&&h(n,["model"],Oe(t,a));const r=d(e,["src"]);r!=null&&h(n,["inputConfig"],sE(I_(t,r)));const l=d(e,["config"]);return l!=null&&cE(l,n),n}function fE(t,e){const n={},a=d(t,["displayName"]);return e!==void 0&&a!=null&&h(e,["batch","displayName"],a),n}function pE(t,e){const n={},a=d(e,["model"]);a!=null&&h(n,["_url","model"],Oe(t,a));const r=d(e,["src"]);r!=null&&h(n,["batch","inputConfig"],_E(t,r));const l=d(e,["config"]);return l!=null&&fE(l,n),n}function mE(t,e){const n={},a=d(e,["name"]);return a!=null&&h(n,["_url","name"],Ri(t,a)),n}function hE(t,e){const n={},a=d(e,["name"]);return a!=null&&h(n,["_url","name"],Ri(t,a)),n}function gE(t){const e={},n=d(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const a=d(t,["name"]);a!=null&&h(e,["name"],a);const r=d(t,["done"]);r!=null&&h(e,["done"],r);const l=d(t,["error"]);return l!=null&&h(e,["error"],l),e}function yE(t){const e={},n=d(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const a=d(t,["name"]);a!=null&&h(e,["name"],a);const r=d(t,["done"]);r!=null&&h(e,["done"],r);const l=d(t,["error"]);return l!=null&&h(e,["error"],l),e}function vE(t,e){const n={},a=d(e,["contents"]);if(a!=null){let l=op(t,a);Array.isArray(l)&&(l=l.map(c=>c)),h(n,["requests[]","request","content"],l)}const r=d(e,["config"]);return r!=null&&(h(n,["_self"],SE(r,n)),hC(n,{"requests[].*":"requests[].request.*"})),n}function SE(t,e){const n={},a=d(t,["taskType"]);e!==void 0&&a!=null&&h(e,["requests[]","taskType"],a);const r=d(t,["title"]);e!==void 0&&r!=null&&h(e,["requests[]","title"],r);const l=d(t,["outputDimensionality"]);if(e!==void 0&&l!=null&&h(e,["requests[]","outputDimensionality"],l),d(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(d(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function _E(t,e){const n={},a=d(e,["fileName"]);a!=null&&h(n,["file_name"],a);const r=d(e,["inlinedRequests"]);return r!=null&&h(n,["requests"],vE(t,r)),n}function TE(t){const e={};if(d(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=d(t,["fileUri"]);n!=null&&h(e,["fileUri"],n);const a=d(t,["mimeType"]);return a!=null&&h(e,["mimeType"],a),e}function bE(t,e,n){const a={},r=d(e,["systemInstruction"]);n!==void 0&&r!=null&&h(n,["systemInstruction"],D_(Mt(r)));const l=d(e,["temperature"]);l!=null&&h(a,["temperature"],l);const c=d(e,["topP"]);c!=null&&h(a,["topP"],c);const f=d(e,["topK"]);f!=null&&h(a,["topK"],f);const y=d(e,["candidateCount"]);y!=null&&h(a,["candidateCount"],y);const p=d(e,["maxOutputTokens"]);p!=null&&h(a,["maxOutputTokens"],p);const m=d(e,["stopSequences"]);m!=null&&h(a,["stopSequences"],m);const v=d(e,["responseLogprobs"]);v!=null&&h(a,["responseLogprobs"],v);const _=d(e,["logprobs"]);_!=null&&h(a,["logprobs"],_);const x=d(e,["presencePenalty"]);x!=null&&h(a,["presencePenalty"],x);const w=d(e,["frequencyPenalty"]);w!=null&&h(a,["frequencyPenalty"],w);const A=d(e,["seed"]);A!=null&&h(a,["seed"],A);const C=d(e,["responseMimeType"]);C!=null&&h(a,["responseMimeType"],C);const N=d(e,["responseSchema"]);N!=null&&h(a,["responseSchema"],lp(N));const I=d(e,["responseJsonSchema"]);if(I!=null&&h(a,["responseJsonSchema"],I),d(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(d(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const R=d(e,["safetySettings"]);if(n!==void 0&&R!=null){let L=R;Array.isArray(L)&&(L=L.map(ne=>OE(ne))),h(n,["safetySettings"],L)}const M=d(e,["tools"]);if(n!==void 0&&M!=null){let L=Ii(M);Array.isArray(L)&&(L=L.map(ne=>qE(Ni(ne)))),h(n,["tools"],L)}const z=d(e,["toolConfig"]);if(n!==void 0&&z!=null&&h(n,["toolConfig"],z),d(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const B=d(e,["cachedContent"]);n!==void 0&&B!=null&&h(n,["cachedContent"],ls(t,B));const k=d(e,["responseModalities"]);k!=null&&h(a,["responseModalities"],k);const W=d(e,["mediaResolution"]);W!=null&&h(a,["mediaResolution"],W);const Y=d(e,["speechConfig"]);if(Y!=null&&h(a,["speechConfig"],up(Y)),d(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const Z=d(e,["thinkingConfig"]);Z!=null&&h(a,["thinkingConfig"],Z);const te=d(e,["imageConfig"]);return te!=null&&h(a,["imageConfig"],te),a}function xE(t){const e={},n=d(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const a=d(t,["candidates"]);if(a!=null){let y=a;Array.isArray(y)&&(y=y.map(p=>oE(p))),h(e,["candidates"],y)}const r=d(t,["modelVersion"]);r!=null&&h(e,["modelVersion"],r);const l=d(t,["promptFeedback"]);l!=null&&h(e,["promptFeedback"],l);const c=d(t,["responseId"]);c!=null&&h(e,["responseId"],c);const f=d(t,["usageMetadata"]);return f!=null&&h(e,["usageMetadata"],f),e}function AE(t,e){const n={},a=d(e,["name"]);return a!=null&&h(n,["_url","name"],Ri(t,a)),n}function wE(t,e){const n={},a=d(e,["name"]);return a!=null&&h(n,["_url","name"],Ri(t,a)),n}function CE(t){const e={};if(d(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=d(t,["enableWidget"]);return n!=null&&h(e,["enableWidget"],n),e}function EE(t){const e={};if(d(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(d(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=d(t,["timeRangeFilter"]);return n!=null&&h(e,["timeRangeFilter"],n),e}function NE(t,e){const n={},a=d(e,["model"]);a!=null&&h(n,["request","model"],Oe(t,a));const r=d(e,["contents"]);if(r!=null){let f=gn(r);Array.isArray(f)&&(f=f.map(y=>D_(y))),h(n,["request","contents"],f)}const l=d(e,["metadata"]);l!=null&&h(n,["metadata"],l);const c=d(e,["config"]);return c!=null&&h(n,["request","generationConfig"],bE(t,c,d(n,["request"],{}))),n}function IE(t){const e={},n=d(t,["response"]);n!=null&&h(e,["response"],xE(n));const a=d(t,["error"]);return a!=null&&h(e,["error"],a),e}function RE(t,e){const n={},a=d(t,["pageSize"]);e!==void 0&&a!=null&&h(e,["_query","pageSize"],a);const r=d(t,["pageToken"]);if(e!==void 0&&r!=null&&h(e,["_query","pageToken"],r),d(t,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return n}function ME(t,e){const n={},a=d(t,["pageSize"]);e!==void 0&&a!=null&&h(e,["_query","pageSize"],a);const r=d(t,["pageToken"]);e!==void 0&&r!=null&&h(e,["_query","pageToken"],r);const l=d(t,["filter"]);return e!==void 0&&l!=null&&h(e,["_query","filter"],l),n}function DE(t){const e={},n=d(t,["config"]);return n!=null&&RE(n,e),e}function PE(t){const e={},n=d(t,["config"]);return n!=null&&ME(n,e),e}function LE(t){const e={},n=d(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const a=d(t,["nextPageToken"]);a!=null&&h(e,["nextPageToken"],a);const r=d(t,["operations"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(c=>kl(c))),h(e,["batchJobs"],l)}return e}function kE(t){const e={},n=d(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const a=d(t,["nextPageToken"]);a!=null&&h(e,["nextPageToken"],a);const r=d(t,["batchPredictionJobs"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(c=>xf(c))),h(e,["batchJobs"],l)}return e}function UE(t){const e={},n=d(t,["functionCall"]);n!=null&&h(e,["functionCall"],n);const a=d(t,["codeExecutionResult"]);a!=null&&h(e,["codeExecutionResult"],a);const r=d(t,["executableCode"]);r!=null&&h(e,["executableCode"],r);const l=d(t,["fileData"]);l!=null&&h(e,["fileData"],TE(l));const c=d(t,["functionResponse"]);c!=null&&h(e,["functionResponse"],c);const f=d(t,["inlineData"]);f!=null&&h(e,["inlineData"],aE(f));const y=d(t,["text"]);y!=null&&h(e,["text"],y);const p=d(t,["thought"]);p!=null&&h(e,["thought"],p);const m=d(t,["thoughtSignature"]);m!=null&&h(e,["thoughtSignature"],m);const v=d(t,["videoMetadata"]);return v!=null&&h(e,["videoMetadata"],v),e}function OE(t){const e={},n=d(t,["category"]);if(n!=null&&h(e,["category"],n),d(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const a=d(t,["threshold"]);return a!=null&&h(e,["threshold"],a),e}function qE(t){const e={},n=d(t,["functionDeclarations"]);if(n!=null){let m=n;Array.isArray(m)&&(m=m.map(v=>v)),h(e,["functionDeclarations"],m)}if(d(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const a=d(t,["googleSearchRetrieval"]);a!=null&&h(e,["googleSearchRetrieval"],a);const r=d(t,["computerUse"]);r!=null&&h(e,["computerUse"],r);const l=d(t,["fileSearch"]);l!=null&&h(e,["fileSearch"],l);const c=d(t,["codeExecution"]);if(c!=null&&h(e,["codeExecution"],c),d(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const f=d(t,["googleMaps"]);f!=null&&h(e,["googleMaps"],CE(f));const y=d(t,["googleSearch"]);y!=null&&h(e,["googleSearch"],EE(y));const p=d(t,["urlContext"]);return p!=null&&h(e,["urlContext"],p),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var rs;(function(t){t.PAGED_ITEM_BATCH_JOBS="batchJobs",t.PAGED_ITEM_MODELS="models",t.PAGED_ITEM_TUNING_JOBS="tuningJobs",t.PAGED_ITEM_FILES="files",t.PAGED_ITEM_CACHED_CONTENTS="cachedContents",t.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",t.PAGED_ITEM_DOCUMENTS="documents"})(rs||(rs={}));class ba{constructor(e,n,a,r){this.pageInternal=[],this.paramsInternal={},this.requestInternal=n,this.init(e,a,r)}init(e,n,a){var r,l;this.nameInternal=e,this.pageInternal=n[this.nameInternal]||[],this.sdkHttpResponseInternal=n==null?void 0:n.sdkHttpResponse,this.idxInternal=0;let c={config:{}};!a||Object.keys(a).length===0?c={config:{}}:typeof a=="object"?c=Object.assign({},a):c=a,c.config&&(c.config.pageToken=n.nextPageToken),this.paramsInternal=c,this.pageInternalSize=(l=(r=c.config)===null||r===void 0?void 0:r.pageSize)!==null&&l!==void 0?l:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let BE=class extends os{constructor(e){super(),this.apiClient=e,this.create=async n=>(this.apiClient.isVertexAI()&&(n.config=this.formatDestination(n.src,n.config)),this.createInternal(n)),this.createEmbeddings=async n=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(n)},this.list=async(n={})=>new ba(rs.PAGED_ITEM_BATCH_JOBS,a=>this.listInternal(a),await this.listInternal(n),n)}createInlinedGenerateContentRequest(e){const n=Rv(this.apiClient,e),a=n._url,r=ie("{model}:batchGenerateContent",a),f=n.batch.inputConfig.requests,y=f.requests,p=[];for(const m of y){const v=Object.assign({},m);if(v.systemInstruction){const _=v.systemInstruction;delete v.systemInstruction;const x=v.request;x.systemInstruction=_,v.request=x}p.push(v)}return f.requests=p,delete n.config,delete n._url,delete n._query,{path:r,body:n}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,n){const a=n?Object.assign({},n):{},r=Date.now().toString();if(a.displayName||(a.displayName=`genaiBatchJob_${r}`),a.dest===void 0){const l=this.getGcsUri(e),c=this.getBigqueryUri(e);if(l)l.endsWith(".jsonl")?a.dest=`${l.slice(0,-6)}/dest`:a.dest=`${l}_dest_${r}`;else if(c)a.dest=`${c}_dest_${r}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return a}async createInternal(e){var n,a,r,l;let c,f="",y={};if(this.apiClient.isVertexAI()){const p=dE(this.apiClient,e);return f=ie("batchPredictionJobs",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json()),c.then(m=>xf(m))}else{const p=Rv(this.apiClient,e);return f=ie("{model}:batchGenerateContent",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c.then(m=>kl(m))}}async createEmbeddingsInternal(e){var n,a;let r,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const f=pE(this.apiClient,e);return l=ie("{model}:asyncBatchEmbedContent",f._url),c=f._query,delete f._url,delete f._query,r=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(y=>y.json()),r.then(y=>kl(y))}}async get(e){var n,a,r,l;let c,f="",y={};if(this.apiClient.isVertexAI()){const p=wE(this.apiClient,e);return f=ie("batchPredictionJobs/{name}",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json()),c.then(m=>xf(m))}else{const p=AE(this.apiClient,e);return f=ie("batches/{name}",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c.then(m=>kl(m))}}async cancel(e){var n,a,r,l;let c="",f={};if(this.apiClient.isVertexAI()){const y=rE(this.apiClient,e);c=ie("batchPredictionJobs/{name}:cancel",y._url),f=y._query,delete y._url,delete y._query,await this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(y),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal})}else{const y=iE(this.apiClient,e);c=ie("batches/{name}:cancel",y._url),f=y._query,delete y._url,delete y._query,await this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(y),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal})}}async listInternal(e){var n,a,r,l;let c,f="",y={};if(this.apiClient.isVertexAI()){const p=PE(e);return f=ie("batchPredictionJobs",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(v=>{const _=v;return _.sdkHttpResponse={headers:m.headers},_})),c.then(m=>{const v=kE(m),_=new Cv;return Object.assign(_,v),_})}else{const p=DE(e);return f=ie("batches",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(v=>{const _=v;return _.sdkHttpResponse={headers:m.headers},_})),c.then(m=>{const v=LE(m),_=new Cv;return Object.assign(_,v),_})}}async delete(e){var n,a,r,l;let c,f="",y={};if(this.apiClient.isVertexAI()){const p=hE(this.apiClient,e);return f=ie("batchPredictionJobs/{name}",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(v=>{const _=v;return _.sdkHttpResponse={headers:m.headers},_})),c.then(m=>yE(m))}else{const p=mE(this.apiClient,e);return f=ie("batches/{name}",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"DELETE",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(v=>{const _=v;return _.sdkHttpResponse={headers:m.headers},_})),c.then(m=>gE(m))}}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function HE(t){const e={},n=d(t,["data"]);if(n!=null&&h(e,["data"],n),d(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const a=d(t,["mimeType"]);return a!=null&&h(e,["mimeType"],a),e}function Mv(t){const e={},n=d(t,["parts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(l=>oN(l))),h(e,["parts"],r)}const a=d(t,["role"]);return a!=null&&h(e,["role"],a),e}function VE(t,e){const n={},a=d(t,["ttl"]);e!==void 0&&a!=null&&h(e,["ttl"],a);const r=d(t,["expireTime"]);e!==void 0&&r!=null&&h(e,["expireTime"],r);const l=d(t,["displayName"]);e!==void 0&&l!=null&&h(e,["displayName"],l);const c=d(t,["contents"]);if(e!==void 0&&c!=null){let m=gn(c);Array.isArray(m)&&(m=m.map(v=>Mv(v))),h(e,["contents"],m)}const f=d(t,["systemInstruction"]);e!==void 0&&f!=null&&h(e,["systemInstruction"],Mv(Mt(f)));const y=d(t,["tools"]);if(e!==void 0&&y!=null){let m=y;Array.isArray(m)&&(m=m.map(v=>lN(v))),h(e,["tools"],m)}const p=d(t,["toolConfig"]);if(e!==void 0&&p!=null&&h(e,["toolConfig"],p),d(t,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return n}function FE(t,e){const n={},a=d(t,["ttl"]);e!==void 0&&a!=null&&h(e,["ttl"],a);const r=d(t,["expireTime"]);e!==void 0&&r!=null&&h(e,["expireTime"],r);const l=d(t,["displayName"]);e!==void 0&&l!=null&&h(e,["displayName"],l);const c=d(t,["contents"]);if(e!==void 0&&c!=null){let v=gn(c);Array.isArray(v)&&(v=v.map(_=>_)),h(e,["contents"],v)}const f=d(t,["systemInstruction"]);e!==void 0&&f!=null&&h(e,["systemInstruction"],Mt(f));const y=d(t,["tools"]);if(e!==void 0&&y!=null){let v=y;Array.isArray(v)&&(v=v.map(_=>uN(_))),h(e,["tools"],v)}const p=d(t,["toolConfig"]);e!==void 0&&p!=null&&h(e,["toolConfig"],p);const m=d(t,["kmsKeyName"]);return e!==void 0&&m!=null&&h(e,["encryption_spec","kmsKeyName"],m),n}function GE(t,e){const n={},a=d(e,["model"]);a!=null&&h(n,["model"],__(t,a));const r=d(e,["config"]);return r!=null&&VE(r,n),n}function zE(t,e){const n={},a=d(e,["model"]);a!=null&&h(n,["model"],__(t,a));const r=d(e,["config"]);return r!=null&&FE(r,n),n}function $E(t,e){const n={},a=d(e,["name"]);return a!=null&&h(n,["_url","name"],ls(t,a)),n}function YE(t,e){const n={},a=d(e,["name"]);return a!=null&&h(n,["_url","name"],ls(t,a)),n}function JE(t){const e={},n=d(t,["sdkHttpResponse"]);return n!=null&&h(e,["sdkHttpResponse"],n),e}function KE(t){const e={},n=d(t,["sdkHttpResponse"]);return n!=null&&h(e,["sdkHttpResponse"],n),e}function jE(t){const e={};if(d(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=d(t,["fileUri"]);n!=null&&h(e,["fileUri"],n);const a=d(t,["mimeType"]);return a!=null&&h(e,["mimeType"],a),e}function XE(t){const e={};if(d(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=d(t,["description"]);n!=null&&h(e,["description"],n);const a=d(t,["name"]);a!=null&&h(e,["name"],a);const r=d(t,["parameters"]);r!=null&&h(e,["parameters"],r);const l=d(t,["parametersJsonSchema"]);l!=null&&h(e,["parametersJsonSchema"],l);const c=d(t,["response"]);c!=null&&h(e,["response"],c);const f=d(t,["responseJsonSchema"]);return f!=null&&h(e,["responseJsonSchema"],f),e}function QE(t,e){const n={},a=d(e,["name"]);return a!=null&&h(n,["_url","name"],ls(t,a)),n}function WE(t,e){const n={},a=d(e,["name"]);return a!=null&&h(n,["_url","name"],ls(t,a)),n}function ZE(t){const e={};if(d(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=d(t,["enableWidget"]);return n!=null&&h(e,["enableWidget"],n),e}function eN(t){const e={};if(d(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(d(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=d(t,["timeRangeFilter"]);return n!=null&&h(e,["timeRangeFilter"],n),e}function tN(t,e){const n={},a=d(t,["pageSize"]);e!==void 0&&a!=null&&h(e,["_query","pageSize"],a);const r=d(t,["pageToken"]);return e!==void 0&&r!=null&&h(e,["_query","pageToken"],r),n}function nN(t,e){const n={},a=d(t,["pageSize"]);e!==void 0&&a!=null&&h(e,["_query","pageSize"],a);const r=d(t,["pageToken"]);return e!==void 0&&r!=null&&h(e,["_query","pageToken"],r),n}function sN(t){const e={},n=d(t,["config"]);return n!=null&&tN(n,e),e}function aN(t){const e={},n=d(t,["config"]);return n!=null&&nN(n,e),e}function iN(t){const e={},n=d(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const a=d(t,["nextPageToken"]);a!=null&&h(e,["nextPageToken"],a);const r=d(t,["cachedContents"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(c=>c)),h(e,["cachedContents"],l)}return e}function rN(t){const e={},n=d(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const a=d(t,["nextPageToken"]);a!=null&&h(e,["nextPageToken"],a);const r=d(t,["cachedContents"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(c=>c)),h(e,["cachedContents"],l)}return e}function oN(t){const e={},n=d(t,["functionCall"]);n!=null&&h(e,["functionCall"],n);const a=d(t,["codeExecutionResult"]);a!=null&&h(e,["codeExecutionResult"],a);const r=d(t,["executableCode"]);r!=null&&h(e,["executableCode"],r);const l=d(t,["fileData"]);l!=null&&h(e,["fileData"],jE(l));const c=d(t,["functionResponse"]);c!=null&&h(e,["functionResponse"],c);const f=d(t,["inlineData"]);f!=null&&h(e,["inlineData"],HE(f));const y=d(t,["text"]);y!=null&&h(e,["text"],y);const p=d(t,["thought"]);p!=null&&h(e,["thought"],p);const m=d(t,["thoughtSignature"]);m!=null&&h(e,["thoughtSignature"],m);const v=d(t,["videoMetadata"]);return v!=null&&h(e,["videoMetadata"],v),e}function lN(t){const e={},n=d(t,["functionDeclarations"]);if(n!=null){let m=n;Array.isArray(m)&&(m=m.map(v=>v)),h(e,["functionDeclarations"],m)}if(d(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const a=d(t,["googleSearchRetrieval"]);a!=null&&h(e,["googleSearchRetrieval"],a);const r=d(t,["computerUse"]);r!=null&&h(e,["computerUse"],r);const l=d(t,["fileSearch"]);l!=null&&h(e,["fileSearch"],l);const c=d(t,["codeExecution"]);if(c!=null&&h(e,["codeExecution"],c),d(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const f=d(t,["googleMaps"]);f!=null&&h(e,["googleMaps"],ZE(f));const y=d(t,["googleSearch"]);y!=null&&h(e,["googleSearch"],eN(y));const p=d(t,["urlContext"]);return p!=null&&h(e,["urlContext"],p),e}function uN(t){const e={},n=d(t,["functionDeclarations"]);if(n!=null){let v=n;Array.isArray(v)&&(v=v.map(_=>XE(_))),h(e,["functionDeclarations"],v)}const a=d(t,["retrieval"]);a!=null&&h(e,["retrieval"],a);const r=d(t,["googleSearchRetrieval"]);r!=null&&h(e,["googleSearchRetrieval"],r);const l=d(t,["computerUse"]);if(l!=null&&h(e,["computerUse"],l),d(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const c=d(t,["codeExecution"]);c!=null&&h(e,["codeExecution"],c);const f=d(t,["enterpriseWebSearch"]);f!=null&&h(e,["enterpriseWebSearch"],f);const y=d(t,["googleMaps"]);y!=null&&h(e,["googleMaps"],y);const p=d(t,["googleSearch"]);p!=null&&h(e,["googleSearch"],p);const m=d(t,["urlContext"]);return m!=null&&h(e,["urlContext"],m),e}function cN(t,e){const n={},a=d(t,["ttl"]);e!==void 0&&a!=null&&h(e,["ttl"],a);const r=d(t,["expireTime"]);return e!==void 0&&r!=null&&h(e,["expireTime"],r),n}function dN(t,e){const n={},a=d(t,["ttl"]);e!==void 0&&a!=null&&h(e,["ttl"],a);const r=d(t,["expireTime"]);return e!==void 0&&r!=null&&h(e,["expireTime"],r),n}function fN(t,e){const n={},a=d(e,["name"]);a!=null&&h(n,["_url","name"],ls(t,a));const r=d(e,["config"]);return r!=null&&cN(r,n),n}function pN(t,e){const n={},a=d(e,["name"]);a!=null&&h(n,["_url","name"],ls(t,a));const r=d(e,["config"]);return r!=null&&dN(r,n),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class mN extends os{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new ba(rs.PAGED_ITEM_CACHED_CONTENTS,a=>this.listInternal(a),await this.listInternal(n),n)}async create(e){var n,a,r,l;let c,f="",y={};if(this.apiClient.isVertexAI()){const p=zE(this.apiClient,e);return f=ie("cachedContents",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json()),c.then(m=>m)}else{const p=GE(this.apiClient,e);return f=ie("cachedContents",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c.then(m=>m)}}async get(e){var n,a,r,l;let c,f="",y={};if(this.apiClient.isVertexAI()){const p=WE(this.apiClient,e);return f=ie("{name}",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json()),c.then(m=>m)}else{const p=QE(this.apiClient,e);return f=ie("{name}",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c.then(m=>m)}}async delete(e){var n,a,r,l;let c,f="",y={};if(this.apiClient.isVertexAI()){const p=YE(this.apiClient,e);return f=ie("{name}",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(v=>{const _=v;return _.sdkHttpResponse={headers:m.headers},_})),c.then(m=>{const v=KE(m),_=new Av;return Object.assign(_,v),_})}else{const p=$E(this.apiClient,e);return f=ie("{name}",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"DELETE",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(v=>{const _=v;return _.sdkHttpResponse={headers:m.headers},_})),c.then(m=>{const v=JE(m),_=new Av;return Object.assign(_,v),_})}}async update(e){var n,a,r,l;let c,f="",y={};if(this.apiClient.isVertexAI()){const p=pN(this.apiClient,e);return f=ie("{name}",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json()),c.then(m=>m)}else{const p=fN(this.apiClient,e);return f=ie("{name}",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"PATCH",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c.then(m=>m)}}async listInternal(e){var n,a,r,l;let c,f="",y={};if(this.apiClient.isVertexAI()){const p=aN(e);return f=ie("cachedContents",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(v=>{const _=v;return _.sdkHttpResponse={headers:m.headers},_})),c.then(m=>{const v=rN(m),_=new wv;return Object.assign(_,v),_})}else{const p=sN(e);return f=ie("cachedContents",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(v=>{const _=v;return _.sdkHttpResponse={headers:m.headers},_})),c.then(m=>{const v=iN(m),_=new wv;return Object.assign(_,v),_})}}}function Dv(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],a=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&a>=t.length&&(t=void 0),{value:t&&t[a++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Qe(t){return this instanceof Qe?(this.v=t,this):new Qe(t)}function bi(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a=n.apply(t,e||[]),r,l=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),f("next"),f("throw"),f("return",c),r[Symbol.asyncIterator]=function(){return this},r;function c(x){return function(w){return Promise.resolve(w).then(x,v)}}function f(x,w){a[x]&&(r[x]=function(A){return new Promise(function(C,N){l.push([x,A,C,N])>1||y(x,A)})},w&&(r[x]=w(r[x])))}function y(x,w){try{p(a[x](w))}catch(A){_(l[0][3],A)}}function p(x){x.value instanceof Qe?Promise.resolve(x.value.v).then(m,v):_(l[0][2],x)}function m(x){y("next",x)}function v(x){y("throw",x)}function _(x,w){x(w),l.shift(),l.length&&y(l[0][0],l[0][1])}}function Hr(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Dv=="function"?Dv(t):t[Symbol.iterator](),n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n);function a(l){n[l]=t[l]&&function(c){return new Promise(function(f,y){c=t[l](c),r(f,y,c.done,c.value)})}}function r(l,c,f,y){Promise.resolve(y).then(function(p){l({value:p,done:f})},c)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function hN(t){var e;if(t.candidates==null||t.candidates.length===0)return!1;const n=(e=t.candidates[0])===null||e===void 0?void 0:e.content;return n===void 0?!1:P_(n)}function P_(t){if(t.parts===void 0||t.parts.length===0)return!1;for(const e of t.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function gN(t){if(t.length!==0){for(const e of t)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function Pv(t){if(t===void 0||t.length===0)return[];const e=[],n=t.length;let a=0;for(;a<n;)if(t[a].role==="user")e.push(t[a]),a++;else{const r=[];let l=!0;for(;a<n&&t[a].role==="model";)r.push(t[a]),l&&!P_(t[a])&&(l=!1),a++;l?e.push(...r):e.pop()}return e}class yN{constructor(e,n){this.modelsModule=e,this.apiClient=n}create(e){return new vN(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}let vN=class{constructor(e,n,a,r={},l=[]){this.apiClient=e,this.modelsModule=n,this.model=a,this.config=r,this.history=l,this.sendPromise=Promise.resolve(),gN(l)}async sendMessage(e){var n;await this.sendPromise;const a=Mt(e.message),r=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(a),config:(n=e.config)!==null&&n!==void 0?n:this.config});return this.sendPromise=(async()=>{var l,c,f;const y=await r,p=(c=(l=y.candidates)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.content,m=y.automaticFunctionCallingHistory,v=this.getHistory(!0).length;let _=[];m!=null&&(_=(f=m.slice(v))!==null&&f!==void 0?f:[]);const x=p?[p]:[];this.recordHistory(a,x,_)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),r}async sendMessageStream(e){var n;await this.sendPromise;const a=Mt(e.message),r=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(a),config:(n=e.config)!==null&&n!==void 0?n:this.config});this.sendPromise=r.then(()=>{}).catch(()=>{});const l=await r;return this.processStreamResponse(l,a)}getHistory(e=!1){const n=e?Pv(this.history):this.history;return structuredClone(n)}processStreamResponse(e,n){var a,r;return bi(this,arguments,function*(){var c,f,y,p;const m=[];try{for(var v=!0,_=Hr(e),x;x=yield Qe(_.next()),c=x.done,!c;v=!0){p=x.value,v=!1;const w=p;if(hN(w)){const A=(r=(a=w.candidates)===null||a===void 0?void 0:a[0])===null||r===void 0?void 0:r.content;A!==void 0&&m.push(A)}yield yield Qe(w)}}catch(w){f={error:w}}finally{try{!v&&!c&&(y=_.return)&&(yield Qe(y.call(_)))}finally{if(f)throw f.error}}this.recordHistory(n,m)})}recordHistory(e,n,a){let r=[];n.length>0&&n.every(l=>l.role!==void 0)?r=n:r.push({role:"model",parts:[]}),a&&a.length>0?this.history.push(...Pv(a)):this.history.push(e),this.history.push(...r)}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ru extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,ru.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function SN(t){const e={},n=d(t,["file"]);return n!=null&&h(e,["file"],n),e}function _N(t){const e={},n=d(t,["sdkHttpResponse"]);return n!=null&&h(e,["sdkHttpResponse"],n),e}function TN(t){const e={},n=d(t,["name"]);return n!=null&&h(e,["_url","file"],C_(n)),e}function bN(t){const e={},n=d(t,["sdkHttpResponse"]);return n!=null&&h(e,["sdkHttpResponse"],n),e}function xN(t){const e={},n=d(t,["name"]);return n!=null&&h(e,["_url","file"],C_(n)),e}function AN(t,e){const n={},a=d(t,["pageSize"]);e!==void 0&&a!=null&&h(e,["_query","pageSize"],a);const r=d(t,["pageToken"]);return e!==void 0&&r!=null&&h(e,["_query","pageToken"],r),n}function wN(t){const e={},n=d(t,["config"]);return n!=null&&AN(n,e),e}function CN(t){const e={},n=d(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const a=d(t,["nextPageToken"]);a!=null&&h(e,["nextPageToken"],a);const r=d(t,["files"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(c=>c)),h(e,["files"],l)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let EN=class extends os{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new ba(rs.PAGED_ITEM_FILES,a=>this.listInternal(a),await this.listInternal(n),n)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(n=>n)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var n,a;let r,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const f=wN(e);return l=ie("files",f._url),c=f._query,delete f._url,delete f._query,r=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(y=>y.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:y.headers},m})),r.then(y=>{const p=CN(y),m=new qC;return Object.assign(m,p),m})}}async createInternal(e){var n,a;let r,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const f=SN(e);return l=ie("upload/v1beta/files",f._url),c=f._query,delete f._url,delete f._query,r=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(y=>y.json()),r.then(y=>{const p=_N(y),m=new BC;return Object.assign(m,p),m})}}async get(e){var n,a;let r,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const f=xN(e);return l=ie("files/{file}",f._url),c=f._query,delete f._url,delete f._query,r=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(y=>y.json()),r.then(y=>y)}}async delete(e){var n,a;let r,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const f=TN(e);return l=ie("files/{file}",f._url),c=f._query,delete f._url,delete f._query,r=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(y=>y.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:y.headers},m})),r.then(y=>{const p=bN(y),m=new HC;return Object.assign(m,p),m})}}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ul(t){const e={},n=d(t,["data"]);if(n!=null&&h(e,["data"],n),d(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const a=d(t,["mimeType"]);return a!=null&&h(e,["mimeType"],a),e}function NN(t){const e={},n=d(t,["parts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(l=>GN(l))),h(e,["parts"],r)}const a=d(t,["role"]);return a!=null&&h(e,["role"],a),e}function IN(t){const e={};if(d(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=d(t,["fileUri"]);n!=null&&h(e,["fileUri"],n);const a=d(t,["mimeType"]);return a!=null&&h(e,["mimeType"],a),e}function RN(t){const e={};if(d(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=d(t,["description"]);n!=null&&h(e,["description"],n);const a=d(t,["name"]);a!=null&&h(e,["name"],a);const r=d(t,["parameters"]);r!=null&&h(e,["parameters"],r);const l=d(t,["parametersJsonSchema"]);l!=null&&h(e,["parametersJsonSchema"],l);const c=d(t,["response"]);c!=null&&h(e,["response"],c);const f=d(t,["responseJsonSchema"]);return f!=null&&h(e,["responseJsonSchema"],f),e}function MN(t){const e={},n=d(t,["modelSelectionConfig"]);n!=null&&h(e,["modelConfig"],n);const a=d(t,["responseJsonSchema"]);a!=null&&h(e,["responseJsonSchema"],a);const r=d(t,["audioTimestamp"]);r!=null&&h(e,["audioTimestamp"],r);const l=d(t,["candidateCount"]);l!=null&&h(e,["candidateCount"],l);const c=d(t,["enableAffectiveDialog"]);c!=null&&h(e,["enableAffectiveDialog"],c);const f=d(t,["frequencyPenalty"]);f!=null&&h(e,["frequencyPenalty"],f);const y=d(t,["logprobs"]);y!=null&&h(e,["logprobs"],y);const p=d(t,["maxOutputTokens"]);p!=null&&h(e,["maxOutputTokens"],p);const m=d(t,["mediaResolution"]);m!=null&&h(e,["mediaResolution"],m);const v=d(t,["presencePenalty"]);v!=null&&h(e,["presencePenalty"],v);const _=d(t,["responseLogprobs"]);_!=null&&h(e,["responseLogprobs"],_);const x=d(t,["responseMimeType"]);x!=null&&h(e,["responseMimeType"],x);const w=d(t,["responseModalities"]);w!=null&&h(e,["responseModalities"],w);const A=d(t,["responseSchema"]);A!=null&&h(e,["responseSchema"],A);const C=d(t,["routingConfig"]);C!=null&&h(e,["routingConfig"],C);const N=d(t,["seed"]);N!=null&&h(e,["seed"],N);const I=d(t,["speechConfig"]);I!=null&&h(e,["speechConfig"],L_(I));const R=d(t,["stopSequences"]);R!=null&&h(e,["stopSequences"],R);const M=d(t,["temperature"]);M!=null&&h(e,["temperature"],M);const z=d(t,["thinkingConfig"]);z!=null&&h(e,["thinkingConfig"],z);const B=d(t,["topK"]);B!=null&&h(e,["topK"],B);const k=d(t,["topP"]);if(k!=null&&h(e,["topP"],k),d(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function DN(t){const e={};if(d(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=d(t,["enableWidget"]);return n!=null&&h(e,["enableWidget"],n),e}function PN(t){const e={};if(d(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(d(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=d(t,["timeRangeFilter"]);return n!=null&&h(e,["timeRangeFilter"],n),e}function LN(t,e){const n={},a=d(t,["generationConfig"]);e!==void 0&&a!=null&&h(e,["setup","generationConfig"],a);const r=d(t,["responseModalities"]);e!==void 0&&r!=null&&h(e,["setup","generationConfig","responseModalities"],r);const l=d(t,["temperature"]);e!==void 0&&l!=null&&h(e,["setup","generationConfig","temperature"],l);const c=d(t,["topP"]);e!==void 0&&c!=null&&h(e,["setup","generationConfig","topP"],c);const f=d(t,["topK"]);e!==void 0&&f!=null&&h(e,["setup","generationConfig","topK"],f);const y=d(t,["maxOutputTokens"]);e!==void 0&&y!=null&&h(e,["setup","generationConfig","maxOutputTokens"],y);const p=d(t,["mediaResolution"]);e!==void 0&&p!=null&&h(e,["setup","generationConfig","mediaResolution"],p);const m=d(t,["seed"]);e!==void 0&&m!=null&&h(e,["setup","generationConfig","seed"],m);const v=d(t,["speechConfig"]);e!==void 0&&v!=null&&h(e,["setup","generationConfig","speechConfig"],cp(v));const _=d(t,["thinkingConfig"]);e!==void 0&&_!=null&&h(e,["setup","generationConfig","thinkingConfig"],_);const x=d(t,["enableAffectiveDialog"]);e!==void 0&&x!=null&&h(e,["setup","generationConfig","enableAffectiveDialog"],x);const w=d(t,["systemInstruction"]);e!==void 0&&w!=null&&h(e,["setup","systemInstruction"],NN(Mt(w)));const A=d(t,["tools"]);if(e!==void 0&&A!=null){let B=Ii(A);Array.isArray(B)&&(B=B.map(k=>$N(Ni(k)))),h(e,["setup","tools"],B)}const C=d(t,["sessionResumption"]);e!==void 0&&C!=null&&h(e,["setup","sessionResumption"],zN(C));const N=d(t,["inputAudioTranscription"]);e!==void 0&&N!=null&&h(e,["setup","inputAudioTranscription"],N);const I=d(t,["outputAudioTranscription"]);e!==void 0&&I!=null&&h(e,["setup","outputAudioTranscription"],I);const R=d(t,["realtimeInputConfig"]);e!==void 0&&R!=null&&h(e,["setup","realtimeInputConfig"],R);const M=d(t,["contextWindowCompression"]);e!==void 0&&M!=null&&h(e,["setup","contextWindowCompression"],M);const z=d(t,["proactivity"]);return e!==void 0&&z!=null&&h(e,["setup","proactivity"],z),n}function kN(t,e){const n={},a=d(t,["generationConfig"]);e!==void 0&&a!=null&&h(e,["setup","generationConfig"],MN(a));const r=d(t,["responseModalities"]);e!==void 0&&r!=null&&h(e,["setup","generationConfig","responseModalities"],r);const l=d(t,["temperature"]);e!==void 0&&l!=null&&h(e,["setup","generationConfig","temperature"],l);const c=d(t,["topP"]);e!==void 0&&c!=null&&h(e,["setup","generationConfig","topP"],c);const f=d(t,["topK"]);e!==void 0&&f!=null&&h(e,["setup","generationConfig","topK"],f);const y=d(t,["maxOutputTokens"]);e!==void 0&&y!=null&&h(e,["setup","generationConfig","maxOutputTokens"],y);const p=d(t,["mediaResolution"]);e!==void 0&&p!=null&&h(e,["setup","generationConfig","mediaResolution"],p);const m=d(t,["seed"]);e!==void 0&&m!=null&&h(e,["setup","generationConfig","seed"],m);const v=d(t,["speechConfig"]);e!==void 0&&v!=null&&h(e,["setup","generationConfig","speechConfig"],L_(cp(v)));const _=d(t,["thinkingConfig"]);e!==void 0&&_!=null&&h(e,["setup","generationConfig","thinkingConfig"],_);const x=d(t,["enableAffectiveDialog"]);e!==void 0&&x!=null&&h(e,["setup","generationConfig","enableAffectiveDialog"],x);const w=d(t,["systemInstruction"]);e!==void 0&&w!=null&&h(e,["setup","systemInstruction"],Mt(w));const A=d(t,["tools"]);if(e!==void 0&&A!=null){let B=Ii(A);Array.isArray(B)&&(B=B.map(k=>YN(Ni(k)))),h(e,["setup","tools"],B)}const C=d(t,["sessionResumption"]);e!==void 0&&C!=null&&h(e,["setup","sessionResumption"],C);const N=d(t,["inputAudioTranscription"]);e!==void 0&&N!=null&&h(e,["setup","inputAudioTranscription"],N);const I=d(t,["outputAudioTranscription"]);e!==void 0&&I!=null&&h(e,["setup","outputAudioTranscription"],I);const R=d(t,["realtimeInputConfig"]);e!==void 0&&R!=null&&h(e,["setup","realtimeInputConfig"],R);const M=d(t,["contextWindowCompression"]);e!==void 0&&M!=null&&h(e,["setup","contextWindowCompression"],M);const z=d(t,["proactivity"]);return e!==void 0&&z!=null&&h(e,["setup","proactivity"],z),n}function UN(t,e){const n={},a=d(e,["model"]);a!=null&&h(n,["setup","model"],Oe(t,a));const r=d(e,["config"]);return r!=null&&h(n,["config"],LN(r,n)),n}function ON(t,e){const n={},a=d(e,["model"]);a!=null&&h(n,["setup","model"],Oe(t,a));const r=d(e,["config"]);return r!=null&&h(n,["config"],kN(r,n)),n}function qN(t){const e={},n=d(t,["musicGenerationConfig"]);return n!=null&&h(e,["musicGenerationConfig"],n),e}function BN(t){const e={},n=d(t,["weightedPrompts"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(r=>r)),h(e,["weightedPrompts"],a)}return e}function HN(t){const e={},n=d(t,["media"]);if(n!=null){let p=T_(n);Array.isArray(p)&&(p=p.map(m=>Ul(m))),h(e,["mediaChunks"],p)}const a=d(t,["audio"]);a!=null&&h(e,["audio"],Ul(x_(a)));const r=d(t,["audioStreamEnd"]);r!=null&&h(e,["audioStreamEnd"],r);const l=d(t,["video"]);l!=null&&h(e,["video"],Ul(b_(l)));const c=d(t,["text"]);c!=null&&h(e,["text"],c);const f=d(t,["activityStart"]);f!=null&&h(e,["activityStart"],f);const y=d(t,["activityEnd"]);return y!=null&&h(e,["activityEnd"],y),e}function VN(t){const e={},n=d(t,["media"]);if(n!=null){let p=T_(n);Array.isArray(p)&&(p=p.map(m=>m)),h(e,["mediaChunks"],p)}const a=d(t,["audio"]);a!=null&&h(e,["audio"],x_(a));const r=d(t,["audioStreamEnd"]);r!=null&&h(e,["audioStreamEnd"],r);const l=d(t,["video"]);l!=null&&h(e,["video"],b_(l));const c=d(t,["text"]);c!=null&&h(e,["text"],c);const f=d(t,["activityStart"]);f!=null&&h(e,["activityStart"],f);const y=d(t,["activityEnd"]);return y!=null&&h(e,["activityEnd"],y),e}function FN(t){const e={},n=d(t,["setupComplete"]);n!=null&&h(e,["setupComplete"],n);const a=d(t,["serverContent"]);a!=null&&h(e,["serverContent"],a);const r=d(t,["toolCall"]);r!=null&&h(e,["toolCall"],r);const l=d(t,["toolCallCancellation"]);l!=null&&h(e,["toolCallCancellation"],l);const c=d(t,["usageMetadata"]);c!=null&&h(e,["usageMetadata"],JN(c));const f=d(t,["goAway"]);f!=null&&h(e,["goAway"],f);const y=d(t,["sessionResumptionUpdate"]);return y!=null&&h(e,["sessionResumptionUpdate"],y),e}function GN(t){const e={},n=d(t,["functionCall"]);n!=null&&h(e,["functionCall"],n);const a=d(t,["codeExecutionResult"]);a!=null&&h(e,["codeExecutionResult"],a);const r=d(t,["executableCode"]);r!=null&&h(e,["executableCode"],r);const l=d(t,["fileData"]);l!=null&&h(e,["fileData"],IN(l));const c=d(t,["functionResponse"]);c!=null&&h(e,["functionResponse"],c);const f=d(t,["inlineData"]);f!=null&&h(e,["inlineData"],Ul(f));const y=d(t,["text"]);y!=null&&h(e,["text"],y);const p=d(t,["thought"]);p!=null&&h(e,["thought"],p);const m=d(t,["thoughtSignature"]);m!=null&&h(e,["thoughtSignature"],m);const v=d(t,["videoMetadata"]);return v!=null&&h(e,["videoMetadata"],v),e}function zN(t){const e={},n=d(t,["handle"]);if(n!=null&&h(e,["handle"],n),d(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function L_(t){const e={},n=d(t,["languageCode"]);n!=null&&h(e,["languageCode"],n);const a=d(t,["voiceConfig"]);if(a!=null&&h(e,["voiceConfig"],a),d(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function $N(t){const e={},n=d(t,["functionDeclarations"]);if(n!=null){let m=n;Array.isArray(m)&&(m=m.map(v=>v)),h(e,["functionDeclarations"],m)}if(d(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const a=d(t,["googleSearchRetrieval"]);a!=null&&h(e,["googleSearchRetrieval"],a);const r=d(t,["computerUse"]);r!=null&&h(e,["computerUse"],r);const l=d(t,["fileSearch"]);l!=null&&h(e,["fileSearch"],l);const c=d(t,["codeExecution"]);if(c!=null&&h(e,["codeExecution"],c),d(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const f=d(t,["googleMaps"]);f!=null&&h(e,["googleMaps"],DN(f));const y=d(t,["googleSearch"]);y!=null&&h(e,["googleSearch"],PN(y));const p=d(t,["urlContext"]);return p!=null&&h(e,["urlContext"],p),e}function YN(t){const e={},n=d(t,["functionDeclarations"]);if(n!=null){let v=n;Array.isArray(v)&&(v=v.map(_=>RN(_))),h(e,["functionDeclarations"],v)}const a=d(t,["retrieval"]);a!=null&&h(e,["retrieval"],a);const r=d(t,["googleSearchRetrieval"]);r!=null&&h(e,["googleSearchRetrieval"],r);const l=d(t,["computerUse"]);if(l!=null&&h(e,["computerUse"],l),d(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const c=d(t,["codeExecution"]);c!=null&&h(e,["codeExecution"],c);const f=d(t,["enterpriseWebSearch"]);f!=null&&h(e,["enterpriseWebSearch"],f);const y=d(t,["googleMaps"]);y!=null&&h(e,["googleMaps"],y);const p=d(t,["googleSearch"]);p!=null&&h(e,["googleSearch"],p);const m=d(t,["urlContext"]);return m!=null&&h(e,["urlContext"],m),e}function JN(t){const e={},n=d(t,["promptTokenCount"]);n!=null&&h(e,["promptTokenCount"],n);const a=d(t,["cachedContentTokenCount"]);a!=null&&h(e,["cachedContentTokenCount"],a);const r=d(t,["candidatesTokenCount"]);r!=null&&h(e,["responseTokenCount"],r);const l=d(t,["toolUsePromptTokenCount"]);l!=null&&h(e,["toolUsePromptTokenCount"],l);const c=d(t,["thoughtsTokenCount"]);c!=null&&h(e,["thoughtsTokenCount"],c);const f=d(t,["totalTokenCount"]);f!=null&&h(e,["totalTokenCount"],f);const y=d(t,["promptTokensDetails"]);if(y!=null){let x=y;Array.isArray(x)&&(x=x.map(w=>w)),h(e,["promptTokensDetails"],x)}const p=d(t,["cacheTokensDetails"]);if(p!=null){let x=p;Array.isArray(x)&&(x=x.map(w=>w)),h(e,["cacheTokensDetails"],x)}const m=d(t,["candidatesTokensDetails"]);if(m!=null){let x=m;Array.isArray(x)&&(x=x.map(w=>w)),h(e,["responseTokensDetails"],x)}const v=d(t,["toolUsePromptTokensDetails"]);if(v!=null){let x=v;Array.isArray(x)&&(x=x.map(w=>w)),h(e,["toolUsePromptTokensDetails"],x)}const _=d(t,["trafficType"]);return _!=null&&h(e,["trafficType"],_),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function KN(t){const e={},n=d(t,["data"]);if(n!=null&&h(e,["data"],n),d(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const a=d(t,["mimeType"]);return a!=null&&h(e,["mimeType"],a),e}function jN(t){const e={},n=d(t,["content"]);n!=null&&h(e,["content"],n);const a=d(t,["citationMetadata"]);a!=null&&h(e,["citationMetadata"],XN(a));const r=d(t,["tokenCount"]);r!=null&&h(e,["tokenCount"],r);const l=d(t,["finishReason"]);l!=null&&h(e,["finishReason"],l);const c=d(t,["avgLogprobs"]);c!=null&&h(e,["avgLogprobs"],c);const f=d(t,["groundingMetadata"]);f!=null&&h(e,["groundingMetadata"],f);const y=d(t,["index"]);y!=null&&h(e,["index"],y);const p=d(t,["logprobsResult"]);p!=null&&h(e,["logprobsResult"],p);const m=d(t,["safetyRatings"]);if(m!=null){let _=m;Array.isArray(_)&&(_=_.map(x=>x)),h(e,["safetyRatings"],_)}const v=d(t,["urlContextMetadata"]);return v!=null&&h(e,["urlContextMetadata"],v),e}function XN(t){const e={},n=d(t,["citationSources"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(r=>r)),h(e,["citations"],a)}return e}function QN(t,e){const n={},a=d(e,["model"]);a!=null&&h(n,["_url","model"],Oe(t,a));const r=d(e,["contents"]);if(r!=null){let l=gn(r);Array.isArray(l)&&(l=l.map(c=>c)),h(n,["contents"],l)}return n}function WN(t){const e={},n=d(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const a=d(t,["tokensInfo"]);if(a!=null){let r=a;Array.isArray(r)&&(r=r.map(l=>l)),h(e,["tokensInfo"],r)}return e}function ZN(t){const e={},n=d(t,["values"]);n!=null&&h(e,["values"],n);const a=d(t,["statistics"]);return a!=null&&h(e,["statistics"],eI(a)),e}function eI(t){const e={},n=d(t,["truncated"]);n!=null&&h(e,["truncated"],n);const a=d(t,["token_count"]);return a!=null&&h(e,["tokenCount"],a),e}function ou(t){const e={},n=d(t,["parts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(l=>iR(l))),h(e,["parts"],r)}const a=d(t,["role"]);return a!=null&&h(e,["role"],a),e}function tI(t){const e={},n=d(t,["controlType"]);n!=null&&h(e,["controlType"],n);const a=d(t,["enableControlImageComputation"]);return a!=null&&h(e,["computeControl"],a),e}function nI(t){const e={};if(d(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(d(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(d(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function sI(t,e){const n={},a=d(t,["systemInstruction"]);e!==void 0&&a!=null&&h(e,["systemInstruction"],Mt(a));const r=d(t,["tools"]);if(e!==void 0&&r!=null){let c=r;Array.isArray(c)&&(c=c.map(f=>B_(f))),h(e,["tools"],c)}const l=d(t,["generationConfig"]);return e!==void 0&&l!=null&&h(e,["generationConfig"],YI(l)),n}function aI(t,e){const n={},a=d(e,["model"]);a!=null&&h(n,["_url","model"],Oe(t,a));const r=d(e,["contents"]);if(r!=null){let c=gn(r);Array.isArray(c)&&(c=c.map(f=>ou(f))),h(n,["contents"],c)}const l=d(e,["config"]);return l!=null&&nI(l),n}function iI(t,e){const n={},a=d(e,["model"]);a!=null&&h(n,["_url","model"],Oe(t,a));const r=d(e,["contents"]);if(r!=null){let c=gn(r);Array.isArray(c)&&(c=c.map(f=>f)),h(n,["contents"],c)}const l=d(e,["config"]);return l!=null&&sI(l,n),n}function rI(t){const e={},n=d(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const a=d(t,["totalTokens"]);a!=null&&h(e,["totalTokens"],a);const r=d(t,["cachedContentTokenCount"]);return r!=null&&h(e,["cachedContentTokenCount"],r),e}function oI(t){const e={},n=d(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const a=d(t,["totalTokens"]);return a!=null&&h(e,["totalTokens"],a),e}function lI(t,e){const n={},a=d(e,["model"]);return a!=null&&h(n,["_url","name"],Oe(t,a)),n}function uI(t,e){const n={},a=d(e,["model"]);return a!=null&&h(n,["_url","name"],Oe(t,a)),n}function cI(t){const e={},n=d(t,["sdkHttpResponse"]);return n!=null&&h(e,["sdkHttpResponse"],n),e}function dI(t){const e={},n=d(t,["sdkHttpResponse"]);return n!=null&&h(e,["sdkHttpResponse"],n),e}function fI(t,e){const n={},a=d(t,["outputGcsUri"]);e!==void 0&&a!=null&&h(e,["parameters","storageUri"],a);const r=d(t,["negativePrompt"]);e!==void 0&&r!=null&&h(e,["parameters","negativePrompt"],r);const l=d(t,["numberOfImages"]);e!==void 0&&l!=null&&h(e,["parameters","sampleCount"],l);const c=d(t,["aspectRatio"]);e!==void 0&&c!=null&&h(e,["parameters","aspectRatio"],c);const f=d(t,["guidanceScale"]);e!==void 0&&f!=null&&h(e,["parameters","guidanceScale"],f);const y=d(t,["seed"]);e!==void 0&&y!=null&&h(e,["parameters","seed"],y);const p=d(t,["safetyFilterLevel"]);e!==void 0&&p!=null&&h(e,["parameters","safetySetting"],p);const m=d(t,["personGeneration"]);e!==void 0&&m!=null&&h(e,["parameters","personGeneration"],m);const v=d(t,["includeSafetyAttributes"]);e!==void 0&&v!=null&&h(e,["parameters","includeSafetyAttributes"],v);const _=d(t,["includeRaiReason"]);e!==void 0&&_!=null&&h(e,["parameters","includeRaiReason"],_);const x=d(t,["language"]);e!==void 0&&x!=null&&h(e,["parameters","language"],x);const w=d(t,["outputMimeType"]);e!==void 0&&w!=null&&h(e,["parameters","outputOptions","mimeType"],w);const A=d(t,["outputCompressionQuality"]);e!==void 0&&A!=null&&h(e,["parameters","outputOptions","compressionQuality"],A);const C=d(t,["addWatermark"]);e!==void 0&&C!=null&&h(e,["parameters","addWatermark"],C);const N=d(t,["labels"]);e!==void 0&&N!=null&&h(e,["labels"],N);const I=d(t,["editMode"]);e!==void 0&&I!=null&&h(e,["parameters","editMode"],I);const R=d(t,["baseSteps"]);return e!==void 0&&R!=null&&h(e,["parameters","editConfig","baseSteps"],R),n}function pI(t,e){const n={},a=d(e,["model"]);a!=null&&h(n,["_url","model"],Oe(t,a));const r=d(e,["prompt"]);r!=null&&h(n,["instances[0]","prompt"],r);const l=d(e,["referenceImages"]);if(l!=null){let f=l;Array.isArray(f)&&(f=f.map(y=>dR(y))),h(n,["instances[0]","referenceImages"],f)}const c=d(e,["config"]);return c!=null&&fI(c,n),n}function mI(t){const e={},n=d(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const a=d(t,["predictions"]);if(a!=null){let r=a;Array.isArray(r)&&(r=r.map(l=>lu(l))),h(e,["generatedImages"],r)}return e}function hI(t,e){const n={},a=d(t,["taskType"]);e!==void 0&&a!=null&&h(e,["requests[]","taskType"],a);const r=d(t,["title"]);e!==void 0&&r!=null&&h(e,["requests[]","title"],r);const l=d(t,["outputDimensionality"]);if(e!==void 0&&l!=null&&h(e,["requests[]","outputDimensionality"],l),d(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(d(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function gI(t,e){const n={},a=d(t,["taskType"]);e!==void 0&&a!=null&&h(e,["instances[]","task_type"],a);const r=d(t,["title"]);e!==void 0&&r!=null&&h(e,["instances[]","title"],r);const l=d(t,["outputDimensionality"]);e!==void 0&&l!=null&&h(e,["parameters","outputDimensionality"],l);const c=d(t,["mimeType"]);e!==void 0&&c!=null&&h(e,["instances[]","mimeType"],c);const f=d(t,["autoTruncate"]);return e!==void 0&&f!=null&&h(e,["parameters","autoTruncate"],f),n}function yI(t,e){const n={},a=d(e,["model"]);a!=null&&h(n,["_url","model"],Oe(t,a));const r=d(e,["contents"]);if(r!=null){let f=op(t,r);Array.isArray(f)&&(f=f.map(y=>y)),h(n,["requests[]","content"],f)}const l=d(e,["config"]);l!=null&&hI(l,n);const c=d(e,["model"]);return c!==void 0&&h(n,["requests[]","model"],Oe(t,c)),n}function vI(t,e){const n={},a=d(e,["model"]);a!=null&&h(n,["_url","model"],Oe(t,a));const r=d(e,["contents"]);if(r!=null){let c=op(t,r);Array.isArray(c)&&(c=c.map(f=>f)),h(n,["instances[]","content"],c)}const l=d(e,["config"]);return l!=null&&gI(l,n),n}function SI(t){const e={},n=d(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const a=d(t,["embeddings"]);if(a!=null){let l=a;Array.isArray(l)&&(l=l.map(c=>c)),h(e,["embeddings"],l)}const r=d(t,["metadata"]);return r!=null&&h(e,["metadata"],r),e}function _I(t){const e={},n=d(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const a=d(t,["predictions[]","embeddings"]);if(a!=null){let l=a;Array.isArray(l)&&(l=l.map(c=>ZN(c))),h(e,["embeddings"],l)}const r=d(t,["metadata"]);return r!=null&&h(e,["metadata"],r),e}function TI(t){const e={},n=d(t,["endpoint"]);n!=null&&h(e,["name"],n);const a=d(t,["deployedModelId"]);return a!=null&&h(e,["deployedModelId"],a),e}function bI(t){const e={};if(d(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=d(t,["fileUri"]);n!=null&&h(e,["fileUri"],n);const a=d(t,["mimeType"]);return a!=null&&h(e,["mimeType"],a),e}function xI(t){const e={};if(d(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=d(t,["description"]);n!=null&&h(e,["description"],n);const a=d(t,["name"]);a!=null&&h(e,["name"],a);const r=d(t,["parameters"]);r!=null&&h(e,["parameters"],r);const l=d(t,["parametersJsonSchema"]);l!=null&&h(e,["parametersJsonSchema"],l);const c=d(t,["response"]);c!=null&&h(e,["response"],c);const f=d(t,["responseJsonSchema"]);return f!=null&&h(e,["responseJsonSchema"],f),e}function AI(t,e,n){const a={},r=d(e,["systemInstruction"]);n!==void 0&&r!=null&&h(n,["systemInstruction"],ou(Mt(r)));const l=d(e,["temperature"]);l!=null&&h(a,["temperature"],l);const c=d(e,["topP"]);c!=null&&h(a,["topP"],c);const f=d(e,["topK"]);f!=null&&h(a,["topK"],f);const y=d(e,["candidateCount"]);y!=null&&h(a,["candidateCount"],y);const p=d(e,["maxOutputTokens"]);p!=null&&h(a,["maxOutputTokens"],p);const m=d(e,["stopSequences"]);m!=null&&h(a,["stopSequences"],m);const v=d(e,["responseLogprobs"]);v!=null&&h(a,["responseLogprobs"],v);const _=d(e,["logprobs"]);_!=null&&h(a,["logprobs"],_);const x=d(e,["presencePenalty"]);x!=null&&h(a,["presencePenalty"],x);const w=d(e,["frequencyPenalty"]);w!=null&&h(a,["frequencyPenalty"],w);const A=d(e,["seed"]);A!=null&&h(a,["seed"],A);const C=d(e,["responseMimeType"]);C!=null&&h(a,["responseMimeType"],C);const N=d(e,["responseSchema"]);N!=null&&h(a,["responseSchema"],lp(N));const I=d(e,["responseJsonSchema"]);if(I!=null&&h(a,["responseJsonSchema"],I),d(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(d(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const R=d(e,["safetySettings"]);if(n!==void 0&&R!=null){let L=R;Array.isArray(L)&&(L=L.map(ne=>fR(ne))),h(n,["safetySettings"],L)}const M=d(e,["tools"]);if(n!==void 0&&M!=null){let L=Ii(M);Array.isArray(L)&&(L=L.map(ne=>vR(Ni(ne)))),h(n,["tools"],L)}const z=d(e,["toolConfig"]);if(n!==void 0&&z!=null&&h(n,["toolConfig"],z),d(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const B=d(e,["cachedContent"]);n!==void 0&&B!=null&&h(n,["cachedContent"],ls(t,B));const k=d(e,["responseModalities"]);k!=null&&h(a,["responseModalities"],k);const W=d(e,["mediaResolution"]);W!=null&&h(a,["mediaResolution"],W);const Y=d(e,["speechConfig"]);if(Y!=null&&h(a,["speechConfig"],up(Y)),d(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const Z=d(e,["thinkingConfig"]);Z!=null&&h(a,["thinkingConfig"],Z);const te=d(e,["imageConfig"]);return te!=null&&h(a,["imageConfig"],te),a}function wI(t,e,n){const a={},r=d(e,["systemInstruction"]);n!==void 0&&r!=null&&h(n,["systemInstruction"],Mt(r));const l=d(e,["temperature"]);l!=null&&h(a,["temperature"],l);const c=d(e,["topP"]);c!=null&&h(a,["topP"],c);const f=d(e,["topK"]);f!=null&&h(a,["topK"],f);const y=d(e,["candidateCount"]);y!=null&&h(a,["candidateCount"],y);const p=d(e,["maxOutputTokens"]);p!=null&&h(a,["maxOutputTokens"],p);const m=d(e,["stopSequences"]);m!=null&&h(a,["stopSequences"],m);const v=d(e,["responseLogprobs"]);v!=null&&h(a,["responseLogprobs"],v);const _=d(e,["logprobs"]);_!=null&&h(a,["logprobs"],_);const x=d(e,["presencePenalty"]);x!=null&&h(a,["presencePenalty"],x);const w=d(e,["frequencyPenalty"]);w!=null&&h(a,["frequencyPenalty"],w);const A=d(e,["seed"]);A!=null&&h(a,["seed"],A);const C=d(e,["responseMimeType"]);C!=null&&h(a,["responseMimeType"],C);const N=d(e,["responseSchema"]);N!=null&&h(a,["responseSchema"],lp(N));const I=d(e,["responseJsonSchema"]);I!=null&&h(a,["responseJsonSchema"],I);const R=d(e,["routingConfig"]);R!=null&&h(a,["routingConfig"],R);const M=d(e,["modelSelectionConfig"]);M!=null&&h(a,["modelConfig"],M);const z=d(e,["safetySettings"]);if(n!==void 0&&z!=null){let O=z;Array.isArray(O)&&(O=O.map(K=>K)),h(n,["safetySettings"],O)}const B=d(e,["tools"]);if(n!==void 0&&B!=null){let O=Ii(B);Array.isArray(O)&&(O=O.map(K=>B_(Ni(K)))),h(n,["tools"],O)}const k=d(e,["toolConfig"]);n!==void 0&&k!=null&&h(n,["toolConfig"],k);const W=d(e,["labels"]);n!==void 0&&W!=null&&h(n,["labels"],W);const Y=d(e,["cachedContent"]);n!==void 0&&Y!=null&&h(n,["cachedContent"],ls(t,Y));const Z=d(e,["responseModalities"]);Z!=null&&h(a,["responseModalities"],Z);const te=d(e,["mediaResolution"]);te!=null&&h(a,["mediaResolution"],te);const L=d(e,["speechConfig"]);L!=null&&h(a,["speechConfig"],q_(up(L)));const ne=d(e,["audioTimestamp"]);ne!=null&&h(a,["audioTimestamp"],ne);const fe=d(e,["thinkingConfig"]);fe!=null&&h(a,["thinkingConfig"],fe);const ae=d(e,["imageConfig"]);return ae!=null&&h(a,["imageConfig"],ae),a}function Lv(t,e){const n={},a=d(e,["model"]);a!=null&&h(n,["_url","model"],Oe(t,a));const r=d(e,["contents"]);if(r!=null){let c=gn(r);Array.isArray(c)&&(c=c.map(f=>ou(f))),h(n,["contents"],c)}const l=d(e,["config"]);return l!=null&&h(n,["generationConfig"],AI(t,l,n)),n}function kv(t,e){const n={},a=d(e,["model"]);a!=null&&h(n,["_url","model"],Oe(t,a));const r=d(e,["contents"]);if(r!=null){let c=gn(r);Array.isArray(c)&&(c=c.map(f=>f)),h(n,["contents"],c)}const l=d(e,["config"]);return l!=null&&h(n,["generationConfig"],wI(t,l,n)),n}function Uv(t){const e={},n=d(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const a=d(t,["candidates"]);if(a!=null){let y=a;Array.isArray(y)&&(y=y.map(p=>jN(p))),h(e,["candidates"],y)}const r=d(t,["modelVersion"]);r!=null&&h(e,["modelVersion"],r);const l=d(t,["promptFeedback"]);l!=null&&h(e,["promptFeedback"],l);const c=d(t,["responseId"]);c!=null&&h(e,["responseId"],c);const f=d(t,["usageMetadata"]);return f!=null&&h(e,["usageMetadata"],f),e}function Ov(t){const e={},n=d(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const a=d(t,["candidates"]);if(a!=null){let p=a;Array.isArray(p)&&(p=p.map(m=>m)),h(e,["candidates"],p)}const r=d(t,["createTime"]);r!=null&&h(e,["createTime"],r);const l=d(t,["modelVersion"]);l!=null&&h(e,["modelVersion"],l);const c=d(t,["promptFeedback"]);c!=null&&h(e,["promptFeedback"],c);const f=d(t,["responseId"]);f!=null&&h(e,["responseId"],f);const y=d(t,["usageMetadata"]);return y!=null&&h(e,["usageMetadata"],y),e}function CI(t,e){const n={};if(d(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(d(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const a=d(t,["numberOfImages"]);e!==void 0&&a!=null&&h(e,["parameters","sampleCount"],a);const r=d(t,["aspectRatio"]);e!==void 0&&r!=null&&h(e,["parameters","aspectRatio"],r);const l=d(t,["guidanceScale"]);if(e!==void 0&&l!=null&&h(e,["parameters","guidanceScale"],l),d(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const c=d(t,["safetyFilterLevel"]);e!==void 0&&c!=null&&h(e,["parameters","safetySetting"],c);const f=d(t,["personGeneration"]);e!==void 0&&f!=null&&h(e,["parameters","personGeneration"],f);const y=d(t,["includeSafetyAttributes"]);e!==void 0&&y!=null&&h(e,["parameters","includeSafetyAttributes"],y);const p=d(t,["includeRaiReason"]);e!==void 0&&p!=null&&h(e,["parameters","includeRaiReason"],p);const m=d(t,["language"]);e!==void 0&&m!=null&&h(e,["parameters","language"],m);const v=d(t,["outputMimeType"]);e!==void 0&&v!=null&&h(e,["parameters","outputOptions","mimeType"],v);const _=d(t,["outputCompressionQuality"]);if(e!==void 0&&_!=null&&h(e,["parameters","outputOptions","compressionQuality"],_),d(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(d(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const x=d(t,["imageSize"]);if(e!==void 0&&x!=null&&h(e,["parameters","sampleImageSize"],x),d(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function EI(t,e){const n={},a=d(t,["outputGcsUri"]);e!==void 0&&a!=null&&h(e,["parameters","storageUri"],a);const r=d(t,["negativePrompt"]);e!==void 0&&r!=null&&h(e,["parameters","negativePrompt"],r);const l=d(t,["numberOfImages"]);e!==void 0&&l!=null&&h(e,["parameters","sampleCount"],l);const c=d(t,["aspectRatio"]);e!==void 0&&c!=null&&h(e,["parameters","aspectRatio"],c);const f=d(t,["guidanceScale"]);e!==void 0&&f!=null&&h(e,["parameters","guidanceScale"],f);const y=d(t,["seed"]);e!==void 0&&y!=null&&h(e,["parameters","seed"],y);const p=d(t,["safetyFilterLevel"]);e!==void 0&&p!=null&&h(e,["parameters","safetySetting"],p);const m=d(t,["personGeneration"]);e!==void 0&&m!=null&&h(e,["parameters","personGeneration"],m);const v=d(t,["includeSafetyAttributes"]);e!==void 0&&v!=null&&h(e,["parameters","includeSafetyAttributes"],v);const _=d(t,["includeRaiReason"]);e!==void 0&&_!=null&&h(e,["parameters","includeRaiReason"],_);const x=d(t,["language"]);e!==void 0&&x!=null&&h(e,["parameters","language"],x);const w=d(t,["outputMimeType"]);e!==void 0&&w!=null&&h(e,["parameters","outputOptions","mimeType"],w);const A=d(t,["outputCompressionQuality"]);e!==void 0&&A!=null&&h(e,["parameters","outputOptions","compressionQuality"],A);const C=d(t,["addWatermark"]);e!==void 0&&C!=null&&h(e,["parameters","addWatermark"],C);const N=d(t,["labels"]);e!==void 0&&N!=null&&h(e,["labels"],N);const I=d(t,["imageSize"]);e!==void 0&&I!=null&&h(e,["parameters","sampleImageSize"],I);const R=d(t,["enhancePrompt"]);return e!==void 0&&R!=null&&h(e,["parameters","enhancePrompt"],R),n}function NI(t,e){const n={},a=d(e,["model"]);a!=null&&h(n,["_url","model"],Oe(t,a));const r=d(e,["prompt"]);r!=null&&h(n,["instances[0]","prompt"],r);const l=d(e,["config"]);return l!=null&&CI(l,n),n}function II(t,e){const n={},a=d(e,["model"]);a!=null&&h(n,["_url","model"],Oe(t,a));const r=d(e,["prompt"]);r!=null&&h(n,["instances[0]","prompt"],r);const l=d(e,["config"]);return l!=null&&EI(l,n),n}function RI(t){const e={},n=d(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const a=d(t,["predictions"]);if(a!=null){let l=a;Array.isArray(l)&&(l=l.map(c=>FI(c))),h(e,["generatedImages"],l)}const r=d(t,["positivePromptSafetyAttributes"]);return r!=null&&h(e,["positivePromptSafetyAttributes"],U_(r)),e}function MI(t){const e={},n=d(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const a=d(t,["predictions"]);if(a!=null){let l=a;Array.isArray(l)&&(l=l.map(c=>lu(c))),h(e,["generatedImages"],l)}const r=d(t,["positivePromptSafetyAttributes"]);return r!=null&&h(e,["positivePromptSafetyAttributes"],O_(r)),e}function DI(t,e){const n={},a=d(t,["numberOfVideos"]);if(e!==void 0&&a!=null&&h(e,["parameters","sampleCount"],a),d(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(d(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const r=d(t,["durationSeconds"]);if(e!==void 0&&r!=null&&h(e,["parameters","durationSeconds"],r),d(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const l=d(t,["aspectRatio"]);e!==void 0&&l!=null&&h(e,["parameters","aspectRatio"],l);const c=d(t,["resolution"]);e!==void 0&&c!=null&&h(e,["parameters","resolution"],c);const f=d(t,["personGeneration"]);if(e!==void 0&&f!=null&&h(e,["parameters","personGeneration"],f),d(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const y=d(t,["negativePrompt"]);e!==void 0&&y!=null&&h(e,["parameters","negativePrompt"],y);const p=d(t,["enhancePrompt"]);if(e!==void 0&&p!=null&&h(e,["parameters","enhancePrompt"],p),d(t,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const m=d(t,["lastFrame"]);e!==void 0&&m!=null&&h(e,["instances[0]","lastFrame"],uu(m));const v=d(t,["referenceImages"]);if(e!==void 0&&v!=null){let _=v;Array.isArray(_)&&(_=_.map(x=>MR(x))),h(e,["instances[0]","referenceImages"],_)}if(d(t,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(d(t,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return n}function PI(t,e){const n={},a=d(t,["numberOfVideos"]);e!==void 0&&a!=null&&h(e,["parameters","sampleCount"],a);const r=d(t,["outputGcsUri"]);e!==void 0&&r!=null&&h(e,["parameters","storageUri"],r);const l=d(t,["fps"]);e!==void 0&&l!=null&&h(e,["parameters","fps"],l);const c=d(t,["durationSeconds"]);e!==void 0&&c!=null&&h(e,["parameters","durationSeconds"],c);const f=d(t,["seed"]);e!==void 0&&f!=null&&h(e,["parameters","seed"],f);const y=d(t,["aspectRatio"]);e!==void 0&&y!=null&&h(e,["parameters","aspectRatio"],y);const p=d(t,["resolution"]);e!==void 0&&p!=null&&h(e,["parameters","resolution"],p);const m=d(t,["personGeneration"]);e!==void 0&&m!=null&&h(e,["parameters","personGeneration"],m);const v=d(t,["pubsubTopic"]);e!==void 0&&v!=null&&h(e,["parameters","pubsubTopic"],v);const _=d(t,["negativePrompt"]);e!==void 0&&_!=null&&h(e,["parameters","negativePrompt"],_);const x=d(t,["enhancePrompt"]);e!==void 0&&x!=null&&h(e,["parameters","enhancePrompt"],x);const w=d(t,["generateAudio"]);e!==void 0&&w!=null&&h(e,["parameters","generateAudio"],w);const A=d(t,["lastFrame"]);e!==void 0&&A!=null&&h(e,["instances[0]","lastFrame"],An(A));const C=d(t,["referenceImages"]);if(e!==void 0&&C!=null){let R=C;Array.isArray(R)&&(R=R.map(M=>DR(M))),h(e,["instances[0]","referenceImages"],R)}const N=d(t,["mask"]);e!==void 0&&N!=null&&h(e,["instances[0]","mask"],RR(N));const I=d(t,["compressionQuality"]);return e!==void 0&&I!=null&&h(e,["parameters","compressionQuality"],I),n}function LI(t){const e={},n=d(t,["name"]);n!=null&&h(e,["name"],n);const a=d(t,["metadata"]);a!=null&&h(e,["metadata"],a);const r=d(t,["done"]);r!=null&&h(e,["done"],r);const l=d(t,["error"]);l!=null&&h(e,["error"],l);const c=d(t,["response","generateVideoResponse"]);return c!=null&&h(e,["response"],qI(c)),e}function kI(t){const e={},n=d(t,["name"]);n!=null&&h(e,["name"],n);const a=d(t,["metadata"]);a!=null&&h(e,["metadata"],a);const r=d(t,["done"]);r!=null&&h(e,["done"],r);const l=d(t,["error"]);l!=null&&h(e,["error"],l);const c=d(t,["response"]);return c!=null&&h(e,["response"],BI(c)),e}function UI(t,e){const n={},a=d(e,["model"]);a!=null&&h(n,["_url","model"],Oe(t,a));const r=d(e,["prompt"]);r!=null&&h(n,["instances[0]","prompt"],r);const l=d(e,["image"]);l!=null&&h(n,["instances[0]","image"],uu(l));const c=d(e,["video"]);c!=null&&h(n,["instances[0]","video"],H_(c));const f=d(e,["source"]);f!=null&&HI(f,n);const y=d(e,["config"]);return y!=null&&DI(y,n),n}function OI(t,e){const n={},a=d(e,["model"]);a!=null&&h(n,["_url","model"],Oe(t,a));const r=d(e,["prompt"]);r!=null&&h(n,["instances[0]","prompt"],r);const l=d(e,["image"]);l!=null&&h(n,["instances[0]","image"],An(l));const c=d(e,["video"]);c!=null&&h(n,["instances[0]","video"],V_(c));const f=d(e,["source"]);f!=null&&VI(f,n);const y=d(e,["config"]);return y!=null&&PI(y,n),n}function qI(t){const e={},n=d(t,["generatedSamples"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(c=>zI(c))),h(e,["generatedVideos"],l)}const a=d(t,["raiMediaFilteredCount"]);a!=null&&h(e,["raiMediaFilteredCount"],a);const r=d(t,["raiMediaFilteredReasons"]);return r!=null&&h(e,["raiMediaFilteredReasons"],r),e}function BI(t){const e={},n=d(t,["videos"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(c=>$I(c))),h(e,["generatedVideos"],l)}const a=d(t,["raiMediaFilteredCount"]);a!=null&&h(e,["raiMediaFilteredCount"],a);const r=d(t,["raiMediaFilteredReasons"]);return r!=null&&h(e,["raiMediaFilteredReasons"],r),e}function HI(t,e){const n={},a=d(t,["prompt"]);e!==void 0&&a!=null&&h(e,["instances[0]","prompt"],a);const r=d(t,["image"]);e!==void 0&&r!=null&&h(e,["instances[0]","image"],uu(r));const l=d(t,["video"]);return e!==void 0&&l!=null&&h(e,["instances[0]","video"],H_(l)),n}function VI(t,e){const n={},a=d(t,["prompt"]);e!==void 0&&a!=null&&h(e,["instances[0]","prompt"],a);const r=d(t,["image"]);e!==void 0&&r!=null&&h(e,["instances[0]","image"],An(r));const l=d(t,["video"]);return e!==void 0&&l!=null&&h(e,["instances[0]","video"],V_(l)),n}function FI(t){const e={},n=d(t,["_self"]);n!=null&&h(e,["image"],QI(n));const a=d(t,["raiFilteredReason"]);a!=null&&h(e,["raiFilteredReason"],a);const r=d(t,["_self"]);return r!=null&&h(e,["safetyAttributes"],U_(r)),e}function lu(t){const e={},n=d(t,["_self"]);n!=null&&h(e,["image"],k_(n));const a=d(t,["raiFilteredReason"]);a!=null&&h(e,["raiFilteredReason"],a);const r=d(t,["_self"]);r!=null&&h(e,["safetyAttributes"],O_(r));const l=d(t,["prompt"]);return l!=null&&h(e,["enhancedPrompt"],l),e}function GI(t){const e={},n=d(t,["_self"]);n!=null&&h(e,["mask"],k_(n));const a=d(t,["labels"]);if(a!=null){let r=a;Array.isArray(r)&&(r=r.map(l=>l)),h(e,["labels"],r)}return e}function zI(t){const e={},n=d(t,["video"]);return n!=null&&h(e,["video"],NR(n)),e}function $I(t){const e={},n=d(t,["_self"]);return n!=null&&h(e,["video"],IR(n)),e}function YI(t){const e={},n=d(t,["modelSelectionConfig"]);n!=null&&h(e,["modelConfig"],n);const a=d(t,["responseJsonSchema"]);a!=null&&h(e,["responseJsonSchema"],a);const r=d(t,["audioTimestamp"]);r!=null&&h(e,["audioTimestamp"],r);const l=d(t,["candidateCount"]);l!=null&&h(e,["candidateCount"],l);const c=d(t,["enableAffectiveDialog"]);c!=null&&h(e,["enableAffectiveDialog"],c);const f=d(t,["frequencyPenalty"]);f!=null&&h(e,["frequencyPenalty"],f);const y=d(t,["logprobs"]);y!=null&&h(e,["logprobs"],y);const p=d(t,["maxOutputTokens"]);p!=null&&h(e,["maxOutputTokens"],p);const m=d(t,["mediaResolution"]);m!=null&&h(e,["mediaResolution"],m);const v=d(t,["presencePenalty"]);v!=null&&h(e,["presencePenalty"],v);const _=d(t,["responseLogprobs"]);_!=null&&h(e,["responseLogprobs"],_);const x=d(t,["responseMimeType"]);x!=null&&h(e,["responseMimeType"],x);const w=d(t,["responseModalities"]);w!=null&&h(e,["responseModalities"],w);const A=d(t,["responseSchema"]);A!=null&&h(e,["responseSchema"],A);const C=d(t,["routingConfig"]);C!=null&&h(e,["routingConfig"],C);const N=d(t,["seed"]);N!=null&&h(e,["seed"],N);const I=d(t,["speechConfig"]);I!=null&&h(e,["speechConfig"],q_(I));const R=d(t,["stopSequences"]);R!=null&&h(e,["stopSequences"],R);const M=d(t,["temperature"]);M!=null&&h(e,["temperature"],M);const z=d(t,["thinkingConfig"]);z!=null&&h(e,["thinkingConfig"],z);const B=d(t,["topK"]);B!=null&&h(e,["topK"],B);const k=d(t,["topP"]);if(k!=null&&h(e,["topP"],k),d(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function JI(t,e){const n={},a=d(e,["model"]);return a!=null&&h(n,["_url","name"],Oe(t,a)),n}function KI(t,e){const n={},a=d(e,["model"]);return a!=null&&h(n,["_url","name"],Oe(t,a)),n}function jI(t){const e={};if(d(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=d(t,["enableWidget"]);return n!=null&&h(e,["enableWidget"],n),e}function XI(t){const e={};if(d(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(d(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=d(t,["timeRangeFilter"]);return n!=null&&h(e,["timeRangeFilter"],n),e}function QI(t){const e={},n=d(t,["bytesBase64Encoded"]);n!=null&&h(e,["imageBytes"],Fs(n));const a=d(t,["mimeType"]);return a!=null&&h(e,["mimeType"],a),e}function k_(t){const e={},n=d(t,["gcsUri"]);n!=null&&h(e,["gcsUri"],n);const a=d(t,["bytesBase64Encoded"]);a!=null&&h(e,["imageBytes"],Fs(a));const r=d(t,["mimeType"]);return r!=null&&h(e,["mimeType"],r),e}function uu(t){const e={};if(d(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=d(t,["imageBytes"]);n!=null&&h(e,["bytesBase64Encoded"],Fs(n));const a=d(t,["mimeType"]);return a!=null&&h(e,["mimeType"],a),e}function An(t){const e={},n=d(t,["gcsUri"]);n!=null&&h(e,["gcsUri"],n);const a=d(t,["imageBytes"]);a!=null&&h(e,["bytesBase64Encoded"],Fs(a));const r=d(t,["mimeType"]);return r!=null&&h(e,["mimeType"],r),e}function WI(t,e,n){const a={},r=d(e,["pageSize"]);n!==void 0&&r!=null&&h(n,["_query","pageSize"],r);const l=d(e,["pageToken"]);n!==void 0&&l!=null&&h(n,["_query","pageToken"],l);const c=d(e,["filter"]);n!==void 0&&c!=null&&h(n,["_query","filter"],c);const f=d(e,["queryBase"]);return n!==void 0&&f!=null&&h(n,["_url","models_url"],E_(t,f)),a}function ZI(t,e,n){const a={},r=d(e,["pageSize"]);n!==void 0&&r!=null&&h(n,["_query","pageSize"],r);const l=d(e,["pageToken"]);n!==void 0&&l!=null&&h(n,["_query","pageToken"],l);const c=d(e,["filter"]);n!==void 0&&c!=null&&h(n,["_query","filter"],c);const f=d(e,["queryBase"]);return n!==void 0&&f!=null&&h(n,["_url","models_url"],E_(t,f)),a}function eR(t,e){const n={},a=d(e,["config"]);return a!=null&&WI(t,a,n),n}function tR(t,e){const n={},a=d(e,["config"]);return a!=null&&ZI(t,a,n),n}function nR(t){const e={},n=d(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const a=d(t,["nextPageToken"]);a!=null&&h(e,["nextPageToken"],a);const r=d(t,["_self"]);if(r!=null){let l=N_(r);Array.isArray(l)&&(l=l.map(c=>Af(c))),h(e,["models"],l)}return e}function sR(t){const e={},n=d(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const a=d(t,["nextPageToken"]);a!=null&&h(e,["nextPageToken"],a);const r=d(t,["_self"]);if(r!=null){let l=N_(r);Array.isArray(l)&&(l=l.map(c=>wf(c))),h(e,["models"],l)}return e}function aR(t){const e={},n=d(t,["maskMode"]);n!=null&&h(e,["maskMode"],n);const a=d(t,["segmentationClasses"]);a!=null&&h(e,["maskClasses"],a);const r=d(t,["maskDilation"]);return r!=null&&h(e,["dilation"],r),e}function Af(t){const e={},n=d(t,["name"]);n!=null&&h(e,["name"],n);const a=d(t,["displayName"]);a!=null&&h(e,["displayName"],a);const r=d(t,["description"]);r!=null&&h(e,["description"],r);const l=d(t,["version"]);l!=null&&h(e,["version"],l);const c=d(t,["_self"]);c!=null&&h(e,["tunedModelInfo"],SR(c));const f=d(t,["inputTokenLimit"]);f!=null&&h(e,["inputTokenLimit"],f);const y=d(t,["outputTokenLimit"]);y!=null&&h(e,["outputTokenLimit"],y);const p=d(t,["supportedGenerationMethods"]);return p!=null&&h(e,["supportedActions"],p),e}function wf(t){const e={},n=d(t,["name"]);n!=null&&h(e,["name"],n);const a=d(t,["displayName"]);a!=null&&h(e,["displayName"],a);const r=d(t,["description"]);r!=null&&h(e,["description"],r);const l=d(t,["versionId"]);l!=null&&h(e,["version"],l);const c=d(t,["deployedModels"]);if(c!=null){let v=c;Array.isArray(v)&&(v=v.map(_=>TI(_))),h(e,["endpoints"],v)}const f=d(t,["labels"]);f!=null&&h(e,["labels"],f);const y=d(t,["_self"]);y!=null&&h(e,["tunedModelInfo"],_R(y));const p=d(t,["defaultCheckpointId"]);p!=null&&h(e,["defaultCheckpointId"],p);const m=d(t,["checkpoints"]);if(m!=null){let v=m;Array.isArray(v)&&(v=v.map(_=>_)),h(e,["checkpoints"],v)}return e}function iR(t){const e={},n=d(t,["functionCall"]);n!=null&&h(e,["functionCall"],n);const a=d(t,["codeExecutionResult"]);a!=null&&h(e,["codeExecutionResult"],a);const r=d(t,["executableCode"]);r!=null&&h(e,["executableCode"],r);const l=d(t,["fileData"]);l!=null&&h(e,["fileData"],bI(l));const c=d(t,["functionResponse"]);c!=null&&h(e,["functionResponse"],c);const f=d(t,["inlineData"]);f!=null&&h(e,["inlineData"],KN(f));const y=d(t,["text"]);y!=null&&h(e,["text"],y);const p=d(t,["thought"]);p!=null&&h(e,["thought"],p);const m=d(t,["thoughtSignature"]);m!=null&&h(e,["thoughtSignature"],m);const v=d(t,["videoMetadata"]);return v!=null&&h(e,["videoMetadata"],v),e}function rR(t){const e={},n=d(t,["productImage"]);return n!=null&&h(e,["image"],An(n)),e}function oR(t,e){const n={},a=d(t,["numberOfImages"]);e!==void 0&&a!=null&&h(e,["parameters","sampleCount"],a);const r=d(t,["baseSteps"]);e!==void 0&&r!=null&&h(e,["parameters","editConfig","baseSteps"],r);const l=d(t,["outputGcsUri"]);e!==void 0&&l!=null&&h(e,["parameters","storageUri"],l);const c=d(t,["seed"]);e!==void 0&&c!=null&&h(e,["parameters","seed"],c);const f=d(t,["safetyFilterLevel"]);e!==void 0&&f!=null&&h(e,["parameters","safetySetting"],f);const y=d(t,["personGeneration"]);e!==void 0&&y!=null&&h(e,["parameters","personGeneration"],y);const p=d(t,["addWatermark"]);e!==void 0&&p!=null&&h(e,["parameters","addWatermark"],p);const m=d(t,["outputMimeType"]);e!==void 0&&m!=null&&h(e,["parameters","outputOptions","mimeType"],m);const v=d(t,["outputCompressionQuality"]);e!==void 0&&v!=null&&h(e,["parameters","outputOptions","compressionQuality"],v);const _=d(t,["enhancePrompt"]);e!==void 0&&_!=null&&h(e,["parameters","enhancePrompt"],_);const x=d(t,["labels"]);return e!==void 0&&x!=null&&h(e,["labels"],x),n}function lR(t,e){const n={},a=d(e,["model"]);a!=null&&h(n,["_url","model"],Oe(t,a));const r=d(e,["source"]);r!=null&&cR(r,n);const l=d(e,["config"]);return l!=null&&oR(l,n),n}function uR(t){const e={},n=d(t,["predictions"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(r=>lu(r))),h(e,["generatedImages"],a)}return e}function cR(t,e){const n={},a=d(t,["prompt"]);e!==void 0&&a!=null&&h(e,["instances[0]","prompt"],a);const r=d(t,["personImage"]);e!==void 0&&r!=null&&h(e,["instances[0]","personImage","image"],An(r));const l=d(t,["productImages"]);if(e!==void 0&&l!=null){let c=l;Array.isArray(c)&&(c=c.map(f=>rR(f))),h(e,["instances[0]","productImages"],c)}return n}function dR(t){const e={},n=d(t,["referenceImage"]);n!=null&&h(e,["referenceImage"],An(n));const a=d(t,["referenceId"]);a!=null&&h(e,["referenceId"],a);const r=d(t,["referenceType"]);r!=null&&h(e,["referenceType"],r);const l=d(t,["maskImageConfig"]);l!=null&&h(e,["maskImageConfig"],aR(l));const c=d(t,["controlImageConfig"]);c!=null&&h(e,["controlImageConfig"],tI(c));const f=d(t,["styleImageConfig"]);f!=null&&h(e,["styleImageConfig"],f);const y=d(t,["subjectImageConfig"]);return y!=null&&h(e,["subjectImageConfig"],y),e}function U_(t){const e={},n=d(t,["safetyAttributes","categories"]);n!=null&&h(e,["categories"],n);const a=d(t,["safetyAttributes","scores"]);a!=null&&h(e,["scores"],a);const r=d(t,["contentType"]);return r!=null&&h(e,["contentType"],r),e}function O_(t){const e={},n=d(t,["safetyAttributes","categories"]);n!=null&&h(e,["categories"],n);const a=d(t,["safetyAttributes","scores"]);a!=null&&h(e,["scores"],a);const r=d(t,["contentType"]);return r!=null&&h(e,["contentType"],r),e}function fR(t){const e={},n=d(t,["category"]);if(n!=null&&h(e,["category"],n),d(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const a=d(t,["threshold"]);return a!=null&&h(e,["threshold"],a),e}function pR(t){const e={},n=d(t,["image"]);return n!=null&&h(e,["image"],An(n)),e}function mR(t,e){const n={},a=d(t,["mode"]);e!==void 0&&a!=null&&h(e,["parameters","mode"],a);const r=d(t,["maxPredictions"]);e!==void 0&&r!=null&&h(e,["parameters","maxPredictions"],r);const l=d(t,["confidenceThreshold"]);e!==void 0&&l!=null&&h(e,["parameters","confidenceThreshold"],l);const c=d(t,["maskDilation"]);e!==void 0&&c!=null&&h(e,["parameters","maskDilation"],c);const f=d(t,["binaryColorThreshold"]);e!==void 0&&f!=null&&h(e,["parameters","binaryColorThreshold"],f);const y=d(t,["labels"]);return e!==void 0&&y!=null&&h(e,["labels"],y),n}function hR(t,e){const n={},a=d(e,["model"]);a!=null&&h(n,["_url","model"],Oe(t,a));const r=d(e,["source"]);r!=null&&yR(r,n);const l=d(e,["config"]);return l!=null&&mR(l,n),n}function gR(t){const e={},n=d(t,["predictions"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(r=>GI(r))),h(e,["generatedMasks"],a)}return e}function yR(t,e){const n={},a=d(t,["prompt"]);e!==void 0&&a!=null&&h(e,["instances[0]","prompt"],a);const r=d(t,["image"]);e!==void 0&&r!=null&&h(e,["instances[0]","image"],An(r));const l=d(t,["scribbleImage"]);return e!==void 0&&l!=null&&h(e,["instances[0]","scribble"],pR(l)),n}function q_(t){const e={},n=d(t,["languageCode"]);n!=null&&h(e,["languageCode"],n);const a=d(t,["voiceConfig"]);if(a!=null&&h(e,["voiceConfig"],a),d(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function vR(t){const e={},n=d(t,["functionDeclarations"]);if(n!=null){let m=n;Array.isArray(m)&&(m=m.map(v=>v)),h(e,["functionDeclarations"],m)}if(d(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const a=d(t,["googleSearchRetrieval"]);a!=null&&h(e,["googleSearchRetrieval"],a);const r=d(t,["computerUse"]);r!=null&&h(e,["computerUse"],r);const l=d(t,["fileSearch"]);l!=null&&h(e,["fileSearch"],l);const c=d(t,["codeExecution"]);if(c!=null&&h(e,["codeExecution"],c),d(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const f=d(t,["googleMaps"]);f!=null&&h(e,["googleMaps"],jI(f));const y=d(t,["googleSearch"]);y!=null&&h(e,["googleSearch"],XI(y));const p=d(t,["urlContext"]);return p!=null&&h(e,["urlContext"],p),e}function B_(t){const e={},n=d(t,["functionDeclarations"]);if(n!=null){let v=n;Array.isArray(v)&&(v=v.map(_=>xI(_))),h(e,["functionDeclarations"],v)}const a=d(t,["retrieval"]);a!=null&&h(e,["retrieval"],a);const r=d(t,["googleSearchRetrieval"]);r!=null&&h(e,["googleSearchRetrieval"],r);const l=d(t,["computerUse"]);if(l!=null&&h(e,["computerUse"],l),d(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const c=d(t,["codeExecution"]);c!=null&&h(e,["codeExecution"],c);const f=d(t,["enterpriseWebSearch"]);f!=null&&h(e,["enterpriseWebSearch"],f);const y=d(t,["googleMaps"]);y!=null&&h(e,["googleMaps"],y);const p=d(t,["googleSearch"]);p!=null&&h(e,["googleSearch"],p);const m=d(t,["urlContext"]);return m!=null&&h(e,["urlContext"],m),e}function SR(t){const e={},n=d(t,["baseModel"]);n!=null&&h(e,["baseModel"],n);const a=d(t,["createTime"]);a!=null&&h(e,["createTime"],a);const r=d(t,["updateTime"]);return r!=null&&h(e,["updateTime"],r),e}function _R(t){const e={},n=d(t,["labels","google-vertex-llm-tuning-base-model-id"]);n!=null&&h(e,["baseModel"],n);const a=d(t,["createTime"]);a!=null&&h(e,["createTime"],a);const r=d(t,["updateTime"]);return r!=null&&h(e,["updateTime"],r),e}function TR(t,e){const n={},a=d(t,["displayName"]);e!==void 0&&a!=null&&h(e,["displayName"],a);const r=d(t,["description"]);e!==void 0&&r!=null&&h(e,["description"],r);const l=d(t,["defaultCheckpointId"]);return e!==void 0&&l!=null&&h(e,["defaultCheckpointId"],l),n}function bR(t,e){const n={},a=d(t,["displayName"]);e!==void 0&&a!=null&&h(e,["displayName"],a);const r=d(t,["description"]);e!==void 0&&r!=null&&h(e,["description"],r);const l=d(t,["defaultCheckpointId"]);return e!==void 0&&l!=null&&h(e,["defaultCheckpointId"],l),n}function xR(t,e){const n={},a=d(e,["model"]);a!=null&&h(n,["_url","name"],Oe(t,a));const r=d(e,["config"]);return r!=null&&TR(r,n),n}function AR(t,e){const n={},a=d(e,["model"]);a!=null&&h(n,["_url","model"],Oe(t,a));const r=d(e,["config"]);return r!=null&&bR(r,n),n}function wR(t,e){const n={},a=d(t,["outputGcsUri"]);e!==void 0&&a!=null&&h(e,["parameters","storageUri"],a);const r=d(t,["safetyFilterLevel"]);e!==void 0&&r!=null&&h(e,["parameters","safetySetting"],r);const l=d(t,["personGeneration"]);e!==void 0&&l!=null&&h(e,["parameters","personGeneration"],l);const c=d(t,["includeRaiReason"]);e!==void 0&&c!=null&&h(e,["parameters","includeRaiReason"],c);const f=d(t,["outputMimeType"]);e!==void 0&&f!=null&&h(e,["parameters","outputOptions","mimeType"],f);const y=d(t,["outputCompressionQuality"]);e!==void 0&&y!=null&&h(e,["parameters","outputOptions","compressionQuality"],y);const p=d(t,["enhanceInputImage"]);e!==void 0&&p!=null&&h(e,["parameters","upscaleConfig","enhanceInputImage"],p);const m=d(t,["imagePreservationFactor"]);e!==void 0&&m!=null&&h(e,["parameters","upscaleConfig","imagePreservationFactor"],m);const v=d(t,["labels"]);e!==void 0&&v!=null&&h(e,["labels"],v);const _=d(t,["numberOfImages"]);e!==void 0&&_!=null&&h(e,["parameters","sampleCount"],_);const x=d(t,["mode"]);return e!==void 0&&x!=null&&h(e,["parameters","mode"],x),n}function CR(t,e){const n={},a=d(e,["model"]);a!=null&&h(n,["_url","model"],Oe(t,a));const r=d(e,["image"]);r!=null&&h(n,["instances[0]","image"],An(r));const l=d(e,["upscaleFactor"]);l!=null&&h(n,["parameters","upscaleConfig","upscaleFactor"],l);const c=d(e,["config"]);return c!=null&&wR(c,n),n}function ER(t){const e={},n=d(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const a=d(t,["predictions"]);if(a!=null){let r=a;Array.isArray(r)&&(r=r.map(l=>lu(l))),h(e,["generatedImages"],r)}return e}function NR(t){const e={},n=d(t,["uri"]);n!=null&&h(e,["uri"],n);const a=d(t,["encodedVideo"]);a!=null&&h(e,["videoBytes"],Fs(a));const r=d(t,["encoding"]);return r!=null&&h(e,["mimeType"],r),e}function IR(t){const e={},n=d(t,["gcsUri"]);n!=null&&h(e,["uri"],n);const a=d(t,["bytesBase64Encoded"]);a!=null&&h(e,["videoBytes"],Fs(a));const r=d(t,["mimeType"]);return r!=null&&h(e,["mimeType"],r),e}function RR(t){const e={},n=d(t,["image"]);n!=null&&h(e,["_self"],An(n));const a=d(t,["maskMode"]);return a!=null&&h(e,["maskMode"],a),e}function MR(t){const e={},n=d(t,["image"]);n!=null&&h(e,["image"],uu(n));const a=d(t,["referenceType"]);return a!=null&&h(e,["referenceType"],a),e}function DR(t){const e={},n=d(t,["image"]);n!=null&&h(e,["image"],An(n));const a=d(t,["referenceType"]);return a!=null&&h(e,["referenceType"],a),e}function H_(t){const e={},n=d(t,["uri"]);n!=null&&h(e,["uri"],n);const a=d(t,["videoBytes"]);a!=null&&h(e,["encodedVideo"],Fs(a));const r=d(t,["mimeType"]);return r!=null&&h(e,["encoding"],r),e}function V_(t){const e={},n=d(t,["uri"]);n!=null&&h(e,["gcsUri"],n);const a=d(t,["videoBytes"]);a!=null&&h(e,["bytesBase64Encoded"],Fs(a));const r=d(t,["mimeType"]);return r!=null&&h(e,["mimeType"],r),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const PR="Content-Type",LR="X-Server-Timeout",kR="User-Agent",Cf="x-goog-api-client",UR="1.29.0",OR=`google-genai-sdk/${UR}`,qR="v1beta1",BR="v1beta",qv=/^\s*data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class HR{constructor(e){var n,a;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const r={};this.clientOptions.vertexai?(r.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:qR,r.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(r.apiVersion=(a=this.clientOptions.apiVersion)!==null&&a!==void 0?a:BR,r.baseUrl="https://generativelanguage.googleapis.com/"),r.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=r,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(r,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const a=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&a.push(e.apiVersion),a.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),n=new URL(e);return n.protocol=n.protocol=="http:"?"ws":"wss",n.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,n,a){const r=[this.getRequestUrlInternal(n)];return a&&r.push(this.getBaseResourcePath()),e!==""&&r.push(e),new URL(`${r.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const a=this.shouldPrependVertexProjectPath(e),r=this.constructUrl(e.path,n,a);if(e.queryParams)for(const[c,f]of Object.entries(e.queryParams))r.searchParams.append(c,String(f));let l={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else l.body=e.body;return l=await this.includeExtraHttpOptionsToRequestInit(l,n,r.toString(),e.abortSignal),this.unaryApiCall(r,l,e.httpMethod)}patchHttpOptions(e,n){const a=JSON.parse(JSON.stringify(e));for(const[r,l]of Object.entries(n))typeof l=="object"?a[r]=Object.assign(Object.assign({},a[r]),l):l!==void 0&&(a[r]=l);return a}async requestStream(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const a=this.shouldPrependVertexProjectPath(e),r=this.constructUrl(e.path,n,a);(!r.searchParams.has("alt")||r.searchParams.get("alt")!=="sse")&&r.searchParams.set("alt","sse");let l={};return l.body=e.body,l=await this.includeExtraHttpOptionsToRequestInit(l,n,r.toString(),e.abortSignal),this.streamApiCall(r,l,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,n,a,r){if(n&&n.timeout||r){const l=new AbortController,c=l.signal;if(n.timeout&&(n==null?void 0:n.timeout)>0){const f=setTimeout(()=>l.abort(),n.timeout);f&&typeof f.unref=="function"&&f.unref()}r&&r.addEventListener("abort",()=>{l.abort()}),e.signal=c}return n&&n.extraBody!==null&&VR(e,n.extraBody),e.headers=await this.getHeadersInternal(n,a),e}async unaryApiCall(e,n,a){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:a})).then(async r=>(await Bv(r),new Tf(r))).catch(r=>{throw r instanceof Error?r:new Error(JSON.stringify(r))})}async streamApiCall(e,n,a){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:a})).then(async r=>(await Bv(r),this.processStreamResponse(r))).catch(r=>{throw r instanceof Error?r:new Error(JSON.stringify(r))})}processStreamResponse(e){var n;return bi(this,arguments,function*(){const r=(n=e==null?void 0:e.body)===null||n===void 0?void 0:n.getReader(),l=new TextDecoder("utf-8");if(!r)throw new Error("Response body is empty");try{let c="";for(;;){const{done:f,value:y}=yield Qe(r.read());if(f){if(c.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const p=l.decode(y,{stream:!0});try{const v=JSON.parse(p);if("error"in v){const _=JSON.parse(JSON.stringify(v.error)),x=_.status,w=_.code,A=`got status: ${x}. ${JSON.stringify(v)}`;if(w>=400&&w<600)throw new ru({message:A,status:w})}}catch(v){if(v.name==="ApiError")throw v}c+=p;let m=c.match(qv);for(;m;){const v=m[1];try{const _=new Response(v,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield Qe(new Tf(_)),c=c.slice(m[0].length),m=c.match(qv)}catch(_){throw new Error(`exception parsing stream chunk ${v}. ${_}`)}}}}finally{r.releaseLock()}})}async apiCall(e,n){return fetch(e,n).catch(a=>{throw new Error(`exception ${a} sending request`)})}getDefaultHeaders(){const e={},n=OR+" "+this.clientOptions.userAgentExtra;return e[kR]=n,e[Cf]=n,e[PR]="application/json",e}async getHeadersInternal(e,n){const a=new Headers;if(e&&e.headers){for(const[r,l]of Object.entries(e.headers))a.append(r,l);e.timeout&&e.timeout>0&&a.append(LR,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(a,n),a}getFileName(e){var n;let a="";return typeof e=="string"&&(a=e.replace(/[/\\]+$/,""),a=(n=a.split(/[/\\]/).pop())!==null&&n!==void 0?n:""),a}async uploadFile(e,n){var a;const r={};n!=null&&(r.mimeType=n.mimeType,r.name=n.name,r.displayName=n.displayName),r.name&&!r.name.startsWith("files/")&&(r.name=`files/${r.name}`);const l=this.clientOptions.uploader,c=await l.stat(e);r.sizeBytes=String(c.size);const f=(a=n==null?void 0:n.mimeType)!==null&&a!==void 0?a:c.type;if(f===void 0||f==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");r.mimeType=f;const y={file:r},p=this.getFileName(e),m=ie("upload/v1beta/files",y._url),v=await this.fetchUploadUrl(m,r.sizeBytes,r.mimeType,p,y,n==null?void 0:n.httpOptions);return l.upload(e,v,this)}async uploadFileToFileSearchStore(e,n,a){var r;const l=this.clientOptions.uploader,c=await l.stat(n),f=String(c.size),y=(r=a==null?void 0:a.mimeType)!==null&&r!==void 0?r:c.type;if(y===void 0||y==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const p=`upload/v1beta/${e}:uploadToFileSearchStore`,m=this.getFileName(n),v={};a!=null&&a.customMetadata&&(v.customMetadata=a.customMetadata),a!=null&&a.chunkingConfig&&(v.chunkingConfig=a.chunkingConfig);const _=await this.fetchUploadUrl(p,f,y,m,v,a==null?void 0:a.httpOptions);return l.uploadToFileSearchStore(n,_,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,n,a,r,l,c){var f;let y={};c?y=c:y={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${n}`,"X-Goog-Upload-Header-Content-Type":`${a}`},r?{"X-Goog-Upload-File-Name":r}:{})};const p=await this.request({path:e,body:JSON.stringify(l),httpMethod:"POST",httpOptions:y});if(!p||!(p!=null&&p.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const m=(f=p==null?void 0:p.headers)===null||f===void 0?void 0:f["x-goog-upload-url"];if(m===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return m}}async function Bv(t){var e;if(t===void 0)throw new Error("response is undefined");if(!t.ok){const n=t.status;let a;!((e=t.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?a=await t.json():a={error:{message:await t.text(),code:t.status,status:t.statusText}};const r=JSON.stringify(a);throw n>=400&&n<600?new ru({message:r,status:n}):new Error(r)}}function VR(t,e){if(!e||Object.keys(e).length===0)return;if(t.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let n={};if(typeof t.body=="string"&&t.body.length>0)try{const l=JSON.parse(t.body);if(typeof l=="object"&&l!==null&&!Array.isArray(l))n=l;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function a(l,c){const f=Object.assign({},l);for(const y in c)if(Object.prototype.hasOwnProperty.call(c,y)){const p=c[y],m=f[y];p&&typeof p=="object"&&!Array.isArray(p)&&m&&typeof m=="object"&&!Array.isArray(m)?f[y]=a(m,p):(m&&p&&typeof m!=typeof p&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${y}". Original type: ${typeof m}, New type: ${typeof p}. Overwriting.`),f[y]=p)}return f}const r=a(n,e);t.body=JSON.stringify(r)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const FR="mcp_used/unknown";let GR=!1;function F_(t){for(const e of t)if(zR(e)||typeof e=="object"&&"inputSchema"in e)return!0;return GR}function G_(t){var e;const n=(e=t[Cf])!==null&&e!==void 0?e:"";t[Cf]=(n+` ${FR}`).trimStart()}function zR(t){return t!==null&&typeof t=="object"&&t instanceof dp}function $R(t,e=100){return bi(this,arguments,function*(){let a,r=0;for(;r<e;){const l=yield Qe(t.listTools({cursor:a}));for(const c of l.tools)yield yield Qe(c),r++;if(!l.nextCursor)break;a=l.nextCursor}})}class dp{constructor(e=[],n){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=n}static create(e,n){return new dp(e,n)}async initialize(){var e,n,a,r;if(this.mcpTools.length>0)return;const l={},c=[];for(const m of this.mcpClients)try{for(var f=!0,y=(n=void 0,Hr($R(m))),p;p=await y.next(),e=p.done,!e;f=!0){r=p.value,f=!1;const v=r;c.push(v);const _=v.name;if(l[_])throw new Error(`Duplicate function name ${_} found in MCP tools. Please ensure function names are unique.`);l[_]=m}}catch(v){n={error:v}}finally{try{!f&&!e&&(a=y.return)&&await a.call(y)}finally{if(n)throw n.error}}this.mcpTools=c,this.functionNameToMcpClient=l}async tool(){return await this.initialize(),XC(this.mcpTools,this.config)}async callTool(e){await this.initialize();const n=[];for(const a of e)if(a.name in this.functionNameToMcpClient){const r=this.functionNameToMcpClient[a.name];let l;this.config.timeout&&(l={timeout:this.config.timeout});const c=await r.callTool({name:a.name,arguments:a.args},void 0,l);n.push({functionResponse:{name:a.name,response:c.isError?{error:c}:c}})}return n}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function YR(t,e,n){const a=new FC;let r;n.data instanceof Blob?r=JSON.parse(await n.data.text()):r=JSON.parse(n.data),Object.assign(a,r),e(a)}class JR{constructor(e,n,a){this.apiClient=e,this.auth=n,this.webSocketFactory=a}async connect(e){var n,a;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const r=this.apiClient.getWebsocketBaseUrl(),l=this.apiClient.getApiVersion(),c=XR(this.apiClient.getDefaultHeaders()),f=this.apiClient.getApiKey(),y=`${r}/ws/google.ai.generativelanguage.${l}.GenerativeService.BidiGenerateMusic?key=${f}`;let p=()=>{};const m=new Promise(R=>{p=R}),v=e.callbacks,_=function(){p({})},x=this.apiClient,w={onopen:_,onmessage:R=>{YR(x,v.onmessage,R)},onerror:(n=v==null?void 0:v.onerror)!==null&&n!==void 0?n:function(R){},onclose:(a=v==null?void 0:v.onclose)!==null&&a!==void 0?a:function(R){}},A=this.webSocketFactory.create(y,jR(c),w);A.connect(),await m;const I={setup:{model:Oe(this.apiClient,e.model)}};return A.send(JSON.stringify(I)),new KR(A,this.apiClient)}}class KR{constructor(e,n){this.conn=e,this.apiClient=n}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const n=BN(e);this.conn.send(JSON.stringify({clientContent:n}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const n=qN(e);this.conn.send(JSON.stringify(n))}sendPlaybackControl(e){const n={playbackControl:e};this.conn.send(JSON.stringify(n))}play(){this.sendPlaybackControl(yi.PLAY)}pause(){this.sendPlaybackControl(yi.PAUSE)}stop(){this.sendPlaybackControl(yi.STOP)}resetContext(){this.sendPlaybackControl(yi.RESET_CONTEXT)}close(){this.conn.close()}}function jR(t){const e={};return t.forEach((n,a)=>{e[a]=n}),e}function XR(t){const e=new Headers;for(const[n,a]of Object.entries(t))e.append(n,a);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const QR="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function WR(t,e,n){const a=new VC;let r;n.data instanceof Blob?r=await n.data.text():n.data instanceof ArrayBuffer?r=new TextDecoder().decode(n.data):r=n.data;const l=JSON.parse(r);if(t.isVertexAI()){const c=FN(l);Object.assign(a,c)}else Object.assign(a,l);e(a)}class ZR{constructor(e,n,a){this.apiClient=e,this.auth=n,this.webSocketFactory=a,this.music=new JR(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var n,a,r,l,c,f;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const y=this.apiClient.getWebsocketBaseUrl(),p=this.apiClient.getApiVersion();let m;const v=this.apiClient.getHeaders();e.config&&e.config.tools&&F_(e.config.tools)&&G_(v);const _=s1(v);if(this.apiClient.isVertexAI())m=`${y}/ws/google.cloud.aiplatform.${p}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(_,m);else{const Y=this.apiClient.getApiKey();let Z="BidiGenerateContent",te="key";Y!=null&&Y.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),p!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),Z="BidiGenerateContentConstrained",te="access_token"),m=`${y}/ws/google.ai.generativelanguage.${p}.GenerativeService.${Z}?${te}=${Y}`}let x=()=>{};const w=new Promise(Y=>{x=Y}),A=e.callbacks,C=function(){var Y;(Y=A==null?void 0:A.onopen)===null||Y===void 0||Y.call(A),x({})},N=this.apiClient,I={onopen:C,onmessage:Y=>{WR(N,A.onmessage,Y)},onerror:(n=A==null?void 0:A.onerror)!==null&&n!==void 0?n:function(Y){},onclose:(a=A==null?void 0:A.onclose)!==null&&a!==void 0?a:function(Y){}},R=this.webSocketFactory.create(m,n1(_),I);R.connect(),await w;let M=Oe(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&M.startsWith("publishers/")){const Y=this.apiClient.getProject(),Z=this.apiClient.getLocation();M=`projects/${Y}/locations/${Z}/`+M}let z={};this.apiClient.isVertexAI()&&((r=e.config)===null||r===void 0?void 0:r.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[Jl.AUDIO]}:e.config.responseModalities=[Jl.AUDIO]),!((l=e.config)===null||l===void 0)&&l.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const B=(f=(c=e.config)===null||c===void 0?void 0:c.tools)!==null&&f!==void 0?f:[],k=[];for(const Y of B)if(this.isCallableTool(Y)){const Z=Y;k.push(await Z.tool())}else k.push(Y);k.length>0&&(e.config.tools=k);const W={model:M,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?z=ON(this.apiClient,W):z=UN(this.apiClient,W),delete z.config,R.send(JSON.stringify(z)),new t1(R,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const e1={turnComplete:!0};class t1{constructor(e,n){this.conn=e,this.apiClient=n}tLiveClientContent(e,n){if(n.turns!==null&&n.turns!==void 0){let a=[];try{a=gn(n.turns),e.isVertexAI()||(a=a.map(r=>ou(r)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof n.turns}'`)}return{clientContent:{turns:a,turnComplete:n.turnComplete}}}return{clientContent:{turnComplete:n.turnComplete}}}tLiveClienttToolResponse(e,n){let a=[];if(n.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(n.functionResponses)?a=n.functionResponses:a=[n.functionResponses],a.length===0)throw new Error("functionResponses is required.");for(const l of a){if(typeof l!="object"||l===null||!("name"in l)||!("response"in l))throw new Error(`Could not parse function response, type '${typeof l}'.`);if(!e.isVertexAI()&&!("id"in l))throw new Error(QR)}return{toolResponse:{functionResponses:a}}}sendClientContent(e){e=Object.assign(Object.assign({},e1),e);const n=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(n))}sendRealtimeInput(e){let n={};this.apiClient.isVertexAI()?n={realtimeInput:VN(e)}:n={realtimeInput:HN(e)},this.conn.send(JSON.stringify(n))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const n=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(n))}close(){this.conn.close()}}function n1(t){const e={};return t.forEach((n,a)=>{e[a]=n}),e}function s1(t){const e=new Headers;for(const[n,a]of Object.entries(t))e.append(n,a);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Hv=10;function Vv(t){var e,n,a;if(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let r=!1;for(const c of(n=t==null?void 0:t.tools)!==null&&n!==void 0?n:[])if(xi(c)){r=!0;break}if(!r)return!0;const l=(a=t==null?void 0:t.automaticFunctionCalling)===null||a===void 0?void 0:a.maximumRemoteCalls;return l&&(l<0||!Number.isInteger(l))||l==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",l),!0):!1}function xi(t){return"callTool"in t&&typeof t.callTool=="function"}function a1(t){var e,n,a;return(a=(n=(e=t.config)===null||e===void 0?void 0:e.tools)===null||n===void 0?void 0:n.some(r=>xi(r)))!==null&&a!==void 0?a:!1}function Fv(t){var e;const n=[];return!((e=t==null?void 0:t.config)===null||e===void 0)&&e.tools&&t.config.tools.forEach((a,r)=>{if(xi(a))return;const l=a;l.functionDeclarations&&l.functionDeclarations.length>0&&n.push(r)}),n}function Gv(t){var e;return!(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let i1=class extends os{constructor(e){super(),this.apiClient=e,this.generateContent=async n=>{var a,r,l,c,f;const y=await this.processParamsMaybeAddMcpUsage(n);if(this.maybeMoveToResponseJsonSchem(n),!a1(n)||Vv(n.config))return await this.generateContentInternal(y);const p=Fv(n);if(p.length>0){const A=p.map(C=>`tools[${C}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${A}.`)}let m,v;const _=gn(y.contents),x=(l=(r=(a=y.config)===null||a===void 0?void 0:a.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls)!==null&&l!==void 0?l:Hv;let w=0;for(;w<x&&(m=await this.generateContentInternal(y),!(!m.functionCalls||m.functionCalls.length===0));){const A=m.candidates[0].content,C=[];for(const N of(f=(c=n.config)===null||c===void 0?void 0:c.tools)!==null&&f!==void 0?f:[])if(xi(N)){const R=await N.callTool(m.functionCalls);C.push(...R)}w++,v={role:"user",parts:C},y.contents=gn(y.contents),y.contents.push(A),y.contents.push(v),Gv(y.config)&&(_.push(A),_.push(v))}return Gv(y.config)&&(m.automaticFunctionCallingHistory=_),m},this.generateContentStream=async n=>{if(this.maybeMoveToResponseJsonSchem(n),Vv(n.config)){const r=await this.processParamsMaybeAddMcpUsage(n);return await this.generateContentStreamInternal(r)}const a=Fv(n);if(a.length>0){const r=a.map(l=>`tools[${l}]`).join(", ");throw new Error(`Incompatible tools found at ${r}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}return await this.processAfcStream(n)},this.generateImages=async n=>await this.generateImagesInternal(n).then(a=>{var r;let l;const c=[];if(a!=null&&a.generatedImages)for(const y of a.generatedImages)y&&(y!=null&&y.safetyAttributes)&&((r=y==null?void 0:y.safetyAttributes)===null||r===void 0?void 0:r.contentType)==="Positive Prompt"?l=y==null?void 0:y.safetyAttributes:c.push(y);let f;return l?f={generatedImages:c,positivePromptSafetyAttributes:l,sdkHttpResponse:a.sdkHttpResponse}:f={generatedImages:c,sdkHttpResponse:a.sdkHttpResponse},f}),this.list=async n=>{var a;const c={config:Object.assign(Object.assign({},{queryBase:!0}),n==null?void 0:n.config)};if(this.apiClient.isVertexAI()&&!c.config.queryBase){if(!((a=c.config)===null||a===void 0)&&a.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");c.config.filter="labels.tune-type:*"}return new ba(rs.PAGED_ITEM_MODELS,f=>this.listInternal(f),await this.listInternal(c),c)},this.editImage=async n=>{const a={model:n.model,prompt:n.prompt,referenceImages:[],config:n.config};return n.referenceImages&&n.referenceImages&&(a.referenceImages=n.referenceImages.map(r=>r.toReferenceImageAPI())),await this.editImageInternal(a)},this.upscaleImage=async n=>{let a={numberOfImages:1,mode:"upscale"};n.config&&(a=Object.assign(Object.assign({},a),n.config));const r={model:n.model,image:n.image,upscaleFactor:n.upscaleFactor,config:a};return await this.upscaleImageInternal(r)},this.generateVideos=async n=>{var a,r,l,c,f,y;if((n.prompt||n.image||n.video)&&n.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((a=n.video)===null||a===void 0)&&a.uri&&(!((r=n.video)===null||r===void 0)&&r.videoBytes)?n.video={uri:n.video.uri,mimeType:n.video.mimeType}:!((c=(l=n.source)===null||l===void 0?void 0:l.video)===null||c===void 0)&&c.uri&&(!((y=(f=n.source)===null||f===void 0?void 0:f.video)===null||y===void 0)&&y.videoBytes)&&(n.source.video={uri:n.source.video.uri,mimeType:n.source.video.mimeType})),await this.generateVideosInternal(n)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var n,a,r;const l=(n=e.config)===null||n===void 0?void 0:n.tools;if(!l)return e;const c=await Promise.all(l.map(async y=>xi(y)?await y.tool():y)),f={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:c})};if(f.config.tools=c,e.config&&e.config.tools&&F_(e.config.tools)){const y=(r=(a=e.config.httpOptions)===null||a===void 0?void 0:a.headers)!==null&&r!==void 0?r:{};let p=Object.assign({},y);Object.keys(p).length===0&&(p=this.apiClient.getDefaultHeaders()),G_(p),f.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:p})}return f}async initAfcToolsMap(e){var n,a,r;const l=new Map;for(const c of(a=(n=e.config)===null||n===void 0?void 0:n.tools)!==null&&a!==void 0?a:[])if(xi(c)){const f=c,y=await f.tool();for(const p of(r=y.functionDeclarations)!==null&&r!==void 0?r:[]){if(!p.name)throw new Error("Function declaration name is required.");if(l.has(p.name))throw new Error(`Duplicate tool declaration name: ${p.name}`);l.set(p.name,f)}}return l}async processAfcStream(e){var n,a,r;const l=(r=(a=(n=e.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||a===void 0?void 0:a.maximumRemoteCalls)!==null&&r!==void 0?r:Hv;let c=!1,f=0;const y=await this.initAfcToolsMap(e);return(function(p,m,v){var _,x;return bi(this,arguments,function*(){for(var w,A,C,N;f<l;){c&&(f++,c=!1);const z=yield Qe(p.processParamsMaybeAddMcpUsage(v)),B=yield Qe(p.generateContentStreamInternal(z)),k=[],W=[];try{for(var I=!0,R=(A=void 0,Hr(B)),M;M=yield Qe(R.next()),w=M.done,!w;I=!0){N=M.value,I=!1;const Y=N;if(yield yield Qe(Y),Y.candidates&&(!((_=Y.candidates[0])===null||_===void 0)&&_.content)){W.push(Y.candidates[0].content);for(const Z of(x=Y.candidates[0].content.parts)!==null&&x!==void 0?x:[])if(f<l&&Z.functionCall){if(!Z.functionCall.name)throw new Error("Function call name was not returned by the model.");if(m.has(Z.functionCall.name)){const te=yield Qe(m.get(Z.functionCall.name).callTool([Z.functionCall]));k.push(...te)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${m.keys()}, mising tool: ${Z.functionCall.name}`)}}}}catch(Y){A={error:Y}}finally{try{!I&&!w&&(C=R.return)&&(yield Qe(C.call(R)))}finally{if(A)throw A.error}}if(k.length>0){c=!0;const Y=new Mr;Y.candidates=[{content:{role:"user",parts:k}}],yield yield Qe(Y);const Z=[];Z.push(...W),Z.push({role:"user",parts:k});const te=gn(v.contents).concat(Z);v.contents=te}else break}})})(this,y,e)}async generateContentInternal(e){var n,a,r,l;let c,f="",y={};if(this.apiClient.isVertexAI()){const p=kv(this.apiClient,e);return f=ie("{model}:generateContent",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(v=>{const _=v;return _.sdkHttpResponse={headers:m.headers},_})),c.then(m=>{const v=Ov(m),_=new Mr;return Object.assign(_,v),_})}else{const p=Lv(this.apiClient,e);return f=ie("{model}:generateContent",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(v=>{const _=v;return _.sdkHttpResponse={headers:m.headers},_})),c.then(m=>{const v=Uv(m),_=new Mr;return Object.assign(_,v),_})}}async generateContentStreamInternal(e){var n,a,r,l;let c,f="",y={};if(this.apiClient.isVertexAI()){const p=kv(this.apiClient,e);return f=ie("{model}:streamGenerateContent?alt=sse",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.requestStream({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}),c.then(function(v){return bi(this,arguments,function*(){var _,x,w,A;try{for(var C=!0,N=Hr(v),I;I=yield Qe(N.next()),_=I.done,!_;C=!0){A=I.value,C=!1;const R=A,M=Ov(yield Qe(R.json()));M.sdkHttpResponse={headers:R.headers};const z=new Mr;Object.assign(z,M),yield yield Qe(z)}}catch(R){x={error:R}}finally{try{!C&&!_&&(w=N.return)&&(yield Qe(w.call(N)))}finally{if(x)throw x.error}}})})}else{const p=Lv(this.apiClient,e);return f=ie("{model}:streamGenerateContent?alt=sse",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.requestStream({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}),c.then(function(v){return bi(this,arguments,function*(){var _,x,w,A;try{for(var C=!0,N=Hr(v),I;I=yield Qe(N.next()),_=I.done,!_;C=!0){A=I.value,C=!1;const R=A,M=Uv(yield Qe(R.json()));M.sdkHttpResponse={headers:R.headers};const z=new Mr;Object.assign(z,M),yield yield Qe(z)}}catch(R){x={error:R}}finally{try{!C&&!_&&(w=N.return)&&(yield Qe(w.call(N)))}finally{if(x)throw x.error}}})})}}async embedContent(e){var n,a,r,l;let c,f="",y={};if(this.apiClient.isVertexAI()){const p=vI(this.apiClient,e);return f=ie("{model}:predict",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(v=>{const _=v;return _.sdkHttpResponse={headers:m.headers},_})),c.then(m=>{const v=_I(m),_=new vv;return Object.assign(_,v),_})}else{const p=yI(this.apiClient,e);return f=ie("{model}:batchEmbedContents",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(v=>{const _=v;return _.sdkHttpResponse={headers:m.headers},_})),c.then(m=>{const v=SI(m),_=new vv;return Object.assign(_,v),_})}}async generateImagesInternal(e){var n,a,r,l;let c,f="",y={};if(this.apiClient.isVertexAI()){const p=II(this.apiClient,e);return f=ie("{model}:predict",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(v=>{const _=v;return _.sdkHttpResponse={headers:m.headers},_})),c.then(m=>{const v=MI(m),_=new Sv;return Object.assign(_,v),_})}else{const p=NI(this.apiClient,e);return f=ie("{model}:predict",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(v=>{const _=v;return _.sdkHttpResponse={headers:m.headers},_})),c.then(m=>{const v=RI(m),_=new Sv;return Object.assign(_,v),_})}}async editImageInternal(e){var n,a;let r,l="",c={};if(this.apiClient.isVertexAI()){const f=pI(this.apiClient,e);return l=ie("{model}:predict",f._url),c=f._query,delete f._url,delete f._query,r=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(y=>y.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:y.headers},m})),r.then(y=>{const p=mI(y),m=new RC;return Object.assign(m,p),m})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var n,a;let r,l="",c={};if(this.apiClient.isVertexAI()){const f=CR(this.apiClient,e);return l=ie("{model}:predict",f._url),c=f._query,delete f._url,delete f._query,r=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(y=>y.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:y.headers},m})),r.then(y=>{const p=ER(y),m=new MC;return Object.assign(m,p),m})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var n,a;let r,l="",c={};if(this.apiClient.isVertexAI()){const f=lR(this.apiClient,e);return l=ie("{model}:predict",f._url),c=f._query,delete f._url,delete f._query,r=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(y=>y.json()),r.then(y=>{const p=uR(y),m=new DC;return Object.assign(m,p),m})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var n,a;let r,l="",c={};if(this.apiClient.isVertexAI()){const f=hR(this.apiClient,e);return l=ie("{model}:predict",f._url),c=f._query,delete f._url,delete f._query,r=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(y=>y.json()),r.then(y=>{const p=gR(y),m=new PC;return Object.assign(m,p),m})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var n,a,r,l;let c,f="",y={};if(this.apiClient.isVertexAI()){const p=KI(this.apiClient,e);return f=ie("{name}",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json()),c.then(m=>wf(m))}else{const p=JI(this.apiClient,e);return f=ie("{name}",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c.then(m=>Af(m))}}async listInternal(e){var n,a,r,l;let c,f="",y={};if(this.apiClient.isVertexAI()){const p=tR(this.apiClient,e);return f=ie("{models_url}",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(v=>{const _=v;return _.sdkHttpResponse={headers:m.headers},_})),c.then(m=>{const v=sR(m),_=new _v;return Object.assign(_,v),_})}else{const p=eR(this.apiClient,e);return f=ie("{models_url}",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(v=>{const _=v;return _.sdkHttpResponse={headers:m.headers},_})),c.then(m=>{const v=nR(m),_=new _v;return Object.assign(_,v),_})}}async update(e){var n,a,r,l;let c,f="",y={};if(this.apiClient.isVertexAI()){const p=AR(this.apiClient,e);return f=ie("{model}",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json()),c.then(m=>wf(m))}else{const p=xR(this.apiClient,e);return f=ie("{name}",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"PATCH",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c.then(m=>Af(m))}}async delete(e){var n,a,r,l;let c,f="",y={};if(this.apiClient.isVertexAI()){const p=uI(this.apiClient,e);return f=ie("{name}",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(v=>{const _=v;return _.sdkHttpResponse={headers:m.headers},_})),c.then(m=>{const v=dI(m),_=new Tv;return Object.assign(_,v),_})}else{const p=lI(this.apiClient,e);return f=ie("{name}",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"DELETE",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(v=>{const _=v;return _.sdkHttpResponse={headers:m.headers},_})),c.then(m=>{const v=cI(m),_=new Tv;return Object.assign(_,v),_})}}async countTokens(e){var n,a,r,l;let c,f="",y={};if(this.apiClient.isVertexAI()){const p=iI(this.apiClient,e);return f=ie("{model}:countTokens",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(v=>{const _=v;return _.sdkHttpResponse={headers:m.headers},_})),c.then(m=>{const v=oI(m),_=new bv;return Object.assign(_,v),_})}else{const p=aI(this.apiClient,e);return f=ie("{model}:countTokens",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(v=>{const _=v;return _.sdkHttpResponse={headers:m.headers},_})),c.then(m=>{const v=rI(m),_=new bv;return Object.assign(_,v),_})}}async computeTokens(e){var n,a;let r,l="",c={};if(this.apiClient.isVertexAI()){const f=QN(this.apiClient,e);return l=ie("{model}:computeTokens",f._url),c=f._query,delete f._url,delete f._query,r=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(y=>y.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:y.headers},m})),r.then(y=>{const p=WN(y),m=new LC;return Object.assign(m,p),m})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var n,a,r,l;let c,f="",y={};if(this.apiClient.isVertexAI()){const p=OI(this.apiClient,e);return f=ie("{model}:predictLongRunning",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json()),c.then(m=>{const v=kI(m),_=new Kl;return Object.assign(_,v),_})}else{const p=UI(this.apiClient,e);return f=ie("{model}:predictLongRunning",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c.then(m=>{const v=LI(m),_=new Kl;return Object.assign(_,v),_})}}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class r1 extends os{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const n=e.operation,a=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const r=n.name.split("/operations/")[0];let l;a&&"httpOptions"in a&&(l=a.httpOptions);const c=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:r,config:{httpOptions:l}});return n._fromAPIResponse({apiResponse:c,_isVertexAI:!0})}else{const r=await this.getVideosOperationInternal({operationName:n.name,config:a});return n._fromAPIResponse({apiResponse:r,_isVertexAI:!1})}}async get(e){const n=e.operation,a=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const r=n.name.split("/operations/")[0];let l;a&&"httpOptions"in a&&(l=a.httpOptions);const c=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:r,config:{httpOptions:l}});return n._fromAPIResponse({apiResponse:c,_isVertexAI:!0})}else{const r=await this.getVideosOperationInternal({operationName:n.name,config:a});return n._fromAPIResponse({apiResponse:r,_isVertexAI:!1})}}async getVideosOperationInternal(e){var n,a,r,l;let c,f="",y={};if(this.apiClient.isVertexAI()){const p=AC(e);return f=ie("{operationName}",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json()),c}else{const p=xC(e);return f=ie("{operationName}",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c}}async fetchPredictVideosOperationInternal(e){var n,a;let r,l="",c={};if(this.apiClient.isVertexAI()){const f=gC(e);return l=ie("{resourceName}:fetchPredictOperation",f._url),c=f._query,delete f._url,delete f._query,r=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(y=>y.json()),r}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function o1(t){const e={},n=d(t,["data"]);if(n!=null&&h(e,["data"],n),d(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const a=d(t,["mimeType"]);return a!=null&&h(e,["mimeType"],a),e}function l1(t){const e={},n=d(t,["parts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(l=>g1(l))),h(e,["parts"],r)}const a=d(t,["role"]);return a!=null&&h(e,["role"],a),e}function u1(t,e,n){const a={},r=d(e,["expireTime"]);n!==void 0&&r!=null&&h(n,["expireTime"],r);const l=d(e,["newSessionExpireTime"]);n!==void 0&&l!=null&&h(n,["newSessionExpireTime"],l);const c=d(e,["uses"]);n!==void 0&&c!=null&&h(n,["uses"],c);const f=d(e,["liveConnectConstraints"]);n!==void 0&&f!=null&&h(n,["bidiGenerateContentSetup"],h1(t,f));const y=d(e,["lockAdditionalFields"]);return n!==void 0&&y!=null&&h(n,["fieldMask"],y),a}function c1(t,e){const n={},a=d(e,["config"]);return a!=null&&h(n,["config"],u1(t,a,n)),n}function d1(t){const e={};if(d(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=d(t,["fileUri"]);n!=null&&h(e,["fileUri"],n);const a=d(t,["mimeType"]);return a!=null&&h(e,["mimeType"],a),e}function f1(t){const e={};if(d(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=d(t,["enableWidget"]);return n!=null&&h(e,["enableWidget"],n),e}function p1(t){const e={};if(d(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(d(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=d(t,["timeRangeFilter"]);return n!=null&&h(e,["timeRangeFilter"],n),e}function m1(t,e){const n={},a=d(t,["generationConfig"]);e!==void 0&&a!=null&&h(e,["setup","generationConfig"],a);const r=d(t,["responseModalities"]);e!==void 0&&r!=null&&h(e,["setup","generationConfig","responseModalities"],r);const l=d(t,["temperature"]);e!==void 0&&l!=null&&h(e,["setup","generationConfig","temperature"],l);const c=d(t,["topP"]);e!==void 0&&c!=null&&h(e,["setup","generationConfig","topP"],c);const f=d(t,["topK"]);e!==void 0&&f!=null&&h(e,["setup","generationConfig","topK"],f);const y=d(t,["maxOutputTokens"]);e!==void 0&&y!=null&&h(e,["setup","generationConfig","maxOutputTokens"],y);const p=d(t,["mediaResolution"]);e!==void 0&&p!=null&&h(e,["setup","generationConfig","mediaResolution"],p);const m=d(t,["seed"]);e!==void 0&&m!=null&&h(e,["setup","generationConfig","seed"],m);const v=d(t,["speechConfig"]);e!==void 0&&v!=null&&h(e,["setup","generationConfig","speechConfig"],cp(v));const _=d(t,["thinkingConfig"]);e!==void 0&&_!=null&&h(e,["setup","generationConfig","thinkingConfig"],_);const x=d(t,["enableAffectiveDialog"]);e!==void 0&&x!=null&&h(e,["setup","generationConfig","enableAffectiveDialog"],x);const w=d(t,["systemInstruction"]);e!==void 0&&w!=null&&h(e,["setup","systemInstruction"],l1(Mt(w)));const A=d(t,["tools"]);if(e!==void 0&&A!=null){let B=Ii(A);Array.isArray(B)&&(B=B.map(k=>v1(Ni(k)))),h(e,["setup","tools"],B)}const C=d(t,["sessionResumption"]);e!==void 0&&C!=null&&h(e,["setup","sessionResumption"],y1(C));const N=d(t,["inputAudioTranscription"]);e!==void 0&&N!=null&&h(e,["setup","inputAudioTranscription"],N);const I=d(t,["outputAudioTranscription"]);e!==void 0&&I!=null&&h(e,["setup","outputAudioTranscription"],I);const R=d(t,["realtimeInputConfig"]);e!==void 0&&R!=null&&h(e,["setup","realtimeInputConfig"],R);const M=d(t,["contextWindowCompression"]);e!==void 0&&M!=null&&h(e,["setup","contextWindowCompression"],M);const z=d(t,["proactivity"]);return e!==void 0&&z!=null&&h(e,["setup","proactivity"],z),n}function h1(t,e){const n={},a=d(e,["model"]);a!=null&&h(n,["setup","model"],Oe(t,a));const r=d(e,["config"]);return r!=null&&h(n,["config"],m1(r,n)),n}function g1(t){const e={},n=d(t,["functionCall"]);n!=null&&h(e,["functionCall"],n);const a=d(t,["codeExecutionResult"]);a!=null&&h(e,["codeExecutionResult"],a);const r=d(t,["executableCode"]);r!=null&&h(e,["executableCode"],r);const l=d(t,["fileData"]);l!=null&&h(e,["fileData"],d1(l));const c=d(t,["functionResponse"]);c!=null&&h(e,["functionResponse"],c);const f=d(t,["inlineData"]);f!=null&&h(e,["inlineData"],o1(f));const y=d(t,["text"]);y!=null&&h(e,["text"],y);const p=d(t,["thought"]);p!=null&&h(e,["thought"],p);const m=d(t,["thoughtSignature"]);m!=null&&h(e,["thoughtSignature"],m);const v=d(t,["videoMetadata"]);return v!=null&&h(e,["videoMetadata"],v),e}function y1(t){const e={},n=d(t,["handle"]);if(n!=null&&h(e,["handle"],n),d(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function v1(t){const e={},n=d(t,["functionDeclarations"]);if(n!=null){let m=n;Array.isArray(m)&&(m=m.map(v=>v)),h(e,["functionDeclarations"],m)}if(d(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const a=d(t,["googleSearchRetrieval"]);a!=null&&h(e,["googleSearchRetrieval"],a);const r=d(t,["computerUse"]);r!=null&&h(e,["computerUse"],r);const l=d(t,["fileSearch"]);l!=null&&h(e,["fileSearch"],l);const c=d(t,["codeExecution"]);if(c!=null&&h(e,["codeExecution"],c),d(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const f=d(t,["googleMaps"]);f!=null&&h(e,["googleMaps"],f1(f));const y=d(t,["googleSearch"]);y!=null&&h(e,["googleSearch"],p1(y));const p=d(t,["urlContext"]);return p!=null&&h(e,["urlContext"],p),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function S1(t){const e=[];for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const a=t[n];if(typeof a=="object"&&a!=null&&Object.keys(a).length>0){const r=Object.keys(a).map(l=>`${n}.${l}`);e.push(...r)}else e.push(n)}return e.join(",")}function _1(t,e){let n=null;const a=t.bidiGenerateContentSetup;if(typeof a=="object"&&a!==null&&"setup"in a){const l=a.setup;typeof l=="object"&&l!==null?(t.bidiGenerateContentSetup=l,n=l):delete t.bidiGenerateContentSetup}else a!==void 0&&delete t.bidiGenerateContentSetup;const r=t.fieldMask;if(n){const l=S1(n);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)l?t.fieldMask=l:delete t.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&r!==null&&Array.isArray(r)&&r.length>0){const c=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let f=[];r.length>0&&(f=r.map(p=>c.includes(p)?`generationConfig.${p}`:p));const y=[];l&&y.push(l),f.length>0&&y.push(...f),y.length>0?t.fieldMask=y.join(","):delete t.fieldMask}else delete t.fieldMask}else r!==null&&Array.isArray(r)&&r.length>0?t.fieldMask=r.join(","):delete t.fieldMask;return t}class T1 extends os{constructor(e){super(),this.apiClient=e}async create(e){var n,a;let r,l="",c={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const f=c1(this.apiClient,e);l=ie("auth_tokens",f._url),c=f._query,delete f.config,delete f._url,delete f._query;const y=_1(f,e.config);return r=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(y),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(p=>p.json()),r.then(p=>p)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function b1(t,e){const n={},a=d(t,["displayName"]);return e!==void 0&&a!=null&&h(e,["displayName"],a),n}function x1(t){const e={},n=d(t,["config"]);return n!=null&&b1(n,e),e}function A1(t,e){const n={},a=d(t,["force"]);return e!==void 0&&a!=null&&h(e,["_query","force"],a),n}function w1(t){const e={},n=d(t,["name"]);n!=null&&h(e,["_url","name"],n);const a=d(t,["config"]);return a!=null&&A1(a,e),e}function C1(t){const e={},n=d(t,["name"]);return n!=null&&h(e,["_url","name"],n),e}function E1(t,e){const n={},a=d(t,["customMetadata"]);if(e!==void 0&&a!=null){let l=a;Array.isArray(l)&&(l=l.map(c=>c)),h(e,["customMetadata"],l)}const r=d(t,["chunkingConfig"]);return e!==void 0&&r!=null&&h(e,["chunkingConfig"],r),n}function N1(t){const e={},n=d(t,["name"]);n!=null&&h(e,["name"],n);const a=d(t,["metadata"]);a!=null&&h(e,["metadata"],a);const r=d(t,["done"]);r!=null&&h(e,["done"],r);const l=d(t,["error"]);l!=null&&h(e,["error"],l);const c=d(t,["response"]);return c!=null&&h(e,["response"],R1(c)),e}function I1(t){const e={},n=d(t,["fileSearchStoreName"]);n!=null&&h(e,["_url","file_search_store_name"],n);const a=d(t,["fileName"]);a!=null&&h(e,["fileName"],a);const r=d(t,["config"]);return r!=null&&E1(r,e),e}function R1(t){const e={},n=d(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const a=d(t,["parent"]);a!=null&&h(e,["parent"],a);const r=d(t,["documentName"]);return r!=null&&h(e,["documentName"],r),e}function M1(t,e){const n={},a=d(t,["pageSize"]);e!==void 0&&a!=null&&h(e,["_query","pageSize"],a);const r=d(t,["pageToken"]);return e!==void 0&&r!=null&&h(e,["_query","pageToken"],r),n}function D1(t){const e={},n=d(t,["config"]);return n!=null&&M1(n,e),e}function P1(t){const e={},n=d(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const a=d(t,["nextPageToken"]);a!=null&&h(e,["nextPageToken"],a);const r=d(t,["fileSearchStores"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(c=>c)),h(e,["fileSearchStores"],l)}return e}function L1(t,e){const n={},a=d(t,["mimeType"]);e!==void 0&&a!=null&&h(e,["mimeType"],a);const r=d(t,["displayName"]);e!==void 0&&r!=null&&h(e,["displayName"],r);const l=d(t,["customMetadata"]);if(e!==void 0&&l!=null){let f=l;Array.isArray(f)&&(f=f.map(y=>y)),h(e,["customMetadata"],f)}const c=d(t,["chunkingConfig"]);return e!==void 0&&c!=null&&h(e,["chunkingConfig"],c),n}function k1(t){const e={},n=d(t,["fileSearchStoreName"]);n!=null&&h(e,["_url","file_search_store_name"],n);const a=d(t,["config"]);return a!=null&&L1(a,e),e}function U1(t){const e={},n=d(t,["sdkHttpResponse"]);return n!=null&&h(e,["sdkHttpResponse"],n),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function O1(t,e){const n={},a=d(t,["force"]);return e!==void 0&&a!=null&&h(e,["_query","force"],a),n}function q1(t){const e={},n=d(t,["name"]);n!=null&&h(e,["_url","name"],n);const a=d(t,["config"]);return a!=null&&O1(a,e),e}function B1(t){const e={},n=d(t,["name"]);return n!=null&&h(e,["_url","name"],n),e}function H1(t,e){const n={},a=d(t,["pageSize"]);e!==void 0&&a!=null&&h(e,["_query","pageSize"],a);const r=d(t,["pageToken"]);return e!==void 0&&r!=null&&h(e,["_query","pageToken"],r),n}function V1(t){const e={},n=d(t,["parent"]);n!=null&&h(e,["_url","parent"],n);const a=d(t,["config"]);return a!=null&&H1(a,e),e}function F1(t){const e={},n=d(t,["sdkHttpResponse"]);n!=null&&h(e,["sdkHttpResponse"],n);const a=d(t,["nextPageToken"]);a!=null&&h(e,["nextPageToken"],a);const r=d(t,["documents"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(c=>c)),h(e,["documents"],l)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class G1 extends os{constructor(e){super(),this.apiClient=e,this.list=async n=>new ba(rs.PAGED_ITEM_DOCUMENTS,a=>this.listInternal({parent:n.parent,config:a.config}),await this.listInternal(n),n)}async get(e){var n,a;let r,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const f=B1(e);return l=ie("{name}",f._url),c=f._query,delete f._url,delete f._query,r=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(y=>y.json()),r.then(y=>y)}}async delete(e){var n,a;let r="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=q1(e);r=ie("{name}",c._url),l=c._query,delete c._url,delete c._query,await this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal})}}async listInternal(e){var n,a;let r,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const f=V1(e);return l=ie("{parent}/documents",f._url),c=f._query,delete f._url,delete f._query,r=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(y=>y.json()),r.then(y=>{const p=F1(y),m=new kC;return Object.assign(m,p),m})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class z1 extends os{constructor(e,n=new G1(e)){super(),this.apiClient=e,this.documents=n,this.list=async(a={})=>new ba(rs.PAGED_ITEM_FILE_SEARCH_STORES,r=>this.listInternal(r),await this.listInternal(a),a)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var n,a;let r,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const f=x1(e);return l=ie("fileSearchStores",f._url),c=f._query,delete f._url,delete f._query,r=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(y=>y.json()),r.then(y=>y)}}async get(e){var n,a;let r,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const f=C1(e);return l=ie("{name}",f._url),c=f._query,delete f._url,delete f._query,r=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(y=>y.json()),r.then(y=>y)}}async delete(e){var n,a;let r="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=w1(e);r=ie("{name}",c._url),l=c._query,delete c._url,delete c._query,await this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal})}}async listInternal(e){var n,a;let r,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const f=D1(e);return l=ie("fileSearchStores",f._url),c=f._query,delete f._url,delete f._query,r=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(y=>y.json()),r.then(y=>{const p=P1(y),m=new UC;return Object.assign(m,p),m})}}async uploadToFileSearchStoreInternal(e){var n,a;let r,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const f=k1(e);return l=ie("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",f._url),c=f._query,delete f._url,delete f._query,r=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(y=>y.json()),r.then(y=>{const p=U1(y),m=new OC;return Object.assign(m,p),m})}}async importFile(e){var n,a;let r,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const f=I1(e);return l=ie("{file_search_store_name}:importFile",f._url),c=f._query,delete f._url,delete f._query,r=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(y=>y.json()),r.then(y=>{const p=N1(y),m=new ip;return Object.assign(m,p),m})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function $1(t,e){const n={},a=d(t,["name"]);return a!=null&&h(n,["_url","name"],a),n}function Y1(t,e){const n={},a=d(t,["name"]);return a!=null&&h(n,["_url","name"],a),n}function J1(t,e,n){const a={};if(d(t,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const r=d(t,["tunedModelDisplayName"]);if(e!==void 0&&r!=null&&h(e,["displayName"],r),d(t,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const l=d(t,["epochCount"]);e!==void 0&&l!=null&&h(e,["tuningTask","hyperparameters","epochCount"],l);const c=d(t,["learningRateMultiplier"]);if(c!=null&&h(a,["tuningTask","hyperparameters","learningRateMultiplier"],c),d(t,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(d(t,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(d(t,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const f=d(t,["batchSize"]);e!==void 0&&f!=null&&h(e,["tuningTask","hyperparameters","batchSize"],f);const y=d(t,["learningRate"]);if(e!==void 0&&y!=null&&h(e,["tuningTask","hyperparameters","learningRate"],y),d(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(d(t,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return a}function K1(t,e,n){const a={};let r=d(n,["config","method"]);if(r===void 0&&(r="SUPERVISED_FINE_TUNING"),r==="SUPERVISED_FINE_TUNING"){const x=d(t,["validationDataset"]);e!==void 0&&x!=null&&h(e,["supervisedTuningSpec"],zv(x))}else if(r==="PREFERENCE_TUNING"){const x=d(t,["validationDataset"]);e!==void 0&&x!=null&&h(e,["preferenceOptimizationSpec"],zv(x))}const l=d(t,["tunedModelDisplayName"]);e!==void 0&&l!=null&&h(e,["tunedModelDisplayName"],l);const c=d(t,["description"]);e!==void 0&&c!=null&&h(e,["description"],c);let f=d(n,["config","method"]);if(f===void 0&&(f="SUPERVISED_FINE_TUNING"),f==="SUPERVISED_FINE_TUNING"){const x=d(t,["epochCount"]);e!==void 0&&x!=null&&h(e,["supervisedTuningSpec","hyperParameters","epochCount"],x)}else if(f==="PREFERENCE_TUNING"){const x=d(t,["epochCount"]);e!==void 0&&x!=null&&h(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],x)}let y=d(n,["config","method"]);if(y===void 0&&(y="SUPERVISED_FINE_TUNING"),y==="SUPERVISED_FINE_TUNING"){const x=d(t,["learningRateMultiplier"]);e!==void 0&&x!=null&&h(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],x)}else if(y==="PREFERENCE_TUNING"){const x=d(t,["learningRateMultiplier"]);e!==void 0&&x!=null&&h(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],x)}let p=d(n,["config","method"]);if(p===void 0&&(p="SUPERVISED_FINE_TUNING"),p==="SUPERVISED_FINE_TUNING"){const x=d(t,["exportLastCheckpointOnly"]);e!==void 0&&x!=null&&h(e,["supervisedTuningSpec","exportLastCheckpointOnly"],x)}else if(p==="PREFERENCE_TUNING"){const x=d(t,["exportLastCheckpointOnly"]);e!==void 0&&x!=null&&h(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],x)}let m=d(n,["config","method"]);if(m===void 0&&(m="SUPERVISED_FINE_TUNING"),m==="SUPERVISED_FINE_TUNING"){const x=d(t,["adapterSize"]);e!==void 0&&x!=null&&h(e,["supervisedTuningSpec","hyperParameters","adapterSize"],x)}else if(m==="PREFERENCE_TUNING"){const x=d(t,["adapterSize"]);e!==void 0&&x!=null&&h(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],x)}if(d(t,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(d(t,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const v=d(t,["labels"]);e!==void 0&&v!=null&&h(e,["labels"],v);const _=d(t,["beta"]);return e!==void 0&&_!=null&&h(e,["preferenceOptimizationSpec","hyperParameters","beta"],_),a}function j1(t,e){const n={},a=d(t,["baseModel"]);a!=null&&h(n,["baseModel"],a);const r=d(t,["preTunedModel"]);r!=null&&h(n,["preTunedModel"],r);const l=d(t,["trainingDataset"]);l!=null&&rM(l);const c=d(t,["config"]);return c!=null&&J1(c,n),n}function X1(t,e){const n={},a=d(t,["baseModel"]);a!=null&&h(n,["baseModel"],a);const r=d(t,["preTunedModel"]);r!=null&&h(n,["preTunedModel"],r);const l=d(t,["trainingDataset"]);l!=null&&oM(l,n,e);const c=d(t,["config"]);return c!=null&&K1(c,n,e),n}function Q1(t,e){const n={},a=d(t,["name"]);return a!=null&&h(n,["_url","name"],a),n}function W1(t,e){const n={},a=d(t,["name"]);return a!=null&&h(n,["_url","name"],a),n}function Z1(t,e,n){const a={},r=d(t,["pageSize"]);e!==void 0&&r!=null&&h(e,["_query","pageSize"],r);const l=d(t,["pageToken"]);e!==void 0&&l!=null&&h(e,["_query","pageToken"],l);const c=d(t,["filter"]);return e!==void 0&&c!=null&&h(e,["_query","filter"],c),a}function eM(t,e,n){const a={},r=d(t,["pageSize"]);e!==void 0&&r!=null&&h(e,["_query","pageSize"],r);const l=d(t,["pageToken"]);e!==void 0&&l!=null&&h(e,["_query","pageToken"],l);const c=d(t,["filter"]);return e!==void 0&&c!=null&&h(e,["_query","filter"],c),a}function tM(t,e){const n={},a=d(t,["config"]);return a!=null&&Z1(a,n),n}function nM(t,e){const n={},a=d(t,["config"]);return a!=null&&eM(a,n),n}function sM(t,e){const n={},a=d(t,["sdkHttpResponse"]);a!=null&&h(n,["sdkHttpResponse"],a);const r=d(t,["nextPageToken"]);r!=null&&h(n,["nextPageToken"],r);const l=d(t,["tunedModels"]);if(l!=null){let c=l;Array.isArray(c)&&(c=c.map(f=>z_(f))),h(n,["tuningJobs"],c)}return n}function aM(t,e){const n={},a=d(t,["sdkHttpResponse"]);a!=null&&h(n,["sdkHttpResponse"],a);const r=d(t,["nextPageToken"]);r!=null&&h(n,["nextPageToken"],r);const l=d(t,["tuningJobs"]);if(l!=null){let c=l;Array.isArray(c)&&(c=c.map(f=>Ef(f))),h(n,["tuningJobs"],c)}return n}function iM(t,e){const n={},a=d(t,["name"]);a!=null&&h(n,["model"],a);const r=d(t,["name"]);return r!=null&&h(n,["endpoint"],r),n}function rM(t,e){const n={};if(d(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(d(t,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const a=d(t,["examples"]);if(a!=null){let r=a;Array.isArray(r)&&(r=r.map(l=>l)),h(n,["examples","examples"],r)}return n}function oM(t,e,n){const a={};let r=d(n,["config","method"]);if(r===void 0&&(r="SUPERVISED_FINE_TUNING"),r==="SUPERVISED_FINE_TUNING"){const c=d(t,["gcsUri"]);e!==void 0&&c!=null&&h(e,["supervisedTuningSpec","trainingDatasetUri"],c)}else if(r==="PREFERENCE_TUNING"){const c=d(t,["gcsUri"]);e!==void 0&&c!=null&&h(e,["preferenceOptimizationSpec","trainingDatasetUri"],c)}let l=d(n,["config","method"]);if(l===void 0&&(l="SUPERVISED_FINE_TUNING"),l==="SUPERVISED_FINE_TUNING"){const c=d(t,["vertexDatasetResource"]);e!==void 0&&c!=null&&h(e,["supervisedTuningSpec","trainingDatasetUri"],c)}else if(l==="PREFERENCE_TUNING"){const c=d(t,["vertexDatasetResource"]);e!==void 0&&c!=null&&h(e,["preferenceOptimizationSpec","trainingDatasetUri"],c)}if(d(t,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return a}function z_(t,e){const n={},a=d(t,["sdkHttpResponse"]);a!=null&&h(n,["sdkHttpResponse"],a);const r=d(t,["name"]);r!=null&&h(n,["name"],r);const l=d(t,["state"]);l!=null&&h(n,["state"],w_(l));const c=d(t,["createTime"]);c!=null&&h(n,["createTime"],c);const f=d(t,["tuningTask","startTime"]);f!=null&&h(n,["startTime"],f);const y=d(t,["tuningTask","completeTime"]);y!=null&&h(n,["endTime"],y);const p=d(t,["updateTime"]);p!=null&&h(n,["updateTime"],p);const m=d(t,["description"]);m!=null&&h(n,["description"],m);const v=d(t,["baseModel"]);v!=null&&h(n,["baseModel"],v);const _=d(t,["_self"]);return _!=null&&h(n,["tunedModel"],iM(_)),n}function Ef(t,e){const n={},a=d(t,["sdkHttpResponse"]);a!=null&&h(n,["sdkHttpResponse"],a);const r=d(t,["name"]);r!=null&&h(n,["name"],r);const l=d(t,["state"]);l!=null&&h(n,["state"],w_(l));const c=d(t,["createTime"]);c!=null&&h(n,["createTime"],c);const f=d(t,["startTime"]);f!=null&&h(n,["startTime"],f);const y=d(t,["endTime"]);y!=null&&h(n,["endTime"],y);const p=d(t,["updateTime"]);p!=null&&h(n,["updateTime"],p);const m=d(t,["error"]);m!=null&&h(n,["error"],m);const v=d(t,["description"]);v!=null&&h(n,["description"],v);const _=d(t,["baseModel"]);_!=null&&h(n,["baseModel"],_);const x=d(t,["tunedModel"]);x!=null&&h(n,["tunedModel"],x);const w=d(t,["preTunedModel"]);w!=null&&h(n,["preTunedModel"],w);const A=d(t,["supervisedTuningSpec"]);A!=null&&h(n,["supervisedTuningSpec"],A);const C=d(t,["preferenceOptimizationSpec"]);C!=null&&h(n,["preferenceOptimizationSpec"],C);const N=d(t,["tuningDataStats"]);N!=null&&h(n,["tuningDataStats"],N);const I=d(t,["encryptionSpec"]);I!=null&&h(n,["encryptionSpec"],I);const R=d(t,["partnerModelTuningSpec"]);R!=null&&h(n,["partnerModelTuningSpec"],R);const M=d(t,["customBaseModel"]);M!=null&&h(n,["customBaseModel"],M);const z=d(t,["experiment"]);z!=null&&h(n,["experiment"],z);const B=d(t,["labels"]);B!=null&&h(n,["labels"],B);const k=d(t,["outputUri"]);k!=null&&h(n,["outputUri"],k);const W=d(t,["pipelineJob"]);W!=null&&h(n,["pipelineJob"],W);const Y=d(t,["serviceAccount"]);Y!=null&&h(n,["serviceAccount"],Y);const Z=d(t,["tunedModelDisplayName"]);Z!=null&&h(n,["tunedModelDisplayName"],Z);const te=d(t,["veoTuningSpec"]);return te!=null&&h(n,["veoTuningSpec"],te),n}function lM(t,e){const n={},a=d(t,["sdkHttpResponse"]);a!=null&&h(n,["sdkHttpResponse"],a);const r=d(t,["name"]);r!=null&&h(n,["name"],r);const l=d(t,["metadata"]);l!=null&&h(n,["metadata"],l);const c=d(t,["done"]);c!=null&&h(n,["done"],c);const f=d(t,["error"]);return f!=null&&h(n,["error"],f),n}function zv(t,e){const n={},a=d(t,["gcsUri"]);a!=null&&h(n,["validationDatasetUri"],a);const r=d(t,["vertexDatasetResource"]);return r!=null&&h(n,["validationDatasetUri"],r),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class uM extends os{constructor(e){super(),this.apiClient=e,this.get=async n=>await this.getInternal(n),this.list=async(n={})=>new ba(rs.PAGED_ITEM_TUNING_JOBS,a=>this.listInternal(a),await this.listInternal(n),n),this.tune=async n=>{var a;if(this.apiClient.isVertexAI())if(n.baseModel.startsWith("projects/")){const r={tunedModelName:n.baseModel};!((a=n.config)===null||a===void 0)&&a.preTunedModelCheckpointId&&(r.checkpointId=n.config.preTunedModelCheckpointId);const l=Object.assign(Object.assign({},n),{preTunedModel:r});return l.baseModel=void 0,await this.tuneInternal(l)}else{const r=Object.assign({},n);return await this.tuneInternal(r)}else{const r=Object.assign({},n),l=await this.tuneMldevInternal(r);let c="";return l.metadata!==void 0&&l.metadata.tunedModel!==void 0?c=l.metadata.tunedModel:l.name!==void 0&&l.name.includes("/operations/")&&(c=l.name.split("/operations/")[0]),{name:c,state:_f.JOB_STATE_QUEUED}}}}async getInternal(e){var n,a,r,l;let c,f="",y={};if(this.apiClient.isVertexAI()){const p=W1(e);return f=ie("{name}",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(v=>{const _=v;return _.sdkHttpResponse={headers:m.headers},_})),c.then(m=>Ef(m))}else{const p=Q1(e);return f=ie("{name}",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(v=>{const _=v;return _.sdkHttpResponse={headers:m.headers},_})),c.then(m=>z_(m))}}async listInternal(e){var n,a,r,l;let c,f="",y={};if(this.apiClient.isVertexAI()){const p=nM(e);return f=ie("tuningJobs",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(v=>{const _=v;return _.sdkHttpResponse={headers:m.headers},_})),c.then(m=>{const v=aM(m),_=new xv;return Object.assign(_,v),_})}else{const p=tM(e);return f=ie("tunedModels",p._url),y=p._query,delete p._url,delete p._query,c=this.apiClient.request({path:f,queryParams:y,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(v=>{const _=v;return _.sdkHttpResponse={headers:m.headers},_})),c.then(m=>{const v=sM(m),_=new xv;return Object.assign(_,v),_})}}async cancel(e){var n,a,r,l;let c="",f={};if(this.apiClient.isVertexAI()){const y=Y1(e);c=ie("{name}:cancel",y._url),f=y._query,delete y._url,delete y._query,await this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(y),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal})}else{const y=$1(e);c=ie("{name}:cancel",y._url),f=y._query,delete y._url,delete y._query,await this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(y),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal})}}async tuneInternal(e){var n,a;let r,l="",c={};if(this.apiClient.isVertexAI()){const f=X1(e,e);return l=ie("tuningJobs",f._url),c=f._query,delete f._url,delete f._query,r=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(y=>y.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:y.headers},m})),r.then(y=>Ef(y))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var n,a;let r,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const f=j1(e);return l=ie("tunedModels",f._url),c=f._query,delete f._url,delete f._query,r=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(y=>y.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:y.headers},m})),r.then(y=>lM(y))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class cM{async download(e,n){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const dM=1024*1024*8,fM=3,pM=1e3,mM=2,Xl="x-goog-upload-status";async function hM(t,e,n){var a;const r=await $_(t,e,n),l=await(r==null?void 0:r.json());if(((a=r==null?void 0:r.headers)===null||a===void 0?void 0:a[Xl])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return l.file}async function gM(t,e,n){var a;const r=await $_(t,e,n),l=await(r==null?void 0:r.json());if(((a=r==null?void 0:r.headers)===null||a===void 0?void 0:a[Xl])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const c=S_(l),f=new rp;return Object.assign(f,c),f}async function $_(t,e,n){var a,r;let l=0,c=0,f=new Tf(new Response),y="upload";for(l=t.size;c<l;){const p=Math.min(dM,l-c),m=t.slice(c,c+p);c+p>=l&&(y+=", finalize");let v=0,_=pM;for(;v<fM&&(f=await n.request({path:"",body:m,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":y,"X-Goog-Upload-Offset":String(c),"Content-Length":String(p)}}}),!(!((a=f==null?void 0:f.headers)===null||a===void 0)&&a[Xl]));)v++,await vM(_),_=_*mM;if(c+=p,((r=f==null?void 0:f.headers)===null||r===void 0?void 0:r[Xl])!=="active")break;if(l<=c)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return f}async function yM(t){return{size:t.size,type:t.type}}function vM(t){return new Promise(e=>setTimeout(e,t))}class SM{async upload(e,n,a){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await hM(e,n,a)}async uploadToFileSearchStore(e,n,a){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await gM(e,n,a)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await yM(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class _M{create(e,n,a){return new TM(e,n,a)}}class TM{constructor(e,n,a){this.url=e,this.headers=n,this.callbacks=a}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const $v="x-goog-api-key";class bM{constructor(e){this.apiKey=e}async addAuthHeaders(e,n){if(e.get($v)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append($v,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const xM="gl-node/";class AM{constructor(e){var n;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(n=e.vertexai)!==null&&n!==void 0?n:!1,this.apiKey=e.apiKey;const a=mC(e.httpOptions,e.vertexai,void 0,void 0);a&&(e.httpOptions?e.httpOptions.baseUrl=a:e.httpOptions={baseUrl:a}),this.apiVersion=e.apiVersion;const r=new bM(this.apiKey);this.apiClient=new HR({auth:r,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:xM+"web",uploader:new SM,downloader:new cM}),this.models=new i1(this.apiClient),this.live=new ZR(this.apiClient,r,new _M),this.batches=new BE(this.apiClient),this.chats=new yN(this.models,this.apiClient),this.caches=new mN(this.apiClient),this.files=new EN(this.apiClient),this.operations=new r1(this.apiClient),this.authTokens=new T1(this.apiClient),this.tunings=new uM(this.apiClient),this.fileSearchStores=new z1(this.apiClient)}}const Nf="RFC3986",If={RFC1738:t=>String(t).replace(/%20/g,"+"),RFC3986:t=>String(t)},wM="RFC1738",CM=Array.isArray,Dn=(()=>{const t=[];for(let e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t})(),Qd=1024,EM=(t,e,n,a,r)=>{if(t.length===0)return t;let l=t;if(typeof t=="symbol"?l=Symbol.prototype.toString.call(t):typeof t!="string"&&(l=String(t)),n==="iso-8859-1")return escape(l).replace(/%u[0-9a-f]{4}/gi,function(f){return"%26%23"+parseInt(f.slice(2),16)+"%3B"});let c="";for(let f=0;f<l.length;f+=Qd){const y=l.length>=Qd?l.slice(f,f+Qd):l,p=[];for(let m=0;m<y.length;++m){let v=y.charCodeAt(m);if(v===45||v===46||v===95||v===126||v>=48&&v<=57||v>=65&&v<=90||v>=97&&v<=122||r===wM&&(v===40||v===41)){p[p.length]=y.charAt(m);continue}if(v<128){p[p.length]=Dn[v];continue}if(v<2048){p[p.length]=Dn[192|v>>6]+Dn[128|v&63];continue}if(v<55296||v>=57344){p[p.length]=Dn[224|v>>12]+Dn[128|v>>6&63]+Dn[128|v&63];continue}m+=1,v=65536+((v&1023)<<10|y.charCodeAt(m)&1023),p[p.length]=Dn[240|v>>18]+Dn[128|v>>12&63]+Dn[128|v>>6&63]+Dn[128|v&63]}c+=p.join("")}return c};function NM(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))}function Yv(t,e){if(CM(t)){const n=[];for(let a=0;a<t.length;a+=1)n.push(e(t[a]));return n}return e(t)}const IM=Object.prototype.hasOwnProperty,Y_={brackets(t){return String(t)+"[]"},comma:"comma",indices(t,e){return String(t)+"["+e+"]"},repeat(t){return String(t)}},Pn=Array.isArray,RM=Array.prototype.push,J_=function(t,e){RM.apply(t,Pn(e)?e:[e])},MM=Date.prototype.toISOString,ht={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:EM,encodeValuesOnly:!1,format:Nf,formatter:If[Nf],indices:!1,serializeDate(t){return MM.call(t)},skipNulls:!1,strictNullHandling:!1};function DM(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"}const Wd={};function K_(t,e,n,a,r,l,c,f,y,p,m,v,_,x,w,A,C,N){let I=t,R=N,M=0,z=!1;for(;(R=R.get(Wd))!==void 0&&!z;){const Z=R.get(t);if(M+=1,typeof Z<"u"){if(Z===M)throw new RangeError("Cyclic object value");z=!0}typeof R.get(Wd)>"u"&&(M=0)}if(typeof p=="function"?I=p(e,I):I instanceof Date?I=_==null?void 0:_(I):n==="comma"&&Pn(I)&&(I=Yv(I,function(Z){return Z instanceof Date?_==null?void 0:_(Z):Z})),I===null){if(l)return y&&!A?y(e,ht.encoder,C,"key",x):e;I=""}if(DM(I)||NM(I)){if(y){const Z=A?e:y(e,ht.encoder,C,"key",x);return[(w==null?void 0:w(Z))+"="+(w==null?void 0:w(y(I,ht.encoder,C,"value",x)))]}return[(w==null?void 0:w(e))+"="+(w==null?void 0:w(String(I)))]}const B=[];if(typeof I>"u")return B;let k;if(n==="comma"&&Pn(I))A&&y&&(I=Yv(I,y)),k=[{value:I.length>0?I.join(",")||null:void 0}];else if(Pn(p))k=p;else{const Z=Object.keys(I);k=m?Z.sort(m):Z}const W=f?String(e).replace(/\./g,"%2E"):String(e),Y=a&&Pn(I)&&I.length===1?W+"[]":W;if(r&&Pn(I)&&I.length===0)return Y+"[]";for(let Z=0;Z<k.length;++Z){const te=k[Z],L=typeof te=="object"&&typeof te.value<"u"?te.value:I[te];if(c&&L===null)continue;const ne=v&&f?te.replace(/\./g,"%2E"):te,fe=Pn(I)?typeof n=="function"?n(Y,ne):Y:Y+(v?"."+ne:"["+ne+"]");N.set(t,M);const ae=new WeakMap;ae.set(Wd,N),J_(B,K_(L,fe,n,a,r,l,c,f,n==="comma"&&A&&Pn(I)?null:y,p,m,v,_,x,w,A,C,ae))}return B}function PM(t=ht){if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.encodeDotInKeys<"u"&&typeof t.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=t.charset||ht.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=Nf;if(typeof t.format<"u"){if(!IM.call(If,t.format))throw new TypeError("Unknown format option provided.");n=t.format}const a=If[n];let r=ht.filter;(typeof t.filter=="function"||Pn(t.filter))&&(r=t.filter);let l;if(t.arrayFormat&&t.arrayFormat in Y_?l=t.arrayFormat:"indices"in t?l=t.indices?"indices":"repeat":l=ht.arrayFormat,"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const c=typeof t.allowDots>"u"?t.encodeDotInKeys?!0:ht.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:ht.addQueryPrefix,allowDots:c,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:ht.allowEmptyArrays,arrayFormat:l,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:ht.charsetSentinel,commaRoundTrip:!!t.commaRoundTrip,delimiter:typeof t.delimiter>"u"?ht.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:ht.encode,encodeDotInKeys:typeof t.encodeDotInKeys=="boolean"?t.encodeDotInKeys:ht.encodeDotInKeys,encoder:typeof t.encoder=="function"?t.encoder:ht.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:ht.encodeValuesOnly,filter:r,format:n,formatter:a,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:ht.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:ht.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:ht.strictNullHandling}}function LM(t,e={}){let n=t;const a=PM(e);let r,l;typeof a.filter=="function"?(l=a.filter,n=l("",n)):Pn(a.filter)&&(l=a.filter,r=l);const c=[];if(typeof n!="object"||n===null)return"";const f=Y_[a.arrayFormat],y=f==="comma"&&a.commaRoundTrip;r||(r=Object.keys(n)),a.sort&&r.sort(a.sort);const p=new WeakMap;for(let _=0;_<r.length;++_){const x=r[_];a.skipNulls&&n[x]===null||J_(c,K_(n[x],x,f,y,a.allowEmptyArrays,a.strictNullHandling,a.skipNulls,a.encodeDotInKeys,a.encode?a.encoder:null,a.filter,a.sort,a.allowDots,a.serializeDate,a.format,a.formatter,a.encodeValuesOnly,a.charset,p))}const m=c.join(a.delimiter);let v=a.addQueryPrefix===!0?"?":"";return a.charsetSentinel&&(a.charset==="iso-8859-1"?v+="utf8=%26%2310003%3B&":v+="utf8=%E2%9C%93&"),m.length>0?v+m:""}const mi="4.104.0";let Jv=!1,Vr,j_,X_,Rf,Q_,W_,Z_,eT,tT;function kM(t,e={auto:!1}){if(Jv)throw new Error(`you must \`import 'openai/shims/${t.kind}'\` before importing anything else from openai`);if(Vr)throw new Error(`can't \`import 'openai/shims/${t.kind}'\` after \`import 'openai/shims/${Vr}'\``);Jv=e.auto,Vr=t.kind,j_=t.fetch,X_=t.FormData,Rf=t.File,Q_=t.ReadableStream,W_=t.getMultipartRequestOptions,Z_=t.getDefaultAgent,eT=t.fileFromPath,tT=t.isFsReadStream}class UM{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function OM({manuallyImported:t}={}){const e=t?"You may need to use polyfills":"Add one of these imports before your first `import  from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let n,a,r,l;try{n=fetch,a=Request,r=Response,l=Headers}catch(c){throw new Error(`this environment is missing the following Web Fetch API type: ${c.message}. ${e}`)}return{kind:"web",fetch:n,Request:a,Response:r,Headers:l,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(c,f)=>({...f,body:new UM(c)}),getDefaultAgent:c=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:c=>!1}}const nT=()=>{Vr||kM(OM(),{auto:!0})};nT();class Se extends Error{}class Et extends Se{constructor(e,n,a,r){super(`${Et.makeMessage(e,n,a)}`),this.status=e,this.headers=r,this.request_id=r==null?void 0:r["x-request-id"],this.error=n;const l=n;this.code=l==null?void 0:l.code,this.param=l==null?void 0:l.param,this.type=l==null?void 0:l.type}static makeMessage(e,n,a){const r=n!=null&&n.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):n?JSON.stringify(n):a;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,n,a,r){if(!e||!r)return new cu({message:a,cause:Df(n)});const l=n==null?void 0:n.error;return e===400?new sT(e,l,a,r):e===401?new aT(e,l,a,r):e===403?new iT(e,l,a,r):e===404?new rT(e,l,a,r):e===409?new oT(e,l,a,r):e===422?new lT(e,l,a,r):e===429?new uT(e,l,a,r):e>=500?new cT(e,l,a,r):new Et(e,l,a,r)}}class hn extends Et{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class cu extends Et{constructor({message:e,cause:n}){super(void 0,void 0,e||"Connection error.",void 0),n&&(this.cause=n)}}class fp extends cu{constructor({message:e}={}){super({message:e??"Request timed out."})}}class sT extends Et{}class aT extends Et{}class iT extends Et{}class rT extends Et{}class oT extends Et{}class lT extends Et{}class uT extends Et{}class cT extends Et{}class dT extends Se{constructor(){super("Could not parse response content as the length limit was reached")}}class fT extends Se{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var wl=function(t,e,n,a,r){if(a==="m")throw new TypeError("Private method is not writable");if(a==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return a==="a"?r.call(t,n):r?r.value=n:e.set(t,n),n},ma=function(t,e,n,a){if(n==="a"&&!a)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!a:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?a:n==="a"?a.call(t):a?a.value:e.get(t)},en;class du{constructor(){en.set(this,void 0),this.buffer=new Uint8Array,wl(this,en,null,"f")}decode(e){if(e==null)return[];const n=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e;let a=new Uint8Array(this.buffer.length+n.length);a.set(this.buffer),a.set(n,this.buffer.length),this.buffer=a;const r=[];let l;for(;(l=qM(this.buffer,ma(this,en,"f")))!=null;){if(l.carriage&&ma(this,en,"f")==null){wl(this,en,l.index,"f");continue}if(ma(this,en,"f")!=null&&(l.index!==ma(this,en,"f")+1||l.carriage)){r.push(this.decodeText(this.buffer.slice(0,ma(this,en,"f")-1))),this.buffer=this.buffer.slice(ma(this,en,"f")),wl(this,en,null,"f");continue}const c=ma(this,en,"f")!==null?l.preceding-1:l.preceding,f=this.decodeText(this.buffer.slice(0,c));r.push(f),this.buffer=this.buffer.slice(l.index),wl(this,en,null,"f")}return r}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new Se(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new Se(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new Se("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}}en=new WeakMap;du.NEWLINE_CHARS=new Set([`
`,"\r"]);du.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function qM(t,e){for(let r=e??0;r<t.length;r++){if(t[r]===10)return{preceding:r,index:r+1,carriage:!1};if(t[r]===13)return{preceding:r,index:r+1,carriage:!0}}return null}function BM(t){for(let a=0;a<t.length-1;a++){if(t[a]===10&&t[a+1]===10||t[a]===13&&t[a+1]===13)return a+2;if(t[a]===13&&t[a+1]===10&&a+3<t.length&&t[a+2]===13&&t[a+3]===10)return a+4}return-1}function pT(t){if(t[Symbol.asyncIterator])return t;const e=t.getReader();return{async next(){try{const n=await e.read();return n!=null&&n.done&&e.releaseLock(),n}catch(n){throw e.releaseLock(),n}},async return(){const n=e.cancel();return e.releaseLock(),await n,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}class kn{constructor(e,n){this.iterator=e,this.controller=n}static fromSSEResponse(e,n){let a=!1;async function*r(){if(a)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");a=!0;let l=!1;try{for await(const c of HM(e,n))if(!l){if(c.data.startsWith("[DONE]")){l=!0;continue}if(c.event===null||c.event.startsWith("response.")||c.event.startsWith("transcript.")){let f;try{f=JSON.parse(c.data)}catch(y){throw console.error("Could not parse message into JSON:",c.data),console.error("From chunk:",c.raw),y}if(f&&f.error)throw new Et(void 0,f.error,void 0,_T(e.headers));yield f}else{let f;try{f=JSON.parse(c.data)}catch(y){throw console.error("Could not parse message into JSON:",c.data),console.error("From chunk:",c.raw),y}if(c.event=="error")throw new Et(void 0,f.error,f.message,void 0);yield{event:c.event,data:f}}}l=!0}catch(c){if(c instanceof Error&&c.name==="AbortError")return;throw c}finally{l||n.abort()}}return new kn(r,n)}static fromReadableStream(e,n){let a=!1;async function*r(){const c=new du,f=pT(e);for await(const y of f)for(const p of c.decode(y))yield p;for(const y of c.flush())yield y}async function*l(){if(a)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");a=!0;let c=!1;try{for await(const f of r())c||f&&(yield JSON.parse(f));c=!0}catch(f){if(f instanceof Error&&f.name==="AbortError")return;throw f}finally{c||n.abort()}}return new kn(l,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],n=[],a=this.iterator(),r=l=>({next:()=>{if(l.length===0){const c=a.next();e.push(c),n.push(c)}return l.shift()}});return[new kn(()=>r(e),this.controller),new kn(()=>r(n),this.controller)]}toReadableStream(){const e=this;let n;const a=new TextEncoder;return new Q_({async start(){n=e[Symbol.asyncIterator]()},async pull(r){try{const{value:l,done:c}=await n.next();if(c)return r.close();const f=a.encode(JSON.stringify(l)+`
`);r.enqueue(f)}catch(l){r.error(l)}},async cancel(){var r;await((r=n.return)==null?void 0:r.call(n))}})}}async function*HM(t,e){if(!t.body)throw e.abort(),new Se("Attempted to iterate over a response with no body");const n=new FM,a=new du,r=pT(t.body);for await(const l of VM(r))for(const c of a.decode(l)){const f=n.decode(c);f&&(yield f)}for(const l of a.flush()){const c=n.decode(l);c&&(yield c)}}async function*VM(t){let e=new Uint8Array;for await(const n of t){if(n==null)continue;const a=n instanceof ArrayBuffer?new Uint8Array(n):typeof n=="string"?new TextEncoder().encode(n):n;let r=new Uint8Array(e.length+a.length);r.set(e),r.set(a,e.length),e=r;let l;for(;(l=BM(e))!==-1;)yield e.slice(0,l),e=e.slice(l)}e.length>0&&(yield e)}class FM{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const l={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],l}if(this.chunks.push(e),e.startsWith(":"))return null;let[n,a,r]=GM(e,":");return r.startsWith(" ")&&(r=r.substring(1)),n==="event"?this.event=r:n==="data"&&this.data.push(r),null}}function GM(t,e){const n=t.indexOf(e);return n!==-1?[t.substring(0,n),e,t.substring(n+e.length)]:[t,"",""]}const mT=t=>t!=null&&typeof t=="object"&&typeof t.url=="string"&&typeof t.blob=="function",hT=t=>t!=null&&typeof t=="object"&&typeof t.name=="string"&&typeof t.lastModified=="number"&&fu(t),fu=t=>t!=null&&typeof t=="object"&&typeof t.size=="number"&&typeof t.type=="string"&&typeof t.text=="function"&&typeof t.slice=="function"&&typeof t.arrayBuffer=="function",zM=t=>hT(t)||mT(t)||tT(t);async function gT(t,e,n){var r;if(t=await t,hT(t))return t;if(mT(t)){const l=await t.blob();e||(e=new URL(t.url).pathname.split(/[\\/]/).pop()??"unknown_file");const c=fu(l)?[await l.arrayBuffer()]:[l];return new Rf(c,e,n)}const a=await $M(t);if(e||(e=JM(t)??"unknown_file"),!(n!=null&&n.type)){const l=(r=a[0])==null?void 0:r.type;typeof l=="string"&&(n={...n,type:l})}return new Rf(a,e,n)}async function $M(t){var n;let e=[];if(typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)e.push(t);else if(fu(t))e.push(await t.arrayBuffer());else if(KM(t))for await(const a of t)e.push(a);else throw new Error(`Unexpected data type: ${typeof t}; constructor: ${(n=t==null?void 0:t.constructor)==null?void 0:n.name}; props: ${YM(t)}`);return e}function YM(t){return`[${Object.getOwnPropertyNames(t).map(n=>`"${n}"`).join(", ")}]`}function JM(t){var e;return Zd(t.name)||Zd(t.filename)||((e=Zd(t.path))==null?void 0:e.split(/[\\/]/).pop())}const Zd=t=>{if(typeof t=="string")return t;if(typeof Buffer<"u"&&t instanceof Buffer)return String(t)},KM=t=>t!=null&&typeof t=="object"&&typeof t[Symbol.asyncIterator]=="function",Kv=t=>t&&typeof t=="object"&&t.body&&t[Symbol.toStringTag]==="MultipartBody",Ta=async t=>{const e=await jM(t.body);return W_(e,t)},jM=async t=>{const e=new X_;return await Promise.all(Object.entries(t||{}).map(([n,a])=>Mf(e,n,a))),e},Mf=async(t,e,n)=>{if(n!==void 0){if(n==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")t.append(e,String(n));else if(zM(n)){const a=await gT(n);t.append(e,a)}else if(Array.isArray(n))await Promise.all(n.map(a=>Mf(t,e+"[]",a)));else if(typeof n=="object")await Promise.all(Object.entries(n).map(([a,r])=>Mf(t,`${e}[${a}]`,r)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`)}};var Ai={},XM=function(t,e,n,a,r){if(typeof e=="function"?t!==e||!0:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,n),n},QM=function(t,e,n,a){if(typeof e=="function"?t!==e||!a:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?a:n==="a"?a.call(t):a?a.value:e.get(t)},Cl;nT();async function yT(t){var c;const{response:e}=t;if(t.options.stream)return Bs("response",e.status,e.url,e.headers,e.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(e,t.controller):kn.fromSSEResponse(e,t.controller);if(e.status===204)return null;if(t.options.__binaryResponse)return e;const n=e.headers.get("content-type"),a=(c=n==null?void 0:n.split(";")[0])==null?void 0:c.trim();if((a==null?void 0:a.includes("application/json"))||(a==null?void 0:a.endsWith("+json"))){const f=await e.json();return Bs("response",e.status,e.url,e.headers,f),vT(f,e)}const l=await e.text();return Bs("response",e.status,e.url,e.headers,l),l}function vT(t,e){return!t||typeof t!="object"||Array.isArray(t)?t:Object.defineProperty(t,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}class pu extends Promise{constructor(e,n=yT){super(a=>{a(null)}),this.responsePromise=e,this.parseResponse=n}_thenUnwrap(e){return new pu(this.responsePromise,async n=>vT(e(await this.parseResponse(n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,n]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:n,request_id:n.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,n){return this.parse().then(e,n)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class WM{constructor({baseURL:e,maxRetries:n=2,timeout:a=6e5,httpAgent:r,fetch:l}){this.baseURL=e,this.maxRetries=ef("maxRetries",n),this.timeout=ef("timeout",a),this.httpAgent=r,this.fetch=l??j_}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...sD(),...this.authHeaders(e)}}validateHeaders(e,n){}defaultIdempotencyKey(){return`stainless-node-retry-${oD()}`}get(e,n){return this.methodRequest("get",e,n)}post(e,n){return this.methodRequest("post",e,n)}patch(e,n){return this.methodRequest("patch",e,n)}put(e,n){return this.methodRequest("put",e,n)}delete(e,n){return this.methodRequest("delete",e,n)}methodRequest(e,n,a){return this.request(Promise.resolve(a).then(async r=>{const l=r&&fu(r==null?void 0:r.body)?new DataView(await r.body.arrayBuffer()):(r==null?void 0:r.body)instanceof DataView?r.body:(r==null?void 0:r.body)instanceof ArrayBuffer?new DataView(r.body):r&&ArrayBuffer.isView(r==null?void 0:r.body)?new DataView(r.body.buffer):r==null?void 0:r.body;return{method:e,path:n,...r,body:l}}))}getAPIList(e,n,a){return this.requestAPIList(n,{method:"get",path:e,...a})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:n=0}={}){var A;const a={...e},{method:r,path:l,query:c,headers:f={}}=a,y=ArrayBuffer.isView(a.body)||a.__binaryRequest&&typeof a.body=="string"?a.body:Kv(a.body)?a.body.body:a.body?JSON.stringify(a.body,null,2):null,p=this.calculateContentLength(y),m=this.buildURL(l,c);"timeout"in a&&ef("timeout",a.timeout),a.timeout=a.timeout??this.timeout;const v=a.httpAgent??this.httpAgent??Z_(m),_=a.timeout+1e3;typeof((A=v==null?void 0:v.options)==null?void 0:A.timeout)=="number"&&_>(v.options.timeout??0)&&(v.options.timeout=_),this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),f[this.idempotencyHeader]=e.idempotencyKey);const x=this.buildHeaders({options:a,headers:f,contentLength:p,retryCount:n});return{req:{method:r,...y&&{body:y},headers:x,...v&&{agent:v},signal:a.signal??null},url:m,timeout:a.timeout}}buildHeaders({options:e,headers:n,contentLength:a,retryCount:r}){const l={};a&&(l["content-length"]=a);const c=this.defaultHeaders(e);return Wv(l,c),Wv(l,n),Kv(e.body)&&Vr!=="node"&&delete l["content-type"],Nl(c,"x-stainless-retry-count")===void 0&&Nl(n,"x-stainless-retry-count")===void 0&&(l["x-stainless-retry-count"]=String(r)),Nl(c,"x-stainless-timeout")===void 0&&Nl(n,"x-stainless-timeout")===void 0&&e.timeout&&(l["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(l,n),l}async prepareOptions(e){}async prepareRequest(e,{url:n,options:a}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(n=>[...n])):{...e}:{}}makeStatusError(e,n,a,r){return Et.generate(e,n,a,r)}request(e,n=null){return new pu(this.makeRequest(e,n))}async makeRequest(e,n){var v,_;const a=await e,r=a.maxRetries??this.maxRetries;n==null&&(n=r),await this.prepareOptions(a);const{req:l,url:c,timeout:f}=this.buildRequest(a,{retryCount:r-n});if(await this.prepareRequest(l,{url:c,options:a}),Bs("request",c,a,l.headers),(v=a.signal)!=null&&v.aborted)throw new hn;const y=new AbortController,p=await this.fetchWithTimeout(c,l,f,y).catch(Df);if(p instanceof Error){if((_=a.signal)!=null&&_.aborted)throw new hn;if(n)return this.retryRequest(a,n);throw p.name==="AbortError"?new fp:new cu({cause:p})}const m=_T(p.headers);if(!p.ok){if(n&&this.shouldRetry(p)){const I=`retrying, ${n} attempts remaining`;return Bs(`response (error; ${I})`,p.status,c,m),this.retryRequest(a,n,m)}const x=await p.text().catch(I=>Df(I).message),w=aD(x),A=w?void 0:x;throw Bs(`response (error; ${n?"(error; no more retries left)":"(error; not retryable)"})`,p.status,c,m,A),this.makeStatusError(p.status,w,A,m)}return{response:p,options:a,controller:y}}requestAPIList(e,n){const a=this.makeRequest(n,null);return new ZM(this,a,e)}buildURL(e,n){const a=rD(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),r=this.defaultQuery();return TT(r)||(n={...r,...n}),typeof n=="object"&&n&&!Array.isArray(n)&&(a.search=this.stringifyQuery(n)),a.toString()}stringifyQuery(e){return Object.entries(e).filter(([n,a])=>typeof a<"u").map(([n,a])=>{if(typeof a=="string"||typeof a=="number"||typeof a=="boolean")return`${encodeURIComponent(n)}=${encodeURIComponent(a)}`;if(a===null)return`${encodeURIComponent(n)}=`;throw new Se(`Cannot stringify type ${typeof a}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,n,a,r){const{signal:l,...c}=n||{};l&&l.addEventListener("abort",()=>r.abort());const f=setTimeout(()=>r.abort(),a),y={signal:r.signal,...c};return y.method&&(y.method=y.method.toUpperCase()),this.fetch.call(void 0,e,y).finally(()=>{clearTimeout(f)})}shouldRetry(e){const n=e.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,n,a){let r;const l=a==null?void 0:a["retry-after-ms"];if(l){const f=parseFloat(l);Number.isNaN(f)||(r=f)}const c=a==null?void 0:a["retry-after"];if(c&&!r){const f=parseFloat(c);Number.isNaN(f)?r=Date.parse(c)-Date.now():r=f*1e3}if(!(r&&0<=r&&r<60*1e3)){const f=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(n,f)}return await Qr(r),this.makeRequest(e,n-1)}calculateDefaultRetryTimeoutMillis(e,n){const l=n-e,c=Math.min(.5*Math.pow(2,l),8),f=1-Math.random()*.25;return c*f*1e3}getUserAgent(){return`${this.constructor.name}/JS ${mi}`}}class ST{constructor(e,n,a,r){Cl.set(this,void 0),XM(this,Cl,e),this.options=r,this.response=n,this.body=a}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new Se("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const n={...this.options};if("params"in e&&typeof n.query=="object")n.query={...n.query,...e.params};else if("url"in e){const a=[...Object.entries(n.query||{}),...e.url.searchParams.entries()];for(const[r,l]of a)e.url.searchParams.set(r,l);n.query=void 0,n.path=e.url.toString()}return await QM(this,Cl,"f").requestAPIList(this.constructor,n)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Cl=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const n of e.getPaginatedItems())yield n}}class ZM extends pu{constructor(e,n,a){super(n,async r=>new a(e,r.response,await yT(r),r.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const n of e)yield n}}const _T=t=>new Proxy(Object.fromEntries(t.entries()),{get(e,n){const a=n.toString();return e[a.toLowerCase()]||e[a]}}),eD={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},et=t=>typeof t=="object"&&t!==null&&!TT(t)&&Object.keys(t).every(e=>bT(eD,e)),tD=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":mi,"X-Stainless-OS":Xv(Deno.build.os),"X-Stainless-Arch":jv(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":mi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":mi,"X-Stainless-OS":Xv(process.platform),"X-Stainless-Arch":jv(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const t=nD();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":mi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":mi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function nD(){if(typeof navigator>"u"||!navigator)return null;const t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:n}of t){const a=n.exec(navigator.userAgent);if(a){const r=a[1]||0,l=a[2]||0,c=a[3]||0;return{browser:e,version:`${r}.${l}.${c}`}}}return null}const jv=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",Xv=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown");let Qv;const sD=()=>Qv??(Qv=tD()),aD=t=>{try{return JSON.parse(t)}catch{return}},iD=/^[a-z][a-z0-9+.-]*:/i,rD=t=>iD.test(t),Qr=t=>new Promise(e=>setTimeout(e,t)),ef=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new Se(`${t} must be an integer`);if(e<0)throw new Se(`${t} must be a positive integer`);return e},Df=t=>{if(t instanceof Error)return t;if(typeof t=="object"&&t!==null)try{return new Error(JSON.stringify(t))}catch{}return new Error(t)},El=t=>{var e,n,a,r;if(typeof process<"u")return((e=Ai==null?void 0:Ai[t])==null?void 0:e.trim())??void 0;if(typeof Deno<"u")return(r=(a=(n=Deno.env)==null?void 0:n.get)==null?void 0:a.call(n,t))==null?void 0:r.trim()};function TT(t){if(!t)return!0;for(const e in t)return!1;return!0}function bT(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Wv(t,e){for(const n in e){if(!bT(e,n))continue;const a=n.toLowerCase();if(!a)continue;const r=e[n];r===null?delete t[a]:r!==void 0&&(t[a]=r)}}const Zv=new Set(["authorization","api-key"]);function Bs(t,...e){if(typeof process<"u"&&(Ai==null?void 0:Ai.DEBUG)==="true"){const n=e.map(a=>{if(!a)return a;if(a.headers){const l={...a,headers:{...a.headers}};for(const c in a.headers)Zv.has(c.toLowerCase())&&(l.headers[c]="REDACTED");return l}let r=null;for(const l in a)Zv.has(l.toLowerCase())&&(r??(r={...a}),r[l]="REDACTED");return r??a});console.log(`OpenAI:DEBUG:${t}`,...n)}}const oD=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),lD=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",uD=t=>typeof(t==null?void 0:t.get)=="function",Nl=(t,e)=>{var a;const n=e.toLowerCase();if(uD(t)){const r=((a=e[0])==null?void 0:a.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(l,c,f)=>c+f.toUpperCase());for(const l of[e,n,e.toUpperCase(),r]){const c=t.get(l);if(c)return c}}for(const[r,l]of Object.entries(t))if(r.toLowerCase()===n)return Array.isArray(l)?(l.length<=1||console.warn(`Received ${l.length} entries for the ${e} header, using the first entry.`),l[0]):l},cD=t=>{if(typeof Buffer<"u"){const e=Buffer.from(t,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{const e=atob(t),n=e.length,a=new Uint8Array(n);for(let r=0;r<n;r++)a[r]=e.charCodeAt(r);return Array.from(new Float32Array(a.buffer))}};function tf(t){return t!=null&&typeof t=="object"&&!Array.isArray(t)}class mu extends ST{constructor(e,n,a,r){super(e,n,a,r),this.data=a.data||[],this.object=a.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class gt extends ST{constructor(e,n,a,r){super(e,n,a,r),this.data=a.data||[],this.has_more=a.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const n=Object.fromEntries(e.url.searchParams);return Object.keys(n).length?n:null}nextPageInfo(){var a;const e=this.getPaginatedItems();if(!e.length)return null;const n=(a=e[e.length-1])==null?void 0:a.id;return n?{params:{after:n}}:null}}class _e{constructor(e){this._client=e}}let xT=class extends _e{list(e,n={},a){return et(n)?this.list(e,{},n):this._client.getAPIList(`/chat/completions/${e}/messages`,dD,{query:n,...a})}},hu=class extends _e{constructor(){super(...arguments),this.messages=new xT(this._client)}create(e,n){return this._client.post("/chat/completions",{body:e,...n,stream:e.stream??!1})}retrieve(e,n){return this._client.get(`/chat/completions/${e}`,n)}update(e,n,a){return this._client.post(`/chat/completions/${e}`,{body:n,...a})}list(e={},n){return et(e)?this.list({},e):this._client.getAPIList("/chat/completions",gu,{query:e,...n})}del(e,n){return this._client.delete(`/chat/completions/${e}`,n)}};class gu extends gt{}class dD extends gt{}hu.ChatCompletionsPage=gu;hu.Messages=xT;let yu=class extends _e{constructor(){super(...arguments),this.completions=new hu(this._client)}};yu.Completions=hu;yu.ChatCompletionsPage=gu;class AT extends _e{create(e,n){return this._client.post("/audio/speech",{body:e,...n,headers:{Accept:"application/octet-stream",...n==null?void 0:n.headers},__binaryResponse:!0})}}class wT extends _e{create(e,n){return this._client.post("/audio/transcriptions",Ta({body:e,...n,stream:e.stream??!1,__metadata:{model:e.model}}))}}class CT extends _e{create(e,n){return this._client.post("/audio/translations",Ta({body:e,...n,__metadata:{model:e.model}}))}}class Wr extends _e{constructor(){super(...arguments),this.transcriptions=new wT(this._client),this.translations=new CT(this._client),this.speech=new AT(this._client)}}Wr.Transcriptions=wT;Wr.Translations=CT;Wr.Speech=AT;class pp extends _e{create(e,n){return this._client.post("/batches",{body:e,...n})}retrieve(e,n){return this._client.get(`/batches/${e}`,n)}list(e={},n){return et(e)?this.list({},e):this._client.getAPIList("/batches",mp,{query:e,...n})}cancel(e,n){return this._client.post(`/batches/${e}/cancel`,n)}}class mp extends gt{}pp.BatchesPage=mp;var _n=function(t,e,n,a,r){if(a==="m")throw new TypeError("Private method is not writable");if(a==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return a==="a"?r.call(t,n):r?r.value=n:e.set(t,n),n},Ze=function(t,e,n,a){if(n==="a"&&!a)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!a:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?a:n==="a"?a.call(t):a?a.value:e.get(t)},Pf,Ol,ql,Pr,Lr,Bl,kr,ns,Ur,Ql,Wl,hi,ET;class hp{constructor(){Pf.add(this),this.controller=new AbortController,Ol.set(this,void 0),ql.set(this,()=>{}),Pr.set(this,()=>{}),Lr.set(this,void 0),Bl.set(this,()=>{}),kr.set(this,()=>{}),ns.set(this,{}),Ur.set(this,!1),Ql.set(this,!1),Wl.set(this,!1),hi.set(this,!1),_n(this,Ol,new Promise((e,n)=>{_n(this,ql,e,"f"),_n(this,Pr,n,"f")}),"f"),_n(this,Lr,new Promise((e,n)=>{_n(this,Bl,e,"f"),_n(this,kr,n,"f")}),"f"),Ze(this,Ol,"f").catch(()=>{}),Ze(this,Lr,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},Ze(this,Pf,"m",ET).bind(this))},0)}_connected(){this.ended||(Ze(this,ql,"f").call(this),this._emit("connect"))}get ended(){return Ze(this,Ur,"f")}get errored(){return Ze(this,Ql,"f")}get aborted(){return Ze(this,Wl,"f")}abort(){this.controller.abort()}on(e,n){return(Ze(this,ns,"f")[e]||(Ze(this,ns,"f")[e]=[])).push({listener:n}),this}off(e,n){const a=Ze(this,ns,"f")[e];if(!a)return this;const r=a.findIndex(l=>l.listener===n);return r>=0&&a.splice(r,1),this}once(e,n){return(Ze(this,ns,"f")[e]||(Ze(this,ns,"f")[e]=[])).push({listener:n,once:!0}),this}emitted(e){return new Promise((n,a)=>{_n(this,hi,!0,"f"),e!=="error"&&this.once("error",a),this.once(e,n)})}async done(){_n(this,hi,!0,"f"),await Ze(this,Lr,"f")}_emit(e,...n){if(Ze(this,Ur,"f"))return;e==="end"&&(_n(this,Ur,!0,"f"),Ze(this,Bl,"f").call(this));const a=Ze(this,ns,"f")[e];if(a&&(Ze(this,ns,"f")[e]=a.filter(r=>!r.once),a.forEach(({listener:r})=>r(...n))),e==="abort"){const r=n[0];!Ze(this,hi,"f")&&!(a!=null&&a.length)&&Promise.reject(r),Ze(this,Pr,"f").call(this,r),Ze(this,kr,"f").call(this,r),this._emit("end");return}if(e==="error"){const r=n[0];!Ze(this,hi,"f")&&!(a!=null&&a.length)&&Promise.reject(r),Ze(this,Pr,"f").call(this,r),Ze(this,kr,"f").call(this,r),this._emit("end")}}_emitFinal(){}}Ol=new WeakMap,ql=new WeakMap,Pr=new WeakMap,Lr=new WeakMap,Bl=new WeakMap,kr=new WeakMap,ns=new WeakMap,Ur=new WeakMap,Ql=new WeakMap,Wl=new WeakMap,hi=new WeakMap,Pf=new WeakSet,ET=function(e){if(_n(this,Ql,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new hn),e instanceof hn)return _n(this,Wl,!0,"f"),this._emit("abort",e);if(e instanceof Se)return this._emit("error",e);if(e instanceof Error){const n=new Se(e.message);return n.cause=e,this._emit("error",n)}return this._emit("error",new Se(String(e)))};var pe=function(t,e,n,a){if(n==="a"&&!a)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!a:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?a:n==="a"?a.call(t):a?a.value:e.get(t)},Zt=function(t,e,n,a,r){if(a==="m")throw new TypeError("Private method is not writable");if(a==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return a==="a"?r.call(t,n):r?r.value=n:e.set(t,n),n},Ct,Lf,Ln,Hl,Tn,va,vi,ya,Zl,tn,Vl,Fl,Fr,Or,qr,eS,tS,nS,sS,aS,iS,rS;class xn extends hp{constructor(){super(...arguments),Ct.add(this),Lf.set(this,[]),Ln.set(this,{}),Hl.set(this,{}),Tn.set(this,void 0),va.set(this,void 0),vi.set(this,void 0),ya.set(this,void 0),Zl.set(this,void 0),tn.set(this,void 0),Vl.set(this,void 0),Fl.set(this,void 0),Fr.set(this,void 0)}[(Lf=new WeakMap,Ln=new WeakMap,Hl=new WeakMap,Tn=new WeakMap,va=new WeakMap,vi=new WeakMap,ya=new WeakMap,Zl=new WeakMap,tn=new WeakMap,Vl=new WeakMap,Fl=new WeakMap,Fr=new WeakMap,Ct=new WeakSet,Symbol.asyncIterator)](){const e=[],n=[];let a=!1;return this.on("event",r=>{const l=n.shift();l?l.resolve(r):e.push(r)}),this.on("end",()=>{a=!0;for(const r of n)r.resolve(void 0);n.length=0}),this.on("abort",r=>{a=!0;for(const l of n)l.reject(r);n.length=0}),this.on("error",r=>{a=!0;for(const l of n)l.reject(r);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:a?{value:void 0,done:!0}:new Promise((l,c)=>n.push({resolve:l,reject:c})).then(l=>l?{value:l,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const n=new xn;return n._run(()=>n._fromReadableStream(e)),n}async _fromReadableStream(e,n){var l;const a=n==null?void 0:n.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),this._connected();const r=kn.fromReadableStream(e,this.controller);for await(const c of r)pe(this,Ct,"m",Or).call(this,c);if((l=r.controller.signal)!=null&&l.aborted)throw new hn;return this._addRun(pe(this,Ct,"m",qr).call(this))}toReadableStream(){return new kn(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,n,a,r,l){const c=new xn;return c._run(()=>c._runToolAssistantStream(e,n,a,r,{...l,headers:{...l==null?void 0:l.headers,"X-Stainless-Helper-Method":"stream"}})),c}async _createToolAssistantStream(e,n,a,r,l){var p;const c=l==null?void 0:l.signal;c&&(c.aborted&&this.controller.abort(),c.addEventListener("abort",()=>this.controller.abort()));const f={...r,stream:!0},y=await e.submitToolOutputs(n,a,f,{...l,signal:this.controller.signal});this._connected();for await(const m of y)pe(this,Ct,"m",Or).call(this,m);if((p=y.controller.signal)!=null&&p.aborted)throw new hn;return this._addRun(pe(this,Ct,"m",qr).call(this))}static createThreadAssistantStream(e,n,a){const r=new xn;return r._run(()=>r._threadAssistantStream(e,n,{...a,headers:{...a==null?void 0:a.headers,"X-Stainless-Helper-Method":"stream"}})),r}static createAssistantStream(e,n,a,r){const l=new xn;return l._run(()=>l._runAssistantStream(e,n,a,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),l}currentEvent(){return pe(this,Vl,"f")}currentRun(){return pe(this,Fl,"f")}currentMessageSnapshot(){return pe(this,Tn,"f")}currentRunStepSnapshot(){return pe(this,Fr,"f")}async finalRunSteps(){return await this.done(),Object.values(pe(this,Ln,"f"))}async finalMessages(){return await this.done(),Object.values(pe(this,Hl,"f"))}async finalRun(){if(await this.done(),!pe(this,va,"f"))throw Error("Final run was not received.");return pe(this,va,"f")}async _createThreadAssistantStream(e,n,a){var f;const r=a==null?void 0:a.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const l={...n,stream:!0},c=await e.createAndRun(l,{...a,signal:this.controller.signal});this._connected();for await(const y of c)pe(this,Ct,"m",Or).call(this,y);if((f=c.controller.signal)!=null&&f.aborted)throw new hn;return this._addRun(pe(this,Ct,"m",qr).call(this))}async _createAssistantStream(e,n,a,r){var y;const l=r==null?void 0:r.signal;l&&(l.aborted&&this.controller.abort(),l.addEventListener("abort",()=>this.controller.abort()));const c={...a,stream:!0},f=await e.create(n,c,{...r,signal:this.controller.signal});this._connected();for await(const p of f)pe(this,Ct,"m",Or).call(this,p);if((y=f.controller.signal)!=null&&y.aborted)throw new hn;return this._addRun(pe(this,Ct,"m",qr).call(this))}static accumulateDelta(e,n){for(const[a,r]of Object.entries(n)){if(!e.hasOwnProperty(a)){e[a]=r;continue}let l=e[a];if(l==null){e[a]=r;continue}if(a==="index"||a==="type"){e[a]=r;continue}if(typeof l=="string"&&typeof r=="string")l+=r;else if(typeof l=="number"&&typeof r=="number")l+=r;else if(tf(l)&&tf(r))l=this.accumulateDelta(l,r);else if(Array.isArray(l)&&Array.isArray(r)){if(l.every(c=>typeof c=="string"||typeof c=="number")){l.push(...r);continue}for(const c of r){if(!tf(c))throw new Error(`Expected array delta entry to be an object but got: ${c}`);const f=c.index;if(f==null)throw console.error(c),new Error("Expected array delta entry to have an `index` property");if(typeof f!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${f}`);const y=l[f];y==null?l.push(c):l[f]=this.accumulateDelta(y,c)}continue}else throw Error(`Unhandled record type: ${a}, deltaValue: ${r}, accValue: ${l}`);e[a]=l}return e}_addRun(e){return e}async _threadAssistantStream(e,n,a){return await this._createThreadAssistantStream(n,e,a)}async _runAssistantStream(e,n,a,r){return await this._createAssistantStream(n,e,a,r)}async _runToolAssistantStream(e,n,a,r,l){return await this._createToolAssistantStream(a,e,n,r,l)}}Or=function(e){if(!this.ended)switch(Zt(this,Vl,e,"f"),pe(this,Ct,"m",nS).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":pe(this,Ct,"m",rS).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":pe(this,Ct,"m",tS).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":pe(this,Ct,"m",eS).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},qr=function(){if(this.ended)throw new Se("stream has ended, this shouldn't happen");if(!pe(this,va,"f"))throw Error("Final run has not been received");return pe(this,va,"f")},eS=function(e){const[n,a]=pe(this,Ct,"m",aS).call(this,e,pe(this,Tn,"f"));Zt(this,Tn,n,"f"),pe(this,Hl,"f")[n.id]=n;for(const r of a){const l=n.content[r.index];(l==null?void 0:l.type)=="text"&&this._emit("textCreated",l.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,n),e.data.delta.content)for(const r of e.data.delta.content){if(r.type=="text"&&r.text){let l=r.text,c=n.content[r.index];if(c&&c.type=="text")this._emit("textDelta",l,c.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(r.index!=pe(this,vi,"f")){if(pe(this,ya,"f"))switch(pe(this,ya,"f").type){case"text":this._emit("textDone",pe(this,ya,"f").text,pe(this,Tn,"f"));break;case"image_file":this._emit("imageFileDone",pe(this,ya,"f").image_file,pe(this,Tn,"f"));break}Zt(this,vi,r.index,"f")}Zt(this,ya,n.content[r.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(pe(this,vi,"f")!==void 0){const r=e.data.content[pe(this,vi,"f")];if(r)switch(r.type){case"image_file":this._emit("imageFileDone",r.image_file,pe(this,Tn,"f"));break;case"text":this._emit("textDone",r.text,pe(this,Tn,"f"));break}}pe(this,Tn,"f")&&this._emit("messageDone",e.data),Zt(this,Tn,void 0,"f")}},tS=function(e){const n=pe(this,Ct,"m",sS).call(this,e);switch(Zt(this,Fr,n,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const a=e.data.delta;if(a.step_details&&a.step_details.type=="tool_calls"&&a.step_details.tool_calls&&n.step_details.type=="tool_calls")for(const l of a.step_details.tool_calls)l.index==pe(this,Zl,"f")?this._emit("toolCallDelta",l,n.step_details.tool_calls[l.index]):(pe(this,tn,"f")&&this._emit("toolCallDone",pe(this,tn,"f")),Zt(this,Zl,l.index,"f"),Zt(this,tn,n.step_details.tool_calls[l.index],"f"),pe(this,tn,"f")&&this._emit("toolCallCreated",pe(this,tn,"f")));this._emit("runStepDelta",e.data.delta,n);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Zt(this,Fr,void 0,"f"),e.data.step_details.type=="tool_calls"&&pe(this,tn,"f")&&(this._emit("toolCallDone",pe(this,tn,"f")),Zt(this,tn,void 0,"f")),this._emit("runStepDone",e.data,n);break}},nS=function(e){pe(this,Lf,"f").push(e),this._emit("event",e)},sS=function(e){switch(e.event){case"thread.run.step.created":return pe(this,Ln,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let n=pe(this,Ln,"f")[e.data.id];if(!n)throw Error("Received a RunStepDelta before creation of a snapshot");let a=e.data;if(a.delta){const r=xn.accumulateDelta(n,a.delta);pe(this,Ln,"f")[e.data.id]=r}return pe(this,Ln,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":pe(this,Ln,"f")[e.data.id]=e.data;break}if(pe(this,Ln,"f")[e.data.id])return pe(this,Ln,"f")[e.data.id];throw new Error("No snapshot available")},aS=function(e,n){let a=[];switch(e.event){case"thread.message.created":return[e.data,a];case"thread.message.delta":if(!n)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let r=e.data;if(r.delta.content)for(const l of r.delta.content)if(l.index in n.content){let c=n.content[l.index];n.content[l.index]=pe(this,Ct,"m",iS).call(this,l,c)}else n.content[l.index]=l,a.push(l);return[n,a];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(n)return[n,a];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},iS=function(e,n){return xn.accumulateDelta(n,e)},rS=function(e){switch(Zt(this,Fl,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":Zt(this,va,e.data,"f"),pe(this,tn,"f")&&(this._emit("toolCallDone",pe(this,tn,"f")),Zt(this,tn,void 0,"f"));break}};class gp extends _e{create(e,n){return this._client.post("/assistants",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,n){return this._client.get(`/assistants/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,n,a){return this._client.post(`/assistants/${e}`,{body:n,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}list(e={},n){return et(e)?this.list({},e):this._client.getAPIList("/assistants",yp,{query:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,n){return this._client.delete(`/assistants/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class yp extends gt{}gp.AssistantsPage=yp;function oS(t){return typeof t.parse=="function"}const wi=t=>(t==null?void 0:t.role)==="assistant",NT=t=>(t==null?void 0:t.role)==="function",IT=t=>(t==null?void 0:t.role)==="tool";function vp(t){return(t==null?void 0:t.$brand)==="auto-parseable-response-format"}function Zr(t){return(t==null?void 0:t.$brand)==="auto-parseable-tool"}function fD(t,e){return!e||!RT(e)?{...t,choices:t.choices.map(n=>({...n,message:{...n.message,parsed:null,...n.message.tool_calls?{tool_calls:n.message.tool_calls}:void 0}}))}:Sp(t,e)}function Sp(t,e){const n=t.choices.map(a=>{var r;if(a.finish_reason==="length")throw new dT;if(a.finish_reason==="content_filter")throw new fT;return{...a,message:{...a.message,...a.message.tool_calls?{tool_calls:((r=a.message.tool_calls)==null?void 0:r.map(l=>mD(e,l)))??void 0}:void 0,parsed:a.message.content&&!a.message.refusal?pD(e,a.message.content):null}}});return{...t,choices:n}}function pD(t,e){var n,a;return((n=t.response_format)==null?void 0:n.type)!=="json_schema"?null:((a=t.response_format)==null?void 0:a.type)==="json_schema"?"$parseRaw"in t.response_format?t.response_format.$parseRaw(e):JSON.parse(e):null}function mD(t,e){var a;const n=(a=t.tools)==null?void 0:a.find(r=>{var l;return((l=r.function)==null?void 0:l.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:Zr(n)?n.$parseRaw(e.function.arguments):n!=null&&n.function.strict?JSON.parse(e.function.arguments):null}}}function hD(t,e){var a;if(!t)return!1;const n=(a=t.tools)==null?void 0:a.find(r=>{var l;return((l=r.function)==null?void 0:l.name)===e.function.name});return Zr(n)||(n==null?void 0:n.function.strict)||!1}function RT(t){var e;return vp(t.response_format)?!0:((e=t.tools)==null?void 0:e.some(n=>Zr(n)||n.type==="function"&&n.function.strict===!0))??!1}function gD(t){for(const e of t??[]){if(e.type!=="function")throw new Se(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new Se(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var zt=function(t,e,n,a){if(n==="a"&&!a)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!a:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?a:n==="a"?a.call(t):a?a.value:e.get(t)},Rt,kf,eu,Uf,Of,qf,MT,Bf;const lS=10;class DT extends hp{constructor(){super(...arguments),Rt.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var a;this._chatCompletions.push(e),this._emit("chatCompletion",e);const n=(a=e.choices[0])==null?void 0:a.message;return n&&this._addMessage(n),e}_addMessage(e,n=!0){if("content"in e||(e.content=null),this.messages.push(e),n){if(this._emit("message",e),(NT(e)||IT(e))&&e.content)this._emit("functionCallResult",e.content);else if(wi(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(wi(e)&&e.tool_calls)for(const a of e.tool_calls)a.type==="function"&&this._emit("functionCall",a.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new Se("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),zt(this,Rt,"m",kf).call(this)}async finalMessage(){return await this.done(),zt(this,Rt,"m",eu).call(this)}async finalFunctionCall(){return await this.done(),zt(this,Rt,"m",Uf).call(this)}async finalFunctionCallResult(){return await this.done(),zt(this,Rt,"m",Of).call(this)}async totalUsage(){return await this.done(),zt(this,Rt,"m",qf).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const n=zt(this,Rt,"m",eu).call(this);n&&this._emit("finalMessage",n);const a=zt(this,Rt,"m",kf).call(this);a&&this._emit("finalContent",a);const r=zt(this,Rt,"m",Uf).call(this);r&&this._emit("finalFunctionCall",r);const l=zt(this,Rt,"m",Of).call(this);l!=null&&this._emit("finalFunctionCallResult",l),this._chatCompletions.some(c=>c.usage)&&this._emit("totalUsage",zt(this,Rt,"m",qf).call(this))}async _createChatCompletion(e,n,a){const r=a==null?void 0:a.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),zt(this,Rt,"m",MT).call(this,n);const l=await e.chat.completions.create({...n,stream:!1},{...a,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Sp(l,n))}async _runChatCompletion(e,n,a){for(const r of n.messages)this._addMessage(r,!1);return await this._createChatCompletion(e,n,a)}async _runFunctions(e,n,a){var _;const r="function",{function_call:l="auto",stream:c,...f}=n,y=typeof l!="string"&&(l==null?void 0:l.name),{maxChatCompletions:p=lS}=a||{},m={};for(const x of n.functions)m[x.name||x.function.name]=x;const v=n.functions.map(x=>({name:x.name||x.function.name,parameters:x.parameters,description:x.description}));for(const x of n.messages)this._addMessage(x,!1);for(let x=0;x<p;++x){const A=(_=(await this._createChatCompletion(e,{...f,function_call:l,functions:v,messages:[...this.messages]},a)).choices[0])==null?void 0:_.message;if(!A)throw new Se("missing message in ChatCompletion response");if(!A.function_call)return;const{name:C,arguments:N}=A.function_call,I=m[C];if(I){if(y&&y!==C){const B=`Invalid function_call: ${JSON.stringify(C)}. ${JSON.stringify(y)} requested. Please try again`;this._addMessage({role:r,name:C,content:B});continue}}else{const B=`Invalid function_call: ${JSON.stringify(C)}. Available options are: ${v.map(k=>JSON.stringify(k.name)).join(", ")}. Please try again`;this._addMessage({role:r,name:C,content:B});continue}let R;try{R=oS(I)?await I.parse(N):N}catch(B){this._addMessage({role:r,name:C,content:B instanceof Error?B.message:String(B)});continue}const M=await I.function(R,this),z=zt(this,Rt,"m",Bf).call(this,M);if(this._addMessage({role:r,name:C,content:z}),y)return}}async _runTools(e,n,a){var x,w,A;const r="tool",{tool_choice:l="auto",stream:c,...f}=n,y=typeof l!="string"&&((x=l==null?void 0:l.function)==null?void 0:x.name),{maxChatCompletions:p=lS}=a||{},m=n.tools.map(C=>{if(Zr(C)){if(!C.$callback)throw new Se("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:C.$callback,name:C.function.name,description:C.function.description||"",parameters:C.function.parameters,parse:C.$parseRaw,strict:!0}}}return C}),v={};for(const C of m)C.type==="function"&&(v[C.function.name||C.function.function.name]=C.function);const _="tools"in n?m.map(C=>C.type==="function"?{type:"function",function:{name:C.function.name||C.function.function.name,parameters:C.function.parameters,description:C.function.description,strict:C.function.strict}}:C):void 0;for(const C of n.messages)this._addMessage(C,!1);for(let C=0;C<p;++C){const I=(w=(await this._createChatCompletion(e,{...f,tool_choice:l,tools:_,messages:[...this.messages]},a)).choices[0])==null?void 0:w.message;if(!I)throw new Se("missing message in ChatCompletion response");if(!((A=I.tool_calls)!=null&&A.length))return;for(const R of I.tool_calls){if(R.type!=="function")continue;const M=R.id,{name:z,arguments:B}=R.function,k=v[z];if(k){if(y&&y!==z){const te=`Invalid tool_call: ${JSON.stringify(z)}. ${JSON.stringify(y)} requested. Please try again`;this._addMessage({role:r,tool_call_id:M,content:te});continue}}else{const te=`Invalid tool_call: ${JSON.stringify(z)}. Available options are: ${Object.keys(v).map(L=>JSON.stringify(L)).join(", ")}. Please try again`;this._addMessage({role:r,tool_call_id:M,content:te});continue}let W;try{W=oS(k)?await k.parse(B):B}catch(te){const L=te instanceof Error?te.message:String(te);this._addMessage({role:r,tool_call_id:M,content:L});continue}const Y=await k.function(W,this),Z=zt(this,Rt,"m",Bf).call(this,Y);if(this._addMessage({role:r,tool_call_id:M,content:Z}),y)return}}}}Rt=new WeakSet,kf=function(){return zt(this,Rt,"m",eu).call(this).content??null},eu=function(){let e=this.messages.length;for(;e-- >0;){const n=this.messages[e];if(wi(n)){const{function_call:a,...r}=n,l={...r,content:n.content??null,refusal:n.refusal??null};return a&&(l.function_call=a),l}}throw new Se("stream ended without producing a ChatCompletionMessage with role=assistant")},Uf=function(){var e,n;for(let a=this.messages.length-1;a>=0;a--){const r=this.messages[a];if(wi(r)&&(r!=null&&r.function_call))return r.function_call;if(wi(r)&&((e=r==null?void 0:r.tool_calls)!=null&&e.length))return(n=r.tool_calls.at(-1))==null?void 0:n.function}},Of=function(){for(let e=this.messages.length-1;e>=0;e--){const n=this.messages[e];if(NT(n)&&n.content!=null||IT(n)&&n.content!=null&&typeof n.content=="string"&&this.messages.some(a=>{var r;return a.role==="assistant"&&((r=a.tool_calls)==null?void 0:r.some(l=>l.type==="function"&&l.id===n.tool_call_id))}))return n.content}},qf=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:n}of this._chatCompletions)n&&(e.completion_tokens+=n.completion_tokens,e.prompt_tokens+=n.prompt_tokens,e.total_tokens+=n.total_tokens);return e},MT=function(e){if(e.n!=null&&e.n>1)throw new Se("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Bf=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class $r extends DT{static runFunctions(e,n,a){const r=new $r,l={...a,headers:{...a==null?void 0:a.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run(()=>r._runFunctions(e,n,l)),r}static runTools(e,n,a){const r=new $r,l={...a,headers:{...a==null?void 0:a.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,n,l)),r}_addMessage(e,n=!0){super._addMessage(e,n),wi(e)&&e.content&&this._emit("content",e.content)}}const PT=1,LT=2,kT=4,UT=8,OT=16,qT=32,BT=64,HT=128,VT=256,FT=HT|VT,GT=OT|qT|FT|BT,zT=PT|LT|GT,$T=kT|UT,yD=zT|$T,_t={STR:PT,NUM:LT,ARR:kT,OBJ:UT,NULL:OT,BOOL:qT,NAN:BT,INFINITY:HT,MINUS_INFINITY:VT,INF:FT,SPECIAL:GT,ATOM:zT,COLLECTION:$T,ALL:yD};class vD extends Error{}class SD extends Error{}function _D(t,e=_t.ALL){if(typeof t!="string")throw new TypeError(`expecting str, got ${typeof t}`);if(!t.trim())throw new Error(`${t} is empty`);return TD(t.trim(),e)}const TD=(t,e)=>{const n=t.length;let a=0;const r=_=>{throw new vD(`${_} at position ${a}`)},l=_=>{throw new SD(`${_} at position ${a}`)},c=()=>(v(),a>=n&&r("Unexpected end of input"),t[a]==='"'?f():t[a]==="{"?y():t[a]==="["?p():t.substring(a,a+4)==="null"||_t.NULL&e&&n-a<4&&"null".startsWith(t.substring(a))?(a+=4,null):t.substring(a,a+4)==="true"||_t.BOOL&e&&n-a<4&&"true".startsWith(t.substring(a))?(a+=4,!0):t.substring(a,a+5)==="false"||_t.BOOL&e&&n-a<5&&"false".startsWith(t.substring(a))?(a+=5,!1):t.substring(a,a+8)==="Infinity"||_t.INFINITY&e&&n-a<8&&"Infinity".startsWith(t.substring(a))?(a+=8,1/0):t.substring(a,a+9)==="-Infinity"||_t.MINUS_INFINITY&e&&1<n-a&&n-a<9&&"-Infinity".startsWith(t.substring(a))?(a+=9,-1/0):t.substring(a,a+3)==="NaN"||_t.NAN&e&&n-a<3&&"NaN".startsWith(t.substring(a))?(a+=3,NaN):m()),f=()=>{const _=a;let x=!1;for(a++;a<n&&(t[a]!=='"'||x&&t[a-1]==="\\");)x=t[a]==="\\"?!x:!1,a++;if(t.charAt(a)=='"')try{return JSON.parse(t.substring(_,++a-Number(x)))}catch(w){l(String(w))}else if(_t.STR&e)try{return JSON.parse(t.substring(_,a-Number(x))+'"')}catch{return JSON.parse(t.substring(_,t.lastIndexOf("\\"))+'"')}r("Unterminated string literal")},y=()=>{a++,v();const _={};try{for(;t[a]!=="}";){if(v(),a>=n&&_t.OBJ&e)return _;const x=f();v(),a++;try{const w=c();Object.defineProperty(_,x,{value:w,writable:!0,enumerable:!0,configurable:!0})}catch(w){if(_t.OBJ&e)return _;throw w}v(),t[a]===","&&a++}}catch{if(_t.OBJ&e)return _;r("Expected '}' at end of object")}return a++,_},p=()=>{a++;const _=[];try{for(;t[a]!=="]";)_.push(c()),v(),t[a]===","&&a++}catch{if(_t.ARR&e)return _;r("Expected ']' at end of array")}return a++,_},m=()=>{if(a===0){t==="-"&&_t.NUM&e&&r("Not sure what '-' is");try{return JSON.parse(t)}catch(x){if(_t.NUM&e)try{return t[t.length-1]==="."?JSON.parse(t.substring(0,t.lastIndexOf("."))):JSON.parse(t.substring(0,t.lastIndexOf("e")))}catch{}l(String(x))}}const _=a;for(t[a]==="-"&&a++;t[a]&&!",]}".includes(t[a]);)a++;a==n&&!(_t.NUM&e)&&r("Unterminated number literal");try{return JSON.parse(t.substring(_,a))}catch{t.substring(_,a)==="-"&&_t.NUM&e&&r("Not sure what '-' is");try{return JSON.parse(t.substring(_,t.lastIndexOf("e")))}catch(w){l(String(w))}}},v=()=>{for(;a<n&&` 
\r	`.includes(t[a]);)a++};return c()},uS=t=>_D(t,_t.ALL^_t.NUM);var ci=function(t,e,n,a,r){if(a==="m")throw new TypeError("Private method is not writable");if(a==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return a==="a"?r.call(t,n):r?r.value=n:e.set(t,n),n},$e=function(t,e,n,a){if(n==="a"&&!a)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!a:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?a:n==="a"?a.call(t):a?a.value:e.get(t)},mt,ts,di,ks,nf,Il,sf,af,rf,Rl,of,cS;class Yr extends DT{constructor(e){super(),mt.add(this),ts.set(this,void 0),di.set(this,void 0),ks.set(this,void 0),ci(this,ts,e,"f"),ci(this,di,[],"f")}get currentChatCompletionSnapshot(){return $e(this,ks,"f")}static fromReadableStream(e){const n=new Yr(null);return n._run(()=>n._fromReadableStream(e)),n}static createChatCompletion(e,n,a){const r=new Yr(n);return r._run(()=>r._runChatCompletion(e,{...n,stream:!0},{...a,headers:{...a==null?void 0:a.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createChatCompletion(e,n,a){var c;super._createChatCompletion;const r=a==null?void 0:a.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),$e(this,mt,"m",nf).call(this);const l=await e.chat.completions.create({...n,stream:!0},{...a,signal:this.controller.signal});this._connected();for await(const f of l)$e(this,mt,"m",sf).call(this,f);if((c=l.controller.signal)!=null&&c.aborted)throw new hn;return this._addChatCompletion($e(this,mt,"m",Rl).call(this))}async _fromReadableStream(e,n){var c;const a=n==null?void 0:n.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),$e(this,mt,"m",nf).call(this),this._connected();const r=kn.fromReadableStream(e,this.controller);let l;for await(const f of r)l&&l!==f.id&&this._addChatCompletion($e(this,mt,"m",Rl).call(this)),$e(this,mt,"m",sf).call(this,f),l=f.id;if((c=r.controller.signal)!=null&&c.aborted)throw new hn;return this._addChatCompletion($e(this,mt,"m",Rl).call(this))}[(ts=new WeakMap,di=new WeakMap,ks=new WeakMap,mt=new WeakSet,nf=function(){this.ended||ci(this,ks,void 0,"f")},Il=function(n){let a=$e(this,di,"f")[n.index];return a||(a={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},$e(this,di,"f")[n.index]=a,a)},sf=function(n){var r,l,c,f,y,p,m,v,_,x,w,A,C,N,I;if(this.ended)return;const a=$e(this,mt,"m",cS).call(this,n);this._emit("chunk",n,a);for(const R of n.choices){const M=a.choices[R.index];R.delta.content!=null&&((r=M.message)==null?void 0:r.role)==="assistant"&&((l=M.message)!=null&&l.content)&&(this._emit("content",R.delta.content,M.message.content),this._emit("content.delta",{delta:R.delta.content,snapshot:M.message.content,parsed:M.message.parsed})),R.delta.refusal!=null&&((c=M.message)==null?void 0:c.role)==="assistant"&&((f=M.message)!=null&&f.refusal)&&this._emit("refusal.delta",{delta:R.delta.refusal,snapshot:M.message.refusal}),((y=R.logprobs)==null?void 0:y.content)!=null&&((p=M.message)==null?void 0:p.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(m=R.logprobs)==null?void 0:m.content,snapshot:((v=M.logprobs)==null?void 0:v.content)??[]}),((_=R.logprobs)==null?void 0:_.refusal)!=null&&((x=M.message)==null?void 0:x.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(w=R.logprobs)==null?void 0:w.refusal,snapshot:((A=M.logprobs)==null?void 0:A.refusal)??[]});const z=$e(this,mt,"m",Il).call(this,M);M.finish_reason&&($e(this,mt,"m",rf).call(this,M),z.current_tool_call_index!=null&&$e(this,mt,"m",af).call(this,M,z.current_tool_call_index));for(const B of R.delta.tool_calls??[])z.current_tool_call_index!==B.index&&($e(this,mt,"m",rf).call(this,M),z.current_tool_call_index!=null&&$e(this,mt,"m",af).call(this,M,z.current_tool_call_index)),z.current_tool_call_index=B.index;for(const B of R.delta.tool_calls??[]){const k=(C=M.message.tool_calls)==null?void 0:C[B.index];k!=null&&k.type&&((k==null?void 0:k.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(N=k.function)==null?void 0:N.name,index:B.index,arguments:k.function.arguments,parsed_arguments:k.function.parsed_arguments,arguments_delta:((I=B.function)==null?void 0:I.arguments)??""}):(k==null||k.type,void 0))}}},af=function(n,a){var c,f,y;if($e(this,mt,"m",Il).call(this,n).done_tool_calls.has(a))return;const l=(c=n.message.tool_calls)==null?void 0:c[a];if(!l)throw new Error("no tool call snapshot");if(!l.type)throw new Error("tool call snapshot missing `type`");if(l.type==="function"){const p=(y=(f=$e(this,ts,"f"))==null?void 0:f.tools)==null?void 0:y.find(m=>m.type==="function"&&m.function.name===l.function.name);this._emit("tool_calls.function.arguments.done",{name:l.function.name,index:a,arguments:l.function.arguments,parsed_arguments:Zr(p)?p.$parseRaw(l.function.arguments):p!=null&&p.function.strict?JSON.parse(l.function.arguments):null})}else l.type},rf=function(n){var r,l;const a=$e(this,mt,"m",Il).call(this,n);if(n.message.content&&!a.content_done){a.content_done=!0;const c=$e(this,mt,"m",of).call(this);this._emit("content.done",{content:n.message.content,parsed:c?c.$parseRaw(n.message.content):null})}n.message.refusal&&!a.refusal_done&&(a.refusal_done=!0,this._emit("refusal.done",{refusal:n.message.refusal})),(r=n.logprobs)!=null&&r.content&&!a.logprobs_content_done&&(a.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:n.logprobs.content})),(l=n.logprobs)!=null&&l.refusal&&!a.logprobs_refusal_done&&(a.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:n.logprobs.refusal}))},Rl=function(){if(this.ended)throw new Se("stream has ended, this shouldn't happen");const n=$e(this,ks,"f");if(!n)throw new Se("request ended without sending any chunks");return ci(this,ks,void 0,"f"),ci(this,di,[],"f"),bD(n,$e(this,ts,"f"))},of=function(){var a;const n=(a=$e(this,ts,"f"))==null?void 0:a.response_format;return vp(n)?n:null},cS=function(n){var a,r,l,c;let f=$e(this,ks,"f");const{choices:y,...p}=n;f?Object.assign(f,p):f=ci(this,ks,{...p,choices:[]},"f");for(const{delta:m,finish_reason:v,index:_,logprobs:x=null,...w}of n.choices){let A=f.choices[_];if(A||(A=f.choices[_]={finish_reason:v,index:_,message:{},logprobs:x,...w}),x)if(!A.logprobs)A.logprobs=Object.assign({},x);else{const{content:B,refusal:k,...W}=x;Object.assign(A.logprobs,W),B&&((a=A.logprobs).content??(a.content=[]),A.logprobs.content.push(...B)),k&&((r=A.logprobs).refusal??(r.refusal=[]),A.logprobs.refusal.push(...k))}if(v&&(A.finish_reason=v,$e(this,ts,"f")&&RT($e(this,ts,"f")))){if(v==="length")throw new dT;if(v==="content_filter")throw new fT}if(Object.assign(A,w),!m)continue;const{content:C,refusal:N,function_call:I,role:R,tool_calls:M,...z}=m;if(Object.assign(A.message,z),N&&(A.message.refusal=(A.message.refusal||"")+N),R&&(A.message.role=R),I&&(A.message.function_call?(I.name&&(A.message.function_call.name=I.name),I.arguments&&((l=A.message.function_call).arguments??(l.arguments=""),A.message.function_call.arguments+=I.arguments)):A.message.function_call=I),C&&(A.message.content=(A.message.content||"")+C,!A.message.refusal&&$e(this,mt,"m",of).call(this)&&(A.message.parsed=uS(A.message.content))),M){A.message.tool_calls||(A.message.tool_calls=[]);for(const{index:B,id:k,type:W,function:Y,...Z}of M){const te=(c=A.message.tool_calls)[B]??(c[B]={});Object.assign(te,Z),k&&(te.id=k),W&&(te.type=W),Y&&(te.function??(te.function={name:Y.name??"",arguments:""})),Y!=null&&Y.name&&(te.function.name=Y.name),Y!=null&&Y.arguments&&(te.function.arguments+=Y.arguments,hD($e(this,ts,"f"),te)&&(te.function.parsed_arguments=uS(te.function.arguments)))}}}return f},Symbol.asyncIterator)](){const e=[],n=[];let a=!1;return this.on("chunk",r=>{const l=n.shift();l?l.resolve(r):e.push(r)}),this.on("end",()=>{a=!0;for(const r of n)r.resolve(void 0);n.length=0}),this.on("abort",r=>{a=!0;for(const l of n)l.reject(r);n.length=0}),this.on("error",r=>{a=!0;for(const l of n)l.reject(r);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:a?{value:void 0,done:!0}:new Promise((l,c)=>n.push({resolve:l,reject:c})).then(l=>l?{value:l,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new kn(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function bD(t,e){const{id:n,choices:a,created:r,model:l,system_fingerprint:c,...f}=t,y={...f,id:n,choices:a.map(({message:p,finish_reason:m,index:v,logprobs:_,...x})=>{if(!m)throw new Se(`missing finish_reason for choice ${v}`);const{content:w=null,function_call:A,tool_calls:C,...N}=p,I=p.role;if(!I)throw new Se(`missing role for choice ${v}`);if(A){const{arguments:R,name:M}=A;if(R==null)throw new Se(`missing function_call.arguments for choice ${v}`);if(!M)throw new Se(`missing function_call.name for choice ${v}`);return{...x,message:{content:w,function_call:{arguments:R,name:M},role:I,refusal:p.refusal??null},finish_reason:m,index:v,logprobs:_}}return C?{...x,index:v,finish_reason:m,logprobs:_,message:{...N,role:I,content:w,refusal:p.refusal??null,tool_calls:C.map((R,M)=>{const{function:z,type:B,id:k,...W}=R,{arguments:Y,name:Z,...te}=z||{};if(k==null)throw new Se(`missing choices[${v}].tool_calls[${M}].id
${Ml(t)}`);if(B==null)throw new Se(`missing choices[${v}].tool_calls[${M}].type
${Ml(t)}`);if(Z==null)throw new Se(`missing choices[${v}].tool_calls[${M}].function.name
${Ml(t)}`);if(Y==null)throw new Se(`missing choices[${v}].tool_calls[${M}].function.arguments
${Ml(t)}`);return{...W,id:k,type:B,function:{...te,name:Z,arguments:Y}}})}}:{...x,message:{...N,content:w,role:I,refusal:p.refusal??null},finish_reason:m,index:v,logprobs:_}}),created:r,model:l,object:"chat.completion",...c?{system_fingerprint:c}:{}};return fD(y,e)}function Ml(t){return JSON.stringify(t)}class Ci extends Yr{static fromReadableStream(e){const n=new Ci(null);return n._run(()=>n._fromReadableStream(e)),n}static runFunctions(e,n,a){const r=new Ci(null),l={...a,headers:{...a==null?void 0:a.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run(()=>r._runFunctions(e,n,l)),r}static runTools(e,n,a){const r=new Ci(n),l={...a,headers:{...a==null?void 0:a.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,n,l)),r}}let YT=class extends _e{parse(e,n){return gD(e.tools),this._client.chat.completions.create(e,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(a=>Sp(a,e))}runFunctions(e,n){return e.stream?Ci.runFunctions(this._client,e,n):$r.runFunctions(this._client,e,n)}runTools(e,n){return e.stream?Ci.runTools(this._client,e,n):$r.runTools(this._client,e,n)}stream(e,n){return Yr.createChatCompletion(this._client,e,n)}};class Hf extends _e{constructor(){super(...arguments),this.completions=new YT(this._client)}}(function(t){t.Completions=YT})(Hf||(Hf={}));class JT extends _e{create(e,n){return this._client.post("/realtime/sessions",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class KT extends _e{create(e,n){return this._client.post("/realtime/transcription_sessions",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class vu extends _e{constructor(){super(...arguments),this.sessions=new JT(this._client),this.transcriptionSessions=new KT(this._client)}}vu.Sessions=JT;vu.TranscriptionSessions=KT;class _p extends _e{create(e,n,a){return this._client.post(`/threads/${e}/messages`,{body:n,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}retrieve(e,n,a){return this._client.get(`/threads/${e}/messages/${n}`,{...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}update(e,n,a,r){return this._client.post(`/threads/${e}/messages/${n}`,{body:a,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,n={},a){return et(n)?this.list(e,{},n):this._client.getAPIList(`/threads/${e}/messages`,Tp,{query:n,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}del(e,n,a){return this._client.delete(`/threads/${e}/messages/${n}`,{...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}}class Tp extends gt{}_p.MessagesPage=Tp;class bp extends _e{retrieve(e,n,a,r={},l){return et(r)?this.retrieve(e,n,a,{},r):this._client.get(`/threads/${e}/runs/${n}/steps/${a}`,{query:r,...l,headers:{"OpenAI-Beta":"assistants=v2",...l==null?void 0:l.headers}})}list(e,n,a={},r){return et(a)?this.list(e,n,{},a):this._client.getAPIList(`/threads/${e}/runs/${n}/steps`,xp,{query:a,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}}class xp extends gt{}bp.RunStepsPage=xp;let eo=class extends _e{constructor(){super(...arguments),this.steps=new bp(this._client)}create(e,n,a){const{include:r,...l}=n;return this._client.post(`/threads/${e}/runs`,{query:{include:r},body:l,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers},stream:n.stream??!1})}retrieve(e,n,a){return this._client.get(`/threads/${e}/runs/${n}`,{...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}update(e,n,a,r){return this._client.post(`/threads/${e}/runs/${n}`,{body:a,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,n={},a){return et(n)?this.list(e,{},n):this._client.getAPIList(`/threads/${e}/runs`,Ap,{query:n,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}cancel(e,n,a){return this._client.post(`/threads/${e}/runs/${n}/cancel`,{...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}async createAndPoll(e,n,a){const r=await this.create(e,n,a);return await this.poll(e,r.id,a)}createAndStream(e,n,a){return xn.createAssistantStream(e,this._client.beta.threads.runs,n,a)}async poll(e,n,a){const r={...a==null?void 0:a.headers,"X-Stainless-Poll-Helper":"true"};for(a!=null&&a.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=a.pollIntervalMs.toString());;){const{data:l,response:c}=await this.retrieve(e,n,{...a,headers:{...a==null?void 0:a.headers,...r}}).withResponse();switch(l.status){case"queued":case"in_progress":case"cancelling":let f=5e3;if(a!=null&&a.pollIntervalMs)f=a.pollIntervalMs;else{const y=c.headers.get("openai-poll-after-ms");if(y){const p=parseInt(y);isNaN(p)||(f=p)}}await Qr(f);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return l}}}stream(e,n,a){return xn.createAssistantStream(e,this._client.beta.threads.runs,n,a)}submitToolOutputs(e,n,a,r){return this._client.post(`/threads/${e}/runs/${n}/submit_tool_outputs`,{body:a,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:a.stream??!1})}async submitToolOutputsAndPoll(e,n,a,r){const l=await this.submitToolOutputs(e,n,a,r);return await this.poll(e,l.id,r)}submitToolOutputsStream(e,n,a,r){return xn.createToolAssistantStream(e,n,this._client.beta.threads.runs,a,r)}};class Ap extends gt{}eo.RunsPage=Ap;eo.Steps=bp;eo.RunStepsPage=xp;class Mi extends _e{constructor(){super(...arguments),this.runs=new eo(this._client),this.messages=new _p(this._client)}create(e={},n){return et(e)?this.create({},e):this._client.post("/threads",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,n){return this._client.get(`/threads/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,n,a){return this._client.post(`/threads/${e}`,{body:n,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}del(e,n){return this._client.delete(`/threads/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}createAndRun(e,n){return this._client.post("/threads/runs",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:e.stream??!1})}async createAndRunPoll(e,n){const a=await this.createAndRun(e,n);return await this.runs.poll(a.thread_id,a.id,n)}createAndRunStream(e,n){return xn.createThreadAssistantStream(e,this._client.beta.threads,n)}}Mi.Runs=eo;Mi.RunsPage=Ap;Mi.Messages=_p;Mi.MessagesPage=Tp;class Di extends _e{constructor(){super(...arguments),this.realtime=new vu(this._client),this.chat=new Hf(this._client),this.assistants=new gp(this._client),this.threads=new Mi(this._client)}}Di.Realtime=vu;Di.Assistants=gp;Di.AssistantsPage=yp;Di.Threads=Mi;class jT extends _e{create(e,n){return this._client.post("/completions",{body:e,...n,stream:e.stream??!1})}}class XT extends _e{retrieve(e,n,a){return this._client.get(`/containers/${e}/files/${n}/content`,{...a,headers:{Accept:"application/binary",...a==null?void 0:a.headers},__binaryResponse:!0})}}let Su=class extends _e{constructor(){super(...arguments),this.content=new XT(this._client)}create(e,n,a){return this._client.post(`/containers/${e}/files`,Ta({body:n,...a}))}retrieve(e,n,a){return this._client.get(`/containers/${e}/files/${n}`,a)}list(e,n={},a){return et(n)?this.list(e,{},n):this._client.getAPIList(`/containers/${e}/files`,wp,{query:n,...a})}del(e,n,a){return this._client.delete(`/containers/${e}/files/${n}`,{...a,headers:{Accept:"*/*",...a==null?void 0:a.headers}})}};class wp extends gt{}Su.FileListResponsesPage=wp;Su.Content=XT;class to extends _e{constructor(){super(...arguments),this.files=new Su(this._client)}create(e,n){return this._client.post("/containers",{body:e,...n})}retrieve(e,n){return this._client.get(`/containers/${e}`,n)}list(e={},n){return et(e)?this.list({},e):this._client.getAPIList("/containers",Cp,{query:e,...n})}del(e,n){return this._client.delete(`/containers/${e}`,{...n,headers:{Accept:"*/*",...n==null?void 0:n.headers}})}}class Cp extends gt{}to.ContainerListResponsesPage=Cp;to.Files=Su;to.FileListResponsesPage=wp;class QT extends _e{create(e,n){const a=!!e.encoding_format;let r=a?e.encoding_format:"base64";a&&Bs("Request","User defined encoding_format:",e.encoding_format);const l=this._client.post("/embeddings",{body:{...e,encoding_format:r},...n});return a?l:(Bs("response","Decoding base64 embeddings to float32 array"),l._thenUnwrap(c=>(c&&c.data&&c.data.forEach(f=>{const y=f.embedding;f.embedding=cD(y)}),c)))}}class Ep extends _e{retrieve(e,n,a,r){return this._client.get(`/evals/${e}/runs/${n}/output_items/${a}`,r)}list(e,n,a={},r){return et(a)?this.list(e,n,{},a):this._client.getAPIList(`/evals/${e}/runs/${n}/output_items`,Np,{query:a,...r})}}class Np extends gt{}Ep.OutputItemListResponsesPage=Np;class no extends _e{constructor(){super(...arguments),this.outputItems=new Ep(this._client)}create(e,n,a){return this._client.post(`/evals/${e}/runs`,{body:n,...a})}retrieve(e,n,a){return this._client.get(`/evals/${e}/runs/${n}`,a)}list(e,n={},a){return et(n)?this.list(e,{},n):this._client.getAPIList(`/evals/${e}/runs`,Ip,{query:n,...a})}del(e,n,a){return this._client.delete(`/evals/${e}/runs/${n}`,a)}cancel(e,n,a){return this._client.post(`/evals/${e}/runs/${n}`,a)}}class Ip extends gt{}no.RunListResponsesPage=Ip;no.OutputItems=Ep;no.OutputItemListResponsesPage=Np;class so extends _e{constructor(){super(...arguments),this.runs=new no(this._client)}create(e,n){return this._client.post("/evals",{body:e,...n})}retrieve(e,n){return this._client.get(`/evals/${e}`,n)}update(e,n,a){return this._client.post(`/evals/${e}`,{body:n,...a})}list(e={},n){return et(e)?this.list({},e):this._client.getAPIList("/evals",Rp,{query:e,...n})}del(e,n){return this._client.delete(`/evals/${e}`,n)}}class Rp extends gt{}so.EvalListResponsesPage=Rp;so.Runs=no;so.RunListResponsesPage=Ip;let Mp=class extends _e{create(e,n){return this._client.post("/files",Ta({body:e,...n}))}retrieve(e,n){return this._client.get(`/files/${e}`,n)}list(e={},n){return et(e)?this.list({},e):this._client.getAPIList("/files",Dp,{query:e,...n})}del(e,n){return this._client.delete(`/files/${e}`,n)}content(e,n){return this._client.get(`/files/${e}/content`,{...n,headers:{Accept:"application/binary",...n==null?void 0:n.headers},__binaryResponse:!0})}retrieveContent(e,n){return this._client.get(`/files/${e}/content`,n)}async waitForProcessing(e,{pollInterval:n=5e3,maxWait:a=1800*1e3}={}){const r=new Set(["processed","error","deleted"]),l=Date.now();let c=await this.retrieve(e);for(;!c.status||!r.has(c.status);)if(await Qr(n),c=await this.retrieve(e),Date.now()-l>a)throw new fp({message:`Giving up on waiting for file ${e} to finish processing after ${a} milliseconds.`});return c}};class Dp extends gt{}Mp.FileObjectsPage=Dp;class WT extends _e{}let ZT=class extends _e{run(e,n){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...n})}validate(e,n){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...n})}};class Pp extends _e{constructor(){super(...arguments),this.graders=new ZT(this._client)}}Pp.Graders=ZT;class Lp extends _e{create(e,n,a){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,kp,{body:n,method:"post",...a})}retrieve(e,n={},a){return et(n)?this.retrieve(e,{},n):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:n,...a})}del(e,n,a){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions/${n}`,a)}}class kp extends mu{}Lp.PermissionCreateResponsesPage=kp;let _u=class extends _e{constructor(){super(...arguments),this.permissions=new Lp(this._client)}};_u.Permissions=Lp;_u.PermissionCreateResponsesPage=kp;class Up extends _e{list(e,n={},a){return et(n)?this.list(e,{},n):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Op,{query:n,...a})}}class Op extends gt{}Up.FineTuningJobCheckpointsPage=Op;class Pi extends _e{constructor(){super(...arguments),this.checkpoints=new Up(this._client)}create(e,n){return this._client.post("/fine_tuning/jobs",{body:e,...n})}retrieve(e,n){return this._client.get(`/fine_tuning/jobs/${e}`,n)}list(e={},n){return et(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",qp,{query:e,...n})}cancel(e,n){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,n)}listEvents(e,n={},a){return et(n)?this.listEvents(e,{},n):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Bp,{query:n,...a})}pause(e,n){return this._client.post(`/fine_tuning/jobs/${e}/pause`,n)}resume(e,n){return this._client.post(`/fine_tuning/jobs/${e}/resume`,n)}}class qp extends gt{}class Bp extends gt{}Pi.FineTuningJobsPage=qp;Pi.FineTuningJobEventsPage=Bp;Pi.Checkpoints=Up;Pi.FineTuningJobCheckpointsPage=Op;class Gs extends _e{constructor(){super(...arguments),this.methods=new WT(this._client),this.jobs=new Pi(this._client),this.checkpoints=new _u(this._client),this.alpha=new Pp(this._client)}}Gs.Methods=WT;Gs.Jobs=Pi;Gs.FineTuningJobsPage=qp;Gs.FineTuningJobEventsPage=Bp;Gs.Checkpoints=_u;Gs.Alpha=Pp;class eb extends _e{}class Hp extends _e{constructor(){super(...arguments),this.graderModels=new eb(this._client)}}Hp.GraderModels=eb;class tb extends _e{createVariation(e,n){return this._client.post("/images/variations",Ta({body:e,...n}))}edit(e,n){return this._client.post("/images/edits",Ta({body:e,...n}))}generate(e,n){return this._client.post("/images/generations",{body:e,...n})}}class Vp extends _e{retrieve(e,n){return this._client.get(`/models/${e}`,n)}list(e){return this._client.getAPIList("/models",Fp,e)}del(e,n){return this._client.delete(`/models/${e}`,n)}}class Fp extends mu{}Vp.ModelsPage=Fp;class nb extends _e{create(e,n){return this._client.post("/moderations",{body:e,...n})}}function xD(t,e){return!e||!wD(e)?{...t,output_parsed:null,output:t.output.map(n=>n.type==="function_call"?{...n,parsed_arguments:null}:n.type==="message"?{...n,content:n.content.map(a=>({...a,parsed:null}))}:n)}:sb(t,e)}function sb(t,e){const n=t.output.map(r=>{if(r.type==="function_call")return{...r,parsed_arguments:ND(e,r)};if(r.type==="message"){const l=r.content.map(c=>c.type==="output_text"?{...c,parsed:AD(e,c.text)}:c);return{...r,content:l}}return r}),a=Object.assign({},t,{output:n});return Object.getOwnPropertyDescriptor(t,"output_text")||ab(a),Object.defineProperty(a,"output_parsed",{enumerable:!0,get(){for(const r of a.output)if(r.type==="message"){for(const l of r.content)if(l.type==="output_text"&&l.parsed!==null)return l.parsed}return null}}),a}function AD(t,e){var n,a,r,l;return((a=(n=t.text)==null?void 0:n.format)==null?void 0:a.type)!=="json_schema"?null:"$parseRaw"in((r=t.text)==null?void 0:r.format)?((l=t.text)==null?void 0:l.format).$parseRaw(e):JSON.parse(e)}function wD(t){var e;return!!vp((e=t.text)==null?void 0:e.format)}function CD(t){return(t==null?void 0:t.$brand)==="auto-parseable-tool"}function ED(t,e){return t.find(n=>n.type==="function"&&n.name===e)}function ND(t,e){const n=ED(t.tools??[],e.name);return{...e,...e,parsed_arguments:CD(n)?n.$parseRaw(e.arguments):n!=null&&n.strict?JSON.parse(e.arguments):null}}function ab(t){const e=[];for(const n of t.output)if(n.type==="message")for(const a of n.content)a.type==="output_text"&&e.push(a.text);t.output_text=e.join("")}class ib extends _e{list(e,n={},a){return et(n)?this.list(e,{},n):this._client.getAPIList(`/responses/${e}/input_items`,RD,{query:n,...a})}}var fi=function(t,e,n,a,r){if(a==="m")throw new TypeError("Private method is not writable");if(a==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return a==="a"?r.call(t,n):r?r.value=n:e.set(t,n),n},Us=function(t,e,n,a){if(n==="a"&&!a)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!a:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?a:n==="a"?a.call(t):a?a.value:e.get(t)},pi,Dl,Os,Pl,dS,fS,pS,mS;class Gp extends hp{constructor(e){super(),pi.add(this),Dl.set(this,void 0),Os.set(this,void 0),Pl.set(this,void 0),fi(this,Dl,e,"f")}static createResponse(e,n,a){const r=new Gp(n);return r._run(()=>r._createOrRetrieveResponse(e,n,{...a,headers:{...a==null?void 0:a.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createOrRetrieveResponse(e,n,a){var f;const r=a==null?void 0:a.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),Us(this,pi,"m",dS).call(this);let l,c=null;"response_id"in n?(l=await e.responses.retrieve(n.response_id,{stream:!0},{...a,signal:this.controller.signal,stream:!0}),c=n.starting_after??null):l=await e.responses.create({...n,stream:!0},{...a,signal:this.controller.signal}),this._connected();for await(const y of l)Us(this,pi,"m",fS).call(this,y,c);if((f=l.controller.signal)!=null&&f.aborted)throw new hn;return Us(this,pi,"m",pS).call(this)}[(Dl=new WeakMap,Os=new WeakMap,Pl=new WeakMap,pi=new WeakSet,dS=function(){this.ended||fi(this,Os,void 0,"f")},fS=function(n,a){if(this.ended)return;const r=(c,f)=>{(a==null||f.sequence_number>a)&&this._emit(c,f)},l=Us(this,pi,"m",mS).call(this,n);switch(r("event",n),n.type){case"response.output_text.delta":{const c=l.output[n.output_index];if(!c)throw new Se(`missing output at index ${n.output_index}`);if(c.type==="message"){const f=c.content[n.content_index];if(!f)throw new Se(`missing content at index ${n.content_index}`);if(f.type!=="output_text")throw new Se(`expected content to be 'output_text', got ${f.type}`);r("response.output_text.delta",{...n,snapshot:f.text})}break}case"response.function_call_arguments.delta":{const c=l.output[n.output_index];if(!c)throw new Se(`missing output at index ${n.output_index}`);c.type==="function_call"&&r("response.function_call_arguments.delta",{...n,snapshot:c.arguments});break}default:r(n.type,n);break}},pS=function(){if(this.ended)throw new Se("stream has ended, this shouldn't happen");const n=Us(this,Os,"f");if(!n)throw new Se("request ended without sending any events");fi(this,Os,void 0,"f");const a=ID(n,Us(this,Dl,"f"));return fi(this,Pl,a,"f"),a},mS=function(n){let a=Us(this,Os,"f");if(!a){if(n.type!=="response.created")throw new Se(`When snapshot hasn't been set yet, expected 'response.created' event, got ${n.type}`);return a=fi(this,Os,n.response,"f"),a}switch(n.type){case"response.output_item.added":{a.output.push(n.item);break}case"response.content_part.added":{const r=a.output[n.output_index];if(!r)throw new Se(`missing output at index ${n.output_index}`);r.type==="message"&&r.content.push(n.part);break}case"response.output_text.delta":{const r=a.output[n.output_index];if(!r)throw new Se(`missing output at index ${n.output_index}`);if(r.type==="message"){const l=r.content[n.content_index];if(!l)throw new Se(`missing content at index ${n.content_index}`);if(l.type!=="output_text")throw new Se(`expected content to be 'output_text', got ${l.type}`);l.text+=n.delta}break}case"response.function_call_arguments.delta":{const r=a.output[n.output_index];if(!r)throw new Se(`missing output at index ${n.output_index}`);r.type==="function_call"&&(r.arguments+=n.delta);break}case"response.completed":{fi(this,Os,n.response,"f");break}}return a},Symbol.asyncIterator)](){const e=[],n=[];let a=!1;return this.on("event",r=>{const l=n.shift();l?l.resolve(r):e.push(r)}),this.on("end",()=>{a=!0;for(const r of n)r.resolve(void 0);n.length=0}),this.on("abort",r=>{a=!0;for(const l of n)l.reject(r);n.length=0}),this.on("error",r=>{a=!0;for(const l of n)l.reject(r);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:a?{value:void 0,done:!0}:new Promise((l,c)=>n.push({resolve:l,reject:c})).then(l=>l?{value:l,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=Us(this,Pl,"f");if(!e)throw new Se("stream ended without producing a ChatCompletion");return e}}function ID(t,e){return xD(t,e)}class zp extends _e{constructor(){super(...arguments),this.inputItems=new ib(this._client)}create(e,n){return this._client.post("/responses",{body:e,...n,stream:e.stream??!1})._thenUnwrap(a=>("object"in a&&a.object==="response"&&ab(a),a))}retrieve(e,n={},a){return this._client.get(`/responses/${e}`,{query:n,...a,stream:(n==null?void 0:n.stream)??!1})}del(e,n){return this._client.delete(`/responses/${e}`,{...n,headers:{Accept:"*/*",...n==null?void 0:n.headers}})}parse(e,n){return this._client.responses.create(e,n)._thenUnwrap(a=>sb(a,e))}stream(e,n){return Gp.createResponse(this._client,e,n)}cancel(e,n){return this._client.post(`/responses/${e}/cancel`,{...n,headers:{Accept:"*/*",...n==null?void 0:n.headers}})}}class RD extends gt{}zp.InputItems=ib;class rb extends _e{create(e,n,a){return this._client.post(`/uploads/${e}/parts`,Ta({body:n,...a}))}}class $p extends _e{constructor(){super(...arguments),this.parts=new rb(this._client)}create(e,n){return this._client.post("/uploads",{body:e,...n})}cancel(e,n){return this._client.post(`/uploads/${e}/cancel`,n)}complete(e,n,a){return this._client.post(`/uploads/${e}/complete`,{body:n,...a})}}$p.Parts=rb;const MD=async t=>{const e=await Promise.allSettled(t),n=e.filter(r=>r.status==="rejected");if(n.length){for(const r of n)console.error(r.reason);throw new Error(`${n.length} promise(s) failed - see the above errors`)}const a=[];for(const r of e)r.status==="fulfilled"&&a.push(r.value);return a};class Tu extends _e{create(e,n,a){return this._client.post(`/vector_stores/${e}/files`,{body:n,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}retrieve(e,n,a){return this._client.get(`/vector_stores/${e}/files/${n}`,{...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}update(e,n,a,r){return this._client.post(`/vector_stores/${e}/files/${n}`,{body:a,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,n={},a){return et(n)?this.list(e,{},n):this._client.getAPIList(`/vector_stores/${e}/files`,bu,{query:n,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}del(e,n,a){return this._client.delete(`/vector_stores/${e}/files/${n}`,{...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}async createAndPoll(e,n,a){const r=await this.create(e,n,a);return await this.poll(e,r.id,a)}async poll(e,n,a){const r={...a==null?void 0:a.headers,"X-Stainless-Poll-Helper":"true"};for(a!=null&&a.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=a.pollIntervalMs.toString());;){const l=await this.retrieve(e,n,{...a,headers:r}).withResponse(),c=l.data;switch(c.status){case"in_progress":let f=5e3;if(a!=null&&a.pollIntervalMs)f=a.pollIntervalMs;else{const y=l.response.headers.get("openai-poll-after-ms");if(y){const p=parseInt(y);isNaN(p)||(f=p)}}await Qr(f);break;case"failed":case"completed":return c}}}async upload(e,n,a){const r=await this._client.files.create({file:n,purpose:"assistants"},a);return this.create(e,{file_id:r.id},a)}async uploadAndPoll(e,n,a){const r=await this.upload(e,n,a);return await this.poll(e,r.id,a)}content(e,n,a){return this._client.getAPIList(`/vector_stores/${e}/files/${n}/content`,Yp,{...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}}class bu extends gt{}class Yp extends mu{}Tu.VectorStoreFilesPage=bu;Tu.FileContentResponsesPage=Yp;class ob extends _e{create(e,n,a){return this._client.post(`/vector_stores/${e}/file_batches`,{body:n,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}retrieve(e,n,a){return this._client.get(`/vector_stores/${e}/file_batches/${n}`,{...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}cancel(e,n,a){return this._client.post(`/vector_stores/${e}/file_batches/${n}/cancel`,{...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}async createAndPoll(e,n,a){const r=await this.create(e,n);return await this.poll(e,r.id,a)}listFiles(e,n,a={},r){return et(a)?this.listFiles(e,n,{},a):this._client.getAPIList(`/vector_stores/${e}/file_batches/${n}/files`,bu,{query:a,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async poll(e,n,a){const r={...a==null?void 0:a.headers,"X-Stainless-Poll-Helper":"true"};for(a!=null&&a.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=a.pollIntervalMs.toString());;){const{data:l,response:c}=await this.retrieve(e,n,{...a,headers:r}).withResponse();switch(l.status){case"in_progress":let f=5e3;if(a!=null&&a.pollIntervalMs)f=a.pollIntervalMs;else{const y=c.headers.get("openai-poll-after-ms");if(y){const p=parseInt(y);isNaN(p)||(f=p)}}await Qr(f);break;case"failed":case"cancelled":case"completed":return l}}}async uploadAndPoll(e,{files:n,fileIds:a=[]},r){if(n==null||n.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const l=(r==null?void 0:r.maxConcurrency)??5,c=Math.min(l,n.length),f=this._client,y=n.values(),p=[...a];async function m(_){for(let x of _){const w=await f.files.create({file:x,purpose:"assistants"},r);p.push(w.id)}}const v=Array(c).fill(y).map(m);return await MD(v),await this.createAndPoll(e,{file_ids:p})}}class zs extends _e{constructor(){super(...arguments),this.files=new Tu(this._client),this.fileBatches=new ob(this._client)}create(e,n){return this._client.post("/vector_stores",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,n){return this._client.get(`/vector_stores/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,n,a){return this._client.post(`/vector_stores/${e}`,{body:n,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}list(e={},n){return et(e)?this.list({},e):this._client.getAPIList("/vector_stores",Jp,{query:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,n){return this._client.delete(`/vector_stores/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}search(e,n,a){return this._client.getAPIList(`/vector_stores/${e}/search`,Kp,{body:n,method:"post",...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}}class Jp extends gt{}class Kp extends mu{}zs.VectorStoresPage=Jp;zs.VectorStoreSearchResponsesPage=Kp;zs.Files=Tu;zs.VectorStoreFilesPage=bu;zs.FileContentResponsesPage=Yp;zs.FileBatches=ob;var lb;class we extends WM{constructor({baseURL:e=El("OPENAI_BASE_URL"),apiKey:n=El("OPENAI_API_KEY"),organization:a=El("OPENAI_ORG_ID")??null,project:r=El("OPENAI_PROJECT_ID")??null,...l}={}){if(n===void 0)throw new Se("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const c={apiKey:n,organization:a,project:r,...l,baseURL:e||"https://api.openai.com/v1"};if(!c.dangerouslyAllowBrowser&&lD())throw new Se(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:c.baseURL,timeout:c.timeout??6e5,httpAgent:c.httpAgent,maxRetries:c.maxRetries,fetch:c.fetch}),this.completions=new jT(this),this.chat=new yu(this),this.embeddings=new QT(this),this.files=new Mp(this),this.images=new tb(this),this.audio=new Wr(this),this.moderations=new nb(this),this.models=new Vp(this),this.fineTuning=new Gs(this),this.graders=new Hp(this),this.vectorStores=new zs(this),this.beta=new Di(this),this.batches=new pp(this),this.uploads=new $p(this),this.responses=new zp(this),this.evals=new so(this),this.containers=new to(this),this._options=c,this.apiKey=n,this.organization=a,this.project=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return LM(e,{arrayFormat:"brackets"})}}lb=we;we.OpenAI=lb;we.DEFAULT_TIMEOUT=6e5;we.OpenAIError=Se;we.APIError=Et;we.APIConnectionError=cu;we.APIConnectionTimeoutError=fp;we.APIUserAbortError=hn;we.NotFoundError=rT;we.ConflictError=oT;we.RateLimitError=uT;we.BadRequestError=sT;we.AuthenticationError=aT;we.InternalServerError=cT;we.PermissionDeniedError=iT;we.UnprocessableEntityError=lT;we.toFile=gT;we.fileFromPath=eT;we.Completions=jT;we.Chat=yu;we.ChatCompletionsPage=gu;we.Embeddings=QT;we.Files=Mp;we.FileObjectsPage=Dp;we.Images=tb;we.Audio=Wr;we.Moderations=nb;we.Models=Vp;we.ModelsPage=Fp;we.FineTuning=Gs;we.Graders=Hp;we.VectorStores=zs;we.VectorStoresPage=Jp;we.VectorStoreSearchResponsesPage=Kp;we.Beta=Di;we.Batches=pp;we.BatchesPage=mp;we.Uploads=$p;we.Responses=zp;we.Evals=so;we.EvalListResponsesPage=Rp;we.Containers=to;we.ContainerListResponsesPage=Cp;const ub=async(t,e=2,n)=>{let a;for(let r=0;r<e;r++){if(n!=null&&n.aborted)throw new DOMException("Aborted","AbortError");try{return await t()}catch(l){if(a=l,n!=null&&n.aborted||r===e-1)throw a;console.warn(`API call failed, retrying... (${r+1}/${e})`,l),await new Promise(c=>setTimeout(c,500))}}throw a};class cb extends Error{constructor(e,n){super(e),this.name="PlanParsingError",this.rawContent=n}}const Vf=t=>{try{return JSON.parse(t)}catch{return null}},DD=t=>{const e=[["[","]"],["{","}"]];for(const[n,a]of e){const r=t.indexOf(n),l=t.lastIndexOf(a);if(r!==-1&&l!==-1&&l>r){const c=t.slice(r,l+1).trim();if(c&&Vf(c)!==null)return c}}return null},tu=t=>{let e=t.trim();const n=e.match(/```(?:json)?\s*([\s\S]*?)\s*```/);n&&n[1]&&(e=n[1]);let r=Vf(e);if(r===null){const l=DD(e);l&&(r=Vf(l))}if(r!==null){const l=r;if(Array.isArray(l))return l;if(typeof l=="object"&&l!==null){const c=Object.values(l).find(f=>Array.isArray(f));if(c&&Array.isArray(c))return c;if("chartType"in l&&"title"in l)return[l]}}throw console.error("Failed to parse AI response as JSON. Content:",e),new cb(`AI response could not be parsed as JSON. Content starts with: "${e.substring(0,150)}..."`,e)},PD=t=>{if(typeof t=="boolean")return t?{type:"json_object"}:void 0;if(t)return{type:"json_schema",json_schema:{name:t.name,schema:t.schema,strict:t.strict??!0}}},us=async(t,e,n,a)=>{if(!t.openAIApiKey)throw new Error("OpenAI API key is not set.");const r=new we({apiKey:t.openAIApiKey,dangerouslyAllowBrowser:!0}),l=PD(n),c={model:t.model,messages:e};l&&(c.response_format=l);const y=(await ub(()=>r.chat.completions.create(c,a?{signal:a}:void 0),2,a)).choices[0].message.content;if(!y)throw new Error("OpenAI returned an empty response.");return y},cs=async(t,e,n,a)=>{if(!t.geminiApiKey)throw new Error("Gemini API key is not set.");const r=new AM({apiKey:t.geminiApiKey}),l=`${e}
${n?"Your response must be a valid JSON object adhering to the provided schema.":""}`;return(await ub(()=>r.models.generateContent({model:t.model,contents:l,config:n?{responseMimeType:"application/json",responseSchema:n}:void 0},a?{signal:a}:void 0),2,a)).text.trim()},db={type:$.OBJECT,properties:{chartType:{type:$.STRING,enum:["bar","line","pie","doughnut","scatter","combo"],description:"Type of chart to generate."},title:{type:$.STRING,description:"A concise title for the analysis."},description:{type:$.STRING,minLength:8,description:"A brief explanation of what the analysis shows. Must be a full sentence with at least 8 characters."},aggregation:{type:$.STRING,enum:["sum","count","avg"],description:"The aggregation function to apply. Omit for scatter plots."},groupByColumn:{type:$.STRING,description:"The column to group data by (categorical). Omit for scatter plots."},valueColumn:{type:$.STRING,description:'The column for aggregation (numerical). Not needed for "count".'},xValueColumn:{type:$.STRING,description:"The column for the X-axis of a scatter plot (numerical). Required for scatter plots."},yValueColumn:{type:$.STRING,description:"The column for the Y-axis of a scatter plot (numerical). Required for scatter plots."},secondaryValueColumn:{type:$.STRING,description:"For combo charts, the secondary column for aggregation (numerical)."},secondaryAggregation:{type:$.STRING,enum:["sum","count","avg"],description:"For combo charts, the aggregation for the secondary value column."},defaultTopN:{type:$.INTEGER,description:"Optional. If the analysis has many categories, this suggests a default Top N view (e.g., 8)."},defaultHideOthers:{type:$.BOOLEAN,description:'Optional. If using defaultTopN, suggests whether to hide the "Others" category by default.'},rowFilter:{type:$.OBJECT,description:"Optional row-level filter to limit rows before aggregation (e.g., single customer or region).",properties:{column:{type:$.STRING,description:"Column to filter on. Must be categorical."},values:{type:$.ARRAY,minItems:1,description:"Exact values to keep (case-sensitive, as they appear in the dataset).",items:{type:$.STRING}}},required:["column","values"],additionalProperties:!1}},required:["chartType","title","description"],additionalProperties:!1},jp={type:$.OBJECT,properties:{plans:{type:$.ARRAY,description:"Array of analysis plans to execute.",items:db}},required:["plans"],additionalProperties:!1},LD={type:$.OBJECT,properties:{name:{type:$.STRING,description:"The column name."},type:{type:$.STRING,enum:["numerical","categorical","date","time","currency","percentage"],description:"The data type of the column. Identify specific types like 'date', 'currency', etc., where possible."}},required:["name","type"],additionalProperties:!1},fb={type:$.OBJECT,properties:{explanation:{type:$.STRING,description:"A brief, user-facing explanation of the transformations that will be applied to the data (e.g., 'Removed 3 summary rows and reshaped the data from a cross-tab format')."},jsFunctionBody:{type:$.STRING,description:"The body of a JavaScript function that takes two arguments `data` (an array of objects) and `_util` (a helper object) and returns the transformed array of objects. This code will be executed to clean and reshape the data. If no transformation is needed, this should be null."},outputColumns:{type:$.ARRAY,description:"A list of column profiles describing the structure of the data AFTER the transformation. If no transformation is performed, this should be the same as the input column profiles.",items:LD}},required:["explanation","jsFunctionBody","outputColumns"]},pb={type:$.OBJECT,properties:{explanation:{type:$.STRING,description:"A brief, user-facing explanation of the filter that was created from the natural language query."},jsFunctionBody:{type:$.STRING,description:"The body of a JavaScript function that takes 'data' and '_util' as arguments and returns a filtered array of objects. It should be a single line starting with 'return data.filter(...);'."}},required:["explanation","jsFunctionBody"]},mb={type:$.OBJECT,properties:{insight:{type:$.STRING,description:"A concise, user-facing message describing the single most important finding."},cardId:{type:$.STRING,description:"The ID of the card where this insight was observed."}},required:["insight","cardId"]},kD=db,UD={type:$.OBJECT,properties:{question:{type:$.STRING,description:"The clear, user-facing question to ask for clarification."},options:{type:$.ARRAY,items:{type:$.OBJECT,properties:{label:{type:$.STRING,description:"The user-friendly text for the option button."},value:{type:$.STRING,description:"The exact column name (case-sensitive) or literal value that should be assigned to the plan when this option is selected. Do not invent new names."}},required:["label","value"]}},pendingPlan:{type:$.OBJECT,description:"The partial analysis plan that is waiting for the user's input. It should contain all known parameters.",properties:{chartType:{type:$.STRING,enum:["bar","line","pie","doughnut","scatter","combo"]},title:{type:$.STRING},description:{type:$.STRING},aggregation:{type:$.STRING,enum:["sum","count","avg"]},groupByColumn:{type:$.STRING},valueColumn:{type:$.STRING},xValueColumn:{type:$.STRING},yValueColumn:{type:$.STRING},secondaryValueColumn:{type:$.STRING},secondaryAggregation:{type:$.STRING,enum:["sum","count","avg"]},defaultTopN:{type:$.INTEGER},defaultHideOthers:{type:$.BOOLEAN},rowFilter:{type:$.OBJECT,properties:{column:{type:$.STRING},values:{type:$.ARRAY,items:{type:$.STRING}}},additionalProperties:!1,required:["column","values"]}}},targetProperty:{type:$.STRING,description:"The name of the property in the 'pendingPlan' that the user's selected value should be assigned to."}},required:["question","options","pendingPlan","targetProperty"]},OD={type:$.OBJECT,description:"Declarative representation of a pending plan step.",properties:{id:{type:$.STRING,minLength:3,description:"Stable identifier (kebab-case recommended) used to reference this step in future actions."},label:{type:$.STRING,minLength:4,description:"Human-readable summary of the step."}},required:["id","label"],additionalProperties:!1},qD={type:$.OBJECT,description:"Structured summary of the agent's current goal, progress, and blockers.",properties:{goal:{type:$.STRING,minLength:6,description:"Overarching objective the agent is pursuing."},contextSummary:{type:$.STRING,description:"Optional short reminder of the context or constraint shaping the plan."},progress:{type:$.STRING,minLength:6,description:"What was just learned or completed from the latest observations."},nextSteps:{type:$.ARRAY,description:"Concrete upcoming actions, ordered by priority.",minItems:1,items:OD},planId:{type:$.STRING,description:"Stable identifier for the active plan (e.g., plan-<timestamp>)."},blockedBy:{type:$.STRING,description:"Describe any blockers or open questions. Omit if none."},observationIds:{type:$.ARRAY,description:"IDs of the observations that informed this update.",items:{type:$.STRING}},confidence:{type:$.NUMBER,description:"Optional confidence score between 0 and 1.",minimum:0,maximum:1},updatedAt:{type:$.STRING,description:"ISO timestamp describing when this snapshot was generated."},currentStepId:{type:$.STRING,description:"The id of the step currently being executed. Must reference one of the declared steps."},steps:{type:$.ARRAY,description:"Full list of steps with their intent + status.",minItems:1,items:{type:$.OBJECT,properties:{id:{type:$.STRING,description:"Stable identifier for the step."},label:{type:$.STRING,description:"Human-readable summary."},intent:{type:$.STRING,description:"High-level intent (e.g., conversation, remove_card)."},status:{type:$.STRING,enum:["ready","in_progress","done","waiting_user"],description:"Current status for the step."}},required:["id","label","status"],additionalProperties:!1}},stateTag:{type:$.STRING,description:'Monotonic tag minted as "<epochMs>-<seq>" or one of the known labels (context_ready, awaiting_clarification, etc.).'}},required:["goal","contextSummary","progress","nextSteps","blockedBy","observationIds","confidence","updatedAt","planId","currentStepId"],additionalProperties:!1},hb={type:$.OBJECT,properties:{actions:{type:$.ARRAY,description:"A sequence of actions for the assistant to perform.",items:{type:$.OBJECT,properties:{thought:{type:$.STRING,description:"The AI's reasoning or thought process before performing the action. This explains *why* this action is being taken. This is a mandatory part of the ReAct pattern."},type:{type:$.STRING,enum:["text_response","plan_creation","dom_action","execute_js_code","proceed_to_analysis","filter_spreadsheet","clarification_request","plan_state_update"],description:"Primary action type identifier. Must align with responseType for backward compatibility."},stateTag:{type:$.STRING,description:'Monotonic tag minted as "<epochMs>-<seq>" that tracks action chronology (or a known label such as awaiting_clarification).'},stepId:{type:$.STRING,description:"The identifier of the plan step this action is advancing. Required for every action including plan_state_update."},responseType:{type:$.STRING,enum:["text_response","plan_creation","dom_action","execute_js_code","proceed_to_analysis","filter_spreadsheet","clarification_request","plan_state_update"]},text:{type:$.STRING,description:"A conversational text response to the user. Required for 'text_response'."},cardId:{type:$.STRING,description:"Optional. The ID of the card this text response refers to. Used to link text to a specific chart."},meta:{type:$.OBJECT,description:"Optional runner hints controlling halt/wait behavior.",properties:{awaitUser:{type:$.BOOLEAN,description:"Set true to pause planning until the user responds."},haltAfter:{type:$.BOOLEAN,description:"Set true to stop auto-continuations after this turn."},resumePlanner:{type:$.BOOLEAN,description:"Set true to explicitly resume the planner after a previous pause."},promptId:{type:$.STRING,description:"Stable identifier for matching follow-up UI (e.g., question cards)."}},additionalProperties:!1},plan:{...kD,description:"Analysis plan object. Required for 'plan_creation'."},planState:{...qD,description:"Summary of the agent goal and progress. Required for 'plan_state_update'."},domAction:{type:$.OBJECT,description:"A DOM manipulation action for the frontend to execute. Required for 'dom_action'.",properties:{toolName:{type:$.STRING,enum:["highlightCard","changeCardChartType","showCardData","filterCard","setTopN","toggleHideOthers","toggleLegendLabel","exportCard","removeCard"]},target:{type:$.OBJECT,description:"Declaration of the DOM target. Provide byId (card id), byTitle, or a CSS selector.",properties:{byId:{type:$.STRING},byTitle:{type:$.STRING},selector:{type:$.STRING}},additionalProperties:!1},args:{type:$.OBJECT,description:"Arguments for the tool. Provide values for all properties; set unused ones to null.",properties:{cardId:{type:$.STRING,description:"The ID of the target analysis card."},cardTitle:{type:$.STRING,description:"Optional title used to look up the card when cardId is unknown (removeCard only)."},newType:{type:$.STRING,enum:["bar","line","pie","doughnut","scatter","combo"],description:"For 'changeCardChartType'."},visible:{type:$.BOOLEAN,description:"For 'showCardData'."},column:{type:$.STRING,description:"For 'filterCard', the column to filter on."},values:{type:$.ARRAY,items:{type:$.STRING},description:"For 'filterCard', the values to include."},topN:{type:$.INTEGER,description:"For 'setTopN'. Provide a positive integer. Omit this field to revert to showing all categories."},hide:{type:$.BOOLEAN,description:"For 'toggleHideOthers'. True hides the 'Others' bucket, false shows it."},label:{type:$.STRING,description:"For 'toggleLegendLabel'. The exact legend label to toggle visibility for."},format:{type:$.STRING,enum:["png","csv","html"],description:"For 'exportCard'. Choose the export format."}},required:["cardId","cardTitle","newType","visible","column","values","topN","hide","label","format"],additionalProperties:!1}},required:["toolName","args"]},code:{type:$.OBJECT,description:"For 'execute_js_code', the code to run.",properties:{explanation:{type:$.STRING,description:"A brief, user-facing explanation of what the code will do."},jsFunctionBody:{type:$.STRING,description:"The non-empty body of a JavaScript function that takes 'data' and returns the transformed 'data'. Blank strings or placeholders are invalid.",minLength:10}},required:["explanation","jsFunctionBody"]},args:{type:$.OBJECT,description:"Arguments for other tools, like 'filter_spreadsheet'.",properties:{query:{type:$.STRING,description:"The natural language query to filter the spreadsheet by."}}},clarification:{...UD,description:"The clarification request object. Required for 'clarification_request'."}},required:["type","responseType","thought","stateTag","stepId"]}}},required:["actions"]},BD=new Map([[$.STRING,"string"],[$.INTEGER,"integer"],[$.NUMBER,"number"],[$.BOOLEAN,"boolean"],[$.ARRAY,"array"],[$.OBJECT,"object"]]),HD=new Set(["","properties.actions.items","properties.actions.items.properties.plan","properties.actions.items.properties.domAction","properties.actions.items.properties.domAction.properties.args","properties.actions.items.properties.code","properties.actions.items.properties.args","properties.actions.items.properties.clarification","properties.actions.items.properties.clarification.properties.options.items","properties.actions.items.properties.clarification.properties.pendingPlan","properties.actions.items.properties.planState","properties.actions.items.properties.planState.properties.nextSteps.items"]),VD=new Set(["properties.actions.items.properties.args","properties.actions.items.properties.plan","properties.actions.items.properties.planState","properties.actions.items.properties.clarification.properties.pendingPlan","properties.plans.items"]),hS=new Set(["properties.actions.items.properties.text","properties.actions.items.properties.stateTag","properties.actions.items.properties.stepId","properties.actions.items.properties.cardId","properties.actions.items.properties.plan","properties.actions.items.properties.plan.properties.aggregation","properties.actions.items.properties.plan.properties.groupByColumn","properties.actions.items.properties.plan.properties.valueColumn","properties.actions.items.properties.plan.properties.xValueColumn","properties.actions.items.properties.plan.properties.yValueColumn","properties.actions.items.properties.plan.properties.secondaryValueColumn","properties.actions.items.properties.plan.properties.secondaryAggregation","properties.actions.items.properties.plan.properties.defaultTopN","properties.actions.items.properties.plan.properties.defaultHideOthers","properties.actions.items.properties.plan.properties.rowFilter","properties.actions.items.properties.plan.properties.rowFilter.properties.column","properties.actions.items.properties.plan.properties.rowFilter.properties.values","properties.actions.items.properties.domAction","properties.actions.items.properties.domAction.properties.args","properties.actions.items.properties.domAction.properties.args.properties.newType","properties.actions.items.properties.domAction.properties.args.properties.visible","properties.actions.items.properties.domAction.properties.args.properties.cardTitle","properties.actions.items.properties.domAction.properties.args.properties.column","properties.actions.items.properties.domAction.properties.args.properties.values","properties.actions.items.properties.domAction.properties.args.properties.topN","properties.actions.items.properties.domAction.properties.args.properties.hide","properties.actions.items.properties.domAction.properties.args.properties.label","properties.actions.items.properties.domAction.properties.args.properties.format","properties.actions.items.properties.code","properties.actions.items.properties.args","properties.actions.items.properties.clarification","properties.actions.items.properties.clarification.properties.pendingPlan","properties.actions.items.properties.clarification.properties.pendingPlan.properties.chartType","properties.actions.items.properties.clarification.properties.pendingPlan.properties.title","properties.actions.items.properties.clarification.properties.pendingPlan.properties.description","properties.actions.items.properties.clarification.properties.pendingPlan.properties.aggregation","properties.actions.items.properties.clarification.properties.pendingPlan.properties.groupByColumn","properties.actions.items.properties.clarification.properties.pendingPlan.properties.valueColumn","properties.actions.items.properties.clarification.properties.pendingPlan.properties.xValueColumn","properties.actions.items.properties.clarification.properties.pendingPlan.properties.yValueColumn","properties.actions.items.properties.clarification.properties.pendingPlan.properties.secondaryValueColumn","properties.actions.items.properties.clarification.properties.pendingPlan.properties.secondaryAggregation","properties.actions.items.properties.clarification.properties.pendingPlan.properties.defaultTopN","properties.actions.items.properties.clarification.properties.pendingPlan.properties.defaultHideOthers","properties.actions.items.properties.clarification.properties.pendingPlan.properties.rowFilter","properties.actions.items.properties.clarification.properties.pendingPlan.properties.rowFilter.properties.column","properties.actions.items.properties.clarification.properties.pendingPlan.properties.rowFilter.properties.values","properties.actions.items.properties.planState","properties.actions.items.properties.planState.properties.contextSummary","properties.actions.items.properties.planState.properties.blockedBy","properties.actions.items.properties.planState.properties.stateTag","properties.jsFunctionBody","properties.plans.items.properties.aggregation","properties.plans.items.properties.groupByColumn","properties.plans.items.properties.valueColumn","properties.plans.items.properties.xValueColumn","properties.plans.items.properties.yValueColumn","properties.plans.items.properties.secondaryValueColumn","properties.plans.items.properties.secondaryAggregation","properties.plans.items.properties.defaultTopN","properties.plans.items.properties.defaultHideOthers","properties.plans.items.properties.rowFilter","properties.plans.items.properties.rowFilter.properties.column","properties.plans.items.properties.rowFilter.properties.values"]),gS=t=>t&&(t.enum&&(t.enum.includes(null)||(t.enum=[...t.enum,null]),t.type||(t.type=["null"])),t.type?Array.isArray(t.type)?t.type.includes("null")||(t.type=[...t.type,"null"]):t.type!=="null"&&(t.type=[t.type,"null"]):t.anyOf||(t.anyOf=[{type:"null"}]),t),as=(t,e="")=>{if(Array.isArray(t))return t.map(n=>as(n,`${e}[]`));if(t&&typeof t=="object"){const n={};for(const[a,r]of Object.entries(t)){if(a==="type"){n.type=BD.get(r)??r;continue}if(a==="properties"&&r&&typeof r=="object"){n.properties={};for(const[l,c]of Object.entries(r)){const f=e?`${e}.properties.${l}`:`properties.${l}`;n.properties[l]=as(c,f)}continue}if(a==="items"){const l=e?`${e}.items`:"items";n.items=as(r,l);continue}n[a]=as(r,e?`${e}.${a}`:a)}if(n.type==="object"&&typeof n.additionalProperties>"u"&&HD.has(e)&&(n.additionalProperties=!1),n.type==="object"&&VD.has(e)){const a=n.properties?Object.keys(n.properties):[];n.required=a}return hS.has(e)?gS(n):n}return hS.has(e)?gS(t):t},gb=as(jp),FD=as(fb),GD=as(pb),zD=as(mb);as(hb);const Si={numberParsing:'- **CRITICAL RULE on NUMBER PARSING**: This is the most common source of errors. To handle numbers that might be formatted as strings (e.g., "$1,234.56", "50%"), you are provided with a safe utility function: `_util.parseNumber(value)`.\n    - **YOU MUST use `_util.parseNumber(value)` for ALL numeric conversions.**\n    - **DO NOT use `parseInt()`, `parseFloat()`, or `Number()` directly.** The provided utility is guaranteed to handle various formats correctly.',splitNumeric:"- **CRITICAL RULE on SPLITTING NUMERIC STRINGS**: If you encounter a single string field that contains multiple comma-separated numbers (which themselves may contain commas as thousand separators, e.g., \"1,234.50,5,678.00,-9,123.45\"), you are provided a utility `_util.splitNumericString(value)` to correctly split the string into an array of number strings.\n    - **YOU MUST use this utility for this specific case.**\n    - **DO NOT use a simple `string.split(',')`**, as this will incorrectly break up numbers.\n    - **Example**: To parse a field 'MonthlyValues' containing \"1,500.00,2,000.00\", your code should be: `const values = _util.splitNumericString(row.MonthlyValues);` This will correctly return `['1,500.00', '2,000.00']`.",dataVsSummaries:`- **Distinguishing Data from Summaries**: Your most critical task is to differentiate between valid data rows and non-data rows (like summaries or metadata).
    - A row is likely **valid data** if it has a value in its primary identifier column(s) (e.g., 'Account Code', 'Product ID') and in its metric columns.
    - **CRITICAL: Do not confuse hierarchical data with summary rows.** Look for patterns in identifier columns where one code is a prefix of another (e.g., '50' is a parent to '5010'). These hierarchical parent rows are **valid data** representing a higher level of aggregation and MUST be kept. Your role is to reshape the data, not to pre-summarize it by removing these levels.
    - A row is likely **non-data** and should be removed if it's explicitly a summary (e.g., contains 'Total', 'Subtotal' in a descriptive column) OR if it's metadata (e.g., the primary identifier column is empty but other columns contain text, like a section header).`,dataframeHelpers:"- **DataFrame Helper DSL**: The runtime provides reliable helpers via `_util`. Use `_util.groupBy(rows, key)`, `_util.pivot(rows, rowKey, columnKey, valueKey, reducer)`, `_util.join(leftRows, rightRows, { leftKey, rightKey, how })`, and `_util.rollingWindow(rows, windowSize, { column, op })` instead of rewriting these routines. These helpers dramatically reduce JavaScript mistakesuse them whenever you need grouping, reshaping, joining, or window calculations."},$D=(t,e,n)=>`
    You are an expert data engineer. Your task is to analyze a raw dataset and, if necessary, provide a JavaScript function to clean and reshape it into a tidy, analysis-ready format. CRITICALLY, you must also provide the schema of the NEW, transformed data with detailed data types.
    A tidy format has: 1. Each variable as a column. 2. Each observation as a row.
    
    Common problems to fix:
    ${Si.numberParsing}
    ${Si.splitNumeric}
    ${Si.dataVsSummaries}
    ${Si.dataframeHelpers}
    - **Crosstab/Wide Format**: Unpivot data where column headers are values (e.g., years, regions).
    - **Multi-header Rows**: Skip initial junk rows.

    Dataset Columns (Initial Schema):
    ${JSON.stringify(t,null,2)}
    Sample Data (up to 20 rows):
    ${JSON.stringify(e,null,2)}
    ${n?`On the previous attempt, your generated code failed with this error: "${n.message}". Please analyze the error and the data, then provide a corrected response.`:""}
    
    Your task:
    1.  **Analyze**: Look at the initial schema and sample data.
    2.  **Plan Transformation**: Decide if cleaning or reshaping is needed. If you identify date or time columns as strings, your function should attempt to parse them into a standard format (e.g., 'YYYY-MM-DD' for dates).
    3.  **Define Output Schema**: Determine the exact column names and types of the data AFTER your transformation. This is the MOST important step. Be as specific as possible with the types. Use 'categorical' for text labels, 'numerical' for general numbers, but you MUST identify and use the more specific types where they apply:
        - **'date'**: For columns containing dates (e.g., "2023-10-26", "10/26/2023").
        - **'time'**: For columns with time values (e.g., "14:30:00").
        - **'currency'**: For columns representing money, especially if they contain symbols like '$' or ','.
        - **'percentage'**: For columns with '%' symbols or values that are clearly percentages.
    4.  **Write Code**: If transformation is needed, write the body of a JavaScript function. This function receives two arguments, \`data\` and \`_util\`, and must return the transformed array of objects.
    5.  **Explain**: Provide a concise 'explanation' of what you did.

    **CRITICAL REQUIREMENTS:**
    - You MUST provide the \`outputColumns\` array. If you don't transform the data, \`outputColumns\` should be identical to the initial schema (but with more specific types if you identified them). If you do transform it, it must accurately reflect the new structure your code creates.
    - Your JavaScript code MUST include a \`return\` statement as its final operation.

    **Example: Reshaping and identifying types using the utility**
    - Initial Data: [{'Product': 'A', 'DateStr': 'Oct 26 2023', 'Revenue': '$1,500.00'}]
    - Explanation: "Standardized the date format and converted the revenue column to a number."
    - jsFunctionBody: "return data.map(row => ({ ...row, DateStr: new Date(row.DateStr).toISOString().split('T')[0], Revenue: _util.parseNumber(row.Revenue) }));"
    - outputColumns: [{'name': 'Product', 'type': 'categorical'}, {'name': 'DateStr', 'type': 'date'}, {'name': 'Revenue', 'type': 'currency'}]
`,YD=(t,e,n)=>`
    You are an expert data analyst. Your task is to convert a user's natural language query into a JavaScript filter function body for a dataset.
    
    **User Query:** "${t}"
    
    **Dataset Columns (Schema):**
    ${JSON.stringify(e,null,2)}
    
    **Sample Data (first 5 rows):**
    ${JSON.stringify(n,null,2)}
    
    **CRITICAL Rules for Code Generation:**
    ${Si.numberParsing}
    ${Si.dataframeHelpers}
    - When comparing strings, convert both the data and the comparison value to the same case (e.g., lower case) using \`.toLowerCase()\` to ensure case-insensitive matching.
    - For date comparisons, you can use \`new Date(row.date_column) > new Date('YYYY-MM-DD')\`.
    - The function you write will be the body of a new Function that receives 'data' (the full array of objects) and '_util'.
    - Your function body MUST start with \`return data.filter(row => ...);\`.
    
    **Your Task:**
    1.  **Analyze Query:** Understand the user's intent. Identify columns, values, and operators (e.g., >, <, =, contains).
    2.  **Write JS Code:** Write a single line of JavaScript that filters the data array.
    3.  **Explain:** Briefly explain the filter you created in plain language.
    
    **Example:**
    - User Query: "show me all rows where sales > 5000 and region is North America"
    - Columns: [{ name: 'sales', type: 'currency' }, { name: 'region', type: 'categorical' }]
    - Your Response (JSON):
    {
      "explanation": "Filtering for rows where 'sales' is greater than 5000 and 'region' is 'North America'.",
      "jsFunctionBody": "return data.filter(row => _util.parseNumber(row.sales) > 5000 && row.region.toLowerCase() === 'north america');"
    }
`,JD=(t,e,n,a)=>`
    You are a senior business intelligence analyst specializing in ERP and financial data. Your task is to generate a diverse list of insightful analysis plan candidates for a given dataset by identifying common data patterns.
    
    Dataset columns:
    - Categorical: ${t.join(", ")}
    - Numerical: ${e.join(", ")}
    Sample Data (first 5 rows):
    ${JSON.stringify(n,null,2)}
    
    Please generate up to ${a} diverse analysis plans.
    **MANDATORY COPY RULE**: Every plan MUST include a natural-language \`description\` (at least 8 characters) that states what the user will learn. Do not leave it blank or use placeholders.
    
    **CRITICAL: Think like a Business/ERP Analyst.**
    1.  **Identify Key Metrics**: First, find the columns that represent measurable values. Look for names like 'VALUE', 'AMOUNT', 'SALES', 'COST', 'QUANTITY', 'PRICE'. These are almost always the columns you should be aggregating (e.g., using 'sum' or 'avg').
    2.  **Identify Dimensions**: Next, find columns that describe the data. Look for names ending in 'CODE', 'ID', 'TYPE', 'CATEGORY', or containing 'NAME', 'DESCRIPTION', 'PROJECT', 'REGION'. These are your primary grouping columns (dimensions).
    3.  **Find Relationships**: Codes and descriptions often go together (e.g., 'PROJECT_CODE' and 'PROJECT_DESCRIPTION'). A very valuable analysis is to group by a description column (which is more human-readable for a chart) and sum a value column.
    4.  **Prioritize High-Value Aggregations**: Focus on creating plans that answer common business questions like 'What are our top revenue sources?', 'Where are the biggest costs?', or 'How are items distributed across categories?'. A simple 'count' is less valuable than a 'sum' of a 'VALUE' or 'AMOUNT' column.
    
    **Example Task**: Given columns ['CODE', 'DESCRIPTION', 'PROJECT_CODE', 'VALUE'], a HIGH-QUALITY plan would be:
    - Title: "Sum of VALUE by DESCRIPTION"
    - Aggregation: 'sum'
    - groupByColumn: 'DESCRIPTION'
    - valueColumn: 'VALUE'
    - Chart Type: 'bar'
    
    For each plan, choose the most appropriate chartType ('bar', 'line', 'pie', 'doughnut', 'scatter', 'combo'). 
    - Use 'line' for time series trends.
    - Use 'bar' for most categorical comparisons, especially for "top X" style reports.
    - Use 'pie' or 'doughnut' for compositions with few categories.
    - Use 'scatter' to show the relationship between two numerical variables.
    - **Use 'combo' (bar + line) to compare two different metrics against the same category (e.g., sum of 'Sales' as bars and average of 'Profit' as a line). You MUST provide both a primary and secondary value column and aggregation for combo charts.**
    
    Rules:
    - For 'scatter' plots, you MUST provide 'xValueColumn' and 'yValueColumn' (both numerical) and you MUST NOT provide 'aggregation' or 'groupByColumn'.
    - For 'combo' charts, you MUST provide 'groupByColumn', 'valueColumn', 'aggregation', 'secondaryValueColumn', and 'secondaryAggregation'.
    - **CRITICAL**: Only use one of the following aggregation types: 'sum', 'count', 'avg'. Do NOT use other statistical measures like 'stddev', 'variance', 'median', etc.
    - Do not create plans that are too granular (e.g., grouping by a unique ID column if there are thousands of them).
    - Never leave the \`description\` empty; summarize the business takeaway in a sentence.

    **Output Format:** Return a single JSON object with this shape:
    {
        "plans": [ /* array of plan objects */ ]
    }
    Do not include any other top-level properties or commentary.
`,KD=t=>`
    You are a Quality Review Data Analyst. Your job is to review a list of proposed analysis plans and their data samples. Your goal is to select ONLY the most insightful and readable charts for the end-user, and configure them for the best default view.
    
    **Review Criteria & Rules:**
    1.  **Discard Low-Value Charts**: This is your most important task. You MUST discard any plan that is not genuinely insightful.
        - **Example of a low-value chart**: A bar chart where all values are nearly identical (e.g., [77, 77, 77, 76, 78]). This shows uniformity but is not a useful visualization. DISCARD IT.
        - **Example of another low-value chart**: A pie/doughnut chart where one category makes up over 95% of the total. This is not insightful. DISCARD IT.
    2.  **Discard Unreadable Charts**: If a chart groups by a high-cardinality column resulting in too many categories to be readable (e.g., more than 50 tiny bars), discard it unless it's a clear time-series line chart.
    3.  **Configure for Readability**: For good, insightful charts that have a moderate number of categories (e.g., 15 to 50), you MUST add default settings to make them readable. Set \`defaultTopN\` to 8 and \`defaultHideOthers\` to \`true\`.
    4.  **Keep Good Charts**: If a chart is insightful and has a reasonable number of categories (e.g., under 15), keep it as is without adding default settings.
    5.  **Copy Quality Gate**: Reject any plan whose \`description\` is blank, shorter than 8 characters, or not an explanatory sentence.
    6.  **Return the Result**: Your final output must be a JSON object shaped as { "plans": [ ... ] } containing ONLY the good, configured plan objects. Do not include the discarded plans or any additional commentary.
    
    **Proposed Plans and Data Samples:**
    ${JSON.stringify(t,null,2)}
`,jD=(t,e,n)=>{const a=n==="Mandarin"?`Provide a concise, insightful summary in two languages, separated by '---'.
Format: English Summary --- Mandarin Summary`:`Provide a concise, insightful summary in ${n}.`;return`
        You are a business intelligence analyst.
        The following data is for a chart titled "${t}".
        Data:
        ${JSON.stringify(e.slice(0,10),null,2)} 
        ${e.length>10?`(...and ${e.length-10} more rows)`:""}
        ${a}
        The summary should highlight key trends, outliers, or business implications. Do not just describe the data; interpret its meaning.
        For example, instead of "Region A has 500 sales", say "Region A is the top performer, contributing the majority of sales, which suggests a strong market presence there."
    `},XD=(t,e,n)=>`
    You are a senior data analyst. After performing an initial automated analysis of a dataset, your task is to create a concise "Core Analysis Briefing". This briefing will be shown to the user and will serve as the shared foundation of understanding for your conversation.
    Based on the columns and the analysis cards you have just generated, summarize the dataset's primary characteristics.
    Your briefing should cover:
    1.  **Primary Subject**: What is this data fundamentally about? (e.g., "This dataset appears to be about online sales transactions...")
    2.  **Key Metrics**: What are the most important numerical columns? (e.g., "...where the key metrics are 'Sale_Amount' and 'Profit'.")
    3.  **Core Dimensions**: What are the main categorical columns used for analysis? (e.g., "The data is primarily broken down by 'Region' and 'Product_Category'.")
    4.  **Suggested Focus**: Based on the initial charts, what should be the focus of further analysis? (e.g., "Future analysis should focus on identifying the most profitable regions and product categories.")
    
    **Available Information:**
    - **Dataset Columns**: ${JSON.stringify(e.map(a=>a.name))}
    - **Generated Analysis Cards**: ${JSON.stringify(t,null,2)}
    
    Produce a single, concise paragraph in ${n}. This is your initial assessment that you will share with your human counterpart.
`,QD=(t,e)=>`
    You are a proactive data analyst. Review the following summaries of data visualizations you have created. Your task is to identify the single most commercially significant or surprising insight. This could be a major trend, a key outlier, or a dominant category that has clear business implications.
    
    **Generated Analysis Cards & Data Samples:**
    ${JSON.stringify(t,null,2)}

    Your Task:
    1.  **Analyze**: Review all the cards provided.
    2.  **Identify**: Find the ONE most important finding. Don't list everything, just the top insight.
    3.  **Formulate**: Write a concise, user-facing message in ${e} that explains this insight (e.g., "I noticed that sales in August were unusually high, you might want to investigate what caused this spike.").
    4.  **Respond**: Return a JSON object containing this message and the ID of the card it relates to.
`,WD=(t,e)=>`
    You are a senior business strategist. You have been provided with several automated data analyses.
    Your task is to synthesize these individual findings into a single, high-level executive summary in ${e}.
    Here are the individual analysis summaries (they are in English):
    ${t}
    Please provide a concise, overarching summary that connects the dots between these analyses. 
    Identify the most critical business insights, potential opportunities, or risks revealed by the data as a whole.
    Do not just repeat the individual summaries. Create a new, synthesized narrative.
    Your response should be a single paragraph of insightful business analysis.
`,ZD=(t,e,n,a,r,l,c,f)=>{const y=t.slice(0,20).map(x=>`${x.name} (${x.type})`).join(", "),p=f.length>0?f.map(x=>`- ${x.title}`).join(`
`):"No analysis cards created yet.",m=l.length>0?l.slice(0,3).join(`
---
`):"No long-term memory snippets selected.",v=c.length>0?c.slice(-3).map(x=>`- [${x.status.toUpperCase()}] ${x.responseType}`).join(`
`):"No recent tool observations available.",_=e.length>0?e.slice(-6).map(x=>`${x.sender==="ai"?"You":"User"}: ${x.text}`).join(`
`):"No prior conversation.";return`
        You are beginning STEP 1 of a multi-stage workflow. Your sole objective in this turn is to emit a high-quality \`plan_state_update\` action that sets the shared goal tracker for the UI. Do **not** run tools, transformations, or DOM actions yet.

        Requirements for this response:
        - The first action must be \`plan_state_update\` with goal, contextSummary, progress, nextSteps (each having id + label), blockedBy (or null), observationIds (array, can be empty), confidence (0-1 or null), and updatedAt.
        - Every action you send must include \`type\`, \`responseType\`, \`stepId\`, and a monotonic \`stateTag\` formatted as "<epochMs>-<seq>" (set \`stateTag\` even on plan_state_update). 
        - The plan_state_update payload must include \`planId\`, \`currentStepId\`, and a comprehensive \`steps\` array where each entry has \`intent\` and \`status\` (\`ready\`|\`in_progress\`|\`done\`).
        - You may optionally include one short \`text_response\` after the plan_state_update to acknowledge the plan to the user in ${a}, but do not trigger other action types.
        - If the user's latest message is merely a greeting or check-in (e.g., "hi", "hello there", ""), still include a first nextSteps entry with id "acknowledge_user" and a label that confirms you will greet/clarify with them before moving to data work.
        - Keep nextSteps focused on the minimum set of concrete moves (e.g., build chart, run filter, gather clarification). Reference dataset columns exactly as they appear.

        Helpful context:
        - Column inventory: ${y||"No columns detected."}
        - Existing analysis cards: 
        ${p}
        - Core analysis briefing: ${r||"Not generated yet."}
        - Long-term memory snippets: 
        ${m}
        - Recent runtime observations:
        ${v}

        Recent conversation:
        ${_}

        The user's latest request is: "${n}"

        Output your answer as a JSON object with an "actions" array. Remember: stay in planning mode only; do not issue executions until the goal tracker is established.
    `},eP=(t,e,n,a,r,l,c,f,y,p,m,v,_)=>{const x=t.filter(M=>M.type==="categorical"||M.type==="date"||M.type==="time").map(M=>M.name),w=t.filter(M=>M.type==="numerical"||M.type==="currency"||M.type==="percentage").map(M=>M.name),A=e.slice(-10).map(M=>`${M.sender==="ai"?"You":"User"}: ${M.text}`).join(`
`),N=`${v.length>0?v.slice(-5).map(M=>`- [${M.source}/${M.status.toUpperCase()}] ${M.actionType}: ${M.summary}${M.details?` (${M.details})`:""}`).join(`
`):"No prior tool actions have been recorded yet. You are starting fresh. Always observe before acting."}
- [DATA_VIEW] Raw Data Explorer filter: ${_}`,I=y.length>0?y.slice(-5).map(M=>{const z=M.outputs?JSON.stringify(M.outputs).slice(0,160):"No structured output reported.";return`- [${M.status.toUpperCase()}] ${M.responseType} (action ${M.actionId.slice(-6)}): ${z}`}).join(`
`):"No runtime observations captured yet for this session.",R=p?`Goal: ${p.goal}
Context: ${p.contextSummary||""}
Progress: ${p.progress}
Next Steps:
${p.nextSteps.map((M,z)=>`  ${z+1}. [${M.id}] ${M.label}`).join(`
`)}
Blocked By: ${p.blockedBy||"Nothing reported."}
Confidence: ${typeof p.confidence=="number"?p.confidence.toFixed(2):"Not provided"}
Referenced Observations: ${p.observationIds&&p.observationIds.length>0?p.observationIds.join(", "):"None specified."}`:"No structured goal has been recorded yet. Your first action must be a plan_state_update that defines a clear goal, ties it to current data, and lists concrete next steps.";return`
        You are an expert data analyst and business strategist, required to operate using a Reason-Act (ReAct) framework. For every action you take, you must first explain your reasoning in the 'thought' field, and then define the action itself. Your goal is to respond to the user by providing insightful analysis and breaking down your response into a sequence of these thought-action pairs. Your final conversational responses should be in ${r}.
        
        **PLAN TRACKER PROTOCOL (Follow exactly):**
        - Every action JSON object MUST include \`type\`, \`responseType\`, \`stepId\`, and a monotonic \`stateTag\` formatted as "<epochMs>-<seq>" (or a supported label such as \`awaiting_clarification\`).
        - Every \`plan_state_update\` action MUST list \`nextSteps\` as objects with \`id\` (kebab-case, >=3 characters) and \`label\` (clear description).
        - For EVERY other action (text_response, dom_action, execute_js_code, etc.) you MUST set \`stepId\` to the \`id\` of the plan step you are executing. If you need a brand-new step, emit a new plan_state_update first.
        - The plan_state_update payload must include \`planId\`, \`currentStepId\`, and a \`steps\` array where each entry has \`intent\` and \`status\` (\`ready\`|\`in_progress\`|\`done\`).
        - Emit at most **two actions per turn**: the \`plan_state_update\` plus a single atomic action (text response, clarification, dom_action, etc.).
        - For any \`dom_action\`, include \`domAction.target\` with either \`byId\`, \`byTitle\`, or \`selector\`. If you cannot resolve a target, downgrade to a \`text_response\` explaining that the user must choose a card.
        - When you complete a step, your thought must explicitly mention it, and you should remove or reorder steps in the following plan_state_update so the UI stays in sync. If you are waiting on user input or clarification, set \`plan_state_update.blockedBy\` to describe the outstanding question AND set \`plan_state_update.stateTag\` to \`awaiting_clarification\`; this tells the runtime to pause automatic continuing.

        **CORE ANALYSIS BRIEFING (Your Internal Summary):**
        ---
        ${l||"No core analysis has been performed yet."}
        ---
        **DATA PREPARATION LOG (How the raw data was initially cleaned):**
        ---
        ${m?`Explanation: ${m.explanation}
Code Executed: \`\`\`javascript
${m.jsFunctionBody}
\`\`\``:"No AI-driven data preparation was performed."}
        ---
        **LONG-TERM MEMORY (Relevant past context, ordered by relevance):**
        ---
        ${f.length>0?f.join(`
---
`):"No specific long-term memories seem relevant to this query."}
        ---
        **AGENT PLAN STATE (Goal tracker shared with the UI):**
        ---
        ${R}
        ---
        **Your Knowledge Base (Real-time Info):**
        - **Dataset Columns**:
            - Categorical: ${x.join(", ")}
            - Numerical: ${w.join(", ")}
        - **Analysis Cards on Screen (Sample of up to 100 rows each)**:
            ${a.length>0?JSON.stringify(a,null,2):"No cards yet."}
        - **Raw Data Sample (first 20 rows):**
            ${c.length>0?JSON.stringify(c,null,2):"No raw data available."}

        **Agent Runtime (Pipeline Awareness):**
        - The frontend runs you through **Context Builder  Planner  Action Dispatcher**. Stay concise so downstream executors can follow the plan.
        - Each action **must** include a \`stateTag\` (use either a known label such as \`context_ready\` or mint "<epochMs>-<seq>" tokens to keep them strictly increasing).

        **Recent Conversation (for flow):**
        ${A}

        **Your Recent Tool Actions (Observe  Check  Act log):**
        ${N}
        
        **Runtime Observations (Newest up to 5):**
        ${I}

        **The user's latest message is:** "${n}"

        **Your Available Actions & Tools:**
        You MUST respond by creating a sequence of one or more actions in a JSON object.
        1.  **text_response**: For conversation. If your text explains a specific card, you MUST include its 'cardId'.
        2.  **plan_creation**: To create a NEW chart. Use a 'defaultTopN' of 8 for readability on high-cardinality columns. When the user limits the analysis to a specific entity/segment (e.g., only Allylink Pte Ltd), populate \`plan.rowFilter\` with \`{ column, values[] }\` so the dataset is sliced *before* aggregation. Matching values must use the exact text that appears in the spreadsheet; include every relevant alias if there are multiple spellings. Always inspect the raw rows/cards to confirm the spelling; when multiple candidates exist, list them explicitly and, if you still cannot decide, issue a \`clarification_request\` with those concrete values instead of guessing. **Important**: if the user does NOT re-affirm the previous filter when they switch topics (for example, they now want a global Project Code view after looking at a single Account), you must reset \`plan.rowFilter\` to \`null\` so the new card covers the full dataset by default. **If the next pending plan step is to build or adjust a chart, your very next action MUST be a \`plan_creation\` (or relevant chart \`dom_action\`) and your \`thought\` must explicitly say you are carrying out that chart step (e.g., "Building the invoice_month_standard bar chart now"). Do NOT run other tools (e.g., \`execute_js_code\`) until that chart step is satisfied.**
        3.  **dom_action**: To INTERACT with an EXISTING card. Available tools: 
            - \`highlightCard\`: Scroll and spotlight a chart.
            - \`changeCardChartType\`: Switch among bar/line/pie/doughnut/scatter/combo.
            - \`showCardData\`: Toggle the full data table visibility (set \`visible\` true/false).
            - \`filterCard\`: Apply the card-level categorical filter (specify \`column\` + \`values\` array).
            - \`setTopN\`: Change the Top N dropdown. Provide a positive \`topN\` integer; omit it to revert to All.
            - \`toggleHideOthers\`: Check/uncheck the Hide Others box (pass \`hide: true\`/false, or omit to flip).
            - \`toggleLegendLabel\`: Simulate clicking a legend label (\`label\` must match the on-screen text exactly).
            - \`exportCard\`: Trigger the export menu (\`format\` = 'png' | 'csv' | 'html').
            - \`removeCard\`: Remove an incorrect/irrelevant chart. Pass the exact \`cardId\` (preferred). If you only know the title, set \`cardTitle\` and the runtime will resolve the matching card when possible.
        4.  **execute_js_code**: For PERMANENT data transformations (creating new columns, deleting rows). This action WILL modify the main dataset and cause ALL charts to regenerate. Whenever you emit this action you MUST supply a fully-formed JavaScript function body (no placeholders, no empty strings). Use the provided helpers\`_util.parseNumber\`, \`_util.splitNumericString\`, \`_util.groupBy\`, \`_util.pivot\`, \`_util.join\`, and \`_util.rollingWindow\`instead of writing ad-hoc code for these operations. If you cannot write the code confidently, do NOT emit this actionexplain the limitation instead. Use it for requests like "Remove all data from the USA".
        5.  **filter_spreadsheet**: For TEMPORARY, exploratory filtering of the Raw Data Explorer view. This action does NOT modify the main dataset and does NOT affect the analysis cards. Use it for requests like "show me record ORD1001" or "find all entries for Hannah". If the user expects the final chart to stay filtered, you must encode that scope inside \`plan.rowFilter\` (or permanently transform the data) instead of relying on this temporary tool. If the user simply says "show the raw data" without a specific condition, set \`args.query\` to \`"show entire table"\` (or leave it blank) so the UI will reveal every row.
        6.  **clarification_request**: To ask the user for more information when their request is ambiguous.
            - **Use Case**: The user says "show sales" but there are multiple sales-related columns ('Sales_USD', 'Sales_Units'). DO NOT GUESS. Ask for clarification.
            - **Auto-Resolve Rule**: If there is only ONE reasonable column/dimension that fits the request (e.g., the dataset only contains a single revenue column), you must confidently pick it yourself and continue without asking the user.
            - **Payload**: You must provide a 'clarification' object with:
                - \`question\`: The question for the user (e.g., "Which sales metric do you mean?").
                - \`options\`: Provide user-friendly \`label\` text, but the \`value\` MUST match a real column name exactly (including case/underscores) so the UI can plug it directly into the plan. Never invent or paraphrase column ids.
                - \`pendingPlan\`: The partial plan you have constructed so far. **You MUST fill out the other fields of the plan with your best guess.** For example, when asking about the \`valueColumn\`, you must still provide a sensible \`groupByColumn\`, \`aggregation\` (e.g., 'sum'), and \`chartType\` (e.g., 'bar'). The user is only clarifying one missing piece.
                - \`targetProperty\`: The name of the property in the plan that the user's choice will fill (e.g., "valueColumn").

        **Decision-Making Process (Observe  Think  Act):**
        - **StateTag Etiquette**: Whenever you finish an action, populate \`stateTag\` with a short label of the state you are leaving the system in (examples: \`context_ready\`, \`clarifying\`, \`transform_ready\`, \`analysis_shared\`). This helps downstream middleware route follow-ups.
        - **OBSERVE**: Begin every response by explicitly noting what you see in the dataset, the existing cards, and the user's prompt. Observe before you plan. When creating a new plan, OBSERVE the relevant raw data sample (up to 20 rows) and any existing cards to understand context.
        - **THINK (Reason)**: After observing, reason about the user's request. What is their goal? Can it be answered from memory, or does it require new analysis? What is the first logical step? Formulate this reasoning and place it in the 'thought' field of your action. This field is MANDATORY for every action and must reference what you just observed.
        - **ACT**: Based on your thought, choose the most appropriate action from your toolset and define its parameters in the same action object.
        - **CRITICAL RULE ON AMBIGUITY**: If the user's request is ambiguous, you must either resolve it yourself (when there is only one reasonable interpretation) or use the \`clarification_request\` action. For example, if they ask to group by "category" and there is a "Product_Category" and a "Customer_Category" column, you must ask them to clarify which one they intend to use. But if there is only one "category" column, proceed without asking. When you do ask, ensure every option's \`value\` is an actual column name from the dataset (case-sensitive, including underscores).
        **Multi-Step Task Planning:** For complex requests that require multiple steps (e.g., "compare X and Y, then summarize"), you MUST adopt a planner persona.
        1.  **Plan-State Loop**: Every turn must begin with a \`plan_state_update\` action. Use it to restate the latest user goal (or refine the previous one), summarize what you learned from prior observations, list concrete next steps, and cite observation IDs you are relying on. Update this again whenever your understanding materially changes.
        2.  **Formulate a Plan**: In the \`thought\` of your VERY FIRST non-plan_state action, outline your tactical steps ("Plan: 1. ...").
        3.  **Execute the Plan**: Decompose your plan into a sequence of \`actions\`. Each action must have its own \`thought\` explaining that specific step. This allows you to chain tools together to solve the problem.
        - **CRITICAL**: If the user asks where a specific data value comes from (like 'Software Product 10') or how the data was cleaned, you MUST consult the **DATA PREPARATION LOG**. Use a 'text_response' to explain the transformation in simple, non-technical language. You can include snippets of the code using markdown formatting to illustrate your point.
        - **Suggest Next Steps**: After successfully answering the user's request, you should add one final \`text_response\` action to proactively suggest a logical next step or a relevant follow-up question. This guides the user and makes the analysis more conversational. Example: "Now that we've seen the regional breakdown, would you like to explore the top-performing product categories within the East region?"
        - **EXAMPLE of Chaining**:
          1.  Action 1: { type: 'execute_js_code', responseType: 'execute_js_code', stepId: 'derive-profit-margin', stateTag: '1731234567890-1', thought: "The user is asking for profit margin, but that column doesn't exist. I need to calculate it from 'Revenue' and 'Cost'.", code: { ... } }
          2.  Action 2: { type: 'plan_creation', responseType: 'plan_creation', stepId: 'plan-profit-margin-chart', stateTag: '1731234567890-2', thought: "Now that I have the 'Profit Margin' column, I need to create a chart to find the product with the highest average margin.", plan: { ... } }
          3.  Action 3: { type: 'text_response', responseType: 'text_response', stepId: 'summarize-profit-margin', stateTag: '1731234567890-3', thought: "The chart is created. I can now see the result and answer the user's question, explaining what I did.", text: "I've calculated the profit margin and created a new chart. It looks like 'Product A' has the highest margin." }
        - Always be conversational. Use 'text_response' actions to acknowledge the user and explain what you are doing, especially after a complex series of actions.
    `},tP=async(t,e,n,a)=>{var l,c;let r;for(let f=0;f<3;f++){if((l=a==null?void 0:a.signal)!=null&&l.aborted)throw new DOMException("Aborted","AbortError");try{let y;const p=$D(t,e,r);if(n.provider==="openai"){if(!n.openAIApiKey)return{explanation:"No transformation needed as API key is not set.",jsFunctionBody:null,outputColumns:t};y=await us(n,[{role:"system",content:`You are an expert data engineer. Your task is to analyze a raw dataset and, if necessary, provide a JavaScript function to clean and reshape it into a tidy, analysis-ready format. CRITICALLY, you must also provide the schema of the NEW, transformed data with detailed data types.
You MUST respond with a single valid JSON object, and nothing else. The JSON object must adhere to the provided schema.`},{role:"user",content:p}],{name:"DataPreparationPlan",schema:FD,strict:!0},a==null?void 0:a.signal)}else{if(!n.geminiApiKey)return{explanation:"No transformation needed as Gemini API key is not set.",jsFunctionBody:null,outputColumns:t};y=await cs(n,p,fb,a==null?void 0:a.signal)}const m=JSON.parse(y);if(m.jsFunctionBody)try{const v={parseNumber:w=>parseFloat(String(w).replace(/[$,%]/g,""))||0,splitNumericString:w=>w.split(",")},x=new Function("data","_util",m.jsFunctionBody)(e,v);if(!Array.isArray(x))throw new Error("Generated function did not return an array.");return m}catch(v){r=v,console.warn(`AI self-correction attempt ${f+1} failed due to JS execution error. Retrying...`,r);continue}return!m.jsFunctionBody&&(!m.outputColumns||m.outputColumns.length===0)&&(m.outputColumns=t),m}catch(y){if((c=a==null?void 0:a.signal)!=null&&c.aborted)throw y;console.error(`Error in data preparation plan generation (Attempt ${f+1}):`,y),r=y}}throw new Error(`AI failed to generate a valid data preparation plan after multiple attempts. Last error: ${r==null?void 0:r.message}`)},nP=new Set(["sum","count","avg"]),yb=t=>{if(!t||typeof t!="object"||!t.chartType||!t.title)return console.warn("Skipping invalid plan: missing chartType or title.",t),!1;if(!t.description||typeof t.description!="string"||t.description.trim().length<8)return console.warn("Skipping invalid plan: description missing or too short.",t),!1;if(t.chartType==="scatter"){if(!t.xValueColumn||!t.yValueColumn)return console.warn("Skipping invalid scatter plot plan: missing xValueColumn or yValueColumn.",t),!1}else{if(!t.aggregation||!t.groupByColumn)return console.warn(`Skipping invalid plan: missing aggregation or groupByColumn for chart type ${t.chartType}.`,t),!1;if(!nP.has(t.aggregation))return console.warn(`Skipping invalid plan: unsupported aggregation type "${t.aggregation}".`,t),!1;if(t.aggregation!=="count"&&!t.valueColumn)return console.warn("Skipping invalid plan: missing valueColumn for sum/avg aggregation.",t),!1}return!0},vb=async(t,e,n,a,r)=>{const l=t.filter(p=>p.type==="categorical"||p.type==="date"||p.type==="time").map(p=>p.name),c=t.filter(p=>p.type==="numerical"||p.type==="currency"||p.type==="percentage").map(p=>p.name);let f;const y=JD(l,c,e,a);if(n.provider==="openai"){const v=await us(n,[{role:"system",content:`You are a senior business intelligence analyst specializing in ERP and financial data. Your task is to generate a diverse list of insightful analysis plan candidates for a given dataset by identifying common data patterns.
You MUST respond with JSON that adheres exactly to the provided schema (an array of plan objects) and includes no extra commentary.`},{role:"user",content:y}],{name:"AnalysisPlanArray",schema:gb,strict:!0},r);f=tu(v)}else{const p=await cs(n,y,jp,r);f=tu(p)}return f.filter(yb)},sP=async(t,e,n)=>{let a;const r=KD(t);if(e.provider==="openai"){const y=await us(e,[{role:"system",content:`You are a Quality Review Data Analyst. Your job is to review a list of proposed analysis plans and their data samples. Select ONLY the most insightful and readable charts and configure them for the best default view.
You MUST respond with JSON that strictly adheres to the provided schema (an array of plan objects) and contains no additional explanation.`},{role:"user",content:r}],{name:"RefinedAnalysisPlanArray",schema:gb,strict:!0},n);a=tu(y)}else{const c=await cs(e,r,jp,n);a=tu(c)}return a.map(c=>c&&c.plan&&typeof c.plan=="object"?c.plan:c).filter(yb)},aP=async(t,e,n,a)=>{if(!(n.provider==="google"&&!!n.geminiApiKey||n.provider==="openai"&&!!n.openAIApiKey))throw new Error("API Key not provided.");const l=await vb(t,e,n,12,a==null?void 0:a.signal);if(l.length===0)return[];const c={fileName:"sample",data:e},f=l.map(m=>{try{const v=y_(c,m);return v.length>0?{plan:m,aggregatedSample:v.slice(0,20)}:null}catch(v){return console.warn(`Execution of plan "${m.title}" failed during review stage:`,v),null}}).filter(m=>m!==null);if(f.length===0)return console.warn("No candidate plans produced data for AI review, returning initial valid candidates."),l.slice(0,4);let p=await sP(f,n,a==null?void 0:a.signal);if(p.length<4&&l.length>p.length){const m=new Set(p.map(x=>x.title)),v=l.filter(x=>!m.has(x.title)),_=4-p.length;p.push(...v.slice(0,_))}return p.slice(0,12)};class Sb extends Error{constructor(e,n,a){super(e),this.name="PlanGenerationFatalError",this.warnings=n,a&&(this.cause=a)}}const iP=async(t,e,n,a)=>{if(!(n.provider==="google"&&!!n.geminiApiKey||n.provider==="openai"&&!!n.openAIApiKey))throw new Error("API Key not provided.");const l=[];try{return{plans:await aP(t,e,n,a),warnings:l}}catch(c){const f=c instanceof cb,y=f?"AI plan response was not valid JSON. Retrying with a simpler generator.":"AI plan generator failed on the first attempt. Retrying with a simpler prompt.";l.push({code:f?"plan_parse_error":"plan_generation_error",message:y,hint:"If this happens repeatedly, ask the assistant to retry with fewer plans."}),console.warn("Plan generation warning:",c);try{return{plans:await vb(t,e,n,8,a==null?void 0:a.signal),warnings:l}}catch(p){throw console.error("Fallback plan generation also failed:",p),new Sb("Failed to generate any analysis plans from AI.",l,p)}}},rP=t=>t.actions.some(e=>{var a;if(e.responseType!=="execute_js_code")return!1;const n=(a=e.code)==null?void 0:a.jsFunctionBody;return!n||n.trim().length===0}),oP=async(t,e,n,a,r,l,c,f,y,p,m,v,_,x,w)=>{if(!(r.provider==="google"&&!!r.geminiApiKey||r.provider==="openai"&&!!r.openAIApiKey))return{actions:[{type:"text_response",responseType:"text_response",stepId:"ad_hoc_response",stateTag:`${Date.now()}-1-fallback`,text:"Cloud AI is disabled. API Key not provided.",thought:"API key is missing, so I must inform the user."}]};try{const C=(w==null?void 0:w.mode)??"full",N=C==="plan_only"?ZD(t,e,n,r.language,l,y,p,a):eP(t,e,n,a,r.language,l,f,y,p,m,v,_,x);if(w!=null&&w.onPromptProfile){const z=C==="plan_only"?"chat_plan_primer":"chat_full",B=N.length,k=Math.ceil(B/4);w.onPromptProfile({mode:C,charCount:B,estimatedTokens:k,promptLabel:z})}const I=`You are an expert data analyst and business strategist, required to operate using a Reason-Act (ReAct) framework. For every action you take, you must first explain your reasoning in the 'thought' field, and then define the action itself. You also maintain an explicit goal tracker by emitting a 'plan_state_update' action at the start of each response (and whenever the mission changes) so the UI can display your progress. Every action JSON object must include \`type\`, \`responseType\`, \`stepId\`, and a monotonic \`stateTag\` formatted as "<epochMs>-<seq>" (or a known label like \`awaiting_clarification\`). The plan_state_update payload must include \`planId\`, \`currentStepId\`, and a \`steps\` array (each entry with intent + status). Emit at most two actions per response: the plan_state_update plus a single atomic action. Your final conversational responses should be in ${r.language}.
Your output MUST be a single JSON object with an "actions" key containing an array of action objects.`,R=r.provider==="openai"?2:1;let M="";for(let z=0;z<R;z++){let B;if(r.provider==="openai"){const Z=[{role:"system",content:`${I}${M}`},{role:"user",content:N}];B=await us(r,Z,!0,w==null?void 0:w.signal)}else B=await cs(r,N,hb,w==null?void 0:w.signal);const k=JSON.parse(B);if(!k.actions||!Array.isArray(k.actions))throw new Error("Invalid response structure from AI: 'actions' array not found.");if(r.provider==="openai"&&rP(k)&&z<R-1){M=`
IMPORTANT VALIDATION FAILURE: Your previous response included an action with responseType=execute_js_code but did not include a valid code.jsFunctionBody. You must respond with executable JavaScript that mutates the provided data and returns the updated array (including an explicit return statement). Provide only valid JSON matching the required schema.`;continue}return k}throw new Error("Failed to obtain a valid AI response after retries.")}catch(C){throw console.error("Error generating chat response:",C),new Error(`Failed to get a valid response from the AI. ${C instanceof Error?C.message:""}`)}},lP=async(t,e,n,a,r)=>{var c,f;let l;for(let y=0;y<2;y++){if((c=r==null?void 0:r.signal)!=null&&c.aborted)throw new DOMException("Aborted","AbortError");try{let p;const m=YD(t,e,n);a.provider==="openai"?p=await us(a,[{role:"system",content:"You are an expert data analyst. Your task is to convert a user's natural language query into a JavaScript filter function body for a dataset. You MUST respond with a single valid JSON object, and nothing else. The JSON object must adhere to the provided schema."},{role:"user",content:m}],{name:"FilterFunctionResponse",schema:GD,strict:!0},r==null?void 0:r.signal):p=await cs(a,m,pb,r==null?void 0:r.signal);const v=JSON.parse(p);if(v.jsFunctionBody&&v.explanation)return v;throw new Error("AI response was missing required fields 'jsFunctionBody' or 'explanation'.")}catch(p){if((f=r==null?void 0:r.signal)!=null&&f.aborted)throw p;console.error(`Error in filter function generation (Attempt ${y+1}):`,p),l=p}}throw new Error(`AI failed to generate a valid filter function. Last error: ${l==null?void 0:l.message}`)},uP=async(t,e,n,a)=>{if(!(n.provider==="google"&&!!n.geminiApiKey||n.provider==="openai"&&!!n.openAIApiKey))return"AI Summaries are disabled. No API Key provided.";try{const l=jD(t,e,n.language);return n.provider==="openai"?await us(n,[{role:"system",content:'You are a business intelligence analyst. Your response must be only the summary text in the specified format. The summary should highlight key trends, outliers, or business implications. Do not just describe the data; interpret its meaning. For example, instead of "Region A has 500 sales", say "Region A is the top performer, contributing the majority of sales, which suggests a strong market presence there."'},{role:"user",content:l}],!1,a==null?void 0:a.signal)||"No summary generated.":await cs(n,l,void 0,a==null?void 0:a.signal)}catch(l){return console.error("Error generating summary:",l),"Failed to generate AI summary."}},cP=async(t,e,n,a)=>{if(!(n.provider==="google"&&!!n.geminiApiKey||n.provider==="openai"&&!!n.openAIApiKey)||t.length===0)return"Could not generate an initial analysis summary.";try{const l=XD(t,e,n.language);if(n.provider==="openai"){const f=[{role:"system",content:`You are a senior data analyst. After performing an initial automated analysis of a dataset, your task is to create a concise "Core Analysis Briefing". This briefing will be shown to the user and will serve as the shared foundation of understanding for your conversation.
Your briefing should cover:
1.  **Primary Subject**: What is this data fundamentally about? (e.g., "This dataset appears to be about online sales transactions...")
2.  **Key Metrics**: What are the most important numerical columns? (e.g., "...where the key metrics are 'Sale_Amount' and 'Profit'.")
3.  **Core Dimensions**: What are the main categorical columns used for analysis? (e.g., "The data is primarily broken down by 'Region' and 'Product_Category'.")
4.  **Suggested Focus**: Based on the initial charts, what should be the focus of further analysis? (e.g., "Future analysis should focus on identifying the most profitable regions and product categories.")
Produce a single, concise paragraph in ${n.language}. This is your initial assessment that you will share with your human counterpart.`},{role:"user",content:l}];return await us(n,f,!1,a==null?void 0:a.signal)||"No summary generated."}else return await cs(n,l,void 0,a==null?void 0:a.signal)}catch(l){return console.error("Error generating core analysis summary:",l),"An error occurred while the AI was forming its initial analysis."}},dP=async(t,e,n)=>{if(!(e.provider==="google"&&!!e.geminiApiKey||e.provider==="openai"&&!!e.openAIApiKey)||t.length===0)return null;try{let r;const l=QD(t,e.language);return e.provider==="openai"?r=await us(e,[{role:"system",content:"You are a proactive data analyst. Review the following summaries of data visualizations. Your task is to identify the single most commercially significant or surprising insight. This could be a major trend, a key outlier, or a dominant category that has clear business implications. Your response must be a single JSON object with 'insight' and 'cardId' keys."},{role:"user",content:l}],{name:"ProactiveInsight",schema:zD,strict:!0},n==null?void 0:n.signal):r=await cs(e,l,mb,n==null?void 0:n.signal),JSON.parse(r)}catch(r){return console.error("Error generating proactive insight:",r),null}},yS=async(t,e,n)=>{if(!(e.provider==="google"&&!!e.geminiApiKey||e.provider==="openai"&&!!e.openAIApiKey))return"AI Summaries are disabled. No API Key provided.";const r=t.map(l=>{const c=l.summary.split("---")[0];return`Chart Title: ${l.plan.title}
Summary: ${c}`}).join(`

`);try{const l=WD(r,e.language);if(e.provider==="openai"){const f=[{role:"system",content:`You are a senior business strategist. You have been provided with several automated data analyses.
Your task is to synthesize these individual findings into a single, high-level executive summary in ${e.language}.
Please provide a concise, overarching summary that connects the dots between these analyses. 
Identify the most critical business insights, potential opportunities, or risks revealed by the data as a whole.
Do not just repeat the individual summaries. Create a new, synthesized narrative.
Your response should be a single paragraph of insightful business analysis.`},{role:"user",content:l}];return await us(e,f,!1,n==null?void 0:n.signal)||"No final summary generated."}else return await cs(e,l,void 0,n==null?void 0:n.signal)}catch(l){return console.error("Error generating final summary:",l),"Failed to generate the final AI summary."}},Ff=(t,e)=>e.some(n=>t instanceof n);let vS,SS;function fP(){return vS||(vS=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function pP(){return SS||(SS=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Gf=new WeakMap,lf=new WeakMap,xu=new WeakMap;function mP(t){const e=new Promise((n,a)=>{const r=()=>{t.removeEventListener("success",l),t.removeEventListener("error",c)},l=()=>{n(Sa(t.result)),r()},c=()=>{a(t.error),r()};t.addEventListener("success",l),t.addEventListener("error",c)});return xu.set(e,t),e}function hP(t){if(Gf.has(t))return;const e=new Promise((n,a)=>{const r=()=>{t.removeEventListener("complete",l),t.removeEventListener("error",c),t.removeEventListener("abort",c)},l=()=>{n(),r()},c=()=>{a(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",l),t.addEventListener("error",c),t.addEventListener("abort",c)});Gf.set(t,e)}let zf={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return Gf.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Sa(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function _b(t){zf=t(zf)}function gP(t){return pP().includes(t)?function(...e){return t.apply($f(this),e),Sa(this.request)}:function(...e){return Sa(t.apply($f(this),e))}}function yP(t){return typeof t=="function"?gP(t):(t instanceof IDBTransaction&&hP(t),Ff(t,fP())?new Proxy(t,zf):t)}function Sa(t){if(t instanceof IDBRequest)return mP(t);if(lf.has(t))return lf.get(t);const e=yP(t);return e!==t&&(lf.set(t,e),xu.set(e,t)),e}const $f=t=>xu.get(t);function Tb(t,e,{blocked:n,upgrade:a,blocking:r,terminated:l}={}){const c=indexedDB.open(t,e),f=Sa(c);return a&&c.addEventListener("upgradeneeded",y=>{a(Sa(c.result),y.oldVersion,y.newVersion,Sa(c.transaction),y)}),n&&c.addEventListener("blocked",y=>n(y.oldVersion,y.newVersion,y)),f.then(y=>{l&&y.addEventListener("close",()=>l()),r&&y.addEventListener("versionchange",p=>r(p.oldVersion,p.newVersion,p))}).catch(()=>{}),f}const vP=["get","getKey","getAll","getAllKeys","count"],SP=["put","add","delete","clear"],uf=new Map;function _S(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(uf.get(e))return uf.get(e);const n=e.replace(/FromIndex$/,""),a=e!==n,r=SP.includes(n);if(!(n in(a?IDBIndex:IDBObjectStore).prototype)||!(r||vP.includes(n)))return;const l=async function(c,...f){const y=this.transaction(c,r?"readwrite":"readonly");let p=y.store;return a&&(p=p.index(f.shift())),(await Promise.all([p[n](...f),r&&y.done]))[0]};return uf.set(e,l),l}_b(t=>({...t,get:(e,n,a)=>_S(e,n)||t.get(e,n,a),has:(e,n)=>!!_S(e,n)||t.has(e,n)}));const _P=["continue","continuePrimaryKey","advance"],TS={},Yf=new WeakMap,bb=new WeakMap,TP={get(t,e){if(!_P.includes(e))return t[e];let n=TS[e];return n||(n=TS[e]=function(...a){Yf.set(this,bb.get(this)[e](...a))}),n}};async function*bP(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;const n=new Proxy(e,TP);for(bb.set(n,e),xu.set(n,$f(e));e;)yield n,e=await(Yf.get(n)||e.continue()),Yf.delete(n)}function bS(t,e){return e===Symbol.asyncIterator&&Ff(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&Ff(t,[IDBIndex,IDBObjectStore])}_b(t=>({...t,get(e,n,a){return bS(e,n)?bP:t.get(e,n,a)},has(e,n){return bS(e,n)||t.has(e,n)}}));const xP={showNewButton:!0,showSettingsButton:!0},cf=t=>{if(typeof t!="string")return;const e=t.trim();return e.length?e:void 0},AP=t=>{if(typeof t!="string")return;const e=t.trim().toLowerCase();if(e==="google")return"google";if(e==="openai")return"openai"},wP=t=>{if(typeof t!="string")return;switch(t.trim().toLowerCase()){case"english":return"English";case"mandarin":return"Mandarin";case"spanish":return"Spanish";case"japanese":return"Japanese";case"french":return"French";default:return}},xS=t=>{if(typeof t=="boolean")return t;if(typeof t!="string")return;const e=t.trim().toLowerCase();if(["y","yes","true","1"].includes(e))return!0;if(["n","no","false","0"].includes(e))return!1},xb=()=>typeof window>"u"?{}:window.__CSV_AGENT_DEFAULTS__??{},CP=()=>{if(typeof window>"u")return{};const t={},e=cf(window.tempGeminiApiKey??window.tempgeminiapikey);e&&(t.geminiApiKey=e);const n=cf(window.tempOpenAIApiKey??window.tempopenaiapikey);n&&(t.openAIApiKey=n);const a=AP(window.tempProvider??window.tempprovider);a&&(t.provider=a);const r=cf(window.tempModel??window.tempmodel);r&&(t.model=r);const l=wP(window.tempLanguage??window.templanguage);return l&&(t.language=l),t},EP=()=>{if(typeof window>"u")return{};const t={},e=xS(window.tempShowNewButton??window.tempshownewbutton);typeof e=="boolean"&&(t.showNewButton=e);const n=xS(window.tempShowSettingsButton??window.tempshowsettingsbutton);return typeof n=="boolean"&&(t.showSettingsButton=n),t},NP=()=>({...xb().defaultSettings??{},...CP()}),Ab=()=>{const t=xb().ui??{};return{...xP,...t,...EP()}},wb="csv-ai-assistant-db",IP=3,_a="reports",Cb="csv-ai-assistant-settings",qs="current_session";let df=null;const RP=()=>new Promise((t,e)=>{const n=indexedDB.deleteDatabase(wb);n.onsuccess=()=>t(),n.onerror=()=>e(n.error),n.onblocked=()=>{console.warn("IndexedDB delete is blocked. Close other tabs to complete reset.")}}),AS=()=>Tb(wb,IP,{upgrade(t,e){if(!t.objectStoreNames.contains(_a)){t.createObjectStore(_a,{keyPath:"id"}).createIndex("updatedAt","updatedAt");return}const n=t.transaction.objectStore(_a);e<2&&!n.indexNames.contains("updatedAt")&&n.createIndex("updatedAt","updatedAt")}}),Au=()=>(df||(df=AS().catch(async t=>{if(t instanceof DOMException&&t.name==="VersionError")return console.warn("IndexedDB version mismatch detected. Resetting local database...",t),await RP(),AS();throw t})),df),Jf=async t=>{await(await Au()).put(_a,t)},Jr=async t=>{try{return await(await Au()).get(_a,t)}catch(e){console.error("Failed to get report from IndexedDB:",e);return}},MP=async()=>{try{return(await(await Au()).getAllFromIndex(_a,"updatedAt")).sort((n,a)=>a.updatedAt.getTime()-n.updatedAt.getTime()).map(({id:n,filename:a,createdAt:r,updatedAt:l})=>({id:n,filename:a,createdAt:r,updatedAt:l}))}catch(t){return console.error("Failed to get reports list from IndexedDB:",t),[]}},Kf=async t=>{try{await(await Au()).delete(_a,t)}catch(e){console.error("Failed to delete report from IndexedDB:",e)}},DP={provider:"google",geminiApiKey:"",openAIApiKey:"",model:"gemini-2.5-pro",language:"English",autoSaveEnabled:!0,autoSaveIntervalSeconds:15},wS=()=>({...DP,...NP()}),PP=t=>{try{localStorage.setItem(Cb,JSON.stringify(t))}catch(e){console.error("Failed to save settings to localStorage:",e)}},CS=()=>{try{const t=localStorage.getItem(Cb);if(t){const e=JSON.parse(t);return e.apiKey&&delete e.apiKey,{...wS(),...e}}}catch(t){console.error("Failed to get settings from localStorage:",t)}return wS()};let ff=null;const LP=async()=>(ff||(ff=(async()=>{const t="https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.1/dist/transformers.min.js";try{return await import(t)}catch(e){throw console.error("Failed to load @xenova/transformers from CDN.",e),e}})()),ff);class _i{constructor(){this.embedder=null,this.documents=[],this.isInitializing=!1,this.isInitialized=!1}static getInstance(){return _i.instance||(_i.instance=new _i),_i.instance}getIsInitialized(){return this.isInitialized}async init(e){if(!(this.isInitialized||this.isInitializing))try{this.isInitializing=!0;const{pipeline:n,env:a}=await LP();a.allowRemoteModels=!0,a.allowLocalModels=!0,a.useBrowserCache=!0,a.cacheDir=a.cacheDir||"indexeddb://ai-memory-models",a.localModelPath=a.localModelPath||"indexeddb://ai-memory-models",e==null||e("Loading AI memory model (~34MB). We'll cache it locally after the first download."),this.embedder=await n("feature-extraction","Xenova/all-MiniLM-L6-v2",{progress_callback:r=>{if(r.status==="progress"&&r.total>0){const l=(r.loaded/1024/1024).toFixed(2),c=(r.total/1024/1024).toFixed(2);e==null||e(`Downloading AI memory model: ${l}MB / ${c}MB`)}}}),e==null||e("AI memory model ready (cached locally for future sessions)."),this.isInitialized=!0}catch(n){console.error("Failed to initialize vector store:",n),e==null||e(`Error loading AI memory model: ${n instanceof Error?n.message:String(n)}`),this.isInitialized=!1}finally{this.isInitializing=!1}}rehydrate(e){this.documents=e}async addDocument(e){if(!this.embedder){console.warn("Vector store not initialized. Skipping document add/update.");return}try{const n=await this.embedder(e.text,{pooling:"mean",normalize:!0}),a={...e,embedding:Array.from(n.data)},r=this.documents.findIndex(l=>l.id===e.id);r>-1?this.documents[r]=a:this.documents.push(a)}catch(n){console.error(`Failed to create embedding for document ${e.id}:`,n)}}deleteDocument(e){const n=this.documents.length;return this.documents=this.documents.filter(a=>a.id!==e),this.documents.length<n}getDocumentCount(){return this.documents.length}getDocuments(){return[...this.documents]}clear(){this.documents=[]}async withAbort(e,n){if(!n)return e;if(n.aborted)throw new DOMException("Aborted","AbortError");return new Promise((a,r)=>{const l=()=>{n.removeEventListener("abort",l),r(new DOMException("Aborted","AbortError"))};n.addEventListener("abort",l),e.then(c=>{n.removeEventListener("abort",l),a(c)},c=>{n.removeEventListener("abort",l),r(c)})})}async search(e,n=5,a){if(!this.embedder||this.documents.length===0)return[];try{const r=await this.withAbort(this.embedder(e,{pooling:"mean",normalize:!0}),a==null?void 0:a.signal),l=Array.from(r.data);return this.documents.map(f=>{const y=this.cosineSimilarity(l,f.embedding);return{id:f.id,text:f.text,score:y}}).filter(f=>f.score>.5).sort((f,y)=>y.score-f.score).slice(0,n)}catch(r){return console.error("Failed to perform vector search:",r),[]}}cosineSimilarity(e,n){let a=0,r=0,l=0;for(let c=0;c<e.length;c++)a+=e[c]*n[c],r+=e[c]*e[c],l+=n[c]*n[c];return r===0||l===0?0:a/(Math.sqrt(r)*Math.sqrt(l))}}const at=_i.getInstance(),jf=async(t,e,n,a={})=>{const r=!!a.runId,l=a.runId??t.beginBusy(e,{cancellable:a.cancellable});try{return await n(l)}finally{r||t.endBusy(l)}},ES=["categorical","date","time"],kP=(t,e,n=500)=>{if(!t.length)return 0;const a=new Set,r=Math.min(t.length,n);for(let l=0;l<r;l++){const c=t[l][e];if(c==null)continue;const f=String(c).trim();if(f&&(a.add(f),a.size>200))break}return a.size},Eb=(t,e)=>{if(!t.length)return[];const n=t.map(r=>({profile:r,uniqueValues:typeof r.uniqueValues=="number"?r.uniqueValues:kP(e,r.name)})),a=n.filter(({profile:r,uniqueValues:l})=>l>1&&(ES.includes(r.type)||l<=50)).sort((r,l)=>{const c=_=>ES.includes(_)?0:1,f=c(r.profile.type),y=c(l.profile.type);if(f!==y)return f-y;const p=12,m=Math.abs((r.uniqueValues||100)-p),v=Math.abs((l.uniqueValues||100)-p);return m-v});return a.length>0?a:n.filter(r=>(r.uniqueValues||0)>1)},Nb=(t,e)=>{const n=Eb(t,e);return n.length?{column:n[0].profile.name,inferred:!0}:{column:null,inferred:!1}},UP=["sum","count","avg"],OP=25,qP=(t,e)=>{const n=new Set;t.forEach(a=>{a!=null&&a.name&&n.add(a.name)});for(let a=0;a<Math.min(e.length,OP);a++)Object.keys(e[a]??{}).forEach(r=>n.add(r));return n},BP=(t,e)=>{if(t){const a=t.toLowerCase();if(UP.includes(a))return{value:a,inferred:!1}}return{value:e?"sum":"count",inferred:!0}},HP=(t,e,n)=>{const a={...t},r=[],l=qP(e,n);if(a.chartType==="scatter")return!a.xValueColumn||!a.yValueColumn?{plan:a,warnings:r,isValid:!1,errorMessage:"Scatter plot plan is missing xValueColumn or yValueColumn."}:{plan:a,warnings:r,isValid:!0};if(!n.length)return{plan:a,warnings:r,isValid:!1,errorMessage:"Dataset appears empty for analysis."};const c=BP(a.aggregation,!!a.valueColumn);if(c.inferred?(a.aggregation=c.value,r.push(`AI plan missing aggregation; defaulting to ${c.value}.`)):a.aggregation=c.value,a.aggregation!=="count"&&!a.valueColumn&&(a.aggregation="count",r.push("Value column missing for sum/avg; using count aggregation instead.")),a.chartType==="combo"){if(!a.valueColumn||!a.secondaryValueColumn)return{plan:a,warnings:r,isValid:!1,errorMessage:"Combo chart requires both valueColumn and secondaryValueColumn."};a.secondaryAggregation||(a.secondaryAggregation=a.aggregation??"sum",r.push("Secondary aggregation missing; mirroring primary aggregation."))}if(!a.groupByColumn){const f=Nb(e,n);if(f.column)a.groupByColumn=f.column,r.push(`AI plan missing grouping; defaulting to "${f.column}".`);else return{plan:a,warnings:r,isValid:!1,errorMessage:"Unable to infer a grouping column for this chart."}}if(a.rowFilter){const f=a.rowFilter.column,y=f?l.has(f):!1,p=Array.isArray(a.rowFilter.values)&&a.rowFilter.values.length>0;if(!f||!y||!p){const m=[];f?y||m.push(`column "${f}" not found`):m.push("missing column"),p||m.push("no filter values provided");const v=m.length?` (${m.join(", ")})`:"";r.push(`Row filter invalid${v}; removing filter.`),delete a.rowFilter}}return{plan:a,warnings:r,isValid:!0}},VP=t=>t.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,""),FP=t=>{const e=new Set,n=VP(t);n&&n!==t&&e.add(n);const a=n.match(/^[a-z]\d?_(.+)$/);return a&&a[1]&&e.add(a[1]),n.includes("__")&&e.add(n.replace(/_+/g,"_")),n.startsWith("column_")&&e.add(n.replace(/^column_/,"")),Array.from(e).filter(Boolean)},Kr=t=>{const e={};return t.forEach(n=>{FP(n).forEach(r=>{e[r]||(e[r]=n)})}),e},GP=(t,e)=>{const n=Object.entries(e);return n.length===0?t:t.map(a=>{const r={...a};for(const[l,c]of n)!(l in r)&&r[c]!==void 0&&(r[l]=r[c]);return r})},zP=(t,e)=>{const n=Object.entries(e);return n.length===0?t:t.map(a=>{const r={...a};for(const[l,c]of n)Object.prototype.hasOwnProperty.call(r,l)&&(Object.prototype.hasOwnProperty.call(r,c)||(r[c]=r[l]),delete r[l]);return r})},NS=t=>t.toLowerCase().replace(/[_-]+/g," ").replace(/[^a-z0-9 ]/g," ").replace(/\s+/g," ").trim(),jr=["groupByColumn","valueColumn","xValueColumn","yValueColumn","secondaryValueColumn"],nu=(t,e,n=1,a=1/0)=>{if(!e||e.length===0)return!1;const r=e.map(c=>c[t]).filter(c=>c!=null&&String(c).trim()!=="");if(r.length===0)return!1;const l=new Set(r.map(c=>String(c))).size;return l>=n&&l<=a},Ib=(t,e,n)=>{if(!jr.includes(e))return t.value;const a=n.find(c=>c===t.value);if(a)return a;const r=n.find(c=>c.toLowerCase()===t.value.toLowerCase());if(r)return r;const l=NS(t.label);return n.find(c=>l.includes(NS(c)))},$P=(t,e,n,a)=>{var y;if(!jr.includes(t.targetProperty)||!e||e.length===0)return t;const r=((y=a==null?void 0:a.preferredColumns)==null?void 0:y.filter(p=>typeof p=="string"&&p.trim().length>0))??[],l=Array.from(new Set([...n,...r])),c=new Set(t.columnHints??[]),f=t.options.map(p=>{const m=Ib(p,t.targetProperty,l);if(!m)return null;c.add(m);const v=r.includes(m);if(t.targetProperty==="groupByColumn"){if(!nu(m,e,2,v?1/0:50))return null}else if(!nu(m,e))return null;return{...p,value:m}}).filter(p=>p!==null);return f.length===0?null:{...t,options:f,columnHints:Array.from(c)}},IS=(t,e)=>{if(!t)return null;const n=e.find(a=>a.name===t);return n?n.name:t},YP=(t,e)=>{const n=IS(t.valueColumn,e)||(t.aggregation==="count"?"Records":"Value"),a=IS(t.groupByColumn,e)||(t.chartType==="scatter"?"X Axis":"Category"),r={"[metric]":n,"[value]":n,"[dimension]":a,"[group]":a},l=p=>{if(!p)return!1;const m=p.replace(/\s+/g,"");return/(.{3,20})\1{3,}/i.test(m)},c=(p,m)=>{if(!p||p.trim()==="")return m;let v=p;for(const _ of Object.keys(r)){const x=new RegExp(_,"gi");v=v.replace(x,r[_])}return/\[.*\]/.test(v)||v.length>150||l(v)?m:v.trim()},f=`${n} by ${a}`,y=`A chart showing ${n} grouped by ${a}.`;return{...t,title:c(t.title,f),description:c(t.description,y)}},Rb=["context_ready","needs_clarification","transform_drafted","transform_ready","analysis_shared","awaiting_data","error_retrying","awaiting_clarification"],JP=/(remove|delete)\s+card/i,KP=/(filter|show|find)\s+(all\s+)?(rows|entries|records|data)/i,jP=/(clean|transform|restructure|normalize|standardize|add\s+column|create\s+column|calculate)/i,XP=/(which|what)\s+(column|field|value)/i,QP=/^(hi|hello|hey|hola|ciao|salut|+|||||||)([!.?\s]|$)/i,WP=/(how\s+are\s+you||thanks|thank\s+you|||what'?s\s+up|)/i,ZP=/^\s*(?:option|choice)?\s*(?:[1-3]|[abc])(?:[\s.:,-].*)?$/i,e2=(t,e)=>{var a,r;const n=(t||"").trim();if(!n)return{intent:"unknown",confidence:.1};if(QP.test(n))return{intent:"greeting",confidence:.9};if(WP.test(n))return{intent:"smalltalk",confidence:.75};if(ZP.test(n))return{intent:"ask_user_choice",confidence:.8};if(JP.test(n)){const l=Array.isArray(e.analysisCards)?e.analysisCards:[],c=n.toLowerCase(),f=l.find(y=>{var m;const p=(m=y==null?void 0:y.plan)==null?void 0:m.title;return typeof p=="string"&&c.includes(p.toLowerCase())});return f?{intent:"remove_card",confidence:.95,requiredTool:{responseType:"dom_action",domToolName:"removeCard",payloadHints:{cardId:f.id,cardTitle:(a=f.plan)==null?void 0:a.title}},payloadHints:(r=f.plan)!=null&&r.title?{cardTitle:f.plan.title}:void 0}:{intent:"remove_card",confidence:.8,requiredTool:null}}return KP.test(n)?{intent:"data_filter",confidence:.75,requiredTool:{responseType:"filter_spreadsheet"},payloadHints:{query:n}}:jP.test(n)?{intent:"data_transform",confidence:.7,requiredTool:{responseType:"execute_js_code"}}:XP.test(n)||n.endsWith("?")?{intent:"clarification",confidence:.6}:{intent:"chart_request",confidence:.4}},t2=[{name:"plan_state_update",description:"Update the shared plan tracker before any other action.",tags:["plan","safe","low_latency"],costEstimate:1,latencyClass:"short",risk:"low"},{name:"text_response",description:"Send a conversational reply to the user and suggest next actions.",tags:["conversation","starter","safe","low_latency"],costEstimate:1,latencyClass:"short",risk:"low"},{name:"dom_action",description:"Modify an existing insight card (highlight, toggle legend, etc.).",tags:["dom","ui"],costEstimate:3,latencyClass:"medium",risk:"medium"},{name:"dom_action.removeCard",description:"Remove an existing chart card by id or title.",tags:["dom","destructive"],costEstimate:4,latencyClass:"medium",risk:"medium",applicableIf:{intentsAny:["remove_card"]}},{name:"filter_spreadsheet",description:"Apply a natural-language filter to the raw data explorer.",tags:["data","tool"],costEstimate:2,latencyClass:"short",risk:"low",applicableIf:{intentsAny:["data_filter"]}},{name:"execute_js_code",description:"Run a JavaScript transform to reshape the dataset.",tags:["data","transform"],costEstimate:5,latencyClass:"long",risk:"high",applicableIf:{intentsAny:["data_transform"]}},{name:"clarification_request",description:"Ask the user to choose between concrete options.",tags:["conversation","safe"],costEstimate:2,latencyClass:"short",risk:"low"},{name:"plan_creation",description:"Create a batch of chart plans for later execution.",tags:["plan","analysis"],costEstimate:4,latencyClass:"medium",risk:"medium"},{name:"proceed_to_analysis",description:"Signal that the AI is ready to summarize results.",tags:["conversation"],costEstimate:1,latencyClass:"short",risk:"low"}],RS=new Map(t2.map(t=>[t.name,t])),n2=t=>{var n;const e=(t.type??t.responseType??"").trim();if(!e)return"unknown";if(e==="dom_action"){const a=(n=t.domAction)==null?void 0:n.toolName;return a?`${e}.${a}`:e}return e},s2=t=>{const e=n2(t);return RS.get(e)??RS.get(e.split(".")[0])},a2=[{id:"greeting_minimal",intent:"greeting",success_criteria:["user_follow_up"],ui:{message_template:"{{greeting}}I am ready to explore your CSV. Pick a quick action or tell me what to analyze next.",quick_action_rules:[{source:"tools",filter:{tags_any:["starter","safe","low_latency"],context:["idle"]},top_k:5}]},governance:{max_tokens:80,deny_tools_if:{latency_class:["long"],risk:["high"]}}},{id:"remove_card_flow",intent:"remove_card",success_criteria:["card_removed"],ui:{message_template:'Removing the card "{{cardTitle}}" from the dashboard now.'},governance:{deny_tools_if:{risk:["high"]}}}],i2=t=>{if(t)return a2.find(e=>e.intent===t)},su="ad_hoc_response",r2=["text_response","plan_creation","dom_action","execute_js_code","proceed_to_analysis","filter_spreadsheet","clarification_request","plan_state_update"],o2={plan_update:"plan_state_update",planstateupdate:"plan_state_update",domaction:"dom_action",agent_action:"text_response",agentaction:"text_response",respond:"text_response"},MS=t=>{if(!t)return null;const e=t.trim().toLowerCase();return e?o2[e]??r2.find(a=>a===e)??null:null},l2=t=>t.domAction?"dom_action":t.code?"execute_js_code":t.plan?"plan_creation":t.args?"filter_spreadsheet":t.clarification?"clarification_request":"text_response",u2=t=>{const n=MS(t.responseType)??MS(t.type)??l2(t);return t.type=n,t.responseType=n,n},c2=(t,e)=>{if(t!=null&&t.currentStepId&&Xf(t.currentStepId))return t.currentStepId.trim();const n=e.find(a=>Xf(a==null?void 0:a.id));return n?n.id.trim():su},Mb=()=>({id:su,label:"Respond directly to the latest request.",intent:"conversation",status:"ready"}),Xf=t=>typeof t=="string"&&t.trim().length>=3,DS=t=>{if(!Array.isArray(t))return[];const e=new Set,n=[];for(const a of t){const r=typeof(a==null?void 0:a.id)=="string"?a.id.trim():"",l=typeof(a==null?void 0:a.label)=="string"?a.label.trim():"";if(r.length<3||l.length<3||e.has(r))continue;const c=typeof(a==null?void 0:a.intent)=="string"&&a.intent.trim().length>0?a.intent.trim():a==null?void 0:a.intent,f=(a==null?void 0:a.status)??"ready";n.push({id:r,label:l,intent:c,status:f}),e.add(r)}return n},Db=(t,e)=>{var a;const n=Mb();return{planId:`plan-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,6)}`,goal:(a=t.detectedIntent)!=null&&a.intent?`Address user intent: ${t.detectedIntent.intent}`:"Acknowledge the user and clarify analysis goals.",contextSummary:t.userMessage.slice(0,200),progress:"Initialized plan scaffold automatically.",nextSteps:[n],steps:[n],currentStepId:n.id,blockedBy:null,observationIds:[],confidence:.6,updatedAt:new Date(t.now).toISOString(),stateTag:e()}},PS=(t,e,n)=>{const a=t??Db(e,n);let r=DS(a.steps),l=DS(a.nextSteps);l.length===0&&(l=r.length>0?r:[Mb()]),r.length===0&&(r=l);let c=Xf(a.currentStepId)?a.currentStepId.trim():l[0].id;return r.some(f=>f.id===c)||(r=[{...l[0],id:c,status:l[0].status??"ready"},...r]),l.some(f=>f.id===c)||(l=[{...r[0],id:c,status:r[0].status??"ready"},...l]),{...a,planId:a.planId??`plan-${Date.now().toString(36)}`,currentStepId:c,nextSteps:l,steps:r,updatedAt:a.updatedAt??new Date().toISOString(),stateTag:a.stateTag??n()}},d2=(t,e)=>{if(t.responseType!=="dom_action"||!t.domAction)return;const n=t.domAction.args??(t.domAction.args={}),a=t.domAction.target??(t.domAction.target={});!a.byId&&typeof n.cardId=="string"&&(a.byId=n.cardId),!a.byTitle&&typeof n.cardTitle=="string"&&(a.byTitle=n.cardTitle),!a.byId&&!a.byTitle&&!a.selector&&(e.push("DOM payload missing target; downgraded to text response."),t.domAction=void 0,t.responseType="text_response",t.type="text_response",t.text="Target not found, please select.")},f2=(t,e,n)=>{const a=[...t],r=[],l=[];let c=!1;(()=>{var v;let p=a.findIndex(_=>(_.type??_.responseType)==="plan_state_update");if(p===-1&&(a.unshift({type:"plan_state_update",responseType:"plan_state_update",stepId:su,stateTag:n("plan"),thought:"Seeding plan tracker automatically.",planState:Db(e,()=>n("plan"))}),c=!0,r.push("Inserted plan_state_update because no active plan was found."),p=0),p>0){const[_]=a.splice(p,1);a.unshift(_),c=!0,r.push("Moved plan_state_update to the beginning of the turn.")}const m=a[0];m.planState=PS(m.planState,e,()=>n("plan")),m.stepId=m.stepId??((v=m.planState)==null?void 0:v.currentStepId)??su,m.stateTag||(m.stateTag=n("plan"))})();const y=c2(e.planState,e.pendingSteps);return a.forEach(p=>{var v;const m=u2(p);m==="plan_state_update"?(p.planState=PS(p.planState,e,()=>n("plan")),p.stepId=p.stepId??((v=p.planState)==null?void 0:v.currentStepId)??y):(!p.stepId||p.stepId.trim().length<3)&&(p.stepId=y,c=!0,r.push(`Attached stepId=${y} to ${m}.`)),p.stateTag||(p.stateTag=n(m),c=!0),d2(p,r)}),{actions:a,report:{mutated:c,notes:r,warnings:l}}},Qf={low:.1,medium:.4,high:.9},Wf={short:.1,medium:.3,long:.7};class p2{constructor(){this.seq=0,this.lastEpoch=0}mint(e,n){const a=e>this.lastEpoch?e:this.lastEpoch;return a!==this.lastEpoch&&(this.seq=0,this.lastEpoch=a),this.seq+=1,`${a.toString().padStart(13,"0")}-${this.seq}`}}const m2=(t,e)=>{var n;return t?t==="remove_card"?e.responseType==="dom_action"&&((n=e.domAction)==null?void 0:n.toolName)==="removeCard":t==="data_filter"?e.responseType==="filter_spreadsheet":t==="data_transform"?e.responseType==="execute_js_code":t==="clarification"?e.responseType==="clarification_request":t==="greeting"||t==="smalltalk"||t==="ask_user_choice"?e.responseType==="text_response":!1:!1},h2=(t,e)=>{var l,c;const n=" hi",a="[Filter Data, Create Chart, Clean Data]",r=((c=(l=e.detectedIntent)==null?void 0:l.payloadHints)==null?void 0:c.cardTitle)??"the selected card";return t.replace(/{{\s*greeting\s*}}/gi,n).replace(/{{\s*quick_actions\s*}}/gi,a).replace(/{{\s*cardTitle\s*}}/gi,r).replace(/{{\s*userMessage\s*}}/gi,e.userMessage)},g2=(t,e)=>{var n;return{type:"text_response",responseType:"text_response",stepId:((n=e.planState)==null?void 0:n.currentStepId)??"ad_hoc_response",thought:`Applying playbook ${t.id} for intent ${t.intent}.`,text:h2(t.ui.message_template,e)}},pf=(t,e,n,a)=>{var v,_;const r=s2(t),l=t.responseType==="plan_state_update"?1.2:.8,c=m2((v=e.detectedIntent)==null?void 0:v.intent,t)?.4:0,f=(_=t.thought)!=null&&_.trim()?Math.min(1,.5+t.thought.trim().length/200):.4,y=(r==null?void 0:r.costEstimate)??3,p=Qf[(r==null?void 0:r.risk)??"medium"]??.4,m=Wf[(r==null?void 0:r.latencyClass)??"medium"]??.3;return{action:t,source:n,playbookId:a==null?void 0:a.id,utility:l+c,confidence:f,cost:y,risk:p,latency:m}},y2=t=>t.utility+t.confidence-t.cost*.1-t.risk-t.latency,v2=(t,e)=>{var r;if(!((r=e==null?void 0:e.governance)!=null&&r.deny_tools_if))return t;const{latency_class:n,risk:a}=e.governance.deny_tools_if;return t.filter(l=>{const c=l.risk,f=l.latency,y=a==null?void 0:a.some(m=>m==="high"&&c>=Qf.high||m==="medium"&&c>=Qf.medium),p=n==null?void 0:n.some(m=>m==="long"&&f>=Wf.long||m==="medium"&&f>=Wf.medium);return!y&&!p})},S2=(t,e)=>{if(t.length===0)return[];const n=t.map(c=>({...c,score:y2(c)})).sort((c,f)=>(f.score??0)-(c.score??0)),a=n.filter(c=>c.action.responseType==="plan_state_update"),r=n.filter(c=>c.action.responseType!=="plan_state_update"),l=[];return a.length>0&&(!e.planState||a[0].source!=="model")||a.length>0?l.push(a[0].action):!e.planState&&r.length>0&&l.push({type:"plan_state_update",responseType:"plan_state_update",thought:"Auto-initializing plan because model skipped it.",stepId:"ad_hoc_response"}),r.length>0&&l.push(r[0].action),l.slice(0,2)},_2=(t,e)=>{var n;return t.length>0?t:[{type:"text_response",responseType:"text_response",stepId:((n=e.planState)==null?void 0:n.currentStepId)??"ad_hoc_response",thought:"Fallback explanation: no valid actions after governance.",text:"I am ready to helpplease let me know what to analyze or adjust."}]};class T2{constructor(){this.stateTagFactory=new p2}run(e,n){var y,p;const a=Array.isArray(e.actions)?e.actions:[],r=i2((y=n.detectedIntent)==null?void 0:y.intent);let l=a.map(m=>pf(m,n,"model"));if(l.length===0&&r){const m=g2(r,n);l.push(pf(m,n,"playbook",r))}if(r&&l.every(m=>m.action.responseType!=="plan_state_update")){const m={type:"plan_state_update",responseType:"plan_state_update",stepId:((p=n.planState)==null?void 0:p.currentStepId)??"ad_hoc_response",thought:`Playbook ${r.id} requires a plan snapshot.`,planState:n.planState??void 0};l.unshift(pf(m,n,"playbook",r))}l=v2(l,r);let c=S2(l,n);c=_2(c,n);const f=f2(c,n,m=>this.stateTagFactory.mint(n.now,m));return{...e,actions:f.actions}}}const b2=()=>new T2,x2={allowLooseSteps:!1},Pb=new Set(Rb),Lb=/^(\d{5,})-(\d+)(?:-[\w-]+)?$/,A2=5e3,w2=8e3,kb="Begin every response with a plan_state_update that lists your goal, context, progress, next steps, blockers (or null), referenced observations, confidence, and updatedAt before any other action.",LS=3,Ub=2,C2=2,E2=new Set(["awaiting_clarification","blocked"]),Xp="ad_hoc_response",Ob={id:"acknowledge_user_greeting",label:"Acknowledge the greeting and ask what to analyze next."},qb="show entire table",N2=["reset plan","start over","","","",""],Bb=/^(hi|hello|hey|hola|ciao|salut|+|||||||)([!.?\s]|$)/i,I2="Requesting simplified plan outline...",R2=b2(),kS=t=>{const e=t.match(Lb);return e?{epochMs:Number(e[1]),seq:Number(e[2]),raw:t}:null},mf=()=>Gb(),M2=t=>{const e=t.trim().toLowerCase();return e?!!N2.some(n=>e.includes(n)):!1},D2=["text_response","plan_creation","dom_action","execute_js_code","proceed_to_analysis","filter_spreadsheet","clarification_request","plan_state_update"],P2={plan_update:"plan_state_update",planstateupdate:"plan_state_update",planstep:"plan_state_update",domaction:"dom_action",agent_action:"text_response",agentmessage:"text_response",respond:"text_response"},Hb=new Set(["greeting","smalltalk","ask_user_choice"]),L2=/(^|\n)\s*(?:\d+[\.\)]|[A-Z][\.\)]|[-]\s*(?:option|choice)\s*\d+)/i,k2=/\b(option|choice|||Type a custom answer)\b/i,U2=/prompt[-\s]*([A-Za-z0-9_-]+)/i,O2=t=>{if(!t)return!1;const e=t.trim();return e?!!(L2.test(e)||k2.test(e)&&e.includes("?")||/Type a custom answer/i.test(e)):!1},q2=t=>{if(!Array.isArray(t)||t.length===0)return!1;const e=[...t].reverse().find(a=>a.responseType==="text_response"&&typeof a.text=="string"&&a.text.trim().length>0);if(!e||!O2(e.text))return!1;const n=e.meta??(e.meta={});if(n.awaitUser=!0,n.haltAfter=!0,!n.promptId){const a=(e.text??"").match(U2);n.promptId=(a==null?void 0:a[1])??Qp()}return!0},B2=t=>{!Array.isArray(t)||t.length===0||t.forEach(e=>{if(e.responseType!=="clarification_request")return;const n=e.meta??(e.meta={});n.awaitUser=!0,n.haltAfter=!0,n.promptId||(n.promptId=Qp())})},H2={maxValidationRetries:Ub,allowPlanFallbackPrompt:!0,allowAutoContinuation:!1},V2=new Set(["chart_request","data_filter","data_transform"]),F2=new Set(["plan_creation","execute_js_code","filter_spreadsheet","proceed_to_analysis"]),G2=t=>t&&Hb.has(t.intent)?{maxValidationRetries:0,allowPlanFallbackPrompt:!1,allowAutoContinuation:!1}:t&&V2.has(t.intent)?{maxValidationRetries:Ub,allowPlanFallbackPrompt:!0,allowAutoContinuation:!0}:H2,US=t=>{if(!t)return null;const e=t.trim().toLowerCase();return e?D2.includes(e)?e:P2[e]??null:null},z2=t=>{if(!Array.isArray(t)||t.length===0)return[];const e=t.filter(Boolean),n=e.find(l=>l.responseType==="plan_state_update"),a=e.find(l=>l.responseType!=="plan_state_update"),r=[];return n&&r.push(n),a&&r.push(a),r.length===0&&r.push(e[0]),r},$2=(t,e)=>{var f,y;if(!Array.isArray(t.actions)){t.actions=[];return}const n=()=>Gb(),a=[];for(const p of t.actions){if(!p)continue;const m=US(p.type)??US(p.responseType)??(p.domAction?"dom_action":p.plan?"plan_creation":p.text?"text_response":null);if(!m)continue;const v={...p,type:m,responseType:m},_=wu(v.stateTag),x=_&&Pb.has(_)?_:null;v.stateTag=x??n(),typeof v.stepId!="string"||v.stepId.trim().length<3?v.stepId=ep(e):v.stepId=v.stepId.trim(),a.push(v)}if(a.length===0){t.actions=[];return}const r=z2(a);r.length<a.length&&e.get().addProgress("Trimmed extra actions to keep this turn atomic.","system");const l=q2(r);B2(r);const c=(f=e.detectedIntent)!=null&&f.intent?Hb.has(e.detectedIntent.intent):!1;if(c&&!r.some(p=>p.responseType==="text_response")&&r.push({type:"text_response",responseType:"text_response",stepId:((y=r[0])==null?void 0:y.stepId)??ep(e),thought:"Auto-generated greeting reply so the assistant can acknowledge the user.",text:" hi"}),c){const p=r.find(m=>m.responseType==="text_response");if(p){const m=p.meta??(p.meta={});l||(m.awaitUser=!0,m.haltAfter=!0,m.promptId=m.promptId??Qp())}}t.actions=r},OS={awaitUser:!1,haltAfter:!1,resumePlanner:!1,promptId:null},Y2=t=>!Array.isArray(t)||t.length===0?{...OS}:t.reduce((e,n)=>n!=null&&n.meta?{awaitUser:e.awaitUser||!!n.meta.awaitUser,haltAfter:e.haltAfter||!!n.meta.haltAfter,resumePlanner:e.resumePlanner||!!n.meta.resumePlanner,promptId:n.meta.promptId??e.promptId}:e,{...OS}),Vb=(t,e)=>{t.set(()=>({agentAwaitingUserInput:!0,agentAwaitingPromptId:e??null}));const n=t.get();n.addProgress("Waiting for your choice to continue."),typeof n.setAgentPhase=="function"&&n.setAgentPhase("idle","Waiting for your choice...")},J2=t=>{t.set(()=>({agentAwaitingUserInput:!1,agentAwaitingPromptId:null}))},K2=(t,e)=>{Vb(t,e.promptId);const n=t.get(),a=n.plannerSession.planState;if(!a)return;const r=Array.isArray(a.steps)&&a.steps.length>0?a.steps:a.nextSteps,l=r==null?void 0:r.map(c=>c.id===a.currentStepId?{...c,status:"waiting_user"}:c);n.updatePlannerPlanState({...a,steps:l??a.steps,nextSteps:[],blockedBy:a.blockedBy??"Waiting for your choice"})},j2=(t,e)=>{if(e.actions.some(f=>f.responseType==="text_response"))return!0;const a=e.actions.find(f=>f.responseType==="plan_state_update"),r=a&&Gr(a)?a.planState:t.get().plannerSession.planState;if(!r)return!1;const l=[];if(r.progress&&l.push(`Progress: ${r.progress}`),r.nextSteps&&r.nextSteps.length>0&&l.push(`Next: ${r.nextSteps[0].label}`),r.blockedBy&&l.push(`Blocked by: ${r.blockedBy}`),l.length===0)return!1;const c={sender:"ai",text:`Status update:
${l.join(`
`)}`,timestamp:new Date,type:"ai_message"};return t.set(f=>({chatHistory:[...f.chatHistory,c]})),!0},X2=(t,e)=>{var n,a,r;if(!t)return[];switch(t.intent){case"remove_card":{const l=(n=t.payloadHints)==null?void 0:n.cardTitle,c=(r=(a=t.requiredTool)==null?void 0:a.payloadHints)==null?void 0:r.cardId;return c&&l?[`USER INTENT: Remove the chart titled "${l}" (cardId: ${c}). ACTION REQUIREMENT: Emit a dom_action removeCard with cardId=${c} (or cardTitle matching that text). Do not use other dom_action tools for this request.`]:[`USER INTENT: Remove a chart but no exact title match was found. Ask the user which chart to remove before proceeding. Available charts: ${(e.analysisCards??[]).map(y=>{var p;return(p=y==null?void 0:y.plan)==null?void 0:p.title}).filter(Boolean).join(", ")}.`]}case"data_filter":return["USER INTENT: Filter the raw data view. ACTION REQUIREMENT: Use filter_spreadsheet immediately with args.query echoing their request before creating new charts."];case"data_transform":return["USER INTENT: Permanently transform the dataset. ACTION REQUIREMENT: Use execute_js_code with valid transformation code before continuing."];case"clarification":return["USER INTENT: Needs clarification. ACTION REQUIREMENT: Ask a clarification_request that lists concrete options or explicitly states the missing detail."];case"smalltalk":return["USER INTENT: Casual smalltalk. Keep the reply lightweight and do not run tools until the user asks for a concrete analysis."];case"ask_user_choice":return["USER INTENT: Responding to a multiple-choice prompt. Acknowledge the selection, restate what it maps to, and resume the pending step without rebuilding the entire plan."];default:return[]}};let qS=0,BS=0;const mn=(t,e,n)=>{const a=t.get();typeof a.setAgentPhase=="function"&&a.setAgentPhase(e,n??null)},Q2=t=>{const e=t.get();typeof e.setAgentPhase=="function"&&e.setAgentPhase("idle",null)},W2=t=>{var e;return(e=t.get().pendingClarifications)==null?void 0:e.some(n=>n.status==="pending"||n.status==="resolving")},HS=()=>typeof performance<"u"?performance.now():Date.now(),Ye={MISSING_TEXT:"MISSING_TEXT",MISSING_PLAN_PAYLOAD:"MISSING_PLAN_PAYLOAD",DOM_PAYLOAD_MISSING:"DOM_PAYLOAD_MISSING",DATASET_UNAVAILABLE:"DATASET_UNAVAILABLE",MISSING_JS_CODE:"MISSING_JS_CODE",TRANSFORM_PENDING:"TRANSFORM_PENDING",TRANSFORM_FAILED:"TRANSFORM_FAILED",CLARIFICATION_PAYLOAD_MISSING:"CLARIFICATION_PAYLOAD_MISSING",CLARIFICATION_NO_OPTIONS:"CLARIFICATION_NO_OPTIONS",THOUGHT_MISSING:"THOUGHT_MISSING",UNSUPPORTED_ACTION:"UNSUPPORTED_ACTION",PLAN_STATE_PAYLOAD_MISSING:"PLAN_STATE_PAYLOAD_MISSING",VALIDATION_FAILED:"VALIDATION_FAILED",PLAN_STEP_OUT_OF_ORDER:"PLAN_STEP_OUT_OF_ORDER"},Fb=()=>`obs-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,Qp=()=>`prompt-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,Gb=(()=>{let t=0,e=0;const n=(a,r)=>`${a.toString().padStart(13,"0")}-${r}`;return()=>{const a=Date.now(),r=a>t?a:t;return r!==t&&(t=r,e=0),e+=1,n(t,e)}})(),Z2=t=>{const e=JSON.stringify(t);let n=0;for(let a=0;a<e.length;a++)n=(n<<5)-n+e.charCodeAt(a),n|=0;return Math.abs(n).toString(36)},eL=t=>{if(t==null)return"";const e=String(t),n=/[",\n]/.test(e),a=e.replace(/"/g,'""');return n?`"${a}"`:a},zb=t=>{const{csvData:e,spreadsheetFilterFunction:n,aiFilterExplanation:a,interactiveSelectionFilter:r}=t,l=(e==null?void 0:e.data)??[];if(l.length===0)return{summary:"No dataset loaded; Raw Data Explorer summary unavailable.",metadata:{totalRows:0,filteredRows:0,snippetHash:null,drilldownLabel:null,drilldownValueCount:0}};let c=l;const f=[];let y=null,p=null,m=0;if(r&&r.column){const{label:A,column:C,values:N}=r,I=new Set(N.map(z=>String(z)));c=c.filter(z=>I.has(String(z[C]??"")));const R=N.slice(0,4).map(z=>`"${String(z)}"`).join(", "),M=N.length>4?` +${N.length-4}`:"";f.push(`Chart drilldown "${A}" (${C})  ${R}${M}.`),p=A,m=N.length}if(n)try{c=g_(c,n),a!=null&&a.trim()?f.push(`AI filter active: ${a.trim()}`):f.push("AI filter active via natural-language query (no explanation available).")}catch(A){const C=A instanceof Error?A.message:String(A);f.push(`AI filter active but preview failed: ${C}`)}const v=c.length,_=l.length,w=(()=>{if(c.length===0)return"No rows available.";if(c.length>1e3){const N=Object.keys(c[0]),I=N.join(","),R=5,M=c.slice(0,R).map(k=>N.map(W=>eL(k[W])).join(",")),z=Math.ceil(c.length/R),B=Z2(c.slice(0,R));return y=B,`CSV snippet page 1/${z} (hash ${B}):
${[I,...M].join(`
`)}`}const A=c.slice(0,3),C=A.length>0?JSON.stringify(A,null,2):"[]";return C.length>600?`${C.slice(0,600)}`:C})();return f.push(`Filtered rows: ${v}/${_}. Preview sample: ${w}`),{summary:f.join(" "),metadata:{totalRows:_,filteredRows:v,snippetHash:y,drilldownLabel:p,drilldownValueCount:m}}},tL=t=>t.observation?t.observation:t.type==="retry"?{status:"error",outputs:{reason:t.reason}}:{status:"success"},nL=6,sL=t=>{if(!t)return null;const e=t.toLowerCase().replace(/[^a-z0-9\s]/g," ").split(/\s+/).filter(Boolean).slice(0,nL).join(" ").trim();return e.length>=3?e:null},Zf=t=>{if(!Array.isArray(t))return[];const e=[],n=new Set;for(const a of t){const r=typeof(a==null?void 0:a.id)=="string"?a.id.trim():"",l=typeof(a==null?void 0:a.label)=="string"?a.label.trim():"";if(r.length>=3&&l.length>=3&&!n.has(r)){const c=typeof(a==null?void 0:a.intent)=="string"&&a.intent.trim()||void 0,f=typeof(a==null?void 0:a.status)=="string"?a.status:void 0;e.push({id:r,label:l,intent:c,status:f}),n.add(r)}}return e},aL=(t,e,n)=>{var l;if(t.responseType!=="text_response")return!1;const a=e.get(),r=a.plannerPendingSteps??[];if(r.length>0){const c=r[0];return((l=e.detectedIntent)==null?void 0:l.intent)==="greeting"&&r.length===1&&(c==null?void 0:c.id)===Ob.id?(t.stepId=c.id,a.addProgress(`Auto-tagged greeting reply to step "${c.id}" so it can proceed.`,"system"),typeof a.recordAgentValidationEvent=="function"&&a.recordAgentValidationEvent({actionType:"text_response",reason:"auto_step_id_greeting_ack",actionIndex:n,runId:e.runId,retryInstruction:"stepId was auto-filled with the greeting acknowledgement step so you can keep chatting."}),!0):!1}return t.stepId=Xp,a.addProgress('Auto-assigned fallback stepId "ad_hoc_response" so the agent can keep chatting.'),typeof a.recordAgentValidationEvent=="function"&&a.recordAgentValidationEvent({actionType:"text_response",reason:"auto_step_id_assigned",actionIndex:n,runId:e.runId,retryInstruction:"stepId was auto-filled because no pending steps were tracked."}),!0},ep=t=>{var n,a;const e=t.get().plannerPendingSteps;if(Array.isArray(e)&&e.length>0){const r=(a=(n=e[0])==null?void 0:n.id)==null?void 0:a.trim();if(r&&r.length>=3)return r}return Xp},iL=(t,e)=>e?t?t.toLowerCase().includes(e):!1:!0,rL=(t,e,n)=>({id:Fb(),actionId:e,responseType:t.responseType,status:n.status,timestamp:new Date().toISOString(),outputs:n.outputs??null,errorCode:n.errorCode??null,uiDelta:n.uiDelta??null}),oL=t=>{var e,n,a,r;switch(t.responseType){case"text_response":return t.text?t.text.slice(0,120):"AI text response";case"plan_creation":return(e=t.plan)!=null&&e.title?`Create analysis "${t.plan.title}"`:"Create new analysis card";case"dom_action":return t.domAction?`DOM action: ${t.domAction.toolName}`:"DOM action";case"execute_js_code":return((n=t.code)==null?void 0:n.explanation)||"Execute data transformation";case"filter_spreadsheet":return(a=t.args)!=null&&a.query?`Filter spreadsheet by "${t.args.query}"`:"Filter spreadsheet";case"clarification_request":return((r=t.clarification)==null?void 0:r.question)||"Ask user for clarification";case"proceed_to_analysis":return"Proceed to analysis pipeline";default:return"Agent action"}},lL=t=>typeof t.text=="string"&&t.text.trim().length>0,$b=t=>!!t.plan,Yb=t=>!!t.domAction,Jb=t=>!!t.code&&typeof t.code.jsFunctionBody=="string"&&t.code.jsFunctionBody.trim().length>0,uL=t=>typeof t.args=="object",Kb=t=>!!t.clarification,Gr=t=>{const e=t.planState;if(!e)return!1;const n=typeof e.goal=="string"&&e.goal.trim().length>0,a=typeof e.progress=="string"&&e.progress.trim().length>0,r=Array.isArray(e.nextSteps)&&e.nextSteps.length>0,l=typeof e.planId=="string"&&e.planId.trim().length>0,c=typeof e.currentStepId=="string"&&e.currentStepId.trim().length>=3,y=Zf(e.steps??e.nextSteps).length>0;return n&&a&&r&&l&&c&&y},cL=t=>t?jr.map(e=>t==null?void 0:t[e]).filter(e=>typeof e=="string"&&e.trim().length>0):[],dL=t=>{const e=t.get().plannerSession.planState;return{hasPendingSteps:!!(e&&Array.isArray(e.nextSteps)&&e.nextSteps.some(a=>typeof(a==null?void 0:a.id)=="string"&&a.id.trim().length>0&&typeof(a==null?void 0:a.label)=="string")),stateTag:e==null?void 0:e.stateTag,hasBlocker:!!(e!=null&&e.blockedBy&&e.blockedBy.trim().length>0)}},fL=t=>!t||!Array.isArray(t.nextSteps)||t.nextSteps.length===0?"No pending steps were captured previously.":t.nextSteps.map(e=>`- [${e.id}] ${e.label}`).join(`
`),pL=t=>{const e=t.get().plannerSession.planState,n=e?`LAST_KNOWN_PLAN:
Goal: ${e.goal}
Progress: ${e.progress}
Next Steps:
${fL(e)}`:"No previous plan was captured; establish a brand new plan.";return`
${t.userMessage}

SYSTEM NOTE: The UI failed to parse your plan. Respond with ONLY a plan_state_update (plus an optional short text_response) that restates or refines the current goal tracker. Do not execute tools yet.

${kb}

${n}
    `.trim()},VS=(t,e)=>{if(!e||e.length===0)return t;const n=e.map(a=>`- ${a}`).join(`
`);return`${t}

SYSTEM INTENT NOTES:
${n}`},Wp=(t,e)=>{var m,v,_,x,w;if(!e||e.toolName!=="removeCard")return;const n=t.get(),a=e.args??(e.args={});if(typeof a.cardId=="string"&&a.cardId.trim().length>0)return;const r=n.analysisCards??[];if(!Array.isArray(r)||r.length===0)return;const l=((v=(m=t.detectedIntent)==null?void 0:m.requiredTool)==null?void 0:v.payloadHints)??{},c=[a.cardId,l.cardId].filter(A=>typeof A=="string"&&A.trim().length>0);for(const A of c){const C=r.find(N=>(N==null?void 0:N.id)===A);if(C){a.cardId=C.id,!a.cardTitle&&((_=C.plan)!=null&&_.title)&&(a.cardTitle=C.plan.title),n.addProgress(`Auto-selected cardId ${C.id} for removeCard using intent hints.`,"system");return}}const f=A=>(A??"").toLowerCase().replace(/\s+/g," ").trim(),y=[typeof a.cardTitle=="string"?a.cardTitle:"",typeof l.cardTitle=="string"?l.cardTitle:""].map(f).filter(A=>A.length>=3);if(y.length===0)return;const p=r.filter(A=>{var N;const C=f((N=A==null?void 0:A.plan)==null?void 0:N.title);return C?y.some(I=>C.includes(I)||I.includes(C)):!1});if(p.length===1){const A=p[0];a.cardId=A.id,a.cardTitle=((x=A.plan)==null?void 0:x.title)??a.cardTitle,n.addProgress(`Auto-selected cardId ${A.id} for removeCard using title "${((w=A.plan)==null?void 0:w.title)??""}".`,"system");return}p.length>1&&n.addProgress(`Multiple charts matched "${y[0]}". Please clarify which card to remove.`,"error")},mL=(t,e)=>{const n=t.get(),a=n.analysisCards??[];if(!Array.isArray(a)||a.length===0){const y="There are no charts available yet. Create one before using this action.";n.addProgress(y,"error");const p={sender:"ai",text:y,timestamp:new Date,type:"ai_message",isError:!0};return t.set(m=>({chatHistory:[...m.chatHistory,p]})),null}const l={question:e.toolName==="removeCard"?"Which chart should I remove?":"Which chart should I update?",options:a.slice(0,9).map((y,p)=>{var m,v;return{label:((v=(m=y==null?void 0:y.plan)==null?void 0:m.title)==null?void 0:v.trim())||`Chart ${p+1}`,value:y.id}}),pendingPlan:{domActionContext:{toolName:e.toolName,args:{...e.args??{}}}},targetProperty:"title",contextType:"dom_action"},c=t.deps.registerClarification(l),f={sender:"ai",text:c.question,timestamp:new Date,type:"ai_clarification",clarificationRequest:c};return t.set(y=>({chatHistory:[...y.chatHistory,f]})),t.set({activeClarificationId:c.id}),mn(t,"clarifying","Need your input to keep going..."),t.get().endBusy(t.runId),Vb(t,c.id),c.id},hL=t=>{const e=t.trim();return e.length<3||Bb.test(e)?!1:/[\p{L}\p{N}]/u.test(e)},Zp=(t,e,n)=>{var c,f;const a=typeof e=="string"?e.trim():"";if(a)return{query:a,source:"payload"};const r=typeof((c=n==null?void 0:n.payloadHints)==null?void 0:c.query)=="string"?n.payloadHints.query.trim():"";if(r)return{query:r,source:"intent_hint"};const l=((f=t.userMessage)==null?void 0:f.trim())??"";return hL(l)?{query:l,source:"user_message"}:{query:qb,source:"default"}},FS=(t,e,n)=>{var y,p,m,v,_;if(t.responseType!=="filter_spreadsheet")return!1;const a=((y=e.detectedIntent)==null?void 0:y.intent)==="data_filter"?e.detectedIntent.requiredTool:void 0;if(!a&&((p=t.args)!=null&&p.query))return!1;const r=typeof((m=t.args)==null?void 0:m.query)=="string"?t.args.query:"",{query:l,source:c}=Zp(e,r,a);if((r==null?void 0:r.trim())===l)return!1;t.args={...t.args??{},query:l};const f=c==="default"?'Auto-filled filter query with "show entire table" to keep the conversation moving.':"Auto-filled filter query using your latest request so the filter tool can run.";return e.get().addProgress(f,"system"),(_=(v=e.get()).recordAgentValidationEvent)==null||_.call(v,{actionType:"filter_spreadsheet",reason:"auto_filter_query_filled",actionIndex:n,runId:e.runId,retryInstruction:"Filter query was auto-filled using the user intent/context."}),!0},gL=(t,e,n)=>{var y,p,m,v,_;if(t.responseType!=="dom_action"||!t.domAction)return!1;const a=(y=e.detectedIntent)==null?void 0:y.requiredTool;if(!a||a.responseType!=="dom_action"||a.domToolName&&t.domAction.toolName!==a.domToolName)return!1;const r=t.domAction.args??(t.domAction.args={});let l=!1;const c=typeof((p=a.payloadHints)==null?void 0:p.cardId)=="string"?a.payloadHints.cardId.trim():"",f=typeof((m=a.payloadHints)==null?void 0:m.cardTitle)=="string"?a.payloadHints.cardTitle.trim():"";return!r.cardId&&c&&(r.cardId=c,l=!0),!r.cardTitle&&f&&(r.cardTitle=f,l=!0),l&&(e.get().addProgress("Auto-filled DOM action payload using intent hints.","system"),(_=(v=e.get()).recordAgentValidationEvent)==null||_.call(v,{actionType:"dom_action",reason:"auto_dom_payload_filled",actionIndex:n,runId:e.runId,retryInstruction:"DOM payload fields were auto-filled using the user intent hints."})),l},yL=(t,e)=>{var a,r,l,c,f,y,p;const n=ep(t);switch(e.responseType){case"dom_action":{if(!e.domToolName)return null;const m={};(a=e.payloadHints)!=null&&a.cardId&&(m.cardId=e.payloadHints.cardId),(r=e.payloadHints)!=null&&r.cardTitle&&(m.cardTitle=e.payloadHints.cardTitle);const v={toolName:e.domToolName,args:m};return Wp(t,v),(l=v.args)!=null&&l.cardId?{type:"dom_action",responseType:"dom_action",thought:"Auto-inserted DOM action to satisfy the user intent.",stepId:n,stateTag:mf(),domAction:v}:null}case"filter_spreadsheet":{const{query:m}=Zp(t,((c=e.payloadHints)==null?void 0:c.query)??null,e);return{type:"filter_spreadsheet",responseType:"filter_spreadsheet",thought:"Auto-inserted filter to satisfy the user intent.",stepId:n,stateTag:mf(),args:{query:m}}}case"execute_js_code":{const m=t.get(),v=((f=t.userMessage)==null?void 0:f.toLowerCase())??"",_=m.columnProfiles??[],x=((y=e.payloadHints)==null?void 0:y.column)??((p=_.find(C=>v.includes(C.name.toLowerCase())))==null?void 0:p.name)??null;if(!x)return null;const A=`
const result = data.map(row => {
    const next = { ...row };
    delete next["${x.replace(/"/g,'\\"')}"];
    return next;
});
return result;
            `.trim();return{type:"execute_js_code",responseType:"execute_js_code",thought:`Auto-inserted data transform to remove the column "${x}".`,stepId:n,stateTag:mf(),code:{explanation:`Removes the column "${x}" from every row of the dataset.`,jsFunctionBody:A}}}default:return null}},vL=async(t,e,n,a)=>{const r=e().analysisCards.map(v=>({id:v.id,title:v.plan.title,aggregatedDataSample:v.aggregatedData.slice(0,100)}));let c=(()=>{const{chatMemoryPreview:v,chatMemoryExclusions:_}=e();return v.filter(x=>!_.includes(x.id))})();if(c.length===0&&at.getDocumentCount()>0)try{c=await at.search(t,3,{signal:n.getRunSignal(a)})}catch(v){v instanceof DOMException&&v.name==="AbortError"||console.error("Fallback memory search failed:",v)}const f=c,y=f.map(v=>v.text),p=()=>zb(e()).summary;return{memorySnapshot:f,requestAiResponse:(v,_)=>{var x;return oP(e().columnProfiles,e().chatHistory,v,r,e().settings,e().aiCoreAnalysisSummary,e().currentView,(((x=e().csvData)==null?void 0:x.data)||[]).slice(0,20),y,e().plannerSession.observations,e().plannerSession.planState,e().dataPreparationPlan,e().agentActionTraces.slice(-10),p(),{signal:(_==null?void 0:_.signal)??n.getRunSignal(a),mode:_==null?void 0:_.mode,onPromptProfile:w=>{var C;const A=e().recordPromptMetric;if(typeof A=="function"){const N={id:`prompt-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,mode:w.mode,charCount:w.charCount,estimatedTokens:w.estimatedTokens,promptLabel:w.promptLabel,createdAt:new Date().toISOString(),runId:a};A(N)}(C=_==null?void 0:_.onPromptProfile)==null||C.call(_,w)}})}}},SL=t=>{var n;const e=t.get();return{planState:e.plannerSession.planState,pendingSteps:e.plannerPendingSteps??[],detectedIntent:t.detectedIntent,userMessage:t.userMessage,runId:t.runId,now:Date.now(),lastStateTag:((n=e.plannerSession.planState)==null?void 0:n.stateTag)??null}},_L=async(t,e)=>{var a;return((a=t.action.thought)==null?void 0:a.trim())?e():(t.runtime.get().addProgress("AI response missing reasoning; action skipped.","error"),QL(t.runtime),t.markTrace("failed","Action blocked because no reasoning was provided.",{errorCode:Ye.THOUGHT_MISSING}),{type:"continue",observation:{status:"error",errorCode:Ye.THOUGHT_MISSING,outputs:{note:"Action skipped because thought field was empty."}}})},TL=(t,e)=>!e||t.responseType!=="plan_creation"||!t.plan?!1:[t.plan.title,t.plan.description,t.plan.groupByColumn,t.plan.valueColumn,t.plan.secondaryValueColumn].filter(Boolean).map(a=>String(a).toLowerCase()).some(a=>a.includes(e)),jb=(t,e)=>{var n;return t.responseType!==e.responseType?!1:e.responseType==="dom_action"&&e.domToolName?((n=t.domAction)==null?void 0:n.toolName)===e.domToolName:!0},ha=Object.create(null),bL=3,GS=t=>{const e=t.get();if(e.plannerSession.planState)return;const a=new Date().toISOString(),r={goal:"Acknowledge the user and gather their request.",contextSummary:"User greeted the assistant; no task specified yet.",progress:"Greeting acknowledged.",nextSteps:[Ob],blockedBy:null,observationIds:[],confidence:.5,updatedAt:a,stateTag:"context_ready"};e.updatePlannerPlanState(r),e.addProgress("Auto-seeded a greeting plan tracker so the assistant can respond.")},xL=async(t,e)=>{const n=t.runtime.runId;if(t.action.responseType==="plan_state_update"||t.action.responseType==="text_response"||t.runtime.policy.allowLooseSteps)return ha[n]=0,e();const l=(t.runtime.get().plannerPendingSteps||[])[0];if(!l)return ha[n]=0,e();const c=typeof t.action.stepId=="string"?t.action.stepId.trim():"",f=c.length>0&&c===l.id,y=sL(l.label),p=!!y&&(iL(t.action.thought,y)||TL(t.action,y));if(!f&&!p){const v=(ha[n]??0)+1;if(ha[n]=v,v>=bL)return t.runtime.get().addProgress("Relaxing plan-step enforcement after repeated attempts. Proceed carefully and build the pending chart immediately."),ha[n]=0,typeof t.runtime.get().completePlannerPendingStep=="function"&&t.runtime.get().completePlannerPendingStep(),e();const _=`"${l.label}" [${l.id}]`;t.runtime.get().addProgress(`State consistency check failed. Next planned step is ${_}. Reference it explicitly and set stepId="${l.id}" before taking other actions.`,"error"),t.markTrace("failed","Plan step order violation.",{errorCode:Ye.PLAN_STEP_OUT_OF_ORDER,metadata:{expectedStepId:l.id,expectedStepLabel:l.label}});const x=`SYSTEM NOTE: You attempted to skip the plan step ${_}. Reference it explicitly and set stepId="${l.id}" before taking other actions.`;return{type:"retry",reason:`Plan step enforcement triggered for ${_}.`,retryPrompt:x,userFacingMessage:`Plan step enforcement triggered for ${_}. I'll restate the pending step and try again.`,progressMessage:`Refocusing on pending step ${_}...`,phaseMessage:"Reordering plan execution after a failed attempt...",statusMessage:"Refocusing on the pending step...",promptMode:"full",observation:{status:"error",errorCode:Ye.PLAN_STEP_OUT_OF_ORDER,outputs:{expectedStepId:l.id,expectedStepLabel:l.label}}}}const m=t.markTrace;t.markTrace=(v,_,x)=>{v==="succeeded"&&(ha[n]=0,l&&(f||p)&&(f||t.runtime.get().addProgress(`Step ${l.id} completed via fallback inference. Future actions must include stepId="${l.id}" to avoid guard warnings.`,"error"),typeof t.runtime.get().completePlannerPendingStep=="function"&&t.runtime.get().completePlannerPendingStep())),m(v,_,x)};try{return await e()}finally{t.markTrace=m}},AL=async(t,e)=>(t.action.thought&&t.runtime.get().addProgress(`AI Thought: ${t.action.thought}`),e()),wL=async(t,e)=>{const n=HS(),a=t.markTrace;t.markTrace=(r,l,c)=>{const y=r==="succeeded"||r==="failed"?{...c??{},durationMs:Math.max(0,HS()-n)}:c;a(r,l,y)};try{return await e()}finally{t.markTrace=a}},CL=[],EL=[_L,xL,AL,wL],NL=()=>[...EL,...CL],IL=(t,e)=>t.reduceRight((n,a)=>async r=>a(r,()=>n(r)),e),RL=async(t,e,n,a)=>{t.responseType==="dom_action"&&t.domAction&&Wp(e,t.domAction);const r=XL[t.responseType];if(!r)return a("failed","Unsupported action type.",{errorCode:Ye.UNSUPPORTED_ACTION}),{type:"continue",observation:{status:"error",errorCode:Ye.UNSUPPORTED_ACTION}};const l={action:t,runtime:e,remainingAutoRetries:n,markTrace:a};return IL(NL(),r)(l)},ot=(t,e,n,a)=>({isValid:!1,userMessage:t?`AI ${t.responseType} action is invalid: ${n}. Asking it to correct the payload...`:n,retryInstruction:a,details:t?{actionType:t.responseType,actionIndex:e,reason:n}:void 0}),ML=t=>{var a;const e=t.clarification;return(a=e.question)!=null&&a.trim()?!Array.isArray(e.options)||e.options.length===0?"Clarification options are missing.":e.options.find(r=>!r||typeof r.label!="string"||typeof r.value!="string")?"Clarification option missing label or value.":e.targetProperty?null:"Clarification targetProperty is missing.":"Clarification question is empty."},DL=t=>{const e=t.args??{},n=typeof e.cardId=="string"?e.cardId.trim():"",a=typeof e.cardTitle=="string"?e.cardTitle.trim():"";if(t.toolName!=="removeCard"&&!n)return"DOM action missing cardId.";switch(t.toolName){case"changeCardChartType":if(!e.newType)return"changeCardChartType requires newType.";break;case"filterCard":if(!e.column||typeof e.column!="string")return"filterCard requires a column.";if(!Array.isArray(e.values)||e.values.length===0)return"filterCard requires at least one value.";if(e.values.some(l=>typeof l!="string"&&typeof l!="number"))return"filterCard values must be strings or numbers.";break;case"setTopN":if(e.topN===void 0||e.topN===null)return"setTopN requires the topN value.";if(e.topN!=="all"&&(!Number.isFinite(Number(e.topN))||Number(e.topN)<=0||!Number.isInteger(Number(e.topN))))return'setTopN must be a positive integer or "all".';break;case"toggleLegendLabel":if(!e.label||typeof e.label!="string")return"toggleLegendLabel requires a label.";break;case"exportCard":if(!e.format||typeof e.format!="string")return"exportCard requires a format.";break;case"removeCard":if(!n&&!a)return"removeCard requires a cardId (or cardTitle that uniquely identifies the card).";break}return null},PL=(t,e)=>{var f;const n=e.args??{},a=typeof n.cardId=="string"?n.cardId.trim():"";if(!a)return null;const l=(Array.isArray(t.get().analysisCards)?t.get().analysisCards:[]).find(y=>y.id===a);if(!l)return null;const c=((f=l.plan)==null?void 0:f.title)??"this card";switch(e.toolName){case"changeCardChartType":{const y=typeof n.newType=="string"?n.newType:null,p=l.displayChartType??l.plan.chartType;if(y&&y===p)return`Skipped chart switch because "${c}" is already a ${y} chart.`;break}case"showCardData":{if(typeof n.visible!="boolean")break;if(l.isDataVisible===n.visible)return n.visible?`Raw data for "${c}" is already visible.`:`Raw data for "${c}" is already hidden.`;break}case"setTopN":{if(n.topN===void 0)break;const y=n.topN==="all"?null:Number(n.topN);if(y!==null&&!Number.isFinite(y))break;if((typeof l.topN=="number"?l.topN:null)===y){const m=y===null?"all categories":`Top ${y}`;return`Skipped Top N change because "${c}" already shows ${m}.`}break}case"toggleHideOthers":{if(typeof n.hide!="boolean")break;if(l.hideOthers===n.hide)return n.hide?`"${c}" already hides the "Others" bucket.`:`"${c}" is already showing the "Others" bucket.`;break}}return null},zS=t=>{if(typeof t!="string")return null;const e=t.trim();return e.length===0?null:e.length<3?"Filter query must be at least 3 characters.":e.length>200?"Filter query is too long (max 200 characters).":null},LL=t=>{var a;if((((a=t.code.explanation)==null?void 0:a.trim())??"").length<10)return"Code explanation must be at least 10 characters.";const n=t.code.jsFunctionBody.trim();return/return\s+/i.test(n)?null:"JavaScript transform must include a return statement."},kL=(t,e,n)=>{if(!e)return;const a=`Validation failed at step ${e.actionIndex+1}`,r=t.get().beginAgentActionTrace(e.actionType,a,"system");t.get().updateAgentActionTrace(r,"failed",e.reason,{errorCode:Ye.VALIDATION_FAILED,metadata:{actionIndex:e.actionIndex}}),t.get().recordAgentValidationEvent({actionType:e.actionType,reason:e.reason,actionIndex:e.actionIndex,runId:t.runId,retryInstruction:n})},UL=(t,e)=>{var p,m,v,_,x,w;if(!Array.isArray(t.actions)||t.actions.length===0)return{isValid:!1,userMessage:"AI response was empty; requesting it to restate the plan...",retryInstruction:"You must return at least one action. Begin with a plan_state_update that satisfies the required schema before any other steps."};if(t.actions.length>C2){const A=t.actions[1]??t.actions[0];return ot(A,Math.min(1,t.actions.length-1),"Too many actions returned in a single response.","Limit every response to a plan_state_update followed by exactly one atomic action (text_response, dom_action, execute_js_code, etc.).")}const n=t.actions[0];let a=e.get().plannerSession.planState;const r=((p=e.detectedIntent)==null?void 0:p.intent)==="greeting";let l=null;const c=(A,C)=>{const N=typeof A.type=="string"?A.type.trim():"";if(!N)return ot(A,C,"Action type is missing.","Every action must include the type field (matching responseType) along with stepId and stateTag.");if(A.responseType!==N)return ot(A,C,"Action type must match responseType.","Keep the type field identical to responseType for every action.");A.type=N;const I=typeof A.stateTag=="string"?A.stateTag.trim():"";if(!I)return ot(A,C,"stateTag is missing.",'Every action must include a monotonic stateTag formatted as "<epochMs>-<seq>" (or a known label like "awaiting_clarification").');const R=wu(I);if(!R)return ot(A,C,"stateTag format is invalid.",'Mint stateTag tokens as "<epochMs>-<seq>" (optionally with a suffix) or use one of the known labels.');const M=kS(R);if(M){if(l&&(M.epochMs<l.epochMs||M.epochMs===l.epochMs&&M.seq<=l.seq))return ot(A,C,"stateTag must strictly increase with each action.","Ensure every new action increments the numeric portion of the stateTag so it remains monotonic.");l=M}return A.stateTag=R,null},f=()=>(GS(e),a=e.get().plannerSession.planState,a?(n.planState=a,e.get().addProgress("Relaxed plan tracker requirement for greeting; auto-filled plan_state_update payload.","system"),!0):!1);if(a){if(n.responseType==="plan_state_update"&&!Gr(n))return ot(n,0,"Plan tracker update missing required fields.","Any plan_state_update must include planId, currentStepId, steps[], goal, contextSummary, progress, nextSteps, blockedBy, observationIds, confidence, and updatedAt.")}else{if(n.responseType!=="plan_state_update")return r&&n.responseType==="text_response"?(GS(e),{isValid:!0}):ot(n??null,0,"First action must be plan_state_update when no plan tracker is active.",kb);if(!Gr(n)&&!(r&&f()))return ot(n,0,"Plan tracker snapshot missing required fields.","Your initial plan_state_update must include planId, currentStepId, steps[], goal, contextSummary, progress, nextSteps, blockedBy (or null), referenced observationIds, confidence, and updatedAt before other actions.")}for(let A=0;A<t.actions.length;A++){const C=t.actions[A],N=c(C,A);if(N)return N;const I=typeof C.stepId=="string"?C.stepId.trim():"";if(I.length<3){if(!(C.responseType==="text_response"?aL(C,e,A):!1))return ot(C,A,"stepId is missing or invalid.","Every action must include stepId matching the pending plan step id (>=3 characters, typically kebab-case).")}else C.stepId=I;switch(C.responseType){case"plan_state_update":if(!Gr(C))return ot(C,A,"Plan tracker update missing required fields.","Ensure every plan_state_update includes goal, progress, nextSteps, blockedBy, observationIds, confidence, and updatedAt.");break;case"plan_creation":if(!$b(C))return ot(C,A,"Plan payload is missing.","Provide a full analysis plan object with chart type, title, description, and column selections.");break;case"dom_action":if(!Yb(C))return ot(C,A,"DOM action payload is missing.","Include domAction with the toolName and args for card interactions.");gL(C,e,A);{const R=DL(C.domAction);if(R)return ot(C,A,R,"Provide the required DOM tool arguments, including cardId and any tool-specific fields.")}break;case"execute_js_code":if(!Jb(C))return ot(C,A,"Executable code payload is missing.","Every execute_js_code action must include explanation and a non-empty jsFunctionBody.");{const R=LL(C);if(R)return ot(C,A,R,"Ensure your data transform includes a clear explanation and a return statement.")}break;case"filter_spreadsheet":if(!uL(C)&&!FS(C,e,A))return ot(C,A,"Filter query is missing.","Provide args.query describing how to filter the spreadsheet.");{let R=zS(((m=C.args)==null?void 0:m.query)??null);if(R&&FS(C,e,A)&&(R=zS(((v=C.args)==null?void 0:v.query)??null)),R)return ot(C,A,R,"Provide a natural-language filter query between 3 and 200 characters.")}break;case"clarification_request":if(!Kb(C))return ot(C,A,"Clarification payload is missing.","Include question, options, pendingPlan, and targetProperty fields.");{const R=ML(C);if(R)return ot(C,A,R,"Clarification requests must include a question, at least one option, and a targetProperty.")}break}}const y=(_=e.detectedIntent)==null?void 0:_.requiredTool;if(y&&!e.intentRequirementSatisfied&&!t.actions.some(C=>jb(C,y))){const C=yL(e,y);if(C){const N=t.actions[0];t.actions=[N,C],l=kS((N==null?void 0:N.stateTag)??"")??null;const I=c(C,1);if(I)return I;const R=y.domToolName??y.responseType??"the required tool";e.get().addProgress(`Auto-inserted ${R} to satisfy the user's request.`,"system"),(w=(x=e.get()).recordAgentValidationEvent)==null||w.call(x,{actionType:C.responseType,reason:"auto_insert_required_tool",actionIndex:t.actions.length-1,runId:e.runId,retryInstruction:`Inserted ${R} automatically because it was required by the user intent.`})}else{const N=y.domToolName??y.responseType??"the required tool";return ot(t.actions[0]??null,0,`Required tool ${N} missing.`,`The user's intent requires using ${N}. Include that action (with the correct payload) in your response before other tools.`)}}return{isValid:!0}},OL=async(t,e,n,a,r)=>{n.get().updateBusyStatus(a);const l=await e.requestAiResponse(t,r);return R2.run(l,SL(n))},$S=t=>t.get().plannerSession.planState?"full":"plan_only",qL=async(t,e,n)=>{var A;const r="Requesting corrected plan outline...";let l=0,c=0,f=!1,y=0;const p=C=>VS(C,n.intentNotes),m=G2(n.detectedIntent),v=m.maxValidationRetries,_=m.allowPlanFallbackPrompt,x=m.allowAutoContinuation,w=async(C,N,I)=>{const R=await OL(C,e,n,N,I);$2(R,n);const M=Y2(R.actions);return M.resumePlanner&&J2(n),{response:R,meta:M}};mn(n,"observing","Reviewing the current dataset and prior context...");try{mn(n,"planning","Thinking through your question...");let{response:C,meta:N}=await w(p(t),"Thinking through your question...",{mode:$S(n)});for(;C;){if(n.get().isRunCancellationRequested(n.runId)){n.get().addProgress("Stopped processing request.");return}const I=UL(C,n);if(!I.isValid){if(c++,kL(n,I.details,I.retryInstruction),n.get().addProgress(I.userMessage,"error"),c>=v){if(!f&&_){f=!0,c=0,n.get().addProgress("Plan validation failed twice; requesting a simplified plan snapshot...","system"),mn(n,"planning","Rebuilding the plan outline..."),{response:C,meta:N}=await w(VS(pL(n),n.intentNotes),I2,{mode:"plan_only"});continue}n.get().addProgress("Unable to obtain a valid plan update after multiple attempts.","error");const L={sender:"ai",text:"Sorry, I could not establish a valid plan_state_update. Please try again or rephrase your question.",timestamp:new Date,type:"ai_message",isError:!0};n.set(ne=>({chatHistory:[...ne.chatHistory,L]}));return}mn(n,"planning","Revising the plan outline based on validation feedback..."),{response:C,meta:N}=await w(p(`${n.userMessage}

SYSTEM NOTE: ${I.retryInstruction}`),r,{mode:$S(n)});continue}const R=1-l,M=C.actions.some(L=>!["plan_state_update","text_response"].includes(L.responseType)),z=C.actions.some(L=>F2.has(L.responseType));mn(n,"acting",M?"Executing the next step of the plan...":"Delivering the latest reasoning step...");const B=await VL(C,n,R);let k=C.actions.some(L=>L.responseType==="text_response");if(B.type==="complete"&&!k&&(k=j2(n,C)),B.type==="halt")return;if(B.type==="retry"){const L=l+2;l++;const ne=`attempt ${L}`,fe=B.phaseMessage??"Retrying the last action automatically...";mn(n,"retrying",fe);const O={sender:"ai",text:B.userFacingMessage??`The previous action failed (${B.reason}). I'll try again automatically (${ne}).`,timestamp:new Date,type:"ai_message",isError:!0};n.set(P=>({chatHistory:[...P.chatHistory,O]}));const K=B.progressMessage??`Auto-retrying last action (${ne})...`;n.get().addProgress(K);const ee=B.statusMessage??"Adjusting the plan after a failed attempt...";mn(n,"planning",ee);const ve=B.retryPrompt??`SYSTEM NOTE: Previous action failed because ${B.reason}. Please adjust and try again.`,be=B.promptMode??"full";({response:C,meta:N}=await w(p(`${n.userMessage}

${ve}`),ee,{mode:be}));continue}if(N.awaitUser){K2(n,N);return}if(N.haltAfter){n.get().addProgress("Stopped auto-continue per AI instruction.");return}mn(n,"verifying","Reviewing what just happened before continuing...");const{hasPendingSteps:W,stateTag:Y,hasBlocker:Z}=dL(n),te=Y?E2.has(Y):!1;if(B.type==="complete"&&k&&x&&z&&y<LS&&W&&!te&&!Z&&!n.get().isRunCancellationRequested(n.runId)&&!M){y++;const L=n.get().plannerSession.planState,ne=[n.userMessage,"",`SYSTEM NOTE: Continue executing your plan. Current goal: ${(L==null?void 0:L.goal)??"N/A"}.`,(A=L==null?void 0:L.nextSteps)!=null&&A.length?`Remaining steps: ${L.nextSteps.map(ae=>`[${ae.id}] ${ae.label}`).join(" | ")}`:null,L!=null&&L.blockedBy?`Known blockers: ${L.blockedBy}`:null].filter(Boolean).join(`
`),fe=y===1?"Continuing plan":`Continuing plan (cycle ${y}/${LS})`;n.get().addProgress(fe),mn(n,"planning","Continuing with the remaining plan steps..."),{response:C,meta:N}=await w(p(ne),y===1?"Continuing plan...":`Continuing plan (cycle ${y})...`,{mode:"full"});continue}break}mn(n,"reporting","Summarizing the latest findings...")}finally{W2(n)||Q2(n)}},BL=t=>t.responseType==="filter_spreadsheet"||t.responseType==="execute_js_code"?!0:t.responseType==="dom_action"&&t.domAction?["filterCard","setTopN","toggleHideOthers","toggleLegendLabel","highlightCard","showCardData","removeCard"].includes(t.domAction.toolName):!1,HL=(t,e,n,a)=>{if(a.status!=="success"||!BL(e))return;const r=zb(t.get()),l={rawDataExplorerSummary:r.summary,filteredRows:r.metadata.filteredRows,totalRows:r.metadata.totalRows,snippetHash:r.metadata.snippetHash,drilldownLabel:r.metadata.drilldownLabel,drilldownValueCount:r.metadata.drilldownValueCount};t.get().appendPlannerObservation({id:Fb(),actionId:n,responseType:e.responseType,status:"success",timestamp:new Date().toISOString(),outputs:l,errorCode:null,uiDelta:null}),typeof t.get().annotateAgentActionTrace=="function"&&t.get().annotateAgentActionTrace(n,l)},VL=async(t,e,n)=>{var a;for(const r of t.actions){if(e.get().isRunCancellationRequested(e.runId))return e.get().addProgress("Cancelled remaining actions."),{type:"halt"};const l=oL(r),c=e.get().beginAgentActionTrace(r.responseType,l,"chat"),f=(A,C,N)=>{e.get().updateAgentActionTrace(c,A,C,N)},y=wu(r.stateTag),p={};y&&(p.stateTag=y),typeof r.stepId=="string"&&r.stepId.trim().length>0&&(p.stepId=r.stepId.trim());const m=Object.keys(p).length>0?{metadata:p}:void 0;f("executing",void 0,m),r.responseType==="dom_action"&&r.domAction&&Wp(e,r.domAction);const v=await RL(r,e,n,f),_=tL(v),x=rL(r,c,_);if(e.get().appendPlannerObservation(x),HL(e,r,c,x),((a=e.detectedIntent)==null?void 0:a.requiredTool)&&!e.intentRequirementSatisfied&&jb(r,e.detectedIntent.requiredTool)&&x.status==="success"&&(e.intentRequirementSatisfied=!0,e.get().addProgress(`Intent requirement satisfied via ${e.detectedIntent.requiredTool.domToolName??e.detectedIntent.requiredTool.responseType}.`),e.get().annotateAgentActionTrace(c,{intentSatisfied:!0,intent:e.detectedIntent.intent})),v.type==="retry")return{type:"retry",reason:v.reason,retryPrompt:v.retryPrompt,userFacingMessage:v.userFacingMessage,progressMessage:v.progressMessage,phaseMessage:v.phaseMessage,statusMessage:v.statusMessage,promptMode:v.promptMode};if(v.type==="halt")return{type:"halt"}}return{type:"complete"}},FL=async({action:t,runtime:e,markTrace:n})=>{if(!lL(t))return n("failed","No AI text response provided.",{errorCode:Ye.MISSING_TEXT}),{type:"continue",observation:{status:"error",errorCode:Ye.MISSING_TEXT}};const a=!e.memoryTagAttached&&e.memorySnapshot.length>0,r={sender:"ai",text:t.text,timestamp:new Date,type:"ai_message",cardId:t.cardId,usedMemories:a?e.memorySnapshot:void 0,meta:t.meta};return e.set(l=>({chatHistory:[...l.chatHistory,r]})),a&&(e.memoryTagAttached=!0),n("succeeded","Shared response with user."),{type:"continue",observation:{status:"success",outputs:{textPreview:t.text.slice(0,200),cardId:t.cardId??null}}}},GL=async({action:t,runtime:e,markTrace:n})=>{var m,v,_,x,w,A;if(!Gr(t))return n("failed","Missing plan state payload.",{errorCode:Ye.PLAN_STATE_PAYLOAD_MISSING}),{type:"continue",observation:{status:"error",errorCode:Ye.PLAN_STATE_PAYLOAD_MISSING}};const a=t.planState,r=Zf(a.nextSteps),l=Zf(a.steps),c=((m=r[0])==null?void 0:m.id)??((v=l[0])==null?void 0:v.id)??((_=e.get().plannerPendingSteps[0])==null?void 0:_.id)??Xp,f=typeof a.planId=="string"&&a.planId.trim().length>0?a.planId.trim():((x=e.get().plannerSession.planState)==null?void 0:x.planId)??`plan-${Date.now().toString(36)}`,y=typeof a.currentStepId=="string"&&a.currentStepId.trim().length>=3?a.currentStepId.trim():c,p={planId:f,goal:a.goal.trim(),progress:a.progress.trim(),nextSteps:r,steps:l.length>0?l:r,currentStepId:y,blockedBy:((w=a.blockedBy)==null?void 0:w.trim())||null,contextSummary:((A=a.contextSummary)==null?void 0:A.trim())||null,observationIds:Array.isArray(a.observationIds)?a.observationIds.filter(C=>typeof C=="string"&&C.trim().length>0):[],confidence:typeof a.confidence=="number"?Math.min(1,Math.max(0,a.confidence)):a.confidence??null,updatedAt:a.updatedAt||new Date().toISOString(),stateTag:wu(a.stateTag)??null};return e.get().updatePlannerPlanState(p),e.get().addProgress(`Plan goal updated: ${p.goal}`),n("succeeded","Plan state captured."),{type:"continue",observation:{status:"success",outputs:{goal:p.goal,nextSteps:p.nextSteps,blockedBy:p.blockedBy}}}},zL=async({action:t,runtime:e,markTrace:n})=>{const a=e.get().csvData;if(!$b(t)||!a)return n("failed","Missing plan payload or dataset.",{errorCode:Ye.MISSING_PLAN_PAYLOAD}),{type:"continue",observation:{status:"error",errorCode:Ye.MISSING_PLAN_PAYLOAD}};const r=await e.deps.runPlanWithChatLifecycle(t.plan,a,e.runId);return n("succeeded",`Executed plan for "${t.plan.title??"analysis"}".`),{type:"continue",observation:{status:"success",outputs:{planTitle:t.plan.title??"analysis",cardsCreated:r.length}}}},$L=async({action:t,runtime:e,markTrace:n})=>{var c,f,y,p,m;if(!Yb(t))return n("failed","Missing DOM action payload.",{errorCode:Ye.DOM_PAYLOAD_MISSING}),{type:"continue",observation:{status:"error",errorCode:Ye.DOM_PAYLOAD_MISSING}};if(!(typeof((c=t.domAction.target)==null?void 0:c.byId)=="string"||typeof((f=t.domAction.target)==null?void 0:f.byTitle)=="string"||typeof((y=t.domAction.target)==null?void 0:y.selector)=="string"||typeof((p=t.domAction.args)==null?void 0:p.cardId)=="string"||typeof((m=t.domAction.args)==null?void 0:m.cardTitle)=="string")){const v="I need you to pick a specific chart before I can perform that action.";e.get().addProgress(v,"error");const _={sender:"ai",text:`${v} Please tap the chart or tell me its title so I can continue.`,timestamp:new Date,type:"ai_message",isError:!0};return e.set(x=>({chatHistory:[...x.chatHistory,_]})),n("succeeded","DOM action skipped due to missing target.",{metadata:{downgraded:!0}}),{type:"continue",observation:{status:"success",outputs:{downgraded:!0}}}}const r=PL(e,t.domAction);if(r){e.get().addProgress(r);const v={sender:"ai",text:r,timestamp:new Date,type:"ai_message"};return e.set(_=>({chatHistory:[..._.chatHistory,v]})),n("succeeded","DOM action skipped (already satisfied).",{metadata:{skipped:!0,toolName:t.domAction.toolName}}),{type:"continue",observation:{status:"success",outputs:{skipped:!0,reason:r}}}}const l=t.domAction.args??(t.domAction.args={});if(typeof l.cardId!="string"||l.cardId.trim().length===0){const v=mL(e,t.domAction);return n("succeeded","Requested card selection before executing DOM action.",{metadata:{clarificationId:v}}),v?{type:"halt",observation:{status:"pending",outputs:{clarificationId:v,awaitingCardSelection:!0}}}:{type:"halt",observation:{status:"error",errorCode:Ye.DOM_PAYLOAD_MISSING}}}return e.get().executeDomAction(t.domAction),n("succeeded",`DOM action ${t.domAction.toolName} completed.`),{type:"continue",observation:{status:"success",outputs:{toolName:t.domAction.toolName,args:t.domAction.args??null},uiDelta:t.domAction.toolName}}},YL=async({action:t,runtime:e,remainingAutoRetries:n,markTrace:a})=>{const r=e.get().csvData;if(!r){const l="Dataset unavailable for transformation.";e.get().addProgress(l,"error");const c={sender:"ai",text:`${l} I could not run the requested update.`,timestamp:new Date,type:"ai_message",isError:!0};return e.set(f=>({chatHistory:[...f.chatHistory,c]})),a("failed",l,{errorCode:Ye.DATASET_UNAVAILABLE}),{type:"continue",observation:{status:"error",errorCode:Ye.DATASET_UNAVAILABLE}}}if(!Jb(t)){const l="AI requested a data transformation but did not include executable code, so no changes were applied.";e.get().addProgress(l,"error");const c={sender:"ai",text:l,timestamp:new Date,type:"ai_message",isError:!0};return e.set(f=>({chatHistory:[...f.chatHistory,c]})),a("failed","Missing jsFunctionBody in execute_js_code payload.",{errorCode:Ye.MISSING_JS_CODE}),{type:"continue",observation:{status:"error",errorCode:Ye.MISSING_JS_CODE}}}if(e.get().pendingDataTransform){const l="A previous AI transformation is still awaiting your approval. Please confirm or discard it before running another one.";e.get().addProgress(l,"error");const c={sender:"ai",text:`${l} You can review it in the Data Change banner above the dashboard.`,timestamp:new Date,type:"ai_message",isError:!0};return e.set(f=>({chatHistory:[...f.chatHistory,c]})),a("failed",l,{errorCode:Ye.TRANSFORM_PENDING}),{type:"continue",observation:{status:"error",errorCode:Ye.TRANSFORM_PENDING}}}try{const l=(L,ne)=>{if(Array.isArray(L)&&L.length>0)return L.map(ae=>ae.name);const fe=ne.find(ae=>ae&&typeof ae=="object");return fe?Object.keys(fe):[]},c=L=>{if(!L||L.length===0)return"(none)";const ne=L.slice(0,8).join(", ");return L.length>8?`${ne}, `:ne},f=e.get().columnAliasMap,y=GP(r.data,f),p=h_(y,t.code.jsFunctionBody.trim()),m=zP(p.data,f),v={...r,data:m},_=vf(v.data),x=Kr(_.map(L=>L.name)),w=l(e.get().columnProfiles,r.data),A=l(_,m),C=w.filter(L=>!A.includes(L)),N=A.filter(L=>!w.includes(L)),I=[`Before (${w.length}): ${c(w)}`,`After (${A.length}): ${c(A)}`,C.length?`Removed: ${c(C)}`:null,N.length?`Added: ${c(N)}`:null].filter(Boolean).join(`
`),{rowsBefore:R,rowsAfter:M,removedRows:z,addedRows:B,modifiedRows:k}=p.meta,W=[`${R}  ${M} rows`,z?`${z} removed`:null,B?`${B} added`:null,k?`${k} modified`:null].filter(Boolean),Y=W.length>0?W.join(", "):"changes detected",Z=`transform-${Date.now()}`;e.get().queuePendingDataTransform({id:Z,summary:Y,explanation:t.code.explanation,meta:p.meta,previewRows:m.slice(0,5),nextData:v,nextColumnProfiles:_,nextAliasMap:x,sourceCode:t.code.jsFunctionBody.trim(),createdAt:new Date().toISOString(),beforeColumns:w,afterColumns:A});const te={sender:"ai",text:`I drafted a data transformation (${Y}). Please review the banner above the dashboard to confirm or discard it.

${I}`,timestamp:new Date,type:"ai_message",cardId:t.cardId};return e.set(L=>({chatHistory:[...L.chatHistory,te]})),a("succeeded",`${Y} (awaiting confirmation)`),{type:"continue",observation:{status:"success",outputs:{summary:Y,rowsBefore:R,rowsAfter:M,pendingTransformId:Z}}}}catch(l){const c=l instanceof Error?l.message:String(l);e.get().addProgress(`AI data transformation failed: ${c}`,"error");const f={sender:"ai",text:`I couldn't apply that data transformation: ${c}`,timestamp:new Date,type:"ai_message",isError:!0};e.set(p=>({chatHistory:[...p.chatHistory,f]})),a("failed",c,{errorCode:Ye.TRANSFORM_FAILED});const y={status:"error",errorCode:Ye.TRANSFORM_FAILED,outputs:{message:c}};return n>0?{type:"retry",reason:c,observation:y}:{type:"halt",observation:y}}},JL=async({action:t,runtime:e,markTrace:n})=>{var c,f;const{query:a,source:r}=Zp(e,((c=t.args)==null?void 0:c.query)??null,((f=e.detectedIntent)==null?void 0:f.intent)==="data_filter"?e.detectedIntent.requiredTool:void 0),l=a===qb;return t.args?t.args.query=a:t.args={query:a},r==="user_message"?e.get().addProgress("No filter payload provided; inferring filter from your latest message."):r==="default"&&e.get().addProgress("No useful filter found; showing the entire dataset so you can refine it."),e.get().addProgress(l?"Showing the full raw dataset for you. Apply a natural-language filter any time.":"AI is filtering the data explorer based on your request."),await e.get().handleNaturalLanguageQuery(a),e.set({isSpreadsheetVisible:!0}),setTimeout(()=>{var y;(y=document.getElementById("raw-data-explorer"))==null||y.scrollIntoView({behavior:"smooth",block:"center"})},100),n("succeeded",`Filter query: ${a}`),{type:"continue",observation:{status:"success",outputs:{query:a,showAll:l},uiDelta:"filter_spreadsheet"}}},KL=async({action:t,runtime:e,markTrace:n})=>{var c;if(!Kb(t))return n("failed","Clarification payload missing.",{errorCode:Ye.CLARIFICATION_PAYLOAD_MISSING}),{type:"continue",observation:{status:"error",errorCode:Ye.CLARIFICATION_PAYLOAD_MISSING}};const a=$P(t.clarification,(c=e.get().csvData)==null?void 0:c.data,e.get().columnProfiles.map(f=>f.name),{preferredColumns:cL(t.clarification.pendingPlan)});if(!a){const f="I could not find any usable columns for that question. Try inspecting the data preview to pick a different column.";e.get().addProgress(f,"error");const y={sender:"ai",text:`${f}
You can also open the Data Preview to double-check column names.`,timestamp:new Date,type:"ai_message",isError:!0,cta:{type:"open_data_preview",label:"Open Data Preview",helperText:"Review the raw columns before asking again."}};return e.set(p=>({chatHistory:[...p.chatHistory,y]})),n("failed","Unable to find usable clarification options.",{errorCode:Ye.CLARIFICATION_NO_OPTIONS}),{type:"continue",observation:{status:"error",errorCode:Ye.CLARIFICATION_NO_OPTIONS}}}const r=e.deps.registerClarification(a);if(r.options.length===1){const f=r.options[0];return e.get().addProgress(`AI inferred you meant "${f.label}" (${f.value}).`),await e.get().handleClarificationResponse(r.id,f),n("succeeded","Auto-resolved clarification based on single option."),{type:"continue",observation:{status:"success",outputs:{clarificationId:r.id,autoResolved:!0}}}}const l={sender:"ai",text:r.columnHints&&r.columnHints.length>0?`${r.question}

(Column context: ${r.columnHints.join(", ")})`:r.question,timestamp:new Date,type:"ai_clarification",clarificationRequest:r};return e.set(f=>({chatHistory:[...f.chatHistory,l]})),e.set({activeClarificationId:r.id}),mn(e,"clarifying","Need your input to keep going..."),e.get().endBusy(e.runId),n("succeeded","Requested user clarification."),{type:"halt",observation:{status:"pending",outputs:{clarificationId:r.id,optionCount:r.options.length}}}},jL=async({markTrace:t})=>(t("succeeded","Proceed to analysis acknowledged."),{type:"continue",observation:{status:"success"}}),XL={text_response:FL,plan_creation:zL,plan_state_update:GL,dom_action:$L,execute_js_code:YL,filter_spreadsheet:JL,clarification_request:KL,proceed_to_analysis:jL},wu=t=>{if(!t)return;const e=t.trim();if(!e)return;if(Pb.has(e)||Lb.test(e))return e;const n=Date.now();n-qS>A2&&(console.warn(`Unknown agent stateTag "${e}". Allowed values: ${Rb.join(", ")} or minted "<epoch>-<seq>" tokens.`),qS=n)},QL=t=>{const e=Date.now();e-BS<w2||(BS=e,t.get().addToast("AI ","info"))};class WL{constructor(e){this.set=e.set,this.get=e.get,this.deps=e.deps,this.policy=e.policy??x2}async handleMessage(e){var x,w;const n=e.trim(),a={sender:"user",text:e,timestamp:new Date,type:"user_message"},r=this.get(),l=r.datasetHash??null,c=r.plannerDatasetHash??null,f=!!(c&&l&&c!==l),y=M2(e),p=Bb.test(n),m=e2(e,r);if(m.intent!=="unknown"){const A=((x=m.requiredTool)==null?void 0:x.domToolName)??((w=m.requiredTool)==null?void 0:w.responseType)??"n/a";r.addProgress(`[IntentRouter] Detected intent=${m.intent} (conf=${m.confidence.toFixed(2)}) tool=${A}`)}const v=X2(m,r);(f||y||p&&r.plannerSession.planState)&&(r.resetPlannerObservations(),r.clearPlannerPlanState(),f?r.addProgress("Detected new dataset; resetting the analysis plan tracker."):y?r.addProgress("Resetting the analysis plan as requested."):p&&r.addProgress("Greeting detected; starting a fresh plan for this interaction.")),this.set({agentAwaitingUserInput:!1,agentAwaitingPromptId:null});const _=this.get().beginBusy("Working on your request...",{cancellable:!0});this.set(A=>({chatHistory:[...A.chatHistory,a]}));try{const A=await vL(e,this.get,this.deps,_);if(this.get().isRunCancellationRequested(_)){this.get().addProgress("Stopped processing request.");return}await qL(e,A,{set:this.set,get:this.get,deps:this.deps,runId:_,userMessage:e,memorySnapshot:A.memorySnapshot,memoryTagAttached:!1,policy:this.policy,intentNotes:v,detectedIntent:m,intentRequirementSatisfied:!(m!=null&&m.requiredTool)})}catch(A){if(!this.get().isRunCancellationRequested(_)){const C=A instanceof Error?A.message:String(A);this.get().addProgress(`Error: ${C}`,"error");const N={sender:"ai",text:`Sorry, an error occurred: ${C}`,timestamp:new Date,type:"ai_message",isError:!0};this.set(I=>({chatHistory:[...I.chatHistory,N]}))}}finally{this.get().pendingClarifications.some(A=>A.status==="pending"||A.status==="resolving")||this.get().endBusy(_),this.get().clearChatMemoryPreview()}}}const ZL=(t,e,n)=>{const a=new WL({set:t,get:e,deps:n});return{chatMemoryPreview:[],chatMemoryExclusions:[],chatMemoryPreviewQuery:"",isMemoryPreviewLoading:!1,handleChatMessage:async r=>{if(!e().isApiKeySet){e().addProgress("API Key not set.","error"),e().setIsSettingsModalOpen(!0);return}await a.handleMessage(r)},previewChatMemories:async r=>{const l=r.trim();if(!l){t({chatMemoryPreview:[],chatMemoryExclusions:[],chatMemoryPreviewQuery:"",isMemoryPreviewLoading:!1});return}if(!at.getIsInitialized()||at.getDocumentCount()===0){t({chatMemoryPreview:[],chatMemoryExclusions:[],chatMemoryPreviewQuery:l,isMemoryPreviewLoading:!1});return}t({chatMemoryPreviewQuery:l,isMemoryPreviewLoading:!0});try{const c=await at.search(l,3);e().chatMemoryPreviewQuery===l&&t({chatMemoryPreview:c,chatMemoryExclusions:[],isMemoryPreviewLoading:!1})}catch(c){console.error("Preview memory search failed:",c),e().chatMemoryPreviewQuery===l&&t({isMemoryPreviewLoading:!1})}},toggleMemoryPreviewSelection:r=>{t(l=>({chatMemoryExclusions:l.chatMemoryExclusions.includes(r)?l.chatMemoryExclusions.filter(f=>f!==r):[...l.chatMemoryExclusions,r]}))},clearChatMemoryPreview:()=>{t({chatMemoryPreview:[],chatMemoryExclusions:[],chatMemoryPreviewQuery:"",isMemoryPreviewLoading:!1})},handleClarificationResponse:async(r,l)=>{const{csvData:c,columnProfiles:f}=e(),y=e().pendingClarifications.find(m=>m.id===r&&m.status==="pending");if(!y||!c)return;const p={sender:"user",text:`Selected: ${l.label}`,timestamp:new Date,type:"user_message"};t(m=>({chatHistory:[...m.chatHistory,p]})),await jf({beginBusy:e().beginBusy,endBusy:e().endBusy},"Applying clarification...",async m=>{try{n.updateClarificationStatus(r,"resolving");const{pendingPlan:v,targetProperty:_}=y;if(y.contextType==="dom_action"&&(v!=null&&v.domActionContext)){const R=v.domActionContext,M={...R.args??{},cardId:l.value,cardTitle:l.label};e().executeDomAction({toolName:R.toolName,args:M}),n.updateClarificationStatus(r,"resolved"),t(z=>({pendingClarifications:z.pendingClarifications.map(B=>B.id===r?{...B,status:"resolved"}:B),agentAwaitingUserInput:!1,agentAwaitingPromptId:null,chatHistory:[...z.chatHistory,{sender:"ai",text:R.toolName==="removeCard"?`Removed the chart "${l.label}".`:`Updated the chart "${l.label}".`,timestamp:new Date,type:"ai_message"}]})),e().addProgress(`Applied ${R.toolName} to "${l.label}".`);return}const x=f.map(R=>R.name),w=Ib(l,_,x);if(jr.includes(_)&&(!w||!x.includes(w))){const R=`I couldn't find a column matching "${l.label}". Please pick another option so I know which column to use.`;e().addProgress(R,"error");const M={sender:"ai",text:R,timestamp:new Date,type:"ai_message",isError:!0};t(z=>({chatHistory:[...z.chatHistory,M]})),n.updateClarificationStatus(r,"pending");return}const A=_==="groupByColumn",C=A?nu(w,c.data,2,50):nu(w,c.data);if(jr.includes(_)&&w&&!C){const R=A?`The column "${w}" doesn't look like a good grouping (not enough distinct categories). Please pick another option.`:`Looks like "${w}" does not contain data right now. Please pick another option or ask about a different metric.`;e().addProgress(R,"error");const M={sender:"ai",text:R,timestamp:new Date,type:"ai_message",isError:!0};t(z=>({chatHistory:[...z.chatHistory,M]})),n.updateClarificationStatus(r,"pending");return}const N={...v,[_]:w??l.value},I=YP(N,f);if(I.aggregation||(I.aggregation=I.valueColumn?"sum":"count"),I.chartType||(I.chartType="bar"),I.chartType!=="scatter"&&(delete I.xValueColumn,delete I.yValueColumn),I.chartType!=="combo"&&(delete I.secondaryValueColumn,delete I.secondaryAggregation),!I.groupByColumn&&I.chartType!=="scatter"){const R=f.map(B=>B.name);let M=null;const z=[...R].sort((B,k)=>k.length-B.length);for(const B of z){const k=B.toLowerCase().replace(/_/g," ");if(l.label.toLowerCase().includes(k)){M=B;break}}if(M)I.groupByColumn=M,e().addProgress(`AI inferred grouping by "${M}" based on your selection.`);else{const{column:B}=Nb(f,c.data);B&&(I.groupByColumn=B,e().addProgress(`AI inferred grouping by "${B}" based on your dataset.`))}}if(I.title||(I.title=`Analysis of ${l.label}`),I.description||(I.description=`A chart showing an analysis of ${l.label}.`),I.chartType!=="scatter"&&(!I.chartType||!I.groupByColumn||!I.aggregation)){const R=["chartType","groupByColumn","aggregation"].filter(M=>!I[M]);throw R.includes("groupByColumn")?new Error("/ grouping column (system could not infer the grouping column)."):new Error(`The clarified plan is still missing required fields like ${R.join(", ")}.`)}await n.runPlanWithChatLifecycle(I,c,m),n.updateClarificationStatus(r,"resolved")}catch(v){if(!e().isRunCancellationRequested(m)){const _=v instanceof Error?v.message:String(v);e().addProgress(`Error processing clarification: ${_}`,"error");const x={sender:"ai",text:`Sorry, an error occurred while creating the chart: ${_}`,timestamp:new Date,type:"ai_message",isError:!0};t(w=>({chatHistory:[...w.chatHistory,x]})),n.updateClarificationStatus(r,"pending")}}},{cancellable:!0})},skipClarification:r=>{const l=e().pendingClarifications.find(y=>y.id===r&&y.status==="pending");if(!l)return;const c={sender:"user",text:`Skipped: ${l.question}`,timestamp:new Date,type:"user_message"},f={sender:"ai",text:"No problemI cancelled that request. Ask me something else whenever you are ready.",timestamp:new Date,type:"ai_message"};n.updateClarificationStatus(r,"skipped"),t(y=>({chatHistory:[...y.chatHistory,c,f]})),e().endBusy()}}},ek=25,tk=t=>{let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n),e|=0;return Math.abs(e).toString(36)},au=t=>{if(!t||!t.data)return null;const e=t.data.slice(0,ek),n=JSON.stringify({name:t.fileName??"unknown",rows:t.data.length,sample:e,columns:e[0]?Object.keys(e[0]):[]});return`ds_${tk(n)}`},Xb="csv_agent_db",nk=3,Ei="provenance",Hs="clean_rows",Vs="columns",is="views";let ga=null;const Qb=async()=>{await new Promise((t,e)=>{const n=indexedDB.deleteDatabase(Xb);n.onsuccess=()=>t(),n.onerror=()=>e(n.error),n.onblocked=()=>console.warn("IndexedDB delete blocked. Close other tabs to proceed.")}),ga=null},sk=(t,e)=>{if(!t.objectStoreNames.contains(e)){if(e===Hs){t.createObjectStore(e,{keyPath:"chunkId"}).createIndex("by_dataset","datasetId",{unique:!1});return}if(e===Vs){t.createObjectStore(e,{keyPath:"datasetId"});return}if(e===is){t.createObjectStore(e,{keyPath:"id"}).createIndex("by_dataset","datasetId",{unique:!1});return}if(e===Ei){t.createObjectStore(e,{keyPath:"datasetId"});return}throw new Error(`Unsupported store name: ${e}`)}},YS=async t=>{try{return await t()}catch(e){if(e instanceof DOMException&&e.name==="VersionError")return console.warn("IndexedDB version mismatch detected. Resetting csv_agent_db...",e),await Qb(),t();throw e}},ak=[Ei,Hs,Vs,is],Li=async(t=[])=>{const e=Array.from(new Set([...ak,...t])),n=(c,f)=>Tb(Xb,c,{upgrade(y){f.forEach(p=>sk(y,p))}});if(!ga)return ga=YS(()=>n(nk,e)),ga;const a=await ga;if(e.filter(c=>!a.objectStoreNames.contains(c)).length===0)return a;a.close();const l=a.version+1;return ga=YS(()=>n(l,e)),ga},ik=(t,e)=>{const n=[];for(let a=0;a<t.length;a+=e)n.push(t.slice(a,a+e));return n},rk=async t=>{const{datasetId:e,rows:n,columns:a,provenance:r,chunkSize:l=2e4}=t;if(!e)throw new Error("persistCleanDataset requires datasetId.");const c=async()=>{const y=(await Li([Hs,Vs,is])).transaction([Hs,Vs,Ei],"readwrite"),p=y.objectStore(Hs),m=y.objectStore(Vs),v=y.objectStore(Ei);await p.clear();const _=ik(n,l),x=new Date().toISOString();for(let C=0;C<_.length;C+=1){const N=_[C],I={chunkId:`${e}-chunk-${C}`,datasetId:e,rowCount:N.length,startRow:C*l,endRow:C*l+N.length-1,rows:N,createdAt:x};await p.put(I)}const w={datasetId:e,columnCount:a.length,columns:a,rowCount:n.length,updatedAt:x};await m.put(w);const A={datasetId:e,fileName:r.fileName,bytes:r.bytes,checksum:r.checksum,cleanedAt:r.cleanedAt};return await v.put(A),await y.done,{chunkCount:_.length,rowCount:n.length}};try{return await c()}catch(f){if(f instanceof DOMException&&f.name==="NotFoundError")return console.warn("IndexedDB store missing detected. Resetting and retrying persist...",f),await Qb(),c();throw f}},ok=async t=>{const{datasetId:e,title:n,kind:a,queryHash:r,explainer:l,dataRef:c}=t,y=(await Li([is])).transaction(is,"readwrite"),p=y.objectStore(is),m=typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,v=`${e}-view-${m}`,_={id:v,datasetId:e,title:n,kind:a,queryHash:r,explainer:l,dataRef:c,createdAt:new Date().toISOString()};return await p.put(_),await y.done,v},lk=async t=>{const e=await Li([is]);try{const n=e.transaction(is,"readonly"),l=await n.objectStore(is).index("by_dataset").getAll(t);return await n.done,l}catch(n){return console.warn(`Failed to read card results for ${t}`,n),[]}},uk=async t=>{const n=(await Li()).transaction(Ei,"readonly"),r=await n.objectStore(Ei).get(t);return await n.done,r??void 0},ck=async t=>{const n=(await Li([Vs])).transaction(Vs,"readonly"),r=await n.objectStore(Vs).get(t);return await n.done,r??null},dk=async(t,e)=>{const a=(await Li([Hs])).transaction(Hs,"readonly"),l=a.objectStore(Hs).index("by_dataset");let c=!1;const f=()=>{c=!0};let y=await l.openCursor(t);for(;y&&!c;){const p=y.value;if(await e(p,f),c)break;y=await y.continue()}await a.done},fk=async t=>{const e=[];return await dk(t,n=>{e.push(...n.rows)}),e};let Gl=null;const Br=new Map,pk=()=>{if(typeof window>"u"||typeof Worker>"u")throw new Error("Web Workers are not supported in this environment.");const t=new Worker(new URL("/agent_csv_dataWorker-CLz5EJ5y.js",import.meta.url),{type:"module"});return t.onmessage=e=>{const n=e.data;if(!n||typeof n.id!="string")return;const a=Br.get(n.id);a&&(Br.delete(n.id),a(n))},t.onerror=e=>{console.error("dataWorker runtime error:",e);const n=e!=null&&e.message&&typeof e.message=="string"?`Data worker crashed: ${e.message}`:"Data worker crashed.";Br.forEach(a=>a({id:"error",ok:!1,reason:n,hint:"Reload and retry your action."})),Br.clear(),t.terminate(),Gl=null},t},mk=()=>(Gl=Gl??pk(),Gl),hf=async(t,e)=>{try{const n=mk(),a=`${t}-${Date.now()}-${Math.random().toString(36).slice(2,8)}`;return await new Promise(r=>{Br.set(a,l=>{l.ok&&l.result?r({ok:!0,data:l.result,durationMs:l.durationMs??0}):r({ok:!1,reason:l.reason??"Worker failed to respond.",hint:l.hint,durationMs:l.durationMs})}),n.postMessage({id:a,action:t,payload:e})})}catch(n){return{ok:!1,reason:n instanceof Error?n.message:"Failed to start worker.",hint:"This browser may not support Web Workers. Try a modern Chromium-based browser."}}},zr={profile:(t,e)=>hf("profile",{datasetId:t,sampleSize:e}),sample:(t,e)=>hf("sample",{datasetId:t,...e??{}}),aggregate:t=>hf("aggregate",t),createCardFromResult:async({datasetId:t,title:e,kind:n,explainer:a,result:r,plan:l})=>{try{const c={schema:r.schema,rows:r.rows,sampled:r.provenance.sampled,source:"aggregate",planSnapshot:l};return{ok:!0,data:{cardId:await ok({datasetId:t,title:e,kind:n,queryHash:r.provenance.queryHash,explainer:a,dataRef:c})},durationMs:0}}catch(c){return{ok:!1,reason:c instanceof Error?c.message:"Failed to store card.",hint:"Retry after checking IndexedDB permissions."}}}},em="csv_agent_last_dataset",Wb=t=>{try{t()}catch(e){console.warn("Dataset cache error:",e)}},Zb=t=>{Wb(()=>{typeof localStorage>"u"||localStorage.setItem(em,t)})},hk=()=>{Wb(()=>{typeof localStorage>"u"||localStorage.removeItem(em)})},gk=()=>{try{return typeof localStorage>"u"?null:localStorage.getItem(em)}catch(t){return console.warn("Dataset cache read error:",t),null}},yk=(t,e,n)=>({handleFileUpload:async a=>{var c;const r=e();if(r.csvData&&r.csvData.data.length>0){const f=await Jr(qs);if(f){const y=`report-${f.createdAt.getTime()}`,p={...f,id:y,updatedAt:new Date};try{await Jf(p)}catch(m){console.error("Failed to archive current session before upload:",m)}}}at.clear(),await Kf(qs),n.resetAutoSaveSession(),await e().loadReportsList(),t({...n.initialAppState,csvData:{fileName:a.name,data:[]},datasetHash:null,busyRunId:null,isCancellationRequested:!1,aiFilterRunId:null,abortControllers:{},toasts:[],chatMemoryPreview:[],chatMemoryExclusions:[],chatMemoryPreviewQuery:"",isMemoryPreviewLoading:!1});const l=e().beginBusy(`Processing ${a.name}...`,{cancellable:!0});try{const f=async w=>{try{const A=await zr.profile(w);A.ok?t({datasetProfile:A.data}):e().addProgress(`Profiling failed: ${A.reason}`,"error")}catch(A){console.error("Failed to profile dataset via worker:",A),e().addProgress("Profiling worker failedretry later from chat.","error")}},y=async w=>{try{const A=await zr.sample(w,{n:200});A.ok&&t({initialDataSample:A.data.rows})}catch(A){console.error("Failed to sample dataset via worker:",A)}},p=async(w,A)=>{try{t(N=>({analysisTimeline:{...N.analysisTimeline,stage:"persisting",totalCards:0,completedCards:0}})),e().addProgress("Persisting cleaned dataset for offline reuse");const C=await rk({datasetId:w,rows:v.data,columns:A,provenance:{fileName:a.name,bytes:a.size,checksum:w,cleanedAt:new Date().toISOString()}});Zb(w),e().addProgress(`Cached ${C.rowCount} rows in ${C.chunkCount} chunks.`),t(N=>({analysisTimeline:{...N.analysisTimeline,stage:"profiling"}})),await Promise.all([f(w),y(w)])}catch(C){console.error("Failed to persist cleaned dataset:",C),e().addProgress("IndexedDB cache failedrefreshing may lose progress.","error"),t(N=>({analysisTimeline:{...N.analysisTimeline,stage:"idle"}}))}};e().updateBusyStatus("Parsing CSV file...");const m=await Jw(a);if(e().addProgress(`Parsed ${m.data.length} rows.`),e().isRunCancellationRequested(l)){e().addProgress("Upload cancelled before analysis.");return}t({initialDataSample:m.data.slice(0,20)});let v=m,_,x=null;if(e().isApiKeySet){e().updateBusyStatus("Initializing AI memory..."),await at.init(e().addProgress),e().addProgress("AI is analyzing data for cleaning and reshaping...");const w=vf(v.data);if(e().updateBusyStatus("Drafting data preparation plan..."),x=await tP(w,v.data.slice(0,20),e().settings,{signal:(c=e().createAbortController(l))==null?void 0:c.signal}),e().isRunCancellationRequested(l)){e().addProgress("Upload cancelled during preparation.");return}if(x&&x.jsFunctionBody){e().addProgress(`AI Plan: ${x.explanation}`),e().addProgress("Executing AI data transformation...");try{const N=h_(v.data,x.jsFunctionBody);v.data=N.data;const{rowsBefore:I,rowsAfter:R,removedRows:M,addedRows:z,modifiedRows:B}=N.meta,k=[`${I}  ${R} rows`];M&&k.push(`${M} removed`),z&&k.push(`${z} added`),B&&k.push(`${B} modified`),e().addProgress(`Transformation complete (${k.join(", ")}).`)}catch(N){const I=N instanceof Error?N.message:String(N);throw e().addProgress(`Data transformation failed: ${I}`,"error"),N}}else e().addProgress("AI found no necessary data transformations.");if(_=x.outputColumns,v.data.length===0)throw new Error("Dataset empty after transformation.");const A=Kr(_.map(N=>N.name)),C=au(v);if(!C)throw new Error(" fingerprint");await p(C,_),t({csvData:v,columnProfiles:_,columnAliasMap:A,datasetHash:C,dataPreparationPlan:x,currentView:"analysis_dashboard"}),await e().handleInitialAnalysis(v,{runId:l})}else{e().addProgress("API Key not set. Please add it in the settings.","error"),e().setIsSettingsModalOpen(!0),_=vf(v.data);const w=Kr(_.map(C=>C.name)),A=au(v);if(!A)throw new Error("");await p(A,_),t({csvData:v,columnProfiles:_,columnAliasMap:w,datasetHash:A,currentView:"analysis_dashboard"})}}catch(f){if(!e().isRunCancellationRequested(l)){console.error("File processing error:",f);const y=f instanceof Error?f.message:String(f);e().addProgress(`File Processing Error: ${y}`,"error"),t({currentView:"file_upload"})}}finally{e().endBusy(l)}},handleNewSession:async()=>{if(e().csvData){const a=await Jr(qs);if(a){const r=`report-${a.createdAt.getTime()}`;try{await Jf({...a,id:r,updatedAt:new Date})}catch(l){console.error("Failed to archive session before starting new one:",l)}}}at.clear(),await Kf(qs),n.resetAutoSaveSession(),hk(),t({...n.initialAppState,busyRunId:null,isCancellationRequested:!1,aiFilterRunId:null,abortControllers:{},toasts:[],chatMemoryPreview:[],chatMemoryExclusions:[],chatMemoryPreviewQuery:"",isMemoryPreviewLoading:!1}),await e().loadReportsList()}}),vk=(t,e,n)=>({handleNaturalLanguageQuery:async a=>{var f;if(!e().isApiKeySet||!e().csvData){e().addProgress("Cannot perform AI query: API Key is not set or no data is loaded.","error");return}const r=e().aiFilterRunId;r&&e().abortRunControllers(r);const l=n.createRunId();t({isAiFiltering:!0,aiFilterRunId:l,spreadsheetFilterFunction:null,aiFilterExplanation:null}),e().addProgress(`AI is processing your data query: "${a}"...`);const c=(f=e().createAbortController(l))==null?void 0:f.signal;try{const y=await lP(a,e().columnProfiles,e().csvData.data.slice(0,5),e().settings,{signal:c});t({spreadsheetFilterFunction:y.jsFunctionBody,aiFilterExplanation:y.explanation}),e().addProgress(`AI filter applied: ${y.explanation}`),e().addToast("AI filter applied successfully.","success")}catch(y){if(y instanceof DOMException&&y.name==="AbortError")e().addProgress("AI filter request cancelled."),e().addToast("AI filter cancelled.","info");else{const p=y instanceof Error?y.message:String(y);e().addProgress(`AI query failed: ${p}`,"error"),e().addToast(`AI filter failed: ${p}`,"error")}}finally{e().clearRunControllers(l),t(y=>y.aiFilterRunId===l?{isAiFiltering:!1,aiFilterRunId:null}:{})}},clearAiFilter:()=>{const a=e().aiFilterRunId;a&&e().abortRunControllers(a);const r=!!e().spreadsheetFilterFunction;if(t({spreadsheetFilterFunction:null,aiFilterExplanation:null,aiFilterRunId:null,isAiFiltering:!1}),r){const l={sender:"ai",text:"System note: Raw Data Explorer AI filter was cleared, so the table now shows all rows.",timestamp:new Date,type:"ai_message"};t(c=>({chatHistory:[...c.chatHistory,l]}))}e().addProgress("AI data filter cleared."),e().addToast("AI filter cleared.","info")},cancelAiFilterRequest:()=>{const{aiFilterRunId:a,isAiFiltering:r}=e();!a||!r||(e().abortRunControllers(a),t({isAiFiltering:!1,aiFilterRunId:null}),e().addProgress("AI data filter cancelled."),e().addToast("AI filter cancelled.","info"))}}),ex=5e3,JS=6e4;class Sk{constructor(e){this.deps=e,this.timer=null,this.inFlight=!1,this.failureToastId=null,this.config={enabled:!0,intervalMs:15e3},this.backoffMs=0,this.lastCreatedAt=null}configure(e){const n={enabled:e.enabled,intervalMs:Math.max(ex,e.intervalMs)};if(this.config=n,!e.enabled){this.stop(),this.clearFailureToast();return}this.restart()}triggerImmediateSave(e=!1){!this.config.enabled&&!e||this.schedule(0,e)}resetSessionMetadata(){this.lastCreatedAt=null}seedCreatedAt(e){this.lastCreatedAt=e}stop(){this.timer&&(clearTimeout(this.timer),this.timer=null)}restart(){this.stop(),this.schedule(this.config.intervalMs)}schedule(e,n=!1){this.stop(),this.timer=setTimeout(()=>{this.performSave(n).finally(()=>{if(this.config.enabled){const a=this.config.intervalMs+this.backoffMs;this.schedule(a)}})},Math.max(0,e))}async performSave(e=!1){var a;if(this.inFlight||!this.config.enabled&&!e)return;const n=this.deps.getStore();if(this.shouldSave(n)){this.inFlight=!0;try{const r=this.deps.buildSnapshot(n),l=await this.ensureCreatedAt(),c={id:qs,filename:((a=n.csvData)==null?void 0:a.fileName)||"Current Session",createdAt:l,updatedAt:new Date,appState:r};await Jf(c),this.backoffMs=0,this.clearFailureToast()}catch(r){console.error("Auto-save failed:",r),this.backoffMs=this.backoffMs===0?Math.min(this.config.intervalMs,JS):Math.min(this.backoffMs*2,JS),this.showFailureToast()}finally{this.inFlight=!1}}}async ensureCreatedAt(){if(this.lastCreatedAt)return this.lastCreatedAt;const e=await Jr(qs);return this.lastCreatedAt=(e==null?void 0:e.createdAt)??new Date,this.lastCreatedAt}shouldSave(e){return!!(e.csvData&&e.csvData.data.length>0)}showFailureToast(){this.failureToastId||(this.failureToastId=this.deps.addToast("Auto-save failed. Click to retry now.","error",0,{label:"Retry now",onClick:()=>this.triggerImmediateSave(!0)}))}clearFailureToast(){this.failureToastId&&(this.deps.dismissToast(this.failureToastId),this.failureToastId=null)}}const _k=t=>({enabled:t.autoSaveEnabled,intervalMs:Math.max(ex,t.autoSaveIntervalSeconds*1e3)}),Tk=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`clar-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,KS=()=>`run-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,bk=()=>`toast-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,xk=()=>`val-${Date.now()}-${Math.random().toString(36).slice(2,8)}`;let $t=null,iu=null;const tx=t=>{iu=_k(t),$t==null||$t.configure(iu)},Ak=()=>{$t==null||$t.resetSessionMetadata()},jS=t=>{$t==null||$t.seedCreatedAt(t)},wk=()=>{$t==null||$t.triggerImmediateSave(!0)},Ck=t=>{var e;return((e=t.find(n=>n.status==="pending"))==null?void 0:e.id)??null},XS=t=>(t??[]).map(e=>({id:typeof(e==null?void 0:e.id)=="string"?e.id.trim():"",label:typeof(e==null?void 0:e.label)=="string"?e.label.trim():"",intent:typeof(e==null?void 0:e.intent)=="string"&&e.intent.trim()||void 0,status:typeof(e==null?void 0:e.status)=="string"?e.status:void 0})).filter(e=>e.id.length>=3&&e.label.length>=3),Ek=t=>{if(!t)return"report";const e=t.split(/\r?\n/).map(a=>a.trim()).find(Boolean);return e&&e.replace(/[^a-z0-9-_]+/gi,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||"report"},Nk=t=>({currentView:t.currentView,isBusy:t.isBusy,busyMessage:t.busyMessage,canCancelBusy:t.canCancelBusy,progressMessages:t.progressMessages,csvData:t.csvData,columnProfiles:t.columnProfiles,analysisCards:t.analysisCards,chatHistory:t.chatHistory,finalSummary:t.finalSummary,aiCoreAnalysisSummary:t.aiCoreAnalysisSummary,dataPreparationPlan:t.dataPreparationPlan,initialDataSample:t.initialDataSample,datasetHash:t.datasetHash,vectorStoreDocuments:at.getDocuments(),spreadsheetFilterFunction:t.spreadsheetFilterFunction,aiFilterExplanation:t.aiFilterExplanation,datasetProfile:t.datasetProfile,pendingClarifications:t.pendingClarifications,activeClarificationId:t.activeClarificationId,toasts:[],agentActionTraces:t.agentActionTraces,agentValidationEvents:t.agentValidationEvents,columnAliasMap:t.columnAliasMap,pendingDataTransform:t.pendingDataTransform,lastAppliedDataTransform:t.lastAppliedDataTransform,isLastAppliedDataTransformBannerDismissed:t.isLastAppliedDataTransformBannerDismissed,interactiveSelectionFilter:t.interactiveSelectionFilter,plannerSession:t.plannerSession,agentPhase:t.agentPhase,plannerPendingSteps:t.plannerPendingSteps,agentPromptMetrics:t.agentPromptMetrics,plannerDatasetHash:t.plannerDatasetHash,agentAwaitingUserInput:t.agentAwaitingUserInput,agentAwaitingPromptId:t.agentAwaitingPromptId,analysisTimeline:t.analysisTimeline}),Ik=t=>{const e=new Date().toISOString().replace(/[:.]/g,"-");return`${Ek(t)}-${e}.csv`},QS=async(t,e,n,a,r,l,c)=>{if(!t||t.length===0)return;let f=null;try{if(!(!!e&&!!n&&e===n)){at.clear(),a("Skipped AI memory restore because the dataset changed since last session."),r("AI memory reset for this dataset.","info",5e3);return}if(!at.getIsInitialized()&&(f=r("Preparing AI memory from history...","info",0),await at.init(a)),!at.getIsInitialized()){a("AI memory model failed to load; saved chat context is unavailable right now.","error"),f&&l(f);return}f&&l(f),at.rehydrate(t),a(c),r("AI memory ready for this report.","success")}catch(y){f&&l(f),console.error("Failed to restore AI memory from saved session:",y),a("Restoring AI memory failed; chat recall may be incomplete this session.","error"),r("AI memory failed to load. Try reloading or re-importing the file.","error",6e3)}},gf=320,Rk=800,Mk=600,WS=(t=[])=>Kr(t.map(e=>e.name)),tp=t=>({observations:(t==null?void 0:t.observations)??[],planState:(t==null?void 0:t.planState)??null}),Dk=(t,e)=>t.length!==e.length?!1:t.every((n,a)=>n===e[a]),Pk=t=>{switch(t.chartType){case"line":return"trend";case"bar":case"pie":case"doughnut":case"combo":return"topn";default:return"kpi"}},Lk=t=>{const e=t.dataRef.planSnapshot??{},n=e.chartType??"bar",a={chartType:n,title:e.title??t.title,description:e.description??t.explainer??"",aggregation:e.aggregation,groupByColumn:e.groupByColumn,valueColumn:e.valueColumn,xValueColumn:e.xValueColumn,yValueColumn:e.yValueColumn,secondaryValueColumn:e.secondaryValueColumn,secondaryAggregation:e.secondaryAggregation,defaultTopN:e.defaultTopN,defaultHideOthers:e.defaultHideOthers,rowFilter:e.rowFilter};return{id:t.id,plan:a,aggregatedData:t.dataRef.rows,summary:t.explainer,displayChartType:n,isDataVisible:!1,topN:e.defaultTopN??null,hideOthers:e.defaultHideOthers??!1,disableAnimation:!0,hiddenLabels:[],dataRefId:t.id,queryHash:t.queryHash,isSampledResult:t.dataRef.sampled}},Dr={currentView:"file_upload",isBusy:!1,busyMessage:null,canCancelBusy:!1,progressMessages:[],csvData:null,columnProfiles:[],analysisCards:[],chatHistory:[],finalSummary:null,aiCoreAnalysisSummary:null,dataPreparationPlan:null,initialDataSample:null,datasetHash:null,vectorStoreDocuments:[],spreadsheetFilterFunction:null,aiFilterExplanation:null,datasetProfile:null,pendingClarifications:[],activeClarificationId:null,toasts:[],agentActionTraces:[],agentValidationEvents:[],columnAliasMap:{},pendingDataTransform:null,lastAppliedDataTransform:null,isLastAppliedDataTransformBannerDismissed:!1,interactiveSelectionFilter:null,plannerSession:tp(),agentPhase:{phase:"idle",message:null,enteredAt:null},plannerPendingSteps:[],agentPromptMetrics:[],plannerDatasetHash:null,agentAwaitingUserInput:!1,agentAwaitingPromptId:null,analysisTimeline:{stage:"idle",totalCards:0,completedCards:0}},Ue=cC((t,e)=>{const n=m=>{const v={...m,id:Tk(),status:"pending",contextType:m.contextType??"plan"};return t(_=>({pendingClarifications:[..._.pendingClarifications,v],activeClarificationId:v.id})),v},a=(m,v)=>{e().pendingClarifications.some(x=>x.id===m)&&t(x=>{const w=x.pendingClarifications.map(C=>C.id===m?{...C,status:v}:C),A=v==="pending"||v==="resolving"?m:Ck(w);return{pendingClarifications:w,activeClarificationId:A}})},r=m=>{var v;return m?(v=e().createAbortController(m))==null?void 0:v.signal:void 0},c=ZL(t,e,{registerClarification:n,updateClarificationStatus:a,getRunSignal:r,runPlanWithChatLifecycle:async(m,v,_)=>{if(_&&e().isRunCancellationRequested(_))return[];const x=m.title??"your requested chart",w={sender:"ai",text:`Okay, creating a chart for "${x}".`,timestamp:new Date,type:"ai_plan_start"};t(C=>({chatHistory:[...C.chatHistory,w]}));const A=await e().runAnalysisPipeline([m],v,{isChatRequest:!0,runId:_});if(A.length>0){const C=A[0].summary.split("---")[0].trim(),N={sender:"ai",text:`Created the chart for "${x}". Here's what I observed:
${C}`,timestamp:new Date,type:"ai_message",cardId:A[0].id};t(I=>({chatHistory:[...I.chatHistory,N]}))}return A}}),f=async m=>{e().addProgress("Restoring cached dataset from IndexedDB");try{const[v,_,x,w]=await Promise.all([uk(m),ck(m),fk(m),lk(m)]);if(!x||x.length===0)return e().addProgress("Cached dataset was empty. Please re-upload your CSV.","error"),!1;const A={fileName:(v==null?void 0:v.fileName)??"cached.csv",data:x},C=(_==null?void 0:_.columns)??[],N=Kr(C.map(M=>M.name)),I=w.map(Lk);t({...Dr,csvData:A,columnProfiles:C,columnAliasMap:N,analysisCards:I,datasetHash:m,currentView:"analysis_dashboard",analysisTimeline:I.length?{stage:"insight",totalCards:I.length,completedCards:I.length}:{stage:"profiling",totalCards:0,completedCards:0},initialDataSample:x.slice(0,50)}),Zb(m);const R=await zr.profile(m);return R.ok?t({datasetProfile:R.data}):addProgress(`Profiling worker failed: ${R.reason}`,"error"),!0}catch(v){return console.error("Failed to restore cached dataset:",v),e().addProgress("Cached dataset restore failed. Please re-upload.","error"),!1}},y=yk(t,e,{initialAppState:Dr,resetAutoSaveSession:Ak}),p=vk(t,e,{createRunId:KS});return{...Dr,...c,...y,...p,busyRunId:null,isCancellationRequested:!1,aiFilterRunId:null,abortControllers:{},isAsideVisible:!0,asideWidth:window.innerWidth/4>gf?window.innerWidth/4:gf,isSpreadsheetVisible:!0,isDataPrepDebugVisible:!1,isSettingsModalOpen:!1,isHistoryPanelOpen:!1,isMemoryPanelOpen:!1,isAiFiltering:!1,settings:CS(),reportsList:[],isResizing:!1,isApiKeySet:(()=>{const m=CS();return m.provider==="google"?!!m.geminiApiKey:!!m.openAIApiKey})(),beginBusy:(m,v)=>{const _=KS();return t({isBusy:!0,busyMessage:m,canCancelBusy:!!(v!=null&&v.cancellable),busyRunId:_,isCancellationRequested:!1}),_},updateBusyStatus:m=>{e().isBusy&&t({busyMessage:m})},endBusy:m=>{const v=e().busyRunId;if(m&&v&&v!==m)return;t({isBusy:!1,busyMessage:null,canCancelBusy:!1,busyRunId:null,isCancellationRequested:!1});const _=m??v;_&&e().clearRunControllers(_)},requestBusyCancel:()=>{if(!e().busyRunId||e().isCancellationRequested)return;t({isCancellationRequested:!0,canCancelBusy:!1,busyMessage:"Cancelling wrapping up safely."}),e().addProgress("Cancelling current request...");const m=e().busyRunId;m&&e().abortRunControllers(m)},isBusyRunActive:m=>e().busyRunId===m,isRunCancellationRequested:m=>e().isCancellationRequested&&e().busyRunId===m,createAbortController:m=>{if(!m)return null;const v=new AbortController;return t(_=>({abortControllers:{..._.abortControllers,[m]:[..._.abortControllers[m]??[],v]}})),v},abortRunControllers:m=>{t(v=>{const _=v.abortControllers[m];if(_==null||_.forEach(w=>{w.signal.aborted||w.abort()}),!_)return{};const x={...v.abortControllers};return delete x[m],{abortControllers:x}})},clearRunControllers:m=>{t(v=>{if(!v.abortControllers[m])return{};const _={...v.abortControllers};return delete _[m],{abortControllers:_}})},addToast:(m,v="info",_=4e3,x)=>{const w=bk();return t(A=>({toasts:[...A.toasts,{id:w,message:m,type:v,actionLabel:x==null?void 0:x.label,onAction:x==null?void 0:x.onClick}]})),_>0&&setTimeout(()=>{e().dismissToast(w)},_),w},dismissToast:m=>{t(v=>({toasts:v.toasts.filter(_=>_.id!==m)}))},queuePendingDataTransform:m=>{if(e().pendingDataTransform){e().addProgress("An AI data transformation is already awaiting approval. Please confirm or discard it first.","error");return}t({pendingDataTransform:m}),e().addProgress("AI proposed a data transformation. Review it above the dashboard before applying."),e().addToast("AI data change pending confirmation.","info",5e3)},confirmPendingDataTransform:async()=>{const m=e().pendingDataTransform;if(!m){e().addProgress("No pending data transformation to confirm.","error");return}const v=e().csvData,_=e().columnProfiles,x=e().columnAliasMap,w=au(m.nextData);t({csvData:m.nextData,columnProfiles:m.nextColumnProfiles,columnAliasMap:m.nextAliasMap,datasetHash:w,pendingDataTransform:null,isLastAppliedDataTransformBannerDismissed:!1,lastAppliedDataTransform:{id:m.id,summary:m.summary,explanation:m.explanation,meta:m.meta,previousData:v,previousColumnProfiles:_,previousAliasMap:x,appliedAt:new Date().toISOString()}}),e().addProgress("Applied the AI data transformation after confirmation."),await e().regenerateAnalyses(m.nextData);const A=k=>{if(!k||k.length===0)return"(none)";const W=k.slice(0,8).join(", ");return k.length>8?`${W}, `:W},C=(k,W)=>{if(k&&k.length>0)return k.map(Z=>Z.name);const Y=W==null?void 0:W.find(Z=>Z&&typeof Z=="object");return Y?Object.keys(Y):[]},N=m.beforeColumns??C(_,(v==null?void 0:v.data)??void 0),I=m.afterColumns??m.nextColumnProfiles.map(k=>k.name),R=N.filter(k=>!I.includes(k)),M=I.filter(k=>!N.includes(k)),z=[`Before (${N.length}): ${A(N)}`,`After (${I.length}): ${A(I)}`,R.length?`Removed: ${A(R)}`:null,M.length?`Added: ${A(M)}`:null].filter(Boolean).join(`
`),B={sender:"ai",text:`Applied transform "${m.summary}".
${z}`,timestamp:new Date,type:"ai_message"};t(k=>({chatHistory:[...k.chatHistory,B]}))},discardPendingDataTransform:()=>{if(!e().pendingDataTransform){e().addProgress("No pending data transformation to discard.","error");return}t({pendingDataTransform:null}),e().addProgress("Discarded the pending AI data transformation.")},undoLastDataTransform:async()=>{if(e().pendingDataTransform){e().addProgress("Resolve the pending AI transformation before undoing.","error");return}const m=e().lastAppliedDataTransform;if(!m||!m.previousData){e().addProgress("No AI data transformation is available to undo.","error");return}const v=au(m.previousData);t({csvData:m.previousData,columnProfiles:m.previousColumnProfiles,columnAliasMap:m.previousAliasMap,datasetHash:v,lastAppliedDataTransform:null,isLastAppliedDataTransformBannerDismissed:!1}),e().addProgress("Reverted the last AI data transformation."),await e().regenerateAnalyses(m.previousData)},dismissLastAppliedDataTransformBanner:()=>{e().lastAppliedDataTransform&&t({isLastAppliedDataTransformBannerDismissed:!0})},linkChartSelectionToRawData:(m,v,_,x)=>{const w=!!v&&_.length>0,A=e().interactiveSelectionFilter;if(!w){A&&A.sourceCardId===m&&t({interactiveSelectionFilter:null});return}const C=_.map(N=>typeof N=="number"?N:String(N));A&&A.sourceCardId===m&&A.column===v&&Dk(A.values,C)||(t({interactiveSelectionFilter:{sourceCardId:m,column:v,values:C,label:x,createdAt:new Date().toISOString()},isSpreadsheetVisible:!0}),setTimeout(()=>{var N;(N=document.getElementById("raw-data-explorer"))==null||N.scrollIntoView({behavior:"smooth",block:"center"})},150))},clearInteractiveSelectionFilter:()=>{const m=e().interactiveSelectionFilter;if(!m)return;const v={sender:"ai",text:`System note: Cleared chart drilldown "${m.label}" (${m.column}); Raw Data Explorer now shows all rows.`,timestamp:new Date,type:"ai_message"};t(x=>({interactiveSelectionFilter:null,chatHistory:[...x.chatHistory,v]})),e().addProgress("Cleared the linked chart selection filter.");const _=e().beginAgentActionTrace("dom_action","User cleared chart drilldown","system");e().updateAgentActionTrace(_,"succeeded","Chart drilldown reset via UI",{metadata:{drilldownLabel:m.label,drilldownColumn:m.column,valueCount:m.values.length}})},init:async()=>{const m=await Jr(qs);if(m)t({...Dr,...m.appState,isBusy:!1,busyMessage:null,canCancelBusy:!1,busyRunId:null,isCancellationRequested:!1,aiFilterRunId:null,abortControllers:{},toasts:[],currentView:m.appState.csvData?"analysis_dashboard":"file_upload",pendingClarifications:m.appState.pendingClarifications??[],activeClarificationId:m.appState.activeClarificationId??null,agentActionTraces:m.appState.agentActionTraces??[],agentValidationEvents:m.appState.agentValidationEvents??[],chatMemoryPreview:[],chatMemoryExclusions:[],chatMemoryPreviewQuery:"",isMemoryPreviewLoading:!1,columnAliasMap:m.appState.columnAliasMap??WS(m.appState.columnProfiles??[]),pendingDataTransform:null,lastAppliedDataTransform:null,interactiveSelectionFilter:null,plannerSession:tp(m.appState.plannerSession),plannerDatasetHash:m.appState.plannerDatasetHash??m.appState.datasetHash??null,datasetProfile:m.appState.datasetProfile??null,analysisTimeline:m.appState.analysisTimeline??{...Dr.analysisTimeline}}),await QS(m.appState.vectorStoreDocuments,m.appState.datasetHash,e().datasetHash,e().addProgress,e().addToast,e().dismissToast,"Restored AI long-term memory from last session."),jS(m.createdAt);else{const v=gk();v&&await f(v)}await e().loadReportsList()},addProgress:(m,v="system")=>{const _={text:m,type:v,timestamp:new Date};t(x=>({progressMessages:[...x.progressMessages,_]}))},loadReportsList:async()=>{const m=await MP();t({reportsList:m})},handleSaveSettings:m=>{PP(m);const v=m.provider==="google"?!!m.geminiApiKey:!!m.openAIApiKey;t({settings:m,isApiKeySet:v}),tx(m)},handleAsideMouseDown:m=>{m.preventDefault(),e().setIsResizing(!0);const v=x=>{const w=window.innerWidth-Mk;let A=window.innerWidth-x.clientX;A=Math.max(gf,A),A=Math.min(Rk,A,w),e().setAsideWidth(A)},_=()=>{e().setIsResizing(!1),document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",_)};document.addEventListener("mousemove",v),document.addEventListener("mouseup",_)},runAnalysisPipeline:async(m,v,_={})=>{const{isChatRequest:x=!1,runId:w}=_,A=e().addProgress,C=e().settings,N=()=>w?e().isRunCancellationRequested(w):!1,I=()=>r(w);let R=!0;const M=e().beginAgentActionTrace,z=e().updateAgentActionTrace,B=e().datasetHash,k=()=>{x||t(L=>{const ne=L.analysisTimeline.totalCards||0,fe=Math.min(ne,L.analysisTimeline.completedCards+1),ae=L.analysisTimeline.stage==="persisting"||L.analysisTimeline.stage==="profiling";return{analysisTimeline:{...L.analysisTimeline,completedCards:fe,stage:ae?"insight":L.analysisTimeline.stage}}})},W=L=>{if(!B||L.chartType==="scatter"||L.chartType==="combo"||!L.groupByColumn||!L.aggregation||L.aggregation!=="count"&&!L.valueColumn)return null;const ne=L.valueColumn??"count",fe=L.chartType==="line"?[{column:L.groupByColumn,direction:"asc"}]:[{column:ne,direction:"desc"}];return{datasetId:B,by:[L.groupByColumn],metrics:[{fn:L.aggregation,column:L.aggregation==="count"?void 0:L.valueColumn,as:ne}],filter:L.rowFilter?[{column:L.rowFilter.column,op:"in",values:L.rowFilter.values}]:void 0,limit:L.defaultTopN??void 0,mode:"sample",sampleSize:Math.min(5e3,v.data.length),orderBy:fe}},Y=async L=>{var ae;const ne=W(L);if(!ne)return null;const fe=await zr.aggregate(ne);return fe.ok?fe.data.rows.length===0?(A(`Skipping "${L.title}" due to empty aggregation result.`,"error"),null):fe.data:(A(`Aggregation worker failed for "${L.title}": ${fe.reason}`,"error"),(ae=fe.reason)!=null&&ae.includes("IndexedDB")&&A("Your browser blocked IndexedDB inside workers; falling back to main thread.","error"),null)};!x&&m.length>0&&t(L=>({analysisTimeline:{...L.analysisTimeline,totalCards:m.length,completedCards:0}}));const Z=async L=>{const ne=M("proceed_to_analysis",`Run analysis "${L.title}"`,"pipeline"),fe=(ae,O)=>z(ne,ae,O);if(N())return null;try{A(`Executing plan: ${L.title}...`),w&&e().updateBusyStatus(`Executing "${L.title}"...`);const ae=HP(L,e().columnProfiles,v.data);if(!ae.isValid)return A(`Skipping "${L.title}" because ${ae.errorMessage??"the plan is invalid."}`,"error"),fe("failed",ae.errorMessage??"Plan invalid."),null;ae.warnings.forEach(Te=>A(`${L.title}: ${Te}`));const O=ae.plan;let K=null,ee=[];try{B&&(K=await Y(O)),K?ee=K.rows:ee=y_(v,O)}catch(Te){if(Te instanceof u_&&Te.code==="no_rows"){const tt=O.rowFilter?`${O.rowFilter.column}  ${O.rowFilter.values.join(", ")}`:"the requested filter";return A(`Skipping "${L.title}" because ${tt} returned no rows.`,"error"),fe("failed",Te.message),k(),null}throw Te}if(ee.length===0)return A(`Skipping "${L.title}" due to empty result.`,"error"),fe("failed","Aggregation returned 0 rows."),k(),null;if(N())return null;A(`AI is summarizing: ${L.title}...`),w&&e().updateBusyStatus(`Summarizing "${L.title}"...`);const ve=await uP(O.title,ee,C,{signal:I()});if(N())return null;let be=null,P=(K==null?void 0:K.provenance.queryHash)??null;const X=(K==null?void 0:K.provenance.sampled)??!1;if(K&&B){const Te=await zr.createCardFromResult({datasetId:B,title:O.title,kind:Pk(O),explainer:ve,result:K,plan:O});Te.ok?be=Te.data.cardId:A(`View cache save failed for "${O.title}": ${Te.reason}`,"error")}const se=ee.length,re=O.chartType!=="scatter"&&se>15,ge={id:`card-${Date.now()}-${Math.random()}`,plan:O,aggregatedData:ee,summary:ve,displayChartType:O.chartType,isDataVisible:!1,topN:re?8:O.defaultTopN||null,hideOthers:re?!0:O.defaultHideOthers||!1,disableAnimation:x||!R||e().analysisCards.length>0,hiddenLabels:[],dataRefId:be,queryHash:P,isSampledResult:X};t(Te=>({analysisCards:[...Te.analysisCards,ge]})),k();const xe=`[Chart: ${O.title}] Description: ${O.description}. AI Summary: ${ve.split("---")[0]}`;return await at.addDocument({id:ge.id,text:xe}),A(`View #${ge.id.slice(-6)} indexed for long-term memory.`),R=!1,A(`Saved as View #${ge.id.slice(-6)}`),fe("succeeded",`Created card with ${ee.length} rows.`),ge}catch(ae){if(N())return A(`Cancelled "${L.title}" before completion.`),z(ne,"failed","Cancelled before completion."),k(),null;console.error("Error executing plan:",L.title,ae);const O=ae instanceof Error?ae.message:String(ae);return A(`Error executing plan "${L.title}": ${O}`,"error"),fe("failed",O),k(),null}},te=(await Promise.all(m.map(Z))).filter(L=>L!==null);if(!x&&te.length>0&&!N()){A("AI is forming its core understanding of the data..."),w&&e().updateBusyStatus("Forming core understanding...");const L=te.map(K=>({id:K.id,title:K.plan.title,aggregatedDataSample:K.aggregatedData.slice(0,10)})),ne=await cP(L,e().columnProfiles,C,{signal:I()});if(N())return te;const fe={sender:"ai",text:ne,timestamp:new Date,type:"ai_thinking"};if(t(K=>({aiCoreAnalysisSummary:ne,chatHistory:[...K.chatHistory,fe]})),A("Indexing core analysis for long-term memory..."),await at.addDocument({id:"core-summary",text:`Core Analysis Summary: ${ne}`}),A("Core analysis indexed."),N())return te;A("AI is looking for key insights..."),w&&e().updateBusyStatus("Looking for key insights...");const ae=await dP(L,C,{signal:I()});if(N())return te;if(ae){const K={sender:"ai",text:ae.insight,timestamp:new Date,type:"ai_proactive_insight",cardId:ae.cardId};t(ee=>({chatHistory:[...ee.chatHistory,K]})),A(`AI proactively identified an insight in View #${ae.cardId.slice(-6)}.`)}if(N())return te;const O=await yS(te,C,{signal:I()});if(N())return te;t({finalSummary:O}),A("Overall summary generated.")}return te},handleInitialAnalysis:async(m,v={})=>{if(!m)return;const{runId:_}=v;await jf({beginBusy:e().beginBusy,endBusy:e().endBusy},"Running analysis...",async x=>{e().addProgress("Starting main analysis...");try{e().addProgress("AI is generating analysis plans..."),e().updateBusyStatus("Drafting analysis plans...");const w=await iP(e().columnProfiles,m.data.slice(0,5),e().settings,{signal:r(x)});w.warnings.forEach(C=>{const N=`Plan generator warning: ${C.message}`;e().addProgress(N,"error"),e().addToast(C.message,"error",6e3)});const A=w.plans;if(x&&e().isRunCancellationRequested(x)){e().addProgress("Analysis cancelled before execution.");return}e().addProgress(`AI proposed ${A.length} plans.`),A.length>0?await e().runAnalysisPipeline(A,m,{runId:x}):(e().addProgress("AI did not propose any analysis plans.","error"),t(C=>({analysisTimeline:{...C.analysisTimeline,stage:"idle",totalCards:0,completedCards:0}})))}catch(w){if(w instanceof Sb)w.warnings.forEach(A=>{e().addProgress(`Plan generator warning: ${A.message}`,"error"),e().addToast(A.message,"error",7e3)}),e().addProgress("Plan generation failed. Please retry analysis or adjust your prompt.","error"),e().addToast("Plan generation failed. Retry?","error",0,{label:"Retry analysis",onClick:()=>{const A=e().csvData;A&&e().handleInitialAnalysis(A)}}),t(A=>({analysisTimeline:{...A.analysisTimeline,stage:"idle"}}));else if(!(x&&e().isRunCancellationRequested(x))){console.error("Analysis pipeline error:",w);const A=w instanceof Error?w.message:String(w);e().addProgress(`Error during analysis: ${A}`,"error"),e().addToast("Analysis failed. Retry?","error",0,{label:"Retry",onClick:()=>{const C=e().csvData;C&&e().handleInitialAnalysis(C)}})}}finally{x&&e().isRunCancellationRequested(x)?e().addProgress("Stopped current analysis."):e().addProgress("Analysis complete. Ready for chat.")}},{runId:_,cancellable:!0})},regenerateAnalyses:async m=>{e().addProgress("Data has changed. Regenerating all analysis cards...");const v=e().analysisCards.map(_=>_.plan);t({analysisCards:[],finalSummary:null}),await jf({beginBusy:e().beginBusy,endBusy:e().endBusy},"Regenerating insight cards...",async _=>{try{if(v.length>0){const x=await e().runAnalysisPipeline(v,m,{isChatRequest:!0,runId:_});if(x.length>0&&!(_&&e().isRunCancellationRequested(_))){const w=await yS(x,e().settings,{signal:r(_)});_&&e().isRunCancellationRequested(_)||(t({finalSummary:w}),e().addProgress("All analysis cards have been updated."))}}else e().addProgress("No existing plans found to regenerate.","error")}catch(x){if(!(_&&e().isRunCancellationRequested(_))){console.error("Error regenerating analyses:",x);const w=x instanceof Error?x.message:String(x);e().addProgress(`Error updating analyses: ${w}`,"error")}}},{cancellable:!0})},executeDomAction:m=>{e().addProgress(`AI is performing action: ${m.toolName}...`);const v=(w,A)=>{t(C=>{const N=C.analysisCards.findIndex(M=>M.id===w);if(N===-1)return{};const I=A(C.analysisCards[N]);if(!I)return{};const R=[...C.analysisCards];return R[N]=I,{analysisCards:R}})},_=w=>e().analysisCards.find(A=>A.id===w),x=w=>{const A=w.plan.groupByColumn||"",C=w.plan.valueColumn||"count";let N=w.aggregatedData;const I=w.filter;if(I!=null&&I.column&&I.values&&I.values.length>0&&(N=N.filter(R=>I.values.includes(R[I.column]))),w.plan.chartType!=="scatter"&&A&&w.topN&&(N=p_(N,A,C,w.topN)),w.topN&&w.hideOthers&&A&&(N=N.filter(R=>R[A]!=="Others")),A&&w.hiddenLabels&&w.hiddenLabels.length>0){const R=new Set(w.hiddenLabels.map(String));N=N.filter(M=>!R.has(String(M[A])))}return N};switch(m.toolName){case"highlightCard":{const w=m.args.cardId,A=document.getElementById(w);A&&(A.scrollIntoView({behavior:"smooth",block:"center"}),A.classList.add("ring-4","ring-blue-500","transition-all","duration-500"),setTimeout(()=>A.classList.remove("ring-4","ring-blue-500"),2500));break}case"changeCardChartType":{const{cardId:w,newType:A}=m.args;v(w,C=>({...C,displayChartType:A}));break}case"showCardData":{const{cardId:w,visible:A}=m.args,C=typeof A=="boolean"?A:!0;v(w,N=>({...N,isDataVisible:C}));break}case"filterCard":{const{cardId:w,column:A,values:C}=m.args;if(!A)break;const N=Array.isArray(C)?C:[];v(w,I=>({...I,filter:N.length>0?{column:A,values:N}:void 0}));break}case"setTopN":{const{cardId:w,topN:A}=m.args,C=A==null||A==="all"?null:Number(A);if(C!==null&&(!Number.isFinite(C)||C<=0))break;v(w,N=>({...N,topN:C}));break}case"toggleHideOthers":{const{cardId:w,hide:A}=m.args;v(w,C=>({...C,hideOthers:typeof A=="boolean"?A:!C.hideOthers}));break}case"toggleLegendLabel":{const{cardId:w,label:A}=m.args;if(!A)break;v(w,C=>{const N=C.hiddenLabels||[],R=N.includes(A)?N.filter(M=>M!==A):[...N,A];return{...C,hiddenLabels:R}});break}case"exportCard":{const{cardId:w,format:A="png"}=m.args,C=_(w),N=document.getElementById(w);if(!C||!N){console.warn("exportCard: card or DOM node not found",w);break}const I=x(C),R=typeof A=="string"?A.toLowerCase():"png";(async()=>{try{switch(R){case"csv":o_(I,C.plan.title);break;case"html":await l_(N,C.plan.title,I,C.summary);break;default:await r_(N,C.plan.title);break}e().addProgress(`Exported "${C.plan.title}" as ${R.toUpperCase()}.`)}catch(M){console.error("Failed to export card",M),e().addProgress("Export failed. Please try again.","error")}})();break}case"removeCard":{const{cardId:w}=m.args;if(!w||typeof w!="string")break;let A=null,C=!1;t(N=>{var M,z;const I=N.analysisCards.find(B=>B.id===w);if(!I)return{};C=!0,A=((M=I.plan)==null?void 0:M.title)??w;const R={analysisCards:N.analysisCards.filter(B=>B.id!==w)};return((z=N.interactiveSelectionFilter)==null?void 0:z.sourceCardId)===w&&(R.interactiveSelectionFilter=null),R}),C?e().addProgress(`Removed card "${A??w}" as requested.`):e().addProgress("Unable to remove the requested card because it was not found.","error");break}}},handleExternalCsvPayload:async m=>{var w;if(!m||typeof m.csv!="string"||!m.csv.trim()){e().addToast("Received empty CSV payload from source page.","error");return}const v=((w=m.fileName)==null?void 0:w.trim())||Ik(m.header),_=new Blob([m.csv],{type:"text/csv"});let x;try{x=new File([_],v,{type:"text/csv"})}catch{x=Object.assign(_,{name:v,lastModified:Date.now()})}try{await e().handleFileUpload(x)}catch(A){console.error("Failed to import CSV payload from opener.",A),e().addToast("Failed to import CSV from report page.","error")}},handleChartTypeChange:(m,v)=>{t(_=>({analysisCards:_.analysisCards.map(x=>x.id===m?{...x,displayChartType:v}:x)}))},handleToggleDataVisibility:m=>{t(v=>({analysisCards:v.analysisCards.map(_=>_.id===m?{..._,isDataVisible:!_.isDataVisible}:_)}))},handleTopNChange:(m,v)=>{t(_=>({analysisCards:_.analysisCards.map(x=>x.id===m?{...x,topN:v}:x)}))},handleHideOthersChange:(m,v)=>{t(_=>({analysisCards:_.analysisCards.map(x=>x.id===m?{...x,hideOthers:v}:x)}))},handleToggleLegendLabel:(m,v)=>{t(_=>({analysisCards:_.analysisCards.map(x=>{if(x.id===m){const w=x.hiddenLabels||[],A=w.includes(v)?w.filter(C=>C!==v):[...w,v];return{...x,hiddenLabels:A}}return x})}))},clearCardFilter:m=>{t(v=>({analysisCards:v.analysisCards.map(_=>_.id===m?{..._,filter:void 0}:_)}))},triggerAutoSaveNow:()=>{wk()},handleLoadReport:async m=>{e().addProgress(`Loading report ${m}...`);const v=await Jr(m);v?(at.clear(),t({...v.appState,agentAwaitingUserInput:v.appState.agentAwaitingUserInput??!1,agentAwaitingPromptId:v.appState.agentAwaitingPromptId??null,currentView:"analysis_dashboard",isHistoryPanelOpen:!1,chatMemoryPreview:[],chatMemoryExclusions:[],chatMemoryPreviewQuery:"",isMemoryPreviewLoading:!1,agentActionTraces:v.appState.agentActionTraces??[],agentValidationEvents:v.appState.agentValidationEvents??[],columnAliasMap:v.appState.columnAliasMap??WS(v.appState.columnProfiles??[]),plannerSession:tp(v.appState.plannerSession),plannerDatasetHash:v.appState.plannerDatasetHash??v.appState.datasetHash??null}),await QS(v.appState.vectorStoreDocuments,v.appState.datasetHash,e().datasetHash,e().addProgress,e().addToast,e().dismissToast,"Restored AI long-term memory from loaded report."),e().addProgress(`Report "${v.filename}" loaded.`),jS(v.createdAt)):e().addProgress(`Failed to load report ${m}.`,"error")},handleDeleteReport:async m=>{await Kf(m),await e().loadReportsList()},handleShowCardFromChat:m=>{const v=document.getElementById(m);v&&(v.scrollIntoView({behavior:"smooth",block:"center"}),v.classList.add("ring-4","ring-blue-500","transition-all","duration-500"),setTimeout(()=>v.classList.remove("ring-4","ring-blue-500"),2500))},setAgentPhase:(m,v)=>t({agentPhase:{phase:m,message:v??null,enteredAt:new Date().toISOString()}}),setIsAsideVisible:m=>t({isAsideVisible:m}),setAsideWidth:m=>t({asideWidth:m}),setIsSpreadsheetVisible:m=>t({isSpreadsheetVisible:m}),setIsDataPrepDebugVisible:m=>t({isDataPrepDebugVisible:m}),setIsSettingsModalOpen:m=>t({isSettingsModalOpen:m}),setIsHistoryPanelOpen:m=>t({isHistoryPanelOpen:m}),setIsMemoryPanelOpen:m=>t({isMemoryPanelOpen:m}),setIsResizing:m=>t({isResizing:m}),recordAgentValidationEvent:({actionType:m,reason:v,actionIndex:_,runId:x,retryInstruction:w,timestamp:A})=>{const C={id:xk(),actionType:m,reason:v,actionIndex:_,runId:x??null,retryInstruction:w,timestamp:A??new Date().toISOString()};t(N=>({agentValidationEvents:[...N.agentValidationEvents,C].slice(-25)})),typeof window<"u"&&typeof window.dispatchEvent=="function"&&window.dispatchEvent(new CustomEvent("agent-validation-event",{detail:C}))},dismissAgentValidationEvent:m=>{t(v=>({agentValidationEvents:v.agentValidationEvents.filter(_=>_.id!==m)}))},clearAgentValidationEvents:()=>t({agentValidationEvents:[]}),recordPromptMetric:m=>{t(v=>({agentPromptMetrics:[...v.agentPromptMetrics,m].slice(-20)}))},clearPromptMetrics:()=>t({agentPromptMetrics:[]}),beginAgentActionTrace:(m,v,_="chat")=>{const x=`trace-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,w={id:x,actionType:m,status:"observing",summary:v,timestamp:new Date,source:_};return t(A=>({agentActionTraces:[...A.agentActionTraces,w].slice(-40)})),x},updateAgentActionTrace:(m,v,_,x)=>{t(w=>({agentActionTraces:w.agentActionTraces.map(A=>{if(A.id!==m)return A;const C=x!=null&&x.metadata?{...A.metadata??{},...x.metadata}:A.metadata;return{...A,status:v,details:_,timestamp:new Date,durationMs:(x==null?void 0:x.durationMs)??A.durationMs,errorCode:(x==null?void 0:x.errorCode)??A.errorCode,metadata:C}})}))},annotateAgentActionTrace:(m,v)=>{!v||Object.keys(v).length===0||t(_=>({agentActionTraces:_.agentActionTraces.map(x=>x.id===m?{...x,metadata:{...x.metadata??{},...v}}:x)}))},appendPlannerObservation:m=>{t(v=>{const _=[...v.plannerSession.observations,m].slice(-12);return{plannerSession:{...v.plannerSession,observations:_}}})},resetPlannerObservations:()=>{t(m=>({plannerSession:{...m.plannerSession,observations:[]}}))},updatePlannerPlanState:m=>{const v=XS(m.nextSteps);t(_=>({plannerSession:{..._.plannerSession,planState:{...m,nextSteps:v}},plannerPendingSteps:v,plannerDatasetHash:_.datasetHash??null}))},clearPlannerPlanState:()=>{t(m=>({plannerSession:{...m.plannerSession,planState:null},plannerPendingSteps:[],plannerDatasetHash:null}))},setPlannerPendingSteps:m=>{t({plannerPendingSteps:XS(m)})},completePlannerPendingStep:()=>{t(m=>m.plannerPendingSteps.length===0?{}:{plannerPendingSteps:m.plannerPendingSteps.slice(1)})},focusDataPreview:()=>{t({isSpreadsheetVisible:!0}),setTimeout(()=>{var m;(m=document.getElementById("raw-data-explorer"))==null||m.scrollIntoView({behavior:"smooth",block:"center"})},100)}}});tx(Ue.getState().settings);$t=new Sk({getStore:()=>Ue.getState(),buildSnapshot:Nk,addToast:(t,e,n,a)=>Ue.getState().addToast(t,e,n,a),dismissToast:t=>Ue.getState().dismissToast(t)});iu&&$t.configure(iu);const kk=()=>T.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:T.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),Uk=()=>T.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:[T.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 000 2h6a1 1 0 100-2H7z",clipRule:"evenodd"}),T.jsx("path",{d:"M12.293 5.293a1 1 0 011.414 0l2 2a1 1 0 01-1.414 1.414L13 7.414V10a1 1 0 11-2 0V7.414l-1.293 1.293a1 1 0 01-1.414-1.414l2-2zM7.707 14.707a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L7 12.586V10a1 1 0 112 0v2.586l1.293-1.293a1 1 0 011.414 1.414l-2 2z"})]}),Ok=()=>T.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:T.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})}),qk=({filter:t})=>{const n=t.values.slice(0,3).map(c=>String(c)).join(", "),a=t.values.length-3,r=a>0?`${n} +${a}`:n,l=`Rows limited to ${t.column}  ${t.values.map(c=>String(c)).join(", ")}`;return T.jsxs("span",{className:"ml-2 inline-flex items-center rounded-full bg-slate-100 px-2 py-0.5 text-xs font-medium text-slate-700 border border-slate-200",title:l,children:["Filtered  ",t.column,": ",r]})},Bk=({cardId:t})=>{var Ke,wn;const e=Ue(he=>he.analysisCards.find(qe=>qe.id===t)),{handleChartTypeChange:n,handleToggleDataVisibility:a,handleTopNChange:r,handleHideOthersChange:l,handleToggleLegendLabel:c,linkChartSelectionToRawData:f,clearCardFilter:y}=Ue(he=>({handleChartTypeChange:he.handleChartTypeChange,handleToggleDataVisibility:he.handleToggleDataVisibility,handleTopNChange:he.handleTopNChange,handleHideOthersChange:he.handleHideOthersChange,handleToggleLegendLabel:he.handleToggleLegendLabel,linkChartSelectionToRawData:he.linkChartSelectionToRawData,clearCardFilter:he.clearCardFilter})),p=ue.useRef(null),m=ue.useRef(null),[v,_]=ue.useState(!1),[x,w]=ue.useState([]),[A,C]=ue.useState(!1),[N,I]=ue.useState(!0);if(!e)return null;const{id:R,plan:M,aggregatedData:z,summary:B,displayChartType:k,isDataVisible:W,topN:Y,hideOthers:Z,disableAnimation:te,filter:L,hiddenLabels:ne=[]}=e,fe=B.split("---"),ae=(Ke=fe[0])==null?void 0:Ke.trim(),O=(wn=fe[1])==null?void 0:wn.trim(),K=M.valueColumn||"count",ee=M.groupByColumn||"",ve=ue.useMemo(()=>{let he=z;return L&&L.column&&L.values.length>0&&(he=he.filter(qe=>L.values.includes(qe[L.column]))),he},[z,L]),be=ue.useMemo(()=>M.chartType!=="scatter"&&ee&&Y?p_(ve,ee,K,Y):ve,[ve,M.chartType,ee,Y,K]),P=ue.useMemo(()=>{let he=be;return Y&&Z&&(he=he.filter(qe=>qe[ee]!=="Others")),ee&&(he=he.filter(qe=>!ne.includes(String(qe[ee])))),he},[be,Y,Z,ee,ne]),X=ue.useMemo(()=>ve.reduce((he,qe)=>he+(Number(qe[K])||0),0),[ve,K]),se=async he=>{if(p.current){_(!0);try{switch(he){case"png":await r_(p.current,M.title);break;case"csv":o_(P,M.title);break;case"html":await l_(p.current,M.title,P,B);break}}finally{_(!1)}}},re=(he,qe)=>{const Cn=qe.ctrlKey||qe.metaKey;w(Ut=>Cn?(Ut.includes(he)?Ut.filter(Un=>Un!==he):[...Ut,he]).sort((Un,Aa)=>Un-Aa):Ut.includes(he)?[]:[he])},ge=()=>{var he;return(he=m.current)==null?void 0:he.resetZoom()},xe=()=>w([]),Te=he=>{const qe=he.target.value==="all"?null:parseInt(he.target.value,10);r(R,qe)},tt=x.map(he=>P[he]);return ue.useEffect(()=>{if(!ee||x.length===0){f(R,null,[],M.title);return}const he=x.map(qe=>{var Cn;return(Cn=P[qe])==null?void 0:Cn[ee]}).filter(qe=>qe!=null);if(he.length===0){f(R,null,[],M.title);return}return f(R,ee,he,M.title),()=>{f(R,null,[],M.title)}},[ee,x,P,R,f,M.title]),T.jsxs("div",{ref:p,id:R,className:"bg-white rounded-lg shadow-lg p-4 flex flex-col transition-all duration-300 hover:shadow-blue-500/20 border border-slate-200 w-full",children:[T.jsxs("div",{className:"flex justify-between items-start gap-4 mb-2",children:[T.jsx("div",{className:"flex flex-col flex-1 min-w-0",children:T.jsxs("div",{className:"flex items-center flex-wrap",children:[T.jsx("h3",{className:"text-lg font-bold text-slate-900",children:M.title}),M.rowFilter&&T.jsx(qk,{filter:M.rowFilter})]})}),T.jsxs("div",{className:"flex items-center bg-slate-100 rounded-md p-0.5 space-x-0.5 flex-shrink-0",children:[T.jsx(zw,{currentType:k,onChange:he=>n(R,he)}),T.jsxs("div",{className:"relative group",children:[T.jsx("button",{disabled:v,className:"p-1.5 text-slate-500 hover:text-slate-900 rounded-md transition-colors hover:bg-slate-200",children:T.jsx(kk,{})}),T.jsxs("div",{className:"absolute right-0 mt-2 w-36 bg-white border border-slate-200 rounded-md shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none group-hover:pointer-events-auto",children:[T.jsx("a",{onClick:()=>se("png"),className:"block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 cursor-pointer rounded-t-md",children:"Export as PNG"}),T.jsx("a",{onClick:()=>se("csv"),className:"block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 cursor-pointer",children:"Export as CSV"}),T.jsx("a",{onClick:()=>se("html"),className:"block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 cursor-pointer rounded-b-md",children:"Export as HTML"})]})]})]})]}),T.jsx("p",{className:"text-sm text-slate-500 mb-4",children:M.description}),T.jsxs("div",{className:"grid gap-4 flex-grow grid-cols-1",children:[T.jsxs("div",{className:"relative h-64",children:[T.jsx(Vw,{ref:m,chartType:k,data:P,plan:M,selectedIndices:x,onElementClick:re,onZoomChange:C,disableAnimation:te}),T.jsxs("div",{className:"absolute top-1 right-1 flex items-center space-x-1",children:[x.length>0&&T.jsx("button",{onClick:xe,title:"Clear selection",className:"p-1 bg-white/50 text-slate-600 rounded-full hover:bg-slate-100 hover:text-slate-800 transition-all backdrop-blur-sm",children:T.jsx(Ok,{})}),A&&T.jsx("button",{onClick:ge,title:"Reset zoom",className:"p-1 bg-white/50 text-slate-600 rounded-full hover:bg-slate-100 hover:text-slate-800 transition-all backdrop-blur-sm",children:T.jsx(Uk,{})})]})]}),ee&&T.jsx("div",{className:"flex flex-col",children:T.jsx(Qw,{data:be,total:X,groupByKey:ee,valueKey:K,hiddenLabels:ne,onLabelClick:he=>c(R,he)})})]}),L&&T.jsx("div",{className:"text-xs text-yellow-800 bg-yellow-100 p-3 rounded-md my-3 border border-yellow-200",children:T.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[T.jsxs("span",{children:[T.jsx("b",{children:"AI Filter Active:"})," Showing where '",L.column,"' is '",L.values.join(", "),`'. Ask AI to "clear filter" or use the button to remove.`]}),T.jsx("button",{type:"button",onClick:()=>y(R),className:"px-3 py-1 text-xs font-semibold text-yellow-900 bg-white/70 border border-yellow-300 rounded-md hover:bg-white hover:border-yellow-400 transition",children:"Clear filter"})]})}),T.jsx("div",{className:"mt-4 border-t border-slate-200 pt-4",children:T.jsxs("div",{className:"bg-slate-50 p-3 rounded-md text-sm border border-slate-200",children:[T.jsxs("div",{className:"flex justify-between items-baseline mb-2",children:[T.jsx("p",{className:"font-semibold text-blue-600",children:"AI Summary"}),M.aggregation==="sum"&&T.jsxs("p",{className:"text-xs text-slate-500",children:["Total: ",T.jsx("span",{className:"font-bold text-base text-slate-800",children:X.toLocaleString(void 0,{maximumFractionDigits:0})})]})]}),T.jsx("p",{className:"text-slate-700 text-xs",children:ae}),O&&T.jsx("p",{className:"text-slate-500 mt-2 text-xs",children:O})]})}),T.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[T.jsx("div",{children:T.jsxs("button",{onClick:()=>a(R),className:"text-sm text-blue-600 hover:underline",children:[W?"Hide":"Show"," Full Data Table"]})}),M.chartType!=="scatter"&&z.length>5&&T.jsxs("div",{className:"flex items-center space-x-2",children:[T.jsx("label",{htmlFor:`top-n-${R}`,className:"text-xs text-slate-500",children:"Show"}),T.jsxs("select",{id:`top-n-${R}`,value:Y||"all",onChange:Te,className:"bg-white border border-slate-300 text-slate-800 text-xs rounded-md py-1 px-2 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[T.jsx("option",{value:"all",children:"All"}),T.jsx("option",{value:"5",children:"Top 5"}),T.jsx("option",{value:"8",children:"Top 8"}),T.jsx("option",{value:"10",children:"Top 10"}),T.jsx("option",{value:"15",children:"Top 15"}),T.jsx("option",{value:"20",children:"Top 20"})]}),Y&&T.jsx("div",{className:"flex items-center",children:T.jsxs("label",{htmlFor:`hide-others-${R}`,className:"flex items-center space-x-1.5 text-xs text-slate-500",children:[T.jsx("input",{type:"checkbox",id:`hide-others-${R}`,checked:Z,onChange:he=>l(R,he.target.checked),className:"bg-slate-100 border-slate-300 rounded focus:ring-blue-500 text-blue-600 h-3.5 w-3.5"}),T.jsx("span",{children:'Hide "Others"'})]})})]})]}),x.length>0&&T.jsxs("div",{className:"mt-4 bg-slate-50 p-3 rounded-md text-sm border border-slate-200",children:[T.jsxs("button",{onClick:()=>I(!N),className:"w-full text-left font-semibold text-blue-600 mb-1",children:[N?"":""," Selection Details (",x.length," items)"]}),N&&T.jsx(Yl,{data:tt})]}),W&&T.jsx("div",{className:"mt-2 max-h-48 overflow-y-auto border border-slate-200 rounded-md",children:T.jsx(Yl,{data:P})})]})},Hk=()=>T.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 inline-block mr-2 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:T.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),Vk=({summary:t})=>T.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg shadow-lg p-6 mb-6",children:[T.jsxs("h2",{className:"text-xl font-bold text-slate-900 mb-3 flex items-center",children:[T.jsx(Hk,{}),"Overall Insights"]}),T.jsx("p",{className:"text-slate-700 whitespace-pre-wrap leading-relaxed",children:t})]}),np=[1,2,3],Fk=({isManual:t,statusLabel:e,selectedCount:n,onToggleMode:a,onSelectManualCount:r})=>T.jsx("div",{className:"flex justify-end",children:T.jsxs("div",{className:"flex flex-wrap items-center gap-4 rounded-2xl border border-slate-200 bg-white/80 px-4 py-3 shadow-sm",children:[T.jsxs("div",{className:"text-right",children:[T.jsx("p",{className:"text-sm font-semibold text-slate-600",children:"Cards per row"}),T.jsx("p",{className:"text-xs text-slate-400",children:e})]}),T.jsx("button",{type:"button",onClick:a,className:`rounded-full border px-3 py-1.5 text-xs font-semibold transition ${t?"border-amber-300 bg-amber-50 text-amber-700":"border-slate-200 bg-white text-slate-500 hover:bg-slate-50"}`,children:t?"Switch to Auto":"Manual override"}),T.jsx("div",{className:"inline-flex overflow-hidden rounded-xl border border-slate-200 bg-white shadow-inner",children:np.map(l=>{const c=n===l;return T.jsx("button",{type:"button",onClick:()=>t&&r(l),disabled:!t,className:`px-4 py-1.5 text-sm font-semibold transition-colors ${c?"bg-slate-100 text-slate-900":"text-slate-500 hover:bg-slate-50"} ${t?"":"cursor-not-allowed opacity-60"}`,"aria-pressed":c,title:t?void 0:"Auto layout is active. Enable manual override to pick.",children:l},l)})})]})}),Gk=np[np.length-1],zk=[{minWidth:1280,columns:3},{minWidth:720,columns:2},{minWidth:0,columns:1}],$k=t=>{if(!t)return 1;for(const e of zk)if(t>=e.minWidth)return Math.min(Gk,e.columns);return 1},Yk=()=>{const t=Ue(_=>_.analysisCards),e=Ue(_=>_.finalSummary),n=ue.useRef(null),a=ue.useRef(null),[r,l]=ue.useState(1),[c,f]=ue.useState(2),[y,p]=ue.useState(!1),m=y?c:r;ue.useLayoutEffect(()=>{if(y)return;const _=n.current;if(!_)return;const x=A=>{a.current!==null&&cancelAnimationFrame(a.current),a.current=requestAnimationFrame(()=>{a.current=null,l(C=>{const N=$k(A);return C===N?C:N})})};if(x(_.getBoundingClientRect().width),typeof ResizeObserver<"u"){const A=new ResizeObserver(C=>{var N;for(const I of C)if(I.target===_){const R=((N=I.contentRect)==null?void 0:N.width)??_.getBoundingClientRect().width;x(R)}});return A.observe(_),()=>{A.disconnect(),a.current!==null&&cancelAnimationFrame(a.current)}}const w=()=>{x(_.getBoundingClientRect().width)};return window.addEventListener("resize",w),()=>{window.removeEventListener("resize",w),a.current!==null&&cancelAnimationFrame(a.current)}},[y,t.length]);const v=()=>{p(_=>(_||f(m),!_))};return t.length===0?T.jsx("div",{className:"flex items-center justify-center h-full",children:T.jsxs("div",{className:"text-center p-4",children:[T.jsx("p",{className:"text-slate-500",children:"Your analysis results will appear here."}),T.jsx("p",{className:"text-slate-400 text-sm mt-2",children:"The AI is generating the initial analysis..."})]})}):T.jsxs("div",{className:"p-1",ref:n,children:[T.jsxs("div",{className:"mb-6 space-y-4",children:[e&&T.jsx("div",{children:T.jsx(Vk,{summary:e})}),T.jsx(Fk,{isManual:y,statusLabel:y?"Manual control enabled":"Auto based on panel width",selectedCount:m,onToggleMode:v,onSelectManualCount:_=>f(_)})]}),T.jsx("div",{className:"mt-6",children:T.jsx(i_,{breakpointCols:m,className:"flex w-auto -ml-6",columnClassName:"pl-6 space-y-6",children:t.map(_=>T.jsx("div",{className:"analysis-card",children:T.jsx(Bk,{cardId:_.id})},_.id))})})]})};function nx(t,e){if(Object.is(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;if(t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(const[a,r]of t)if(!Object.is(r,e.get(a)))return!1;return!0}if(t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(const a of t)if(!e.has(a))return!1;return!0}const n=Object.keys(t);if(n.length!==Object.keys(e).length)return!1;for(const a of n)if(!Object.prototype.hasOwnProperty.call(e,a)||!Object.is(t[a],e[a]))return!1;return!0}const Jk=240,Kk=(t,e,n)=>{const{maxHeight:a=Jk,minHeight:r=0}=n??{};ue.useLayoutEffect(()=>{const l=t.current;if(!l)return;l.style.height="auto";const c=l.scrollHeight,f=Math.min(Math.max(c,r),a);l.style.height=`${f}px`,l.style.overflowY=c>a?"auto":"hidden"},[t,e,a,r])},jk="",Xk="",Qk="",Wk="",Zk=t=>{let e=t.trim();return e=e.replace(/^\*\*(.+)\*\*$/,"$1").trim(),e=e.replace(/^\*+/,"").replace(/\*+$/,"").trim(),e=e.replace(/^["']+/,"").replace(/["']+$/,"").trim(),e=e.replace(/\s*\(\s*(?:optional|default)\s*\)\s*$/i,"").trim(),e=e.replace(/[:;]+$/,"").trim(),e},eU=[/^([0-9]+|[A-Za-z])[\.\)\]]\s+(.+)$/,/^([0-9]+|[A-Za-z])[]\s+(.+)$/,/^[(\[]?(?:option|choice)?\s*([0-9]+|[A-Za-z])[\)\]\.:-]\s+(.+)$/i,/^([0-9]+|[A-Za-z])\s*[-]\s+(.+)$/,/^[-]\s*(?:option|choice)?\s*([0-9]+|[A-Za-z])?[:\.\-\)]?\s+(.+)$/i],tU=new RegExp(String.raw`(?:^|\n)\s*(?:[\(\\[]?\s*(?:option|choice)?\s*)?([0-9]+|[A-Za-z])[\)\]\.:-]\s+([^\n]+?)(?=\n|$)`,"gi"),nU=t=>{const e=t.replace(/\r/g,"").replace(new RegExp(jk,"g"),".").replace(new RegExp(Xk,"g"),"(").replace(new RegExp(Qk,"g"),")").replace(new RegExp(Wk,"g"),""),n=e.split(/\n+/).map(l=>l.trim()),a=new Set,r=l=>{if(!l)return;const c=Zk(l);!c||c.length<2||c.length>140||a.add(c)};for(const l of n)if(l)for(const c of eU){const f=l.match(c);if(f&&f[2]){r(f[2]);break}}if(a.size===0){let l;for(;(l=tU.exec(e))!==null&&(r(l[2]),!(a.size>=5)););}return Array.from(a).slice(0,5)},sU=({promptId:t,message:e,onSubmit:n,disabled:a=!1,isActive:r})=>{const l=ue.useMemo(()=>nU(e),[e]),[c,f]=ue.useState(""),[y,p]=ue.useState(!1),m=a||y;if(l.length===0)return null;const v=x=>{const w=x.trim();w&&(p(!0),n(w))},_=x=>{x.preventDefault(),!(!c.trim()||m)&&(v(c),f(""))};return T.jsxs("div",{className:`rounded-md border px-3 py-2 ${r?"border-blue-300 bg-blue-50":"border-slate-200 bg-slate-50"} transition-colors`,children:[T.jsxs("div",{className:"flex items-center justify-between text-[11px] uppercase tracking-wide text-slate-500 mb-2",children:[T.jsxs("span",{children:["Prompt ",t]}),y&&T.jsx("span",{className:"text-emerald-600 font-semibold",children:"Sent"})]}),l.length>0&&T.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:l.map(x=>T.jsx("button",{type:"button",onClick:()=>v(x),disabled:m,className:`text-xs px-3 py-1 rounded-full border ${m?"text-slate-400 border-slate-200 bg-white cursor-not-allowed":"text-blue-700 border-blue-200 bg-white hover:bg-blue-100"} transition-colors`,children:x},`${t}-${x}`))}),T.jsxs("form",{onSubmit:_,className:"flex items-center gap-2",children:[T.jsx("input",{type:"text",value:c,onChange:x=>f(x.target.value),placeholder:"Type a custom answer",disabled:m,className:"flex-grow rounded-md border border-slate-200 px-2 py-1 text-sm text-slate-700 placeholder-slate-400 focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:bg-slate-100"}),T.jsx("button",{type:"submit",disabled:m||!c.trim(),className:"text-xs font-semibold px-3 py-1 rounded-md bg-blue-600 text-white disabled:bg-slate-300 disabled:text-slate-500 transition-colors",children:"Send"})]})]})},aU=()=>T.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:T.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),iU=()=>T.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[T.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),T.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),rU=()=>T.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:T.jsx("path",{d:"M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"})}),oU=()=>T.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:T.jsx("path",{d:"M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"})}),lU=()=>T.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[T.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),T.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),ZS=(t,e=60)=>t.length>e?`${t.slice(0,e)}`:t,uU={info:"bg-blue-50 text-blue-800 border-blue-200",warning:"bg-amber-50 text-amber-800 border-amber-200",muted:"bg-slate-100 text-slate-600 border-slate-200",progress:"bg-indigo-50 text-indigo-800 border-indigo-200",neutral:"bg-white text-slate-600 border-slate-200"},cU={info:"",warning:"",muted:"",progress:"",neutral:""},e_=240,dU=Ab(),t_={idle:{label:"Idle / Ready",helper:"Waiting for your next instruction.",icon:"",badge:"border-slate-200 bg-white text-slate-600"},observing:{label:"Observing data",helper:"Reviewing dataset context before acting.",icon:"",badge:"border-sky-200 bg-sky-50 text-sky-700"},planning:{label:"Planning",helper:"Breaking the task into actionable steps.",icon:"",badge:"border-purple-200 bg-purple-50 text-purple-700"},acting:{label:"Executing",helper:"Running the next tool or UI action.",icon:"",badge:"border-indigo-200 bg-indigo-50 text-indigo-700"},verifying:{label:"Verifying",helper:"Checking outputs before sharing updates.",icon:"",badge:"border-emerald-200 bg-emerald-50 text-emerald-700"},reporting:{label:"Reporting",helper:"Summarizing findings back to you.",icon:"",badge:"border-slate-200 bg-slate-50 text-slate-700"},clarifying:{label:"Needs clarification",helper:"Waiting on your answer to keep going.",icon:"",badge:"border-amber-200 bg-amber-50 text-amber-800"},retrying:{label:"Retrying",helper:"Adjusting after a failed attempt.",icon:"",badge:"border-rose-200 bg-rose-50 text-rose-700"}},fU={observing:{tone:"info",icon:"",message:"Reviewing your dataset",defaultHelperText:"Scanning columns, totals, and data freshness before planning."},planning:{tone:"info",icon:"",message:"Planning the next steps",defaultHelperText:"Sequencing the right tools to answer your question."},acting:{tone:"progress",icon:"",message:"Executing the plan",defaultHelperText:"Running transformations or updating charts for you."},verifying:{tone:"progress",icon:"",message:"Double-checking results",defaultHelperText:"Validating outputs before sharing them."},reporting:{tone:"neutral",icon:"",message:"Summarizing findings",defaultHelperText:"Preparing the explanation you will see in chat."},retrying:{tone:"warning",icon:"",message:"Retrying after an error",defaultHelperText:"Adjusting the last step to recover automatically."},clarifying:{tone:"info",icon:"",message:"Waiting for your clarification",defaultHelperText:"Answer the question above so I can continue."}},pU=()=>Ue(t=>({progressMessages:t.progressMessages,chatHistory:t.chatHistory,isBusy:t.isBusy,handleChatMessage:t.handleChatMessage,isApiKeySet:t.isApiKeySet,setIsAsideVisible:t.setIsAsideVisible,setIsSettingsModalOpen:t.setIsSettingsModalOpen,setIsMemoryPanelOpen:t.setIsMemoryPanelOpen,handleShowCardFromChat:t.handleShowCardFromChat,currentView:t.currentView,pendingClarifications:t.pendingClarifications,activeClarificationId:t.activeClarificationId,handleClarificationResponse:t.handleClarificationResponse,skipClarification:t.skipClarification,columnProfiles:t.columnProfiles,csvData:t.csvData,focusDataPreview:t.focusDataPreview,isCancellationRequested:t.isCancellationRequested,chatMemoryPreview:t.chatMemoryPreview,chatMemoryExclusions:t.chatMemoryExclusions,previewChatMemories:t.previewChatMemories,toggleMemoryPreviewSelection:t.toggleMemoryPreviewSelection,isMemoryPreviewLoading:t.isMemoryPreviewLoading,agentPhase:t.agentPhase,agentAwaitingUserInput:t.agentAwaitingUserInput,agentAwaitingPromptId:t.agentAwaitingPromptId}),nx),mU=()=>{var Aa,ki;const t=pU(),{progressMessages:e,chatHistory:n,isBusy:a,handleChatMessage:r,isApiKeySet:l,setIsAsideVisible:c,setIsSettingsModalOpen:f,setIsMemoryPanelOpen:y,handleShowCardFromChat:p,currentView:m,pendingClarifications:v,activeClarificationId:_,handleClarificationResponse:x,skipClarification:w,columnProfiles:A,csvData:C,focusDataPreview:N,isCancellationRequested:I,chatMemoryPreview:R,chatMemoryExclusions:M,previewChatMemories:z,toggleMemoryPreviewSelection:B,isMemoryPreviewLoading:k,agentPhase:W,agentAwaitingUserInput:Y,agentAwaitingPromptId:Z}=t,[te,L]=ue.useState(""),[ne,fe]=ue.useState({}),ae=ue.useRef(null),O=ue.useRef(null);Kk(O,te,{maxHeight:e_});const K=v.some(oe=>oe.status==="pending"),ee=ue.useMemo(()=>[...n].sort((oe,Re)=>oe.timestamp.getTime()-Re.timestamp.getTime()),[n]),ve=(C==null?void 0:C.data)??[],be=ue.useMemo(()=>{if(!A||A.length===0)return[];const oe=Eb(A,ve);return oe.length>0?oe:A.filter(Re=>["categorical","date","time"].includes(Re.type)).map(Re=>({profile:Re,uniqueValues:typeof Re.uniqueValues=="number"?Re.uniqueValues:0}))},[A,ve]),P=ue.useCallback((oe,Re)=>{const Dt=Re.trim();if(!Dt||a||!l)return;const yt=oe?`[prompt:${oe}] ${Dt}`:Dt;r(yt)},[r,a,l]),X=R.filter(oe=>!M.includes(oe.id)).length,se=R.length>0,re=_??((Aa=v.find(oe=>oe.status==="pending"))==null?void 0:Aa.id)??null,ge=()=>{var oe;(oe=ae.current)==null||oe.scrollIntoView({behavior:"smooth"})},xe=(oe,Re="ring-blue-400")=>{oe.classList.add("ring-2",Re),setTimeout(()=>oe.classList.remove("ring-2",Re),1800)},Te=()=>{if(!re||typeof document>"u")return;const oe=document.getElementById(`clarification-${re}`);oe&&(oe.scrollIntoView({behavior:"smooth",block:"center"}),xe(oe,"ring-blue-400"))},tt=()=>{if(typeof document>"u")return;const oe=document.getElementById("file-upload-panel");oe&&(oe.scrollIntoView({behavior:"smooth",block:"center"}),xe(oe,"ring-blue-300"))},Ke=()=>{if(typeof document>"u")return;const oe=document.getElementById("file-upload");if(oe){oe.click();return}tt()},wn=(oe,Re)=>{fe(Dt=>({...Dt,[oe]:Re}))},he=oe=>{const Re=ne[oe];Re&&x(oe,{label:`Manual grouping: ${Re}`,value:Re})},qe=(()=>{var ce,lt;const oe=((ce=e[e.length-1])==null?void 0:ce.text)??"",Re=oe.startsWith("Continuing plan"),Dt=(W==null?void 0:W.phase)??"idle",yt=Dt!=="idle"?fU[Dt]:void 0,$s=((lt=W==null?void 0:W.message)==null?void 0:lt.trim())||(yt==null?void 0:yt.defaultHelperText);return l?K?{tone:"info",icon:"",message:"Clarification pending  answer the follow-up to continue.",helperText:"Jump to the question, choose the right column, or skip it if it no longer applies.",actions:re?[{label:"Jump to question",onClick:Te}]:void 0}:Y?{tone:"info",icon:"",message:"Waiting on your response to continue.",helperText:"Use the question card above to answer so the agent can resume."}:Re?{tone:"muted",icon:"",message:oe,helperText:"The agent is automatically continuing the plan. You can relax or cancel if needed."}:m==="file_upload"?{tone:"muted",icon:"",message:"No dataset yet  upload a CSV to unlock the workspace.",helperText:"Drag & drop directly into the uploader or use Select a file.",actions:[{label:"Scroll to uploader",onClick:tt},{label:"Select a file",onClick:Ke}]}:a?I?{tone:"progress",icon:"",message:"Stopping the last run",helperText:"Once cancelled you can submit a new instruction right away."}:yt?{tone:yt.tone,icon:yt.icon,message:yt.message,helperText:$s}:{tone:"progress",icon:"",message:"AI is crunching your request.",helperText:"Feel free to review earlier messages while the agent works."}:yt?{tone:yt.tone,icon:yt.icon,message:yt.message,helperText:$s}:{tone:"neutral",icon:"",message:"Ready for your next instruction.",helperText:"Try Sum of sales by region or Remove rows for USA."}:{tone:"warning",icon:"",message:"API key missing  add one so Gemini can help.",helperText:"Open Settings and paste your Google Gemini API key to enable chat + analysis.",actions:[{label:"Open Settings",onClick:()=>f(!0)}]}})();ue.useEffect(ge,[ee]),ue.useEffect(()=>{const oe=te.trim();if(!oe){z("");return}const Re=window.setTimeout(()=>{z(oe)},400);return()=>window.clearTimeout(Re)},[te,z]);const Cn=oe=>{oe.preventDefault(),te.trim()&&!a&&(r(te.trim()),L(""))},Ut=oe=>{oe.key==="Enter"&&!oe.shiftKey&&Cn(oe)},xa=()=>{if(!l)return"Set API Key in settings to chat";if(K)return"Please resolve or skip the clarification above";if(Y)return"Answer the AI question above to resume";switch(m){case"analysis_dashboard":return"New analysis or transformation?";case"file_upload":default:return"Upload a file to begin chatting"}},Un=(oe,Re)=>{var Dt,yt,$s;if("sender"in oe){const ce=oe;if(ce.type==="ai_clarification"&&ce.clarificationRequest){const lt=v.find(Nt=>Nt.id===ce.clarificationRequest.id),nn=(lt==null?void 0:lt.status)??"resolved",Ys=nn==="pending",Js=nn==="resolving",Ui=(Ys||Js)&&(lt==null?void 0:lt.id)===_,ao=lt?nn==="pending":!1,Cu=ce.clarificationRequest.targetProperty==="groupByColumn",io=ne[ce.clarificationRequest.id]??"",Ks=Cu&&be.length>0,Pt={pending:Ui?"bg-blue-100 text-blue-800 border-blue-200":"bg-slate-100 text-slate-600 border-slate-200",resolving:"bg-amber-100 text-amber-800 border-amber-200",resolved:"bg-emerald-100 text-emerald-800 border-emerald-200",skipped:"bg-slate-200 text-slate-500 border-slate-300"},En=`clarification-${(lt==null?void 0:lt.id)??ce.clarificationRequest.id}`,Lt=nn==="pending"?Ui?"Active":"Queued":nn==="resolving"?"Working":nn==="skipped"?"Skipped":"Answered";return T.jsxs("div",{id:En,className:`my-2 p-3 bg-white border rounded-lg transition-colors ${Ui?"border-blue-400 shadow shadow-blue-100":"border-blue-200"} ${nn==="resolved"?"opacity-90":""} ${nn==="skipped"?"opacity-60":""}`,children:[T.jsxs("div",{className:"flex items-center justify-between mb-2",children:[T.jsxs("div",{className:"flex items-center text-blue-700",children:[T.jsx("span",{className:"text-lg mr-2",children:""}),T.jsx("h4",{className:"font-semibold",children:"Clarification Needed"})]}),T.jsx("span",{className:`text-xs px-2 py-1 border rounded-full ${Pt[nn]??"bg-slate-100 text-slate-600 border-slate-200"}`,children:Lt})]}),T.jsx("p",{className:"text-sm text-slate-700 mb-1",children:ce.clarificationRequest.question}),ce.clarificationRequest.columnHints&&ce.clarificationRequest.columnHints.length>0&&T.jsxs("p",{className:"text-xs text-slate-500 mb-2",children:["Column context: ",ce.clarificationRequest.columnHints.join(", ")]}),T.jsx("div",{className:"flex flex-col space-y-2",children:ce.clarificationRequest.options.map(Nt=>T.jsxs("button",{onClick:()=>x(ce.clarificationRequest.id,Nt),disabled:!Ys||a,className:"w-full text-left text-sm px-3 py-2 bg-slate-100 rounded-md hover:bg-blue-100 hover:border-blue-500 border border-slate-200 transition-colors disabled:opacity-60 disabled:cursor-not-allowed disabled:hover:bg-slate-100",children:[T.jsx("span",{className:"font-medium text-slate-800",children:Nt.label}),T.jsxs("span",{className:"block text-xs text-slate-500",children:["Column: ",Nt.value]})]},`${ce.clarificationRequest.id}-${Nt.value}`))}),Ks&&T.jsxs("div",{className:"mt-3 border-t border-slate-200 pt-3",children:[T.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"  / Pick a grouping column manually"}),T.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[T.jsxs("select",{className:"flex-1 border border-slate-200 rounded-md px-3 py-2 text-sm text-slate-700 bg-white",value:io,onChange:Nt=>wn(ce.clarificationRequest.id,Nt.target.value),disabled:!Ys||Js,children:[T.jsx("option",{value:"",children:" / Choose a grouping column"}),be.map(Nt=>T.jsxs("option",{value:Nt.profile.name,children:[Nt.profile.name,Nt.uniqueValues?` (${Nt.uniqueValues} distinct)`:" (distinct unknown)"]},`${ce.clarificationRequest.id}-${Nt.profile.name}`))]}),T.jsx("button",{onClick:()=>he(ce.clarificationRequest.id),disabled:!Ys||a||!io,className:"text-sm px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:" / Use column"})]})]}),T.jsx("div",{className:"flex justify-end mt-3",children:T.jsx("button",{onClick:()=>w(ce.clarificationRequest.id),disabled:!ao,className:"text-xs text-slate-500 hover:text-red-600 border border-slate-200 px-3 py-1 rounded-md transition-colors disabled:opacity-40 disabled:cursor-not-allowed",children:"Skip / Cancel"})})]},`chat-${Re}`)}return ce.type==="ai_plan_start"?T.jsxs("div",{className:"my-2 p-3 bg-slate-100 border border-slate-200 rounded-lg",children:[T.jsxs("div",{className:"flex items-center text-slate-700 mb-2",children:[T.jsx("span",{className:"text-lg mr-2",children:""}),T.jsx("h4",{className:"font-semibold",children:"Plan Execution"})]}),T.jsx("p",{className:"text-sm text-slate-700 whitespace-pre-wrap",children:ce.text})]},`chat-${Re}`):ce.type==="ai_thinking"?T.jsxs("div",{className:"my-2 p-3 bg-white border border-blue-200 rounded-lg",children:[T.jsxs("div",{className:"flex items-center text-blue-700 mb-2",children:[T.jsx("span",{className:"text-lg mr-2",children:""}),T.jsx("h4",{className:"font-semibold",children:"AI's Initial Analysis"})]}),T.jsx("p",{className:"text-sm text-slate-700 whitespace-pre-wrap",children:ce.text})]},`chat-${Re}`):ce.type==="ai_proactive_insight"?T.jsxs("div",{className:"my-2 p-3 bg-yellow-50 border border-yellow-300 rounded-lg",children:[T.jsxs("div",{className:"flex items-center text-yellow-800 mb-2",children:[T.jsx("span",{className:"text-lg mr-2",children:""}),T.jsx("h4",{className:"font-semibold",children:"Proactive Insight"})]}),T.jsx("p",{className:"text-sm text-slate-700 whitespace-pre-wrap",children:ce.text}),ce.cardId&&T.jsx("button",{onClick:()=>p(ce.cardId),className:"mt-2 text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-md hover:bg-yellow-200 transition-colors w-full text-left font-medium",children:" Show Related Card"})]},`chat-${Re}`):ce.sender==="user"?T.jsx("div",{className:"flex justify-end",children:T.jsx("div",{className:"bg-blue-600 rounded-lg px-3 py-2 max-w-xs lg:max-w-md",children:T.jsx("p",{className:"text-sm text-white",style:{whiteSpace:"break-spaces"},children:ce.text})})},`chat-${Re}`):T.jsx("div",{className:"flex",children:T.jsxs("div",{className:`rounded-lg px-3 py-2 max-w-xs lg:max-w-md ${ce.isError?"bg-red-100":"bg-slate-200"}`,children:[T.jsx("p",{className:`text-sm ${ce.isError?"text-red-800":"text-slate-800"}`,style:{whiteSpace:"break-spaces"},children:ce.text}),ce.cardId&&!ce.isError&&T.jsx("button",{onClick:()=>p(ce.cardId),className:"mt-2 text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-md hover:bg-blue-200 transition-colors w-full text-left font-medium",children:" Show Related Card"}),((Dt=ce.cta)==null?void 0:Dt.type)==="open_data_preview"&&T.jsxs("button",{onClick:N,className:"mt-2 text-xs bg-white text-blue-700 border border-blue-200 px-2 py-1 rounded-md hover:bg-blue-50 transition-colors w-full text-left font-medium",children:[" ",ce.cta.label,ce.cta.helperText&&T.jsx("span",{className:"block text-[11px] text-slate-500 mt-0.5",children:ce.cta.helperText})]}),ce.usedMemories&&ce.usedMemories.length>0&&T.jsxs("div",{className:"mt-2 border border-blue-100 bg-white rounded-md p-2",children:[T.jsxs("p",{className:"text-[11px] font-semibold text-blue-700 mb-1",children:["Used memory (",ce.usedMemories.length,")"]}),T.jsx("div",{className:"flex flex-wrap gap-1",children:ce.usedMemories.map(lt=>T.jsx("span",{className:"text-[11px] text-slate-600 bg-blue-50 border border-blue-100 rounded-full px-2 py-0.5",children:ZS(lt.text,48)},lt.id))})]}),((yt=ce.meta)==null?void 0:yt.awaitUser)&&(($s=ce.meta)==null?void 0:$s.promptId)&&T.jsx("div",{className:"mt-3",children:T.jsx(sU,{promptId:ce.meta.promptId,message:ce.text,onSubmit:lt=>P(ce.meta.promptId,lt),disabled:!l||a&&!Y,isActive:!Z||Z===ce.meta.promptId})})]})},`chat-${Re}`)}};return T.jsxs("div",{className:"flex flex-col h-full bg-slate-100 rounded-lg md:rounded-none",children:[T.jsxs("div",{className:"p-4 border-b border-slate-200 flex justify-between items-center relative",children:[T.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Assistant"}),T.jsxs("div",{className:"flex items-center space-x-3",children:[T.jsx("button",{onClick:()=>y(!0),className:"p-1 text-slate-500 rounded-full hover:bg-slate-200 hover:text-slate-800 transition-colors",title:"View AI Memory","aria-label":"View AI Memory",children:T.jsx(rU,{})}),dU.showSettingsButton&&T.jsx("button",{onClick:()=>f(!0),className:"p-1 text-slate-500 rounded-full hover:bg-slate-200 hover:text-slate-800 transition-colors",title:"Settings","aria-label":"Open Settings",children:T.jsx(iU,{})}),T.jsx("button",{onClick:()=>c(!1),className:"p-1 text-slate-500 rounded-full hover:bg-slate-200 hover:text-slate-800 transition-colors",title:"Hide Panel","aria-label":"Hide Assistant Panel",children:T.jsx(aU,{})})]})]}),T.jsxs("div",{className:"flex-1 p-4 overflow-y-auto space-y-4",children:[T.jsx(ix,{}),T.jsx(ax,{}),T.jsx(rx,{}),T.jsx(sx,{}),T.jsx(ox,{}),ee.map(Un),T.jsx("div",{ref:ae})]}),T.jsxs("div",{className:"p-4 border-t border-slate-200 bg-white",children:[se&&T.jsxs("div",{className:"mb-3",children:[T.jsxs("div",{className:"flex items-center gap-2 text-[11px] font-semibold text-slate-600 uppercase tracking-wide",children:["Used memory (",X,"/",R.length,")",k&&T.jsx("span",{className:"text-slate-400 font-normal normal-case",children:"Updating"})]}),T.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:R.map(oe=>{const Re=M.includes(oe.id);return T.jsx("button",{type:"button",onClick:()=>B(oe.id),className:`text-[11px] px-2 py-1 rounded-full border transition-colors ${Re?"bg-white border-slate-300 text-slate-400 line-through":"bg-blue-50 border-blue-200 text-blue-700"}`,title:Re?"Click to include this memory":"Click to exclude this memory",children:ZS(oe.text,42)},oe.id)})})]}),T.jsxs("form",{onSubmit:Cn,className:"flex items-start space-x-2",children:[T.jsxs("div",{className:"relative flex-grow",children:[T.jsx("textarea",{ref:O,rows:1,value:te,onChange:oe=>L(oe.target.value),onKeyDown:Ut,placeholder:xa(),disabled:!l||m==="file_upload"||K||Y,"aria-describedby":"chat-input-char-count",className:"w-full bg-white border border-slate-300 rounded-md py-2 pl-3 pr-14 text-sm leading-5 text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 resize-none",style:{minHeight:"40px",maxHeight:`${e_}px`,overflowY:"hidden"}}),T.jsxs("span",{id:"chat-input-char-count",className:"pointer-events-none absolute bottom-2 right-3 text-[11px] text-slate-400",children:[te.length," chars"]})]}),T.jsxs("button",{type:"submit",disabled:a||!te.trim()||!l||m==="file_upload"||K||Y,className:"flex-shrink-0 px-4 h-10 flex items-center justify-center gap-2 bg-blue-600 text-white font-semibold rounded-md hover:bg-blue-700 transition-colors disabled:bg-blue-300 disabled:cursor-not-allowed","aria-label":a?I?"Cancelling request":"Sending message":"Send message",children:[a?T.jsx(lU,{}):T.jsx(oU,{}),T.jsx("span",{className:"text-sm",children:a?I?"Cancelling":"Sending":"Send"})]})]}),T.jsxs("div",{className:`mt-3 flex flex-wrap items-center gap-2 rounded-md border px-3 py-2 text-xs ${uU[qe.tone]}`,role:"status","aria-live":"polite",children:[T.jsxs("div",{className:"flex items-start gap-2 flex-1 min-w-[200px]",children:[T.jsx("span",{className:"text-base leading-5",children:qe.icon??cU[qe.tone]}),T.jsxs("div",{children:[T.jsx("p",{className:"font-medium",children:qe.message}),qe.helperText&&T.jsx("p",{className:"text-[11px] opacity-90 mt-0.5",children:qe.helperText})]})]}),(ki=qe.actions)==null?void 0:ki.map(oe=>T.jsx("button",{type:"button",onClick:oe.onClick,className:"text-xs font-semibold text-blue-700 hover:text-blue-800 underline-offset-2 hover:underline",children:oe.label},oe.label))]})]})]})},hU=t=>{const e=[];let n=0,a=null;return t.forEach(r=>{if(r.text.startsWith("Continuing plan")){n+=1,a=r.timestamp;return}n>0&&(e.push({text:n===1?"Continuing plan":`Continuing plan retried ${n}`,type:"system",timestamp:a??r.timestamp}),n=0,a=null),e.push(r)}),n>0&&e.push({text:n===1?"Continuing plan":`Continuing plan retried ${n}`,type:"system",timestamp:a??new Date}),e.slice(-30)},sx=bn.memo(()=>{const t=Ue(r=>r.progressMessages),[e,n]=ue.useState(!0),a=ue.useMemo(()=>hU(t),[t]);return a.length===0?null:T.jsxs("div",{className:"mb-4 rounded-lg border border-slate-200 bg-white shadow-sm",children:[T.jsxs("button",{type:"button",onClick:()=>n(r=>!r),className:"w-full flex items-center justify-between px-3 py-2 text-xs font-medium text-slate-600",children:[T.jsx("span",{className:"uppercase tracking-wide",children:"System log"}),T.jsxs("span",{className:"text-[11px] text-slate-400",children:[a.length," events  ",e?"Show":"Hide"]})]}),!e&&T.jsx("div",{className:"max-h-56 overflow-y-auto divide-y divide-slate-100",children:a.map((r,l)=>T.jsxs("div",{className:`px-3 py-2 text-xs flex gap-2 ${r.type==="error"?"text-red-600":"text-slate-600"}`,children:[T.jsx("span",{className:"text-slate-400",children:r.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),T.jsx("span",{className:"leading-snug",children:r.text})]},`${r.timestamp.getTime()}-${l}`))})]})});sx.displayName="SystemLogPanel";const ax=bn.memo(()=>{const t=Ue(a=>{var r;return((r=a.plannerSession)==null?void 0:r.planState)??null});if(!t)return null;const e=t.nextSteps??[],n=t.updatedAt?new Date(t.updatedAt):new Date;return T.jsxs("div",{className:"mb-4 rounded-lg border border-slate-200 bg-white p-4 shadow-sm",children:[T.jsxs("div",{className:"flex items-center justify-between mb-2",children:[T.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Agent Goal Tracker"}),T.jsxs("span",{className:"text-xs text-slate-500",children:["Updated ",n.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),T.jsxs("p",{className:"text-sm text-slate-800 mb-2",children:[T.jsx("span",{className:"font-medium",children:"Goal:"})," ",t.goal]}),t.progress&&T.jsxs("p",{className:"text-sm text-slate-700 mb-2",children:[T.jsx("span",{className:"font-medium",children:"Progress:"})," ",t.progress]}),e.length>0&&T.jsxs("div",{className:"mb-2",children:[T.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500 mb-1",children:"Next steps"}),T.jsx("ol",{className:"list-decimal list-inside text-sm text-slate-700 space-y-0.5",children:e.map(a=>T.jsxs("li",{children:[T.jsxs("span",{className:"font-mono text-[11px] text-slate-500 mr-1",children:["[",a.id,"]"]}),a.label]},a.id))})]}),t.blockedBy&&T.jsxs("p",{className:"text-sm text-amber-600",children:[T.jsx("span",{className:"font-medium",children:"Blocked by:"})," ",t.blockedBy]})]})});ax.displayName="PlannerGoalTracker";const ix=bn.memo(()=>{const t=Ue(y=>y.agentPhase),{phase:e,message:n,enteredAt:a}=t??{phase:"idle",message:null,enteredAt:null},r=t_[e]??t_.idle,l=(n==null?void 0:n.trim())||r.helper,c=a?new Date(a):null,f=c&&!Number.isNaN(c.getTime())?c.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"}):null;return T.jsxs("div",{className:`mb-4 flex items-center justify-between rounded-lg border px-3 py-2 text-sm ${r.badge}`,role:"status","aria-live":"polite",children:[T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx("span",{className:"text-base",children:r.icon}),T.jsxs("div",{children:[T.jsx("p",{className:"font-semibold",children:r.label}),T.jsx("p",{className:"text-xs opacity-90",children:l})]})]}),f&&T.jsxs("span",{className:"text-xs text-slate-500 whitespace-nowrap",children:["Since ",f]})]})});ix.displayName="AgentPhaseIndicator";const gU={observing:"bg-slate-400",executing:"bg-blue-500",succeeded:"bg-emerald-500",failed:"bg-red-500"},yU={chat:"Chat",pipeline:"Analysis Pipeline",system:"System"},vU=t=>(t instanceof Date?t:new Date(t)).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),rx=bn.memo(()=>{const t=Ue(n=>n.agentActionTraces),e=ue.useMemo(()=>t.slice(-12).reverse(),[t]);return e.length===0?null:T.jsxs("div",{className:"mb-4",children:[T.jsxs("div",{className:"flex items-center justify-between mb-2",children:[T.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"AI Action Log"}),T.jsxs("span",{className:"text-xs text-slate-500",children:["Last ",e.length," events"]})]}),T.jsx("div",{className:"space-y-3 max-h-56 overflow-y-auto pr-1",children:e.map(n=>{const a=n.source??"chat",r=n.status??"observing";return T.jsxs("div",{className:"flex items-start space-x-3 text-sm",children:[T.jsx("div",{className:"flex flex-col items-center mt-1",children:T.jsx("span",{className:`w-2 h-2 rounded-full ${gU[r]}`})}),T.jsxs("div",{className:"flex-1",children:[T.jsxs("div",{className:"flex items-center text-xs text-slate-500 gap-2",children:[T.jsx("span",{className:"font-medium",children:vU(n.timestamp)}),T.jsx("span",{children:""}),T.jsx("span",{children:yU[a]??"AI"}),T.jsx("span",{children:""}),T.jsx("span",{className:"capitalize",children:r})]}),T.jsx("p",{className:"text-slate-800 mt-0.5 leading-snug whitespace-pre-line",children:n.summary}),n.details&&T.jsx("p",{className:"text-xs text-slate-500 mt-1 leading-snug whitespace-pre-line",children:n.details})]})]},n.id)})})]})});rx.displayName="AgentActionLogPanel";const SU={success:"bg-emerald-100 text-emerald-800 border-emerald-200",error:"bg-red-100 text-red-700 border-red-200",pending:"bg-amber-50 text-amber-700 border-amber-200"},_U={success:"Completed",error:"Failed",pending:"Pending"},TU={text_response:"Shared response",plan_creation:"Created analysis plan",dom_action:"UI interaction",execute_js_code:"Data transform",filter_spreadsheet:"Spreadsheet filter",clarification_request:"Clarification request",proceed_to_analysis:"Pipeline continuation"},bU=t=>{const e=new Date(t);return Number.isNaN(e.getTime())?"":e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},xU=t=>{const{outputs:e,uiDelta:n}=t;if(e){if(typeof e.summary=="string")return e.summary;if(typeof e.textPreview=="string")return e.textPreview;if(typeof e.reason=="string")return e.reason;const a=Object.keys(e)[0];if(a){const r=e[a],l=typeof r=="string"?r:JSON.stringify(r);return l.length>140?`${l.slice(0,140)}`:l}}return n||null},ox=bn.memo(()=>{const{observations:t,isBusy:e}=Ue(a=>{var r;return{observations:((r=a.plannerSession)==null?void 0:r.observations)??[],isBusy:a.isBusy}},nx),n=ue.useMemo(()=>t.slice(-8).reverse(),[t]);return n.length===0?null:T.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg p-3 shadow-sm",children:[T.jsxs("div",{className:"flex items-center justify-between mb-3",children:[T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx("span",{className:"text-lg",children:""}),T.jsxs("div",{children:[T.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Live Agent Timeline"}),T.jsx("p",{className:"text-xs text-slate-500",children:"Newest events shown first"})]})]}),e&&T.jsx("span",{className:"text-xs uppercase tracking-wide text-blue-600 font-semibold",children:"Running"})]}),T.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto pr-1",children:n.map(a=>{const r=xU(a),l=a.status??"pending",c=SU[l]??"bg-slate-100 text-slate-600 border-slate-200",f=_U[l]??l;return T.jsxs("div",{className:"relative border-l-2 border-slate-100 pl-3",children:[T.jsx("span",{className:`absolute -left-[5px] top-2 w-2 h-2 rounded-full ${l==="success"?"bg-emerald-500":l==="error"?"bg-red-500":"bg-amber-400"}`}),T.jsxs("div",{className:"flex items-center justify-between text-[11px] text-slate-500",children:[T.jsx("span",{className:"font-medium",children:bU(a.timestamp)}),T.jsx("span",{className:`px-2 py-0.5 rounded-full border ${c}`,children:f})]}),T.jsx("p",{className:"text-sm font-semibold text-slate-800 mt-1",children:TU[a.responseType]??"Agent action"}),r&&T.jsx("p",{className:"text-xs text-slate-600 mt-1 whitespace-pre-line",children:r}),a.errorCode&&T.jsxs("p",{className:"text-xs text-red-600 mt-1",children:["Error code: ",a.errorCode]})]},a.id)})})]})});ox.displayName="AgentObservationTimeline";const AU=()=>{const{handleFileUpload:t,isBusy:e,isApiKeySet:n,progressMessages:a,fileName:r}=Ue(v=>{var _;return{handleFileUpload:v.handleFileUpload,isBusy:v.isBusy,isApiKeySet:v.isApiKeySet,progressMessages:v.progressMessages,fileName:((_=v.csvData)==null?void 0:_.fileName)||null}}),[l,c]=ue.useState(!1),f={id:"file-upload-panel"},y=ue.useCallback(v=>{v.preventDefault(),v.stopPropagation(),n&&(v.type==="dragenter"||v.type==="dragover"?c(!0):v.type==="dragleave"&&c(!1))},[n]),p=ue.useCallback(v=>{v.preventDefault(),v.stopPropagation(),c(!1),n&&v.dataTransfer.files&&v.dataTransfer.files[0]&&t(v.dataTransfer.files[0])},[t,n]),m=v=>{n&&v.target.files&&v.target.files[0]&&t(v.target.files[0])};return e&&r?T.jsxs("div",{...f,className:"flex flex-col items-center justify-center p-12 border-2 border-dashed rounded-lg border-blue-500 bg-slate-100 h-full",children:[T.jsxs("div",{className:"flex items-center text-xl text-slate-800 mb-4",children:[T.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[T.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),T.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),T.jsxs("span",{children:['Processing "',r,'"...']})]}),T.jsx("div",{className:"w-full max-w-lg bg-white rounded-md p-4 max-h-64 overflow-y-auto border border-slate-200",children:T.jsx("ul",{className:"space-y-1",children:a.map((v,_)=>T.jsxs("li",{className:`flex text-xs ${v.type==="error"?"text-red-600":"text-slate-500"}`,children:[T.jsx("span",{className:"mr-2 text-slate-400",children:v.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})}),T.jsx("span",{children:v.text})]},_))})}),T.jsx("p",{className:"mt-4 text-xs text-slate-500",children:"All processing is done locally in your browser. Your data stays private."})]}):n?T.jsxs("div",{...f,onDragEnter:y,onDragLeave:y,onDragOver:y,onDrop:p,className:`flex flex-col items-center justify-center p-12 border-2 border-dashed rounded-lg transition-colors duration-300 h-full ${l?"border-blue-500 bg-slate-100":"border-slate-300 hover:border-blue-500"}`,children:[T.jsx("svg",{className:"w-16 h-16 text-slate-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:T.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V7a2 2 0 012-2h10a2 2 0 012 2v10a2 2 0 01-2 2z"})}),T.jsx("p",{className:"text-xl text-slate-500 mb-2",children:"Drag & drop your CSV file here"}),T.jsx("p",{className:"text-slate-400",children:"or"}),T.jsx("label",{htmlFor:"file-upload",className:"mt-4 cursor-pointer bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors",children:"Select a file"}),T.jsx("input",{id:"file-upload",type:"file",accept:".csv",onChange:m,className:"hidden",disabled:e}),T.jsx("p",{className:"mt-4 text-xs text-slate-500",children:"All processing is done locally in your browser. Your data stays private."})]}):T.jsxs("div",{...f,className:"flex flex-col items-center justify-center p-12 border-2 border-dashed rounded-lg border-slate-300 h-full",children:[T.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-16 h-16 text-slate-400 mb-4",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:T.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 5.25a3 3 0 013 3m3 0a6 6 0 01-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1121.75 8.25z"})}),T.jsx("h3",{className:"text-xl font-semibold text-slate-800",children:"API Key Required"}),T.jsx("p",{className:"mt-2 max-w-sm text-center text-slate-500",children:"To unlock the AI analysis features, please add your Google Gemini API key in the Assistant's settings panel."}),T.jsx("p",{className:"mt-6 text-xs text-slate-400",children:"Your data remains local and private even when using the AI."})]})},wU=["English","Mandarin","Spanish","Japanese","French"],n_=["gemini-2.5-flash","gemini-2.5-pro"],s_=["gpt-5","gpt-5-mini"],CU=[{label:"Every 15 seconds",value:15},{label:"Every 30 seconds",value:30},{label:"Every minute",value:60},{label:"Every 2 minutes",value:120}],EU=()=>{const{isOpen:t,onClose:e,onSave:n,currentSettings:a}=Ue(p=>({isOpen:p.isSettingsModalOpen,onClose:()=>p.setIsSettingsModalOpen(!1),onSave:p.handleSaveSettings,currentSettings:p.settings})),[r,l]=ue.useState(a);if(ue.useEffect(()=>{l(a)},[a,t]),!t)return null;const c=()=>{n(r),e()},f=p=>{const{name:m,value:v}=p.target;l(m==="autoSaveIntervalSeconds"?_=>({..._,[m]:Number(v)}):_=>({..._,[m]:v}))},y=p=>{l(m=>{const v=n_.includes(m.model),_=s_.includes(m.model);let x=m.model;return p==="google"&&!v?x="gemini-2.5-pro":p==="openai"&&!_&&(x="gpt-5"),{...m,provider:p,model:x}})};return T.jsx("div",{className:"fixed inset-0 bg-slate-900 bg-opacity-50 flex items-center justify-center z-50",onClick:e,children:T.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-md border border-slate-200",onClick:p=>p.stopPropagation(),children:[T.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-6",children:"Settings"}),T.jsxs("div",{className:"space-y-6",children:[T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"AI Provider"}),T.jsxs("div",{className:"flex space-x-2 rounded-lg bg-slate-200 p-1",children:[T.jsx("button",{onClick:()=>y("google"),className:`w-full rounded-md py-1.5 text-sm font-medium transition-colors ${r.provider==="google"?"bg-blue-600 text-white shadow":"text-slate-700 hover:bg-slate-300"}`,children:"Google Gemini"}),T.jsx("button",{onClick:()=>y("openai"),className:`w-full rounded-md py-1.5 text-sm font-medium transition-colors ${r.provider==="openai"?"bg-blue-600 text-white shadow":"text-slate-700 hover:bg-slate-300"}`,children:"OpenAI"})]})]}),r.provider==="google"&&T.jsxs("div",{children:[T.jsx("label",{htmlFor:"geminiApiKey",className:"block text-sm font-medium text-slate-700",children:"Gemini API Key"}),T.jsx("input",{type:"password",id:"geminiApiKey",name:"geminiApiKey",value:r.geminiApiKey,onChange:f,className:"mt-1 block w-full bg-white border border-slate-300 rounded-md py-2 px-3 text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter your API key"}),T.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Get your key from ",T.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"Google AI Studio"}),"."]})]}),r.provider==="openai"&&T.jsxs("div",{children:[T.jsx("label",{htmlFor:"openAIApiKey",className:"block text-sm font-medium text-slate-700",children:"OpenAI API Key"}),T.jsx("input",{type:"password",id:"openAIApiKey",name:"openAIApiKey",value:r.openAIApiKey,onChange:f,className:"mt-1 block w-full bg-white border border-slate-300 rounded-md py-2 px-3 text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter your API key (sk-...)"}),T.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Get your key from ",T.jsx("a",{href:"https://platform.openai.com/api-keys",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"OpenAI Platform"}),"."]})]}),T.jsxs("div",{children:[T.jsx("label",{htmlFor:"model",className:"block text-sm font-medium text-slate-700",children:"AI Model"}),T.jsx("input",{type:"text",id:"model",name:"model",value:r.model,onChange:f,list:"model-list",className:"mt-1 block w-full bg-white border border-slate-300 rounded-md py-2 px-3 text-slate-900 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., gpt-5"}),T.jsx("datalist",{id:"model-list",children:(r.provider==="google"?n_:s_).map(p=>T.jsx("option",{value:p},p))}),T.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Select a suggested model or type a custom one."})]}),T.jsxs("div",{children:[T.jsx("label",{htmlFor:"language",className:"block text-sm font-medium text-slate-700",children:"Agent Language"}),T.jsx("select",{id:"language",name:"language",value:r.language,onChange:f,className:"mt-1 block w-full bg-white border border-slate-300 rounded-md py-2 px-3 text-slate-900 focus:outline-none focus:ring-2 focus:ring-blue-500",children:wU.map(p=>T.jsx("option",{value:p,children:p},p))}),T.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Primary language for AI summaries and chat responses."})]}),T.jsxs("div",{className:"border-t border-slate-200 pt-4",children:[T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Auto-Save"}),T.jsx("p",{className:"text-xs text-slate-500",children:"Periodically store the current analysis so you can recover it later."})]}),T.jsx("button",{onClick:()=>l(p=>({...p,autoSaveEnabled:!p.autoSaveEnabled})),className:`px-3 py-1 rounded-full text-sm font-medium transition-colors ${r.autoSaveEnabled?"bg-blue-600 text-white":"bg-slate-200 text-slate-700"}`,children:r.autoSaveEnabled?"Enabled":"Paused"})]}),r.autoSaveEnabled&&T.jsxs("div",{className:"mt-4",children:[T.jsx("label",{htmlFor:"autoSaveIntervalSeconds",className:"block text-sm font-medium text-slate-700",children:"Auto-Save Frequency"}),T.jsx("select",{id:"autoSaveIntervalSeconds",name:"autoSaveIntervalSeconds",value:r.autoSaveIntervalSeconds,onChange:f,className:"mt-1 block w-full bg-white border border-slate-300 rounded-md py-2 px-3 text-slate-900 focus:outline-none focus:ring-2 focus:ring-blue-500",children:CU.map(p=>T.jsx("option",{value:p.value,children:p.label},p.value))})]})]})]}),T.jsxs("div",{className:"mt-8 flex justify-end space-x-3",children:[T.jsx("button",{onClick:e,className:"px-4 py-2 bg-slate-200 text-slate-800 rounded-md hover:bg-slate-300 transition-colors",children:"Cancel"}),T.jsx("button",{onClick:c,className:"px-4 py-2 bg-blue-600 text-white font-semibold rounded-md hover:bg-blue-700 transition-colors",children:"Save Settings"})]})]})})},NU=()=>T.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:T.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),IU=()=>T.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:T.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),RU=()=>{const{isOpen:t,onClose:e,reports:n,onLoadReport:a,onDeleteReport:r}=Ue(c=>({isOpen:c.isHistoryPanelOpen,onClose:()=>c.setIsHistoryPanelOpen(!1),reports:c.reportsList,onLoadReport:c.handleLoadReport,onDeleteReport:c.handleDeleteReport}));if(!t)return null;const l=(c,f,y)=>{c.stopPropagation(),window.confirm(`Are you sure you want to delete the report for "${y}"? This cannot be undone.`)&&r(f)};return T.jsx("div",{className:"fixed inset-0 bg-slate-900 bg-opacity-50 flex items-center justify-center z-50",onClick:e,children:T.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-2xl h-full max-h-[80vh] border border-slate-200 flex flex-col",onClick:c=>c.stopPropagation(),children:[T.jsxs("div",{className:"flex justify-between items-center mb-4",children:[T.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"Analysis History"}),T.jsx("button",{onClick:e,className:"p-1 text-slate-500 rounded-full hover:bg-slate-100 hover:text-slate-800 transition-colors",title:"Close History",children:T.jsx(NU,{})})]}),T.jsx("div",{className:"flex-grow overflow-y-auto pr-2",children:n.length===0?T.jsx("div",{className:"flex items-center justify-center h-full",children:T.jsx("p",{className:"text-slate-500",children:"No past reports found. Upload a CSV to start."})}):T.jsx("ul",{className:"space-y-3",children:n.map(c=>{const f=c.id===qs;return T.jsx("li",{children:T.jsx("div",{onClick:()=>!f&&a(c.id),className:`block p-4 bg-slate-50 rounded-lg transition-all ${f?"ring-2 ring-blue-500 cursor-default":"hover:bg-slate-100 hover:ring-2 hover:ring-blue-500 cursor-pointer"}`,children:T.jsxs("div",{className:"flex justify-between items-center",children:[T.jsxs("div",{children:[T.jsxs("p",{className:"font-semibold text-slate-800 truncate",children:[f?T.jsx("span",{className:"text-blue-600 font-bold",children:"[Current Session] "}):null,c.filename]}),T.jsxs("p",{className:"text-sm text-slate-500",children:["Last saved: ",new Date(c.updatedAt).toLocaleString()]})]}),!f&&T.jsx("button",{onClick:y=>l(y,c.id,c.filename),className:"p-2 text-slate-500 rounded-full hover:bg-red-100 hover:text-red-600 transition-colors flex-shrink-0 ml-4",title:"Delete Report",children:T.jsx(IU,{})})]})})},c.id)})})}),T.jsx("p",{className:"text-xs text-slate-500 mt-4 text-center",children:"Your reports are saved securely in your browser's IndexedDB."})]})})},MU=()=>T.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:T.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),DU=()=>T.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:T.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),PU=5*1024,LU=()=>{const t=Ue(k=>k.isMemoryPanelOpen),e=Ue(k=>k.addToast),n=()=>Ue.getState().setIsMemoryPanelOpen(!1),[a,r]=ue.useState([]),[l,c]=ue.useState(""),[f,y]=ue.useState([]),[p,m]=ue.useState(!1),[v,_]=ue.useState(null),x=ue.useRef(null),w=at.getIsInitialized(),A=ue.useCallback(()=>{r(at.getDocuments())},[]),C=ue.useMemo(()=>{if(a.length===0)return 0;const k=a.reduce((Y,Z)=>Y+Z.text.length*2,0),W=a.length*384*4;return(k+W)/1024},[a]);ue.useEffect(()=>{t?A():(c(""),y([]),_(null))},[t,A]),ue.useEffect(()=>()=>{var k;(k=x.current)==null||k.abort()},[]);const N=async k=>{var Y;if(k.preventDefault(),!l.trim()||!w)return;(Y=x.current)==null||Y.abort();const W=new AbortController;x.current=W,m(!0),_(null);try{const Z=await at.search(l,5,{signal:W.signal});W.signal.aborted||y(Z)}catch(Z){Z instanceof DOMException&&Z.name==="AbortError"||console.error("Memory search failed:",Z)}finally{x.current===W&&(x.current=null),m(!1)}},I=()=>{x.current&&(x.current.abort(),x.current=null,m(!1),e("Memory search cancelled.","info"))},R=k=>{window.confirm("Are you sure you want to delete this memory item?")&&(at.deleteDocument(k),A())},M=()=>{window.confirm("Are you sure you want to clear all items from the AI's memory? This cannot be undone.")&&(at.clear(),A(),y([]))},z=k=>{_(k);const W=document.getElementById(`memory-doc-${k.substring(0,30)}`);W==null||W.scrollIntoView({behavior:"smooth",block:"center"})};if(!t)return null;const B=Math.min(C/PU*100,100);return T.jsx("div",{className:"fixed inset-0 bg-slate-900 bg-opacity-50 flex items-center justify-center z-50 transition-opacity",onClick:n,children:T.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-4xl h-full max-h-[85vh] border border-slate-200 flex flex-col",onClick:k=>k.stopPropagation(),children:[T.jsxs("header",{className:"flex justify-between items-start mb-4 flex-shrink-0",children:[T.jsxs("div",{children:[T.jsxs("div",{className:"flex items-center space-x-3",children:[T.jsx("span",{className:"text-3xl",children:""}),T.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"AI Long-Term Memory"})]}),T.jsxs("div",{className:"mt-2 pl-12",children:[T.jsxs("div",{className:"flex items-baseline space-x-2 text-sm text-slate-500",children:[T.jsxs("span",{children:[a.length," items"]}),T.jsx("span",{className:"text-slate-300",children:"|"}),T.jsxs("span",{children:["Using ~",C.toFixed(2)," KB"]})]}),T.jsx("div",{className:"w-full bg-slate-200 rounded-full h-1.5 mt-1",children:T.jsx("div",{className:"bg-blue-600 h-1.5 rounded-full",style:{width:`${B}%`}})})]})]}),T.jsx("button",{onClick:n,className:"p-1 text-slate-500 rounded-full hover:bg-slate-100 hover:text-slate-800 transition-colors",title:"Close",children:T.jsx(MU,{})})]}),T.jsxs("div",{className:"flex-grow grid md:grid-cols-2 gap-6 min-h-0",children:[T.jsxs("div",{className:"flex flex-col min-h-0",children:[T.jsxs("div",{className:"mb-4 p-4 bg-slate-50 border border-slate-200 rounded-lg flex-shrink-0",children:[T.jsx("h3",{className:"font-semibold text-slate-800 mb-2",children:"Test Similarity Search"}),T.jsxs("form",{onSubmit:N,className:"flex items-center space-x-2",children:[T.jsx("input",{type:"text",value:l,onChange:k=>c(k.target.value),placeholder:w?"Enter query to find memories...":"Memory model is loading...",disabled:!w||p,className:"flex-grow bg-white border border-slate-300 rounded-md py-1.5 px-3 text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:opacity-50"}),T.jsxs("div",{className:"flex items-center space-x-2",children:[T.jsx("button",{type:"submit",disabled:!w||p||!l.trim(),className:"px-4 py-1.5 bg-blue-600 text-white font-semibold rounded-md hover:bg-blue-700 transition-colors disabled:bg-blue-300 disabled:cursor-not-allowed",children:p?"Searching":"Search"}),p&&T.jsx("button",{type:"button",onClick:I,className:"px-3 py-1.5 border border-slate-300 rounded-md text-slate-600 hover:bg-slate-100 transition-colors",children:"Cancel"})]})]})]}),T.jsx("div",{className:"flex-grow overflow-y-auto pr-2",children:f.length>0&&T.jsxs("div",{className:"space-y-2",children:[T.jsx("h4",{className:"text-sm font-medium text-slate-600",children:"Top Results:"}),f.map(k=>T.jsxs("div",{onClick:()=>z(k.text),className:"bg-white p-2.5 border border-slate-200 rounded-lg text-xs cursor-pointer hover:border-blue-500 hover:ring-1 hover:ring-blue-500",children:[T.jsxs("div",{className:"flex justify-between items-center mb-1",children:[T.jsx("p",{className:"text-slate-700 font-semibold",children:"Match"}),T.jsxs("p",{className:"text-blue-600 font-bold",children:[(k.score*100).toFixed(1),"%"]})]}),T.jsx("div",{className:"w-full bg-slate-200 rounded-full h-1 mb-2",children:T.jsx("div",{className:"bg-blue-500 h-1 rounded-full",style:{width:`${k.score*100}%`}})}),T.jsxs("p",{className:"text-slate-600 italic",children:['"',k.text,'"']})]},k.id))]})})]}),T.jsxs("div",{className:"flex flex-col min-h-0",children:[T.jsxs("div",{className:"flex justify-between items-center mb-2 flex-shrink-0",children:[T.jsxs("h3",{className:"font-semibold text-slate-800",children:["All Stored Memories (",a.length,")"]}),a.length>0&&T.jsx("button",{onClick:M,className:"text-xs text-red-600 hover:underline",children:"Clear All"})]}),T.jsx("div",{className:"flex-grow overflow-y-auto pr-2 border-t border-slate-200 pt-2",children:a.length===0?T.jsx("div",{className:"flex items-center justify-center h-full text-slate-500 text-sm",children:T.jsx("p",{children:"The AI's memory is currently empty."})}):T.jsx("ul",{className:"space-y-2",children:a.map(k=>T.jsxs("li",{id:`memory-doc-${k.text.substring(0,30)}`,className:`p-3 bg-slate-50 rounded-lg text-sm text-slate-800 border border-slate-200 flex justify-between items-start group transition-all duration-300 ${v===k.text?"border-blue-500 ring-2 ring-blue-500":""}`,children:[T.jsx("p",{className:"flex-grow pr-4 break-words",children:k.text}),T.jsx("button",{onClick:()=>R(k.id),className:"p-1 text-slate-400 rounded-full hover:bg-red-100 hover:text-red-600 transition-colors opacity-0 group-hover:opacity-100 flex-shrink-0",title:"Delete Memory",children:T.jsx(DU,{})})]},k.id))})})]})]})]})})},Ll=50,kU=({direction:t})=>t?t==="ascending"?T.jsx("span",{className:"text-slate-800",children:""}):T.jsx("span",{className:"text-slate-800",children:""}):T.jsx("span",{className:"text-slate-400",children:""}),UU=({data:t,sortConfig:e,onSort:n,columnWidths:a,onColumnResizeStart:r})=>{const[l,c]=ue.useState(0);if(!t||t.length===0)return T.jsx("p",{className:"text-slate-500 p-4 text-center",children:"No data matches your search."});const f=Object.keys(t[0]),y=Math.ceil(t.length/Ll),p=l*Ll,m=t.slice(p,p+Ll),v=()=>c(w=>Math.max(0,w-1)),_=()=>c(w=>Math.min(y-1,w+1)),x=w=>{let A,C="";for(;w>=0;)A=w%26,C=String.fromCharCode(A+65)+C,w=Math.floor(w/26)-1;return C};return T.jsxs("div",{className:"w-full text-sm h-full flex flex-col",children:[T.jsx("div",{className:"flex-grow overflow-auto",children:T.jsxs("table",{className:"w-full text-left border-collapse",style:{tableLayout:"fixed"},children:[T.jsx("thead",{className:"bg-slate-100 text-slate-600 sticky top-0 z-10",children:T.jsxs("tr",{children:[T.jsx("th",{className:"p-2 font-semibold text-slate-500 text-center sticky left-0 z-20 bg-slate-100 border-r border-slate-200",style:{width:"60px"},children:"#"}),f.map((w,A)=>T.jsxs("th",{className:"p-2 font-semibold whitespace-nowrap border-r border-l border-slate-200 relative",style:{width:a[w]||150},children:[T.jsxs("button",{onClick:()=>n(w),className:"flex items-center justify-between w-full h-full",children:[T.jsxs("span",{className:"truncate",title:w,children:[x(A)," - ",w]}),T.jsx(kU,{direction:(e==null?void 0:e.key)===w?e.direction:void 0})]}),T.jsx("div",{onMouseDown:C=>r(w,C),className:"absolute top-0 right-0 h-full w-2 cursor-col-resize z-30"})]},w))]})}),T.jsx("tbody",{className:"bg-white",children:m.map((w,A)=>T.jsxs("tr",{className:"border-b border-slate-200 last:border-b-0 hover:bg-slate-50",children:[T.jsx("td",{className:"p-2 text-slate-400 text-center sticky left-0 z-10 bg-white border-r border-slate-200",style:{width:"60px"},children:p+A+1}),f.map(C=>T.jsx("td",{className:"p-2 text-slate-700 whitespace-nowrap overflow-hidden text-ellipsis border-r border-l border-slate-200",children:$l(w[C])},`${A}-${C}`))]},A))})]})}),y>1&&T.jsxs("div",{className:"flex justify-between items-center p-2 bg-slate-100 border-t border-slate-200 flex-shrink-0",children:[T.jsxs("span",{className:"text-xs text-slate-500",children:["Showing ",p+1," - ",Math.min(p+Ll,t.length)," of ",t.length," rows"]}),T.jsxs("div",{className:"flex items-center space-x-2",children:[T.jsx("button",{onClick:v,disabled:l===0,className:"px-2 py-1 text-xs bg-slate-200 rounded disabled:opacity-50 hover:bg-slate-300",children:"Previous"}),T.jsxs("span",{className:"text-xs text-slate-500",children:["Page ",l+1," of ",y]}),T.jsx("button",{onClick:_,disabled:l===y-1,className:"px-2 py-1 text-xs bg-slate-200 rounded disabled:opacity-50 hover:bg-slate-300",children:"Next"})]})]})]})},OU=()=>T.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-slate-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:T.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),qU=({isOpen:t})=>T.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-6 w-6 transform transition-transform duration-200 ${t?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:T.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),a_=()=>T.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:T.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})}),BU=()=>T.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:T.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})}),HU=()=>T.jsxs("svg",{className:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[T.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),T.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),VU=t=>{const e=t instanceof Date?t:new Date(t);return Number.isNaN(e.getTime())?"":e.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"})},FU=({isVisible:t})=>{const{csvData:e,spreadsheetFilterFunction:n,aiFilterExplanation:a,isAiFiltering:r,handleNaturalLanguageQuery:l,clearAiFilter:c,cancelAiFilterRequest:f,interactiveSelectionFilter:y,chatHistory:p,datasetHash:m,addToast:v}=Ue(L=>({csvData:L.csvData,spreadsheetFilterFunction:L.spreadsheetFilterFunction,aiFilterExplanation:L.aiFilterExplanation,isAiFiltering:L.isAiFiltering,handleNaturalLanguageQuery:L.handleNaturalLanguageQuery,clearAiFilter:L.clearAiFilter,cancelAiFilterRequest:L.cancelAiFilterRequest,interactiveSelectionFilter:L.interactiveSelectionFilter,chatHistory:L.chatHistory,datasetHash:L.datasetHash,addToast:L.addToast})),_=()=>Ue.getState().setIsSpreadsheetVisible(!t),[x,w]=ue.useState(null),[A,C]=ue.useState(""),N=ue.useMemo(()=>(e==null?void 0:e.data.length)>0?Object.keys(e.data[0]):[],[e==null?void 0:e.data]),[I,R]=ue.useState({});ue.useEffect(()=>{if(!e)return;const L={};N.forEach(ne=>{var O;const fe=ne.length*8+30,ae=String(((O=e.data[0])==null?void 0:O[ne])||"").length*7;L[ne]=Math.max(120,fe,ae)}),R(L)},[N,e]);const M=L=>{let ne="ascending";x&&x.key===L&&x.direction==="ascending"&&(ne="descending"),w({key:L,direction:ne})},z=(L,ne)=>{ne.preventDefault();const fe=ne.clientX,ae=I[L],O=ee=>{const ve=ae+(ee.clientX-fe);ve>60&&R(be=>({...be,[L]:ve}))},K=()=>{document.removeEventListener("mousemove",O),document.removeEventListener("mouseup",K),document.body.style.cursor=""};document.body.style.cursor="col-resize",document.addEventListener("mousemove",O),document.addEventListener("mouseup",K)},B=()=>{if(!e||e.data.length===0||N.length===0)return;const L=K=>{const ee=K==null?"":String(K);return/[",\n]/.test(ee)?`"${ee.replace(/"/g,'""')}"`:ee},ne=[N.join(","),...e.data.map(K=>N.map(ee=>L(K[ee])).join(","))],fe=new Blob([ne.join(`
`)],{type:"text/csv;charset=utf-8;"}),ae=URL.createObjectURL(fe),O=document.createElement("a");O.href=ae,O.download=e.fileName||"dataset.csv",O.click(),URL.revokeObjectURL(ae)},k=async()=>{if(m)try{await navigator.clipboard.writeText(m),v("Checksum copied.","success",2e3)}catch(L){console.error("Failed to copy checksum:",L),v("Copy failed. Please copy manually.","error",3e3)}},W=()=>{A.trim()&&l(A.trim())},Y=L=>{L.key==="Enter"&&W()},Z=ue.useMemo(()=>{if(!e)return[];let L=[...e.data];if(y&&y.column){const ne=y.values.map(fe=>String(fe));L=L.filter(fe=>{const ae=fe[y.column];return ne.includes(ae==null?"":String(ae))})}if(n)try{L=g_(L,n)}catch(ne){console.error("AI filter execution failed:",ne)}else if(A){const ne=A.toLowerCase();L=L.filter(fe=>Object.values(fe).some(ae=>String(ae).toLowerCase().includes(ne)))}return x!==null&&L.sort((ne,fe)=>{const ae=ne[x.key],O=fe[x.key];if(ae==null)return 1;if(O==null)return-1;const K=typeof ae=="number"?ae:parseFloat(String(ae).replace(/[^0-9.-]+/g,"")),ee=typeof O=="number"?O:parseFloat(String(O).replace(/[^0-9.-]+/g,""));if(!isNaN(K)&&!isNaN(ee))return x.direction==="ascending"?K-ee:ee-K;const ve=String(ae).toLowerCase(),be=String(O).toLowerCase();return ve<be?x.direction==="ascending"?-1:1:ve>be?x.direction==="ascending"?1:-1:0}),L},[e,x,A,n,y]),te=ue.useMemo(()=>p.filter(L=>typeof L.text=="string"&&L.text.startsWith("System note:")&&(L.text.includes("Raw Data Explorer")||L.text.includes("chart drilldown"))).slice(-5).reverse(),[p]);return e?T.jsxs("div",{id:"raw-data-explorer",className:"bg-white rounded-lg shadow-lg flex flex-col transition-all duration-300 border border-slate-200",children:[T.jsxs("button",{onClick:_,className:"flex justify-between items-center p-4 cursor-pointer w-full text-left rounded-t-lg hover:bg-slate-50","aria-expanded":t,children:[T.jsxs("div",{children:[T.jsx("h3",{className:"text-lg font-bold text-slate-900",children:"Raw Data Explorer"}),T.jsxs("p",{className:"text-sm text-slate-500",children:["File: ",e.fileName]}),T.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-xs text-slate-500",children:[T.jsx("button",{type:"button",onClick:B,className:"underline decoration-dotted hover:text-slate-700",children:"Download Original"}),T.jsx("span",{className:"text-slate-300",children:""}),T.jsx("button",{type:"button",onClick:k,disabled:!m,className:`underline decoration-dotted ${m?"hover:text-slate-700":"text-slate-300 cursor-not-allowed"}`,children:"Copy checksum"})]})]}),T.jsx(qU,{isOpen:t})]}),t&&T.jsxs("div",{className:"flex flex-col h-full p-4 pt-0",children:[y&&T.jsxs("div",{className:"bg-amber-50 text-amber-900 border border-amber-200 rounded-md p-2 text-xs mb-2",children:[T.jsx("p",{className:"font-semibold",children:"Chart Drilldown Active"}),T.jsxs("p",{className:"mt-1",children:[y.label,"  ",y.column," "," ",y.values.map(L=>String(L)).join(", ")]}),T.jsx("p",{className:"mt-1 text-amber-800",children:"Adjust or clear the selection directly on the chart to remove this link."})]}),te.length>0&&T.jsxs("div",{className:"bg-slate-50 text-slate-700 border border-slate-200 rounded-md p-2 text-xs mb-2",children:[T.jsx("p",{className:"font-semibold mb-1",children:"Filter Provenance"}),T.jsx("ul",{className:"space-y-1",children:te.map((L,ne)=>T.jsxs("li",{className:"flex justify-between items-start gap-2",children:[T.jsx("span",{className:"flex-1 text-slate-600",children:L.text}),T.jsx("span",{className:"text-slate-400 whitespace-nowrap",children:VU(L.timestamp)})]},`${L.timestamp}-${ne}`))})]}),T.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[T.jsxs("div",{className:"flex flex-col flex-grow space-y-1",children:[T.jsxs("div",{className:"relative",children:[T.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:T.jsx(OU,{})}),T.jsx("input",{type:"text",placeholder:"Search table or ask AI (e.g., 'show rows where column_3 > 100')",value:A,onChange:L=>C(L.target.value),onKeyDown:Y,className:"bg-white border border-slate-300 rounded-md py-1.5 pl-10 pr-4 text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-1 focus:ring-blue-500 w-full"})]}),T.jsxs("div",{className:"text-xs text-slate-500 flex items-center space-x-3 flex-wrap",children:[T.jsxs("span",{children:["Filtered rows: ",Z.length,"/",e.data.length]}),n&&T.jsxs("button",{type:"button",onClick:c,className:"flex items-center space-x-1 text-blue-600 hover:text-blue-800 underline decoration-dotted",title:"Clear AI filter",children:[T.jsx(a_,{}),T.jsx("span",{children:"AI filter active (click to clear)"})]}),y&&T.jsxs("span",{className:"text-amber-700",children:['Drilldown from "',y.label,'"']})]})]}),T.jsxs("div",{className:"flex items-center space-x-2",children:[T.jsxs("button",{onClick:W,disabled:r||!A.trim(),className:"flex items-center space-x-2 px-3 py-1.5 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:bg-blue-300 disabled:cursor-not-allowed",title:"Use AI to filter data based on your query",children:[r?T.jsx(HU,{}):T.jsx(a_,{}),T.jsx("span",{children:r?"Working":"Ask AI"})]}),r&&T.jsx("button",{type:"button",onClick:f,className:"px-3 py-1.5 border border-slate-300 rounded-md text-slate-600 hover:bg-slate-100 transition-colors",children:"Cancel"})]})]}),a&&T.jsxs("div",{className:"bg-blue-50 text-blue-800 border border-blue-200 rounded-md p-2 text-sm flex justify-between items-center mb-2",children:[T.jsxs("p",{children:[T.jsx("span",{className:"font-semibold",children:"AI Filter:"})," ",a]}),T.jsx("button",{onClick:c,className:"p-1 rounded-full hover:bg-blue-200",title:"Clear AI filter",children:T.jsx(BU,{})})]}),T.jsx("div",{className:"flex-grow overflow-auto border border-slate-200 rounded-md",style:{maxHeight:"60vh"},children:T.jsx(UU,{data:Z,sortConfig:x,onSort:M,columnWidths:I,onColumnResizeStart:z})})]})]}):null},GU=({isOpen:t})=>T.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-6 w-6 transform transition-transform duration-200 ${t?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:T.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),zU=()=>T.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:T.jsx("path",{fillRule:"evenodd",d:"M12.316 3.051a1 1 0 01.633 1.265l-4 12a1 1 0 11-1.898-.632l4-12a1 1 0 011.265-.633zM5.707 6.293a1 1 0 010 1.414L3.414 10l2.293 2.293a1 1 0 11-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0zm8.586 0a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 11-1.414-1.414L16.586 10l-2.293-2.293a1 1 0 010-1.414z",clipRule:"evenodd"})}),$U=({isVisible:t})=>{const{plan:e,originalSample:n,transformedSample:a}=Ue(l=>{var c;return{plan:l.dataPreparationPlan,originalSample:l.initialDataSample,transformedSample:((c=l.csvData)==null?void 0:c.data.slice(0,20))||[]}}),r=()=>Ue.getState().setIsDataPrepDebugVisible(!t);return!e||!n?null:T.jsxs("div",{className:"bg-white rounded-lg shadow-lg flex flex-col transition-all duration-300 border border-slate-200",children:[T.jsxs("button",{onClick:r,className:"flex justify-between items-center p-4 cursor-pointer w-full text-left rounded-t-lg hover:bg-slate-50","aria-expanded":t,children:[T.jsxs("div",{children:[T.jsxs("h3",{className:"text-lg font-bold text-slate-900 flex items-center",children:[T.jsx(zU,{})," AI Data Transformation Log"]}),T.jsx("p",{className:"text-sm text-slate-500",children:"See how the AI cleaned and reshaped your data."})]}),T.jsx(GU,{isOpen:t})]}),t&&T.jsxs("div",{className:"p-4 pt-0 space-y-6",children:[T.jsxs("div",{children:[T.jsx("h4",{className:"font-semibold text-slate-800 mb-2",children:"AI's Plan"}),T.jsxs("p",{className:"text-sm bg-slate-50 p-3 rounded-md border border-slate-200 text-slate-700 italic",children:['"',e.explanation,'"']})]}),T.jsxs("div",{children:[T.jsx("h4",{className:"font-semibold text-slate-800 mb-2",children:"Transformation Code"}),T.jsx("pre",{className:"bg-slate-900 text-slate-100 p-3 rounded-md text-xs overflow-x-auto",children:T.jsx("code",{children:`// AI-generated function to transform data
function transform(data, _util) {
${e.jsFunctionBody}
}`})})]}),T.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[T.jsxs("div",{children:[T.jsx("h4",{className:"font-semibold text-slate-800 mb-2",children:"Data Before (Raw Sample)"}),T.jsx("div",{className:"max-h-64 overflow-y-auto border border-slate-200 rounded-md",children:T.jsx(Yl,{data:n})})]}),T.jsxs("div",{children:[T.jsx("h4",{className:"font-semibold text-slate-800 mb-2",children:"Data After (Transformed Sample)"}),T.jsx("div",{className:"max-h-64 overflow-y-auto border border-slate-200 rounded-md",children:T.jsx(Yl,{data:a})})]})]})]})]})},YU=()=>T.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:T.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),JU=()=>T.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:T.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),KU=()=>T.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:T.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2-2z"})}),jU=Ab(),XU=()=>{const{onNewSession:t,onOpenHistory:e,isAsideVisible:n,onShowAssistant:a}=Ue(r=>({onNewSession:r.handleNewSession,onOpenHistory:()=>{r.loadReportsList(),r.setIsHistoryPanelOpen(!0)},isAsideVisible:r.isAsideVisible,onShowAssistant:()=>r.setIsAsideVisible(!0)}));return T.jsxs("header",{className:"mb-6 flex justify-between items-start flex-shrink-0",children:[T.jsx("div",{className:"max-w-xs",children:T.jsx("h1",{className:"text-xl font-extrabold text-slate-900 leading-tight",children:"CSV Data Analysis Agent"})}),T.jsxs("div",{className:"flex items-center space-x-2",children:[jU.showNewButton&&T.jsxs("button",{onClick:t,className:"flex items-center space-x-2 px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",title:"Start a new analysis session",children:[T.jsx(KU,{}),T.jsx("span",{className:"hidden sm:inline",children:"New"})]}),T.jsxs("button",{onClick:e,className:"flex items-center space-x-2 px-3 py-2 bg-white border border-slate-300 text-slate-700 rounded-md hover:bg-slate-100 transition-colors",title:"View analysis history",children:[T.jsx(JU,{}),T.jsx("span",{className:"hidden sm:inline",children:"History"})]}),!n&&T.jsx("button",{onClick:a,className:"p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors","aria-label":"Show Assistant Panel",title:"Show Assistant Panel",children:T.jsx(YU,{})})]})]})},yf=["persisting","profiling","insight"],QU=(t,e,n)=>{if(t==="insight"){const a=Math.max(e||1,1);return`First insight (${Math.min(Math.max(n||1,1),a)} of ${a})`}return t==="profiling"?"Profiling sample":"Persisting data"},WU=()=>{const t=Ue(n=>n.analysisTimeline);if(t.stage==="idle")return null;const e=Math.max(yf.indexOf(t.stage),0);return T.jsx("div",{className:"bg-white border border-slate-200 rounded-lg px-4 py-3 mb-4 shadow-sm",children:T.jsx("ol",{className:"flex items-center justify-between",children:yf.map((n,a)=>{const r=a<=e,l=QU(n,t.totalCards,t.completedCards);return T.jsxs("li",{className:"flex-1 flex items-center",children:[T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx("div",{className:`w-6 h-6 rounded-full border text-xs flex items-center justify-center ${r?"bg-blue-600 text-white border-blue-600":"bg-white text-slate-400 border-slate-300"}`,children:a+1}),T.jsx("span",{className:`text-sm font-medium ${r?"text-slate-900":"text-slate-400"}`,children:l})]}),a<yf.length-1&&T.jsx("div",{className:`flex-1 h-px mx-3 ${a<e?"bg-blue-300":"bg-slate-200"}`})]},n)})})})},ZU=()=>T.jsxs("svg",{className:"h-4 w-4 text-blue-600 animate-spin",viewBox:"0 0 24 24",fill:"none",role:"status","aria-label":"Loading",children:[T.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),T.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),eO=()=>{const{isBusy:t,busyMessage:e,canCancelBusy:n,requestBusyCancel:a,isCancellationRequested:r}=Ue(l=>({isBusy:l.isBusy,busyMessage:l.busyMessage,canCancelBusy:l.canCancelBusy,requestBusyCancel:l.requestBusyCancel,isCancellationRequested:l.isCancellationRequested}));return t?T.jsxs("div",{className:"mb-4 rounded-lg border border-blue-200 bg-blue-50 px-4 py-3 shadow-sm flex flex-col gap-2 md:flex-row md:items-center md:justify-between",role:"status","aria-live":"polite",children:[T.jsxs("div",{className:"flex items-center gap-3 text-blue-900",children:[T.jsx(ZU,{}),T.jsxs("div",{children:[T.jsx("p",{className:"text-sm font-semibold",children:e||"Running your request"}),r&&T.jsx("p",{className:"text-xs text-blue-700",children:"Cancelling wrapping up safely."})]})]}),n&&T.jsx("button",{type:"button",onClick:a,disabled:r,className:"text-sm font-semibold rounded-md border border-blue-300 px-3 py-1.5 text-blue-700 hover:bg-blue-100 disabled:opacity-60 disabled:cursor-not-allowed",children:r?"Cancelling":"Cancel"})]}):null},tO={info:"bg-slate-800 text-white",success:"bg-emerald-600 text-white",error:"bg-red-600 text-white"},nO=()=>{const{toasts:t,dismissToast:e}=Ue(n=>({toasts:n.toasts,dismissToast:n.dismissToast}));return t.length===0?null:T.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-3 max-w-sm",children:t.map(n=>T.jsxs("div",{className:`flex items-start justify-between rounded-lg shadow-lg px-4 py-3 text-sm ${tO[n.type]}`,children:[T.jsxs("div",{className:"pr-4 space-y-2",children:[T.jsx("p",{children:n.message}),n.actionLabel&&n.onAction&&T.jsx("button",{className:"underline text-white/90 hover:text-white text-xs font-medium",onClick:()=>{var a;(a=n.onAction)==null||a.call(n),e(n.id)},children:n.actionLabel})]}),T.jsx("button",{onClick:()=>e(n.id),className:"text-white/70 hover:text-white text-lg leading-none","aria-label":"Dismiss notification",children:""})]},n.id))})},sO=(t,e,n,a,r)=>{const l=[`${t}  ${e} rows`];return n&&l.push(`${n} removed`),a&&l.push(`${a} added`),r&&l.push(`${r} modified`),l.join("  ")},aO=()=>{const{pendingDataTransform:t,lastAppliedDataTransform:e,isLastAppliedDataTransformBannerDismissed:n,confirmPendingDataTransform:a,discardPendingDataTransform:r,undoLastDataTransform:l,dismissLastAppliedDataTransformBanner:c}=Ue(p=>({pendingDataTransform:p.pendingDataTransform,lastAppliedDataTransform:p.lastAppliedDataTransform,isLastAppliedDataTransformBannerDismissed:p.isLastAppliedDataTransformBannerDismissed,confirmPendingDataTransform:p.confirmPendingDataTransform,discardPendingDataTransform:p.discardPendingDataTransform,undoLastDataTransform:p.undoLastDataTransform,dismissLastAppliedDataTransformBanner:p.dismissLastAppliedDataTransformBanner})),f=n?null:e,y=!!f;return!t&&!y?null:T.jsxs("div",{className:"space-y-3 mt-4",children:[t&&T.jsxs("div",{className:"border border-amber-200 bg-amber-50 rounded-md p-4 shadow-sm",children:[T.jsx("p",{className:"text-sm font-semibold text-amber-900",children:"AI Data Change Pending Confirmation"}),T.jsx("p",{className:"text-xs text-amber-900 mt-1",children:t.explanation||"The AI prepared a dataset update."}),T.jsx("p",{className:"text-xs text-amber-800 mt-1",children:sO(t.meta.rowsBefore,t.meta.rowsAfter,t.meta.removedRows,t.meta.addedRows,t.meta.modifiedRows)}),t.previewRows.length>0&&T.jsx("pre",{className:"bg-white text-amber-900 text-xs rounded-md mt-2 p-2 overflow-auto max-h-40 border border-amber-200",children:JSON.stringify(t.previewRows.slice(0,2),null,2)}),T.jsxs("div",{className:"flex flex-wrap gap-2 mt-3",children:[T.jsx("button",{onClick:a,className:"px-3 py-1.5 bg-amber-600 text-white rounded-md text-sm hover:bg-amber-700 transition-colors",children:"Apply Change"}),T.jsx("button",{onClick:r,className:"px-3 py-1.5 border border-amber-400 text-amber-900 rounded-md text-sm hover:bg-amber-100 transition-colors",children:"Discard"})]})]}),y&&T.jsx("div",{className:"border border-emerald-200 bg-emerald-50 rounded-md p-3",children:T.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[T.jsxs("div",{children:[T.jsx("p",{className:"text-sm font-semibold text-emerald-900",children:"Last Applied AI Change"}),T.jsx("p",{className:"text-xs text-emerald-800 mt-1",children:f.summary})]}),T.jsxs("div",{className:"flex items-center gap-2 self-start sm:self-auto",children:[T.jsx("button",{onClick:l,className:"px-3 py-1.5 border border-emerald-400 text-emerald-900 rounded-md text-sm hover:bg-emerald-100 transition-colors",children:"Undo Change"}),T.jsx("button",{type:"button",onClick:c,"aria-label":"Dismiss last applied AI change",className:"p-1.5 rounded-full text-emerald-700 hover:text-emerald-900 hover:bg-emerald-100 transition-colors",children:T.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-4 h-4","aria-hidden":"true",children:T.jsx("path",{fillRule:"evenodd",d:"M5.22 5.22a.75.75 0 0 1 1.06 0L10 8.94l3.72-3.72a.75.75 0 1 1 1.06 1.06L11.06 10l3.72 3.72a.75.75 0 1 1-1.06 1.06L10 11.06l-3.72 3.72a.75.75 0 1 1-1.06-1.06L8.94 10 5.22 6.28a.75.75 0 0 1 0-1.06Z",clipRule:"evenodd"})})})]})]})})]})},iO=()=>{const{init:t,currentView:e,csvData:n,isAsideVisible:a,asideWidth:r,isResizing:l,handleAsideMouseDown:c,isDataPrepDebugVisible:f,isSpreadsheetVisible:y,dataPreparationPlan:p,initialDataSample:m}=Ue(w=>({init:w.init,currentView:w.currentView,csvData:w.csvData,isAsideVisible:w.isAsideVisible,asideWidth:w.asideWidth,isResizing:w.isResizing,handleAsideMouseDown:w.handleAsideMouseDown,isDataPrepDebugVisible:w.isDataPrepDebugVisible,isSpreadsheetVisible:w.isSpreadsheetVisible,dataPreparationPlan:w.dataPreparationPlan,initialDataSample:w.initialDataSample})),v=Ue(w=>w.setIsAsideVisible),_=Ue(w=>w.handleExternalCsvPayload);ue.useEffect(()=>{t()},[t]),ue.useEffect(()=>{const w=N=>{!N||typeof N.csv!="string"||_(N).catch(I=>{console.error("Failed to process external CSV payload.",I)})},A=()=>{if(typeof window>"u"||typeof window.__getNextCsvPayload!="function")return;let N;do N=window.__getNextCsvPayload(),N&&w(N);while(N)},C=N=>{w(N.detail||null)};return A(),window.addEventListener("ai-table-csv",C),()=>{window.removeEventListener("ai-table-csv",C)}},[_]);const x=()=>e==="file_upload"||!n?T.jsx("div",{className:"flex-grow min-h-0",children:T.jsx(AU,{})}):T.jsxs("div",{className:"flex-grow min-h-0 overflow-y-auto",children:[T.jsx(Yk,{}),p&&p.jsFunctionBody&&m&&T.jsx("div",{className:"mt-8",children:T.jsx($U,{isVisible:f})}),T.jsx("div",{className:"mt-8",children:T.jsx(FU,{isVisible:y})})]});return T.jsxs("div",{className:"flex flex-col md:flex-row h-screen bg-slate-50 text-slate-800 font-sans",children:[T.jsx(EU,{}),T.jsx(RU,{}),T.jsx(LU,{}),T.jsx(nO,{}),T.jsxs("main",{className:"flex-1 overflow-hidden p-4 flex flex-col",children:[T.jsx(XU,{}),T.jsx(WU,{}),T.jsx(eO,{}),T.jsx(aO,{}),x()]}),a&&T.jsxs(T.Fragment,{children:[T.jsx("div",{onMouseDown:c,onDoubleClick:()=>v(!1),className:"hidden md:flex group items-center justify-center w-2.5 cursor-col-resize",title:"Drag to resize, double-click to hide",children:T.jsx("div",{className:`w-0.5 h-8 bg-slate-300 rounded-full transition-colors duration-200 group-hover:bg-brand-secondary ${l?"!bg-blue-600":""}`})}),T.jsx("aside",{className:"w-full md:w-auto bg-white flex flex-col h-full border-l border-slate-200",style:{width:r},children:T.jsx("div",{className:"flex-1 overflow-hidden flex flex-col",children:T.jsx(mU,{})})})]})]})},lx=document.getElementById("root");if(!lx)throw new Error("Could not find root element to mount to");const rO=Lw.createRoot(lx);rO.render(T.jsx(bn.StrictMode,{children:T.jsx(iO,{})}));
