class su{constructor(){this.nodes=new Map,this.edges=new Map,this.entryPoint=null}addNode(e,n){return this.nodes.set(e,n),this}addEdge(e,n){return this.edges.set(e,n),this}setEntryPoint(e){return this.entryPoint=e,this}build(){if(!this.entryPoint)throw new Error("LangGraphBuilder requires an entry point via setEntryPoint().");return new iu(this.entryPoint,this.nodes,this.edges)}}class iu{constructor(e,n,s){this.entryPoint=e,this.nodes=n,this.edges=s}async invoke(e){var u;let n=this.entryPoint,s=e.state;const i=[];let r=!1,a=n;for(;n;){const d=this.nodes.get(n);if(!d)throw new Error(`LangGraphMachine missing node handler for "${n}".`);const c=await d({state:s,payload:e.payload});if(s=c.state,(u=c.actions)!=null&&u.length&&i.push(...c.actions),a=c.label??n,c.halted){r=!0;break}n=this.edges.get(n)}return{state:s,actions:i,halted:r,label:a??"complete"}}}const ru="0.1.0",ou="context_ready",au=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`session-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,lu=(t,e)=>{const n=new Date().toISOString(),s={sessionId:au(),planId:null,stateTag:ou,phase:"observe",awaitingUser:!1,awaitPrompt:null,awaitPromptId:null,pendingUserReply:null,pendingPlan:null,pendingVerification:null,steps:[],currentStepId:null,blockedBy:null,observations:[],viewIds:[],warnings:[],loopBudget:{maxActs:3,actsUsed:0,exceeded:!1},updatedAt:n};return{...s,...e,steps:s.steps,observations:s.observations,viewIds:s.viewIds,warnings:s.warnings,loopBudget:s.loopBudget,phase:s.phase}},uu=["ready","in_progress","done"],jo=t=>t?["context_ready","awaiting_clarification","needs_clarification"].includes(t)?!0:/^\d{5,}-\d+$/.test(t)||/^ts[0-9a-z]{2,}-[0-9a-z_-]+$/i.test(t):!1,cu=t=>{if(!Array.isArray(t))return[];const e=new Set,n=[];return t.forEach(s=>{const i=typeof(s==null?void 0:s.id)=="string"?s.id.trim():"",r=typeof(s==null?void 0:s.label)=="string"?s.label.trim():"",a=typeof(s==null?void 0:s.intent)=="string"?s.intent.trim():"conversation";if(i.length<3||r.length<3||e.has(i))return;const u=uu.includes(s.status)?s.status:"ready";n.push({id:i,label:r,intent:a,status:u}),e.add(i)}),n},du=(t,e)=>{var r;if(!e)return t;const n=cu(e.steps??e.nextSteps),s=typeof e.currentStepId=="string"&&e.currentStepId.trim().length>=3?e.currentStepId.trim():((r=n[0])==null?void 0:r.id)??t.currentStepId,i=typeof e.planId=="string"&&e.planId.trim().length>=3?e.planId.trim():t.planId;return{...t,planId:i,steps:n,currentStepId:s,blockedBy:e.blockedBy??t.blockedBy,stateTag:e.stateTag&&jo(e.stateTag)?e.stateTag:t.stateTag,updatedAt:new Date().toISOString(),awaitPrompt:t.awaitPrompt,awaitPromptId:t.awaitPromptId,pendingUserReply:t.pendingUserReply,phase:t.phase,loopBudget:t.loopBudget}},Di=t=>t?jo(t):!1,fu=["text_response","await_user","dom_action","execute_js_code","proceed_to_analysis","filter_spreadsheet","clarification_request"],ea=(t,e)=>{if(!Array.isArray(e)||e.length===0)return{ok:!0,nextState:t,acceptedActions:[]};if(t.awaitingUser)return Le("awaiting_user","Graph is waiting for user input; no actions can run.",t);if(e.length>2)return Le("turn_budget_exceeded","Each turn may include at most 2 actions.",t);const n=e[0];if(n.responseType!=="plan_state_update")return Le("first_action_plan_required","First action must be plan_state_update.",t);if(!Di(n.stateTag))return Le("invalid_state_tag","plan_state_update is missing a valid stateTag.",t);if(!n.planState)return Le("missing_plan_state","plan_state_update is missing planState payload.",t);const s=e[1];if(s){if(s.responseType==="plan_state_update")return Le("atomic_type_invalid","Second action must be atomic, not plan_state_update.",t);if(!fu.includes(s.responseType))return Le("atomic_type_invalid",`Atomic action ${s.responseType} is not permitted in this turn.`,t);if(!Di(s.stateTag))return Le("invalid_state_tag","Atomic action is missing a valid stateTag.",t)}return{ok:!0,nextState:pu(t,n,s),acceptedActions:e}},pu=(t,e,n)=>{var r,a,u,d,c,f;let s=du(t,e.planState);return s={...s,stateTag:e.stateTag??s.stateTag,updatedAt:new Date().toISOString()},!!((r=e.meta)!=null&&r.awaitUser)||((a=e.planState)==null?void 0:a.blockedBy)==="awaiting_user_choice"||!!((u=n==null?void 0:n.meta)!=null&&u.awaitUser)||(n==null?void 0:n.responseType)==="await_user"?s={...s,awaitingUser:!0,blockedBy:((d=e.planState)==null?void 0:d.blockedBy)??(n==null?void 0:n.reason)??"awaiting_user_choice",awaitPrompt:(n==null?void 0:n.awaitUserPayload)??s.awaitPrompt,awaitPromptId:((c=n==null?void 0:n.awaitUserPayload)==null?void 0:c.promptId)??s.awaitPromptId}:s={...s,awaitingUser:!1,blockedBy:((f=e.planState)==null?void 0:f.blockedBy)??null,awaitPrompt:null,awaitPromptId:null},s},Le=(t,e,n)=>({ok:!1,violations:[{code:t,message:e}],nextState:n}),hu=t=>lu(),mu=({state:t})=>({state:{...t,phase:"observe",updatedAt:new Date().toISOString()},actions:[],label:"observe"});/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let gu,yu;function _u(){return{geminiUrl:gu,vertexUrl:yu}}function Tu(t,e,n,s){var i,r;if(!(t!=null&&t.baseUrl)){const a=_u();return e?(i=a.vertexUrl)!==null&&i!==void 0?i:n:(r=a.geminiUrl)!==null&&r!==void 0?r:s}return t.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class De{}function A(t,e){const n=/\{([^}]+)\}/g;return t.replace(n,(s,i)=>{if(Object.prototype.hasOwnProperty.call(e,i)){const r=e[i];return r!=null?String(r):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function l(t,e,n){for(let r=0;r<e.length-1;r++){const a=e[r];if(a.endsWith("[]")){const u=a.slice(0,-2);if(!(u in t))if(Array.isArray(n))t[u]=Array.from({length:n.length},()=>({}));else throw new Error(`Value must be a list given an array path ${a}`);if(Array.isArray(t[u])){const d=t[u];if(Array.isArray(n))for(let c=0;c<d.length;c++){const f=d[c];l(f,e.slice(r+1),n[c])}else for(const c of d)l(c,e.slice(r+1),n)}return}else if(a.endsWith("[0]")){const u=a.slice(0,-3);u in t||(t[u]=[{}]);const d=t[u];l(d[0],e.slice(r+1),n);return}(!t[a]||typeof t[a]!="object")&&(t[a]={}),t=t[a]}const s=e[e.length-1],i=t[s];if(i!==void 0){if(!n||typeof n=="object"&&Object.keys(n).length===0||n===i)return;if(typeof i=="object"&&typeof n=="object"&&i!==null&&n!==null)Object.assign(i,n);else throw new Error(`Cannot set value for an existing key. Key: ${s}`)}else s==="_self"&&typeof n=="object"&&n!==null&&!Array.isArray(n)?Object.assign(t,n):t[s]=n}function o(t,e,n=void 0){try{if(e.length===1&&e[0]==="_self")return t;for(let s=0;s<e.length;s++){if(typeof t!="object"||t===null)return n;const i=e[s];if(i.endsWith("[]")){const r=i.slice(0,-2);if(r in t){const a=t[r];return Array.isArray(a)?a.map(u=>o(u,e.slice(s+1),n)):n}else return n}else t=t[i]}return t}catch(s){if(s instanceof TypeError)return n;throw s}}function vu(t,e){for(const[n,s]of Object.entries(e)){const i=n.split("."),r=s.split("."),a=new Set;let u=-1;for(let d=0;d<i.length;d++)if(i[d]==="*"){u=d;break}if(u!==-1&&r.length>u)for(let d=u;d<r.length;d++){const c=r[d];c!=="*"&&!c.endsWith("[]")&&!c.endsWith("[0]")&&a.add(c)}us(t,i,r,0,a)}}function us(t,e,n,s,i){if(s>=e.length||typeof t!="object"||t===null)return;const r=e[s];if(r.endsWith("[]")){const a=r.slice(0,-2),u=t;if(a in u&&Array.isArray(u[a]))for(const d of u[a])us(d,e,n,s+1,i)}else if(r==="*"){if(typeof t=="object"&&t!==null&&!Array.isArray(t)){const a=t,u=Object.keys(a).filter(c=>!c.startsWith("_")&&!i.has(c)),d={};for(const c of u)d[c]=a[c];for(const[c,f]of Object.entries(d)){const p=[];for(const h of n.slice(s))h==="*"?p.push(c):p.push(h);l(a,p,f)}for(const c of u)delete a[c]}}else{const a=t;r in a&&us(a[r],e,n,s+1,i)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Gs(t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Su(t){const e={},n=o(t,["operationName"]);n!=null&&l(e,["operationName"],n);const s=o(t,["resourceName"]);return s!=null&&l(e,["_url","resourceName"],s),e}function Cu(t){const e={},n=o(t,["name"]);n!=null&&l(e,["name"],n);const s=o(t,["metadata"]);s!=null&&l(e,["metadata"],s);const i=o(t,["done"]);i!=null&&l(e,["done"],i);const r=o(t,["error"]);r!=null&&l(e,["error"],r);const a=o(t,["response","generateVideoResponse"]);return a!=null&&l(e,["response"],wu(a)),e}function Eu(t){const e={},n=o(t,["name"]);n!=null&&l(e,["name"],n);const s=o(t,["metadata"]);s!=null&&l(e,["metadata"],s);const i=o(t,["done"]);i!=null&&l(e,["done"],i);const r=o(t,["error"]);r!=null&&l(e,["error"],r);const a=o(t,["response"]);return a!=null&&l(e,["response"],Iu(a)),e}function wu(t){const e={},n=o(t,["generatedSamples"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>Au(a))),l(e,["generatedVideos"],r)}const s=o(t,["raiMediaFilteredCount"]);s!=null&&l(e,["raiMediaFilteredCount"],s);const i=o(t,["raiMediaFilteredReasons"]);return i!=null&&l(e,["raiMediaFilteredReasons"],i),e}function Iu(t){const e={},n=o(t,["videos"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>Ru(a))),l(e,["generatedVideos"],r)}const s=o(t,["raiMediaFilteredCount"]);s!=null&&l(e,["raiMediaFilteredCount"],s);const i=o(t,["raiMediaFilteredReasons"]);return i!=null&&l(e,["raiMediaFilteredReasons"],i),e}function Au(t){const e={},n=o(t,["video"]);return n!=null&&l(e,["video"],bu(n)),e}function Ru(t){const e={},n=o(t,["_self"]);return n!=null&&l(e,["video"],Du(n)),e}function Pu(t){const e={},n=o(t,["operationName"]);return n!=null&&l(e,["_url","operationName"],n),e}function xu(t){const e={},n=o(t,["operationName"]);return n!=null&&l(e,["_url","operationName"],n),e}function Nu(t){const e={},n=o(t,["name"]);n!=null&&l(e,["name"],n);const s=o(t,["metadata"]);s!=null&&l(e,["metadata"],s);const i=o(t,["done"]);i!=null&&l(e,["done"],i);const r=o(t,["error"]);r!=null&&l(e,["error"],r);const a=o(t,["response"]);return a!=null&&l(e,["response"],Mu(a)),e}function Mu(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["parent"]);s!=null&&l(e,["parent"],s);const i=o(t,["documentName"]);return i!=null&&l(e,["documentName"],i),e}function ta(t){const e={},n=o(t,["name"]);n!=null&&l(e,["name"],n);const s=o(t,["metadata"]);s!=null&&l(e,["metadata"],s);const i=o(t,["done"]);i!=null&&l(e,["done"],i);const r=o(t,["error"]);r!=null&&l(e,["error"],r);const a=o(t,["response"]);return a!=null&&l(e,["response"],ku(a)),e}function ku(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["parent"]);s!=null&&l(e,["parent"],s);const i=o(t,["documentName"]);return i!=null&&l(e,["documentName"],i),e}function bu(t){const e={},n=o(t,["uri"]);n!=null&&l(e,["uri"],n);const s=o(t,["encodedVideo"]);s!=null&&l(e,["videoBytes"],Gs(s));const i=o(t,["encoding"]);return i!=null&&l(e,["mimeType"],i),e}function Du(t){const e={},n=o(t,["gcsUri"]);n!=null&&l(e,["uri"],n);const s=o(t,["bytesBase64Encoded"]);s!=null&&l(e,["videoBytes"],Gs(s));const i=o(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Ui;(function(t){t.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",t.OUTCOME_OK="OUTCOME_OK",t.OUTCOME_FAILED="OUTCOME_FAILED",t.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(Ui||(Ui={}));var Li;(function(t){t.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",t.PYTHON="PYTHON"})(Li||(Li={}));var Fi;(function(t){t.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",t.SILENT="SILENT",t.WHEN_IDLE="WHEN_IDLE",t.INTERRUPT="INTERRUPT"})(Fi||(Fi={}));var y;(function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.STRING="STRING",t.NUMBER="NUMBER",t.INTEGER="INTEGER",t.BOOLEAN="BOOLEAN",t.ARRAY="ARRAY",t.OBJECT="OBJECT",t.NULL="NULL"})(y||(y={}));var $i;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})($i||($i={}));var Gi;(function(t){t.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",t.SIMPLE_SEARCH="SIMPLE_SEARCH",t.ELASTIC_SEARCH="ELASTIC_SEARCH"})(Gi||(Gi={}));var Vi;(function(t){t.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",t.NO_AUTH="NO_AUTH",t.API_KEY_AUTH="API_KEY_AUTH",t.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",t.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",t.OAUTH="OAUTH",t.OIDC_AUTH="OIDC_AUTH"})(Vi||(Vi={}));var qi;(function(t){t.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",t.HTTP_IN_QUERY="HTTP_IN_QUERY",t.HTTP_IN_HEADER="HTTP_IN_HEADER",t.HTTP_IN_PATH="HTTP_IN_PATH",t.HTTP_IN_BODY="HTTP_IN_BODY",t.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(qi||(qi={}));var Bi;(function(t){t.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",t.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",t.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",t.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(Bi||(Bi={}));var Oi;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",t.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",t.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",t.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",t.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(Oi||(Oi={}));var Hi;(function(t){t.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",t.SEVERITY="SEVERITY",t.PROBABILITY="PROBABILITY"})(Hi||(Hi={}));var Ji;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE",t.OFF="OFF"})(Ji||(Ji={}));var Wi;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.IMAGE_SAFETY="IMAGE_SAFETY",t.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",t.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",t.NO_IMAGE="NO_IMAGE"})(Wi||(Wi={}));var Yi;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(Yi||(Yi={}));var Ki;(function(t){t.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",t.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",t.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",t.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",t.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(Ki||(Ki={}));var zi;(function(t){t.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",t.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",t.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",t.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",t.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(zi||(zi={}));var Zi;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.IMAGE_SAFETY="IMAGE_SAFETY",t.MODEL_ARMOR="MODEL_ARMOR",t.JAILBREAK="JAILBREAK"})(Zi||(Zi={}));var Xi;(function(t){t.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",t.ON_DEMAND="ON_DEMAND",t.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(Xi||(Xi={}));var yn;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.AUDIO="AUDIO"})(yn||(yn={}));var Qi;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(Qi||(Qi={}));var ji;(function(t){t.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",t.TUNING_MODE_FULL="TUNING_MODE_FULL",t.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(ji||(ji={}));var er;(function(t){t.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",t.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",t.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",t.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",t.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",t.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",t.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(er||(er={}));var cs;(function(t){t.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",t.JOB_STATE_QUEUED="JOB_STATE_QUEUED",t.JOB_STATE_PENDING="JOB_STATE_PENDING",t.JOB_STATE_RUNNING="JOB_STATE_RUNNING",t.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",t.JOB_STATE_FAILED="JOB_STATE_FAILED",t.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",t.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",t.JOB_STATE_PAUSED="JOB_STATE_PAUSED",t.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",t.JOB_STATE_UPDATING="JOB_STATE_UPDATING",t.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(cs||(cs={}));var tr;(function(t){t.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",t.TUNING_TASK_I2V="TUNING_TASK_I2V",t.TUNING_TASK_T2V="TUNING_TASK_T2V",t.TUNING_TASK_R2V="TUNING_TASK_R2V"})(tr||(tr={}));var nr;(function(t){t.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",t.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",t.BALANCED="BALANCED",t.PRIORITIZE_COST="PRIORITIZE_COST"})(nr||(nr={}));var sr;(function(t){t.UNSPECIFIED="UNSPECIFIED",t.BLOCKING="BLOCKING",t.NON_BLOCKING="NON_BLOCKING"})(sr||(sr={}));var ir;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(ir||(ir={}));var rr;(function(t){t.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",t.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(rr||(rr={}));var or;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE",t.VALIDATED="VALIDATED"})(or||(or={}));var ar;(function(t){t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(ar||(ar={}));var lr;(function(t){t.DONT_ALLOW="DONT_ALLOW",t.ALLOW_ADULT="ALLOW_ADULT",t.ALLOW_ALL="ALLOW_ALL"})(lr||(lr={}));var ur;(function(t){t.auto="auto",t.en="en",t.ja="ja",t.ko="ko",t.hi="hi",t.zh="zh",t.pt="pt",t.es="es"})(ur||(ur={}));var cr;(function(t){t.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",t.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",t.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",t.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",t.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(cr||(cr={}));var dr;(function(t){t.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",t.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",t.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",t.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(dr||(dr={}));var fr;(function(t){t.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",t.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",t.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",t.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(fr||(fr={}));var pr;(function(t){t.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",t.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",t.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",t.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",t.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",t.EDIT_MODE_STYLE="EDIT_MODE_STYLE",t.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",t.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(pr||(pr={}));var hr;(function(t){t.FOREGROUND="FOREGROUND",t.BACKGROUND="BACKGROUND",t.PROMPT="PROMPT",t.SEMANTIC="SEMANTIC",t.INTERACTIVE="INTERACTIVE"})(hr||(hr={}));var mr;(function(t){t.ASSET="ASSET",t.STYLE="STYLE"})(mr||(mr={}));var gr;(function(t){t.INSERT="INSERT",t.REMOVE="REMOVE",t.REMOVE_STATIC="REMOVE_STATIC",t.OUTPAINT="OUTPAINT"})(gr||(gr={}));var yr;(function(t){t.OPTIMIZED="OPTIMIZED",t.LOSSLESS="LOSSLESS"})(yr||(yr={}));var _r;(function(t){t.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",t.PREFERENCE_TUNING="PREFERENCE_TUNING"})(_r||(_r={}));var Tr;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.STATE_PENDING="STATE_PENDING",t.STATE_ACTIVE="STATE_ACTIVE",t.STATE_FAILED="STATE_FAILED"})(Tr||(Tr={}));var vr;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.PROCESSING="PROCESSING",t.ACTIVE="ACTIVE",t.FAILED="FAILED"})(vr||(vr={}));var Sr;(function(t){t.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",t.UPLOADED="UPLOADED",t.GENERATED="GENERATED"})(Sr||(Sr={}));var Cr;(function(t){t.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.RESPONSE_REJECTED="RESPONSE_REJECTED",t.NEED_MORE_INPUT="NEED_MORE_INPUT"})(Cr||(Cr={}));var Er;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.VIDEO="VIDEO",t.AUDIO="AUDIO",t.DOCUMENT="DOCUMENT"})(Er||(Er={}));var wr;(function(t){t.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",t.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",t.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(wr||(wr={}));var Ir;(function(t){t.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",t.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",t.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(Ir||(Ir={}));var Ar;(function(t){t.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",t.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",t.NO_INTERRUPTION="NO_INTERRUPTION"})(Ar||(Ar={}));var Rr;(function(t){t.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",t.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",t.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(Rr||(Rr={}));var Pr;(function(t){t.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",t.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",t.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",t.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",t.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",t.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",t.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",t.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",t.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",t.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",t.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",t.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",t.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(Pr||(Pr={}));var xr;(function(t){t.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",t.QUALITY="QUALITY",t.DIVERSITY="DIVERSITY",t.VOCALIZATION="VOCALIZATION"})(xr||(xr={}));var ct;(function(t){t.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",t.PLAY="PLAY",t.PAUSE="PAUSE",t.STOP="STOP",t.RESET_CONTEXT="RESET_CONTEXT"})(ct||(ct={}));class ds{constructor(e){const n={};for(const s of e.headers.entries())n[s[0]]=s[1];this.headers=n,this.responseInternal=e}json(){return this.responseInternal.json()}}class xt{get text(){var e,n,s,i,r,a,u,d;if(((i=(s=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let c="",f=!1;const p=[];for(const h of(d=(u=(a=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)!==null&&d!==void 0?d:[]){for(const[m,_]of Object.entries(h))m!=="text"&&m!=="thought"&&(_!==null||_!==void 0)&&p.push(m);if(typeof h.text=="string"){if(typeof h.thought=="boolean"&&h.thought)continue;f=!0,c+=h.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),f?c:void 0}get data(){var e,n,s,i,r,a,u,d;if(((i=(s=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let c="";const f=[];for(const p of(d=(u=(a=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)!==null&&d!==void 0?d:[]){for(const[h,m]of Object.entries(p))h!=="inlineData"&&(m!==null||m!==void 0)&&f.push(h);p.inlineData&&typeof p.inlineData.data=="string"&&(c+=atob(p.inlineData.data))}return f.length>0&&console.warn(`there are non-data parts ${f} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),c.length>0?btoa(c):void 0}get functionCalls(){var e,n,s,i,r,a,u,d;if(((i=(s=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const c=(d=(u=(a=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)===null||d===void 0?void 0:d.filter(f=>f.functionCall).map(f=>f.functionCall).filter(f=>f!==void 0);if((c==null?void 0:c.length)!==0)return c}get executableCode(){var e,n,s,i,r,a,u,d,c;if(((i=(s=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const f=(d=(u=(a=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)===null||d===void 0?void 0:d.filter(p=>p.executableCode).map(p=>p.executableCode).filter(p=>p!==void 0);if((f==null?void 0:f.length)!==0)return(c=f==null?void 0:f[0])===null||c===void 0?void 0:c.code}get codeExecutionResult(){var e,n,s,i,r,a,u,d,c;if(((i=(s=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const f=(d=(u=(a=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)===null||d===void 0?void 0:d.filter(p=>p.codeExecutionResult).map(p=>p.codeExecutionResult).filter(p=>p!==void 0);if((f==null?void 0:f.length)!==0)return(c=f==null?void 0:f[0])===null||c===void 0?void 0:c.output}}class Nr{}class Mr{}class Uu{}class Lu{}class Fu{}class $u{}class kr{}class br{}class Dr{}class Gu{}class _n{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const s=new _n;let i;const r=e;return n?i=Eu(r):i=Cu(r),Object.assign(s,i),s}}class Ur{}class Lr{}class Fr{}class Vu{}class qu{}class Bu{}class Vs{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const s=new Vs,r=Nu(e);return Object.assign(s,r),s}}class Ou{}class Hu{}class Ju{}class $r{}class Wu{get text(){var e,n,s;let i="",r=!1;const a=[];for(const u of(s=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&s!==void 0?s:[]){for(const[d,c]of Object.entries(u))d!=="text"&&d!=="thought"&&c!==null&&a.push(d);if(typeof u.text=="string"){if(typeof u.thought=="boolean"&&u.thought)continue;r=!0,i+=u.text}}return a.length>0&&console.warn(`there are non-text parts ${a} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),r?i:void 0}get data(){var e,n,s;let i="";const r=[];for(const a of(s=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&s!==void 0?s:[]){for(const[u,d]of Object.entries(a))u!=="inlineData"&&d!==null&&r.push(u);a.inlineData&&typeof a.inlineData.data=="string"&&(i+=atob(a.inlineData.data))}return r.length>0&&console.warn(`there are non-data parts ${r} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}}class Yu{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class qs{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const s=new qs,r=ta(e);return Object.assign(s,r),s}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Y(t,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(t.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const n=e.split("/",2);return`publishers/${n[0]}/models/${n[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function na(t,e){const n=Y(t,e);return n?n.startsWith("publishers/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}`:n.startsWith("models/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/publishers/google/${n}`:n:""}function sa(t){return Array.isArray(t)?t.map(e=>Tn(e)):[Tn(t)]}function Tn(t){if(typeof t=="object"&&t!==null)return t;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof t}`)}function ia(t){const e=Tn(t);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function ra(t){const e=Tn(t);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Gr(t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function oa(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>Gr(e)):[Gr(t)]}function fs(t){return t!=null&&typeof t=="object"&&"parts"in t&&Array.isArray(t.parts)}function Vr(t){return t!=null&&typeof t=="object"&&"functionCall"in t}function qr(t){return t!=null&&typeof t=="object"&&"functionResponse"in t}function ae(t){if(t==null)throw new Error("ContentUnion is required");return fs(t)?t:{role:"user",parts:oa(t)}}function Bs(t,e){if(!e)return[];if(t.isVertexAI()&&Array.isArray(e))return e.flatMap(n=>{const s=ae(n);return s.parts&&s.parts.length>0&&s.parts[0].text!==void 0?[s.parts[0].text]:[]});if(t.isVertexAI()){const n=ae(e);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]}return Array.isArray(e)?e.map(n=>ae(n)):[ae(e)]}function ye(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t)){if(Vr(t)||qr(t))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[ae(t)]}const e=[],n=[],s=fs(t[0]);for(const i of t){const r=fs(i);if(r!=s)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(r)e.push(i);else{if(Vr(i)||qr(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(i)}}return s||e.push({role:"user",parts:oa(n)}),e}function Ku(t,e){t.includes("null")&&(e.nullable=!0);const n=t.filter(s=>s!=="null");if(n.length===1)e.type=Object.values(y).includes(n[0].toUpperCase())?n[0].toUpperCase():y.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const s of n)e.anyOf.push({type:Object.values(y).includes(s.toUpperCase())?s.toUpperCase():y.TYPE_UNSPECIFIED})}}function ft(t){const e={},n=["items"],s=["anyOf"],i=["properties"];if(t.type&&t.anyOf)throw new Error("type and anyOf cannot be both populated.");const r=t.anyOf;r!=null&&r.length==2&&(r[0].type==="null"?(e.nullable=!0,t=r[1]):r[1].type==="null"&&(e.nullable=!0,t=r[0])),t.type instanceof Array&&Ku(t.type,e);for(const[a,u]of Object.entries(t))if(u!=null)if(a=="type"){if(u==="null")throw new Error("type: null can not be the only possible type for the field.");if(u instanceof Array)continue;e.type=Object.values(y).includes(u.toUpperCase())?u.toUpperCase():y.TYPE_UNSPECIFIED}else if(n.includes(a))e[a]=ft(u);else if(s.includes(a)){const d=[];for(const c of u){if(c.type=="null"){e.nullable=!0;continue}d.push(ft(c))}e[a]=d}else if(i.includes(a)){const d={};for(const[c,f]of Object.entries(u))d[c]=ft(f);e[a]=d}else{if(a==="additionalProperties")continue;e[a]=u}return e}function Os(t){return ft(t)}function Hs(t){if(typeof t=="object")return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function Js(t){if("multiSpeakerVoiceConfig"in t)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return t}function Et(t){if(t.functionDeclarations)for(const e of t.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=ft(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=ft(e.response));return t}function wt(t){if(t==null)throw new Error("tools is required");if(!Array.isArray(t))throw new Error("tools is required and must be an array of Tools");const e=[];for(const n of t)e.push(n);return e}function zu(t,e,n,s=1){const i=!e.startsWith(`${n}/`)&&e.split("/").length===s;return t.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${t.getProject()}/${e}`:e.startsWith(`${n}/`)?`projects/${t.getProject()}/locations/${t.getLocation()}/${e}`:i?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}/${e}`:e:i?`${n}/${e}`:e}function Ue(t,e){if(typeof e!="string")throw new Error("name must be a string");return zu(t,e,"cachedContents")}function aa(t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function Ke(t){return Gs(t)}function Zu(t){return t!=null&&typeof t=="object"&&"name"in t}function Xu(t){return t!=null&&typeof t=="object"&&"video"in t}function Qu(t){return t!=null&&typeof t=="object"&&"uri"in t}function la(t){var e;let n;if(Zu(t)&&(n=t.name),!(Qu(t)&&(n=t.uri,n===void 0))&&!(Xu(t)&&(n=(e=t.video)===null||e===void 0?void 0:e.uri,n===void 0))){if(typeof t=="string"&&(n=t),n===void 0)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){const i=n.split("files/")[1].match(/[a-z0-9]+/);if(i===null)throw new Error(`Could not extract file name from URI ${n}`);n=i[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function ua(t,e){let n;return t.isVertexAI()?n=e?"publishers/google/models":"models":n=e?"models":"tunedModels",n}function ca(t){for(const e of["models","tunedModels","publisherModels"])if(ju(t,e))return t[e];return[]}function ju(t,e){return t!==null&&typeof t=="object"&&e in t}function ec(t,e={}){const n=t,s={name:n.name,description:n.description,parametersJsonSchema:n.inputSchema};return n.outputSchema&&(s.responseJsonSchema=n.outputSchema),e.behavior&&(s.behavior=e.behavior),{functionDeclarations:[s]}}function tc(t,e={}){const n=[],s=new Set;for(const i of t){const r=i.name;if(s.has(r))throw new Error(`Duplicate function name ${r} found in MCP tools. Please ensure function names are unique.`);s.add(r);const a=ec(i,e);a.functionDeclarations&&n.push(...a.functionDeclarations)}return{functionDeclarations:n}}function da(t,e){let n;if(typeof e=="string")if(t.isVertexAI())if(e.startsWith("gs://"))n={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))n={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))n={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(t.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:e}}else n=e;const s=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,i=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(t.isVertexAI()){if(i>0||s!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(s>0||i!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function nc(t){if(typeof t!="string")return t;const e=t;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function fa(t){if(typeof t!="object"||t===null)return{};const e=t,n=e.inlinedResponses;if(typeof n!="object"||n===null)return t;const i=n.inlinedResponses;if(!Array.isArray(i)||i.length===0)return t;let r=!1;for(const a of i){if(typeof a!="object"||a===null)continue;const d=a.response;if(typeof d!="object"||d===null)continue;if(d.embedding!==void 0){r=!0;break}}return r&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),t}function It(t,e){const n=e;if(!t.isVertexAI()){if(/batches\/[^/]+$/.test(n))return n.split("/").pop();throw new Error(`Invalid batch job name: ${n}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(n))return n.split("/").pop();if(/^\d+$/.test(n))return n;throw new Error(`Invalid batch job name: ${n}.`)}function pa(t){const e=t;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function sc(t){const e={},n=o(t,["responsesFile"]);n!=null&&l(e,["fileName"],n);const s=o(t,["inlinedResponses","inlinedResponses"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>Dc(a))),l(e,["inlinedResponses"],r)}const i=o(t,["inlinedEmbedContentResponses","inlinedResponses"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(a=>a)),l(e,["inlinedEmbedContentResponses"],r)}return e}function ic(t){const e={},n=o(t,["predictionsFormat"]);n!=null&&l(e,["format"],n);const s=o(t,["gcsDestination","outputUriPrefix"]);s!=null&&l(e,["gcsUri"],s);const i=o(t,["bigqueryDestination","outputUri"]);return i!=null&&l(e,["bigqueryUri"],i),e}function rc(t){const e={},n=o(t,["format"]);n!=null&&l(e,["predictionsFormat"],n);const s=o(t,["gcsUri"]);s!=null&&l(e,["gcsDestination","outputUriPrefix"],s);const i=o(t,["bigqueryUri"]);if(i!=null&&l(e,["bigqueryDestination","outputUri"],i),o(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(o(t,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(o(t,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function un(t){const e={},n=o(t,["name"]);n!=null&&l(e,["name"],n);const s=o(t,["metadata","displayName"]);s!=null&&l(e,["displayName"],s);const i=o(t,["metadata","state"]);i!=null&&l(e,["state"],pa(i));const r=o(t,["metadata","createTime"]);r!=null&&l(e,["createTime"],r);const a=o(t,["metadata","endTime"]);a!=null&&l(e,["endTime"],a);const u=o(t,["metadata","updateTime"]);u!=null&&l(e,["updateTime"],u);const d=o(t,["metadata","model"]);d!=null&&l(e,["model"],d);const c=o(t,["metadata","output"]);return c!=null&&l(e,["dest"],sc(fa(c))),e}function ps(t){const e={},n=o(t,["name"]);n!=null&&l(e,["name"],n);const s=o(t,["displayName"]);s!=null&&l(e,["displayName"],s);const i=o(t,["state"]);i!=null&&l(e,["state"],pa(i));const r=o(t,["error"]);r!=null&&l(e,["error"],r);const a=o(t,["createTime"]);a!=null&&l(e,["createTime"],a);const u=o(t,["startTime"]);u!=null&&l(e,["startTime"],u);const d=o(t,["endTime"]);d!=null&&l(e,["endTime"],d);const c=o(t,["updateTime"]);c!=null&&l(e,["updateTime"],c);const f=o(t,["model"]);f!=null&&l(e,["model"],f);const p=o(t,["inputConfig"]);p!=null&&l(e,["src"],oc(p));const h=o(t,["outputConfig"]);h!=null&&l(e,["dest"],ic(fa(h)));const m=o(t,["completionStats"]);return m!=null&&l(e,["completionStats"],m),e}function oc(t){const e={},n=o(t,["instancesFormat"]);n!=null&&l(e,["format"],n);const s=o(t,["gcsSource","uris"]);s!=null&&l(e,["gcsUri"],s);const i=o(t,["bigquerySource","inputUri"]);return i!=null&&l(e,["bigqueryUri"],i),e}function ac(t,e){const n={};if(o(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(o(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(o(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const s=o(e,["fileName"]);s!=null&&l(n,["fileName"],s);const i=o(e,["inlinedRequests"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(a=>bc(t,a))),l(n,["requests","requests"],r)}return n}function lc(t){const e={},n=o(t,["format"]);n!=null&&l(e,["instancesFormat"],n);const s=o(t,["gcsUri"]);s!=null&&l(e,["gcsSource","uris"],s);const i=o(t,["bigqueryUri"]);if(i!=null&&l(e,["bigquerySource","inputUri"],i),o(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(o(t,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function uc(t){const e={},n=o(t,["data"]);if(n!=null&&l(e,["data"],n),o(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=o(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function cc(t,e){const n={},s=o(e,["name"]);return s!=null&&l(n,["_url","name"],It(t,s)),n}function dc(t,e){const n={},s=o(e,["name"]);return s!=null&&l(n,["_url","name"],It(t,s)),n}function fc(t){const e={},n=o(t,["content"]);n!=null&&l(e,["content"],n);const s=o(t,["citationMetadata"]);s!=null&&l(e,["citationMetadata"],pc(s));const i=o(t,["tokenCount"]);i!=null&&l(e,["tokenCount"],i);const r=o(t,["finishReason"]);r!=null&&l(e,["finishReason"],r);const a=o(t,["avgLogprobs"]);a!=null&&l(e,["avgLogprobs"],a);const u=o(t,["groundingMetadata"]);u!=null&&l(e,["groundingMetadata"],u);const d=o(t,["index"]);d!=null&&l(e,["index"],d);const c=o(t,["logprobsResult"]);c!=null&&l(e,["logprobsResult"],c);const f=o(t,["safetyRatings"]);if(f!=null){let h=f;Array.isArray(h)&&(h=h.map(m=>m)),l(e,["safetyRatings"],h)}const p=o(t,["urlContextMetadata"]);return p!=null&&l(e,["urlContextMetadata"],p),e}function pc(t){const e={},n=o(t,["citationSources"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(i=>i)),l(e,["citations"],s)}return e}function ha(t){const e={},n=o(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>qc(r))),l(e,["parts"],i)}const s=o(t,["role"]);return s!=null&&l(e,["role"],s),e}function hc(t,e){const n={},s=o(t,["displayName"]);if(e!==void 0&&s!=null&&l(e,["batch","displayName"],s),o(t,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return n}function mc(t,e){const n={},s=o(t,["displayName"]);e!==void 0&&s!=null&&l(e,["displayName"],s);const i=o(t,["dest"]);return e!==void 0&&i!=null&&l(e,["outputConfig"],rc(nc(i))),n}function Br(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["src"]);i!=null&&l(n,["batch","inputConfig"],ac(t,da(t,i)));const r=o(e,["config"]);return r!=null&&hc(r,n),n}function gc(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["model"],Y(t,s));const i=o(e,["src"]);i!=null&&l(n,["inputConfig"],lc(da(t,i)));const r=o(e,["config"]);return r!=null&&mc(r,n),n}function yc(t,e){const n={},s=o(t,["displayName"]);return e!==void 0&&s!=null&&l(e,["batch","displayName"],s),n}function _c(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["src"]);i!=null&&l(n,["batch","inputConfig"],Ic(t,i));const r=o(e,["config"]);return r!=null&&yc(r,n),n}function Tc(t,e){const n={},s=o(e,["name"]);return s!=null&&l(n,["_url","name"],It(t,s)),n}function vc(t,e){const n={},s=o(e,["name"]);return s!=null&&l(n,["_url","name"],It(t,s)),n}function Sc(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["name"]);s!=null&&l(e,["name"],s);const i=o(t,["done"]);i!=null&&l(e,["done"],i);const r=o(t,["error"]);return r!=null&&l(e,["error"],r),e}function Cc(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["name"]);s!=null&&l(e,["name"],s);const i=o(t,["done"]);i!=null&&l(e,["done"],i);const r=o(t,["error"]);return r!=null&&l(e,["error"],r),e}function Ec(t,e){const n={},s=o(e,["contents"]);if(s!=null){let r=Bs(t,s);Array.isArray(r)&&(r=r.map(a=>a)),l(n,["requests[]","request","content"],r)}const i=o(e,["config"]);return i!=null&&(l(n,["_self"],wc(i,n)),vu(n,{"requests[].*":"requests[].request.*"})),n}function wc(t,e){const n={},s=o(t,["taskType"]);e!==void 0&&s!=null&&l(e,["requests[]","taskType"],s);const i=o(t,["title"]);e!==void 0&&i!=null&&l(e,["requests[]","title"],i);const r=o(t,["outputDimensionality"]);if(e!==void 0&&r!=null&&l(e,["requests[]","outputDimensionality"],r),o(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(o(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function Ic(t,e){const n={},s=o(e,["fileName"]);s!=null&&l(n,["file_name"],s);const i=o(e,["inlinedRequests"]);return i!=null&&l(n,["requests"],Ec(t,i)),n}function Ac(t){const e={};if(o(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=o(t,["fileUri"]);n!=null&&l(e,["fileUri"],n);const s=o(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function Rc(t,e,n){const s={},i=o(e,["systemInstruction"]);n!==void 0&&i!=null&&l(n,["systemInstruction"],ha(ae(i)));const r=o(e,["temperature"]);r!=null&&l(s,["temperature"],r);const a=o(e,["topP"]);a!=null&&l(s,["topP"],a);const u=o(e,["topK"]);u!=null&&l(s,["topK"],u);const d=o(e,["candidateCount"]);d!=null&&l(s,["candidateCount"],d);const c=o(e,["maxOutputTokens"]);c!=null&&l(s,["maxOutputTokens"],c);const f=o(e,["stopSequences"]);f!=null&&l(s,["stopSequences"],f);const p=o(e,["responseLogprobs"]);p!=null&&l(s,["responseLogprobs"],p);const h=o(e,["logprobs"]);h!=null&&l(s,["logprobs"],h);const m=o(e,["presencePenalty"]);m!=null&&l(s,["presencePenalty"],m);const _=o(e,["frequencyPenalty"]);_!=null&&l(s,["frequencyPenalty"],_);const g=o(e,["seed"]);g!=null&&l(s,["seed"],g);const T=o(e,["responseMimeType"]);T!=null&&l(s,["responseMimeType"],T);const w=o(e,["responseSchema"]);w!=null&&l(s,["responseSchema"],Os(w));const v=o(e,["responseJsonSchema"]);if(v!=null&&l(s,["responseJsonSchema"],v),o(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(o(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const S=o(e,["safetySettings"]);if(n!==void 0&&S!=null){let O=S;Array.isArray(O)&&(O=O.map(Q=>Bc(Q))),l(n,["safetySettings"],O)}const C=o(e,["tools"]);if(n!==void 0&&C!=null){let O=wt(C);Array.isArray(O)&&(O=O.map(Q=>Oc(Et(Q)))),l(n,["tools"],O)}const N=o(e,["toolConfig"]);if(n!==void 0&&N!=null&&l(n,["toolConfig"],N),o(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const R=o(e,["cachedContent"]);n!==void 0&&R!=null&&l(n,["cachedContent"],Ue(t,R));const I=o(e,["responseModalities"]);I!=null&&l(s,["responseModalities"],I);const q=o(e,["mediaResolution"]);q!=null&&l(s,["mediaResolution"],q);const P=o(e,["speechConfig"]);if(P!=null&&l(s,["speechConfig"],Hs(P)),o(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const M=o(e,["thinkingConfig"]);M!=null&&l(s,["thinkingConfig"],M);const U=o(e,["imageConfig"]);return U!=null&&l(s,["imageConfig"],U),s}function Pc(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["candidates"]);if(s!=null){let d=s;Array.isArray(d)&&(d=d.map(c=>fc(c))),l(e,["candidates"],d)}const i=o(t,["modelVersion"]);i!=null&&l(e,["modelVersion"],i);const r=o(t,["promptFeedback"]);r!=null&&l(e,["promptFeedback"],r);const a=o(t,["responseId"]);a!=null&&l(e,["responseId"],a);const u=o(t,["usageMetadata"]);return u!=null&&l(e,["usageMetadata"],u),e}function xc(t,e){const n={},s=o(e,["name"]);return s!=null&&l(n,["_url","name"],It(t,s)),n}function Nc(t,e){const n={},s=o(e,["name"]);return s!=null&&l(n,["_url","name"],It(t,s)),n}function Mc(t){const e={};if(o(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=o(t,["enableWidget"]);return n!=null&&l(e,["enableWidget"],n),e}function kc(t){const e={};if(o(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(o(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=o(t,["timeRangeFilter"]);return n!=null&&l(e,["timeRangeFilter"],n),e}function bc(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["request","model"],Y(t,s));const i=o(e,["contents"]);if(i!=null){let u=ye(i);Array.isArray(u)&&(u=u.map(d=>ha(d))),l(n,["request","contents"],u)}const r=o(e,["metadata"]);r!=null&&l(n,["metadata"],r);const a=o(e,["config"]);return a!=null&&l(n,["request","generationConfig"],Rc(t,a,o(n,["request"],{}))),n}function Dc(t){const e={},n=o(t,["response"]);n!=null&&l(e,["response"],Pc(n));const s=o(t,["error"]);return s!=null&&l(e,["error"],s),e}function Uc(t,e){const n={},s=o(t,["pageSize"]);e!==void 0&&s!=null&&l(e,["_query","pageSize"],s);const i=o(t,["pageToken"]);if(e!==void 0&&i!=null&&l(e,["_query","pageToken"],i),o(t,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return n}function Lc(t,e){const n={},s=o(t,["pageSize"]);e!==void 0&&s!=null&&l(e,["_query","pageSize"],s);const i=o(t,["pageToken"]);e!==void 0&&i!=null&&l(e,["_query","pageToken"],i);const r=o(t,["filter"]);return e!==void 0&&r!=null&&l(e,["_query","filter"],r),n}function Fc(t){const e={},n=o(t,["config"]);return n!=null&&Uc(n,e),e}function $c(t){const e={},n=o(t,["config"]);return n!=null&&Lc(n,e),e}function Gc(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["nextPageToken"]);s!=null&&l(e,["nextPageToken"],s);const i=o(t,["operations"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(a=>un(a))),l(e,["batchJobs"],r)}return e}function Vc(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["nextPageToken"]);s!=null&&l(e,["nextPageToken"],s);const i=o(t,["batchPredictionJobs"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(a=>ps(a))),l(e,["batchJobs"],r)}return e}function qc(t){const e={},n=o(t,["functionCall"]);n!=null&&l(e,["functionCall"],n);const s=o(t,["codeExecutionResult"]);s!=null&&l(e,["codeExecutionResult"],s);const i=o(t,["executableCode"]);i!=null&&l(e,["executableCode"],i);const r=o(t,["fileData"]);r!=null&&l(e,["fileData"],Ac(r));const a=o(t,["functionResponse"]);a!=null&&l(e,["functionResponse"],a);const u=o(t,["inlineData"]);u!=null&&l(e,["inlineData"],uc(u));const d=o(t,["text"]);d!=null&&l(e,["text"],d);const c=o(t,["thought"]);c!=null&&l(e,["thought"],c);const f=o(t,["thoughtSignature"]);f!=null&&l(e,["thoughtSignature"],f);const p=o(t,["videoMetadata"]);return p!=null&&l(e,["videoMetadata"],p),e}function Bc(t){const e={},n=o(t,["category"]);if(n!=null&&l(e,["category"],n),o(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const s=o(t,["threshold"]);return s!=null&&l(e,["threshold"],s),e}function Oc(t){const e={},n=o(t,["functionDeclarations"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(p=>p)),l(e,["functionDeclarations"],f)}if(o(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=o(t,["googleSearchRetrieval"]);s!=null&&l(e,["googleSearchRetrieval"],s);const i=o(t,["computerUse"]);i!=null&&l(e,["computerUse"],i);const r=o(t,["fileSearch"]);r!=null&&l(e,["fileSearch"],r);const a=o(t,["codeExecution"]);if(a!=null&&l(e,["codeExecution"],a),o(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const u=o(t,["googleMaps"]);u!=null&&l(e,["googleMaps"],Mc(u));const d=o(t,["googleSearch"]);d!=null&&l(e,["googleSearch"],kc(d));const c=o(t,["urlContext"]);return c!=null&&l(e,["urlContext"],c),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var ke;(function(t){t.PAGED_ITEM_BATCH_JOBS="batchJobs",t.PAGED_ITEM_MODELS="models",t.PAGED_ITEM_TUNING_JOBS="tuningJobs",t.PAGED_ITEM_FILES="files",t.PAGED_ITEM_CACHED_CONTENTS="cachedContents",t.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",t.PAGED_ITEM_DOCUMENTS="documents"})(ke||(ke={}));class nt{constructor(e,n,s,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=n,this.init(e,s,i)}init(e,n,s){var i,r;this.nameInternal=e,this.pageInternal=n[this.nameInternal]||[],this.sdkHttpResponseInternal=n==null?void 0:n.sdkHttpResponse,this.idxInternal=0;let a={config:{}};!s||Object.keys(s).length===0?a={config:{}}:typeof s=="object"?a=Object.assign({},s):a=s,a.config&&(a.config.pageToken=n.nextPageToken),this.paramsInternal=a,this.pageInternalSize=(r=(i=a.config)===null||i===void 0?void 0:i.pageSize)!==null&&r!==void 0?r:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let Hc=class extends De{constructor(e){super(),this.apiClient=e,this.create=async n=>(this.apiClient.isVertexAI()&&(n.config=this.formatDestination(n.src,n.config)),this.createInternal(n)),this.createEmbeddings=async n=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(n)},this.list=async(n={})=>new nt(ke.PAGED_ITEM_BATCH_JOBS,s=>this.listInternal(s),await this.listInternal(n),n)}createInlinedGenerateContentRequest(e){const n=Br(this.apiClient,e),s=n._url,i=A("{model}:batchGenerateContent",s),u=n.batch.inputConfig.requests,d=u.requests,c=[];for(const f of d){const p=Object.assign({},f);if(p.systemInstruction){const h=p.systemInstruction;delete p.systemInstruction;const m=p.request;m.systemInstruction=h,p.request=m}c.push(p)}return u.requests=c,delete n.config,delete n._url,delete n._query,{path:i,body:n}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,n){const s=n?Object.assign({},n):{},i=Date.now().toString();if(s.displayName||(s.displayName=`genaiBatchJob_${i}`),s.dest===void 0){const r=this.getGcsUri(e),a=this.getBigqueryUri(e);if(r)r.endsWith(".jsonl")?s.dest=`${r.slice(0,-6)}/dest`:s.dest=`${r}_dest_${i}`;else if(a)s.dest=`${a}_dest_${i}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return s}async createInternal(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=gc(this.apiClient,e);return u=A("batchPredictionJobs",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(f=>ps(f))}else{const c=Br(this.apiClient,e);return u=A("{model}:batchGenerateContent",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),a.then(f=>un(f))}}async createEmbeddingsInternal(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=_c(this.apiClient,e);return r=A("{model}:asyncBatchEmbedContent",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>un(d))}}async get(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=Nc(this.apiClient,e);return u=A("batchPredictionJobs/{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(f=>ps(f))}else{const c=xc(this.apiClient,e);return u=A("batches/{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),a.then(f=>un(f))}}async cancel(e){var n,s,i,r;let a="",u={};if(this.apiClient.isVertexAI()){const d=dc(this.apiClient,e);a=A("batchPredictionJobs/{name}:cancel",d._url),u=d._query,delete d._url,delete d._query,await this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}else{const d=cc(this.apiClient,e);a=A("batches/{name}:cancel",d._url),u=d._query,delete d._url,delete d._query,await this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=$c(e);return u=A("batchPredictionJobs",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=Vc(f),h=new $r;return Object.assign(h,p),h})}else{const c=Fc(e);return u=A("batches",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=Gc(f),h=new $r;return Object.assign(h,p),h})}}async delete(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=vc(this.apiClient,e);return u=A("batchPredictionJobs/{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>Cc(f))}else{const c=Tc(this.apiClient,e);return u=A("batches/{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>Sc(f))}}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Jc(t){const e={},n=o(t,["data"]);if(n!=null&&l(e,["data"],n),o(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=o(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function Or(t){const e={},n=o(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>fd(r))),l(e,["parts"],i)}const s=o(t,["role"]);return s!=null&&l(e,["role"],s),e}function Wc(t,e){const n={},s=o(t,["ttl"]);e!==void 0&&s!=null&&l(e,["ttl"],s);const i=o(t,["expireTime"]);e!==void 0&&i!=null&&l(e,["expireTime"],i);const r=o(t,["displayName"]);e!==void 0&&r!=null&&l(e,["displayName"],r);const a=o(t,["contents"]);if(e!==void 0&&a!=null){let f=ye(a);Array.isArray(f)&&(f=f.map(p=>Or(p))),l(e,["contents"],f)}const u=o(t,["systemInstruction"]);e!==void 0&&u!=null&&l(e,["systemInstruction"],Or(ae(u)));const d=o(t,["tools"]);if(e!==void 0&&d!=null){let f=d;Array.isArray(f)&&(f=f.map(p=>pd(p))),l(e,["tools"],f)}const c=o(t,["toolConfig"]);if(e!==void 0&&c!=null&&l(e,["toolConfig"],c),o(t,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return n}function Yc(t,e){const n={},s=o(t,["ttl"]);e!==void 0&&s!=null&&l(e,["ttl"],s);const i=o(t,["expireTime"]);e!==void 0&&i!=null&&l(e,["expireTime"],i);const r=o(t,["displayName"]);e!==void 0&&r!=null&&l(e,["displayName"],r);const a=o(t,["contents"]);if(e!==void 0&&a!=null){let p=ye(a);Array.isArray(p)&&(p=p.map(h=>h)),l(e,["contents"],p)}const u=o(t,["systemInstruction"]);e!==void 0&&u!=null&&l(e,["systemInstruction"],ae(u));const d=o(t,["tools"]);if(e!==void 0&&d!=null){let p=d;Array.isArray(p)&&(p=p.map(h=>hd(h))),l(e,["tools"],p)}const c=o(t,["toolConfig"]);e!==void 0&&c!=null&&l(e,["toolConfig"],c);const f=o(t,["kmsKeyName"]);return e!==void 0&&f!=null&&l(e,["encryption_spec","kmsKeyName"],f),n}function Kc(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["model"],na(t,s));const i=o(e,["config"]);return i!=null&&Wc(i,n),n}function zc(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["model"],na(t,s));const i=o(e,["config"]);return i!=null&&Yc(i,n),n}function Zc(t,e){const n={},s=o(e,["name"]);return s!=null&&l(n,["_url","name"],Ue(t,s)),n}function Xc(t,e){const n={},s=o(e,["name"]);return s!=null&&l(n,["_url","name"],Ue(t,s)),n}function Qc(t){const e={},n=o(t,["sdkHttpResponse"]);return n!=null&&l(e,["sdkHttpResponse"],n),e}function jc(t){const e={},n=o(t,["sdkHttpResponse"]);return n!=null&&l(e,["sdkHttpResponse"],n),e}function ed(t){const e={};if(o(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=o(t,["fileUri"]);n!=null&&l(e,["fileUri"],n);const s=o(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function td(t){const e={};if(o(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=o(t,["description"]);n!=null&&l(e,["description"],n);const s=o(t,["name"]);s!=null&&l(e,["name"],s);const i=o(t,["parameters"]);i!=null&&l(e,["parameters"],i);const r=o(t,["parametersJsonSchema"]);r!=null&&l(e,["parametersJsonSchema"],r);const a=o(t,["response"]);a!=null&&l(e,["response"],a);const u=o(t,["responseJsonSchema"]);return u!=null&&l(e,["responseJsonSchema"],u),e}function nd(t,e){const n={},s=o(e,["name"]);return s!=null&&l(n,["_url","name"],Ue(t,s)),n}function sd(t,e){const n={},s=o(e,["name"]);return s!=null&&l(n,["_url","name"],Ue(t,s)),n}function id(t){const e={};if(o(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=o(t,["enableWidget"]);return n!=null&&l(e,["enableWidget"],n),e}function rd(t){const e={};if(o(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(o(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=o(t,["timeRangeFilter"]);return n!=null&&l(e,["timeRangeFilter"],n),e}function od(t,e){const n={},s=o(t,["pageSize"]);e!==void 0&&s!=null&&l(e,["_query","pageSize"],s);const i=o(t,["pageToken"]);return e!==void 0&&i!=null&&l(e,["_query","pageToken"],i),n}function ad(t,e){const n={},s=o(t,["pageSize"]);e!==void 0&&s!=null&&l(e,["_query","pageSize"],s);const i=o(t,["pageToken"]);return e!==void 0&&i!=null&&l(e,["_query","pageToken"],i),n}function ld(t){const e={},n=o(t,["config"]);return n!=null&&od(n,e),e}function ud(t){const e={},n=o(t,["config"]);return n!=null&&ad(n,e),e}function cd(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["nextPageToken"]);s!=null&&l(e,["nextPageToken"],s);const i=o(t,["cachedContents"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(a=>a)),l(e,["cachedContents"],r)}return e}function dd(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["nextPageToken"]);s!=null&&l(e,["nextPageToken"],s);const i=o(t,["cachedContents"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(a=>a)),l(e,["cachedContents"],r)}return e}function fd(t){const e={},n=o(t,["functionCall"]);n!=null&&l(e,["functionCall"],n);const s=o(t,["codeExecutionResult"]);s!=null&&l(e,["codeExecutionResult"],s);const i=o(t,["executableCode"]);i!=null&&l(e,["executableCode"],i);const r=o(t,["fileData"]);r!=null&&l(e,["fileData"],ed(r));const a=o(t,["functionResponse"]);a!=null&&l(e,["functionResponse"],a);const u=o(t,["inlineData"]);u!=null&&l(e,["inlineData"],Jc(u));const d=o(t,["text"]);d!=null&&l(e,["text"],d);const c=o(t,["thought"]);c!=null&&l(e,["thought"],c);const f=o(t,["thoughtSignature"]);f!=null&&l(e,["thoughtSignature"],f);const p=o(t,["videoMetadata"]);return p!=null&&l(e,["videoMetadata"],p),e}function pd(t){const e={},n=o(t,["functionDeclarations"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(p=>p)),l(e,["functionDeclarations"],f)}if(o(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=o(t,["googleSearchRetrieval"]);s!=null&&l(e,["googleSearchRetrieval"],s);const i=o(t,["computerUse"]);i!=null&&l(e,["computerUse"],i);const r=o(t,["fileSearch"]);r!=null&&l(e,["fileSearch"],r);const a=o(t,["codeExecution"]);if(a!=null&&l(e,["codeExecution"],a),o(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const u=o(t,["googleMaps"]);u!=null&&l(e,["googleMaps"],id(u));const d=o(t,["googleSearch"]);d!=null&&l(e,["googleSearch"],rd(d));const c=o(t,["urlContext"]);return c!=null&&l(e,["urlContext"],c),e}function hd(t){const e={},n=o(t,["functionDeclarations"]);if(n!=null){let p=n;Array.isArray(p)&&(p=p.map(h=>td(h))),l(e,["functionDeclarations"],p)}const s=o(t,["retrieval"]);s!=null&&l(e,["retrieval"],s);const i=o(t,["googleSearchRetrieval"]);i!=null&&l(e,["googleSearchRetrieval"],i);const r=o(t,["computerUse"]);if(r!=null&&l(e,["computerUse"],r),o(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const a=o(t,["codeExecution"]);a!=null&&l(e,["codeExecution"],a);const u=o(t,["enterpriseWebSearch"]);u!=null&&l(e,["enterpriseWebSearch"],u);const d=o(t,["googleMaps"]);d!=null&&l(e,["googleMaps"],d);const c=o(t,["googleSearch"]);c!=null&&l(e,["googleSearch"],c);const f=o(t,["urlContext"]);return f!=null&&l(e,["urlContext"],f),e}function md(t,e){const n={},s=o(t,["ttl"]);e!==void 0&&s!=null&&l(e,["ttl"],s);const i=o(t,["expireTime"]);return e!==void 0&&i!=null&&l(e,["expireTime"],i),n}function gd(t,e){const n={},s=o(t,["ttl"]);e!==void 0&&s!=null&&l(e,["ttl"],s);const i=o(t,["expireTime"]);return e!==void 0&&i!=null&&l(e,["expireTime"],i),n}function yd(t,e){const n={},s=o(e,["name"]);s!=null&&l(n,["_url","name"],Ue(t,s));const i=o(e,["config"]);return i!=null&&md(i,n),n}function _d(t,e){const n={},s=o(e,["name"]);s!=null&&l(n,["_url","name"],Ue(t,s));const i=o(e,["config"]);return i!=null&&gd(i,n),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Td extends De{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new nt(ke.PAGED_ITEM_CACHED_CONTENTS,s=>this.listInternal(s),await this.listInternal(n),n)}async create(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=zc(this.apiClient,e);return u=A("cachedContents",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(f=>f)}else{const c=Kc(this.apiClient,e);return u=A("cachedContents",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),a.then(f=>f)}}async get(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=sd(this.apiClient,e);return u=A("{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(f=>f)}else{const c=nd(this.apiClient,e);return u=A("{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),a.then(f=>f)}}async delete(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=Xc(this.apiClient,e);return u=A("{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=jc(f),h=new Lr;return Object.assign(h,p),h})}else{const c=Zc(this.apiClient,e);return u=A("{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=Qc(f),h=new Lr;return Object.assign(h,p),h})}}async update(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=_d(this.apiClient,e);return u=A("{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(f=>f)}else{const c=yd(this.apiClient,e);return u=A("{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),a.then(f=>f)}}async listInternal(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=ud(e);return u=A("cachedContents",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=dd(f),h=new Fr;return Object.assign(h,p),h})}else{const c=ld(e);return u=A("cachedContents",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=cd(f),h=new Fr;return Object.assign(h,p),h})}}}function Hr(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],s=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function z(t){return this instanceof z?(this.v=t,this):new z(t)}function pt(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=n.apply(t,e||[]),i,r=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",a),i[Symbol.asyncIterator]=function(){return this},i;function a(m){return function(_){return Promise.resolve(_).then(m,p)}}function u(m,_){s[m]&&(i[m]=function(g){return new Promise(function(T,w){r.push([m,g,T,w])>1||d(m,g)})},_&&(i[m]=_(i[m])))}function d(m,_){try{c(s[m](_))}catch(g){h(r[0][3],g)}}function c(m){m.value instanceof z?Promise.resolve(m.value.v).then(f,p):h(r[0][2],m)}function f(m){d("next",m)}function p(m){d("throw",m)}function h(m,_){m(_),r.shift(),r.length&&d(r[0][0],r[0][1])}}function Ft(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Hr=="function"?Hr(t):t[Symbol.iterator](),n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n);function s(r){n[r]=t[r]&&function(a){return new Promise(function(u,d){a=t[r](a),i(u,d,a.done,a.value)})}}function i(r,a,u,d){Promise.resolve(d).then(function(c){r({value:c,done:u})},a)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function vd(t){var e;if(t.candidates==null||t.candidates.length===0)return!1;const n=(e=t.candidates[0])===null||e===void 0?void 0:e.content;return n===void 0?!1:ma(n)}function ma(t){if(t.parts===void 0||t.parts.length===0)return!1;for(const e of t.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function Sd(t){if(t.length!==0){for(const e of t)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function Jr(t){if(t===void 0||t.length===0)return[];const e=[],n=t.length;let s=0;for(;s<n;)if(t[s].role==="user")e.push(t[s]),s++;else{const i=[];let r=!0;for(;s<n&&t[s].role==="model";)i.push(t[s]),r&&!ma(t[s])&&(r=!1),s++;r?e.push(...i):e.pop()}return e}class Cd{constructor(e,n){this.modelsModule=e,this.apiClient=n}create(e){return new Ed(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}let Ed=class{constructor(e,n,s,i={},r=[]){this.apiClient=e,this.modelsModule=n,this.model=s,this.config=i,this.history=r,this.sendPromise=Promise.resolve(),Sd(r)}async sendMessage(e){var n;await this.sendPromise;const s=ae(e.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(s),config:(n=e.config)!==null&&n!==void 0?n:this.config});return this.sendPromise=(async()=>{var r,a,u;const d=await i,c=(a=(r=d.candidates)===null||r===void 0?void 0:r[0])===null||a===void 0?void 0:a.content,f=d.automaticFunctionCallingHistory,p=this.getHistory(!0).length;let h=[];f!=null&&(h=(u=f.slice(p))!==null&&u!==void 0?u:[]);const m=c?[c]:[];this.recordHistory(s,m,h)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),i}async sendMessageStream(e){var n;await this.sendPromise;const s=ae(e.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(s),config:(n=e.config)!==null&&n!==void 0?n:this.config});this.sendPromise=i.then(()=>{}).catch(()=>{});const r=await i;return this.processStreamResponse(r,s)}getHistory(e=!1){const n=e?Jr(this.history):this.history;return structuredClone(n)}processStreamResponse(e,n){var s,i;return pt(this,arguments,function*(){var a,u,d,c;const f=[];try{for(var p=!0,h=Ft(e),m;m=yield z(h.next()),a=m.done,!a;p=!0){c=m.value,p=!1;const _=c;if(vd(_)){const g=(i=(s=_.candidates)===null||s===void 0?void 0:s[0])===null||i===void 0?void 0:i.content;g!==void 0&&f.push(g)}yield yield z(_)}}catch(_){u={error:_}}finally{try{!p&&!a&&(d=h.return)&&(yield z(d.call(h)))}finally{if(u)throw u.error}}this.recordHistory(n,f)})}recordHistory(e,n,s){let i=[];n.length>0&&n.every(r=>r.role!==void 0)?i=n:i.push({role:"model",parts:[]}),s&&s.length>0?this.history.push(...Jr(s)):this.history.push(e),this.history.push(...i)}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Mn extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,Mn.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function wd(t){const e={},n=o(t,["file"]);return n!=null&&l(e,["file"],n),e}function Id(t){const e={},n=o(t,["sdkHttpResponse"]);return n!=null&&l(e,["sdkHttpResponse"],n),e}function Ad(t){const e={},n=o(t,["name"]);return n!=null&&l(e,["_url","file"],la(n)),e}function Rd(t){const e={},n=o(t,["sdkHttpResponse"]);return n!=null&&l(e,["sdkHttpResponse"],n),e}function Pd(t){const e={},n=o(t,["name"]);return n!=null&&l(e,["_url","file"],la(n)),e}function xd(t,e){const n={},s=o(t,["pageSize"]);e!==void 0&&s!=null&&l(e,["_query","pageSize"],s);const i=o(t,["pageToken"]);return e!==void 0&&i!=null&&l(e,["_query","pageToken"],i),n}function Nd(t){const e={},n=o(t,["config"]);return n!=null&&xd(n,e),e}function Md(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["nextPageToken"]);s!=null&&l(e,["nextPageToken"],s);const i=o(t,["files"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(a=>a)),l(e,["files"],r)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let kd=class extends De{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new nt(ke.PAGED_ITEM_FILES,s=>this.listInternal(s),await this.listInternal(n),n)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(n=>n)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Nd(e);return r=A("files",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(c=>{const f=c;return f.sdkHttpResponse={headers:d.headers},f})),i.then(d=>{const c=Md(d),f=new Ou;return Object.assign(f,c),f})}}async createInternal(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=wd(e);return r=A("upload/v1beta/files",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>{const c=Id(d),f=new Hu;return Object.assign(f,c),f})}}async get(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Pd(e);return r=A("files/{file}",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>d)}}async delete(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Ad(e);return r=A("files/{file}",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(c=>{const f=c;return f.sdkHttpResponse={headers:d.headers},f})),i.then(d=>{const c=Rd(d),f=new Ju;return Object.assign(f,c),f})}}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function cn(t){const e={},n=o(t,["data"]);if(n!=null&&l(e,["data"],n),o(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=o(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function bd(t){const e={},n=o(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>Kd(r))),l(e,["parts"],i)}const s=o(t,["role"]);return s!=null&&l(e,["role"],s),e}function Dd(t){const e={};if(o(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=o(t,["fileUri"]);n!=null&&l(e,["fileUri"],n);const s=o(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function Ud(t){const e={};if(o(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=o(t,["description"]);n!=null&&l(e,["description"],n);const s=o(t,["name"]);s!=null&&l(e,["name"],s);const i=o(t,["parameters"]);i!=null&&l(e,["parameters"],i);const r=o(t,["parametersJsonSchema"]);r!=null&&l(e,["parametersJsonSchema"],r);const a=o(t,["response"]);a!=null&&l(e,["response"],a);const u=o(t,["responseJsonSchema"]);return u!=null&&l(e,["responseJsonSchema"],u),e}function Ld(t){const e={},n=o(t,["modelSelectionConfig"]);n!=null&&l(e,["modelConfig"],n);const s=o(t,["responseJsonSchema"]);s!=null&&l(e,["responseJsonSchema"],s);const i=o(t,["audioTimestamp"]);i!=null&&l(e,["audioTimestamp"],i);const r=o(t,["candidateCount"]);r!=null&&l(e,["candidateCount"],r);const a=o(t,["enableAffectiveDialog"]);a!=null&&l(e,["enableAffectiveDialog"],a);const u=o(t,["frequencyPenalty"]);u!=null&&l(e,["frequencyPenalty"],u);const d=o(t,["logprobs"]);d!=null&&l(e,["logprobs"],d);const c=o(t,["maxOutputTokens"]);c!=null&&l(e,["maxOutputTokens"],c);const f=o(t,["mediaResolution"]);f!=null&&l(e,["mediaResolution"],f);const p=o(t,["presencePenalty"]);p!=null&&l(e,["presencePenalty"],p);const h=o(t,["responseLogprobs"]);h!=null&&l(e,["responseLogprobs"],h);const m=o(t,["responseMimeType"]);m!=null&&l(e,["responseMimeType"],m);const _=o(t,["responseModalities"]);_!=null&&l(e,["responseModalities"],_);const g=o(t,["responseSchema"]);g!=null&&l(e,["responseSchema"],g);const T=o(t,["routingConfig"]);T!=null&&l(e,["routingConfig"],T);const w=o(t,["seed"]);w!=null&&l(e,["seed"],w);const v=o(t,["speechConfig"]);v!=null&&l(e,["speechConfig"],ga(v));const S=o(t,["stopSequences"]);S!=null&&l(e,["stopSequences"],S);const C=o(t,["temperature"]);C!=null&&l(e,["temperature"],C);const N=o(t,["thinkingConfig"]);N!=null&&l(e,["thinkingConfig"],N);const R=o(t,["topK"]);R!=null&&l(e,["topK"],R);const I=o(t,["topP"]);if(I!=null&&l(e,["topP"],I),o(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function Fd(t){const e={};if(o(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=o(t,["enableWidget"]);return n!=null&&l(e,["enableWidget"],n),e}function $d(t){const e={};if(o(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(o(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=o(t,["timeRangeFilter"]);return n!=null&&l(e,["timeRangeFilter"],n),e}function Gd(t,e){const n={},s=o(t,["generationConfig"]);e!==void 0&&s!=null&&l(e,["setup","generationConfig"],s);const i=o(t,["responseModalities"]);e!==void 0&&i!=null&&l(e,["setup","generationConfig","responseModalities"],i);const r=o(t,["temperature"]);e!==void 0&&r!=null&&l(e,["setup","generationConfig","temperature"],r);const a=o(t,["topP"]);e!==void 0&&a!=null&&l(e,["setup","generationConfig","topP"],a);const u=o(t,["topK"]);e!==void 0&&u!=null&&l(e,["setup","generationConfig","topK"],u);const d=o(t,["maxOutputTokens"]);e!==void 0&&d!=null&&l(e,["setup","generationConfig","maxOutputTokens"],d);const c=o(t,["mediaResolution"]);e!==void 0&&c!=null&&l(e,["setup","generationConfig","mediaResolution"],c);const f=o(t,["seed"]);e!==void 0&&f!=null&&l(e,["setup","generationConfig","seed"],f);const p=o(t,["speechConfig"]);e!==void 0&&p!=null&&l(e,["setup","generationConfig","speechConfig"],Js(p));const h=o(t,["thinkingConfig"]);e!==void 0&&h!=null&&l(e,["setup","generationConfig","thinkingConfig"],h);const m=o(t,["enableAffectiveDialog"]);e!==void 0&&m!=null&&l(e,["setup","generationConfig","enableAffectiveDialog"],m);const _=o(t,["systemInstruction"]);e!==void 0&&_!=null&&l(e,["setup","systemInstruction"],bd(ae(_)));const g=o(t,["tools"]);if(e!==void 0&&g!=null){let R=wt(g);Array.isArray(R)&&(R=R.map(I=>Zd(Et(I)))),l(e,["setup","tools"],R)}const T=o(t,["sessionResumption"]);e!==void 0&&T!=null&&l(e,["setup","sessionResumption"],zd(T));const w=o(t,["inputAudioTranscription"]);e!==void 0&&w!=null&&l(e,["setup","inputAudioTranscription"],w);const v=o(t,["outputAudioTranscription"]);e!==void 0&&v!=null&&l(e,["setup","outputAudioTranscription"],v);const S=o(t,["realtimeInputConfig"]);e!==void 0&&S!=null&&l(e,["setup","realtimeInputConfig"],S);const C=o(t,["contextWindowCompression"]);e!==void 0&&C!=null&&l(e,["setup","contextWindowCompression"],C);const N=o(t,["proactivity"]);return e!==void 0&&N!=null&&l(e,["setup","proactivity"],N),n}function Vd(t,e){const n={},s=o(t,["generationConfig"]);e!==void 0&&s!=null&&l(e,["setup","generationConfig"],Ld(s));const i=o(t,["responseModalities"]);e!==void 0&&i!=null&&l(e,["setup","generationConfig","responseModalities"],i);const r=o(t,["temperature"]);e!==void 0&&r!=null&&l(e,["setup","generationConfig","temperature"],r);const a=o(t,["topP"]);e!==void 0&&a!=null&&l(e,["setup","generationConfig","topP"],a);const u=o(t,["topK"]);e!==void 0&&u!=null&&l(e,["setup","generationConfig","topK"],u);const d=o(t,["maxOutputTokens"]);e!==void 0&&d!=null&&l(e,["setup","generationConfig","maxOutputTokens"],d);const c=o(t,["mediaResolution"]);e!==void 0&&c!=null&&l(e,["setup","generationConfig","mediaResolution"],c);const f=o(t,["seed"]);e!==void 0&&f!=null&&l(e,["setup","generationConfig","seed"],f);const p=o(t,["speechConfig"]);e!==void 0&&p!=null&&l(e,["setup","generationConfig","speechConfig"],ga(Js(p)));const h=o(t,["thinkingConfig"]);e!==void 0&&h!=null&&l(e,["setup","generationConfig","thinkingConfig"],h);const m=o(t,["enableAffectiveDialog"]);e!==void 0&&m!=null&&l(e,["setup","generationConfig","enableAffectiveDialog"],m);const _=o(t,["systemInstruction"]);e!==void 0&&_!=null&&l(e,["setup","systemInstruction"],ae(_));const g=o(t,["tools"]);if(e!==void 0&&g!=null){let R=wt(g);Array.isArray(R)&&(R=R.map(I=>Xd(Et(I)))),l(e,["setup","tools"],R)}const T=o(t,["sessionResumption"]);e!==void 0&&T!=null&&l(e,["setup","sessionResumption"],T);const w=o(t,["inputAudioTranscription"]);e!==void 0&&w!=null&&l(e,["setup","inputAudioTranscription"],w);const v=o(t,["outputAudioTranscription"]);e!==void 0&&v!=null&&l(e,["setup","outputAudioTranscription"],v);const S=o(t,["realtimeInputConfig"]);e!==void 0&&S!=null&&l(e,["setup","realtimeInputConfig"],S);const C=o(t,["contextWindowCompression"]);e!==void 0&&C!=null&&l(e,["setup","contextWindowCompression"],C);const N=o(t,["proactivity"]);return e!==void 0&&N!=null&&l(e,["setup","proactivity"],N),n}function qd(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["setup","model"],Y(t,s));const i=o(e,["config"]);return i!=null&&l(n,["config"],Gd(i,n)),n}function Bd(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["setup","model"],Y(t,s));const i=o(e,["config"]);return i!=null&&l(n,["config"],Vd(i,n)),n}function Od(t){const e={},n=o(t,["musicGenerationConfig"]);return n!=null&&l(e,["musicGenerationConfig"],n),e}function Hd(t){const e={},n=o(t,["weightedPrompts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(i=>i)),l(e,["weightedPrompts"],s)}return e}function Jd(t){const e={},n=o(t,["media"]);if(n!=null){let c=sa(n);Array.isArray(c)&&(c=c.map(f=>cn(f))),l(e,["mediaChunks"],c)}const s=o(t,["audio"]);s!=null&&l(e,["audio"],cn(ra(s)));const i=o(t,["audioStreamEnd"]);i!=null&&l(e,["audioStreamEnd"],i);const r=o(t,["video"]);r!=null&&l(e,["video"],cn(ia(r)));const a=o(t,["text"]);a!=null&&l(e,["text"],a);const u=o(t,["activityStart"]);u!=null&&l(e,["activityStart"],u);const d=o(t,["activityEnd"]);return d!=null&&l(e,["activityEnd"],d),e}function Wd(t){const e={},n=o(t,["media"]);if(n!=null){let c=sa(n);Array.isArray(c)&&(c=c.map(f=>f)),l(e,["mediaChunks"],c)}const s=o(t,["audio"]);s!=null&&l(e,["audio"],ra(s));const i=o(t,["audioStreamEnd"]);i!=null&&l(e,["audioStreamEnd"],i);const r=o(t,["video"]);r!=null&&l(e,["video"],ia(r));const a=o(t,["text"]);a!=null&&l(e,["text"],a);const u=o(t,["activityStart"]);u!=null&&l(e,["activityStart"],u);const d=o(t,["activityEnd"]);return d!=null&&l(e,["activityEnd"],d),e}function Yd(t){const e={},n=o(t,["setupComplete"]);n!=null&&l(e,["setupComplete"],n);const s=o(t,["serverContent"]);s!=null&&l(e,["serverContent"],s);const i=o(t,["toolCall"]);i!=null&&l(e,["toolCall"],i);const r=o(t,["toolCallCancellation"]);r!=null&&l(e,["toolCallCancellation"],r);const a=o(t,["usageMetadata"]);a!=null&&l(e,["usageMetadata"],Qd(a));const u=o(t,["goAway"]);u!=null&&l(e,["goAway"],u);const d=o(t,["sessionResumptionUpdate"]);return d!=null&&l(e,["sessionResumptionUpdate"],d),e}function Kd(t){const e={},n=o(t,["functionCall"]);n!=null&&l(e,["functionCall"],n);const s=o(t,["codeExecutionResult"]);s!=null&&l(e,["codeExecutionResult"],s);const i=o(t,["executableCode"]);i!=null&&l(e,["executableCode"],i);const r=o(t,["fileData"]);r!=null&&l(e,["fileData"],Dd(r));const a=o(t,["functionResponse"]);a!=null&&l(e,["functionResponse"],a);const u=o(t,["inlineData"]);u!=null&&l(e,["inlineData"],cn(u));const d=o(t,["text"]);d!=null&&l(e,["text"],d);const c=o(t,["thought"]);c!=null&&l(e,["thought"],c);const f=o(t,["thoughtSignature"]);f!=null&&l(e,["thoughtSignature"],f);const p=o(t,["videoMetadata"]);return p!=null&&l(e,["videoMetadata"],p),e}function zd(t){const e={},n=o(t,["handle"]);if(n!=null&&l(e,["handle"],n),o(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function ga(t){const e={},n=o(t,["languageCode"]);n!=null&&l(e,["languageCode"],n);const s=o(t,["voiceConfig"]);if(s!=null&&l(e,["voiceConfig"],s),o(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function Zd(t){const e={},n=o(t,["functionDeclarations"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(p=>p)),l(e,["functionDeclarations"],f)}if(o(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=o(t,["googleSearchRetrieval"]);s!=null&&l(e,["googleSearchRetrieval"],s);const i=o(t,["computerUse"]);i!=null&&l(e,["computerUse"],i);const r=o(t,["fileSearch"]);r!=null&&l(e,["fileSearch"],r);const a=o(t,["codeExecution"]);if(a!=null&&l(e,["codeExecution"],a),o(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const u=o(t,["googleMaps"]);u!=null&&l(e,["googleMaps"],Fd(u));const d=o(t,["googleSearch"]);d!=null&&l(e,["googleSearch"],$d(d));const c=o(t,["urlContext"]);return c!=null&&l(e,["urlContext"],c),e}function Xd(t){const e={},n=o(t,["functionDeclarations"]);if(n!=null){let p=n;Array.isArray(p)&&(p=p.map(h=>Ud(h))),l(e,["functionDeclarations"],p)}const s=o(t,["retrieval"]);s!=null&&l(e,["retrieval"],s);const i=o(t,["googleSearchRetrieval"]);i!=null&&l(e,["googleSearchRetrieval"],i);const r=o(t,["computerUse"]);if(r!=null&&l(e,["computerUse"],r),o(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const a=o(t,["codeExecution"]);a!=null&&l(e,["codeExecution"],a);const u=o(t,["enterpriseWebSearch"]);u!=null&&l(e,["enterpriseWebSearch"],u);const d=o(t,["googleMaps"]);d!=null&&l(e,["googleMaps"],d);const c=o(t,["googleSearch"]);c!=null&&l(e,["googleSearch"],c);const f=o(t,["urlContext"]);return f!=null&&l(e,["urlContext"],f),e}function Qd(t){const e={},n=o(t,["promptTokenCount"]);n!=null&&l(e,["promptTokenCount"],n);const s=o(t,["cachedContentTokenCount"]);s!=null&&l(e,["cachedContentTokenCount"],s);const i=o(t,["candidatesTokenCount"]);i!=null&&l(e,["responseTokenCount"],i);const r=o(t,["toolUsePromptTokenCount"]);r!=null&&l(e,["toolUsePromptTokenCount"],r);const a=o(t,["thoughtsTokenCount"]);a!=null&&l(e,["thoughtsTokenCount"],a);const u=o(t,["totalTokenCount"]);u!=null&&l(e,["totalTokenCount"],u);const d=o(t,["promptTokensDetails"]);if(d!=null){let m=d;Array.isArray(m)&&(m=m.map(_=>_)),l(e,["promptTokensDetails"],m)}const c=o(t,["cacheTokensDetails"]);if(c!=null){let m=c;Array.isArray(m)&&(m=m.map(_=>_)),l(e,["cacheTokensDetails"],m)}const f=o(t,["candidatesTokensDetails"]);if(f!=null){let m=f;Array.isArray(m)&&(m=m.map(_=>_)),l(e,["responseTokensDetails"],m)}const p=o(t,["toolUsePromptTokensDetails"]);if(p!=null){let m=p;Array.isArray(m)&&(m=m.map(_=>_)),l(e,["toolUsePromptTokensDetails"],m)}const h=o(t,["trafficType"]);return h!=null&&l(e,["trafficType"],h),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function jd(t){const e={},n=o(t,["data"]);if(n!=null&&l(e,["data"],n),o(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=o(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function ef(t){const e={},n=o(t,["content"]);n!=null&&l(e,["content"],n);const s=o(t,["citationMetadata"]);s!=null&&l(e,["citationMetadata"],tf(s));const i=o(t,["tokenCount"]);i!=null&&l(e,["tokenCount"],i);const r=o(t,["finishReason"]);r!=null&&l(e,["finishReason"],r);const a=o(t,["avgLogprobs"]);a!=null&&l(e,["avgLogprobs"],a);const u=o(t,["groundingMetadata"]);u!=null&&l(e,["groundingMetadata"],u);const d=o(t,["index"]);d!=null&&l(e,["index"],d);const c=o(t,["logprobsResult"]);c!=null&&l(e,["logprobsResult"],c);const f=o(t,["safetyRatings"]);if(f!=null){let h=f;Array.isArray(h)&&(h=h.map(m=>m)),l(e,["safetyRatings"],h)}const p=o(t,["urlContextMetadata"]);return p!=null&&l(e,["urlContextMetadata"],p),e}function tf(t){const e={},n=o(t,["citationSources"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(i=>i)),l(e,["citations"],s)}return e}function nf(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["contents"]);if(i!=null){let r=ye(i);Array.isArray(r)&&(r=r.map(a=>a)),l(n,["contents"],r)}return n}function sf(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["tokensInfo"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(r=>r)),l(e,["tokensInfo"],i)}return e}function rf(t){const e={},n=o(t,["values"]);n!=null&&l(e,["values"],n);const s=o(t,["statistics"]);return s!=null&&l(e,["statistics"],of(s)),e}function of(t){const e={},n=o(t,["truncated"]);n!=null&&l(e,["truncated"],n);const s=o(t,["token_count"]);return s!=null&&l(e,["tokenCount"],s),e}function kn(t){const e={},n=o(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>dp(r))),l(e,["parts"],i)}const s=o(t,["role"]);return s!=null&&l(e,["role"],s),e}function af(t){const e={},n=o(t,["controlType"]);n!=null&&l(e,["controlType"],n);const s=o(t,["enableControlImageComputation"]);return s!=null&&l(e,["computeControl"],s),e}function lf(t){const e={};if(o(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(o(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(o(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function uf(t,e){const n={},s=o(t,["systemInstruction"]);e!==void 0&&s!=null&&l(e,["systemInstruction"],ae(s));const i=o(t,["tools"]);if(e!==void 0&&i!=null){let a=i;Array.isArray(a)&&(a=a.map(u=>Sa(u))),l(e,["tools"],a)}const r=o(t,["generationConfig"]);return e!==void 0&&r!=null&&l(e,["generationConfig"],Qf(r)),n}function cf(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["contents"]);if(i!=null){let a=ye(i);Array.isArray(a)&&(a=a.map(u=>kn(u))),l(n,["contents"],a)}const r=o(e,["config"]);return r!=null&&lf(r),n}function df(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["contents"]);if(i!=null){let a=ye(i);Array.isArray(a)&&(a=a.map(u=>u)),l(n,["contents"],a)}const r=o(e,["config"]);return r!=null&&uf(r,n),n}function ff(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["totalTokens"]);s!=null&&l(e,["totalTokens"],s);const i=o(t,["cachedContentTokenCount"]);return i!=null&&l(e,["cachedContentTokenCount"],i),e}function pf(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["totalTokens"]);return s!=null&&l(e,["totalTokens"],s),e}function hf(t,e){const n={},s=o(e,["model"]);return s!=null&&l(n,["_url","name"],Y(t,s)),n}function mf(t,e){const n={},s=o(e,["model"]);return s!=null&&l(n,["_url","name"],Y(t,s)),n}function gf(t){const e={},n=o(t,["sdkHttpResponse"]);return n!=null&&l(e,["sdkHttpResponse"],n),e}function yf(t){const e={},n=o(t,["sdkHttpResponse"]);return n!=null&&l(e,["sdkHttpResponse"],n),e}function _f(t,e){const n={},s=o(t,["outputGcsUri"]);e!==void 0&&s!=null&&l(e,["parameters","storageUri"],s);const i=o(t,["negativePrompt"]);e!==void 0&&i!=null&&l(e,["parameters","negativePrompt"],i);const r=o(t,["numberOfImages"]);e!==void 0&&r!=null&&l(e,["parameters","sampleCount"],r);const a=o(t,["aspectRatio"]);e!==void 0&&a!=null&&l(e,["parameters","aspectRatio"],a);const u=o(t,["guidanceScale"]);e!==void 0&&u!=null&&l(e,["parameters","guidanceScale"],u);const d=o(t,["seed"]);e!==void 0&&d!=null&&l(e,["parameters","seed"],d);const c=o(t,["safetyFilterLevel"]);e!==void 0&&c!=null&&l(e,["parameters","safetySetting"],c);const f=o(t,["personGeneration"]);e!==void 0&&f!=null&&l(e,["parameters","personGeneration"],f);const p=o(t,["includeSafetyAttributes"]);e!==void 0&&p!=null&&l(e,["parameters","includeSafetyAttributes"],p);const h=o(t,["includeRaiReason"]);e!==void 0&&h!=null&&l(e,["parameters","includeRaiReason"],h);const m=o(t,["language"]);e!==void 0&&m!=null&&l(e,["parameters","language"],m);const _=o(t,["outputMimeType"]);e!==void 0&&_!=null&&l(e,["parameters","outputOptions","mimeType"],_);const g=o(t,["outputCompressionQuality"]);e!==void 0&&g!=null&&l(e,["parameters","outputOptions","compressionQuality"],g);const T=o(t,["addWatermark"]);e!==void 0&&T!=null&&l(e,["parameters","addWatermark"],T);const w=o(t,["labels"]);e!==void 0&&w!=null&&l(e,["labels"],w);const v=o(t,["editMode"]);e!==void 0&&v!=null&&l(e,["parameters","editMode"],v);const S=o(t,["baseSteps"]);return e!==void 0&&S!=null&&l(e,["parameters","editConfig","baseSteps"],S),n}function Tf(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["prompt"]);i!=null&&l(n,["instances[0]","prompt"],i);const r=o(e,["referenceImages"]);if(r!=null){let u=r;Array.isArray(u)&&(u=u.map(d=>yp(d))),l(n,["instances[0]","referenceImages"],u)}const a=o(e,["config"]);return a!=null&&_f(a,n),n}function vf(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["predictions"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(r=>bn(r))),l(e,["generatedImages"],i)}return e}function Sf(t,e){const n={},s=o(t,["taskType"]);e!==void 0&&s!=null&&l(e,["requests[]","taskType"],s);const i=o(t,["title"]);e!==void 0&&i!=null&&l(e,["requests[]","title"],i);const r=o(t,["outputDimensionality"]);if(e!==void 0&&r!=null&&l(e,["requests[]","outputDimensionality"],r),o(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(o(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function Cf(t,e){const n={},s=o(t,["taskType"]);e!==void 0&&s!=null&&l(e,["instances[]","task_type"],s);const i=o(t,["title"]);e!==void 0&&i!=null&&l(e,["instances[]","title"],i);const r=o(t,["outputDimensionality"]);e!==void 0&&r!=null&&l(e,["parameters","outputDimensionality"],r);const a=o(t,["mimeType"]);e!==void 0&&a!=null&&l(e,["instances[]","mimeType"],a);const u=o(t,["autoTruncate"]);return e!==void 0&&u!=null&&l(e,["parameters","autoTruncate"],u),n}function Ef(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["contents"]);if(i!=null){let u=Bs(t,i);Array.isArray(u)&&(u=u.map(d=>d)),l(n,["requests[]","content"],u)}const r=o(e,["config"]);r!=null&&Sf(r,n);const a=o(e,["model"]);return a!==void 0&&l(n,["requests[]","model"],Y(t,a)),n}function wf(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["contents"]);if(i!=null){let a=Bs(t,i);Array.isArray(a)&&(a=a.map(u=>u)),l(n,["instances[]","content"],a)}const r=o(e,["config"]);return r!=null&&Cf(r,n),n}function If(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["embeddings"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>a)),l(e,["embeddings"],r)}const i=o(t,["metadata"]);return i!=null&&l(e,["metadata"],i),e}function Af(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["predictions[]","embeddings"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>rf(a))),l(e,["embeddings"],r)}const i=o(t,["metadata"]);return i!=null&&l(e,["metadata"],i),e}function Rf(t){const e={},n=o(t,["endpoint"]);n!=null&&l(e,["name"],n);const s=o(t,["deployedModelId"]);return s!=null&&l(e,["deployedModelId"],s),e}function Pf(t){const e={};if(o(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=o(t,["fileUri"]);n!=null&&l(e,["fileUri"],n);const s=o(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function xf(t){const e={};if(o(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=o(t,["description"]);n!=null&&l(e,["description"],n);const s=o(t,["name"]);s!=null&&l(e,["name"],s);const i=o(t,["parameters"]);i!=null&&l(e,["parameters"],i);const r=o(t,["parametersJsonSchema"]);r!=null&&l(e,["parametersJsonSchema"],r);const a=o(t,["response"]);a!=null&&l(e,["response"],a);const u=o(t,["responseJsonSchema"]);return u!=null&&l(e,["responseJsonSchema"],u),e}function Nf(t,e,n){const s={},i=o(e,["systemInstruction"]);n!==void 0&&i!=null&&l(n,["systemInstruction"],kn(ae(i)));const r=o(e,["temperature"]);r!=null&&l(s,["temperature"],r);const a=o(e,["topP"]);a!=null&&l(s,["topP"],a);const u=o(e,["topK"]);u!=null&&l(s,["topK"],u);const d=o(e,["candidateCount"]);d!=null&&l(s,["candidateCount"],d);const c=o(e,["maxOutputTokens"]);c!=null&&l(s,["maxOutputTokens"],c);const f=o(e,["stopSequences"]);f!=null&&l(s,["stopSequences"],f);const p=o(e,["responseLogprobs"]);p!=null&&l(s,["responseLogprobs"],p);const h=o(e,["logprobs"]);h!=null&&l(s,["logprobs"],h);const m=o(e,["presencePenalty"]);m!=null&&l(s,["presencePenalty"],m);const _=o(e,["frequencyPenalty"]);_!=null&&l(s,["frequencyPenalty"],_);const g=o(e,["seed"]);g!=null&&l(s,["seed"],g);const T=o(e,["responseMimeType"]);T!=null&&l(s,["responseMimeType"],T);const w=o(e,["responseSchema"]);w!=null&&l(s,["responseSchema"],Os(w));const v=o(e,["responseJsonSchema"]);if(v!=null&&l(s,["responseJsonSchema"],v),o(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(o(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const S=o(e,["safetySettings"]);if(n!==void 0&&S!=null){let O=S;Array.isArray(O)&&(O=O.map(Q=>_p(Q))),l(n,["safetySettings"],O)}const C=o(e,["tools"]);if(n!==void 0&&C!=null){let O=wt(C);Array.isArray(O)&&(O=O.map(Q=>wp(Et(Q)))),l(n,["tools"],O)}const N=o(e,["toolConfig"]);if(n!==void 0&&N!=null&&l(n,["toolConfig"],N),o(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const R=o(e,["cachedContent"]);n!==void 0&&R!=null&&l(n,["cachedContent"],Ue(t,R));const I=o(e,["responseModalities"]);I!=null&&l(s,["responseModalities"],I);const q=o(e,["mediaResolution"]);q!=null&&l(s,["mediaResolution"],q);const P=o(e,["speechConfig"]);if(P!=null&&l(s,["speechConfig"],Hs(P)),o(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const M=o(e,["thinkingConfig"]);M!=null&&l(s,["thinkingConfig"],M);const U=o(e,["imageConfig"]);return U!=null&&l(s,["imageConfig"],U),s}function Mf(t,e,n){const s={},i=o(e,["systemInstruction"]);n!==void 0&&i!=null&&l(n,["systemInstruction"],ae(i));const r=o(e,["temperature"]);r!=null&&l(s,["temperature"],r);const a=o(e,["topP"]);a!=null&&l(s,["topP"],a);const u=o(e,["topK"]);u!=null&&l(s,["topK"],u);const d=o(e,["candidateCount"]);d!=null&&l(s,["candidateCount"],d);const c=o(e,["maxOutputTokens"]);c!=null&&l(s,["maxOutputTokens"],c);const f=o(e,["stopSequences"]);f!=null&&l(s,["stopSequences"],f);const p=o(e,["responseLogprobs"]);p!=null&&l(s,["responseLogprobs"],p);const h=o(e,["logprobs"]);h!=null&&l(s,["logprobs"],h);const m=o(e,["presencePenalty"]);m!=null&&l(s,["presencePenalty"],m);const _=o(e,["frequencyPenalty"]);_!=null&&l(s,["frequencyPenalty"],_);const g=o(e,["seed"]);g!=null&&l(s,["seed"],g);const T=o(e,["responseMimeType"]);T!=null&&l(s,["responseMimeType"],T);const w=o(e,["responseSchema"]);w!=null&&l(s,["responseSchema"],Os(w));const v=o(e,["responseJsonSchema"]);v!=null&&l(s,["responseJsonSchema"],v);const S=o(e,["routingConfig"]);S!=null&&l(s,["routingConfig"],S);const C=o(e,["modelSelectionConfig"]);C!=null&&l(s,["modelConfig"],C);const N=o(e,["safetySettings"]);if(n!==void 0&&N!=null){let xe=N;Array.isArray(xe)&&(xe=xe.map(zn=>zn)),l(n,["safetySettings"],xe)}const R=o(e,["tools"]);if(n!==void 0&&R!=null){let xe=wt(R);Array.isArray(xe)&&(xe=xe.map(zn=>Sa(Et(zn)))),l(n,["tools"],xe)}const I=o(e,["toolConfig"]);n!==void 0&&I!=null&&l(n,["toolConfig"],I);const q=o(e,["labels"]);n!==void 0&&q!=null&&l(n,["labels"],q);const P=o(e,["cachedContent"]);n!==void 0&&P!=null&&l(n,["cachedContent"],Ue(t,P));const M=o(e,["responseModalities"]);M!=null&&l(s,["responseModalities"],M);const U=o(e,["mediaResolution"]);U!=null&&l(s,["mediaResolution"],U);const O=o(e,["speechConfig"]);O!=null&&l(s,["speechConfig"],va(Hs(O)));const Q=o(e,["audioTimestamp"]);Q!=null&&l(s,["audioTimestamp"],Q);const H=o(e,["thinkingConfig"]);H!=null&&l(s,["thinkingConfig"],H);const he=o(e,["imageConfig"]);return he!=null&&l(s,["imageConfig"],he),s}function Wr(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["contents"]);if(i!=null){let a=ye(i);Array.isArray(a)&&(a=a.map(u=>kn(u))),l(n,["contents"],a)}const r=o(e,["config"]);return r!=null&&l(n,["generationConfig"],Nf(t,r,n)),n}function Yr(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["contents"]);if(i!=null){let a=ye(i);Array.isArray(a)&&(a=a.map(u=>u)),l(n,["contents"],a)}const r=o(e,["config"]);return r!=null&&l(n,["generationConfig"],Mf(t,r,n)),n}function Kr(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["candidates"]);if(s!=null){let d=s;Array.isArray(d)&&(d=d.map(c=>ef(c))),l(e,["candidates"],d)}const i=o(t,["modelVersion"]);i!=null&&l(e,["modelVersion"],i);const r=o(t,["promptFeedback"]);r!=null&&l(e,["promptFeedback"],r);const a=o(t,["responseId"]);a!=null&&l(e,["responseId"],a);const u=o(t,["usageMetadata"]);return u!=null&&l(e,["usageMetadata"],u),e}function zr(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["candidates"]);if(s!=null){let c=s;Array.isArray(c)&&(c=c.map(f=>f)),l(e,["candidates"],c)}const i=o(t,["createTime"]);i!=null&&l(e,["createTime"],i);const r=o(t,["modelVersion"]);r!=null&&l(e,["modelVersion"],r);const a=o(t,["promptFeedback"]);a!=null&&l(e,["promptFeedback"],a);const u=o(t,["responseId"]);u!=null&&l(e,["responseId"],u);const d=o(t,["usageMetadata"]);return d!=null&&l(e,["usageMetadata"],d),e}function kf(t,e){const n={};if(o(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(o(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const s=o(t,["numberOfImages"]);e!==void 0&&s!=null&&l(e,["parameters","sampleCount"],s);const i=o(t,["aspectRatio"]);e!==void 0&&i!=null&&l(e,["parameters","aspectRatio"],i);const r=o(t,["guidanceScale"]);if(e!==void 0&&r!=null&&l(e,["parameters","guidanceScale"],r),o(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const a=o(t,["safetyFilterLevel"]);e!==void 0&&a!=null&&l(e,["parameters","safetySetting"],a);const u=o(t,["personGeneration"]);e!==void 0&&u!=null&&l(e,["parameters","personGeneration"],u);const d=o(t,["includeSafetyAttributes"]);e!==void 0&&d!=null&&l(e,["parameters","includeSafetyAttributes"],d);const c=o(t,["includeRaiReason"]);e!==void 0&&c!=null&&l(e,["parameters","includeRaiReason"],c);const f=o(t,["language"]);e!==void 0&&f!=null&&l(e,["parameters","language"],f);const p=o(t,["outputMimeType"]);e!==void 0&&p!=null&&l(e,["parameters","outputOptions","mimeType"],p);const h=o(t,["outputCompressionQuality"]);if(e!==void 0&&h!=null&&l(e,["parameters","outputOptions","compressionQuality"],h),o(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(o(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const m=o(t,["imageSize"]);if(e!==void 0&&m!=null&&l(e,["parameters","sampleImageSize"],m),o(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function bf(t,e){const n={},s=o(t,["outputGcsUri"]);e!==void 0&&s!=null&&l(e,["parameters","storageUri"],s);const i=o(t,["negativePrompt"]);e!==void 0&&i!=null&&l(e,["parameters","negativePrompt"],i);const r=o(t,["numberOfImages"]);e!==void 0&&r!=null&&l(e,["parameters","sampleCount"],r);const a=o(t,["aspectRatio"]);e!==void 0&&a!=null&&l(e,["parameters","aspectRatio"],a);const u=o(t,["guidanceScale"]);e!==void 0&&u!=null&&l(e,["parameters","guidanceScale"],u);const d=o(t,["seed"]);e!==void 0&&d!=null&&l(e,["parameters","seed"],d);const c=o(t,["safetyFilterLevel"]);e!==void 0&&c!=null&&l(e,["parameters","safetySetting"],c);const f=o(t,["personGeneration"]);e!==void 0&&f!=null&&l(e,["parameters","personGeneration"],f);const p=o(t,["includeSafetyAttributes"]);e!==void 0&&p!=null&&l(e,["parameters","includeSafetyAttributes"],p);const h=o(t,["includeRaiReason"]);e!==void 0&&h!=null&&l(e,["parameters","includeRaiReason"],h);const m=o(t,["language"]);e!==void 0&&m!=null&&l(e,["parameters","language"],m);const _=o(t,["outputMimeType"]);e!==void 0&&_!=null&&l(e,["parameters","outputOptions","mimeType"],_);const g=o(t,["outputCompressionQuality"]);e!==void 0&&g!=null&&l(e,["parameters","outputOptions","compressionQuality"],g);const T=o(t,["addWatermark"]);e!==void 0&&T!=null&&l(e,["parameters","addWatermark"],T);const w=o(t,["labels"]);e!==void 0&&w!=null&&l(e,["labels"],w);const v=o(t,["imageSize"]);e!==void 0&&v!=null&&l(e,["parameters","sampleImageSize"],v);const S=o(t,["enhancePrompt"]);return e!==void 0&&S!=null&&l(e,["parameters","enhancePrompt"],S),n}function Df(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["prompt"]);i!=null&&l(n,["instances[0]","prompt"],i);const r=o(e,["config"]);return r!=null&&kf(r,n),n}function Uf(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["prompt"]);i!=null&&l(n,["instances[0]","prompt"],i);const r=o(e,["config"]);return r!=null&&bf(r,n),n}function Lf(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["predictions"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>Kf(a))),l(e,["generatedImages"],r)}const i=o(t,["positivePromptSafetyAttributes"]);return i!=null&&l(e,["positivePromptSafetyAttributes"],_a(i)),e}function Ff(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["predictions"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>bn(a))),l(e,["generatedImages"],r)}const i=o(t,["positivePromptSafetyAttributes"]);return i!=null&&l(e,["positivePromptSafetyAttributes"],Ta(i)),e}function $f(t,e){const n={},s=o(t,["numberOfVideos"]);if(e!==void 0&&s!=null&&l(e,["parameters","sampleCount"],s),o(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(o(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const i=o(t,["durationSeconds"]);if(e!==void 0&&i!=null&&l(e,["parameters","durationSeconds"],i),o(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const r=o(t,["aspectRatio"]);e!==void 0&&r!=null&&l(e,["parameters","aspectRatio"],r);const a=o(t,["resolution"]);e!==void 0&&a!=null&&l(e,["parameters","resolution"],a);const u=o(t,["personGeneration"]);if(e!==void 0&&u!=null&&l(e,["parameters","personGeneration"],u),o(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const d=o(t,["negativePrompt"]);e!==void 0&&d!=null&&l(e,["parameters","negativePrompt"],d);const c=o(t,["enhancePrompt"]);if(e!==void 0&&c!=null&&l(e,["parameters","enhancePrompt"],c),o(t,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const f=o(t,["lastFrame"]);e!==void 0&&f!=null&&l(e,["instances[0]","lastFrame"],Dn(f));const p=o(t,["referenceImages"]);if(e!==void 0&&p!=null){let h=p;Array.isArray(h)&&(h=h.map(m=>Fp(m))),l(e,["instances[0]","referenceImages"],h)}if(o(t,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(o(t,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return n}function Gf(t,e){const n={},s=o(t,["numberOfVideos"]);e!==void 0&&s!=null&&l(e,["parameters","sampleCount"],s);const i=o(t,["outputGcsUri"]);e!==void 0&&i!=null&&l(e,["parameters","storageUri"],i);const r=o(t,["fps"]);e!==void 0&&r!=null&&l(e,["parameters","fps"],r);const a=o(t,["durationSeconds"]);e!==void 0&&a!=null&&l(e,["parameters","durationSeconds"],a);const u=o(t,["seed"]);e!==void 0&&u!=null&&l(e,["parameters","seed"],u);const d=o(t,["aspectRatio"]);e!==void 0&&d!=null&&l(e,["parameters","aspectRatio"],d);const c=o(t,["resolution"]);e!==void 0&&c!=null&&l(e,["parameters","resolution"],c);const f=o(t,["personGeneration"]);e!==void 0&&f!=null&&l(e,["parameters","personGeneration"],f);const p=o(t,["pubsubTopic"]);e!==void 0&&p!=null&&l(e,["parameters","pubsubTopic"],p);const h=o(t,["negativePrompt"]);e!==void 0&&h!=null&&l(e,["parameters","negativePrompt"],h);const m=o(t,["enhancePrompt"]);e!==void 0&&m!=null&&l(e,["parameters","enhancePrompt"],m);const _=o(t,["generateAudio"]);e!==void 0&&_!=null&&l(e,["parameters","generateAudio"],_);const g=o(t,["lastFrame"]);e!==void 0&&g!=null&&l(e,["instances[0]","lastFrame"],Ce(g));const T=o(t,["referenceImages"]);if(e!==void 0&&T!=null){let S=T;Array.isArray(S)&&(S=S.map(C=>$p(C))),l(e,["instances[0]","referenceImages"],S)}const w=o(t,["mask"]);e!==void 0&&w!=null&&l(e,["instances[0]","mask"],Lp(w));const v=o(t,["compressionQuality"]);return e!==void 0&&v!=null&&l(e,["parameters","compressionQuality"],v),n}function Vf(t){const e={},n=o(t,["name"]);n!=null&&l(e,["name"],n);const s=o(t,["metadata"]);s!=null&&l(e,["metadata"],s);const i=o(t,["done"]);i!=null&&l(e,["done"],i);const r=o(t,["error"]);r!=null&&l(e,["error"],r);const a=o(t,["response","generateVideoResponse"]);return a!=null&&l(e,["response"],Hf(a)),e}function qf(t){const e={},n=o(t,["name"]);n!=null&&l(e,["name"],n);const s=o(t,["metadata"]);s!=null&&l(e,["metadata"],s);const i=o(t,["done"]);i!=null&&l(e,["done"],i);const r=o(t,["error"]);r!=null&&l(e,["error"],r);const a=o(t,["response"]);return a!=null&&l(e,["response"],Jf(a)),e}function Bf(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["prompt"]);i!=null&&l(n,["instances[0]","prompt"],i);const r=o(e,["image"]);r!=null&&l(n,["instances[0]","image"],Dn(r));const a=o(e,["video"]);a!=null&&l(n,["instances[0]","video"],Ca(a));const u=o(e,["source"]);u!=null&&Wf(u,n);const d=o(e,["config"]);return d!=null&&$f(d,n),n}function Of(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["prompt"]);i!=null&&l(n,["instances[0]","prompt"],i);const r=o(e,["image"]);r!=null&&l(n,["instances[0]","image"],Ce(r));const a=o(e,["video"]);a!=null&&l(n,["instances[0]","video"],Ea(a));const u=o(e,["source"]);u!=null&&Yf(u,n);const d=o(e,["config"]);return d!=null&&Gf(d,n),n}function Hf(t){const e={},n=o(t,["generatedSamples"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>Zf(a))),l(e,["generatedVideos"],r)}const s=o(t,["raiMediaFilteredCount"]);s!=null&&l(e,["raiMediaFilteredCount"],s);const i=o(t,["raiMediaFilteredReasons"]);return i!=null&&l(e,["raiMediaFilteredReasons"],i),e}function Jf(t){const e={},n=o(t,["videos"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>Xf(a))),l(e,["generatedVideos"],r)}const s=o(t,["raiMediaFilteredCount"]);s!=null&&l(e,["raiMediaFilteredCount"],s);const i=o(t,["raiMediaFilteredReasons"]);return i!=null&&l(e,["raiMediaFilteredReasons"],i),e}function Wf(t,e){const n={},s=o(t,["prompt"]);e!==void 0&&s!=null&&l(e,["instances[0]","prompt"],s);const i=o(t,["image"]);e!==void 0&&i!=null&&l(e,["instances[0]","image"],Dn(i));const r=o(t,["video"]);return e!==void 0&&r!=null&&l(e,["instances[0]","video"],Ca(r)),n}function Yf(t,e){const n={},s=o(t,["prompt"]);e!==void 0&&s!=null&&l(e,["instances[0]","prompt"],s);const i=o(t,["image"]);e!==void 0&&i!=null&&l(e,["instances[0]","image"],Ce(i));const r=o(t,["video"]);return e!==void 0&&r!=null&&l(e,["instances[0]","video"],Ea(r)),n}function Kf(t){const e={},n=o(t,["_self"]);n!=null&&l(e,["image"],sp(n));const s=o(t,["raiFilteredReason"]);s!=null&&l(e,["raiFilteredReason"],s);const i=o(t,["_self"]);return i!=null&&l(e,["safetyAttributes"],_a(i)),e}function bn(t){const e={},n=o(t,["_self"]);n!=null&&l(e,["image"],ya(n));const s=o(t,["raiFilteredReason"]);s!=null&&l(e,["raiFilteredReason"],s);const i=o(t,["_self"]);i!=null&&l(e,["safetyAttributes"],Ta(i));const r=o(t,["prompt"]);return r!=null&&l(e,["enhancedPrompt"],r),e}function zf(t){const e={},n=o(t,["_self"]);n!=null&&l(e,["mask"],ya(n));const s=o(t,["labels"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(r=>r)),l(e,["labels"],i)}return e}function Zf(t){const e={},n=o(t,["video"]);return n!=null&&l(e,["video"],Dp(n)),e}function Xf(t){const e={},n=o(t,["_self"]);return n!=null&&l(e,["video"],Up(n)),e}function Qf(t){const e={},n=o(t,["modelSelectionConfig"]);n!=null&&l(e,["modelConfig"],n);const s=o(t,["responseJsonSchema"]);s!=null&&l(e,["responseJsonSchema"],s);const i=o(t,["audioTimestamp"]);i!=null&&l(e,["audioTimestamp"],i);const r=o(t,["candidateCount"]);r!=null&&l(e,["candidateCount"],r);const a=o(t,["enableAffectiveDialog"]);a!=null&&l(e,["enableAffectiveDialog"],a);const u=o(t,["frequencyPenalty"]);u!=null&&l(e,["frequencyPenalty"],u);const d=o(t,["logprobs"]);d!=null&&l(e,["logprobs"],d);const c=o(t,["maxOutputTokens"]);c!=null&&l(e,["maxOutputTokens"],c);const f=o(t,["mediaResolution"]);f!=null&&l(e,["mediaResolution"],f);const p=o(t,["presencePenalty"]);p!=null&&l(e,["presencePenalty"],p);const h=o(t,["responseLogprobs"]);h!=null&&l(e,["responseLogprobs"],h);const m=o(t,["responseMimeType"]);m!=null&&l(e,["responseMimeType"],m);const _=o(t,["responseModalities"]);_!=null&&l(e,["responseModalities"],_);const g=o(t,["responseSchema"]);g!=null&&l(e,["responseSchema"],g);const T=o(t,["routingConfig"]);T!=null&&l(e,["routingConfig"],T);const w=o(t,["seed"]);w!=null&&l(e,["seed"],w);const v=o(t,["speechConfig"]);v!=null&&l(e,["speechConfig"],va(v));const S=o(t,["stopSequences"]);S!=null&&l(e,["stopSequences"],S);const C=o(t,["temperature"]);C!=null&&l(e,["temperature"],C);const N=o(t,["thinkingConfig"]);N!=null&&l(e,["thinkingConfig"],N);const R=o(t,["topK"]);R!=null&&l(e,["topK"],R);const I=o(t,["topP"]);if(I!=null&&l(e,["topP"],I),o(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function jf(t,e){const n={},s=o(e,["model"]);return s!=null&&l(n,["_url","name"],Y(t,s)),n}function ep(t,e){const n={},s=o(e,["model"]);return s!=null&&l(n,["_url","name"],Y(t,s)),n}function tp(t){const e={};if(o(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=o(t,["enableWidget"]);return n!=null&&l(e,["enableWidget"],n),e}function np(t){const e={};if(o(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(o(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=o(t,["timeRangeFilter"]);return n!=null&&l(e,["timeRangeFilter"],n),e}function sp(t){const e={},n=o(t,["bytesBase64Encoded"]);n!=null&&l(e,["imageBytes"],Ke(n));const s=o(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function ya(t){const e={},n=o(t,["gcsUri"]);n!=null&&l(e,["gcsUri"],n);const s=o(t,["bytesBase64Encoded"]);s!=null&&l(e,["imageBytes"],Ke(s));const i=o(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function Dn(t){const e={};if(o(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=o(t,["imageBytes"]);n!=null&&l(e,["bytesBase64Encoded"],Ke(n));const s=o(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function Ce(t){const e={},n=o(t,["gcsUri"]);n!=null&&l(e,["gcsUri"],n);const s=o(t,["imageBytes"]);s!=null&&l(e,["bytesBase64Encoded"],Ke(s));const i=o(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function ip(t,e,n){const s={},i=o(e,["pageSize"]);n!==void 0&&i!=null&&l(n,["_query","pageSize"],i);const r=o(e,["pageToken"]);n!==void 0&&r!=null&&l(n,["_query","pageToken"],r);const a=o(e,["filter"]);n!==void 0&&a!=null&&l(n,["_query","filter"],a);const u=o(e,["queryBase"]);return n!==void 0&&u!=null&&l(n,["_url","models_url"],ua(t,u)),s}function rp(t,e,n){const s={},i=o(e,["pageSize"]);n!==void 0&&i!=null&&l(n,["_query","pageSize"],i);const r=o(e,["pageToken"]);n!==void 0&&r!=null&&l(n,["_query","pageToken"],r);const a=o(e,["filter"]);n!==void 0&&a!=null&&l(n,["_query","filter"],a);const u=o(e,["queryBase"]);return n!==void 0&&u!=null&&l(n,["_url","models_url"],ua(t,u)),s}function op(t,e){const n={},s=o(e,["config"]);return s!=null&&ip(t,s,n),n}function ap(t,e){const n={},s=o(e,["config"]);return s!=null&&rp(t,s,n),n}function lp(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["nextPageToken"]);s!=null&&l(e,["nextPageToken"],s);const i=o(t,["_self"]);if(i!=null){let r=ca(i);Array.isArray(r)&&(r=r.map(a=>hs(a))),l(e,["models"],r)}return e}function up(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["nextPageToken"]);s!=null&&l(e,["nextPageToken"],s);const i=o(t,["_self"]);if(i!=null){let r=ca(i);Array.isArray(r)&&(r=r.map(a=>ms(a))),l(e,["models"],r)}return e}function cp(t){const e={},n=o(t,["maskMode"]);n!=null&&l(e,["maskMode"],n);const s=o(t,["segmentationClasses"]);s!=null&&l(e,["maskClasses"],s);const i=o(t,["maskDilation"]);return i!=null&&l(e,["dilation"],i),e}function hs(t){const e={},n=o(t,["name"]);n!=null&&l(e,["name"],n);const s=o(t,["displayName"]);s!=null&&l(e,["displayName"],s);const i=o(t,["description"]);i!=null&&l(e,["description"],i);const r=o(t,["version"]);r!=null&&l(e,["version"],r);const a=o(t,["_self"]);a!=null&&l(e,["tunedModelInfo"],Ip(a));const u=o(t,["inputTokenLimit"]);u!=null&&l(e,["inputTokenLimit"],u);const d=o(t,["outputTokenLimit"]);d!=null&&l(e,["outputTokenLimit"],d);const c=o(t,["supportedGenerationMethods"]);return c!=null&&l(e,["supportedActions"],c),e}function ms(t){const e={},n=o(t,["name"]);n!=null&&l(e,["name"],n);const s=o(t,["displayName"]);s!=null&&l(e,["displayName"],s);const i=o(t,["description"]);i!=null&&l(e,["description"],i);const r=o(t,["versionId"]);r!=null&&l(e,["version"],r);const a=o(t,["deployedModels"]);if(a!=null){let p=a;Array.isArray(p)&&(p=p.map(h=>Rf(h))),l(e,["endpoints"],p)}const u=o(t,["labels"]);u!=null&&l(e,["labels"],u);const d=o(t,["_self"]);d!=null&&l(e,["tunedModelInfo"],Ap(d));const c=o(t,["defaultCheckpointId"]);c!=null&&l(e,["defaultCheckpointId"],c);const f=o(t,["checkpoints"]);if(f!=null){let p=f;Array.isArray(p)&&(p=p.map(h=>h)),l(e,["checkpoints"],p)}return e}function dp(t){const e={},n=o(t,["functionCall"]);n!=null&&l(e,["functionCall"],n);const s=o(t,["codeExecutionResult"]);s!=null&&l(e,["codeExecutionResult"],s);const i=o(t,["executableCode"]);i!=null&&l(e,["executableCode"],i);const r=o(t,["fileData"]);r!=null&&l(e,["fileData"],Pf(r));const a=o(t,["functionResponse"]);a!=null&&l(e,["functionResponse"],a);const u=o(t,["inlineData"]);u!=null&&l(e,["inlineData"],jd(u));const d=o(t,["text"]);d!=null&&l(e,["text"],d);const c=o(t,["thought"]);c!=null&&l(e,["thought"],c);const f=o(t,["thoughtSignature"]);f!=null&&l(e,["thoughtSignature"],f);const p=o(t,["videoMetadata"]);return p!=null&&l(e,["videoMetadata"],p),e}function fp(t){const e={},n=o(t,["productImage"]);return n!=null&&l(e,["image"],Ce(n)),e}function pp(t,e){const n={},s=o(t,["numberOfImages"]);e!==void 0&&s!=null&&l(e,["parameters","sampleCount"],s);const i=o(t,["baseSteps"]);e!==void 0&&i!=null&&l(e,["parameters","editConfig","baseSteps"],i);const r=o(t,["outputGcsUri"]);e!==void 0&&r!=null&&l(e,["parameters","storageUri"],r);const a=o(t,["seed"]);e!==void 0&&a!=null&&l(e,["parameters","seed"],a);const u=o(t,["safetyFilterLevel"]);e!==void 0&&u!=null&&l(e,["parameters","safetySetting"],u);const d=o(t,["personGeneration"]);e!==void 0&&d!=null&&l(e,["parameters","personGeneration"],d);const c=o(t,["addWatermark"]);e!==void 0&&c!=null&&l(e,["parameters","addWatermark"],c);const f=o(t,["outputMimeType"]);e!==void 0&&f!=null&&l(e,["parameters","outputOptions","mimeType"],f);const p=o(t,["outputCompressionQuality"]);e!==void 0&&p!=null&&l(e,["parameters","outputOptions","compressionQuality"],p);const h=o(t,["enhancePrompt"]);e!==void 0&&h!=null&&l(e,["parameters","enhancePrompt"],h);const m=o(t,["labels"]);return e!==void 0&&m!=null&&l(e,["labels"],m),n}function hp(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["source"]);i!=null&&gp(i,n);const r=o(e,["config"]);return r!=null&&pp(r,n),n}function mp(t){const e={},n=o(t,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(i=>bn(i))),l(e,["generatedImages"],s)}return e}function gp(t,e){const n={},s=o(t,["prompt"]);e!==void 0&&s!=null&&l(e,["instances[0]","prompt"],s);const i=o(t,["personImage"]);e!==void 0&&i!=null&&l(e,["instances[0]","personImage","image"],Ce(i));const r=o(t,["productImages"]);if(e!==void 0&&r!=null){let a=r;Array.isArray(a)&&(a=a.map(u=>fp(u))),l(e,["instances[0]","productImages"],a)}return n}function yp(t){const e={},n=o(t,["referenceImage"]);n!=null&&l(e,["referenceImage"],Ce(n));const s=o(t,["referenceId"]);s!=null&&l(e,["referenceId"],s);const i=o(t,["referenceType"]);i!=null&&l(e,["referenceType"],i);const r=o(t,["maskImageConfig"]);r!=null&&l(e,["maskImageConfig"],cp(r));const a=o(t,["controlImageConfig"]);a!=null&&l(e,["controlImageConfig"],af(a));const u=o(t,["styleImageConfig"]);u!=null&&l(e,["styleImageConfig"],u);const d=o(t,["subjectImageConfig"]);return d!=null&&l(e,["subjectImageConfig"],d),e}function _a(t){const e={},n=o(t,["safetyAttributes","categories"]);n!=null&&l(e,["categories"],n);const s=o(t,["safetyAttributes","scores"]);s!=null&&l(e,["scores"],s);const i=o(t,["contentType"]);return i!=null&&l(e,["contentType"],i),e}function Ta(t){const e={},n=o(t,["safetyAttributes","categories"]);n!=null&&l(e,["categories"],n);const s=o(t,["safetyAttributes","scores"]);s!=null&&l(e,["scores"],s);const i=o(t,["contentType"]);return i!=null&&l(e,["contentType"],i),e}function _p(t){const e={},n=o(t,["category"]);if(n!=null&&l(e,["category"],n),o(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const s=o(t,["threshold"]);return s!=null&&l(e,["threshold"],s),e}function Tp(t){const e={},n=o(t,["image"]);return n!=null&&l(e,["image"],Ce(n)),e}function vp(t,e){const n={},s=o(t,["mode"]);e!==void 0&&s!=null&&l(e,["parameters","mode"],s);const i=o(t,["maxPredictions"]);e!==void 0&&i!=null&&l(e,["parameters","maxPredictions"],i);const r=o(t,["confidenceThreshold"]);e!==void 0&&r!=null&&l(e,["parameters","confidenceThreshold"],r);const a=o(t,["maskDilation"]);e!==void 0&&a!=null&&l(e,["parameters","maskDilation"],a);const u=o(t,["binaryColorThreshold"]);e!==void 0&&u!=null&&l(e,["parameters","binaryColorThreshold"],u);const d=o(t,["labels"]);return e!==void 0&&d!=null&&l(e,["labels"],d),n}function Sp(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["source"]);i!=null&&Ep(i,n);const r=o(e,["config"]);return r!=null&&vp(r,n),n}function Cp(t){const e={},n=o(t,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(i=>zf(i))),l(e,["generatedMasks"],s)}return e}function Ep(t,e){const n={},s=o(t,["prompt"]);e!==void 0&&s!=null&&l(e,["instances[0]","prompt"],s);const i=o(t,["image"]);e!==void 0&&i!=null&&l(e,["instances[0]","image"],Ce(i));const r=o(t,["scribbleImage"]);return e!==void 0&&r!=null&&l(e,["instances[0]","scribble"],Tp(r)),n}function va(t){const e={},n=o(t,["languageCode"]);n!=null&&l(e,["languageCode"],n);const s=o(t,["voiceConfig"]);if(s!=null&&l(e,["voiceConfig"],s),o(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function wp(t){const e={},n=o(t,["functionDeclarations"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(p=>p)),l(e,["functionDeclarations"],f)}if(o(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=o(t,["googleSearchRetrieval"]);s!=null&&l(e,["googleSearchRetrieval"],s);const i=o(t,["computerUse"]);i!=null&&l(e,["computerUse"],i);const r=o(t,["fileSearch"]);r!=null&&l(e,["fileSearch"],r);const a=o(t,["codeExecution"]);if(a!=null&&l(e,["codeExecution"],a),o(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const u=o(t,["googleMaps"]);u!=null&&l(e,["googleMaps"],tp(u));const d=o(t,["googleSearch"]);d!=null&&l(e,["googleSearch"],np(d));const c=o(t,["urlContext"]);return c!=null&&l(e,["urlContext"],c),e}function Sa(t){const e={},n=o(t,["functionDeclarations"]);if(n!=null){let p=n;Array.isArray(p)&&(p=p.map(h=>xf(h))),l(e,["functionDeclarations"],p)}const s=o(t,["retrieval"]);s!=null&&l(e,["retrieval"],s);const i=o(t,["googleSearchRetrieval"]);i!=null&&l(e,["googleSearchRetrieval"],i);const r=o(t,["computerUse"]);if(r!=null&&l(e,["computerUse"],r),o(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const a=o(t,["codeExecution"]);a!=null&&l(e,["codeExecution"],a);const u=o(t,["enterpriseWebSearch"]);u!=null&&l(e,["enterpriseWebSearch"],u);const d=o(t,["googleMaps"]);d!=null&&l(e,["googleMaps"],d);const c=o(t,["googleSearch"]);c!=null&&l(e,["googleSearch"],c);const f=o(t,["urlContext"]);return f!=null&&l(e,["urlContext"],f),e}function Ip(t){const e={},n=o(t,["baseModel"]);n!=null&&l(e,["baseModel"],n);const s=o(t,["createTime"]);s!=null&&l(e,["createTime"],s);const i=o(t,["updateTime"]);return i!=null&&l(e,["updateTime"],i),e}function Ap(t){const e={},n=o(t,["labels","google-vertex-llm-tuning-base-model-id"]);n!=null&&l(e,["baseModel"],n);const s=o(t,["createTime"]);s!=null&&l(e,["createTime"],s);const i=o(t,["updateTime"]);return i!=null&&l(e,["updateTime"],i),e}function Rp(t,e){const n={},s=o(t,["displayName"]);e!==void 0&&s!=null&&l(e,["displayName"],s);const i=o(t,["description"]);e!==void 0&&i!=null&&l(e,["description"],i);const r=o(t,["defaultCheckpointId"]);return e!==void 0&&r!=null&&l(e,["defaultCheckpointId"],r),n}function Pp(t,e){const n={},s=o(t,["displayName"]);e!==void 0&&s!=null&&l(e,["displayName"],s);const i=o(t,["description"]);e!==void 0&&i!=null&&l(e,["description"],i);const r=o(t,["defaultCheckpointId"]);return e!==void 0&&r!=null&&l(e,["defaultCheckpointId"],r),n}function xp(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","name"],Y(t,s));const i=o(e,["config"]);return i!=null&&Rp(i,n),n}function Np(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["config"]);return i!=null&&Pp(i,n),n}function Mp(t,e){const n={},s=o(t,["outputGcsUri"]);e!==void 0&&s!=null&&l(e,["parameters","storageUri"],s);const i=o(t,["safetyFilterLevel"]);e!==void 0&&i!=null&&l(e,["parameters","safetySetting"],i);const r=o(t,["personGeneration"]);e!==void 0&&r!=null&&l(e,["parameters","personGeneration"],r);const a=o(t,["includeRaiReason"]);e!==void 0&&a!=null&&l(e,["parameters","includeRaiReason"],a);const u=o(t,["outputMimeType"]);e!==void 0&&u!=null&&l(e,["parameters","outputOptions","mimeType"],u);const d=o(t,["outputCompressionQuality"]);e!==void 0&&d!=null&&l(e,["parameters","outputOptions","compressionQuality"],d);const c=o(t,["enhanceInputImage"]);e!==void 0&&c!=null&&l(e,["parameters","upscaleConfig","enhanceInputImage"],c);const f=o(t,["imagePreservationFactor"]);e!==void 0&&f!=null&&l(e,["parameters","upscaleConfig","imagePreservationFactor"],f);const p=o(t,["labels"]);e!==void 0&&p!=null&&l(e,["labels"],p);const h=o(t,["numberOfImages"]);e!==void 0&&h!=null&&l(e,["parameters","sampleCount"],h);const m=o(t,["mode"]);return e!==void 0&&m!=null&&l(e,["parameters","mode"],m),n}function kp(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["_url","model"],Y(t,s));const i=o(e,["image"]);i!=null&&l(n,["instances[0]","image"],Ce(i));const r=o(e,["upscaleFactor"]);r!=null&&l(n,["parameters","upscaleConfig","upscaleFactor"],r);const a=o(e,["config"]);return a!=null&&Mp(a,n),n}function bp(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["predictions"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(r=>bn(r))),l(e,["generatedImages"],i)}return e}function Dp(t){const e={},n=o(t,["uri"]);n!=null&&l(e,["uri"],n);const s=o(t,["encodedVideo"]);s!=null&&l(e,["videoBytes"],Ke(s));const i=o(t,["encoding"]);return i!=null&&l(e,["mimeType"],i),e}function Up(t){const e={},n=o(t,["gcsUri"]);n!=null&&l(e,["uri"],n);const s=o(t,["bytesBase64Encoded"]);s!=null&&l(e,["videoBytes"],Ke(s));const i=o(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function Lp(t){const e={},n=o(t,["image"]);n!=null&&l(e,["_self"],Ce(n));const s=o(t,["maskMode"]);return s!=null&&l(e,["maskMode"],s),e}function Fp(t){const e={},n=o(t,["image"]);n!=null&&l(e,["image"],Dn(n));const s=o(t,["referenceType"]);return s!=null&&l(e,["referenceType"],s),e}function $p(t){const e={},n=o(t,["image"]);n!=null&&l(e,["image"],Ce(n));const s=o(t,["referenceType"]);return s!=null&&l(e,["referenceType"],s),e}function Ca(t){const e={},n=o(t,["uri"]);n!=null&&l(e,["uri"],n);const s=o(t,["videoBytes"]);s!=null&&l(e,["encodedVideo"],Ke(s));const i=o(t,["mimeType"]);return i!=null&&l(e,["encoding"],i),e}function Ea(t){const e={},n=o(t,["uri"]);n!=null&&l(e,["gcsUri"],n);const s=o(t,["videoBytes"]);s!=null&&l(e,["bytesBase64Encoded"],Ke(s));const i=o(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Gp="Content-Type",Vp="X-Server-Timeout",qp="User-Agent",gs="x-goog-api-client",Bp="1.29.0",Op=`google-genai-sdk/${Bp}`,Hp="v1beta1",Jp="v1beta",Zr=/^\s*data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class Wp{constructor(e){var n,s;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const i={};this.clientOptions.vertexai?(i.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:Hp,i.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(i.apiVersion=(s=this.clientOptions.apiVersion)!==null&&s!==void 0?s:Jp,i.baseUrl="https://generativelanguage.googleapis.com/"),i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const s=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&s.push(e.apiVersion),s.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),n=new URL(e);return n.protocol=n.protocol=="http:"?"ws":"wss",n.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,n,s){const i=[this.getRequestUrlInternal(n)];return s&&i.push(this.getBaseResourcePath()),e!==""&&i.push(e),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const s=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,n,s);if(e.queryParams)for(const[a,u]of Object.entries(e.queryParams))i.searchParams.append(a,String(u));let r={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else r.body=e.body;return r=await this.includeExtraHttpOptionsToRequestInit(r,n,i.toString(),e.abortSignal),this.unaryApiCall(i,r,e.httpMethod)}patchHttpOptions(e,n){const s=JSON.parse(JSON.stringify(e));for(const[i,r]of Object.entries(n))typeof r=="object"?s[i]=Object.assign(Object.assign({},s[i]),r):r!==void 0&&(s[i]=r);return s}async requestStream(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const s=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,n,s);(!i.searchParams.has("alt")||i.searchParams.get("alt")!=="sse")&&i.searchParams.set("alt","sse");let r={};return r.body=e.body,r=await this.includeExtraHttpOptionsToRequestInit(r,n,i.toString(),e.abortSignal),this.streamApiCall(i,r,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,n,s,i){if(n&&n.timeout||i){const r=new AbortController,a=r.signal;if(n.timeout&&(n==null?void 0:n.timeout)>0){const u=setTimeout(()=>r.abort(),n.timeout);u&&typeof u.unref=="function"&&u.unref()}i&&i.addEventListener("abort",()=>{r.abort()}),e.signal=a}return n&&n.extraBody!==null&&Yp(e,n.extraBody),e.headers=await this.getHeadersInternal(n,s),e}async unaryApiCall(e,n,s){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:s})).then(async i=>(await Xr(i),new ds(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(e,n,s){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:s})).then(async i=>(await Xr(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(e){var n;return pt(this,arguments,function*(){const i=(n=e==null?void 0:e.body)===null||n===void 0?void 0:n.getReader(),r=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let a="";for(;;){const{done:u,value:d}=yield z(i.read());if(u){if(a.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const c=r.decode(d,{stream:!0});try{const p=JSON.parse(c);if("error"in p){const h=JSON.parse(JSON.stringify(p.error)),m=h.status,_=h.code,g=`got status: ${m}. ${JSON.stringify(p)}`;if(_>=400&&_<600)throw new Mn({message:g,status:_})}}catch(p){if(p.name==="ApiError")throw p}a+=c;let f=a.match(Zr);for(;f;){const p=f[1];try{const h=new Response(p,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield z(new ds(h)),a=a.slice(f[0].length),f=a.match(Zr)}catch(h){throw new Error(`exception parsing stream chunk ${p}. ${h}`)}}}}finally{i.releaseLock()}})}async apiCall(e,n){return fetch(e,n).catch(s=>{throw new Error(`exception ${s} sending request`)})}getDefaultHeaders(){const e={},n=Op+" "+this.clientOptions.userAgentExtra;return e[qp]=n,e[gs]=n,e[Gp]="application/json",e}async getHeadersInternal(e,n){const s=new Headers;if(e&&e.headers){for(const[i,r]of Object.entries(e.headers))s.append(i,r);e.timeout&&e.timeout>0&&s.append(Vp,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(s,n),s}getFileName(e){var n;let s="";return typeof e=="string"&&(s=e.replace(/[/\\]+$/,""),s=(n=s.split(/[/\\]/).pop())!==null&&n!==void 0?n:""),s}async uploadFile(e,n){var s;const i={};n!=null&&(i.mimeType=n.mimeType,i.name=n.name,i.displayName=n.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);const r=this.clientOptions.uploader,a=await r.stat(e);i.sizeBytes=String(a.size);const u=(s=n==null?void 0:n.mimeType)!==null&&s!==void 0?s:a.type;if(u===void 0||u==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=u;const d={file:i},c=this.getFileName(e),f=A("upload/v1beta/files",d._url),p=await this.fetchUploadUrl(f,i.sizeBytes,i.mimeType,c,d,n==null?void 0:n.httpOptions);return r.upload(e,p,this)}async uploadFileToFileSearchStore(e,n,s){var i;const r=this.clientOptions.uploader,a=await r.stat(n),u=String(a.size),d=(i=s==null?void 0:s.mimeType)!==null&&i!==void 0?i:a.type;if(d===void 0||d==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const c=`upload/v1beta/${e}:uploadToFileSearchStore`,f=this.getFileName(n),p={};s!=null&&s.customMetadata&&(p.customMetadata=s.customMetadata),s!=null&&s.chunkingConfig&&(p.chunkingConfig=s.chunkingConfig);const h=await this.fetchUploadUrl(c,u,d,f,p,s==null?void 0:s.httpOptions);return r.uploadToFileSearchStore(n,h,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,n,s,i,r,a){var u;let d={};a?d=a:d={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${n}`,"X-Goog-Upload-Header-Content-Type":`${s}`},i?{"X-Goog-Upload-File-Name":i}:{})};const c=await this.request({path:e,body:JSON.stringify(r),httpMethod:"POST",httpOptions:d});if(!c||!(c!=null&&c.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const f=(u=c==null?void 0:c.headers)===null||u===void 0?void 0:u["x-goog-upload-url"];if(f===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return f}}async function Xr(t){var e;if(t===void 0)throw new Error("response is undefined");if(!t.ok){const n=t.status;let s;!((e=t.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?s=await t.json():s={error:{message:await t.text(),code:t.status,status:t.statusText}};const i=JSON.stringify(s);throw n>=400&&n<600?new Mn({message:i,status:n}):new Error(i)}}function Yp(t,e){if(!e||Object.keys(e).length===0)return;if(t.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let n={};if(typeof t.body=="string"&&t.body.length>0)try{const r=JSON.parse(t.body);if(typeof r=="object"&&r!==null&&!Array.isArray(r))n=r;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function s(r,a){const u=Object.assign({},r);for(const d in a)if(Object.prototype.hasOwnProperty.call(a,d)){const c=a[d],f=u[d];c&&typeof c=="object"&&!Array.isArray(c)&&f&&typeof f=="object"&&!Array.isArray(f)?u[d]=s(f,c):(f&&c&&typeof f!=typeof c&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${d}". Original type: ${typeof f}, New type: ${typeof c}. Overwriting.`),u[d]=c)}return u}const i=s(n,e);t.body=JSON.stringify(i)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Kp="mcp_used/unknown";let zp=!1;function wa(t){for(const e of t)if(Zp(e)||typeof e=="object"&&"inputSchema"in e)return!0;return zp}function Ia(t){var e;const n=(e=t[gs])!==null&&e!==void 0?e:"";t[gs]=(n+` ${Kp}`).trimStart()}function Zp(t){return t!==null&&typeof t=="object"&&t instanceof Ws}function Xp(t,e=100){return pt(this,arguments,function*(){let s,i=0;for(;i<e;){const r=yield z(t.listTools({cursor:s}));for(const a of r.tools)yield yield z(a),i++;if(!r.nextCursor)break;s=r.nextCursor}})}class Ws{constructor(e=[],n){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=n}static create(e,n){return new Ws(e,n)}async initialize(){var e,n,s,i;if(this.mcpTools.length>0)return;const r={},a=[];for(const f of this.mcpClients)try{for(var u=!0,d=(n=void 0,Ft(Xp(f))),c;c=await d.next(),e=c.done,!e;u=!0){i=c.value,u=!1;const p=i;a.push(p);const h=p.name;if(r[h])throw new Error(`Duplicate function name ${h} found in MCP tools. Please ensure function names are unique.`);r[h]=f}}catch(p){n={error:p}}finally{try{!u&&!e&&(s=d.return)&&await s.call(d)}finally{if(n)throw n.error}}this.mcpTools=a,this.functionNameToMcpClient=r}async tool(){return await this.initialize(),tc(this.mcpTools,this.config)}async callTool(e){await this.initialize();const n=[];for(const s of e)if(s.name in this.functionNameToMcpClient){const i=this.functionNameToMcpClient[s.name];let r;this.config.timeout&&(r={timeout:this.config.timeout});const a=await i.callTool({name:s.name,arguments:s.args},void 0,r);n.push({functionResponse:{name:s.name,response:a.isError?{error:a}:a}})}return n}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function Qp(t,e,n){const s=new Yu;let i;n.data instanceof Blob?i=JSON.parse(await n.data.text()):i=JSON.parse(n.data),Object.assign(s,i),e(s)}class jp{constructor(e,n,s){this.apiClient=e,this.auth=n,this.webSocketFactory=s}async connect(e){var n,s;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const i=this.apiClient.getWebsocketBaseUrl(),r=this.apiClient.getApiVersion(),a=nh(this.apiClient.getDefaultHeaders()),u=this.apiClient.getApiKey(),d=`${i}/ws/google.ai.generativelanguage.${r}.GenerativeService.BidiGenerateMusic?key=${u}`;let c=()=>{};const f=new Promise(S=>{c=S}),p=e.callbacks,h=function(){c({})},m=this.apiClient,_={onopen:h,onmessage:S=>{Qp(m,p.onmessage,S)},onerror:(n=p==null?void 0:p.onerror)!==null&&n!==void 0?n:function(S){},onclose:(s=p==null?void 0:p.onclose)!==null&&s!==void 0?s:function(S){}},g=this.webSocketFactory.create(d,th(a),_);g.connect(),await f;const v={setup:{model:Y(this.apiClient,e.model)}};return g.send(JSON.stringify(v)),new eh(g,this.apiClient)}}class eh{constructor(e,n){this.conn=e,this.apiClient=n}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const n=Hd(e);this.conn.send(JSON.stringify({clientContent:n}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const n=Od(e);this.conn.send(JSON.stringify(n))}sendPlaybackControl(e){const n={playbackControl:e};this.conn.send(JSON.stringify(n))}play(){this.sendPlaybackControl(ct.PLAY)}pause(){this.sendPlaybackControl(ct.PAUSE)}stop(){this.sendPlaybackControl(ct.STOP)}resetContext(){this.sendPlaybackControl(ct.RESET_CONTEXT)}close(){this.conn.close()}}function th(t){const e={};return t.forEach((n,s)=>{e[s]=n}),e}function nh(t){const e=new Headers;for(const[n,s]of Object.entries(t))e.append(n,s);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const sh="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function ih(t,e,n){const s=new Wu;let i;n.data instanceof Blob?i=await n.data.text():n.data instanceof ArrayBuffer?i=new TextDecoder().decode(n.data):i=n.data;const r=JSON.parse(i);if(t.isVertexAI()){const a=Yd(r);Object.assign(s,a)}else Object.assign(s,r);e(s)}class rh{constructor(e,n,s){this.apiClient=e,this.auth=n,this.webSocketFactory=s,this.music=new jp(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var n,s,i,r,a,u;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const d=this.apiClient.getWebsocketBaseUrl(),c=this.apiClient.getApiVersion();let f;const p=this.apiClient.getHeaders();e.config&&e.config.tools&&wa(e.config.tools)&&Ia(p);const h=uh(p);if(this.apiClient.isVertexAI())f=`${d}/ws/google.cloud.aiplatform.${c}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(h,f);else{const P=this.apiClient.getApiKey();let M="BidiGenerateContent",U="key";P!=null&&P.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),c!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),M="BidiGenerateContentConstrained",U="access_token"),f=`${d}/ws/google.ai.generativelanguage.${c}.GenerativeService.${M}?${U}=${P}`}let m=()=>{};const _=new Promise(P=>{m=P}),g=e.callbacks,T=function(){var P;(P=g==null?void 0:g.onopen)===null||P===void 0||P.call(g),m({})},w=this.apiClient,v={onopen:T,onmessage:P=>{ih(w,g.onmessage,P)},onerror:(n=g==null?void 0:g.onerror)!==null&&n!==void 0?n:function(P){},onclose:(s=g==null?void 0:g.onclose)!==null&&s!==void 0?s:function(P){}},S=this.webSocketFactory.create(f,lh(h),v);S.connect(),await _;let C=Y(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&C.startsWith("publishers/")){const P=this.apiClient.getProject(),M=this.apiClient.getLocation();C=`projects/${P}/locations/${M}/`+C}let N={};this.apiClient.isVertexAI()&&((i=e.config)===null||i===void 0?void 0:i.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[yn.AUDIO]}:e.config.responseModalities=[yn.AUDIO]),!((r=e.config)===null||r===void 0)&&r.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const R=(u=(a=e.config)===null||a===void 0?void 0:a.tools)!==null&&u!==void 0?u:[],I=[];for(const P of R)if(this.isCallableTool(P)){const M=P;I.push(await M.tool())}else I.push(P);I.length>0&&(e.config.tools=I);const q={model:C,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?N=Bd(this.apiClient,q):N=qd(this.apiClient,q),delete N.config,S.send(JSON.stringify(N)),new ah(S,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const oh={turnComplete:!0};class ah{constructor(e,n){this.conn=e,this.apiClient=n}tLiveClientContent(e,n){if(n.turns!==null&&n.turns!==void 0){let s=[];try{s=ye(n.turns),e.isVertexAI()||(s=s.map(i=>kn(i)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof n.turns}'`)}return{clientContent:{turns:s,turnComplete:n.turnComplete}}}return{clientContent:{turnComplete:n.turnComplete}}}tLiveClienttToolResponse(e,n){let s=[];if(n.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(n.functionResponses)?s=n.functionResponses:s=[n.functionResponses],s.length===0)throw new Error("functionResponses is required.");for(const r of s){if(typeof r!="object"||r===null||!("name"in r)||!("response"in r))throw new Error(`Could not parse function response, type '${typeof r}'.`);if(!e.isVertexAI()&&!("id"in r))throw new Error(sh)}return{toolResponse:{functionResponses:s}}}sendClientContent(e){e=Object.assign(Object.assign({},oh),e);const n=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(n))}sendRealtimeInput(e){let n={};this.apiClient.isVertexAI()?n={realtimeInput:Wd(e)}:n={realtimeInput:Jd(e)},this.conn.send(JSON.stringify(n))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const n=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(n))}close(){this.conn.close()}}function lh(t){const e={};return t.forEach((n,s)=>{e[s]=n}),e}function uh(t){const e=new Headers;for(const[n,s]of Object.entries(t))e.append(n,s);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Qr=10;function jr(t){var e,n,s;if(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let i=!1;for(const a of(n=t==null?void 0:t.tools)!==null&&n!==void 0?n:[])if(ht(a)){i=!0;break}if(!i)return!0;const r=(s=t==null?void 0:t.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls;return r&&(r<0||!Number.isInteger(r))||r==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",r),!0):!1}function ht(t){return"callTool"in t&&typeof t.callTool=="function"}function ch(t){var e,n,s;return(s=(n=(e=t.config)===null||e===void 0?void 0:e.tools)===null||n===void 0?void 0:n.some(i=>ht(i)))!==null&&s!==void 0?s:!1}function eo(t){var e;const n=[];return!((e=t==null?void 0:t.config)===null||e===void 0)&&e.tools&&t.config.tools.forEach((s,i)=>{if(ht(s))return;const r=s;r.functionDeclarations&&r.functionDeclarations.length>0&&n.push(i)}),n}function to(t){var e;return!(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let dh=class extends De{constructor(e){super(),this.apiClient=e,this.generateContent=async n=>{var s,i,r,a,u;const d=await this.processParamsMaybeAddMcpUsage(n);if(this.maybeMoveToResponseJsonSchem(n),!ch(n)||jr(n.config))return await this.generateContentInternal(d);const c=eo(n);if(c.length>0){const g=c.map(T=>`tools[${T}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${g}.`)}let f,p;const h=ye(d.contents),m=(r=(i=(s=d.config)===null||s===void 0?void 0:s.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&r!==void 0?r:Qr;let _=0;for(;_<m&&(f=await this.generateContentInternal(d),!(!f.functionCalls||f.functionCalls.length===0));){const g=f.candidates[0].content,T=[];for(const w of(u=(a=n.config)===null||a===void 0?void 0:a.tools)!==null&&u!==void 0?u:[])if(ht(w)){const S=await w.callTool(f.functionCalls);T.push(...S)}_++,p={role:"user",parts:T},d.contents=ye(d.contents),d.contents.push(g),d.contents.push(p),to(d.config)&&(h.push(g),h.push(p))}return to(d.config)&&(f.automaticFunctionCallingHistory=h),f},this.generateContentStream=async n=>{if(this.maybeMoveToResponseJsonSchem(n),jr(n.config)){const i=await this.processParamsMaybeAddMcpUsage(n);return await this.generateContentStreamInternal(i)}const s=eo(n);if(s.length>0){const i=s.map(r=>`tools[${r}]`).join(", ");throw new Error(`Incompatible tools found at ${i}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}return await this.processAfcStream(n)},this.generateImages=async n=>await this.generateImagesInternal(n).then(s=>{var i;let r;const a=[];if(s!=null&&s.generatedImages)for(const d of s.generatedImages)d&&(d!=null&&d.safetyAttributes)&&((i=d==null?void 0:d.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?r=d==null?void 0:d.safetyAttributes:a.push(d);let u;return r?u={generatedImages:a,positivePromptSafetyAttributes:r,sdkHttpResponse:s.sdkHttpResponse}:u={generatedImages:a,sdkHttpResponse:s.sdkHttpResponse},u}),this.list=async n=>{var s;const a={config:Object.assign(Object.assign({},{queryBase:!0}),n==null?void 0:n.config)};if(this.apiClient.isVertexAI()&&!a.config.queryBase){if(!((s=a.config)===null||s===void 0)&&s.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");a.config.filter="labels.tune-type:*"}return new nt(ke.PAGED_ITEM_MODELS,u=>this.listInternal(u),await this.listInternal(a),a)},this.editImage=async n=>{const s={model:n.model,prompt:n.prompt,referenceImages:[],config:n.config};return n.referenceImages&&n.referenceImages&&(s.referenceImages=n.referenceImages.map(i=>i.toReferenceImageAPI())),await this.editImageInternal(s)},this.upscaleImage=async n=>{let s={numberOfImages:1,mode:"upscale"};n.config&&(s=Object.assign(Object.assign({},s),n.config));const i={model:n.model,image:n.image,upscaleFactor:n.upscaleFactor,config:s};return await this.upscaleImageInternal(i)},this.generateVideos=async n=>{var s,i,r,a,u,d;if((n.prompt||n.image||n.video)&&n.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((s=n.video)===null||s===void 0)&&s.uri&&(!((i=n.video)===null||i===void 0)&&i.videoBytes)?n.video={uri:n.video.uri,mimeType:n.video.mimeType}:!((a=(r=n.source)===null||r===void 0?void 0:r.video)===null||a===void 0)&&a.uri&&(!((d=(u=n.source)===null||u===void 0?void 0:u.video)===null||d===void 0)&&d.videoBytes)&&(n.source.video={uri:n.source.video.uri,mimeType:n.source.video.mimeType})),await this.generateVideosInternal(n)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var n,s,i;const r=(n=e.config)===null||n===void 0?void 0:n.tools;if(!r)return e;const a=await Promise.all(r.map(async d=>ht(d)?await d.tool():d)),u={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:a})};if(u.config.tools=a,e.config&&e.config.tools&&wa(e.config.tools)){const d=(i=(s=e.config.httpOptions)===null||s===void 0?void 0:s.headers)!==null&&i!==void 0?i:{};let c=Object.assign({},d);Object.keys(c).length===0&&(c=this.apiClient.getDefaultHeaders()),Ia(c),u.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:c})}return u}async initAfcToolsMap(e){var n,s,i;const r=new Map;for(const a of(s=(n=e.config)===null||n===void 0?void 0:n.tools)!==null&&s!==void 0?s:[])if(ht(a)){const u=a,d=await u.tool();for(const c of(i=d.functionDeclarations)!==null&&i!==void 0?i:[]){if(!c.name)throw new Error("Function declaration name is required.");if(r.has(c.name))throw new Error(`Duplicate tool declaration name: ${c.name}`);r.set(c.name,u)}}return r}async processAfcStream(e){var n,s,i;const r=(i=(s=(n=e.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls)!==null&&i!==void 0?i:Qr;let a=!1,u=0;const d=await this.initAfcToolsMap(e);return(function(c,f,p){var h,m;return pt(this,arguments,function*(){for(var _,g,T,w;u<r;){a&&(u++,a=!1);const N=yield z(c.processParamsMaybeAddMcpUsage(p)),R=yield z(c.generateContentStreamInternal(N)),I=[],q=[];try{for(var v=!0,S=(g=void 0,Ft(R)),C;C=yield z(S.next()),_=C.done,!_;v=!0){w=C.value,v=!1;const P=w;if(yield yield z(P),P.candidates&&(!((h=P.candidates[0])===null||h===void 0)&&h.content)){q.push(P.candidates[0].content);for(const M of(m=P.candidates[0].content.parts)!==null&&m!==void 0?m:[])if(u<r&&M.functionCall){if(!M.functionCall.name)throw new Error("Function call name was not returned by the model.");if(f.has(M.functionCall.name)){const U=yield z(f.get(M.functionCall.name).callTool([M.functionCall]));I.push(...U)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${f.keys()}, mising tool: ${M.functionCall.name}`)}}}}catch(P){g={error:P}}finally{try{!v&&!_&&(T=S.return)&&(yield z(T.call(S)))}finally{if(g)throw g.error}}if(I.length>0){a=!0;const P=new xt;P.candidates=[{content:{role:"user",parts:I}}],yield yield z(P);const M=[];M.push(...q),M.push({role:"user",parts:I});const U=ye(p.contents).concat(M);p.contents=U}else break}})})(this,d,e)}async generateContentInternal(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=Yr(this.apiClient,e);return u=A("{model}:generateContent",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=zr(f),h=new xt;return Object.assign(h,p),h})}else{const c=Wr(this.apiClient,e);return u=A("{model}:generateContent",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=Kr(f),h=new xt;return Object.assign(h,p),h})}}async generateContentStreamInternal(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=Yr(this.apiClient,e);return u=A("{model}:streamGenerateContent?alt=sse",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.requestStream({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}),a.then(function(p){return pt(this,arguments,function*(){var h,m,_,g;try{for(var T=!0,w=Ft(p),v;v=yield z(w.next()),h=v.done,!h;T=!0){g=v.value,T=!1;const S=g,C=zr(yield z(S.json()));C.sdkHttpResponse={headers:S.headers};const N=new xt;Object.assign(N,C),yield yield z(N)}}catch(S){m={error:S}}finally{try{!T&&!h&&(_=w.return)&&(yield z(_.call(w)))}finally{if(m)throw m.error}}})})}else{const c=Wr(this.apiClient,e);return u=A("{model}:streamGenerateContent?alt=sse",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.requestStream({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),a.then(function(p){return pt(this,arguments,function*(){var h,m,_,g;try{for(var T=!0,w=Ft(p),v;v=yield z(w.next()),h=v.done,!h;T=!0){g=v.value,T=!1;const S=g,C=Kr(yield z(S.json()));C.sdkHttpResponse={headers:S.headers};const N=new xt;Object.assign(N,C),yield yield z(N)}}catch(S){m={error:S}}finally{try{!T&&!h&&(_=w.return)&&(yield z(_.call(w)))}finally{if(m)throw m.error}}})})}}async embedContent(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=wf(this.apiClient,e);return u=A("{model}:predict",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=Af(f),h=new Nr;return Object.assign(h,p),h})}else{const c=Ef(this.apiClient,e);return u=A("{model}:batchEmbedContents",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=If(f),h=new Nr;return Object.assign(h,p),h})}}async generateImagesInternal(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=Uf(this.apiClient,e);return u=A("{model}:predict",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=Ff(f),h=new Mr;return Object.assign(h,p),h})}else{const c=Df(this.apiClient,e);return u=A("{model}:predict",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=Lf(f),h=new Mr;return Object.assign(h,p),h})}}async editImageInternal(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI()){const u=Tf(this.apiClient,e);return r=A("{model}:predict",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(c=>{const f=c;return f.sdkHttpResponse={headers:d.headers},f})),i.then(d=>{const c=vf(d),f=new Uu;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI()){const u=kp(this.apiClient,e);return r=A("{model}:predict",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(c=>{const f=c;return f.sdkHttpResponse={headers:d.headers},f})),i.then(d=>{const c=bp(d),f=new Lu;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI()){const u=hp(this.apiClient,e);return r=A("{model}:predict",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>{const c=mp(d),f=new Fu;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI()){const u=Sp(this.apiClient,e);return r=A("{model}:predict",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>{const c=Cp(d),f=new $u;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=ep(this.apiClient,e);return u=A("{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(f=>ms(f))}else{const c=jf(this.apiClient,e);return u=A("{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),a.then(f=>hs(f))}}async listInternal(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=ap(this.apiClient,e);return u=A("{models_url}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=up(f),h=new kr;return Object.assign(h,p),h})}else{const c=op(this.apiClient,e);return u=A("{models_url}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=lp(f),h=new kr;return Object.assign(h,p),h})}}async update(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=Np(this.apiClient,e);return u=A("{model}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(f=>ms(f))}else{const c=xp(this.apiClient,e);return u=A("{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),a.then(f=>hs(f))}}async delete(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=mf(this.apiClient,e);return u=A("{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=yf(f),h=new br;return Object.assign(h,p),h})}else{const c=hf(this.apiClient,e);return u=A("{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=gf(f),h=new br;return Object.assign(h,p),h})}}async countTokens(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=df(this.apiClient,e);return u=A("{model}:countTokens",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=pf(f),h=new Dr;return Object.assign(h,p),h})}else{const c=cf(this.apiClient,e);return u=A("{model}:countTokens",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=ff(f),h=new Dr;return Object.assign(h,p),h})}}async computeTokens(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI()){const u=nf(this.apiClient,e);return r=A("{model}:computeTokens",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(c=>{const f=c;return f.sdkHttpResponse={headers:d.headers},f})),i.then(d=>{const c=sf(d),f=new Gu;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=Of(this.apiClient,e);return u=A("{model}:predictLongRunning",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a.then(f=>{const p=qf(f),h=new _n;return Object.assign(h,p),h})}else{const c=Bf(this.apiClient,e);return u=A("{model}:predictLongRunning",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),a.then(f=>{const p=Vf(f),h=new _n;return Object.assign(h,p),h})}}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class fh extends De{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const n=e.operation,s=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=n.name.split("/operations/")[0];let r;s&&"httpOptions"in s&&(r=s.httpOptions);const a=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:i,config:{httpOptions:r}});return n._fromAPIResponse({apiResponse:a,_isVertexAI:!0})}else{const i=await this.getVideosOperationInternal({operationName:n.name,config:s});return n._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async get(e){const n=e.operation,s=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=n.name.split("/operations/")[0];let r;s&&"httpOptions"in s&&(r=s.httpOptions);const a=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:i,config:{httpOptions:r}});return n._fromAPIResponse({apiResponse:a,_isVertexAI:!0})}else{const i=await this.getVideosOperationInternal({operationName:n.name,config:s});return n._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async getVideosOperationInternal(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=xu(e);return u=A("{operationName}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),a}else{const c=Pu(e);return u=A("{operationName}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),a}}async fetchPredictVideosOperationInternal(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI()){const u=Su(e);return r=A("{resourceName}:fetchPredictOperation",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ph(t){const e={},n=o(t,["data"]);if(n!=null&&l(e,["data"],n),o(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=o(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function hh(t){const e={},n=o(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>Ch(r))),l(e,["parts"],i)}const s=o(t,["role"]);return s!=null&&l(e,["role"],s),e}function mh(t,e,n){const s={},i=o(e,["expireTime"]);n!==void 0&&i!=null&&l(n,["expireTime"],i);const r=o(e,["newSessionExpireTime"]);n!==void 0&&r!=null&&l(n,["newSessionExpireTime"],r);const a=o(e,["uses"]);n!==void 0&&a!=null&&l(n,["uses"],a);const u=o(e,["liveConnectConstraints"]);n!==void 0&&u!=null&&l(n,["bidiGenerateContentSetup"],Sh(t,u));const d=o(e,["lockAdditionalFields"]);return n!==void 0&&d!=null&&l(n,["fieldMask"],d),s}function gh(t,e){const n={},s=o(e,["config"]);return s!=null&&l(n,["config"],mh(t,s,n)),n}function yh(t){const e={};if(o(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=o(t,["fileUri"]);n!=null&&l(e,["fileUri"],n);const s=o(t,["mimeType"]);return s!=null&&l(e,["mimeType"],s),e}function _h(t){const e={};if(o(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=o(t,["enableWidget"]);return n!=null&&l(e,["enableWidget"],n),e}function Th(t){const e={};if(o(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(o(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=o(t,["timeRangeFilter"]);return n!=null&&l(e,["timeRangeFilter"],n),e}function vh(t,e){const n={},s=o(t,["generationConfig"]);e!==void 0&&s!=null&&l(e,["setup","generationConfig"],s);const i=o(t,["responseModalities"]);e!==void 0&&i!=null&&l(e,["setup","generationConfig","responseModalities"],i);const r=o(t,["temperature"]);e!==void 0&&r!=null&&l(e,["setup","generationConfig","temperature"],r);const a=o(t,["topP"]);e!==void 0&&a!=null&&l(e,["setup","generationConfig","topP"],a);const u=o(t,["topK"]);e!==void 0&&u!=null&&l(e,["setup","generationConfig","topK"],u);const d=o(t,["maxOutputTokens"]);e!==void 0&&d!=null&&l(e,["setup","generationConfig","maxOutputTokens"],d);const c=o(t,["mediaResolution"]);e!==void 0&&c!=null&&l(e,["setup","generationConfig","mediaResolution"],c);const f=o(t,["seed"]);e!==void 0&&f!=null&&l(e,["setup","generationConfig","seed"],f);const p=o(t,["speechConfig"]);e!==void 0&&p!=null&&l(e,["setup","generationConfig","speechConfig"],Js(p));const h=o(t,["thinkingConfig"]);e!==void 0&&h!=null&&l(e,["setup","generationConfig","thinkingConfig"],h);const m=o(t,["enableAffectiveDialog"]);e!==void 0&&m!=null&&l(e,["setup","generationConfig","enableAffectiveDialog"],m);const _=o(t,["systemInstruction"]);e!==void 0&&_!=null&&l(e,["setup","systemInstruction"],hh(ae(_)));const g=o(t,["tools"]);if(e!==void 0&&g!=null){let R=wt(g);Array.isArray(R)&&(R=R.map(I=>wh(Et(I)))),l(e,["setup","tools"],R)}const T=o(t,["sessionResumption"]);e!==void 0&&T!=null&&l(e,["setup","sessionResumption"],Eh(T));const w=o(t,["inputAudioTranscription"]);e!==void 0&&w!=null&&l(e,["setup","inputAudioTranscription"],w);const v=o(t,["outputAudioTranscription"]);e!==void 0&&v!=null&&l(e,["setup","outputAudioTranscription"],v);const S=o(t,["realtimeInputConfig"]);e!==void 0&&S!=null&&l(e,["setup","realtimeInputConfig"],S);const C=o(t,["contextWindowCompression"]);e!==void 0&&C!=null&&l(e,["setup","contextWindowCompression"],C);const N=o(t,["proactivity"]);return e!==void 0&&N!=null&&l(e,["setup","proactivity"],N),n}function Sh(t,e){const n={},s=o(e,["model"]);s!=null&&l(n,["setup","model"],Y(t,s));const i=o(e,["config"]);return i!=null&&l(n,["config"],vh(i,n)),n}function Ch(t){const e={},n=o(t,["functionCall"]);n!=null&&l(e,["functionCall"],n);const s=o(t,["codeExecutionResult"]);s!=null&&l(e,["codeExecutionResult"],s);const i=o(t,["executableCode"]);i!=null&&l(e,["executableCode"],i);const r=o(t,["fileData"]);r!=null&&l(e,["fileData"],yh(r));const a=o(t,["functionResponse"]);a!=null&&l(e,["functionResponse"],a);const u=o(t,["inlineData"]);u!=null&&l(e,["inlineData"],ph(u));const d=o(t,["text"]);d!=null&&l(e,["text"],d);const c=o(t,["thought"]);c!=null&&l(e,["thought"],c);const f=o(t,["thoughtSignature"]);f!=null&&l(e,["thoughtSignature"],f);const p=o(t,["videoMetadata"]);return p!=null&&l(e,["videoMetadata"],p),e}function Eh(t){const e={},n=o(t,["handle"]);if(n!=null&&l(e,["handle"],n),o(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function wh(t){const e={},n=o(t,["functionDeclarations"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(p=>p)),l(e,["functionDeclarations"],f)}if(o(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=o(t,["googleSearchRetrieval"]);s!=null&&l(e,["googleSearchRetrieval"],s);const i=o(t,["computerUse"]);i!=null&&l(e,["computerUse"],i);const r=o(t,["fileSearch"]);r!=null&&l(e,["fileSearch"],r);const a=o(t,["codeExecution"]);if(a!=null&&l(e,["codeExecution"],a),o(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const u=o(t,["googleMaps"]);u!=null&&l(e,["googleMaps"],_h(u));const d=o(t,["googleSearch"]);d!=null&&l(e,["googleSearch"],Th(d));const c=o(t,["urlContext"]);return c!=null&&l(e,["urlContext"],c),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ih(t){const e=[];for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const s=t[n];if(typeof s=="object"&&s!=null&&Object.keys(s).length>0){const i=Object.keys(s).map(r=>`${n}.${r}`);e.push(...i)}else e.push(n)}return e.join(",")}function Ah(t,e){let n=null;const s=t.bidiGenerateContentSetup;if(typeof s=="object"&&s!==null&&"setup"in s){const r=s.setup;typeof r=="object"&&r!==null?(t.bidiGenerateContentSetup=r,n=r):delete t.bidiGenerateContentSetup}else s!==void 0&&delete t.bidiGenerateContentSetup;const i=t.fieldMask;if(n){const r=Ih(n);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)r?t.fieldMask=r:delete t.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&i!==null&&Array.isArray(i)&&i.length>0){const a=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let u=[];i.length>0&&(u=i.map(c=>a.includes(c)?`generationConfig.${c}`:c));const d=[];r&&d.push(r),u.length>0&&d.push(...u),d.length>0?t.fieldMask=d.join(","):delete t.fieldMask}else delete t.fieldMask}else i!==null&&Array.isArray(i)&&i.length>0?t.fieldMask=i.join(","):delete t.fieldMask;return t}class Rh extends De{constructor(e){super(),this.apiClient=e}async create(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const u=gh(this.apiClient,e);r=A("auth_tokens",u._url),a=u._query,delete u.config,delete u._url,delete u._query;const d=Ah(u,e.config);return i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json()),i.then(c=>c)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ph(t,e){const n={},s=o(t,["displayName"]);return e!==void 0&&s!=null&&l(e,["displayName"],s),n}function xh(t){const e={},n=o(t,["config"]);return n!=null&&Ph(n,e),e}function Nh(t,e){const n={},s=o(t,["force"]);return e!==void 0&&s!=null&&l(e,["_query","force"],s),n}function Mh(t){const e={},n=o(t,["name"]);n!=null&&l(e,["_url","name"],n);const s=o(t,["config"]);return s!=null&&Nh(s,e),e}function kh(t){const e={},n=o(t,["name"]);return n!=null&&l(e,["_url","name"],n),e}function bh(t,e){const n={},s=o(t,["customMetadata"]);if(e!==void 0&&s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>a)),l(e,["customMetadata"],r)}const i=o(t,["chunkingConfig"]);return e!==void 0&&i!=null&&l(e,["chunkingConfig"],i),n}function Dh(t){const e={},n=o(t,["name"]);n!=null&&l(e,["name"],n);const s=o(t,["metadata"]);s!=null&&l(e,["metadata"],s);const i=o(t,["done"]);i!=null&&l(e,["done"],i);const r=o(t,["error"]);r!=null&&l(e,["error"],r);const a=o(t,["response"]);return a!=null&&l(e,["response"],Lh(a)),e}function Uh(t){const e={},n=o(t,["fileSearchStoreName"]);n!=null&&l(e,["_url","file_search_store_name"],n);const s=o(t,["fileName"]);s!=null&&l(e,["fileName"],s);const i=o(t,["config"]);return i!=null&&bh(i,e),e}function Lh(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["parent"]);s!=null&&l(e,["parent"],s);const i=o(t,["documentName"]);return i!=null&&l(e,["documentName"],i),e}function Fh(t,e){const n={},s=o(t,["pageSize"]);e!==void 0&&s!=null&&l(e,["_query","pageSize"],s);const i=o(t,["pageToken"]);return e!==void 0&&i!=null&&l(e,["_query","pageToken"],i),n}function $h(t){const e={},n=o(t,["config"]);return n!=null&&Fh(n,e),e}function Gh(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["nextPageToken"]);s!=null&&l(e,["nextPageToken"],s);const i=o(t,["fileSearchStores"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(a=>a)),l(e,["fileSearchStores"],r)}return e}function Vh(t,e){const n={},s=o(t,["mimeType"]);e!==void 0&&s!=null&&l(e,["mimeType"],s);const i=o(t,["displayName"]);e!==void 0&&i!=null&&l(e,["displayName"],i);const r=o(t,["customMetadata"]);if(e!==void 0&&r!=null){let u=r;Array.isArray(u)&&(u=u.map(d=>d)),l(e,["customMetadata"],u)}const a=o(t,["chunkingConfig"]);return e!==void 0&&a!=null&&l(e,["chunkingConfig"],a),n}function qh(t){const e={},n=o(t,["fileSearchStoreName"]);n!=null&&l(e,["_url","file_search_store_name"],n);const s=o(t,["config"]);return s!=null&&Vh(s,e),e}function Bh(t){const e={},n=o(t,["sdkHttpResponse"]);return n!=null&&l(e,["sdkHttpResponse"],n),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Oh(t,e){const n={},s=o(t,["force"]);return e!==void 0&&s!=null&&l(e,["_query","force"],s),n}function Hh(t){const e={},n=o(t,["name"]);n!=null&&l(e,["_url","name"],n);const s=o(t,["config"]);return s!=null&&Oh(s,e),e}function Jh(t){const e={},n=o(t,["name"]);return n!=null&&l(e,["_url","name"],n),e}function Wh(t,e){const n={},s=o(t,["pageSize"]);e!==void 0&&s!=null&&l(e,["_query","pageSize"],s);const i=o(t,["pageToken"]);return e!==void 0&&i!=null&&l(e,["_query","pageToken"],i),n}function Yh(t){const e={},n=o(t,["parent"]);n!=null&&l(e,["_url","parent"],n);const s=o(t,["config"]);return s!=null&&Wh(s,e),e}function Kh(t){const e={},n=o(t,["sdkHttpResponse"]);n!=null&&l(e,["sdkHttpResponse"],n);const s=o(t,["nextPageToken"]);s!=null&&l(e,["nextPageToken"],s);const i=o(t,["documents"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(a=>a)),l(e,["documents"],r)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class zh extends De{constructor(e){super(),this.apiClient=e,this.list=async n=>new nt(ke.PAGED_ITEM_DOCUMENTS,s=>this.listInternal({parent:n.parent,config:s.config}),await this.listInternal(n),n)}async get(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Jh(e);return r=A("{name}",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>d)}}async delete(e){var n,s;let i="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=Hh(e);i=A("{name}",a._url),r=a._query,delete a._url,delete a._query,await this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}}async listInternal(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Yh(e);return r=A("{parent}/documents",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>{const c=Kh(d),f=new Vu;return Object.assign(f,c),f})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Zh extends De{constructor(e,n=new zh(e)){super(),this.apiClient=e,this.documents=n,this.list=async(s={})=>new nt(ke.PAGED_ITEM_FILE_SEARCH_STORES,i=>this.listInternal(i),await this.listInternal(s),s)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=xh(e);return r=A("fileSearchStores",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>d)}}async get(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=kh(e);return r=A("{name}",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>d)}}async delete(e){var n,s;let i="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=Mh(e);i=A("{name}",a._url),r=a._query,delete a._url,delete a._query,await this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}}async listInternal(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=$h(e);return r=A("fileSearchStores",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>{const c=Gh(d),f=new qu;return Object.assign(f,c),f})}}async uploadToFileSearchStoreInternal(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=qh(e);return r=A("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>{const c=Bh(d),f=new Bu;return Object.assign(f,c),f})}}async importFile(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Uh(e);return r=A("{file_search_store_name}:importFile",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>{const c=Dh(d),f=new Vs;return Object.assign(f,c),f})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Xh(t,e){const n={},s=o(t,["name"]);return s!=null&&l(n,["_url","name"],s),n}function Qh(t,e){const n={},s=o(t,["name"]);return s!=null&&l(n,["_url","name"],s),n}function jh(t,e,n){const s={};if(o(t,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const i=o(t,["tunedModelDisplayName"]);if(e!==void 0&&i!=null&&l(e,["displayName"],i),o(t,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const r=o(t,["epochCount"]);e!==void 0&&r!=null&&l(e,["tuningTask","hyperparameters","epochCount"],r);const a=o(t,["learningRateMultiplier"]);if(a!=null&&l(s,["tuningTask","hyperparameters","learningRateMultiplier"],a),o(t,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(o(t,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(o(t,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const u=o(t,["batchSize"]);e!==void 0&&u!=null&&l(e,["tuningTask","hyperparameters","batchSize"],u);const d=o(t,["learningRate"]);if(e!==void 0&&d!=null&&l(e,["tuningTask","hyperparameters","learningRate"],d),o(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(o(t,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return s}function em(t,e,n){const s={};let i=o(n,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){const m=o(t,["validationDataset"]);e!==void 0&&m!=null&&l(e,["supervisedTuningSpec"],no(m))}else if(i==="PREFERENCE_TUNING"){const m=o(t,["validationDataset"]);e!==void 0&&m!=null&&l(e,["preferenceOptimizationSpec"],no(m))}const r=o(t,["tunedModelDisplayName"]);e!==void 0&&r!=null&&l(e,["tunedModelDisplayName"],r);const a=o(t,["description"]);e!==void 0&&a!=null&&l(e,["description"],a);let u=o(n,["config","method"]);if(u===void 0&&(u="SUPERVISED_FINE_TUNING"),u==="SUPERVISED_FINE_TUNING"){const m=o(t,["epochCount"]);e!==void 0&&m!=null&&l(e,["supervisedTuningSpec","hyperParameters","epochCount"],m)}else if(u==="PREFERENCE_TUNING"){const m=o(t,["epochCount"]);e!==void 0&&m!=null&&l(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],m)}let d=o(n,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){const m=o(t,["learningRateMultiplier"]);e!==void 0&&m!=null&&l(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],m)}else if(d==="PREFERENCE_TUNING"){const m=o(t,["learningRateMultiplier"]);e!==void 0&&m!=null&&l(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],m)}let c=o(n,["config","method"]);if(c===void 0&&(c="SUPERVISED_FINE_TUNING"),c==="SUPERVISED_FINE_TUNING"){const m=o(t,["exportLastCheckpointOnly"]);e!==void 0&&m!=null&&l(e,["supervisedTuningSpec","exportLastCheckpointOnly"],m)}else if(c==="PREFERENCE_TUNING"){const m=o(t,["exportLastCheckpointOnly"]);e!==void 0&&m!=null&&l(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],m)}let f=o(n,["config","method"]);if(f===void 0&&(f="SUPERVISED_FINE_TUNING"),f==="SUPERVISED_FINE_TUNING"){const m=o(t,["adapterSize"]);e!==void 0&&m!=null&&l(e,["supervisedTuningSpec","hyperParameters","adapterSize"],m)}else if(f==="PREFERENCE_TUNING"){const m=o(t,["adapterSize"]);e!==void 0&&m!=null&&l(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],m)}if(o(t,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(o(t,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const p=o(t,["labels"]);e!==void 0&&p!=null&&l(e,["labels"],p);const h=o(t,["beta"]);return e!==void 0&&h!=null&&l(e,["preferenceOptimizationSpec","hyperParameters","beta"],h),s}function tm(t,e){const n={},s=o(t,["baseModel"]);s!=null&&l(n,["baseModel"],s);const i=o(t,["preTunedModel"]);i!=null&&l(n,["preTunedModel"],i);const r=o(t,["trainingDataset"]);r!=null&&fm(r);const a=o(t,["config"]);return a!=null&&jh(a,n),n}function nm(t,e){const n={},s=o(t,["baseModel"]);s!=null&&l(n,["baseModel"],s);const i=o(t,["preTunedModel"]);i!=null&&l(n,["preTunedModel"],i);const r=o(t,["trainingDataset"]);r!=null&&pm(r,n,e);const a=o(t,["config"]);return a!=null&&em(a,n,e),n}function sm(t,e){const n={},s=o(t,["name"]);return s!=null&&l(n,["_url","name"],s),n}function im(t,e){const n={},s=o(t,["name"]);return s!=null&&l(n,["_url","name"],s),n}function rm(t,e,n){const s={},i=o(t,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);const r=o(t,["pageToken"]);e!==void 0&&r!=null&&l(e,["_query","pageToken"],r);const a=o(t,["filter"]);return e!==void 0&&a!=null&&l(e,["_query","filter"],a),s}function om(t,e,n){const s={},i=o(t,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);const r=o(t,["pageToken"]);e!==void 0&&r!=null&&l(e,["_query","pageToken"],r);const a=o(t,["filter"]);return e!==void 0&&a!=null&&l(e,["_query","filter"],a),s}function am(t,e){const n={},s=o(t,["config"]);return s!=null&&rm(s,n),n}function lm(t,e){const n={},s=o(t,["config"]);return s!=null&&om(s,n),n}function um(t,e){const n={},s=o(t,["sdkHttpResponse"]);s!=null&&l(n,["sdkHttpResponse"],s);const i=o(t,["nextPageToken"]);i!=null&&l(n,["nextPageToken"],i);const r=o(t,["tunedModels"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(u=>Aa(u))),l(n,["tuningJobs"],a)}return n}function cm(t,e){const n={},s=o(t,["sdkHttpResponse"]);s!=null&&l(n,["sdkHttpResponse"],s);const i=o(t,["nextPageToken"]);i!=null&&l(n,["nextPageToken"],i);const r=o(t,["tuningJobs"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(u=>ys(u))),l(n,["tuningJobs"],a)}return n}function dm(t,e){const n={},s=o(t,["name"]);s!=null&&l(n,["model"],s);const i=o(t,["name"]);return i!=null&&l(n,["endpoint"],i),n}function fm(t,e){const n={};if(o(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(o(t,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const s=o(t,["examples"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(r=>r)),l(n,["examples","examples"],i)}return n}function pm(t,e,n){const s={};let i=o(n,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){const a=o(t,["gcsUri"]);e!==void 0&&a!=null&&l(e,["supervisedTuningSpec","trainingDatasetUri"],a)}else if(i==="PREFERENCE_TUNING"){const a=o(t,["gcsUri"]);e!==void 0&&a!=null&&l(e,["preferenceOptimizationSpec","trainingDatasetUri"],a)}let r=o(n,["config","method"]);if(r===void 0&&(r="SUPERVISED_FINE_TUNING"),r==="SUPERVISED_FINE_TUNING"){const a=o(t,["vertexDatasetResource"]);e!==void 0&&a!=null&&l(e,["supervisedTuningSpec","trainingDatasetUri"],a)}else if(r==="PREFERENCE_TUNING"){const a=o(t,["vertexDatasetResource"]);e!==void 0&&a!=null&&l(e,["preferenceOptimizationSpec","trainingDatasetUri"],a)}if(o(t,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return s}function Aa(t,e){const n={},s=o(t,["sdkHttpResponse"]);s!=null&&l(n,["sdkHttpResponse"],s);const i=o(t,["name"]);i!=null&&l(n,["name"],i);const r=o(t,["state"]);r!=null&&l(n,["state"],aa(r));const a=o(t,["createTime"]);a!=null&&l(n,["createTime"],a);const u=o(t,["tuningTask","startTime"]);u!=null&&l(n,["startTime"],u);const d=o(t,["tuningTask","completeTime"]);d!=null&&l(n,["endTime"],d);const c=o(t,["updateTime"]);c!=null&&l(n,["updateTime"],c);const f=o(t,["description"]);f!=null&&l(n,["description"],f);const p=o(t,["baseModel"]);p!=null&&l(n,["baseModel"],p);const h=o(t,["_self"]);return h!=null&&l(n,["tunedModel"],dm(h)),n}function ys(t,e){const n={},s=o(t,["sdkHttpResponse"]);s!=null&&l(n,["sdkHttpResponse"],s);const i=o(t,["name"]);i!=null&&l(n,["name"],i);const r=o(t,["state"]);r!=null&&l(n,["state"],aa(r));const a=o(t,["createTime"]);a!=null&&l(n,["createTime"],a);const u=o(t,["startTime"]);u!=null&&l(n,["startTime"],u);const d=o(t,["endTime"]);d!=null&&l(n,["endTime"],d);const c=o(t,["updateTime"]);c!=null&&l(n,["updateTime"],c);const f=o(t,["error"]);f!=null&&l(n,["error"],f);const p=o(t,["description"]);p!=null&&l(n,["description"],p);const h=o(t,["baseModel"]);h!=null&&l(n,["baseModel"],h);const m=o(t,["tunedModel"]);m!=null&&l(n,["tunedModel"],m);const _=o(t,["preTunedModel"]);_!=null&&l(n,["preTunedModel"],_);const g=o(t,["supervisedTuningSpec"]);g!=null&&l(n,["supervisedTuningSpec"],g);const T=o(t,["preferenceOptimizationSpec"]);T!=null&&l(n,["preferenceOptimizationSpec"],T);const w=o(t,["tuningDataStats"]);w!=null&&l(n,["tuningDataStats"],w);const v=o(t,["encryptionSpec"]);v!=null&&l(n,["encryptionSpec"],v);const S=o(t,["partnerModelTuningSpec"]);S!=null&&l(n,["partnerModelTuningSpec"],S);const C=o(t,["customBaseModel"]);C!=null&&l(n,["customBaseModel"],C);const N=o(t,["experiment"]);N!=null&&l(n,["experiment"],N);const R=o(t,["labels"]);R!=null&&l(n,["labels"],R);const I=o(t,["outputUri"]);I!=null&&l(n,["outputUri"],I);const q=o(t,["pipelineJob"]);q!=null&&l(n,["pipelineJob"],q);const P=o(t,["serviceAccount"]);P!=null&&l(n,["serviceAccount"],P);const M=o(t,["tunedModelDisplayName"]);M!=null&&l(n,["tunedModelDisplayName"],M);const U=o(t,["veoTuningSpec"]);return U!=null&&l(n,["veoTuningSpec"],U),n}function hm(t,e){const n={},s=o(t,["sdkHttpResponse"]);s!=null&&l(n,["sdkHttpResponse"],s);const i=o(t,["name"]);i!=null&&l(n,["name"],i);const r=o(t,["metadata"]);r!=null&&l(n,["metadata"],r);const a=o(t,["done"]);a!=null&&l(n,["done"],a);const u=o(t,["error"]);return u!=null&&l(n,["error"],u),n}function no(t,e){const n={},s=o(t,["gcsUri"]);s!=null&&l(n,["validationDatasetUri"],s);const i=o(t,["vertexDatasetResource"]);return i!=null&&l(n,["validationDatasetUri"],i),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class mm extends De{constructor(e){super(),this.apiClient=e,this.get=async n=>await this.getInternal(n),this.list=async(n={})=>new nt(ke.PAGED_ITEM_TUNING_JOBS,s=>this.listInternal(s),await this.listInternal(n),n),this.tune=async n=>{var s;if(this.apiClient.isVertexAI())if(n.baseModel.startsWith("projects/")){const i={tunedModelName:n.baseModel};!((s=n.config)===null||s===void 0)&&s.preTunedModelCheckpointId&&(i.checkpointId=n.config.preTunedModelCheckpointId);const r=Object.assign(Object.assign({},n),{preTunedModel:i});return r.baseModel=void 0,await this.tuneInternal(r)}else{const i=Object.assign({},n);return await this.tuneInternal(i)}else{const i=Object.assign({},n),r=await this.tuneMldevInternal(i);let a="";return r.metadata!==void 0&&r.metadata.tunedModel!==void 0?a=r.metadata.tunedModel:r.name!==void 0&&r.name.includes("/operations/")&&(a=r.name.split("/operations/")[0]),{name:a,state:cs.JOB_STATE_QUEUED}}}}async getInternal(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=im(e);return u=A("{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>ys(f))}else{const c=sm(e);return u=A("{name}",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>Aa(f))}}async listInternal(e){var n,s,i,r;let a,u="",d={};if(this.apiClient.isVertexAI()){const c=lm(e);return u=A("tuningJobs",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=cm(f),h=new Ur;return Object.assign(h,p),h})}else{const c=am(e);return u=A("tunedModels",c._url),d=c._query,delete c._url,delete c._query,a=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),a.then(f=>{const p=um(f),h=new Ur;return Object.assign(h,p),h})}}async cancel(e){var n,s,i,r;let a="",u={};if(this.apiClient.isVertexAI()){const d=Qh(e);a=A("{name}:cancel",d._url),u=d._query,delete d._url,delete d._query,await this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}else{const d=Xh(e);a=A("{name}:cancel",d._url),u=d._query,delete d._url,delete d._query,await this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async tuneInternal(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI()){const u=nm(e,e);return r=A("tuningJobs",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(c=>{const f=c;return f.sdkHttpResponse={headers:d.headers},f})),i.then(d=>ys(d))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var n,s;let i,r="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=tm(e);return r=A("tunedModels",u._url),a=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(c=>{const f=c;return f.sdkHttpResponse={headers:d.headers},f})),i.then(d=>hm(d))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class gm{async download(e,n){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const ym=1024*1024*8,_m=3,Tm=1e3,vm=2,vn="x-goog-upload-status";async function Sm(t,e,n){var s;const i=await Ra(t,e,n),r=await(i==null?void 0:i.json());if(((s=i==null?void 0:i.headers)===null||s===void 0?void 0:s[vn])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return r.file}async function Cm(t,e,n){var s;const i=await Ra(t,e,n),r=await(i==null?void 0:i.json());if(((s=i==null?void 0:i.headers)===null||s===void 0?void 0:s[vn])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const a=ta(r),u=new qs;return Object.assign(u,a),u}async function Ra(t,e,n){var s,i;let r=0,a=0,u=new ds(new Response),d="upload";for(r=t.size;a<r;){const c=Math.min(ym,r-a),f=t.slice(a,a+c);a+c>=r&&(d+=", finalize");let p=0,h=Tm;for(;p<_m&&(u=await n.request({path:"",body:f,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":d,"X-Goog-Upload-Offset":String(a),"Content-Length":String(c)}}}),!(!((s=u==null?void 0:u.headers)===null||s===void 0)&&s[vn]));)p++,await wm(h),h=h*vm;if(a+=c,((i=u==null?void 0:u.headers)===null||i===void 0?void 0:i[vn])!=="active")break;if(r<=a)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return u}async function Em(t){return{size:t.size,type:t.type}}function wm(t){return new Promise(e=>setTimeout(e,t))}class Im{async upload(e,n,s){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await Sm(e,n,s)}async uploadToFileSearchStore(e,n,s){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await Cm(e,n,s)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await Em(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Am{create(e,n,s){return new Rm(e,n,s)}}class Rm{constructor(e,n,s){this.url=e,this.headers=n,this.callbacks=s}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const so="x-goog-api-key";class Pm{constructor(e){this.apiKey=e}async addAuthHeaders(e,n){if(e.get(so)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(so,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const xm="gl-node/";class Nm{constructor(e){var n;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(n=e.vertexai)!==null&&n!==void 0?n:!1,this.apiKey=e.apiKey;const s=Tu(e.httpOptions,e.vertexai,void 0,void 0);s&&(e.httpOptions?e.httpOptions.baseUrl=s:e.httpOptions={baseUrl:s}),this.apiVersion=e.apiVersion;const i=new Pm(this.apiKey);this.apiClient=new Wp({auth:i,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:xm+"web",uploader:new Im,downloader:new gm}),this.models=new dh(this.apiClient),this.live=new rh(this.apiClient,i,new Am),this.batches=new Hc(this.apiClient),this.chats=new Cd(this.models,this.apiClient),this.caches=new Td(this.apiClient),this.files=new kd(this.apiClient),this.operations=new fh(this.apiClient),this.authTokens=new Rh(this.apiClient),this.tunings=new mm(this.apiClient),this.fileSearchStores=new Zh(this.apiClient)}}const _s="RFC3986",Ts={RFC1738:t=>String(t).replace(/%20/g,"+"),RFC3986:t=>String(t)},Mm="RFC1738",km=Array.isArray,Ee=(()=>{const t=[];for(let e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t})(),Zn=1024,bm=(t,e,n,s,i)=>{if(t.length===0)return t;let r=t;if(typeof t=="symbol"?r=Symbol.prototype.toString.call(t):typeof t!="string"&&(r=String(t)),n==="iso-8859-1")return escape(r).replace(/%u[0-9a-f]{4}/gi,function(u){return"%26%23"+parseInt(u.slice(2),16)+"%3B"});let a="";for(let u=0;u<r.length;u+=Zn){const d=r.length>=Zn?r.slice(u,u+Zn):r,c=[];for(let f=0;f<d.length;++f){let p=d.charCodeAt(f);if(p===45||p===46||p===95||p===126||p>=48&&p<=57||p>=65&&p<=90||p>=97&&p<=122||i===Mm&&(p===40||p===41)){c[c.length]=d.charAt(f);continue}if(p<128){c[c.length]=Ee[p];continue}if(p<2048){c[c.length]=Ee[192|p>>6]+Ee[128|p&63];continue}if(p<55296||p>=57344){c[c.length]=Ee[224|p>>12]+Ee[128|p>>6&63]+Ee[128|p&63];continue}f+=1,p=65536+((p&1023)<<10|d.charCodeAt(f)&1023),c[c.length]=Ee[240|p>>18]+Ee[128|p>>12&63]+Ee[128|p>>6&63]+Ee[128|p&63]}a+=c.join("")}return a};function Dm(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))}function io(t,e){if(km(t)){const n=[];for(let s=0;s<t.length;s+=1)n.push(e(t[s]));return n}return e(t)}const Um=Object.prototype.hasOwnProperty,Pa={brackets(t){return String(t)+"[]"},comma:"comma",indices(t,e){return String(t)+"["+e+"]"},repeat(t){return String(t)}},we=Array.isArray,Lm=Array.prototype.push,xa=function(t,e){Lm.apply(t,we(e)?e:[e])},Fm=Date.prototype.toISOString,te={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:bm,encodeValuesOnly:!1,format:_s,formatter:Ts[_s],indices:!1,serializeDate(t){return Fm.call(t)},skipNulls:!1,strictNullHandling:!1};function $m(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"}const Xn={};function Na(t,e,n,s,i,r,a,u,d,c,f,p,h,m,_,g,T,w){let v=t,S=w,C=0,N=!1;for(;(S=S.get(Xn))!==void 0&&!N;){const M=S.get(t);if(C+=1,typeof M<"u"){if(M===C)throw new RangeError("Cyclic object value");N=!0}typeof S.get(Xn)>"u"&&(C=0)}if(typeof c=="function"?v=c(e,v):v instanceof Date?v=h==null?void 0:h(v):n==="comma"&&we(v)&&(v=io(v,function(M){return M instanceof Date?h==null?void 0:h(M):M})),v===null){if(r)return d&&!g?d(e,te.encoder,T,"key",m):e;v=""}if($m(v)||Dm(v)){if(d){const M=g?e:d(e,te.encoder,T,"key",m);return[(_==null?void 0:_(M))+"="+(_==null?void 0:_(d(v,te.encoder,T,"value",m)))]}return[(_==null?void 0:_(e))+"="+(_==null?void 0:_(String(v)))]}const R=[];if(typeof v>"u")return R;let I;if(n==="comma"&&we(v))g&&d&&(v=io(v,d)),I=[{value:v.length>0?v.join(",")||null:void 0}];else if(we(c))I=c;else{const M=Object.keys(v);I=f?M.sort(f):M}const q=u?String(e).replace(/\./g,"%2E"):String(e),P=s&&we(v)&&v.length===1?q+"[]":q;if(i&&we(v)&&v.length===0)return P+"[]";for(let M=0;M<I.length;++M){const U=I[M],O=typeof U=="object"&&typeof U.value<"u"?U.value:v[U];if(a&&O===null)continue;const Q=p&&u?U.replace(/\./g,"%2E"):U,H=we(v)?typeof n=="function"?n(P,Q):P:P+(p?"."+Q:"["+Q+"]");w.set(t,C);const he=new WeakMap;he.set(Xn,w),xa(R,Na(O,H,n,s,i,r,a,u,n==="comma"&&g&&we(v)?null:d,c,f,p,h,m,_,g,T,he))}return R}function Gm(t=te){if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.encodeDotInKeys<"u"&&typeof t.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=t.charset||te.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=_s;if(typeof t.format<"u"){if(!Um.call(Ts,t.format))throw new TypeError("Unknown format option provided.");n=t.format}const s=Ts[n];let i=te.filter;(typeof t.filter=="function"||we(t.filter))&&(i=t.filter);let r;if(t.arrayFormat&&t.arrayFormat in Pa?r=t.arrayFormat:"indices"in t?r=t.indices?"indices":"repeat":r=te.arrayFormat,"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const a=typeof t.allowDots>"u"?t.encodeDotInKeys?!0:te.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:te.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:te.allowEmptyArrays,arrayFormat:r,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:te.charsetSentinel,commaRoundTrip:!!t.commaRoundTrip,delimiter:typeof t.delimiter>"u"?te.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:te.encode,encodeDotInKeys:typeof t.encodeDotInKeys=="boolean"?t.encodeDotInKeys:te.encodeDotInKeys,encoder:typeof t.encoder=="function"?t.encoder:te.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:te.encodeValuesOnly,filter:i,format:n,formatter:s,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:te.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:te.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:te.strictNullHandling}}function Vm(t,e={}){let n=t;const s=Gm(e);let i,r;typeof s.filter=="function"?(r=s.filter,n=r("",n)):we(s.filter)&&(r=s.filter,i=r);const a=[];if(typeof n!="object"||n===null)return"";const u=Pa[s.arrayFormat],d=u==="comma"&&s.commaRoundTrip;i||(i=Object.keys(n)),s.sort&&i.sort(s.sort);const c=new WeakMap;for(let h=0;h<i.length;++h){const m=i[h];s.skipNulls&&n[m]===null||xa(a,Na(n[m],m,u,d,s.allowEmptyArrays,s.strictNullHandling,s.skipNulls,s.encodeDotInKeys,s.encode?s.encoder:null,s.filter,s.sort,s.allowDots,s.serializeDate,s.format,s.formatter,s.encodeValuesOnly,s.charset,c))}const f=a.join(s.delimiter);let p=s.addQueryPrefix===!0?"?":"";return s.charsetSentinel&&(s.charset==="iso-8859-1"?p+="utf8=%26%2310003%3B&":p+="utf8=%E2%9C%93&"),f.length>0?p+f:""}const at="4.104.0";let ro=!1,$t,Ma,ka,vs,ba,Da,Ua,La,Fa;function qm(t,e={auto:!1}){if(ro)throw new Error(`you must \`import 'openai/shims/${t.kind}'\` before importing anything else from openai`);if($t)throw new Error(`can't \`import 'openai/shims/${t.kind}'\` after \`import 'openai/shims/${$t}'\``);ro=e.auto,$t=t.kind,Ma=t.fetch,ka=t.FormData,vs=t.File,ba=t.ReadableStream,Da=t.getMultipartRequestOptions,Ua=t.getDefaultAgent,La=t.fileFromPath,Fa=t.isFsReadStream}class Bm{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function Om({manuallyImported:t}={}){const e=t?"You may need to use polyfills":"Add one of these imports before your first `import  from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let n,s,i,r;try{n=fetch,s=Request,i=Response,r=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:n,Request:s,Response:i,Headers:r,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,u)=>({...u,body:new Bm(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:a=>!1}}const $a=()=>{$t||qm(Om(),{auto:!0})};$a();class L extends Error{}class re extends L{constructor(e,n,s,i){super(`${re.makeMessage(e,n,s)}`),this.status=e,this.headers=i,this.request_id=i==null?void 0:i["x-request-id"],this.error=n;const r=n;this.code=r==null?void 0:r.code,this.param=r==null?void 0:r.param,this.type=r==null?void 0:r.type}static makeMessage(e,n,s){const i=n!=null&&n.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):n?JSON.stringify(n):s;return e&&i?`${e} ${i}`:e?`${e} status code (no body)`:i||"(no status code or body)"}static generate(e,n,s,i){if(!e||!i)return new Un({message:s,cause:Cs(n)});const r=n==null?void 0:n.error;return e===400?new Ga(e,r,s,i):e===401?new Va(e,r,s,i):e===403?new qa(e,r,s,i):e===404?new Ba(e,r,s,i):e===409?new Oa(e,r,s,i):e===422?new Ha(e,r,s,i):e===429?new Ja(e,r,s,i):e>=500?new Wa(e,r,s,i):new re(e,r,s,i)}}class ge extends re{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class Un extends re{constructor({message:e,cause:n}){super(void 0,void 0,e||"Connection error.",void 0),n&&(this.cause=n)}}class Ys extends Un{constructor({message:e}={}){super({message:e??"Request timed out."})}}class Ga extends re{}class Va extends re{}class qa extends re{}class Ba extends re{}class Oa extends re{}class Ha extends re{}class Ja extends re{}class Wa extends re{}class Ya extends L{constructor(){super("Could not parse response content as the length limit was reached")}}class Ka extends L{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var jt=function(t,e,n,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(t,n):i?i.value=n:e.set(t,n),n},Xe=function(t,e,n,s){if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)},de;class Ln{constructor(){de.set(this,void 0),this.buffer=new Uint8Array,jt(this,de,null,"f")}decode(e){if(e==null)return[];const n=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e;let s=new Uint8Array(this.buffer.length+n.length);s.set(this.buffer),s.set(n,this.buffer.length),this.buffer=s;const i=[];let r;for(;(r=Hm(this.buffer,Xe(this,de,"f")))!=null;){if(r.carriage&&Xe(this,de,"f")==null){jt(this,de,r.index,"f");continue}if(Xe(this,de,"f")!=null&&(r.index!==Xe(this,de,"f")+1||r.carriage)){i.push(this.decodeText(this.buffer.slice(0,Xe(this,de,"f")-1))),this.buffer=this.buffer.slice(Xe(this,de,"f")),jt(this,de,null,"f");continue}const a=Xe(this,de,"f")!==null?r.preceding-1:r.preceding,u=this.decodeText(this.buffer.slice(0,a));i.push(u),this.buffer=this.buffer.slice(r.index),jt(this,de,null,"f")}return i}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new L(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new L(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new L("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}}de=new WeakMap;Ln.NEWLINE_CHARS=new Set([`
`,"\r"]);Ln.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function Hm(t,e){for(let i=e??0;i<t.length;i++){if(t[i]===10)return{preceding:i,index:i+1,carriage:!1};if(t[i]===13)return{preceding:i,index:i+1,carriage:!0}}return null}function Jm(t){for(let s=0;s<t.length-1;s++){if(t[s]===10&&t[s+1]===10||t[s]===13&&t[s+1]===13)return s+2;if(t[s]===13&&t[s+1]===10&&s+3<t.length&&t[s+2]===13&&t[s+3]===10)return s+4}return-1}function za(t){if(t[Symbol.asyncIterator])return t;const e=t.getReader();return{async next(){try{const n=await e.read();return n!=null&&n.done&&e.releaseLock(),n}catch(n){throw e.releaseLock(),n}},async return(){const n=e.cancel();return e.releaseLock(),await n,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}class Re{constructor(e,n){this.iterator=e,this.controller=n}static fromSSEResponse(e,n){let s=!1;async function*i(){if(s)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let r=!1;try{for await(const a of Wm(e,n))if(!r){if(a.data.startsWith("[DONE]")){r=!0;continue}if(a.event===null||a.event.startsWith("response.")||a.event.startsWith("transcript.")){let u;try{u=JSON.parse(a.data)}catch(d){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),d}if(u&&u.error)throw new re(void 0,u.error,void 0,nl(e.headers));yield u}else{let u;try{u=JSON.parse(a.data)}catch(d){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),d}if(a.event=="error")throw new re(void 0,u.error,u.message,void 0);yield{event:a.event,data:u}}}r=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{r||n.abort()}}return new Re(i,n)}static fromReadableStream(e,n){let s=!1;async function*i(){const a=new Ln,u=za(e);for await(const d of u)for(const c of a.decode(d))yield c;for(const d of a.flush())yield d}async function*r(){if(s)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let a=!1;try{for await(const u of i())a||u&&(yield JSON.parse(u));a=!0}catch(u){if(u instanceof Error&&u.name==="AbortError")return;throw u}finally{a||n.abort()}}return new Re(r,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],n=[],s=this.iterator(),i=r=>({next:()=>{if(r.length===0){const a=s.next();e.push(a),n.push(a)}return r.shift()}});return[new Re(()=>i(e),this.controller),new Re(()=>i(n),this.controller)]}toReadableStream(){const e=this;let n;const s=new TextEncoder;return new ba({async start(){n=e[Symbol.asyncIterator]()},async pull(i){try{const{value:r,done:a}=await n.next();if(a)return i.close();const u=s.encode(JSON.stringify(r)+`
`);i.enqueue(u)}catch(r){i.error(r)}},async cancel(){var i;await((i=n.return)==null?void 0:i.call(n))}})}}async function*Wm(t,e){if(!t.body)throw e.abort(),new L("Attempted to iterate over a response with no body");const n=new Km,s=new Ln,i=za(t.body);for await(const r of Ym(i))for(const a of s.decode(r)){const u=n.decode(a);u&&(yield u)}for(const r of s.flush()){const a=n.decode(r);a&&(yield a)}}async function*Ym(t){let e=new Uint8Array;for await(const n of t){if(n==null)continue;const s=n instanceof ArrayBuffer?new Uint8Array(n):typeof n=="string"?new TextEncoder().encode(n):n;let i=new Uint8Array(e.length+s.length);i.set(e),i.set(s,e.length),e=i;let r;for(;(r=Jm(e))!==-1;)yield e.slice(0,r),e=e.slice(r)}e.length>0&&(yield e)}class Km{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const r={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],r}if(this.chunks.push(e),e.startsWith(":"))return null;let[n,s,i]=zm(e,":");return i.startsWith(" ")&&(i=i.substring(1)),n==="event"?this.event=i:n==="data"&&this.data.push(i),null}}function zm(t,e){const n=t.indexOf(e);return n!==-1?[t.substring(0,n),e,t.substring(n+e.length)]:[t,"",""]}const Za=t=>t!=null&&typeof t=="object"&&typeof t.url=="string"&&typeof t.blob=="function",Xa=t=>t!=null&&typeof t=="object"&&typeof t.name=="string"&&typeof t.lastModified=="number"&&Fn(t),Fn=t=>t!=null&&typeof t=="object"&&typeof t.size=="number"&&typeof t.type=="string"&&typeof t.text=="function"&&typeof t.slice=="function"&&typeof t.arrayBuffer=="function",Zm=t=>Xa(t)||Za(t)||Fa(t);async function Qa(t,e,n){var i;if(t=await t,Xa(t))return t;if(Za(t)){const r=await t.blob();e||(e=new URL(t.url).pathname.split(/[\\/]/).pop()??"unknown_file");const a=Fn(r)?[await r.arrayBuffer()]:[r];return new vs(a,e,n)}const s=await Xm(t);if(e||(e=jm(t)??"unknown_file"),!(n!=null&&n.type)){const r=(i=s[0])==null?void 0:i.type;typeof r=="string"&&(n={...n,type:r})}return new vs(s,e,n)}async function Xm(t){var n;let e=[];if(typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)e.push(t);else if(Fn(t))e.push(await t.arrayBuffer());else if(eg(t))for await(const s of t)e.push(s);else throw new Error(`Unexpected data type: ${typeof t}; constructor: ${(n=t==null?void 0:t.constructor)==null?void 0:n.name}; props: ${Qm(t)}`);return e}function Qm(t){return`[${Object.getOwnPropertyNames(t).map(n=>`"${n}"`).join(", ")}]`}function jm(t){var e;return Qn(t.name)||Qn(t.filename)||((e=Qn(t.path))==null?void 0:e.split(/[\\/]/).pop())}const Qn=t=>{if(typeof t=="string")return t;if(typeof Buffer<"u"&&t instanceof Buffer)return String(t)},eg=t=>t!=null&&typeof t=="object"&&typeof t[Symbol.asyncIterator]=="function",oo=t=>t&&typeof t=="object"&&t.body&&t[Symbol.toStringTag]==="MultipartBody",et=async t=>{const e=await tg(t.body);return Da(e,t)},tg=async t=>{const e=new ka;return await Promise.all(Object.entries(t||{}).map(([n,s])=>Ss(e,n,s))),e},Ss=async(t,e,n)=>{if(n!==void 0){if(n==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")t.append(e,String(n));else if(Zm(n)){const s=await Qa(n);t.append(e,s)}else if(Array.isArray(n))await Promise.all(n.map(s=>Ss(t,e+"[]",s)));else if(typeof n=="object")await Promise.all(Object.entries(n).map(([s,i])=>Ss(t,`${e}[${s}]`,i)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`)}};var mt={},ng=function(t,e,n,s,i){if(typeof e=="function"?t!==e||!0:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,n),n},sg=function(t,e,n,s){if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)},en;$a();async function ja(t){var a;const{response:e}=t;if(t.options.stream)return Be("response",e.status,e.url,e.headers,e.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(e,t.controller):Re.fromSSEResponse(e,t.controller);if(e.status===204)return null;if(t.options.__binaryResponse)return e;const n=e.headers.get("content-type"),s=(a=n==null?void 0:n.split(";")[0])==null?void 0:a.trim();if((s==null?void 0:s.includes("application/json"))||(s==null?void 0:s.endsWith("+json"))){const u=await e.json();return Be("response",e.status,e.url,e.headers,u),el(u,e)}const r=await e.text();return Be("response",e.status,e.url,e.headers,r),r}function el(t,e){return!t||typeof t!="object"||Array.isArray(t)?t:Object.defineProperty(t,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}class $n extends Promise{constructor(e,n=ja){super(s=>{s(null)}),this.responsePromise=e,this.parseResponse=n}_thenUnwrap(e){return new $n(this.responsePromise,async n=>el(e(await this.parseResponse(n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,n]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:n,request_id:n.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,n){return this.parse().then(e,n)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class ig{constructor({baseURL:e,maxRetries:n=2,timeout:s=6e5,httpAgent:i,fetch:r}){this.baseURL=e,this.maxRetries=jn("maxRetries",n),this.timeout=jn("timeout",s),this.httpAgent=i,this.fetch=r??Ma}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...ug(),...this.authHeaders(e)}}validateHeaders(e,n){}defaultIdempotencyKey(){return`stainless-node-retry-${pg()}`}get(e,n){return this.methodRequest("get",e,n)}post(e,n){return this.methodRequest("post",e,n)}patch(e,n){return this.methodRequest("patch",e,n)}put(e,n){return this.methodRequest("put",e,n)}delete(e,n){return this.methodRequest("delete",e,n)}methodRequest(e,n,s){return this.request(Promise.resolve(s).then(async i=>{const r=i&&Fn(i==null?void 0:i.body)?new DataView(await i.body.arrayBuffer()):(i==null?void 0:i.body)instanceof DataView?i.body:(i==null?void 0:i.body)instanceof ArrayBuffer?new DataView(i.body):i&&ArrayBuffer.isView(i==null?void 0:i.body)?new DataView(i.body.buffer):i==null?void 0:i.body;return{method:e,path:n,...i,body:r}}))}getAPIList(e,n,s){return this.requestAPIList(n,{method:"get",path:e,...s})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:n=0}={}){var g;const s={...e},{method:i,path:r,query:a,headers:u={}}=s,d=ArrayBuffer.isView(s.body)||s.__binaryRequest&&typeof s.body=="string"?s.body:oo(s.body)?s.body.body:s.body?JSON.stringify(s.body,null,2):null,c=this.calculateContentLength(d),f=this.buildURL(r,a);"timeout"in s&&jn("timeout",s.timeout),s.timeout=s.timeout??this.timeout;const p=s.httpAgent??this.httpAgent??Ua(f),h=s.timeout+1e3;typeof((g=p==null?void 0:p.options)==null?void 0:g.timeout)=="number"&&h>(p.options.timeout??0)&&(p.options.timeout=h),this.idempotencyHeader&&i!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),u[this.idempotencyHeader]=e.idempotencyKey);const m=this.buildHeaders({options:s,headers:u,contentLength:c,retryCount:n});return{req:{method:i,...d&&{body:d},headers:m,...p&&{agent:p},signal:s.signal??null},url:f,timeout:s.timeout}}buildHeaders({options:e,headers:n,contentLength:s,retryCount:i}){const r={};s&&(r["content-length"]=s);const a=this.defaultHeaders(e);return co(r,a),co(r,n),oo(e.body)&&$t!=="node"&&delete r["content-type"],nn(a,"x-stainless-retry-count")===void 0&&nn(n,"x-stainless-retry-count")===void 0&&(r["x-stainless-retry-count"]=String(i)),nn(a,"x-stainless-timeout")===void 0&&nn(n,"x-stainless-timeout")===void 0&&e.timeout&&(r["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(r,n),r}async prepareOptions(e){}async prepareRequest(e,{url:n,options:s}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(n=>[...n])):{...e}:{}}makeStatusError(e,n,s,i){return re.generate(e,n,s,i)}request(e,n=null){return new $n(this.makeRequest(e,n))}async makeRequest(e,n){var p,h;const s=await e,i=s.maxRetries??this.maxRetries;n==null&&(n=i),await this.prepareOptions(s);const{req:r,url:a,timeout:u}=this.buildRequest(s,{retryCount:i-n});if(await this.prepareRequest(r,{url:a,options:s}),Be("request",a,s,r.headers),(p=s.signal)!=null&&p.aborted)throw new ge;const d=new AbortController,c=await this.fetchWithTimeout(a,r,u,d).catch(Cs);if(c instanceof Error){if((h=s.signal)!=null&&h.aborted)throw new ge;if(n)return this.retryRequest(s,n);throw c.name==="AbortError"?new Ys:new Un({cause:c})}const f=nl(c.headers);if(!c.ok){if(n&&this.shouldRetry(c)){const v=`retrying, ${n} attempts remaining`;return Be(`response (error; ${v})`,c.status,a,f),this.retryRequest(s,n,f)}const m=await c.text().catch(v=>Cs(v).message),_=cg(m),g=_?void 0:m;throw Be(`response (error; ${n?"(error; no more retries left)":"(error; not retryable)"})`,c.status,a,f,g),this.makeStatusError(c.status,_,g,f)}return{response:c,options:s,controller:d}}requestAPIList(e,n){const s=this.makeRequest(n,null);return new rg(this,s,e)}buildURL(e,n){const s=fg(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return sl(i)||(n={...i,...n}),typeof n=="object"&&n&&!Array.isArray(n)&&(s.search=this.stringifyQuery(n)),s.toString()}stringifyQuery(e){return Object.entries(e).filter(([n,s])=>typeof s<"u").map(([n,s])=>{if(typeof s=="string"||typeof s=="number"||typeof s=="boolean")return`${encodeURIComponent(n)}=${encodeURIComponent(s)}`;if(s===null)return`${encodeURIComponent(n)}=`;throw new L(`Cannot stringify type ${typeof s}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,n,s,i){const{signal:r,...a}=n||{};r&&r.addEventListener("abort",()=>i.abort());const u=setTimeout(()=>i.abort(),s),d={signal:i.signal,...a};return d.method&&(d.method=d.method.toUpperCase()),this.fetch.call(void 0,e,d).finally(()=>{clearTimeout(u)})}shouldRetry(e){const n=e.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,n,s){let i;const r=s==null?void 0:s["retry-after-ms"];if(r){const u=parseFloat(r);Number.isNaN(u)||(i=u)}const a=s==null?void 0:s["retry-after"];if(a&&!i){const u=parseFloat(a);Number.isNaN(u)?i=Date.parse(a)-Date.now():i=u*1e3}if(!(i&&0<=i&&i<60*1e3)){const u=e.maxRetries??this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(n,u)}return await Jt(i),this.makeRequest(e,n-1)}calculateDefaultRetryTimeoutMillis(e,n){const r=n-e,a=Math.min(.5*Math.pow(2,r),8),u=1-Math.random()*.25;return a*u*1e3}getUserAgent(){return`${this.constructor.name}/JS ${at}`}}class tl{constructor(e,n,s,i){en.set(this,void 0),ng(this,en,e),this.options=i,this.response=n,this.body=s}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new L("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const n={...this.options};if("params"in e&&typeof n.query=="object")n.query={...n.query,...e.params};else if("url"in e){const s=[...Object.entries(n.query||{}),...e.url.searchParams.entries()];for(const[i,r]of s)e.url.searchParams.set(i,r);n.query=void 0,n.path=e.url.toString()}return await sg(this,en,"f").requestAPIList(this.constructor,n)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(en=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const n of e.getPaginatedItems())yield n}}class rg extends $n{constructor(e,n,s){super(n,async i=>new s(e,i.response,await ja(i),i.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const n of e)yield n}}const nl=t=>new Proxy(Object.fromEntries(t.entries()),{get(e,n){const s=n.toString();return e[s.toLowerCase()]||e[s]}}),og={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},X=t=>typeof t=="object"&&t!==null&&!sl(t)&&Object.keys(t).every(e=>il(og,e)),ag=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":at,"X-Stainless-OS":lo(Deno.build.os),"X-Stainless-Arch":ao(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":at,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":at,"X-Stainless-OS":lo(process.platform),"X-Stainless-Arch":ao(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const t=lg();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":at,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":at,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function lg(){if(typeof navigator>"u"||!navigator)return null;const t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:n}of t){const s=n.exec(navigator.userAgent);if(s){const i=s[1]||0,r=s[2]||0,a=s[3]||0;return{browser:e,version:`${i}.${r}.${a}`}}}return null}const ao=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",lo=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown");let uo;const ug=()=>uo??(uo=ag()),cg=t=>{try{return JSON.parse(t)}catch{return}},dg=/^[a-z][a-z0-9+.-]*:/i,fg=t=>dg.test(t),Jt=t=>new Promise(e=>setTimeout(e,t)),jn=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new L(`${t} must be an integer`);if(e<0)throw new L(`${t} must be a positive integer`);return e},Cs=t=>{if(t instanceof Error)return t;if(typeof t=="object"&&t!==null)try{return new Error(JSON.stringify(t))}catch{}return new Error(t)},tn=t=>{var e,n,s,i;if(typeof process<"u")return((e=mt==null?void 0:mt[t])==null?void 0:e.trim())??void 0;if(typeof Deno<"u")return(i=(s=(n=Deno.env)==null?void 0:n.get)==null?void 0:s.call(n,t))==null?void 0:i.trim()};function sl(t){if(!t)return!0;for(const e in t)return!1;return!0}function il(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function co(t,e){for(const n in e){if(!il(e,n))continue;const s=n.toLowerCase();if(!s)continue;const i=e[n];i===null?delete t[s]:i!==void 0&&(t[s]=i)}}const fo=new Set(["authorization","api-key"]);function Be(t,...e){if(typeof process<"u"&&(mt==null?void 0:mt.DEBUG)==="true"){const n=e.map(s=>{if(!s)return s;if(s.headers){const r={...s,headers:{...s.headers}};for(const a in s.headers)fo.has(a.toLowerCase())&&(r.headers[a]="REDACTED");return r}let i=null;for(const r in s)fo.has(r.toLowerCase())&&(i??(i={...s}),i[r]="REDACTED");return i??s});console.log(`OpenAI:DEBUG:${t}`,...n)}}const pg=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),hg=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",mg=t=>typeof(t==null?void 0:t.get)=="function",nn=(t,e)=>{var s;const n=e.toLowerCase();if(mg(t)){const i=((s=e[0])==null?void 0:s.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(r,a,u)=>a+u.toUpperCase());for(const r of[e,n,e.toUpperCase(),i]){const a=t.get(r);if(a)return a}}for(const[i,r]of Object.entries(t))if(i.toLowerCase()===n)return Array.isArray(r)?(r.length<=1||console.warn(`Received ${r.length} entries for the ${e} header, using the first entry.`),r[0]):r},gg=t=>{if(typeof Buffer<"u"){const e=Buffer.from(t,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{const e=atob(t),n=e.length,s=new Uint8Array(n);for(let i=0;i<n;i++)s[i]=e.charCodeAt(i);return Array.from(new Float32Array(s.buffer))}};function es(t){return t!=null&&typeof t=="object"&&!Array.isArray(t)}class Gn extends tl{constructor(e,n,s,i){super(e,n,s,i),this.data=s.data||[],this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class ne extends tl{constructor(e,n,s,i){super(e,n,s,i),this.data=s.data||[],this.has_more=s.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const n=Object.fromEntries(e.url.searchParams);return Object.keys(n).length?n:null}nextPageInfo(){var s;const e=this.getPaginatedItems();if(!e.length)return null;const n=(s=e[e.length-1])==null?void 0:s.id;return n?{params:{after:n}}:null}}class F{constructor(e){this._client=e}}let rl=class extends F{list(e,n={},s){return X(n)?this.list(e,{},n):this._client.getAPIList(`/chat/completions/${e}/messages`,yg,{query:n,...s})}},Vn=class extends F{constructor(){super(...arguments),this.messages=new rl(this._client)}create(e,n){return this._client.post("/chat/completions",{body:e,...n,stream:e.stream??!1})}retrieve(e,n){return this._client.get(`/chat/completions/${e}`,n)}update(e,n,s){return this._client.post(`/chat/completions/${e}`,{body:n,...s})}list(e={},n){return X(e)?this.list({},e):this._client.getAPIList("/chat/completions",qn,{query:e,...n})}del(e,n){return this._client.delete(`/chat/completions/${e}`,n)}};class qn extends ne{}class yg extends ne{}Vn.ChatCompletionsPage=qn;Vn.Messages=rl;let Bn=class extends F{constructor(){super(...arguments),this.completions=new Vn(this._client)}};Bn.Completions=Vn;Bn.ChatCompletionsPage=qn;class ol extends F{create(e,n){return this._client.post("/audio/speech",{body:e,...n,headers:{Accept:"application/octet-stream",...n==null?void 0:n.headers},__binaryResponse:!0})}}class al extends F{create(e,n){return this._client.post("/audio/transcriptions",et({body:e,...n,stream:e.stream??!1,__metadata:{model:e.model}}))}}class ll extends F{create(e,n){return this._client.post("/audio/translations",et({body:e,...n,__metadata:{model:e.model}}))}}class Wt extends F{constructor(){super(...arguments),this.transcriptions=new al(this._client),this.translations=new ll(this._client),this.speech=new ol(this._client)}}Wt.Transcriptions=al;Wt.Translations=ll;Wt.Speech=ol;class Ks extends F{create(e,n){return this._client.post("/batches",{body:e,...n})}retrieve(e,n){return this._client.get(`/batches/${e}`,n)}list(e={},n){return X(e)?this.list({},e):this._client.getAPIList("/batches",zs,{query:e,...n})}cancel(e,n){return this._client.post(`/batches/${e}/cancel`,n)}}class zs extends ne{}Ks.BatchesPage=zs;var Te=function(t,e,n,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(t,n):i?i.value=n:e.set(t,n),n},Z=function(t,e,n,s){if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)},Es,dn,fn,Nt,Mt,pn,kt,Me,bt,Sn,Cn,lt,ul;class Zs{constructor(){Es.add(this),this.controller=new AbortController,dn.set(this,void 0),fn.set(this,()=>{}),Nt.set(this,()=>{}),Mt.set(this,void 0),pn.set(this,()=>{}),kt.set(this,()=>{}),Me.set(this,{}),bt.set(this,!1),Sn.set(this,!1),Cn.set(this,!1),lt.set(this,!1),Te(this,dn,new Promise((e,n)=>{Te(this,fn,e,"f"),Te(this,Nt,n,"f")}),"f"),Te(this,Mt,new Promise((e,n)=>{Te(this,pn,e,"f"),Te(this,kt,n,"f")}),"f"),Z(this,dn,"f").catch(()=>{}),Z(this,Mt,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},Z(this,Es,"m",ul).bind(this))},0)}_connected(){this.ended||(Z(this,fn,"f").call(this),this._emit("connect"))}get ended(){return Z(this,bt,"f")}get errored(){return Z(this,Sn,"f")}get aborted(){return Z(this,Cn,"f")}abort(){this.controller.abort()}on(e,n){return(Z(this,Me,"f")[e]||(Z(this,Me,"f")[e]=[])).push({listener:n}),this}off(e,n){const s=Z(this,Me,"f")[e];if(!s)return this;const i=s.findIndex(r=>r.listener===n);return i>=0&&s.splice(i,1),this}once(e,n){return(Z(this,Me,"f")[e]||(Z(this,Me,"f")[e]=[])).push({listener:n,once:!0}),this}emitted(e){return new Promise((n,s)=>{Te(this,lt,!0,"f"),e!=="error"&&this.once("error",s),this.once(e,n)})}async done(){Te(this,lt,!0,"f"),await Z(this,Mt,"f")}_emit(e,...n){if(Z(this,bt,"f"))return;e==="end"&&(Te(this,bt,!0,"f"),Z(this,pn,"f").call(this));const s=Z(this,Me,"f")[e];if(s&&(Z(this,Me,"f")[e]=s.filter(i=>!i.once),s.forEach(({listener:i})=>i(...n))),e==="abort"){const i=n[0];!Z(this,lt,"f")&&!(s!=null&&s.length)&&Promise.reject(i),Z(this,Nt,"f").call(this,i),Z(this,kt,"f").call(this,i),this._emit("end");return}if(e==="error"){const i=n[0];!Z(this,lt,"f")&&!(s!=null&&s.length)&&Promise.reject(i),Z(this,Nt,"f").call(this,i),Z(this,kt,"f").call(this,i),this._emit("end")}}_emitFinal(){}}dn=new WeakMap,fn=new WeakMap,Nt=new WeakMap,Mt=new WeakMap,pn=new WeakMap,kt=new WeakMap,Me=new WeakMap,bt=new WeakMap,Sn=new WeakMap,Cn=new WeakMap,lt=new WeakMap,Es=new WeakSet,ul=function(e){if(Te(this,Sn,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new ge),e instanceof ge)return Te(this,Cn,!0,"f"),this._emit("abort",e);if(e instanceof L)return this._emit("error",e);if(e instanceof Error){const n=new L(e.message);return n.cause=e,this._emit("error",n)}return this._emit("error",new L(String(e)))};var D=function(t,e,n,s){if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)},ce=function(t,e,n,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(t,n):i?i.value=n:e.set(t,n),n},ie,ws,Ie,hn,ve,je,dt,Qe,En,fe,mn,gn,Gt,Dt,Ut,po,ho,mo,go,yo,_o,To;class Se extends Zs{constructor(){super(...arguments),ie.add(this),ws.set(this,[]),Ie.set(this,{}),hn.set(this,{}),ve.set(this,void 0),je.set(this,void 0),dt.set(this,void 0),Qe.set(this,void 0),En.set(this,void 0),fe.set(this,void 0),mn.set(this,void 0),gn.set(this,void 0),Gt.set(this,void 0)}[(ws=new WeakMap,Ie=new WeakMap,hn=new WeakMap,ve=new WeakMap,je=new WeakMap,dt=new WeakMap,Qe=new WeakMap,En=new WeakMap,fe=new WeakMap,mn=new WeakMap,gn=new WeakMap,Gt=new WeakMap,ie=new WeakSet,Symbol.asyncIterator)](){const e=[],n=[];let s=!1;return this.on("event",i=>{const r=n.shift();r?r.resolve(i):e.push(i)}),this.on("end",()=>{s=!0;for(const i of n)i.resolve(void 0);n.length=0}),this.on("abort",i=>{s=!0;for(const r of n)r.reject(i);n.length=0}),this.on("error",i=>{s=!0;for(const r of n)r.reject(i);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((r,a)=>n.push({resolve:r,reject:a})).then(r=>r?{value:r,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const n=new Se;return n._run(()=>n._fromReadableStream(e)),n}async _fromReadableStream(e,n){var r;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),this._connected();const i=Re.fromReadableStream(e,this.controller);for await(const a of i)D(this,ie,"m",Dt).call(this,a);if((r=i.controller.signal)!=null&&r.aborted)throw new ge;return this._addRun(D(this,ie,"m",Ut).call(this))}toReadableStream(){return new Re(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,n,s,i,r){const a=new Se;return a._run(()=>a._runToolAssistantStream(e,n,s,i,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,n,s,i,r){var c;const a=r==null?void 0:r.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const u={...i,stream:!0},d=await e.submitToolOutputs(n,s,u,{...r,signal:this.controller.signal});this._connected();for await(const f of d)D(this,ie,"m",Dt).call(this,f);if((c=d.controller.signal)!=null&&c.aborted)throw new ge;return this._addRun(D(this,ie,"m",Ut).call(this))}static createThreadAssistantStream(e,n,s){const i=new Se;return i._run(()=>i._threadAssistantStream(e,n,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}static createAssistantStream(e,n,s,i){const r=new Se;return r._run(()=>r._runAssistantStream(e,n,s,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),r}currentEvent(){return D(this,mn,"f")}currentRun(){return D(this,gn,"f")}currentMessageSnapshot(){return D(this,ve,"f")}currentRunStepSnapshot(){return D(this,Gt,"f")}async finalRunSteps(){return await this.done(),Object.values(D(this,Ie,"f"))}async finalMessages(){return await this.done(),Object.values(D(this,hn,"f"))}async finalRun(){if(await this.done(),!D(this,je,"f"))throw Error("Final run was not received.");return D(this,je,"f")}async _createThreadAssistantStream(e,n,s){var u;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const r={...n,stream:!0},a=await e.createAndRun(r,{...s,signal:this.controller.signal});this._connected();for await(const d of a)D(this,ie,"m",Dt).call(this,d);if((u=a.controller.signal)!=null&&u.aborted)throw new ge;return this._addRun(D(this,ie,"m",Ut).call(this))}async _createAssistantStream(e,n,s,i){var d;const r=i==null?void 0:i.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const a={...s,stream:!0},u=await e.create(n,a,{...i,signal:this.controller.signal});this._connected();for await(const c of u)D(this,ie,"m",Dt).call(this,c);if((d=u.controller.signal)!=null&&d.aborted)throw new ge;return this._addRun(D(this,ie,"m",Ut).call(this))}static accumulateDelta(e,n){for(const[s,i]of Object.entries(n)){if(!e.hasOwnProperty(s)){e[s]=i;continue}let r=e[s];if(r==null){e[s]=i;continue}if(s==="index"||s==="type"){e[s]=i;continue}if(typeof r=="string"&&typeof i=="string")r+=i;else if(typeof r=="number"&&typeof i=="number")r+=i;else if(es(r)&&es(i))r=this.accumulateDelta(r,i);else if(Array.isArray(r)&&Array.isArray(i)){if(r.every(a=>typeof a=="string"||typeof a=="number")){r.push(...i);continue}for(const a of i){if(!es(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);const u=a.index;if(u==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof u!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${u}`);const d=r[u];d==null?r.push(a):r[u]=this.accumulateDelta(d,a)}continue}else throw Error(`Unhandled record type: ${s}, deltaValue: ${i}, accValue: ${r}`);e[s]=r}return e}_addRun(e){return e}async _threadAssistantStream(e,n,s){return await this._createThreadAssistantStream(n,e,s)}async _runAssistantStream(e,n,s,i){return await this._createAssistantStream(n,e,s,i)}async _runToolAssistantStream(e,n,s,i,r){return await this._createToolAssistantStream(s,e,n,i,r)}}Dt=function(e){if(!this.ended)switch(ce(this,mn,e,"f"),D(this,ie,"m",mo).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":D(this,ie,"m",To).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":D(this,ie,"m",ho).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":D(this,ie,"m",po).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Ut=function(){if(this.ended)throw new L("stream has ended, this shouldn't happen");if(!D(this,je,"f"))throw Error("Final run has not been received");return D(this,je,"f")},po=function(e){const[n,s]=D(this,ie,"m",yo).call(this,e,D(this,ve,"f"));ce(this,ve,n,"f"),D(this,hn,"f")[n.id]=n;for(const i of s){const r=n.content[i.index];(r==null?void 0:r.type)=="text"&&this._emit("textCreated",r.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,n),e.data.delta.content)for(const i of e.data.delta.content){if(i.type=="text"&&i.text){let r=i.text,a=n.content[i.index];if(a&&a.type=="text")this._emit("textDelta",r,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(i.index!=D(this,dt,"f")){if(D(this,Qe,"f"))switch(D(this,Qe,"f").type){case"text":this._emit("textDone",D(this,Qe,"f").text,D(this,ve,"f"));break;case"image_file":this._emit("imageFileDone",D(this,Qe,"f").image_file,D(this,ve,"f"));break}ce(this,dt,i.index,"f")}ce(this,Qe,n.content[i.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(D(this,dt,"f")!==void 0){const i=e.data.content[D(this,dt,"f")];if(i)switch(i.type){case"image_file":this._emit("imageFileDone",i.image_file,D(this,ve,"f"));break;case"text":this._emit("textDone",i.text,D(this,ve,"f"));break}}D(this,ve,"f")&&this._emit("messageDone",e.data),ce(this,ve,void 0,"f")}},ho=function(e){const n=D(this,ie,"m",go).call(this,e);switch(ce(this,Gt,n,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const s=e.data.delta;if(s.step_details&&s.step_details.type=="tool_calls"&&s.step_details.tool_calls&&n.step_details.type=="tool_calls")for(const r of s.step_details.tool_calls)r.index==D(this,En,"f")?this._emit("toolCallDelta",r,n.step_details.tool_calls[r.index]):(D(this,fe,"f")&&this._emit("toolCallDone",D(this,fe,"f")),ce(this,En,r.index,"f"),ce(this,fe,n.step_details.tool_calls[r.index],"f"),D(this,fe,"f")&&this._emit("toolCallCreated",D(this,fe,"f")));this._emit("runStepDelta",e.data.delta,n);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":ce(this,Gt,void 0,"f"),e.data.step_details.type=="tool_calls"&&D(this,fe,"f")&&(this._emit("toolCallDone",D(this,fe,"f")),ce(this,fe,void 0,"f")),this._emit("runStepDone",e.data,n);break}},mo=function(e){D(this,ws,"f").push(e),this._emit("event",e)},go=function(e){switch(e.event){case"thread.run.step.created":return D(this,Ie,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let n=D(this,Ie,"f")[e.data.id];if(!n)throw Error("Received a RunStepDelta before creation of a snapshot");let s=e.data;if(s.delta){const i=Se.accumulateDelta(n,s.delta);D(this,Ie,"f")[e.data.id]=i}return D(this,Ie,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":D(this,Ie,"f")[e.data.id]=e.data;break}if(D(this,Ie,"f")[e.data.id])return D(this,Ie,"f")[e.data.id];throw new Error("No snapshot available")},yo=function(e,n){let s=[];switch(e.event){case"thread.message.created":return[e.data,s];case"thread.message.delta":if(!n)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let i=e.data;if(i.delta.content)for(const r of i.delta.content)if(r.index in n.content){let a=n.content[r.index];n.content[r.index]=D(this,ie,"m",_o).call(this,r,a)}else n.content[r.index]=r,s.push(r);return[n,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(n)return[n,s];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},_o=function(e,n){return Se.accumulateDelta(n,e)},To=function(e){switch(ce(this,gn,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":ce(this,je,e.data,"f"),D(this,fe,"f")&&(this._emit("toolCallDone",D(this,fe,"f")),ce(this,fe,void 0,"f"));break}};class Xs extends F{create(e,n){return this._client.post("/assistants",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,n){return this._client.get(`/assistants/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,n,s){return this._client.post(`/assistants/${e}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e={},n){return X(e)?this.list({},e):this._client.getAPIList("/assistants",Qs,{query:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,n){return this._client.delete(`/assistants/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Qs extends ne{}Xs.AssistantsPage=Qs;function vo(t){return typeof t.parse=="function"}const gt=t=>(t==null?void 0:t.role)==="assistant",cl=t=>(t==null?void 0:t.role)==="function",dl=t=>(t==null?void 0:t.role)==="tool";function js(t){return(t==null?void 0:t.$brand)==="auto-parseable-response-format"}function Yt(t){return(t==null?void 0:t.$brand)==="auto-parseable-tool"}function _g(t,e){return!e||!fl(e)?{...t,choices:t.choices.map(n=>({...n,message:{...n.message,parsed:null,...n.message.tool_calls?{tool_calls:n.message.tool_calls}:void 0}}))}:ei(t,e)}function ei(t,e){const n=t.choices.map(s=>{var i;if(s.finish_reason==="length")throw new Ya;if(s.finish_reason==="content_filter")throw new Ka;return{...s,message:{...s.message,...s.message.tool_calls?{tool_calls:((i=s.message.tool_calls)==null?void 0:i.map(r=>vg(e,r)))??void 0}:void 0,parsed:s.message.content&&!s.message.refusal?Tg(e,s.message.content):null}}});return{...t,choices:n}}function Tg(t,e){var n,s;return((n=t.response_format)==null?void 0:n.type)!=="json_schema"?null:((s=t.response_format)==null?void 0:s.type)==="json_schema"?"$parseRaw"in t.response_format?t.response_format.$parseRaw(e):JSON.parse(e):null}function vg(t,e){var s;const n=(s=t.tools)==null?void 0:s.find(i=>{var r;return((r=i.function)==null?void 0:r.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:Yt(n)?n.$parseRaw(e.function.arguments):n!=null&&n.function.strict?JSON.parse(e.function.arguments):null}}}function Sg(t,e){var s;if(!t)return!1;const n=(s=t.tools)==null?void 0:s.find(i=>{var r;return((r=i.function)==null?void 0:r.name)===e.function.name});return Yt(n)||(n==null?void 0:n.function.strict)||!1}function fl(t){var e;return js(t.response_format)?!0:((e=t.tools)==null?void 0:e.some(n=>Yt(n)||n.type==="function"&&n.function.strict===!0))??!1}function Cg(t){for(const e of t??[]){if(e.type!=="function")throw new L(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new L(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var le=function(t,e,n,s){if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)},oe,Is,wn,As,Rs,Ps,pl,xs;const So=10;class hl extends Zs{constructor(){super(...arguments),oe.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var s;this._chatCompletions.push(e),this._emit("chatCompletion",e);const n=(s=e.choices[0])==null?void 0:s.message;return n&&this._addMessage(n),e}_addMessage(e,n=!0){if("content"in e||(e.content=null),this.messages.push(e),n){if(this._emit("message",e),(cl(e)||dl(e))&&e.content)this._emit("functionCallResult",e.content);else if(gt(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(gt(e)&&e.tool_calls)for(const s of e.tool_calls)s.type==="function"&&this._emit("functionCall",s.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new L("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),le(this,oe,"m",Is).call(this)}async finalMessage(){return await this.done(),le(this,oe,"m",wn).call(this)}async finalFunctionCall(){return await this.done(),le(this,oe,"m",As).call(this)}async finalFunctionCallResult(){return await this.done(),le(this,oe,"m",Rs).call(this)}async totalUsage(){return await this.done(),le(this,oe,"m",Ps).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const n=le(this,oe,"m",wn).call(this);n&&this._emit("finalMessage",n);const s=le(this,oe,"m",Is).call(this);s&&this._emit("finalContent",s);const i=le(this,oe,"m",As).call(this);i&&this._emit("finalFunctionCall",i);const r=le(this,oe,"m",Rs).call(this);r!=null&&this._emit("finalFunctionCallResult",r),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",le(this,oe,"m",Ps).call(this))}async _createChatCompletion(e,n,s){const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),le(this,oe,"m",pl).call(this,n);const r=await e.chat.completions.create({...n,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion(ei(r,n))}async _runChatCompletion(e,n,s){for(const i of n.messages)this._addMessage(i,!1);return await this._createChatCompletion(e,n,s)}async _runFunctions(e,n,s){var h;const i="function",{function_call:r="auto",stream:a,...u}=n,d=typeof r!="string"&&(r==null?void 0:r.name),{maxChatCompletions:c=So}=s||{},f={};for(const m of n.functions)f[m.name||m.function.name]=m;const p=n.functions.map(m=>({name:m.name||m.function.name,parameters:m.parameters,description:m.description}));for(const m of n.messages)this._addMessage(m,!1);for(let m=0;m<c;++m){const g=(h=(await this._createChatCompletion(e,{...u,function_call:r,functions:p,messages:[...this.messages]},s)).choices[0])==null?void 0:h.message;if(!g)throw new L("missing message in ChatCompletion response");if(!g.function_call)return;const{name:T,arguments:w}=g.function_call,v=f[T];if(v){if(d&&d!==T){const R=`Invalid function_call: ${JSON.stringify(T)}. ${JSON.stringify(d)} requested. Please try again`;this._addMessage({role:i,name:T,content:R});continue}}else{const R=`Invalid function_call: ${JSON.stringify(T)}. Available options are: ${p.map(I=>JSON.stringify(I.name)).join(", ")}. Please try again`;this._addMessage({role:i,name:T,content:R});continue}let S;try{S=vo(v)?await v.parse(w):w}catch(R){this._addMessage({role:i,name:T,content:R instanceof Error?R.message:String(R)});continue}const C=await v.function(S,this),N=le(this,oe,"m",xs).call(this,C);if(this._addMessage({role:i,name:T,content:N}),d)return}}async _runTools(e,n,s){var m,_,g;const i="tool",{tool_choice:r="auto",stream:a,...u}=n,d=typeof r!="string"&&((m=r==null?void 0:r.function)==null?void 0:m.name),{maxChatCompletions:c=So}=s||{},f=n.tools.map(T=>{if(Yt(T)){if(!T.$callback)throw new L("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:T.$callback,name:T.function.name,description:T.function.description||"",parameters:T.function.parameters,parse:T.$parseRaw,strict:!0}}}return T}),p={};for(const T of f)T.type==="function"&&(p[T.function.name||T.function.function.name]=T.function);const h="tools"in n?f.map(T=>T.type==="function"?{type:"function",function:{name:T.function.name||T.function.function.name,parameters:T.function.parameters,description:T.function.description,strict:T.function.strict}}:T):void 0;for(const T of n.messages)this._addMessage(T,!1);for(let T=0;T<c;++T){const v=(_=(await this._createChatCompletion(e,{...u,tool_choice:r,tools:h,messages:[...this.messages]},s)).choices[0])==null?void 0:_.message;if(!v)throw new L("missing message in ChatCompletion response");if(!((g=v.tool_calls)!=null&&g.length))return;for(const S of v.tool_calls){if(S.type!=="function")continue;const C=S.id,{name:N,arguments:R}=S.function,I=p[N];if(I){if(d&&d!==N){const U=`Invalid tool_call: ${JSON.stringify(N)}. ${JSON.stringify(d)} requested. Please try again`;this._addMessage({role:i,tool_call_id:C,content:U});continue}}else{const U=`Invalid tool_call: ${JSON.stringify(N)}. Available options are: ${Object.keys(p).map(O=>JSON.stringify(O)).join(", ")}. Please try again`;this._addMessage({role:i,tool_call_id:C,content:U});continue}let q;try{q=vo(I)?await I.parse(R):R}catch(U){const O=U instanceof Error?U.message:String(U);this._addMessage({role:i,tool_call_id:C,content:O});continue}const P=await I.function(q,this),M=le(this,oe,"m",xs).call(this,P);if(this._addMessage({role:i,tool_call_id:C,content:M}),d)return}}}}oe=new WeakSet,Is=function(){return le(this,oe,"m",wn).call(this).content??null},wn=function(){let e=this.messages.length;for(;e-- >0;){const n=this.messages[e];if(gt(n)){const{function_call:s,...i}=n,r={...i,content:n.content??null,refusal:n.refusal??null};return s&&(r.function_call=s),r}}throw new L("stream ended without producing a ChatCompletionMessage with role=assistant")},As=function(){var e,n;for(let s=this.messages.length-1;s>=0;s--){const i=this.messages[s];if(gt(i)&&(i!=null&&i.function_call))return i.function_call;if(gt(i)&&((e=i==null?void 0:i.tool_calls)!=null&&e.length))return(n=i.tool_calls.at(-1))==null?void 0:n.function}},Rs=function(){for(let e=this.messages.length-1;e>=0;e--){const n=this.messages[e];if(cl(n)&&n.content!=null||dl(n)&&n.content!=null&&typeof n.content=="string"&&this.messages.some(s=>{var i;return s.role==="assistant"&&((i=s.tool_calls)==null?void 0:i.some(r=>r.type==="function"&&r.id===n.tool_call_id))}))return n.content}},Ps=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:n}of this._chatCompletions)n&&(e.completion_tokens+=n.completion_tokens,e.prompt_tokens+=n.prompt_tokens,e.total_tokens+=n.total_tokens);return e},pl=function(e){if(e.n!=null&&e.n>1)throw new L("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},xs=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class qt extends hl{static runFunctions(e,n,s){const i=new qt,r={...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"runFunctions"}};return i._run(()=>i._runFunctions(e,n,r)),i}static runTools(e,n,s){const i=new qt,r={...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,n,r)),i}_addMessage(e,n=!0){super._addMessage(e,n),gt(e)&&e.content&&this._emit("content",e.content)}}const ml=1,gl=2,yl=4,_l=8,Tl=16,vl=32,Sl=64,Cl=128,El=256,wl=Cl|El,Il=Tl|vl|wl|Sl,Al=ml|gl|Il,Rl=yl|_l,Eg=Al|Rl,se={STR:ml,NUM:gl,ARR:yl,OBJ:_l,NULL:Tl,BOOL:vl,NAN:Sl,INFINITY:Cl,MINUS_INFINITY:El,INF:wl,SPECIAL:Il,ATOM:Al,COLLECTION:Rl,ALL:Eg};class wg extends Error{}class Ig extends Error{}function Ag(t,e=se.ALL){if(typeof t!="string")throw new TypeError(`expecting str, got ${typeof t}`);if(!t.trim())throw new Error(`${t} is empty`);return Rg(t.trim(),e)}const Rg=(t,e)=>{const n=t.length;let s=0;const i=h=>{throw new wg(`${h} at position ${s}`)},r=h=>{throw new Ig(`${h} at position ${s}`)},a=()=>(p(),s>=n&&i("Unexpected end of input"),t[s]==='"'?u():t[s]==="{"?d():t[s]==="["?c():t.substring(s,s+4)==="null"||se.NULL&e&&n-s<4&&"null".startsWith(t.substring(s))?(s+=4,null):t.substring(s,s+4)==="true"||se.BOOL&e&&n-s<4&&"true".startsWith(t.substring(s))?(s+=4,!0):t.substring(s,s+5)==="false"||se.BOOL&e&&n-s<5&&"false".startsWith(t.substring(s))?(s+=5,!1):t.substring(s,s+8)==="Infinity"||se.INFINITY&e&&n-s<8&&"Infinity".startsWith(t.substring(s))?(s+=8,1/0):t.substring(s,s+9)==="-Infinity"||se.MINUS_INFINITY&e&&1<n-s&&n-s<9&&"-Infinity".startsWith(t.substring(s))?(s+=9,-1/0):t.substring(s,s+3)==="NaN"||se.NAN&e&&n-s<3&&"NaN".startsWith(t.substring(s))?(s+=3,NaN):f()),u=()=>{const h=s;let m=!1;for(s++;s<n&&(t[s]!=='"'||m&&t[s-1]==="\\");)m=t[s]==="\\"?!m:!1,s++;if(t.charAt(s)=='"')try{return JSON.parse(t.substring(h,++s-Number(m)))}catch(_){r(String(_))}else if(se.STR&e)try{return JSON.parse(t.substring(h,s-Number(m))+'"')}catch{return JSON.parse(t.substring(h,t.lastIndexOf("\\"))+'"')}i("Unterminated string literal")},d=()=>{s++,p();const h={};try{for(;t[s]!=="}";){if(p(),s>=n&&se.OBJ&e)return h;const m=u();p(),s++;try{const _=a();Object.defineProperty(h,m,{value:_,writable:!0,enumerable:!0,configurable:!0})}catch(_){if(se.OBJ&e)return h;throw _}p(),t[s]===","&&s++}}catch{if(se.OBJ&e)return h;i("Expected '}' at end of object")}return s++,h},c=()=>{s++;const h=[];try{for(;t[s]!=="]";)h.push(a()),p(),t[s]===","&&s++}catch{if(se.ARR&e)return h;i("Expected ']' at end of array")}return s++,h},f=()=>{if(s===0){t==="-"&&se.NUM&e&&i("Not sure what '-' is");try{return JSON.parse(t)}catch(m){if(se.NUM&e)try{return t[t.length-1]==="."?JSON.parse(t.substring(0,t.lastIndexOf("."))):JSON.parse(t.substring(0,t.lastIndexOf("e")))}catch{}r(String(m))}}const h=s;for(t[s]==="-"&&s++;t[s]&&!",]}".includes(t[s]);)s++;s==n&&!(se.NUM&e)&&i("Unterminated number literal");try{return JSON.parse(t.substring(h,s))}catch{t.substring(h,s)==="-"&&se.NUM&e&&i("Not sure what '-' is");try{return JSON.parse(t.substring(h,t.lastIndexOf("e")))}catch(_){r(String(_))}}},p=()=>{for(;s<n&&` 
\r	`.includes(t[s]);)s++};return a()},Co=t=>Ag(t,se.ALL^se.NUM);var st=function(t,e,n,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(t,n):i?i.value=n:e.set(t,n),n},K=function(t,e,n,s){if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)},ee,Ne,it,Fe,ts,sn,ns,ss,is,rn,rs,Eo;class Bt extends hl{constructor(e){super(),ee.add(this),Ne.set(this,void 0),it.set(this,void 0),Fe.set(this,void 0),st(this,Ne,e,"f"),st(this,it,[],"f")}get currentChatCompletionSnapshot(){return K(this,Fe,"f")}static fromReadableStream(e){const n=new Bt(null);return n._run(()=>n._fromReadableStream(e)),n}static createChatCompletion(e,n,s){const i=new Bt(n);return i._run(()=>i._runChatCompletion(e,{...n,stream:!0},{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createChatCompletion(e,n,s){var a;super._createChatCompletion;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),K(this,ee,"m",ts).call(this);const r=await e.chat.completions.create({...n,stream:!0},{...s,signal:this.controller.signal});this._connected();for await(const u of r)K(this,ee,"m",ns).call(this,u);if((a=r.controller.signal)!=null&&a.aborted)throw new ge;return this._addChatCompletion(K(this,ee,"m",rn).call(this))}async _fromReadableStream(e,n){var a;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),K(this,ee,"m",ts).call(this),this._connected();const i=Re.fromReadableStream(e,this.controller);let r;for await(const u of i)r&&r!==u.id&&this._addChatCompletion(K(this,ee,"m",rn).call(this)),K(this,ee,"m",ns).call(this,u),r=u.id;if((a=i.controller.signal)!=null&&a.aborted)throw new ge;return this._addChatCompletion(K(this,ee,"m",rn).call(this))}[(Ne=new WeakMap,it=new WeakMap,Fe=new WeakMap,ee=new WeakSet,ts=function(){this.ended||st(this,Fe,void 0,"f")},sn=function(n){let s=K(this,it,"f")[n.index];return s||(s={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},K(this,it,"f")[n.index]=s,s)},ns=function(n){var i,r,a,u,d,c,f,p,h,m,_,g,T,w,v;if(this.ended)return;const s=K(this,ee,"m",Eo).call(this,n);this._emit("chunk",n,s);for(const S of n.choices){const C=s.choices[S.index];S.delta.content!=null&&((i=C.message)==null?void 0:i.role)==="assistant"&&((r=C.message)!=null&&r.content)&&(this._emit("content",S.delta.content,C.message.content),this._emit("content.delta",{delta:S.delta.content,snapshot:C.message.content,parsed:C.message.parsed})),S.delta.refusal!=null&&((a=C.message)==null?void 0:a.role)==="assistant"&&((u=C.message)!=null&&u.refusal)&&this._emit("refusal.delta",{delta:S.delta.refusal,snapshot:C.message.refusal}),((d=S.logprobs)==null?void 0:d.content)!=null&&((c=C.message)==null?void 0:c.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(f=S.logprobs)==null?void 0:f.content,snapshot:((p=C.logprobs)==null?void 0:p.content)??[]}),((h=S.logprobs)==null?void 0:h.refusal)!=null&&((m=C.message)==null?void 0:m.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(_=S.logprobs)==null?void 0:_.refusal,snapshot:((g=C.logprobs)==null?void 0:g.refusal)??[]});const N=K(this,ee,"m",sn).call(this,C);C.finish_reason&&(K(this,ee,"m",is).call(this,C),N.current_tool_call_index!=null&&K(this,ee,"m",ss).call(this,C,N.current_tool_call_index));for(const R of S.delta.tool_calls??[])N.current_tool_call_index!==R.index&&(K(this,ee,"m",is).call(this,C),N.current_tool_call_index!=null&&K(this,ee,"m",ss).call(this,C,N.current_tool_call_index)),N.current_tool_call_index=R.index;for(const R of S.delta.tool_calls??[]){const I=(T=C.message.tool_calls)==null?void 0:T[R.index];I!=null&&I.type&&((I==null?void 0:I.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(w=I.function)==null?void 0:w.name,index:R.index,arguments:I.function.arguments,parsed_arguments:I.function.parsed_arguments,arguments_delta:((v=R.function)==null?void 0:v.arguments)??""}):(I==null||I.type,void 0))}}},ss=function(n,s){var a,u,d;if(K(this,ee,"m",sn).call(this,n).done_tool_calls.has(s))return;const r=(a=n.message.tool_calls)==null?void 0:a[s];if(!r)throw new Error("no tool call snapshot");if(!r.type)throw new Error("tool call snapshot missing `type`");if(r.type==="function"){const c=(d=(u=K(this,Ne,"f"))==null?void 0:u.tools)==null?void 0:d.find(f=>f.type==="function"&&f.function.name===r.function.name);this._emit("tool_calls.function.arguments.done",{name:r.function.name,index:s,arguments:r.function.arguments,parsed_arguments:Yt(c)?c.$parseRaw(r.function.arguments):c!=null&&c.function.strict?JSON.parse(r.function.arguments):null})}else r.type},is=function(n){var i,r;const s=K(this,ee,"m",sn).call(this,n);if(n.message.content&&!s.content_done){s.content_done=!0;const a=K(this,ee,"m",rs).call(this);this._emit("content.done",{content:n.message.content,parsed:a?a.$parseRaw(n.message.content):null})}n.message.refusal&&!s.refusal_done&&(s.refusal_done=!0,this._emit("refusal.done",{refusal:n.message.refusal})),(i=n.logprobs)!=null&&i.content&&!s.logprobs_content_done&&(s.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:n.logprobs.content})),(r=n.logprobs)!=null&&r.refusal&&!s.logprobs_refusal_done&&(s.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:n.logprobs.refusal}))},rn=function(){if(this.ended)throw new L("stream has ended, this shouldn't happen");const n=K(this,Fe,"f");if(!n)throw new L("request ended without sending any chunks");return st(this,Fe,void 0,"f"),st(this,it,[],"f"),Pg(n,K(this,Ne,"f"))},rs=function(){var s;const n=(s=K(this,Ne,"f"))==null?void 0:s.response_format;return js(n)?n:null},Eo=function(n){var s,i,r,a;let u=K(this,Fe,"f");const{choices:d,...c}=n;u?Object.assign(u,c):u=st(this,Fe,{...c,choices:[]},"f");for(const{delta:f,finish_reason:p,index:h,logprobs:m=null,..._}of n.choices){let g=u.choices[h];if(g||(g=u.choices[h]={finish_reason:p,index:h,message:{},logprobs:m,..._}),m)if(!g.logprobs)g.logprobs=Object.assign({},m);else{const{content:R,refusal:I,...q}=m;Object.assign(g.logprobs,q),R&&((s=g.logprobs).content??(s.content=[]),g.logprobs.content.push(...R)),I&&((i=g.logprobs).refusal??(i.refusal=[]),g.logprobs.refusal.push(...I))}if(p&&(g.finish_reason=p,K(this,Ne,"f")&&fl(K(this,Ne,"f")))){if(p==="length")throw new Ya;if(p==="content_filter")throw new Ka}if(Object.assign(g,_),!f)continue;const{content:T,refusal:w,function_call:v,role:S,tool_calls:C,...N}=f;if(Object.assign(g.message,N),w&&(g.message.refusal=(g.message.refusal||"")+w),S&&(g.message.role=S),v&&(g.message.function_call?(v.name&&(g.message.function_call.name=v.name),v.arguments&&((r=g.message.function_call).arguments??(r.arguments=""),g.message.function_call.arguments+=v.arguments)):g.message.function_call=v),T&&(g.message.content=(g.message.content||"")+T,!g.message.refusal&&K(this,ee,"m",rs).call(this)&&(g.message.parsed=Co(g.message.content))),C){g.message.tool_calls||(g.message.tool_calls=[]);for(const{index:R,id:I,type:q,function:P,...M}of C){const U=(a=g.message.tool_calls)[R]??(a[R]={});Object.assign(U,M),I&&(U.id=I),q&&(U.type=q),P&&(U.function??(U.function={name:P.name??"",arguments:""})),P!=null&&P.name&&(U.function.name=P.name),P!=null&&P.arguments&&(U.function.arguments+=P.arguments,Sg(K(this,Ne,"f"),U)&&(U.function.parsed_arguments=Co(U.function.arguments)))}}}return u},Symbol.asyncIterator)](){const e=[],n=[];let s=!1;return this.on("chunk",i=>{const r=n.shift();r?r.resolve(i):e.push(i)}),this.on("end",()=>{s=!0;for(const i of n)i.resolve(void 0);n.length=0}),this.on("abort",i=>{s=!0;for(const r of n)r.reject(i);n.length=0}),this.on("error",i=>{s=!0;for(const r of n)r.reject(i);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((r,a)=>n.push({resolve:r,reject:a})).then(r=>r?{value:r,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Re(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Pg(t,e){const{id:n,choices:s,created:i,model:r,system_fingerprint:a,...u}=t,d={...u,id:n,choices:s.map(({message:c,finish_reason:f,index:p,logprobs:h,...m})=>{if(!f)throw new L(`missing finish_reason for choice ${p}`);const{content:_=null,function_call:g,tool_calls:T,...w}=c,v=c.role;if(!v)throw new L(`missing role for choice ${p}`);if(g){const{arguments:S,name:C}=g;if(S==null)throw new L(`missing function_call.arguments for choice ${p}`);if(!C)throw new L(`missing function_call.name for choice ${p}`);return{...m,message:{content:_,function_call:{arguments:S,name:C},role:v,refusal:c.refusal??null},finish_reason:f,index:p,logprobs:h}}return T?{...m,index:p,finish_reason:f,logprobs:h,message:{...w,role:v,content:_,refusal:c.refusal??null,tool_calls:T.map((S,C)=>{const{function:N,type:R,id:I,...q}=S,{arguments:P,name:M,...U}=N||{};if(I==null)throw new L(`missing choices[${p}].tool_calls[${C}].id
${on(t)}`);if(R==null)throw new L(`missing choices[${p}].tool_calls[${C}].type
${on(t)}`);if(M==null)throw new L(`missing choices[${p}].tool_calls[${C}].function.name
${on(t)}`);if(P==null)throw new L(`missing choices[${p}].tool_calls[${C}].function.arguments
${on(t)}`);return{...q,id:I,type:R,function:{...U,name:M,arguments:P}}})}}:{...m,message:{...w,content:_,role:v,refusal:c.refusal??null},finish_reason:f,index:p,logprobs:h}}),created:i,model:r,object:"chat.completion",...a?{system_fingerprint:a}:{}};return _g(d,e)}function on(t){return JSON.stringify(t)}class yt extends Bt{static fromReadableStream(e){const n=new yt(null);return n._run(()=>n._fromReadableStream(e)),n}static runFunctions(e,n,s){const i=new yt(null),r={...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"runFunctions"}};return i._run(()=>i._runFunctions(e,n,r)),i}static runTools(e,n,s){const i=new yt(n),r={...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,n,r)),i}}let Pl=class extends F{parse(e,n){return Cg(e.tools),this._client.chat.completions.create(e,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(s=>ei(s,e))}runFunctions(e,n){return e.stream?yt.runFunctions(this._client,e,n):qt.runFunctions(this._client,e,n)}runTools(e,n){return e.stream?yt.runTools(this._client,e,n):qt.runTools(this._client,e,n)}stream(e,n){return Bt.createChatCompletion(this._client,e,n)}};class Ns extends F{constructor(){super(...arguments),this.completions=new Pl(this._client)}}(function(t){t.Completions=Pl})(Ns||(Ns={}));class xl extends F{create(e,n){return this._client.post("/realtime/sessions",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Nl extends F{create(e,n){return this._client.post("/realtime/transcription_sessions",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class On extends F{constructor(){super(...arguments),this.sessions=new xl(this._client),this.transcriptionSessions=new Nl(this._client)}}On.Sessions=xl;On.TranscriptionSessions=Nl;class ti extends F{create(e,n,s){return this._client.post(`/threads/${e}/messages`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}retrieve(e,n,s){return this._client.get(`/threads/${e}/messages/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}update(e,n,s,i){return this._client.post(`/threads/${e}/messages/${n}`,{body:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,n={},s){return X(n)?this.list(e,{},n):this._client.getAPIList(`/threads/${e}/messages`,ni,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}del(e,n,s){return this._client.delete(`/threads/${e}/messages/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class ni extends ne{}ti.MessagesPage=ni;class si extends F{retrieve(e,n,s,i={},r){return X(i)?this.retrieve(e,n,s,{},i):this._client.get(`/threads/${e}/runs/${n}/steps/${s}`,{query:i,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,n,s={},i){return X(s)?this.list(e,n,{},s):this._client.getAPIList(`/threads/${e}/runs/${n}/steps`,ii,{query:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}}class ii extends ne{}si.RunStepsPage=ii;let Kt=class extends F{constructor(){super(...arguments),this.steps=new si(this._client)}create(e,n,s){const{include:i,...r}=n;return this._client.post(`/threads/${e}/runs`,{query:{include:i},body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:n.stream??!1})}retrieve(e,n,s){return this._client.get(`/threads/${e}/runs/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}update(e,n,s,i){return this._client.post(`/threads/${e}/runs/${n}`,{body:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,n={},s){return X(n)?this.list(e,{},n):this._client.getAPIList(`/threads/${e}/runs`,ri,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}cancel(e,n,s){return this._client.post(`/threads/${e}/runs/${n}/cancel`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async createAndPoll(e,n,s){const i=await this.create(e,n,s);return await this.poll(e,i.id,s)}createAndStream(e,n,s){return Se.createAssistantStream(e,this._client.beta.threads.runs,n,s)}async poll(e,n,s){const i={...s==null?void 0:s.headers,"X-Stainless-Poll-Helper":"true"};for(s!=null&&s.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){const{data:r,response:a}=await this.retrieve(e,n,{...s,headers:{...s==null?void 0:s.headers,...i}}).withResponse();switch(r.status){case"queued":case"in_progress":case"cancelling":let u=5e3;if(s!=null&&s.pollIntervalMs)u=s.pollIntervalMs;else{const d=a.headers.get("openai-poll-after-ms");if(d){const c=parseInt(d);isNaN(c)||(u=c)}}await Jt(u);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return r}}}stream(e,n,s){return Se.createAssistantStream(e,this._client.beta.threads.runs,n,s)}submitToolOutputs(e,n,s,i){return this._client.post(`/threads/${e}/runs/${n}/submit_tool_outputs`,{body:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers},stream:s.stream??!1})}async submitToolOutputsAndPoll(e,n,s,i){const r=await this.submitToolOutputs(e,n,s,i);return await this.poll(e,r.id,i)}submitToolOutputsStream(e,n,s,i){return Se.createToolAssistantStream(e,n,this._client.beta.threads.runs,s,i)}};class ri extends ne{}Kt.RunsPage=ri;Kt.Steps=si;Kt.RunStepsPage=ii;class At extends F{constructor(){super(...arguments),this.runs=new Kt(this._client),this.messages=new ti(this._client)}create(e={},n){return X(e)?this.create({},e):this._client.post("/threads",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,n){return this._client.get(`/threads/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,n,s){return this._client.post(`/threads/${e}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}del(e,n){return this._client.delete(`/threads/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}createAndRun(e,n){return this._client.post("/threads/runs",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:e.stream??!1})}async createAndRunPoll(e,n){const s=await this.createAndRun(e,n);return await this.runs.poll(s.thread_id,s.id,n)}createAndRunStream(e,n){return Se.createThreadAssistantStream(e,this._client.beta.threads,n)}}At.Runs=Kt;At.RunsPage=ri;At.Messages=ti;At.MessagesPage=ni;class Rt extends F{constructor(){super(...arguments),this.realtime=new On(this._client),this.chat=new Ns(this._client),this.assistants=new Xs(this._client),this.threads=new At(this._client)}}Rt.Realtime=On;Rt.Assistants=Xs;Rt.AssistantsPage=Qs;Rt.Threads=At;class Ml extends F{create(e,n){return this._client.post("/completions",{body:e,...n,stream:e.stream??!1})}}class kl extends F{retrieve(e,n,s){return this._client.get(`/containers/${e}/files/${n}/content`,{...s,headers:{Accept:"application/binary",...s==null?void 0:s.headers},__binaryResponse:!0})}}let Hn=class extends F{constructor(){super(...arguments),this.content=new kl(this._client)}create(e,n,s){return this._client.post(`/containers/${e}/files`,et({body:n,...s}))}retrieve(e,n,s){return this._client.get(`/containers/${e}/files/${n}`,s)}list(e,n={},s){return X(n)?this.list(e,{},n):this._client.getAPIList(`/containers/${e}/files`,oi,{query:n,...s})}del(e,n,s){return this._client.delete(`/containers/${e}/files/${n}`,{...s,headers:{Accept:"*/*",...s==null?void 0:s.headers}})}};class oi extends ne{}Hn.FileListResponsesPage=oi;Hn.Content=kl;class zt extends F{constructor(){super(...arguments),this.files=new Hn(this._client)}create(e,n){return this._client.post("/containers",{body:e,...n})}retrieve(e,n){return this._client.get(`/containers/${e}`,n)}list(e={},n){return X(e)?this.list({},e):this._client.getAPIList("/containers",ai,{query:e,...n})}del(e,n){return this._client.delete(`/containers/${e}`,{...n,headers:{Accept:"*/*",...n==null?void 0:n.headers}})}}class ai extends ne{}zt.ContainerListResponsesPage=ai;zt.Files=Hn;zt.FileListResponsesPage=oi;class bl extends F{create(e,n){const s=!!e.encoding_format;let i=s?e.encoding_format:"base64";s&&Be("Request","User defined encoding_format:",e.encoding_format);const r=this._client.post("/embeddings",{body:{...e,encoding_format:i},...n});return s?r:(Be("response","Decoding base64 embeddings to float32 array"),r._thenUnwrap(a=>(a&&a.data&&a.data.forEach(u=>{const d=u.embedding;u.embedding=gg(d)}),a)))}}class li extends F{retrieve(e,n,s,i){return this._client.get(`/evals/${e}/runs/${n}/output_items/${s}`,i)}list(e,n,s={},i){return X(s)?this.list(e,n,{},s):this._client.getAPIList(`/evals/${e}/runs/${n}/output_items`,ui,{query:s,...i})}}class ui extends ne{}li.OutputItemListResponsesPage=ui;class Zt extends F{constructor(){super(...arguments),this.outputItems=new li(this._client)}create(e,n,s){return this._client.post(`/evals/${e}/runs`,{body:n,...s})}retrieve(e,n,s){return this._client.get(`/evals/${e}/runs/${n}`,s)}list(e,n={},s){return X(n)?this.list(e,{},n):this._client.getAPIList(`/evals/${e}/runs`,ci,{query:n,...s})}del(e,n,s){return this._client.delete(`/evals/${e}/runs/${n}`,s)}cancel(e,n,s){return this._client.post(`/evals/${e}/runs/${n}`,s)}}class ci extends ne{}Zt.RunListResponsesPage=ci;Zt.OutputItems=li;Zt.OutputItemListResponsesPage=ui;class Xt extends F{constructor(){super(...arguments),this.runs=new Zt(this._client)}create(e,n){return this._client.post("/evals",{body:e,...n})}retrieve(e,n){return this._client.get(`/evals/${e}`,n)}update(e,n,s){return this._client.post(`/evals/${e}`,{body:n,...s})}list(e={},n){return X(e)?this.list({},e):this._client.getAPIList("/evals",di,{query:e,...n})}del(e,n){return this._client.delete(`/evals/${e}`,n)}}class di extends ne{}Xt.EvalListResponsesPage=di;Xt.Runs=Zt;Xt.RunListResponsesPage=ci;let fi=class extends F{create(e,n){return this._client.post("/files",et({body:e,...n}))}retrieve(e,n){return this._client.get(`/files/${e}`,n)}list(e={},n){return X(e)?this.list({},e):this._client.getAPIList("/files",pi,{query:e,...n})}del(e,n){return this._client.delete(`/files/${e}`,n)}content(e,n){return this._client.get(`/files/${e}/content`,{...n,headers:{Accept:"application/binary",...n==null?void 0:n.headers},__binaryResponse:!0})}retrieveContent(e,n){return this._client.get(`/files/${e}/content`,n)}async waitForProcessing(e,{pollInterval:n=5e3,maxWait:s=1800*1e3}={}){const i=new Set(["processed","error","deleted"]),r=Date.now();let a=await this.retrieve(e);for(;!a.status||!i.has(a.status);)if(await Jt(n),a=await this.retrieve(e),Date.now()-r>s)throw new Ys({message:`Giving up on waiting for file ${e} to finish processing after ${s} milliseconds.`});return a}};class pi extends ne{}fi.FileObjectsPage=pi;class Dl extends F{}let Ul=class extends F{run(e,n){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...n})}validate(e,n){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...n})}};class hi extends F{constructor(){super(...arguments),this.graders=new Ul(this._client)}}hi.Graders=Ul;class mi extends F{create(e,n,s){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,gi,{body:n,method:"post",...s})}retrieve(e,n={},s){return X(n)?this.retrieve(e,{},n):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:n,...s})}del(e,n,s){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions/${n}`,s)}}class gi extends Gn{}mi.PermissionCreateResponsesPage=gi;let Jn=class extends F{constructor(){super(...arguments),this.permissions=new mi(this._client)}};Jn.Permissions=mi;Jn.PermissionCreateResponsesPage=gi;class yi extends F{list(e,n={},s){return X(n)?this.list(e,{},n):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,_i,{query:n,...s})}}class _i extends ne{}yi.FineTuningJobCheckpointsPage=_i;class Pt extends F{constructor(){super(...arguments),this.checkpoints=new yi(this._client)}create(e,n){return this._client.post("/fine_tuning/jobs",{body:e,...n})}retrieve(e,n){return this._client.get(`/fine_tuning/jobs/${e}`,n)}list(e={},n){return X(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Ti,{query:e,...n})}cancel(e,n){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,n)}listEvents(e,n={},s){return X(n)?this.listEvents(e,{},n):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,vi,{query:n,...s})}pause(e,n){return this._client.post(`/fine_tuning/jobs/${e}/pause`,n)}resume(e,n){return this._client.post(`/fine_tuning/jobs/${e}/resume`,n)}}class Ti extends ne{}class vi extends ne{}Pt.FineTuningJobsPage=Ti;Pt.FineTuningJobEventsPage=vi;Pt.Checkpoints=yi;Pt.FineTuningJobCheckpointsPage=_i;class ze extends F{constructor(){super(...arguments),this.methods=new Dl(this._client),this.jobs=new Pt(this._client),this.checkpoints=new Jn(this._client),this.alpha=new hi(this._client)}}ze.Methods=Dl;ze.Jobs=Pt;ze.FineTuningJobsPage=Ti;ze.FineTuningJobEventsPage=vi;ze.Checkpoints=Jn;ze.Alpha=hi;class Ll extends F{}class Si extends F{constructor(){super(...arguments),this.graderModels=new Ll(this._client)}}Si.GraderModels=Ll;class Fl extends F{createVariation(e,n){return this._client.post("/images/variations",et({body:e,...n}))}edit(e,n){return this._client.post("/images/edits",et({body:e,...n}))}generate(e,n){return this._client.post("/images/generations",{body:e,...n})}}class Ci extends F{retrieve(e,n){return this._client.get(`/models/${e}`,n)}list(e){return this._client.getAPIList("/models",Ei,e)}del(e,n){return this._client.delete(`/models/${e}`,n)}}class Ei extends Gn{}Ci.ModelsPage=Ei;class $l extends F{create(e,n){return this._client.post("/moderations",{body:e,...n})}}function xg(t,e){return!e||!Mg(e)?{...t,output_parsed:null,output:t.output.map(n=>n.type==="function_call"?{...n,parsed_arguments:null}:n.type==="message"?{...n,content:n.content.map(s=>({...s,parsed:null}))}:n)}:Gl(t,e)}function Gl(t,e){const n=t.output.map(i=>{if(i.type==="function_call")return{...i,parsed_arguments:Dg(e,i)};if(i.type==="message"){const r=i.content.map(a=>a.type==="output_text"?{...a,parsed:Ng(e,a.text)}:a);return{...i,content:r}}return i}),s=Object.assign({},t,{output:n});return Object.getOwnPropertyDescriptor(t,"output_text")||Vl(s),Object.defineProperty(s,"output_parsed",{enumerable:!0,get(){for(const i of s.output)if(i.type==="message"){for(const r of i.content)if(r.type==="output_text"&&r.parsed!==null)return r.parsed}return null}}),s}function Ng(t,e){var n,s,i,r;return((s=(n=t.text)==null?void 0:n.format)==null?void 0:s.type)!=="json_schema"?null:"$parseRaw"in((i=t.text)==null?void 0:i.format)?((r=t.text)==null?void 0:r.format).$parseRaw(e):JSON.parse(e)}function Mg(t){var e;return!!js((e=t.text)==null?void 0:e.format)}function kg(t){return(t==null?void 0:t.$brand)==="auto-parseable-tool"}function bg(t,e){return t.find(n=>n.type==="function"&&n.name===e)}function Dg(t,e){const n=bg(t.tools??[],e.name);return{...e,...e,parsed_arguments:kg(n)?n.$parseRaw(e.arguments):n!=null&&n.strict?JSON.parse(e.arguments):null}}function Vl(t){const e=[];for(const n of t.output)if(n.type==="message")for(const s of n.content)s.type==="output_text"&&e.push(s.text);t.output_text=e.join("")}class ql extends F{list(e,n={},s){return X(n)?this.list(e,{},n):this._client.getAPIList(`/responses/${e}/input_items`,Lg,{query:n,...s})}}var rt=function(t,e,n,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(t,n):i?i.value=n:e.set(t,n),n},$e=function(t,e,n,s){if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)},ot,an,Ge,ln,wo,Io,Ao,Ro;class wi extends Zs{constructor(e){super(),ot.add(this),an.set(this,void 0),Ge.set(this,void 0),ln.set(this,void 0),rt(this,an,e,"f")}static createResponse(e,n,s){const i=new wi(n);return i._run(()=>i._createOrRetrieveResponse(e,n,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createOrRetrieveResponse(e,n,s){var u;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),$e(this,ot,"m",wo).call(this);let r,a=null;"response_id"in n?(r=await e.responses.retrieve(n.response_id,{stream:!0},{...s,signal:this.controller.signal,stream:!0}),a=n.starting_after??null):r=await e.responses.create({...n,stream:!0},{...s,signal:this.controller.signal}),this._connected();for await(const d of r)$e(this,ot,"m",Io).call(this,d,a);if((u=r.controller.signal)!=null&&u.aborted)throw new ge;return $e(this,ot,"m",Ao).call(this)}[(an=new WeakMap,Ge=new WeakMap,ln=new WeakMap,ot=new WeakSet,wo=function(){this.ended||rt(this,Ge,void 0,"f")},Io=function(n,s){if(this.ended)return;const i=(a,u)=>{(s==null||u.sequence_number>s)&&this._emit(a,u)},r=$e(this,ot,"m",Ro).call(this,n);switch(i("event",n),n.type){case"response.output_text.delta":{const a=r.output[n.output_index];if(!a)throw new L(`missing output at index ${n.output_index}`);if(a.type==="message"){const u=a.content[n.content_index];if(!u)throw new L(`missing content at index ${n.content_index}`);if(u.type!=="output_text")throw new L(`expected content to be 'output_text', got ${u.type}`);i("response.output_text.delta",{...n,snapshot:u.text})}break}case"response.function_call_arguments.delta":{const a=r.output[n.output_index];if(!a)throw new L(`missing output at index ${n.output_index}`);a.type==="function_call"&&i("response.function_call_arguments.delta",{...n,snapshot:a.arguments});break}default:i(n.type,n);break}},Ao=function(){if(this.ended)throw new L("stream has ended, this shouldn't happen");const n=$e(this,Ge,"f");if(!n)throw new L("request ended without sending any events");rt(this,Ge,void 0,"f");const s=Ug(n,$e(this,an,"f"));return rt(this,ln,s,"f"),s},Ro=function(n){let s=$e(this,Ge,"f");if(!s){if(n.type!=="response.created")throw new L(`When snapshot hasn't been set yet, expected 'response.created' event, got ${n.type}`);return s=rt(this,Ge,n.response,"f"),s}switch(n.type){case"response.output_item.added":{s.output.push(n.item);break}case"response.content_part.added":{const i=s.output[n.output_index];if(!i)throw new L(`missing output at index ${n.output_index}`);i.type==="message"&&i.content.push(n.part);break}case"response.output_text.delta":{const i=s.output[n.output_index];if(!i)throw new L(`missing output at index ${n.output_index}`);if(i.type==="message"){const r=i.content[n.content_index];if(!r)throw new L(`missing content at index ${n.content_index}`);if(r.type!=="output_text")throw new L(`expected content to be 'output_text', got ${r.type}`);r.text+=n.delta}break}case"response.function_call_arguments.delta":{const i=s.output[n.output_index];if(!i)throw new L(`missing output at index ${n.output_index}`);i.type==="function_call"&&(i.arguments+=n.delta);break}case"response.completed":{rt(this,Ge,n.response,"f");break}}return s},Symbol.asyncIterator)](){const e=[],n=[];let s=!1;return this.on("event",i=>{const r=n.shift();r?r.resolve(i):e.push(i)}),this.on("end",()=>{s=!0;for(const i of n)i.resolve(void 0);n.length=0}),this.on("abort",i=>{s=!0;for(const r of n)r.reject(i);n.length=0}),this.on("error",i=>{s=!0;for(const r of n)r.reject(i);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((r,a)=>n.push({resolve:r,reject:a})).then(r=>r?{value:r,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=$e(this,ln,"f");if(!e)throw new L("stream ended without producing a ChatCompletion");return e}}function Ug(t,e){return xg(t,e)}class Ii extends F{constructor(){super(...arguments),this.inputItems=new ql(this._client)}create(e,n){return this._client.post("/responses",{body:e,...n,stream:e.stream??!1})._thenUnwrap(s=>("object"in s&&s.object==="response"&&Vl(s),s))}retrieve(e,n={},s){return this._client.get(`/responses/${e}`,{query:n,...s,stream:(n==null?void 0:n.stream)??!1})}del(e,n){return this._client.delete(`/responses/${e}`,{...n,headers:{Accept:"*/*",...n==null?void 0:n.headers}})}parse(e,n){return this._client.responses.create(e,n)._thenUnwrap(s=>Gl(s,e))}stream(e,n){return wi.createResponse(this._client,e,n)}cancel(e,n){return this._client.post(`/responses/${e}/cancel`,{...n,headers:{Accept:"*/*",...n==null?void 0:n.headers}})}}class Lg extends ne{}Ii.InputItems=ql;class Bl extends F{create(e,n,s){return this._client.post(`/uploads/${e}/parts`,et({body:n,...s}))}}class Ai extends F{constructor(){super(...arguments),this.parts=new Bl(this._client)}create(e,n){return this._client.post("/uploads",{body:e,...n})}cancel(e,n){return this._client.post(`/uploads/${e}/cancel`,n)}complete(e,n,s){return this._client.post(`/uploads/${e}/complete`,{body:n,...s})}}Ai.Parts=Bl;const Fg=async t=>{const e=await Promise.allSettled(t),n=e.filter(i=>i.status==="rejected");if(n.length){for(const i of n)console.error(i.reason);throw new Error(`${n.length} promise(s) failed - see the above errors`)}const s=[];for(const i of e)i.status==="fulfilled"&&s.push(i.value);return s};class Wn extends F{create(e,n,s){return this._client.post(`/vector_stores/${e}/files`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}retrieve(e,n,s){return this._client.get(`/vector_stores/${e}/files/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}update(e,n,s,i){return this._client.post(`/vector_stores/${e}/files/${n}`,{body:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,n={},s){return X(n)?this.list(e,{},n):this._client.getAPIList(`/vector_stores/${e}/files`,Yn,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}del(e,n,s){return this._client.delete(`/vector_stores/${e}/files/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async createAndPoll(e,n,s){const i=await this.create(e,n,s);return await this.poll(e,i.id,s)}async poll(e,n,s){const i={...s==null?void 0:s.headers,"X-Stainless-Poll-Helper":"true"};for(s!=null&&s.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){const r=await this.retrieve(e,n,{...s,headers:i}).withResponse(),a=r.data;switch(a.status){case"in_progress":let u=5e3;if(s!=null&&s.pollIntervalMs)u=s.pollIntervalMs;else{const d=r.response.headers.get("openai-poll-after-ms");if(d){const c=parseInt(d);isNaN(c)||(u=c)}}await Jt(u);break;case"failed":case"completed":return a}}}async upload(e,n,s){const i=await this._client.files.create({file:n,purpose:"assistants"},s);return this.create(e,{file_id:i.id},s)}async uploadAndPoll(e,n,s){const i=await this.upload(e,n,s);return await this.poll(e,i.id,s)}content(e,n,s){return this._client.getAPIList(`/vector_stores/${e}/files/${n}/content`,Ri,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class Yn extends ne{}class Ri extends Gn{}Wn.VectorStoreFilesPage=Yn;Wn.FileContentResponsesPage=Ri;class Ol extends F{create(e,n,s){return this._client.post(`/vector_stores/${e}/file_batches`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}retrieve(e,n,s){return this._client.get(`/vector_stores/${e}/file_batches/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}cancel(e,n,s){return this._client.post(`/vector_stores/${e}/file_batches/${n}/cancel`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async createAndPoll(e,n,s){const i=await this.create(e,n);return await this.poll(e,i.id,s)}listFiles(e,n,s={},i){return X(s)?this.listFiles(e,n,{},s):this._client.getAPIList(`/vector_stores/${e}/file_batches/${n}/files`,Yn,{query:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}async poll(e,n,s){const i={...s==null?void 0:s.headers,"X-Stainless-Poll-Helper":"true"};for(s!=null&&s.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){const{data:r,response:a}=await this.retrieve(e,n,{...s,headers:i}).withResponse();switch(r.status){case"in_progress":let u=5e3;if(s!=null&&s.pollIntervalMs)u=s.pollIntervalMs;else{const d=a.headers.get("openai-poll-after-ms");if(d){const c=parseInt(d);isNaN(c)||(u=c)}}await Jt(u);break;case"failed":case"cancelled":case"completed":return r}}}async uploadAndPoll(e,{files:n,fileIds:s=[]},i){if(n==null||n.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const r=(i==null?void 0:i.maxConcurrency)??5,a=Math.min(r,n.length),u=this._client,d=n.values(),c=[...s];async function f(h){for(let m of h){const _=await u.files.create({file:m,purpose:"assistants"},i);c.push(_.id)}}const p=Array(a).fill(d).map(f);return await Fg(p),await this.createAndPoll(e,{file_ids:c})}}class Ze extends F{constructor(){super(...arguments),this.files=new Wn(this._client),this.fileBatches=new Ol(this._client)}create(e,n){return this._client.post("/vector_stores",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,n){return this._client.get(`/vector_stores/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,n,s){return this._client.post(`/vector_stores/${e}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e={},n){return X(e)?this.list({},e):this._client.getAPIList("/vector_stores",Pi,{query:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,n){return this._client.delete(`/vector_stores/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}search(e,n,s){return this._client.getAPIList(`/vector_stores/${e}/search`,xi,{body:n,method:"post",...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class Pi extends ne{}class xi extends Gn{}Ze.VectorStoresPage=Pi;Ze.VectorStoreSearchResponsesPage=xi;Ze.Files=Wn;Ze.VectorStoreFilesPage=Yn;Ze.FileContentResponsesPage=Ri;Ze.FileBatches=Ol;var Hl;class V extends ig{constructor({baseURL:e=tn("OPENAI_BASE_URL"),apiKey:n=tn("OPENAI_API_KEY"),organization:s=tn("OPENAI_ORG_ID")??null,project:i=tn("OPENAI_PROJECT_ID")??null,...r}={}){if(n===void 0)throw new L("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const a={apiKey:n,organization:s,project:i,...r,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&hg())throw new L(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new Ml(this),this.chat=new Bn(this),this.embeddings=new bl(this),this.files=new fi(this),this.images=new Fl(this),this.audio=new Wt(this),this.moderations=new $l(this),this.models=new Ci(this),this.fineTuning=new ze(this),this.graders=new Si(this),this.vectorStores=new Ze(this),this.beta=new Rt(this),this.batches=new Ks(this),this.uploads=new Ai(this),this.responses=new Ii(this),this.evals=new Xt(this),this.containers=new zt(this),this._options=a,this.apiKey=n,this.organization=s,this.project=i}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return Vm(e,{arrayFormat:"brackets"})}}Hl=V;V.OpenAI=Hl;V.DEFAULT_TIMEOUT=6e5;V.OpenAIError=L;V.APIError=re;V.APIConnectionError=Un;V.APIConnectionTimeoutError=Ys;V.APIUserAbortError=ge;V.NotFoundError=Ba;V.ConflictError=Oa;V.RateLimitError=Ja;V.BadRequestError=Ga;V.AuthenticationError=Va;V.InternalServerError=Wa;V.PermissionDeniedError=qa;V.UnprocessableEntityError=Ha;V.toFile=Qa;V.fileFromPath=La;V.Completions=Ml;V.Chat=Bn;V.ChatCompletionsPage=qn;V.Embeddings=bl;V.Files=fi;V.FileObjectsPage=pi;V.Images=Fl;V.Audio=Wt;V.Moderations=$l;V.Models=Ci;V.ModelsPage=Ei;V.FineTuning=ze;V.Graders=Si;V.VectorStores=Ze;V.VectorStoresPage=Pi;V.VectorStoreSearchResponsesPage=xi;V.Beta=Rt;V.Batches=Ks;V.BatchesPage=zs;V.Uploads=Ai;V.Responses=Ii;V.Evals=Xt;V.EvalListResponsesPage=di;V.Containers=zt;V.ContainerListResponsesPage=ai;const $g=t=>typeof t=="object"&&t!==null&&"aborted"in t,Jl=t=>t?$g(t)?{signal:t}:t:{},Gg=async(t,e=2,n)=>{let s;for(let i=0;i<e;i++){if(n!=null&&n.aborted)throw new DOMException("Aborted","AbortError");try{return await t()}catch(r){if(s=r,n!=null&&n.aborted||i===e-1)throw s;console.warn(`API call failed, retrying... (${i+1}/${e})`,r),await new Promise(a=>setTimeout(a,500))}}throw s},Vg=new Set(["user","assistant","system","developer"]),qg=t=>Vg.has(t)?t:"user",Bg=t=>{if(typeof t=="string")return t;if(Array.isArray(t))return t.map(e=>typeof e=="string"?e:"text"in e&&typeof e.text=="string"?e.text:JSON.stringify(e)).join(`
`);if(t&&typeof t=="object"&&"text"in t){const e=t.text;if(typeof e=="string")return e}return""},Og=t=>t.map(e=>({role:qg(e.role),content:Bg(e.content),type:"message"})),Hg=t=>{},Jg=t=>{var e,n,s;return(t==null?void 0:t.status)??((e=t==null?void 0:t.response)==null?void 0:e.status)??(t==null?void 0:t.code)??((n=t==null?void 0:t.error)==null?void 0:n.status)??((s=t==null?void 0:t.cause)==null?void 0:s.status)},Wg=(t,e)=>new Promise((n,s)=>{if(e!=null&&e.aborted){s(new DOMException("Aborted","AbortError"));return}const i=setTimeout(n,t);if(e){const r=()=>{clearTimeout(i),s(new DOMException("Aborted","AbortError"))};e.addEventListener("abort",r,{once:!0})}}),Yg=async(t,e,n,s)=>{var m;if(!t.openAIApiKey)throw new Error("OpenAI API key is not set.");const i=new V({apiKey:t.openAIApiKey,dangerouslyAllowBrowser:!0}),r=Jl(s),a=Hg(),u={model:t.model,input:Og(e)};a&&(u.text={format:a});const d=2,c=3e4,f=Date.now();let p=0,h;for(;p<d;){if((m=r.signal)!=null&&m.aborted)throw new DOMException("Aborted","AbortError");try{const _=await i.responses.create(u,r.signal?{signal:r.signal}:void 0),g=_==null?void 0:_.usage;g&&r.onUsage&&r.onUsage({provider:"openai",model:t.model,promptTokens:g.prompt_tokens??g.input_tokens??g.input_token_count,completionTokens:g.completion_tokens??g.output_tokens??g.output_token_count,totalTokens:g.total_tokens??g.total_token_count,operation:r.operation});const T=(_.output_text??"").trim();if(!T)throw new Error("OpenAI returned an empty response.");return T}catch(_){h=_;const g=Jg(_),T=g===429||typeof g=="number"&&g>=500,w=Date.now()-f;if(!T||p===d-1||w>=c)throw _;const v=Math.min(2e3,500*Math.pow(2,p));await Wg(v,r.signal),p+=1}}throw h instanceof Error?h:new Error("OpenAI request failed.")},Kg=async(t,e,n,s)=>{if(!t.geminiApiKey)throw new Error("Gemini API key is not set.");const i=new Nm({apiKey:t.geminiApiKey}),r=Jl(s),u=`${e}`.trim(),d=await Gg(()=>i.models.generateContent({model:t.model,contents:u},r.signal?{signal:r.signal}:void 0),2,r.signal),c=d.usageMetadata;return c&&r.onUsage&&r.onUsage({provider:"gemini",model:t.model,promptTokens:c.promptTokenCount??void 0,completionTokens:c.candidatesTokenCount??void 0,totalTokens:c.totalTokenCount??void 0,operation:r.operation}),d.text.trim()};var W;(function(t){t.assertEqual=i=>{};function e(i){}t.assertIs=e;function n(i){throw new Error}t.assertNever=n,t.arrayToEnum=i=>{const r={};for(const a of i)r[a]=a;return r},t.getValidEnumValues=i=>{const r=t.objectKeys(i).filter(u=>typeof i[i[u]]!="number"),a={};for(const u of r)a[u]=i[u];return t.objectValues(a)},t.objectValues=i=>t.objectKeys(i).map(function(r){return i[r]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{const r=[];for(const a in i)Object.prototype.hasOwnProperty.call(i,a)&&r.push(a);return r},t.find=(i,r)=>{for(const a of i)if(r(a))return a},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&Number.isFinite(i)&&Math.floor(i)===i;function s(i,r=" | "){return i.map(a=>typeof a=="string"?`'${a}'`:a).join(r)}t.joinValues=s,t.jsonStringifyReplacer=(i,r)=>typeof r=="bigint"?r.toString():r})(W||(W={}));var Po;(function(t){t.mergeShapes=(e,n)=>({...e,...n})})(Po||(Po={}));const k=W.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Ve=t=>{switch(typeof t){case"undefined":return k.undefined;case"string":return k.string;case"number":return Number.isNaN(t)?k.nan:k.number;case"boolean":return k.boolean;case"function":return k.function;case"bigint":return k.bigint;case"symbol":return k.symbol;case"object":return Array.isArray(t)?k.array:t===null?k.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?k.promise:typeof Map<"u"&&t instanceof Map?k.map:typeof Set<"u"&&t instanceof Set?k.set:typeof Date<"u"&&t instanceof Date?k.date:k.object;default:return k.unknown}},E=W.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class be extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=e}format(e){const n=e||function(r){return r.message},s={_errors:[]},i=r=>{for(const a of r.issues)if(a.code==="invalid_union")a.unionErrors.map(i);else if(a.code==="invalid_return_type")i(a.returnTypeError);else if(a.code==="invalid_arguments")i(a.argumentsError);else if(a.path.length===0)s._errors.push(n(a));else{let u=s,d=0;for(;d<a.path.length;){const c=a.path[d];d===a.path.length-1?(u[c]=u[c]||{_errors:[]},u[c]._errors.push(n(a))):u[c]=u[c]||{_errors:[]},u=u[c],d++}}};return i(this),s}static assert(e){if(!(e instanceof be))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,W.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=n=>n.message){const n={},s=[];for(const i of this.issues)if(i.path.length>0){const r=i.path[0];n[r]=n[r]||[],n[r].push(e(i))}else s.push(e(i));return{formErrors:s,fieldErrors:n}}get formErrors(){return this.flatten()}}be.create=t=>new be(t);const Ms=(t,e)=>{let n;switch(t.code){case E.invalid_type:t.received===k.undefined?n="Required":n=`Expected ${t.expected}, received ${t.received}`;break;case E.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(t.expected,W.jsonStringifyReplacer)}`;break;case E.unrecognized_keys:n=`Unrecognized key(s) in object: ${W.joinValues(t.keys,", ")}`;break;case E.invalid_union:n="Invalid input";break;case E.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${W.joinValues(t.options)}`;break;case E.invalid_enum_value:n=`Invalid enum value. Expected ${W.joinValues(t.options)}, received '${t.received}'`;break;case E.invalid_arguments:n="Invalid function arguments";break;case E.invalid_return_type:n="Invalid function return type";break;case E.invalid_date:n="Invalid date";break;case E.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(n=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?n=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?n=`Invalid input: must end with "${t.validation.endsWith}"`:W.assertNever(t.validation):t.validation!=="regex"?n=`Invalid ${t.validation}`:n="Invalid";break;case E.too_small:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:n="Invalid input";break;case E.too_big:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?n=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:n="Invalid input";break;case E.custom:n="Invalid input";break;case E.invalid_intersection_types:n="Intersection results could not be merged";break;case E.not_multiple_of:n=`Number must be a multiple of ${t.multipleOf}`;break;case E.not_finite:n="Number must be finite";break;default:n=e.defaultError,W.assertNever(t)}return{message:n}};let zg=Ms;function Zg(){return zg}const Xg=t=>{const{data:e,path:n,errorMaps:s,issueData:i}=t,r=[...n,...i.path||[]],a={...i,path:r};if(i.message!==void 0)return{...i,path:r,message:i.message};let u="";const d=s.filter(c=>!!c).slice().reverse();for(const c of d)u=c(a,{data:e,defaultError:u}).message;return{...i,path:r,message:u}};function x(t,e){const n=Zg(),s=Xg({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,n,n===Ms?void 0:Ms].filter(i=>!!i)});t.common.issues.push(s)}class pe{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,n){const s=[];for(const i of n){if(i.status==="aborted")return $;i.status==="dirty"&&e.dirty(),s.push(i.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,n){const s=[];for(const i of n){const r=await i.key,a=await i.value;s.push({key:r,value:a})}return pe.mergeObjectSync(e,s)}static mergeObjectSync(e,n){const s={};for(const i of n){const{key:r,value:a}=i;if(r.status==="aborted"||a.status==="aborted")return $;r.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),r.value!=="__proto__"&&(typeof a.value<"u"||i.alwaysSet)&&(s[r.value]=a.value)}return{status:e.value,value:s}}}const $=Object.freeze({status:"aborted"}),Lt=t=>({status:"dirty",value:t}),_e=t=>({status:"valid",value:t}),xo=t=>t.status==="aborted",No=t=>t.status==="dirty",_t=t=>t.status==="valid",In=t=>typeof Promise<"u"&&t instanceof Promise;var b;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(b||(b={}));class We{constructor(e,n,s,i){this._cachedPath=[],this.parent=e,this.data=n,this._path=s,this._key=i}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Mo=(t,e)=>{if(_t(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new be(t.common.issues);return this._error=n,this._error}}};function B(t){if(!t)return{};const{errorMap:e,invalid_type_error:n,required_error:s,description:i}=t;if(e&&(n||s))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(a,u)=>{const{message:d}=t;return a.code==="invalid_enum_value"?{message:d??u.defaultError}:typeof u.data>"u"?{message:d??s??u.defaultError}:a.code!=="invalid_type"?{message:u.defaultError}:{message:d??n??u.defaultError}},description:i}}class J{get description(){return this._def.description}_getType(e){return Ve(e.data)}_getOrReturnCtx(e,n){return n||{common:e.parent.common,data:e.data,parsedType:Ve(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new pe,ctx:{common:e.parent.common,data:e.data,parsedType:Ve(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const n=this._parse(e);if(In(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(e){const n=this._parse(e);return Promise.resolve(n)}parse(e,n){const s=this.safeParse(e,n);if(s.success)return s.data;throw s.error}safeParse(e,n){const s={common:{issues:[],async:(n==null?void 0:n.async)??!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ve(e)},i=this._parseSync({data:e,path:s.path,parent:s});return Mo(s,i)}"~validate"(e){var s,i;const n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ve(e)};if(!this["~standard"].async)try{const r=this._parseSync({data:e,path:[],parent:n});return _t(r)?{value:r.value}:{issues:n.common.issues}}catch(r){(i=(s=r==null?void 0:r.message)==null?void 0:s.toLowerCase())!=null&&i.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(r=>_t(r)?{value:r.value}:{issues:n.common.issues})}async parseAsync(e,n){const s=await this.safeParseAsync(e,n);if(s.success)return s.data;throw s.error}async safeParseAsync(e,n){const s={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ve(e)},i=this._parse({data:e,path:s.path,parent:s}),r=await(In(i)?i:Promise.resolve(i));return Mo(s,r)}refine(e,n){const s=i=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(i):n;return this._refinement((i,r)=>{const a=e(i),u=()=>r.addIssue({code:E.custom,...s(i)});return typeof Promise<"u"&&a instanceof Promise?a.then(d=>d?!0:(u(),!1)):a?!0:(u(),!1)})}refinement(e,n){return this._refinement((s,i)=>e(s)?!0:(i.addIssue(typeof n=="function"?n(s,i):n),!1))}_refinement(e){return new St({schema:this,typeName:G.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return Oe.create(this,this._def)}nullable(){return Ct.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Pe.create(this)}promise(){return xn.create(this,this._def)}or(e){return Rn.create([this,e],this._def)}and(e){return Pn.create(this,e,this._def)}transform(e){return new St({...B(this._def),schema:this,typeName:G.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const n=typeof e=="function"?e:()=>e;return new Ds({...B(this._def),innerType:this,defaultValue:n,typeName:G.ZodDefault})}brand(){return new vy({typeName:G.ZodBranded,type:this,...B(this._def)})}catch(e){const n=typeof e=="function"?e:()=>e;return new Us({...B(this._def),innerType:this,catchValue:n,typeName:G.ZodCatch})}describe(e){const n=this.constructor;return new n({...this._def,description:e})}pipe(e){return Ni.create(this,e)}readonly(){return Ls.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Qg=/^c[^\s-]{8,}$/i,jg=/^[0-9a-z]+$/,ey=/^[0-9A-HJKMNP-TV-Z]{26}$/i,ty=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,ny=/^[a-z0-9_-]{21}$/i,sy=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,iy=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,ry=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,oy="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let os;const ay=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ly=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,uy=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,cy=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,dy=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,fy=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Wl="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",py=new RegExp(`^${Wl}$`);function Yl(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);const n=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${n}`}function hy(t){return new RegExp(`^${Yl(t)}$`)}function my(t){let e=`${Wl}T${Yl(t)}`;const n=[];return n.push(t.local?"Z?":"Z"),t.offset&&n.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${n.join("|")})`,new RegExp(`^${e}$`)}function gy(t,e){return!!((e==="v4"||!e)&&ay.test(t)||(e==="v6"||!e)&&uy.test(t))}function yy(t,e){if(!sy.test(t))return!1;try{const[n]=t.split(".");if(!n)return!1;const s=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),i=JSON.parse(atob(s));return!(typeof i!="object"||i===null||"typ"in i&&(i==null?void 0:i.typ)!=="JWT"||!i.alg||e&&i.alg!==e)}catch{return!1}}function _y(t,e){return!!((e==="v4"||!e)&&ly.test(t)||(e==="v6"||!e)&&cy.test(t))}class qe extends J{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==k.string){const r=this._getOrReturnCtx(e);return x(r,{code:E.invalid_type,expected:k.string,received:r.parsedType}),$}const s=new pe;let i;for(const r of this._def.checks)if(r.kind==="min")e.data.length<r.value&&(i=this._getOrReturnCtx(e,i),x(i,{code:E.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),s.dirty());else if(r.kind==="max")e.data.length>r.value&&(i=this._getOrReturnCtx(e,i),x(i,{code:E.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),s.dirty());else if(r.kind==="length"){const a=e.data.length>r.value,u=e.data.length<r.value;(a||u)&&(i=this._getOrReturnCtx(e,i),a?x(i,{code:E.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}):u&&x(i,{code:E.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}),s.dirty())}else if(r.kind==="email")ry.test(e.data)||(i=this._getOrReturnCtx(e,i),x(i,{validation:"email",code:E.invalid_string,message:r.message}),s.dirty());else if(r.kind==="emoji")os||(os=new RegExp(oy,"u")),os.test(e.data)||(i=this._getOrReturnCtx(e,i),x(i,{validation:"emoji",code:E.invalid_string,message:r.message}),s.dirty());else if(r.kind==="uuid")ty.test(e.data)||(i=this._getOrReturnCtx(e,i),x(i,{validation:"uuid",code:E.invalid_string,message:r.message}),s.dirty());else if(r.kind==="nanoid")ny.test(e.data)||(i=this._getOrReturnCtx(e,i),x(i,{validation:"nanoid",code:E.invalid_string,message:r.message}),s.dirty());else if(r.kind==="cuid")Qg.test(e.data)||(i=this._getOrReturnCtx(e,i),x(i,{validation:"cuid",code:E.invalid_string,message:r.message}),s.dirty());else if(r.kind==="cuid2")jg.test(e.data)||(i=this._getOrReturnCtx(e,i),x(i,{validation:"cuid2",code:E.invalid_string,message:r.message}),s.dirty());else if(r.kind==="ulid")ey.test(e.data)||(i=this._getOrReturnCtx(e,i),x(i,{validation:"ulid",code:E.invalid_string,message:r.message}),s.dirty());else if(r.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),x(i,{validation:"url",code:E.invalid_string,message:r.message}),s.dirty()}else r.kind==="regex"?(r.regex.lastIndex=0,r.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),x(i,{validation:"regex",code:E.invalid_string,message:r.message}),s.dirty())):r.kind==="trim"?e.data=e.data.trim():r.kind==="includes"?e.data.includes(r.value,r.position)||(i=this._getOrReturnCtx(e,i),x(i,{code:E.invalid_string,validation:{includes:r.value,position:r.position},message:r.message}),s.dirty()):r.kind==="toLowerCase"?e.data=e.data.toLowerCase():r.kind==="toUpperCase"?e.data=e.data.toUpperCase():r.kind==="startsWith"?e.data.startsWith(r.value)||(i=this._getOrReturnCtx(e,i),x(i,{code:E.invalid_string,validation:{startsWith:r.value},message:r.message}),s.dirty()):r.kind==="endsWith"?e.data.endsWith(r.value)||(i=this._getOrReturnCtx(e,i),x(i,{code:E.invalid_string,validation:{endsWith:r.value},message:r.message}),s.dirty()):r.kind==="datetime"?my(r).test(e.data)||(i=this._getOrReturnCtx(e,i),x(i,{code:E.invalid_string,validation:"datetime",message:r.message}),s.dirty()):r.kind==="date"?py.test(e.data)||(i=this._getOrReturnCtx(e,i),x(i,{code:E.invalid_string,validation:"date",message:r.message}),s.dirty()):r.kind==="time"?hy(r).test(e.data)||(i=this._getOrReturnCtx(e,i),x(i,{code:E.invalid_string,validation:"time",message:r.message}),s.dirty()):r.kind==="duration"?iy.test(e.data)||(i=this._getOrReturnCtx(e,i),x(i,{validation:"duration",code:E.invalid_string,message:r.message}),s.dirty()):r.kind==="ip"?gy(e.data,r.version)||(i=this._getOrReturnCtx(e,i),x(i,{validation:"ip",code:E.invalid_string,message:r.message}),s.dirty()):r.kind==="jwt"?yy(e.data,r.alg)||(i=this._getOrReturnCtx(e,i),x(i,{validation:"jwt",code:E.invalid_string,message:r.message}),s.dirty()):r.kind==="cidr"?_y(e.data,r.version)||(i=this._getOrReturnCtx(e,i),x(i,{validation:"cidr",code:E.invalid_string,message:r.message}),s.dirty()):r.kind==="base64"?dy.test(e.data)||(i=this._getOrReturnCtx(e,i),x(i,{validation:"base64",code:E.invalid_string,message:r.message}),s.dirty()):r.kind==="base64url"?fy.test(e.data)||(i=this._getOrReturnCtx(e,i),x(i,{validation:"base64url",code:E.invalid_string,message:r.message}),s.dirty()):W.assertNever(r);return{status:s.value,value:e.data}}_regex(e,n,s){return this.refinement(i=>e.test(i),{validation:n,code:E.invalid_string,...b.errToObj(s)})}_addCheck(e){return new qe({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...b.errToObj(e)})}url(e){return this._addCheck({kind:"url",...b.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...b.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...b.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...b.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...b.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...b.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...b.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...b.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...b.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...b.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...b.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...b.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...b.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...b.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...b.errToObj(e)})}regex(e,n){return this._addCheck({kind:"regex",regex:e,...b.errToObj(n)})}includes(e,n){return this._addCheck({kind:"includes",value:e,position:n==null?void 0:n.position,...b.errToObj(n==null?void 0:n.message)})}startsWith(e,n){return this._addCheck({kind:"startsWith",value:e,...b.errToObj(n)})}endsWith(e,n){return this._addCheck({kind:"endsWith",value:e,...b.errToObj(n)})}min(e,n){return this._addCheck({kind:"min",value:e,...b.errToObj(n)})}max(e,n){return this._addCheck({kind:"max",value:e,...b.errToObj(n)})}length(e,n){return this._addCheck({kind:"length",value:e,...b.errToObj(n)})}nonempty(e){return this.min(1,b.errToObj(e))}trim(){return new qe({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new qe({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new qe({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxLength(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}qe.create=t=>new qe({checks:[],typeName:G.ZodString,coerce:(t==null?void 0:t.coerce)??!1,...B(t)});function Ty(t,e){const n=(t.toString().split(".")[1]||"").length,s=(e.toString().split(".")[1]||"").length,i=n>s?n:s,r=Number.parseInt(t.toFixed(i).replace(".","")),a=Number.parseInt(e.toFixed(i).replace(".",""));return r%a/10**i}class Tt extends J{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==k.number){const r=this._getOrReturnCtx(e);return x(r,{code:E.invalid_type,expected:k.number,received:r.parsedType}),$}let s;const i=new pe;for(const r of this._def.checks)r.kind==="int"?W.isInteger(e.data)||(s=this._getOrReturnCtx(e,s),x(s,{code:E.invalid_type,expected:"integer",received:"float",message:r.message}),i.dirty()):r.kind==="min"?(r.inclusive?e.data<r.value:e.data<=r.value)&&(s=this._getOrReturnCtx(e,s),x(s,{code:E.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),i.dirty()):r.kind==="max"?(r.inclusive?e.data>r.value:e.data>=r.value)&&(s=this._getOrReturnCtx(e,s),x(s,{code:E.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),i.dirty()):r.kind==="multipleOf"?Ty(e.data,r.value)!==0&&(s=this._getOrReturnCtx(e,s),x(s,{code:E.not_multiple_of,multipleOf:r.value,message:r.message}),i.dirty()):r.kind==="finite"?Number.isFinite(e.data)||(s=this._getOrReturnCtx(e,s),x(s,{code:E.not_finite,message:r.message}),i.dirty()):W.assertNever(r);return{status:i.value,value:e.data}}gte(e,n){return this.setLimit("min",e,!0,b.toString(n))}gt(e,n){return this.setLimit("min",e,!1,b.toString(n))}lte(e,n){return this.setLimit("max",e,!0,b.toString(n))}lt(e,n){return this.setLimit("max",e,!1,b.toString(n))}setLimit(e,n,s,i){return new Tt({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:s,message:b.toString(i)}]})}_addCheck(e){return new Tt({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:b.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:b.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:b.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:b.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:b.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:b.toString(n)})}finite(e){return this._addCheck({kind:"finite",message:b.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:b.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:b.toString(e)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&W.isInteger(e.value))}get isFinite(){let e=null,n=null;for(const s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(n===null||s.value>n)&&(n=s.value):s.kind==="max"&&(e===null||s.value<e)&&(e=s.value)}return Number.isFinite(n)&&Number.isFinite(e)}}Tt.create=t=>new Tt({checks:[],typeName:G.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...B(t)});class Ot extends J{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==k.bigint)return this._getInvalidInput(e);let s;const i=new pe;for(const r of this._def.checks)r.kind==="min"?(r.inclusive?e.data<r.value:e.data<=r.value)&&(s=this._getOrReturnCtx(e,s),x(s,{code:E.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),i.dirty()):r.kind==="max"?(r.inclusive?e.data>r.value:e.data>=r.value)&&(s=this._getOrReturnCtx(e,s),x(s,{code:E.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),i.dirty()):r.kind==="multipleOf"?e.data%r.value!==BigInt(0)&&(s=this._getOrReturnCtx(e,s),x(s,{code:E.not_multiple_of,multipleOf:r.value,message:r.message}),i.dirty()):W.assertNever(r);return{status:i.value,value:e.data}}_getInvalidInput(e){const n=this._getOrReturnCtx(e);return x(n,{code:E.invalid_type,expected:k.bigint,received:n.parsedType}),$}gte(e,n){return this.setLimit("min",e,!0,b.toString(n))}gt(e,n){return this.setLimit("min",e,!1,b.toString(n))}lte(e,n){return this.setLimit("max",e,!0,b.toString(n))}lt(e,n){return this.setLimit("max",e,!1,b.toString(n))}setLimit(e,n,s,i){return new Ot({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:s,message:b.toString(i)}]})}_addCheck(e){return new Ot({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:b.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:b.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:b.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:b.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:b.toString(n)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}Ot.create=t=>new Ot({checks:[],typeName:G.ZodBigInt,coerce:(t==null?void 0:t.coerce)??!1,...B(t)});class ks extends J{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==k.boolean){const s=this._getOrReturnCtx(e);return x(s,{code:E.invalid_type,expected:k.boolean,received:s.parsedType}),$}return _e(e.data)}}ks.create=t=>new ks({typeName:G.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...B(t)});class An extends J{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==k.date){const r=this._getOrReturnCtx(e);return x(r,{code:E.invalid_type,expected:k.date,received:r.parsedType}),$}if(Number.isNaN(e.data.getTime())){const r=this._getOrReturnCtx(e);return x(r,{code:E.invalid_date}),$}const s=new pe;let i;for(const r of this._def.checks)r.kind==="min"?e.data.getTime()<r.value&&(i=this._getOrReturnCtx(e,i),x(i,{code:E.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),s.dirty()):r.kind==="max"?e.data.getTime()>r.value&&(i=this._getOrReturnCtx(e,i),x(i,{code:E.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),s.dirty()):W.assertNever(r);return{status:s.value,value:new Date(e.data.getTime())}}_addCheck(e){return new An({...this._def,checks:[...this._def.checks,e]})}min(e,n){return this._addCheck({kind:"min",value:e.getTime(),message:b.toString(n)})}max(e,n){return this._addCheck({kind:"max",value:e.getTime(),message:b.toString(n)})}get minDate(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e!=null?new Date(e):null}}An.create=t=>new An({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:G.ZodDate,...B(t)});class ko extends J{_parse(e){if(this._getType(e)!==k.symbol){const s=this._getOrReturnCtx(e);return x(s,{code:E.invalid_type,expected:k.symbol,received:s.parsedType}),$}return _e(e.data)}}ko.create=t=>new ko({typeName:G.ZodSymbol,...B(t)});class bo extends J{_parse(e){if(this._getType(e)!==k.undefined){const s=this._getOrReturnCtx(e);return x(s,{code:E.invalid_type,expected:k.undefined,received:s.parsedType}),$}return _e(e.data)}}bo.create=t=>new bo({typeName:G.ZodUndefined,...B(t)});class Do extends J{_parse(e){if(this._getType(e)!==k.null){const s=this._getOrReturnCtx(e);return x(s,{code:E.invalid_type,expected:k.null,received:s.parsedType}),$}return _e(e.data)}}Do.create=t=>new Do({typeName:G.ZodNull,...B(t)});class Uo extends J{constructor(){super(...arguments),this._any=!0}_parse(e){return _e(e.data)}}Uo.create=t=>new Uo({typeName:G.ZodAny,...B(t)});class Lo extends J{constructor(){super(...arguments),this._unknown=!0}_parse(e){return _e(e.data)}}Lo.create=t=>new Lo({typeName:G.ZodUnknown,...B(t)});class Ye extends J{_parse(e){const n=this._getOrReturnCtx(e);return x(n,{code:E.invalid_type,expected:k.never,received:n.parsedType}),$}}Ye.create=t=>new Ye({typeName:G.ZodNever,...B(t)});class Fo extends J{_parse(e){if(this._getType(e)!==k.undefined){const s=this._getOrReturnCtx(e);return x(s,{code:E.invalid_type,expected:k.void,received:s.parsedType}),$}return _e(e.data)}}Fo.create=t=>new Fo({typeName:G.ZodVoid,...B(t)});class Pe extends J{_parse(e){const{ctx:n,status:s}=this._processInputParams(e),i=this._def;if(n.parsedType!==k.array)return x(n,{code:E.invalid_type,expected:k.array,received:n.parsedType}),$;if(i.exactLength!==null){const a=n.data.length>i.exactLength.value,u=n.data.length<i.exactLength.value;(a||u)&&(x(n,{code:a?E.too_big:E.too_small,minimum:u?i.exactLength.value:void 0,maximum:a?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),s.dirty())}if(i.minLength!==null&&n.data.length<i.minLength.value&&(x(n,{code:E.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),s.dirty()),i.maxLength!==null&&n.data.length>i.maxLength.value&&(x(n,{code:E.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),s.dirty()),n.common.async)return Promise.all([...n.data].map((a,u)=>i.type._parseAsync(new We(n,a,n.path,u)))).then(a=>pe.mergeArray(s,a));const r=[...n.data].map((a,u)=>i.type._parseSync(new We(n,a,n.path,u)));return pe.mergeArray(s,r)}get element(){return this._def.type}min(e,n){return new Pe({...this._def,minLength:{value:e,message:b.toString(n)}})}max(e,n){return new Pe({...this._def,maxLength:{value:e,message:b.toString(n)}})}length(e,n){return new Pe({...this._def,exactLength:{value:e,message:b.toString(n)}})}nonempty(e){return this.min(1,e)}}Pe.create=(t,e)=>new Pe({type:t,minLength:null,maxLength:null,exactLength:null,typeName:G.ZodArray,...B(e)});function ut(t){if(t instanceof j){const e={};for(const n in t.shape){const s=t.shape[n];e[n]=Oe.create(ut(s))}return new j({...t._def,shape:()=>e})}else return t instanceof Pe?new Pe({...t._def,type:ut(t.element)}):t instanceof Oe?Oe.create(ut(t.unwrap())):t instanceof Ct?Ct.create(ut(t.unwrap())):t instanceof tt?tt.create(t.items.map(e=>ut(e))):t}class j extends J{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),n=W.objectKeys(e);return this._cached={shape:e,keys:n},this._cached}_parse(e){if(this._getType(e)!==k.object){const c=this._getOrReturnCtx(e);return x(c,{code:E.invalid_type,expected:k.object,received:c.parsedType}),$}const{status:s,ctx:i}=this._processInputParams(e),{shape:r,keys:a}=this._getCached(),u=[];if(!(this._def.catchall instanceof Ye&&this._def.unknownKeys==="strip"))for(const c in i.data)a.includes(c)||u.push(c);const d=[];for(const c of a){const f=r[c],p=i.data[c];d.push({key:{status:"valid",value:c},value:f._parse(new We(i,p,i.path,c)),alwaysSet:c in i.data})}if(this._def.catchall instanceof Ye){const c=this._def.unknownKeys;if(c==="passthrough")for(const f of u)d.push({key:{status:"valid",value:f},value:{status:"valid",value:i.data[f]}});else if(c==="strict")u.length>0&&(x(i,{code:E.unrecognized_keys,keys:u}),s.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const f of u){const p=i.data[f];d.push({key:{status:"valid",value:f},value:c._parse(new We(i,p,i.path,f)),alwaysSet:f in i.data})}}return i.common.async?Promise.resolve().then(async()=>{const c=[];for(const f of d){const p=await f.key,h=await f.value;c.push({key:p,value:h,alwaysSet:f.alwaysSet})}return c}).then(c=>pe.mergeObjectSync(s,c)):pe.mergeObjectSync(s,d)}get shape(){return this._def.shape()}strict(e){return b.errToObj,new j({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(n,s)=>{var r,a;const i=((a=(r=this._def).errorMap)==null?void 0:a.call(r,n,s).message)??s.defaultError;return n.code==="unrecognized_keys"?{message:b.errToObj(e).message??i}:{message:i}}}:{}})}strip(){return new j({...this._def,unknownKeys:"strip"})}passthrough(){return new j({...this._def,unknownKeys:"passthrough"})}extend(e){return new j({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new j({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:G.ZodObject})}setKey(e,n){return this.augment({[e]:n})}catchall(e){return new j({...this._def,catchall:e})}pick(e){const n={};for(const s of W.objectKeys(e))e[s]&&this.shape[s]&&(n[s]=this.shape[s]);return new j({...this._def,shape:()=>n})}omit(e){const n={};for(const s of W.objectKeys(this.shape))e[s]||(n[s]=this.shape[s]);return new j({...this._def,shape:()=>n})}deepPartial(){return ut(this)}partial(e){const n={};for(const s of W.objectKeys(this.shape)){const i=this.shape[s];e&&!e[s]?n[s]=i:n[s]=i.optional()}return new j({...this._def,shape:()=>n})}required(e){const n={};for(const s of W.objectKeys(this.shape))if(e&&!e[s])n[s]=this.shape[s];else{let r=this.shape[s];for(;r instanceof Oe;)r=r._def.innerType;n[s]=r}return new j({...this._def,shape:()=>n})}keyof(){return Kl(W.objectKeys(this.shape))}}j.create=(t,e)=>new j({shape:()=>t,unknownKeys:"strip",catchall:Ye.create(),typeName:G.ZodObject,...B(e)});j.strictCreate=(t,e)=>new j({shape:()=>t,unknownKeys:"strict",catchall:Ye.create(),typeName:G.ZodObject,...B(e)});j.lazycreate=(t,e)=>new j({shape:t,unknownKeys:"strip",catchall:Ye.create(),typeName:G.ZodObject,...B(e)});class Rn extends J{_parse(e){const{ctx:n}=this._processInputParams(e),s=this._def.options;function i(r){for(const u of r)if(u.result.status==="valid")return u.result;for(const u of r)if(u.result.status==="dirty")return n.common.issues.push(...u.ctx.common.issues),u.result;const a=r.map(u=>new be(u.ctx.common.issues));return x(n,{code:E.invalid_union,unionErrors:a}),$}if(n.common.async)return Promise.all(s.map(async r=>{const a={...n,common:{...n.common,issues:[]},parent:null};return{result:await r._parseAsync({data:n.data,path:n.path,parent:a}),ctx:a}})).then(i);{let r;const a=[];for(const d of s){const c={...n,common:{...n.common,issues:[]},parent:null},f=d._parseSync({data:n.data,path:n.path,parent:c});if(f.status==="valid")return f;f.status==="dirty"&&!r&&(r={result:f,ctx:c}),c.common.issues.length&&a.push(c.common.issues)}if(r)return n.common.issues.push(...r.ctx.common.issues),r.result;const u=a.map(d=>new be(d));return x(n,{code:E.invalid_union,unionErrors:u}),$}}get options(){return this._def.options}}Rn.create=(t,e)=>new Rn({options:t,typeName:G.ZodUnion,...B(e)});function bs(t,e){const n=Ve(t),s=Ve(e);if(t===e)return{valid:!0,data:t};if(n===k.object&&s===k.object){const i=W.objectKeys(e),r=W.objectKeys(t).filter(u=>i.indexOf(u)!==-1),a={...t,...e};for(const u of r){const d=bs(t[u],e[u]);if(!d.valid)return{valid:!1};a[u]=d.data}return{valid:!0,data:a}}else if(n===k.array&&s===k.array){if(t.length!==e.length)return{valid:!1};const i=[];for(let r=0;r<t.length;r++){const a=t[r],u=e[r],d=bs(a,u);if(!d.valid)return{valid:!1};i.push(d.data)}return{valid:!0,data:i}}else return n===k.date&&s===k.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}class Pn extends J{_parse(e){const{status:n,ctx:s}=this._processInputParams(e),i=(r,a)=>{if(xo(r)||xo(a))return $;const u=bs(r.value,a.value);return u.valid?((No(r)||No(a))&&n.dirty(),{status:n.value,value:u.data}):(x(s,{code:E.invalid_intersection_types}),$)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([r,a])=>i(r,a)):i(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}}Pn.create=(t,e,n)=>new Pn({left:t,right:e,typeName:G.ZodIntersection,...B(n)});class tt extends J{_parse(e){const{status:n,ctx:s}=this._processInputParams(e);if(s.parsedType!==k.array)return x(s,{code:E.invalid_type,expected:k.array,received:s.parsedType}),$;if(s.data.length<this._def.items.length)return x(s,{code:E.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),$;!this._def.rest&&s.data.length>this._def.items.length&&(x(s,{code:E.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const r=[...s.data].map((a,u)=>{const d=this._def.items[u]||this._def.rest;return d?d._parse(new We(s,a,s.path,u)):null}).filter(a=>!!a);return s.common.async?Promise.all(r).then(a=>pe.mergeArray(n,a)):pe.mergeArray(n,r)}get items(){return this._def.items}rest(e){return new tt({...this._def,rest:e})}}tt.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new tt({items:t,typeName:G.ZodTuple,rest:null,...B(e)})};class $o extends J{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:s}=this._processInputParams(e);if(s.parsedType!==k.map)return x(s,{code:E.invalid_type,expected:k.map,received:s.parsedType}),$;const i=this._def.keyType,r=this._def.valueType,a=[...s.data.entries()].map(([u,d],c)=>({key:i._parse(new We(s,u,s.path,[c,"key"])),value:r._parse(new We(s,d,s.path,[c,"value"]))}));if(s.common.async){const u=new Map;return Promise.resolve().then(async()=>{for(const d of a){const c=await d.key,f=await d.value;if(c.status==="aborted"||f.status==="aborted")return $;(c.status==="dirty"||f.status==="dirty")&&n.dirty(),u.set(c.value,f.value)}return{status:n.value,value:u}})}else{const u=new Map;for(const d of a){const c=d.key,f=d.value;if(c.status==="aborted"||f.status==="aborted")return $;(c.status==="dirty"||f.status==="dirty")&&n.dirty(),u.set(c.value,f.value)}return{status:n.value,value:u}}}}$o.create=(t,e,n)=>new $o({valueType:e,keyType:t,typeName:G.ZodMap,...B(n)});class Ht extends J{_parse(e){const{status:n,ctx:s}=this._processInputParams(e);if(s.parsedType!==k.set)return x(s,{code:E.invalid_type,expected:k.set,received:s.parsedType}),$;const i=this._def;i.minSize!==null&&s.data.size<i.minSize.value&&(x(s,{code:E.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),n.dirty()),i.maxSize!==null&&s.data.size>i.maxSize.value&&(x(s,{code:E.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),n.dirty());const r=this._def.valueType;function a(d){const c=new Set;for(const f of d){if(f.status==="aborted")return $;f.status==="dirty"&&n.dirty(),c.add(f.value)}return{status:n.value,value:c}}const u=[...s.data.values()].map((d,c)=>r._parse(new We(s,d,s.path,c)));return s.common.async?Promise.all(u).then(d=>a(d)):a(u)}min(e,n){return new Ht({...this._def,minSize:{value:e,message:b.toString(n)}})}max(e,n){return new Ht({...this._def,maxSize:{value:e,message:b.toString(n)}})}size(e,n){return this.min(e,n).max(e,n)}nonempty(e){return this.min(1,e)}}Ht.create=(t,e)=>new Ht({valueType:t,minSize:null,maxSize:null,typeName:G.ZodSet,...B(e)});class Go extends J{get schema(){return this._def.getter()}_parse(e){const{ctx:n}=this._processInputParams(e);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}Go.create=(t,e)=>new Go({getter:t,typeName:G.ZodLazy,...B(e)});class Vo extends J{_parse(e){if(e.data!==this._def.value){const n=this._getOrReturnCtx(e);return x(n,{received:n.data,code:E.invalid_literal,expected:this._def.value}),$}return{status:"valid",value:e.data}}get value(){return this._def.value}}Vo.create=(t,e)=>new Vo({value:t,typeName:G.ZodLiteral,...B(e)});function Kl(t,e){return new vt({values:t,typeName:G.ZodEnum,...B(e)})}class vt extends J{_parse(e){if(typeof e.data!="string"){const n=this._getOrReturnCtx(e),s=this._def.values;return x(n,{expected:W.joinValues(s),received:n.parsedType,code:E.invalid_type}),$}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const n=this._getOrReturnCtx(e),s=this._def.values;return x(n,{received:n.data,code:E.invalid_enum_value,options:s}),$}return _e(e.data)}get options(){return this._def.values}get enum(){const e={};for(const n of this._def.values)e[n]=n;return e}get Values(){const e={};for(const n of this._def.values)e[n]=n;return e}get Enum(){const e={};for(const n of this._def.values)e[n]=n;return e}extract(e,n=this._def){return vt.create(e,{...this._def,...n})}exclude(e,n=this._def){return vt.create(this.options.filter(s=>!e.includes(s)),{...this._def,...n})}}vt.create=Kl;class qo extends J{_parse(e){const n=W.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==k.string&&s.parsedType!==k.number){const i=W.objectValues(n);return x(s,{expected:W.joinValues(i),received:s.parsedType,code:E.invalid_type}),$}if(this._cache||(this._cache=new Set(W.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const i=W.objectValues(n);return x(s,{received:s.data,code:E.invalid_enum_value,options:i}),$}return _e(e.data)}get enum(){return this._def.values}}qo.create=(t,e)=>new qo({values:t,typeName:G.ZodNativeEnum,...B(e)});class xn extends J{unwrap(){return this._def.type}_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==k.promise&&n.common.async===!1)return x(n,{code:E.invalid_type,expected:k.promise,received:n.parsedType}),$;const s=n.parsedType===k.promise?n.data:Promise.resolve(n.data);return _e(s.then(i=>this._def.type.parseAsync(i,{path:n.path,errorMap:n.common.contextualErrorMap})))}}xn.create=(t,e)=>new xn({type:t,typeName:G.ZodPromise,...B(e)});class St extends J{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===G.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:n,ctx:s}=this._processInputParams(e),i=this._def.effect||null,r={addIssue:a=>{x(s,a),a.fatal?n.abort():n.dirty()},get path(){return s.path}};if(r.addIssue=r.addIssue.bind(r),i.type==="preprocess"){const a=i.transform(s.data,r);if(s.common.async)return Promise.resolve(a).then(async u=>{if(n.value==="aborted")return $;const d=await this._def.schema._parseAsync({data:u,path:s.path,parent:s});return d.status==="aborted"?$:d.status==="dirty"||n.value==="dirty"?Lt(d.value):d});{if(n.value==="aborted")return $;const u=this._def.schema._parseSync({data:a,path:s.path,parent:s});return u.status==="aborted"?$:u.status==="dirty"||n.value==="dirty"?Lt(u.value):u}}if(i.type==="refinement"){const a=u=>{const d=i.refinement(u,r);if(s.common.async)return Promise.resolve(d);if(d instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return u};if(s.common.async===!1){const u=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return u.status==="aborted"?$:(u.status==="dirty"&&n.dirty(),a(u.value),{status:n.value,value:u.value})}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(u=>u.status==="aborted"?$:(u.status==="dirty"&&n.dirty(),a(u.value).then(()=>({status:n.value,value:u.value}))))}if(i.type==="transform")if(s.common.async===!1){const a=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!_t(a))return $;const u=i.transform(a.value,r);if(u instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:u}}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(a=>_t(a)?Promise.resolve(i.transform(a.value,r)).then(u=>({status:n.value,value:u})):$);W.assertNever(i)}}St.create=(t,e,n)=>new St({schema:t,typeName:G.ZodEffects,effect:e,...B(n)});St.createWithPreprocess=(t,e,n)=>new St({schema:e,effect:{type:"preprocess",transform:t},typeName:G.ZodEffects,...B(n)});class Oe extends J{_parse(e){return this._getType(e)===k.undefined?_e(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Oe.create=(t,e)=>new Oe({innerType:t,typeName:G.ZodOptional,...B(e)});class Ct extends J{_parse(e){return this._getType(e)===k.null?_e(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ct.create=(t,e)=>new Ct({innerType:t,typeName:G.ZodNullable,...B(e)});class Ds extends J{_parse(e){const{ctx:n}=this._processInputParams(e);let s=n.data;return n.parsedType===k.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:n.path,parent:n})}removeDefault(){return this._def.innerType}}Ds.create=(t,e)=>new Ds({innerType:t,typeName:G.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...B(e)});class Us extends J{_parse(e){const{ctx:n}=this._processInputParams(e),s={...n,common:{...n.common,issues:[]}},i=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return In(i)?i.then(r=>({status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new be(s.common.issues)},input:s.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new be(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}}Us.create=(t,e)=>new Us({innerType:t,typeName:G.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...B(e)});class Bo extends J{_parse(e){if(this._getType(e)!==k.nan){const s=this._getOrReturnCtx(e);return x(s,{code:E.invalid_type,expected:k.nan,received:s.parsedType}),$}return{status:"valid",value:e.data}}}Bo.create=t=>new Bo({typeName:G.ZodNaN,...B(t)});class vy extends J{_parse(e){const{ctx:n}=this._processInputParams(e),s=n.data;return this._def.type._parse({data:s,path:n.path,parent:n})}unwrap(){return this._def.type}}class Ni extends J{_parse(e){const{status:n,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{const r=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return r.status==="aborted"?$:r.status==="dirty"?(n.dirty(),Lt(r.value)):this._def.out._parseAsync({data:r.value,path:s.path,parent:s})})();{const i=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return i.status==="aborted"?$:i.status==="dirty"?(n.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:s.path,parent:s})}}static create(e,n){return new Ni({in:e,out:n,typeName:G.ZodPipeline})}}class Ls extends J{_parse(e){const n=this._def.innerType._parse(e),s=i=>(_t(i)&&(i.value=Object.freeze(i.value)),i);return In(n)?n.then(i=>s(i)):s(n)}unwrap(){return this._def.innerType}}Ls.create=(t,e)=>new Ls({innerType:t,typeName:G.ZodReadonly,...B(e)});var G;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(G||(G={}));const Ae=qe.create,Vt=Tt.create,Fs=ks.create;Ye.create;const $s=Pe.create,Mi=j.create,Oo=Rn.create;Pn.create;tt.create;const Nn=vt.create;xn.create;Oe.create;Ct.create;const Sy=["aggregate","profile","clean","detect_anomaly","remove_card","save_view","ask_clarify"],Cy=["csv.aggregate","csv.profile","csv.clean_invoice_month","csv.detect_outliers","ui.remove_card","idb.save_view"],Ey={aggregate:["csv.aggregate"],profile:["csv.profile"],clean:["csv.clean_invoice_month"],detect_anomaly:["csv.detect_outliers"],remove_card:["ui.remove_card"],save_view:["idb.save_view"],ask_clarify:[]},wy=Nn(["=","!=",">",">=","<","<=","in","contains"]),Iy=Mi({column:Ae().min(1,"Filter column is required."),op:wy.default("="),value:Oo([Ae(),Vt(),Fs(),$s(Oo([Ae(),Vt(),Fs()])).nonempty()])}).strict(),Ay=Mi({datasetId:Ae().min(1).optional().nullable(),column:Ae().min(1).optional(),valueColumn:Ae().min(1).optional(),groupBy:$s(Ae().min(1)).default([]),aggregation:Nn(["sum","avg","count","min","max"]).default("sum"),filters:$s(Iy).default([]),limit:Vt().int().positive().optional(),topN:Vt().int().positive().optional(),thresholdMultiplier:Vt().positive().optional(),viewTitle:Ae().min(1).optional(),cardId:Ae().min(1).optional()}).strict(),Ry=Mi({intent:Nn(Sy),tool:Nn(Cy).nullable().default(null),args:Ay.default({}),awaitUser:Fs().default(!1),message:Ae().max(280).optional().nullable()}).superRefine((t,e)=>{const n=Ey[t.intent]??[];n.length===0?t.tool!==null&&e.addIssue({code:E.custom,message:`Intent "${t.intent}" should not specify a tool.`,path:["tool"]}):(!t.tool||!n.includes(t.tool))&&e.addIssue({code:E.custom,message:`Tool "${t.tool}" is not allowed for intent "${t.intent}".`,path:["tool"]}),t.intent==="ask_clarify"&&!t.awaitUser&&e.addIssue({code:E.custom,message:"ask_clarify intent must set awaitUser=true.",path:["awaitUser"]})}),Kn=t=>{const e={...t};if(Array.isArray(e.enum))return e.enum.includes(null)||(e.enum=[...e.enum,null]),e;const n=e.type;return Array.isArray(n)?n.includes("null")||(e.type=[...n,"null"]):n?e.type=[n,"null"]:e.type=["null"],e},Qt=(t,e)=>{const n={...t};return e.forEach(s=>{if(!n[s])throw new Error(`Attempted to mark missing property "${s}" as nullable.`);n[s]=Kn(n[s])}),n},zl={type:y.OBJECT,properties:{chartType:{type:y.STRING,enum:["bar","line","pie","doughnut","scatter","combo"],description:"Type of chart to generate."},title:{type:y.STRING,description:"A concise title for the analysis."},description:{type:y.STRING,minLength:8,description:"A brief explanation of what the analysis shows. Must be a full sentence with at least 8 characters."},aggregation:{type:y.STRING,enum:["sum","count","avg"],description:"The aggregation function to apply. Omit for scatter plots."},groupByColumn:{type:y.STRING,description:"The column to group data by (categorical). Omit for scatter plots."},valueColumn:{type:y.STRING,description:'The column for aggregation (numerical). Not needed for "count".'},xValueColumn:{type:y.STRING,description:"The column for the X-axis of a scatter plot (numerical). Required for scatter plots."},yValueColumn:{type:y.STRING,description:"The column for the Y-axis of a scatter plot (numerical). Required for scatter plots."},secondaryValueColumn:{type:y.STRING,description:"For combo charts, the secondary column for aggregation (numerical)."},secondaryAggregation:{type:y.STRING,enum:["sum","count","avg"],description:"For combo charts, the aggregation for the secondary value column."},defaultTopN:{type:y.INTEGER,description:"Optional. If the analysis has many categories, this suggests a default Top N view (e.g., 8)."},defaultHideOthers:{type:y.BOOLEAN,description:'Optional. If using defaultTopN, suggests whether to hide the "Others" category by default.'},orderBy:{type:y.ARRAY,description:"Optional ordering instructions applied before limiting rows.",items:{type:y.OBJECT,properties:{column:{type:y.STRING,description:"Column to sort by (group or metric alias)."},direction:{type:y.STRING,enum:["asc","desc"],description:"Sort direction (default desc)."}},required:["column","direction"],additionalProperties:!1}},limit:{type:y.INTEGER,description:"Optional limit applied after sorting (e.g., Top N rows)."},rowFilter:{type:y.OBJECT,description:"Optional row-level filter to limit rows before aggregation (e.g., single customer or region).",properties:{column:{type:y.STRING,description:"Column to filter on. Must be categorical."},values:{type:y.ARRAY,minItems:1,description:"Exact values to keep (case-sensitive, as they appear in the dataset).",items:{type:y.STRING}}},required:["column","values"],additionalProperties:!1}},required:["chartType","title","description","aggregation","groupByColumn","valueColumn","xValueColumn","yValueColumn","secondaryValueColumn","secondaryAggregation","defaultTopN","defaultHideOthers","orderBy","limit","rowFilter"],additionalProperties:!1},Py={type:y.OBJECT,properties:{plans:{type:y.ARRAY,description:"Array of analysis plans to execute.",items:zl}},required:["plans"],additionalProperties:!1},xy={type:y.OBJECT,properties:{name:{type:y.STRING,description:"The column name."},type:{type:y.STRING,enum:["numerical","categorical","date","time","currency","percentage"],description:"The data type of the column. Identify specific types like 'date', 'currency', etc., where possible."}},required:["name","type"],additionalProperties:!1},Ny={type:y.OBJECT,properties:{explanation:{type:y.STRING,description:"A brief, user-facing explanation of the transformations that will be applied to the data (e.g., 'Removed 3 summary rows and reshaped the data from a cross-tab format')."},jsFunctionBody:Kn({type:y.STRING,description:"The body of a JavaScript function that takes two arguments `data` (an array of objects) and `_util` (a helper object) and returns the transformed array of objects. This code will be executed to clean and reshape the data."}),outputColumns:{type:y.ARRAY,description:"A list of column profiles describing the structure of the data AFTER the transformation. If no transformation is performed, this should be the same as the input column profiles.",items:xy}},required:["explanation","jsFunctionBody","outputColumns"],additionalProperties:!1},My={type:y.OBJECT,properties:{explanation:{type:y.STRING,description:"A brief, user-facing explanation of the filter that was created from the natural language query."},jsFunctionBody:{type:y.STRING,description:"The body of a JavaScript function that takes 'data' and '_util' as arguments and returns a filtered array of objects. It should be a single line starting with 'return data.filter(...);'."}},required:["explanation","jsFunctionBody"],additionalProperties:!1},ky={type:y.OBJECT,properties:{insight:{type:y.STRING,description:"A concise, user-facing message describing the single most important finding."},cardId:{type:y.STRING,description:"The ID of the card where this insight was observed."}},required:["insight","cardId"],additionalProperties:!1},by=zl,Zl={chartType:{type:y.STRING,enum:["bar","line","pie","doughnut","scatter","combo"]},title:{type:y.STRING},description:{type:y.STRING},aggregation:{type:y.STRING,enum:["sum","count","avg"]},groupByColumn:{type:y.STRING},valueColumn:{type:y.STRING},xValueColumn:{type:y.STRING},yValueColumn:{type:y.STRING},secondaryValueColumn:{type:y.STRING},secondaryAggregation:{type:y.STRING,enum:["sum","count","avg"]},defaultTopN:{type:y.INTEGER},defaultHideOthers:{type:y.BOOLEAN},orderBy:{type:y.ARRAY,items:{type:y.OBJECT,properties:{column:{type:y.STRING},direction:{type:y.STRING,enum:["asc","desc"]}},required:["column","direction"],additionalProperties:!1}},limit:{type:y.INTEGER},rowFilter:{type:y.OBJECT,properties:{column:{type:y.STRING},values:{type:y.ARRAY,items:{type:y.STRING}}},additionalProperties:!1,required:["column","values"]}},Ho=Object.keys(Zl),Dy={type:y.OBJECT,properties:{question:{type:y.STRING,description:"The clear, user-facing question to ask for clarification."},options:{type:y.ARRAY,items:{type:y.OBJECT,properties:{label:{type:y.STRING,description:"The user-friendly text for the option button."},value:{type:y.STRING,description:"The exact column name (case-sensitive) or literal value that should be assigned to the plan when this option is selected. Do not invent new names."}},required:["label","value"],additionalProperties:!1}},pendingPlan:{type:y.OBJECT,description:"The partial analysis plan that is waiting for the user's input. It should contain all known parameters.",properties:Qt(Zl,Ho),required:Ho,additionalProperties:!1},targetProperty:{type:y.STRING,description:"The name of the property in the 'pendingPlan' that the user's selected value should be assigned to."},reasonHint:Kn({type:y.STRING,description:"Optional short explanation describing why the clarification is required."})},required:["question","options","pendingPlan","targetProperty"],additionalProperties:!1},Uy={type:y.OBJECT,description:"Declarative representation of a pending plan step.",properties:{id:{type:y.STRING,minLength:3,description:"Stable identifier (kebab-case recommended) used to reference this step in future actions."},label:{type:y.STRING,minLength:4,description:"Human-readable summary of the step."}},required:["id","label"],additionalProperties:!1},Ly={goal:{type:y.STRING,minLength:6},contextSummary:{type:y.STRING},progress:{type:y.STRING,minLength:6},nextSteps:{type:y.ARRAY,minItems:1,items:Uy},planId:{type:y.STRING},blockedBy:{type:y.STRING},observationIds:{type:y.ARRAY,items:{type:y.STRING}},confidence:{type:y.NUMBER,minimum:0,maximum:1},updatedAt:{type:y.STRING},currentStepId:{type:y.STRING},steps:{type:y.ARRAY,minItems:1,items:{type:y.OBJECT,properties:{id:{type:y.STRING},label:{type:y.STRING},intent:{type:y.STRING},status:{type:y.STRING,enum:["ready","in_progress","done","waiting_user"]}},required:["id","label","intent","status"],additionalProperties:!1}},stateTag:{type:y.STRING}},Fy={type:y.OBJECT,properties:Qt(Ly,["contextSummary","planId","blockedBy","confidence"]),required:["goal","contextSummary","progress","nextSteps","planId","blockedBy","observationIds","confidence","updatedAt","currentStepId","steps","stateTag"],additionalProperties:!1},$y={type:y.OBJECT,properties:{awaitUser:{type:y.BOOLEAN},haltAfter:{type:y.BOOLEAN},resumePlanner:{type:y.BOOLEAN},promptId:{type:y.STRING}},required:["awaitUser","haltAfter","resumePlanner","promptId"],additionalProperties:!1},Gy={type:y.OBJECT,properties:{id:{type:y.STRING},label:{type:y.STRING}},required:["id","label"],additionalProperties:!1},Vy={type:y.OBJECT,properties:{promptId:{type:y.STRING},question:{type:y.STRING},options:{type:y.ARRAY,minItems:1,items:Gy},allowFreeText:{type:y.BOOLEAN},placeholder:{type:y.STRING}},required:["promptId","question","options","allowFreeText","placeholder"],additionalProperties:!1},as={byId:{type:y.STRING},byTitle:{type:y.STRING},selector:{type:y.STRING}},qy={type:y.OBJECT,properties:Qt(as,Object.keys(as)),required:Object.keys(as),additionalProperties:!1},ls={cardId:{type:y.STRING},cardTitle:{type:y.STRING},newType:{type:y.STRING,enum:["bar","line","pie","doughnut","scatter","combo"]},visible:{type:y.BOOLEAN},column:{type:y.STRING},values:{type:y.ARRAY,items:{type:y.STRING}},topN:{type:y.INTEGER},hide:{type:y.BOOLEAN},label:{type:y.STRING},format:{type:y.STRING,enum:["png","csv","html"]}},By={type:y.OBJECT,properties:Qt(ls,Object.keys(ls)),required:Object.keys(ls),additionalProperties:!1},Oy={type:y.OBJECT,properties:{toolName:{type:y.STRING,enum:["highlightCard","changeCardChartType","showCardData","filterCard","setTopN","toggleHideOthers","toggleLegendLabel","exportCard","removeCard"]},target:qy,args:By},required:["toolName","target","args"],additionalProperties:!1},Hy={type:y.OBJECT,properties:{explanation:{type:y.STRING},jsFunctionBody:{type:y.STRING,minLength:10}},required:["explanation","jsFunctionBody"],additionalProperties:!1},Jy={type:y.OBJECT,properties:{query:{type:y.STRING}},required:["query"],additionalProperties:!1},Wy=["plan_state_update","text_response","await_user","plan_creation","dom_action","execute_js_code","proceed_to_analysis","filter_spreadsheet","clarification_request"],Yy=["intentContract","meta","planState","text","cardId","awaitUserPayload","plan","domAction","code","args","clarification"],Xl=(t=Wy)=>({type:y.OBJECT,properties:Qt({type:{type:y.STRING,enum:t},responseType:{type:y.STRING,enum:t},reason:{type:y.STRING,maxLength:280},stepId:{type:y.STRING},intentContract:Ry,meta:$y,planState:Fy,text:{type:y.STRING},cardId:{type:y.STRING},awaitUserPayload:Vy,plan:by,domAction:Oy,code:Hy,args:Jy,clarification:Dy},Yy),required:["type","responseType","reason","stepId","intentContract","meta","planState","text","cardId","awaitUserPayload","plan","domAction","code","args","clarification"],additionalProperties:!1}),Ky=Xl(),zy={type:y.ARRAY,minItems:1,maxItems:1,items:Xl(["plan_state_update"])};y.OBJECT,y.STRING,Kn({type:y.OBJECT,description:"Tool arguments payload (free-form keys allowed).",patternProperties:{"^.*$":{type:["string","number","integer","boolean","array","object","null"]}},additionalProperties:!1}),y.BOOLEAN;const Zy={type:y.OBJECT,properties:{actions:{type:y.ARRAY,description:"A sequence of actions for the assistant to perform.",minItems:1,items:Ky}},required:["actions"],additionalProperties:!1},Xy={type:y.OBJECT,properties:{actions:zy},required:["actions"],additionalProperties:!1},Jo=new Map([[y.STRING,"string"],[y.INTEGER,"integer"],[y.NUMBER,"number"],[y.BOOLEAN,"boolean"],[y.ARRAY,"array"],[y.OBJECT,"object"]]),Qy=new Set,Wo=new Set(["properties.actions.items.properties.text","properties.actions.items.properties.cardId","properties.actions.items.properties.domAction.properties.args","properties.actions.items.properties.domAction.properties.args.properties.newType","properties.actions.items.properties.domAction.properties.args.properties.visible","properties.actions.items.properties.domAction.properties.args.properties.cardTitle","properties.actions.items.properties.domAction.properties.args.properties.column","properties.actions.items.properties.domAction.properties.args.properties.values","properties.actions.items.properties.domAction.properties.args.properties.topN","properties.actions.items.properties.domAction.properties.args.properties.hide","properties.actions.items.properties.domAction.properties.args.properties.label","properties.actions.items.properties.domAction.properties.args.properties.format","properties.actions.items.properties.domAction.properties.target.properties.byId","properties.actions.items.properties.domAction.properties.target.properties.byTitle","properties.actions.items.properties.domAction.properties.target.properties.selector","properties.actions.items.properties.planState.properties.contextSummary","properties.actions.items.properties.planState.properties.blockedBy","properties.actions.items.properties.planState.properties.confidence","properties.actions.items.properties.intentContract.properties.tool","properties.actions.items.properties.intentContract.properties.args.properties.datasetId","properties.actions.items.properties.intentContract.properties.args.properties.column","properties.actions.items.properties.intentContract.properties.args.properties.valueColumn","properties.actions.items.properties.intentContract.properties.args.properties.limit","properties.actions.items.properties.intentContract.properties.args.properties.topN","properties.actions.items.properties.intentContract.properties.args.properties.thresholdMultiplier","properties.actions.items.properties.intentContract.properties.args.properties.viewTitle","properties.actions.items.properties.intentContract.properties.args.properties.cardId","properties.actions.items.properties.intentContract.properties.message","properties.actions.items.properties.clarification.properties.pendingPlan.properties.chartType","properties.actions.items.properties.clarification.properties.pendingPlan.properties.title","properties.actions.items.properties.clarification.properties.pendingPlan.properties.description","properties.actions.items.properties.clarification.properties.pendingPlan.properties.aggregation","properties.actions.items.properties.clarification.properties.pendingPlan.properties.groupByColumn","properties.actions.items.properties.clarification.properties.pendingPlan.properties.valueColumn","properties.actions.items.properties.clarification.properties.pendingPlan.properties.xValueColumn","properties.actions.items.properties.clarification.properties.pendingPlan.properties.yValueColumn","properties.actions.items.properties.clarification.properties.pendingPlan.properties.secondaryValueColumn","properties.actions.items.properties.clarification.properties.pendingPlan.properties.secondaryAggregation","properties.actions.items.properties.clarification.properties.pendingPlan.properties.defaultTopN","properties.actions.items.properties.clarification.properties.pendingPlan.properties.defaultHideOthers","properties.actions.items.properties.clarification.properties.pendingPlan.properties.orderBy","properties.actions.items.properties.clarification.properties.pendingPlan.properties.orderBy.items.properties.direction","properties.actions.items.properties.clarification.properties.pendingPlan.properties.rowFilter","properties.actions.items.properties.clarification.properties.pendingPlan.properties.rowFilter.properties.column","properties.actions.items.properties.clarification.properties.pendingPlan.properties.rowFilter.properties.values","properties.actions.items.properties.clarification.properties.pendingPlan.properties.limit","properties.plans.items.properties.aggregation","properties.plans.items.properties.groupByColumn","properties.plans.items.properties.valueColumn","properties.plans.items.properties.xValueColumn","properties.plans.items.properties.yValueColumn","properties.plans.items.properties.secondaryValueColumn","properties.plans.items.properties.secondaryAggregation","properties.plans.items.properties.defaultTopN","properties.plans.items.properties.defaultHideOthers","properties.plans.items.properties.orderBy","properties.plans.items.properties.orderBy.items.properties.direction","properties.plans.items.properties.rowFilter","properties.plans.items.properties.rowFilter.properties.column","properties.plans.items.properties.rowFilter.properties.values","properties.plans.items.properties.limit"]),Yo=t=>{if(!t)return t;let e=!1;return t.enum&&(e=!0,t.enum.includes(null)||(t.enum=[...t.enum,null])),t.type?Array.isArray(t.type)?t.type.includes("null")||(t.type=[...t.type,"null"]):t.type!=="null"&&(t.type=[t.type,"null"]):e||(t.type=["null"]),t},Ko=t=>t.replace(/\.oneOf\[\d+\]/g,"").replace(/\.anyOf\[\d+\]/g,""),me=(t,e="")=>{if(Array.isArray(t))return t.map(s=>me(s,`${e}[]`));if(t&&typeof t=="object"){const s={};for(const[r,a]of Object.entries(t)){if(r==="type"){Array.isArray(a)?s.type=a.map(u=>Jo.get(u)??u):s.type=Jo.get(a)??a;continue}if(r==="properties"&&a&&typeof a=="object"){s.properties={};for(const[u,d]of Object.entries(a)){const c=e?`${e}.properties.${u}`:`properties.${u}`;s.properties[u]=me(d,c)}continue}if(r==="items"){const u=e?`${e}.items`:"items";s.items=me(a,u);continue}if(r==="oneOf"&&Array.isArray(a)){s.oneOf=a.map((u,d)=>me(u,`${e}.oneOf[${d}]`));continue}if(r==="anyOf"&&Array.isArray(a)){s.anyOf=a.map((u,d)=>me(u,`${e}.anyOf[${d}]`));continue}s[r]=me(a,e?`${e}.${r}`:r)}const i=Ko(e);if(s.type==="object"&&Qy.has(i)){const r=s.properties?Object.keys(s.properties):[];s.required=r}return Wo.has(i)?Yo(s):s}const n=Ko(e);return Wo.has(n)?Yo(t):t};me(Py);me(Ny);me(My);me(ky);me(Zy);me(Xy);const jy=7e3,e_="[Context trimmed due to budget: ",ki=(t,e=jy,n)=>{const s=(n==null?void 0:n.includeTrimNote)??!0,i=n!=null&&n.stageFilter?new Set(Array.isArray(n.stageFilter)?n.stageFilter:[n.stageFilter]):null,a=[...i?t.filter(p=>p.stage?i.has(p.stage):!1):t].sort((p,h)=>{const m=typeof p.priority=="number"?p.priority:5,_=typeof h.priority=="number"?h.priority:5;return m-_}),u=[],d=[];let c=0;a.forEach((p,h)=>{var w;const m=(w=p.content)==null?void 0:w.trim();if(!m)return;const _=m,g=_.length+(u.length>0?2:0);p.required||u.length===0||c+g<=e?(u.push(_),c+=g):d.push(p.label||`Section ${h+1}`)});let f=u.join(`

`);if(s&&d.length>0){const p=`${e_}${d.join(", ")}]`;f=`${f}

${p}`}return{prompt:f,trimmedSections:d}},Ql=(t,e=5)=>{const n=t.length>0?t.slice(-e):[];return n.length===0?"No prior conversation.":n.map(s=>`${s.sender==="ai"?"Agent":"User"}: ${s.text}`).join(`
`)},t_=(t,e,n,s,i,r,a,u)=>{const d=Ql(e,5),c='\nYou are beginning STEP 1 of a multi-stage workflow. Your sole objective in this turn is to emit a high-quality `plan_state_update` action that sets the shared goal tracker for the UI. Do **not** run tools, transformations, DOM actions, or conversational replies yet.\nRequirements for this response:\n- The first action must be `plan_state_update` with goal, contextSummary, progress, nextSteps (each having id + label), blockedBy (or null), observationIds (array, can be empty), confidence (0-1 or null), and updatedAt.\n- Every action you send must include `type`, `responseType`, and `stepId`. The runtime will append metadata such as timestamps and stateTag tokens.\n- Each action\'s `reason` must be no more than 280 characters and clearly state the immediate justification for that step (e.g., "Plan: drafting the chart creation steps").\n- The plan_state_update payload must include `planId`, `currentStepId`, and a comprehensive `steps` array where each entry has `intent` and `status` (`ready`|`in_progress`|`done`).\n- Emit exactly **one** action (the plan_state_update). **Do NOT** include `text_response`; the host UI will provide any greeting copy.\n- If the user\'s latest message is merely a greeting or check-in (e.g., "hi", "hello there", ""), still include a first nextSteps entry with id "acknowledge_user" and a label that confirms you will greet/clarify with them before moving to data work.\n- Keep nextSteps focused on the minimum set of concrete moves (e.g., build chart, run filter, gather clarification). Reference dataset columns exactly as they appear.\n- Return **raw JSON only** (no Markdown fences/backticks, no commentary) and only include the fields described abovedo not invent extra keys.\n- Never wrap the JSON in ``` ``` or prepend/append explanatory text; the response must begin with { and end with }.\n'.trim(),f=`
Recent conversation (last ${Math.min(e.length,5)} turn${Math.min(e.length,5)===1?"":"s"}):
${d}
`.trim(),p=`
The user's latest request is: "${n}"

Output your answer as a JSON object with an "actions" array. Remember: stay in planning mode only; do not issue executions until the goal tracker is established.
`.trim(),h=[{label:"Instructions",content:c,required:!0,priority:0,stage:"seed"},{label:"Recent conversation",content:f,priority:1,stage:"conversation"},{label:"Latest request",content:p,required:!0,priority:2,stage:"action"}],{prompt:m,trimmedSections:_}=ki(h);return _.length>0&&typeof console<"u"&&console.info("[promptBudget] Plan primer trimmed sections:",_),m},jl=(t,e,n,s,i,r,a,u,d,c,f,p)=>{const h=Ql(e,5),_=`${f.length>0?f.slice(-5).map(H=>`- [${H.source}/${H.status.toUpperCase()}] ${H.actionType}: ${H.summary}${H.details?` (${H.details})`:""}`).join(`
`):"No prior tool actions have been recorded yet. You are starting fresh. Always observe before acting."}
- [DATA_VIEW] Raw Data Explorer filter: ${p}`,g=u.length>0?u.slice(-5).map(H=>{const he=H.outputs?JSON.stringify(H.outputs).slice(0,160):"No structured output reported.";return`- [${H.status.toUpperCase()}] ${H.responseType} (action ${H.actionId.slice(-6)}): ${he}`}).join(`
`):"No runtime observations captured yet for this session.",T=d?`Goal: ${d.goal}
Context: ${d.contextSummary||""}
Progress: ${d.progress}
Next Steps:
${d.nextSteps.map((H,he)=>`  ${he+1}. [${H.id}] ${H.label}`).join(`
`)}
Blocked By: ${d.blockedBy||"Nothing reported."}
Confidence: ${typeof d.confidence=="number"?d.confidence.toFixed(2):"Not provided"}
Referenced Observations: ${d.observationIds&&d.observationIds.length>0?d.observationIds.join(", "):"None specified."}`:"No structured goal has been recorded yet. Your first action must be a plan_state_update that defines a clear goal, ties it to current data, and lists concrete next steps.",w=t.length>0?`Column inventory (${t.length} total, showing up to 10): ${t.slice(0,10).map(H=>`${H.name} (${H.type})`).join(", ")}`:"No columns detected.",v=s.length>0?`Existing cards (${s.length} total, showing up to 4):
${s.slice(0,4).map(H=>`- ${H.title}${H.chartType?` (${H.chartType})`:""}`).join(`
`)}`:"No analysis cards visible yet.",S=`Core analysis briefing:
${r||"Not generated yet."}`,C=c?`Data preparation log:
Explanation: ${c.explanation}
Code:
${c.jsFunctionBody}`:"No AI-driven data preparation was performed.",N=a.length>0?`Long-term memory (top ${Math.min(a.length,3)}):
${a.slice(0,3).join(`
---
`)}`:"No relevant long-term memories.",R=`
You are an expert data analyst and strategist operating with a Reason-Act (ReAct) framework. Every action needs a short reason first, then the action payload. Keep final conversational replies in ${i}.
`.trim(),I='\nPLAN TRACKER PROTOCOL (Follow exactly):\n- Every action JSON must include `type`, `responseType`, and `stepId`. The host app will supply timestamps/stateTags after validation.\n- `plan_state_update` entries must list `nextSteps` objects (id + label) and a `steps` array including `intent` + `status`.\n- Emit at most two actions per turn (plan_state_update + one atomic action). Reasons 280 chars referencing the plan step.\n- Use `await_user` when the user must choose; include numbered options and set `meta.awaitUser=true`.\n- For `dom_action`, always specify `domAction.target`. If the target is unknown, fall back to a text_response asking the user.\n- When blocked, set `plan_state_update.blockedBy` to the waiting label (e.g., "awaiting_clarification").\n- Structured tool intents must be placed in `intentContract` (object with `intent`, `tool`, `args`, `awaitUser`, `message`). Supported tools: csv.aggregate, csv.profile, csv.clean_invoice_month, csv.detect_outliers, ui.remove_card, idb.save_view. For ask_clarify set `tool=null` and `awaitUser=true`. Default aggregation "sum" and groupBy [] when unspecified.\n'.trim();`
DATA PREPARATION LOG:
${c?`Explanation: ${c.explanation}
Code:
${c.jsFunctionBody}`:"No AI-driven data preparation was performed."}
`.trim(),`
LONG-TERM MEMORY:
${a.length>0?a.join(`
---
`):"No specific long-term memories are relevant."}
`.trim();const q=`
AGENT PLAN STATE:
${T}
`.trim();s.length>0&&s.slice(0,6).map(H=>`  - ${H.title}${H.chartType?` (${H.chartType})`:""}`).join(`
`);const P=`
Agent runtime notes:
- Pipeline: Context Builder  Planner  Action Dispatcher. Keep plans concise for downstream executors.
`.trim(),M=`
Recent tool actions:
${_}
`.trim(),U=`
Runtime observations (latest up to 5):
${g}
`.trim(),O=`
Recent conversation:
${h||"No prior conversation."}
`.trim(),Q=`
Latest user message: "${n}"

Respond with a JSON object containing an "actions" array. Example (pseudocode):
{
  "actions": [
    { "type": "plan_state_update", ... },
    { "type": "text_response", ... }
  ]
}

Primary actions available: text_response, plan_creation, dom_action, execute_js_code, clarification_request, await_user, filter_spreadsheet, proceed_to_analysis. Always acknowledge the user via text_response when you finish a complex step.
- Output raw JSON only (no Markdown fences/backticks). Stick to the documented fields; do not add extra keys or prose outside the JSON object.
- The response must start with { and end with }no greetings or commentary outside the JSON.
`.trim();return[{label:"Seed instructions",content:R,required:!0,priority:0,stage:"seed"},{label:"Plan protocol",content:I,required:!0,priority:1,stage:"seed"},{label:"Conversation",content:O,priority:2,stage:"conversation"},{label:"Context: columns",content:w,priority:3,stage:"context"},{label:"Context: cards",content:v,priority:3,stage:"context"},{label:"Context: analysis briefing",content:S,priority:4,stage:"context"},{label:"Context: data prep",content:C,priority:4,stage:"context"},{label:"Context: long-term memory",content:N,priority:5,stage:"context"},{label:"Context: plan state",content:q,priority:5,stage:"context"},{label:"Context: runtime notes",content:P,priority:7,stage:"context"},{label:"Context: action traces",content:M,priority:7,stage:"context"},{label:"Context: observations",content:U,priority:7,stage:"context"},{label:"Action / user request",content:Q,required:!0,priority:8,stage:"action"}]},n_=(t,e,n,s,i,r,a,u,d,c,f,p)=>{const h=jl(t,e,n,s,i,r,a,u,d,c,f,p),{prompt:m,trimmedSections:_}=ki(h);return _.length>0&&typeof console<"u"&&console.info("[promptBudget] Chat prompt trimmed sections:",_),m},s_=(t,e,n,s,i,r,a,u,d,c,f,p,h)=>{const m=jl(e,n,s,i,r,a,u,d,c,f,p,h);return ki(m,void 0,{includeTrimNote:!1,stageFilter:t}).prompt};class eu extends Error{constructor(e,n){super(e),this.name="JsonCoercionError",this.rawContent=n}}const i_=/```(?:json)?\s*([\s\S]*?)```/i,r_=t=>{try{const e=JSON.parse(t);if(e&&typeof e=="object"&&!Array.isArray(e))return e}catch{return null}return null},o_=t=>{let e=0,n=-1,s=!1,i=!1;for(let r=0;r<t.length;r++){const a=t[r];if(s){if(i){i=!1;continue}if(a==="\\"){i=!0;continue}a==='"'&&(s=!1);continue}if(a==='"'){s=!0;continue}if(a==="{")e===0&&(n=r),e+=1;else if(a==="}"&&e>0&&(e-=1,e===0&&n!==-1))return t.slice(n,r+1).trim()}return null},a_=t=>{if(t&&typeof t=="object"&&!Array.isArray(t))return t;const n=(typeof t=="string"?t:t!=null?String(t):"").trim(),s=[];n&&s.push(n);const i=n.match(i_);i!=null&&i[1]&&s.push(i[1].trim());const r=o_(n);r&&s.push(r);for(const a of s){const u=r_(a);if(u)return u}throw new eu("Failed to parse JSON object.",n)};class l_{constructor(){this.seq=0,this.lastEpoch=0}mint(e=Date.now(),n){const s=e>this.lastEpoch?e:this.lastEpoch;return s!==this.lastEpoch&&(this.seq=0,this.lastEpoch=s),this.seq+=1,`${s.toString().padStart(13,"0")}-${this.seq}`}}class zo extends Error{constructor(e,n){super(e),this.name="AiChatResponseParsingError",this.rawContent=n}}const u_=t=>{try{const e=a_(t);if(!e.actions||!Array.isArray(e.actions))throw new zo("Invalid response structure: 'actions' array missing.",JSON.stringify(e));return e}catch(e){throw e instanceof eu?new zo(e.message,e.rawContent):e}},Zo={plan:{phase:"plan",title:"Plan Primer",summary:"During the PLAN phase you are only confirming the mission. Emit exactly two actions in this order: (1) plan_state_update capturing the refreshed plan tracker, (2) text_response that acknowledges the plan and next steps. Do not run tools or code yet.",expectations:["The plan_state_update includes planId, goal, contextSummary, progress, currentStepId, nextSteps, steps, blockedBy, observationIds, confidence, updatedAt, stateTag.","The text_response should reassure the user that their request is understood and restate what happens next.","No execute_js_code, dom_action, or proceed_to_analysis actions are allowed in this phase."]},talk:{phase:"talk",title:"Conversation & Clarification",summary:"During the TALK phase you keep the user in the loop or gather missing info. Start with a plan_state_update when the context changes, then follow with a conversational action such as text_response, clarification_request, or await_user.",expectations:["Never emit execute_js_code or dom_action in the TALK phase.","If you must wait for the user, use await_user with clear choices; otherwise answer with text_response.","Reuse the existing planId and progress when nothing has changed rather than inventing a new plan."]},act:{phase:"act",title:"Action & Tool Execution",summary:"During the ACT phase you must pair a plan_state_update with a single atomic tool call. Keep the planner in sync, then run exactly one action such as execute_js_code, proceed_to_analysis, filter_spreadsheet, or a dom_action that fulfills the current step.",expectations:["When emitting execute_js_code you must provide runnable JavaScript in code.jsFunctionBody that mutates the data array and returns it.","If you are removing or adjusting cards, prefer dom_action with the correct toolName and target metadata.","Keep the action list to two entries max (plan_state_update plus one tool call) so the runtime can stream progress safely."]}},c_="talk",d_=t=>{const e=t?Zo[t]:Zo[c_],n=e.expectations.map(s=>`- ${s}`).join(`
`);return`Phase directive  ${e.title}:
${e.summary}
${n}`},f_=t=>t.actions.some(e=>{var s;if(e.responseType!=="execute_js_code")return!1;const n=(s=e.code)==null?void 0:s.jsFunctionBody;return!n||n.trim().length===0}),tu=new l_,p_=`Example JSON response (plan_state_update + text acknowledgement):
\`\`\`json
{
  "actions": [
    {
      "type": "plan_state_update",
      "responseType": "plan_state_update",
      "stepId": "plan-init",
      "reason": "Restating the plan so the UI stays in sync.",
      "planState": {
        "planId": "plan-abc123",
        "goal": "Compare revenue vs. orders by channel.",
        "contextSummary": "User asked for the top-performing channels in 2024.",
        "progress": "Ready to build the comparison card.",
        "blockedBy": null,
        "observationIds": [],
        "confidence": 0.65,
        "updatedAt": "2024-05-18T09:00:00.000Z",
        "currentStepId": "plan-init",
        "nextSteps": [{ "id": "acknowledge_user", "label": "" }],
        "steps": [
          {
            "id": "acknowledge_user",
            "label": "",
            "intent": "conversation",
            "status": "in_progress"
          }
        ],
        "stateTag": "context_ready"
      }
    },
    {
      "type": "text_response",
      "responseType": "text_response",
      "stepId": "plan-init",
      "reason": "Let the user know I captured the plan.",
      "text": ""
    }
  ]
}
\`\`\``,h_=t=>typeof t!="number"||Number.isNaN(t)||!Number.isFinite(t)?.65:Math.min(1,Math.max(0,t)),m_=t=>{if(t.type!=="plan_state_update"||!t.planState)return;const e=t.planState;(typeof e.updatedAt!="string"||!e.updatedAt.trim())&&(e.updatedAt=new Date().toISOString()),(typeof e.stateTag!="string"||!e.stateTag.trim())&&(e.stateTag=tu.mint(Date.now(),"plan")),Array.isArray(e.observationIds)||(e.observationIds=[]),e.blockedBy=e.blockedBy??null,(typeof e.contextSummary!="string"||e.contextSummary.trim().length===0)&&(e.contextSummary=null),e.confidence=h_(e.confidence)},g_=async(t,e,n,s,i,r,a,u,d,c,f,p,h,m)=>{if(!(i.provider==="google"&&!!i.geminiApiKey||i.provider==="openai"&&!!i.openAIApiKey))return{actions:[{type:"text_response",responseType:"text_response",stepId:"ad_hoc_response",stateTag:tu.mint(Date.now(),"fallback"),text:"Cloud AI is disabled. API Key not provided.",reason:"API key is missing, so I must inform the user."}]};try{const g=(m==null?void 0:m.mode)??"full",T=g==="full"?m==null?void 0:m.promptStage:void 0,w=g==="plan_only"?"chat.plan_only":"chat.full",v=(m==null?void 0:m.phase)??(g==="plan_only"?"plan":void 0),S=d_(v),C=g==="plan_only"?t_(t,e,n,i.language,r,u,d,s):T?(Array.isArray(T)?T:[T]).map(q=>s_(q,t,e,n,s,i.language,r,u,d,c,f,p,h)).join(`

`):n_(t,e,n,s,i.language,r,u,d,c,f,p,h);if(m!=null&&m.onPromptProfile){const q=g==="full"&&T?Array.isArray(T)?T.join("+"):T:null,P=g==="plan_only"?"chat_plan_primer":`chat_full${q?`_stage_${q}`:""}`,M=C.length,U=Math.ceil(M/4);m.onPromptProfile({mode:g,charCount:M,estimatedTokens:U,promptLabel:P})}const N=`You are an expert data analyst and business strategist, required to operate using a Reason-Act (ReAct) framework. For every action you take, you must first explain your reasoning in the 'reason' field, and then define the action itself. Keep each reason under 280 characters (ideally two sentences or fewer) and tie it to the plan step you're executing. You also maintain an explicit goal tracker by emitting a 'plan_state_update' action at the start of each response (and whenever the mission changes) so the UI can display your progress. Every action JSON object must include \`type\`, \`responseType\`, and \`stepId\`. The runtime appends metadata like timestamps and stateTags automatically, so you may omit them. The plan_state_update payload must include \`planId\`, \`currentStepId\`, and a \`steps\` array (each entry with intent + status). Emit at most two actions per response: the plan_state_update plus a single atomic action. When the user's latest message is only a greeting or check-in, the first entry in \`nextSteps\` (and \`steps\`) must be an \`acknowledge_user\` conversation step before any data work. Your final conversational responses should be in ${i.language}.
${p_}
Your output MUST be a single JSON object with an "actions" key containing an array of action objects. Never wrap the JSON in markdown fences or add commentarythe response must start with '{' and end with '}'.`,R=i.provider==="openai"?2:1;let I="";for(let q=0;q<R;q++){let P;if(i.provider==="openai"){const Q=[{role:"system",content:`${N}
${S}${I}`},{role:"user",content:C}];P=await Yg(i,Q,!1,{signal:m==null?void 0:m.signal,operation:w,onUsage:H=>{var he;return(he=m==null?void 0:m.onUsage)==null?void 0:he.call(m,{...H,operation:w})}})}else{const O=`${C}

${S}`;P=await Kg(i,O,void 0,{signal:m==null?void 0:m.signal,operation:w,onUsage:Q=>{var H;return(H=m==null?void 0:m.onUsage)==null?void 0:H.call(m,{...Q,operation:w})}})}const M=u_(P);if(!M.actions||!Array.isArray(M.actions))throw new Error("Invalid response structure from AI: 'actions' array not found.");if(M.actions.forEach(O=>m_(O)),i.provider==="openai"&&f_(M)&&q<R-1){I=`
IMPORTANT VALIDATION FAILURE: Your previous response included an action with responseType=execute_js_code but did not include a valid code.jsFunctionBody. You must respond with executable JavaScript that mutates the provided data and returns the updated array (including an explicit return statement). Provide only valid JSON matching the required action envelope.`;continue}return M}throw new Error("Failed to obtain a valid AI response after retries.")}catch(g){throw console.error("Error generating chat response:",g),new Error(`Failed to get a valid response from the AI. ${g instanceof Error?g.message:""}`)}},y_="llm_turn",__=t=>!t||typeof t!="object"?!1:t.kind===y_,T_=t=>{switch(t){case"act":return"act";case"plan":case"observe":return"plan";default:return"talk"}},Xo=t=>({type:"text_response",responseType:"text_response",reason:"Notify user about the planner status.",stepId:"graph-plan",stateTag:`ts${Date.now().toString(36)}-plan`,timestamp:new Date().toISOString(),text:t}),v_=async({state:t,payload:e})=>{var s,i;const n={...t,phase:"plan",updatedAt:new Date().toISOString()};if(!e||!__(e))return{state:n,actions:[],label:"plan"};try{const r=await g_(e.columns,e.chatHistory,e.userMessage,e.cardContext,e.settings,e.aiCoreAnalysisSummary,e.currentView,e.longTermMemory,e.recentObservations,e.activePlanState,e.dataPreparationPlan,e.recentActionTraces,e.rawDataFilterSummary,{phase:T_(n.phase)}),a=Array.isArray(r.actions)?r.actions:[],u=ea(n,a);if(!u.ok||!u.nextState){const d=((i=(s=u.violations)==null?void 0:s[0])==null?void 0:i.message)??"LLM response failed validation.";return{state:n,actions:[Xo(d)],label:"plan"}}return{state:u.nextState,actions:u.acceptedActions??a,label:"plan"}}catch(r){return{state:n,actions:[Xo(`LLM ${r instanceof Error?r.message:String(r)}`)],label:"plan"}}},S_=({state:t})=>{const e=t.pendingPlan;if(!e||!e.plan)return{state:{...t,phase:"act"},actions:[],label:"act"};const n={type:"plan_creation",responseType:"plan_creation",stepId:e.id,stateTag:`ts${Date.now().toString(36)}-act`,timestamp:new Date().toISOString(),reason:`${e.summary}`,plan:e.plan},s=C_(e)??null,i=Math.min(t.loopBudget.maxActs,t.loopBudget.actsUsed+1),r={...t.loopBudget,actsUsed:i,exceeded:i>=t.loopBudget.maxActs},a=[n];return s&&a.push(s),{state:{...t,phase:"act",pendingPlan:e,pendingVerification:{id:e.id,description:e.summary,meta:null,summary:e.summary,payload:null,createdAt:new Date().toISOString()},loopBudget:r},actions:a,label:"act"}},C_=t=>{var d,c;if(t.intent!=="remove_rows"||!t.plan)return null;const e=t.plan,n=t.metadata??{},s=typeof n.column=="string"&&n.column.trim().length>0?n.column.trim():typeof((d=e.rowFilter)==null?void 0:d.column)=="string"?e.rowFilter.column:null,r=(Array.isArray(n.values)?n.values:((c=e.rowFilter)==null?void 0:c.values)??[]).map(f=>f!=null?String(f).trim():"").filter(f=>f.length>0);if(!s||r.length===0)return null;const a=` ${s}  ${r.join(", ")} `,u=`
const blocked = new Set(${JSON.stringify(r.map(f=>f.toLowerCase()))});
return data.filter(row => {
    const cell = row[${JSON.stringify(s)}];
    return !blocked.has(String(cell ?? '').toLowerCase());
});
    `.trim();return{type:"execute_js_code",responseType:"execute_js_code",stepId:`remove-${s.toLowerCase()}`,stateTag:`ts${Date.now().toString(36)}-transform`,timestamp:new Date().toISOString(),reason:`${s}  {${r.join(", ")}}`,code:{explanation:a,jsFunctionBody:u},meta:{toolCall:void 0,removalContext:{column:s,values:r}}}},E_=({state:t})=>{var d;const e=t.pendingVerification;if(!e)return{state:{...t,phase:"verify"},actions:[],label:"verify"};const n=e.meta,s=[];e.summary?s.push(e.summary):n&&(n.source&&s.push(`${n.source==="sample"?"":""}`),typeof n.rows=="number"&&s.push(`${n.rows}`),typeof n.processedRows=="number"&&typeof n.totalRows=="number"&&s.push(`${n.processedRows}/${n.totalRows}`),(d=n.warnings)!=null&&d.length&&s.push(` ${n.warnings.length} `),n.summary&&s.push(n.summary));const r=(()=>{const c=e.payload;if(!c||typeof c!="object")return null;switch(typeof c.kind=="string"?c.kind:null){case"profile_dataset":{const p=c.columns,h=c.rowCount,m=c.sampledRows;return`${p??"?"}   ${h??"?"}  ${m??"?"}`}case"normalize_invoice_month":{const p=c.column??"InvoiceMonth",h=c.normalizedCount,m=c.skippedCount;return` ${p} ${h??0} ${m??0}`}case"detect_outliers":{const p=c.column??"value",h=c.count,m=c.threshold;return` ${p} ${h??0}  ${m??"?"}`}case"execute_js_code":{const p=typeof c.column=="string"?c.column:null,h=c.removedRows,m=c.addedRows,_=c.modifiedRows,g=[h?` ${h}`:null,m?` ${m}`:null,_?` ${_}`:null].filter(Boolean),T=g.length?g.join(" / "):"";return p?` ${p}${T}`:`${T}`}case"aggregate_plan":{const p=c.planTitle??e.description,h=c.rows;return`${p} ${h??0} `}default:return null}})();r&&s.push(r);const a=t.loopBudget.exceeded||t.loopBudget.actsUsed>=t.loopBudget.maxActs,u={type:"text_response",responseType:"text_response",stepId:e.id,stateTag:`ts${Date.now().toString(36)}-verify`,timestamp:new Date().toISOString(),reason:"",text:n?`${e.description}
${s.join("  ")}${a?`
 `:""}`:`${e.description}${a?`
 `:""}`};return{state:{...t,phase:"verify",pendingVerification:null,loopBudget:{...t.loopBudget,exceeded:a},blockedBy:a?"loop_budget_exceeded":t.blockedBy},actions:[u],label:"verify"}},bi=self,w_=new su().addNode("observe",mu).addNode("plan",v_).addNode("act",S_).addNode("verify",E_).addEdge("observe","plan").addEdge("plan","act").addEdge("act","verify").setEntryPoint("observe").build();let ue=hu();const Qo=20,He=()=>Date.now(),Je=t=>{bi.postMessage(t)},nu=()=>{Je({type:"graph/ready",version:ru,timestamp:He()})},I_=t=>{var s,i,r,a;const e=He(),n=ea(ue,t);n.ok&&n.nextState&&(ue=n.nextState),Je({type:"graph/validation",ok:n.ok,timestamp:e,code:(i=(s=n.violations)==null?void 0:s[0])==null?void 0:i.code,reason:(a=(r=n.violations)==null?void 0:r[0])==null?void 0:a.message,state:n.nextState})},A_=t=>{const e=t.find(s=>s.meta&&"telemetry"in s.meta);return!e||!e.meta?null:e.meta.telemetry??null},R_=async t=>{const e=await w_.invoke({state:ue,payload:t});ue=e.state;const n=A_(e.actions);Je({type:"graph/pipeline",node:e.label,actions:e.actions,state:ue,phase:ue.phase,loopBudget:ue.loopBudget,telemetry:n,timestamp:He()})},P_=(t,e)=>{var r;const n=ue.awaitPrompt,s=((r=ue.pendingPlan)==null?void 0:r.plan)??null;ue={...ue,awaitingUser:!1,blockedBy:null,awaitPrompt:null,awaitPromptId:null,pendingUserReply:{optionId:t??null,freeText:e??null,promptId:(n==null?void 0:n.promptId)??null,question:(n==null?void 0:n.question)??"User follow-up",options:(n==null?void 0:n.options)??[],at:new Date().toISOString(),plan:s},stateTag:"context_ready",updatedAt:new Date().toISOString()};const i=t||e?`User replied with ${t??""} ${e??""}`.trim():"User reply received.";Je({type:"graph/log",level:"info",message:i,timestamp:He()})},x_=t=>{var a;const e=`verify-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,6)}`,n=new Date().toISOString(),s={id:e,kind:typeof((a=t.payload)==null?void 0:a.kind)=="string"?t.payload.kind:"tool_result",payload:{description:t.description,summary:t.summary??null,meta:t.meta??null,...t.payload??{}},at:n},i=[...ue.observations,s],r=i.length>Qo?i.slice(i.length-Qo):i;ue={...ue,pendingVerification:{id:e,description:t.description,meta:t.meta?{...t.meta,summary:t.summary??void 0}:null,summary:t.summary??null,payload:t.payload??null,createdAt:n},observations:r}},N_=t=>{switch(t.type){case"graph/init":nu();return;case"graph/ping":Je({type:"graph/pong",nonce:t.nonce,timestamp:He()});return;case"graph/shutdown":Je({type:"graph/log",level:"info",message:t.reason?`LangGraph runtime shutting down: ${t.reason}`:"LangGraph runtime shutting down by request.",timestamp:He()}),bi.close();return;case"graph/applyActions":I_(t.actions??[]);return;case"graph/runPipeline":R_(t.payload??{});return;case"graph/userReply":P_(t.optionId??null,t.freeText??null);return;case"graph/tool_result":x_(t.verification);return;default:Je({type:"graph/log",level:"warn",message:`Unhandled client event ${t.type}`,timestamp:He()})}};bi.addEventListener("message",t=>{const e=t.data;if(!e||typeof e!="object"||typeof e.type!="string"){Je({type:"graph/log",level:"warn",message:"Ignored message without graph type.",timestamp:He()});return}N_(e)});nu();
